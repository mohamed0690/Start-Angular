(()=>{var Dc=class{constructor(){this.buffer=""}static append(e,t){e.buffer+=t}static toString(e){return e.buffer}},Pe;(c=>{function g(){return 2.718281828459045}c.Math_E=g;function e(){return 1/0}c.Math_INFINITY=e;function t(){return 0/0}c.Math_NAN=t;function n(){return 3.141592653589793}c.Math_PI=n;function r(){return Math.pow(2,.5)}c.Math_SQRT_2=r;function o(l,u){l<=u;let d=l+(u-l)*Math.random();return l<=d&&d<=u,d}c.Math_randomInRange1=o;function i(l,u){l<=u;let d=l+((u-l)*Math.random()|0);return l<=d&&(l!=u?d<u:d==u),d}c.Math_randomInRange2=i;function a(l,u,d){return l<u?u:l>d?d:l}c.Math_clamp1=a;function s(l,u,d){return l<u?u:l>d?d:l}c.Math_clamp2=s})(Pe||(Pe={}));var xa=g=>g===(g|0);var Vr=g=>g===null?g:g+"";var Lc=class{constructor(e){this._context=null,this._ext=null,this._activeQuery=null,this._isRunning=!1,this._eventsPendingTimestamps=[],this._resolvedEvents=[],this._context=e,this._ext=e.getExtension("EXT_disjoint_timer_query")}start(){if(this._ext==null)throw new Error("EXT_disjoint_timer_query WebGL extension is not available. Cannot start profiler.");if(this._isRunning)throw new Error("Profiler is already running");let e=this._context.getExtension("WEBGL_debug_renderer_info");if(e!==null){let t=this._context.getParameter(e.UNMASKED_RENDERER_WEBGL);if(t.indexOf("NVIDIA GeForce GT 750M")!=-1)throw new Error(`${t} cards seem to have a buggy implementation of EXT_disjoint_timer_query. Refusing to profile to avoid confusing results.`)}this._isRunning=!0,this._eventsPendingTimestamps.length=0,this._resolvedEvents.length=0,this._activeQuery=this._ext.createQueryEXT(),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery)}stop(){if(this._ext!=null){if(!this._isRunning)throw new Error("Profiler is already stopped");this._isRunning=!1,this._activeQuery=null,this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT)}}isRunning(){return this._isRunning}_markAction(e){if(this._ext==null)return;if(this._activeQuery==null)throw new Error("Cannot mark actions while no profile is active");let t=this._activeQuery;this._activeQuery=this._ext.createQueryEXT(),this._ext.endQueryEXT(this._ext.TIME_ELAPSED_EXT),this._ext.beginQueryEXT(this._ext.TIME_ELAPSED_EXT,this._activeQuery),this._eventsPendingTimestamps.push(new Lu(e,t))}pushFrame(e){this._markAction(new Mc(ss.OPEN_FRAME,e))}popFrame(e){this._markAction(new Mc(ss.CLOSE_FRAME,e))}resolveEventsIfPossible(){if(this._ext==null)return;let e=0;for(;e<this._eventsPendingTimestamps.length;){let t=this._eventsPendingTimestamps[e],n=t.query;if(!this._ext.getQueryObjectEXT(n,this._ext.QUERY_RESULT_AVAILABLE_EXT))break;if(this._context.getParameter(this._ext.GPU_DISJOINT_EXT))throw new Error("GPU_DISJOINT_EXT");let r=this._ext.getQueryObjectEXT(n,this._ext.QUERY_RESULT_EXT);this._ext.deleteQueryEXT(n);let i=(this._resolvedEvents.length==0?0:ie.List_last(this._resolvedEvents).timestamp)+r;this._resolvedEvents.push(new Vu(t.action,i)),e=e+1}e>0&&(this._eventsPendingTimestamps=this._eventsPendingTimestamps.slice(e))}hasPendingResults(){return this._eventsPendingTimestamps.length!=0}resolvedEvents(){return this._resolvedEvents}exportSpeedscopeProfile(){let e=[],t=[];if(this._resolvedEvents.length==0)throw new Error("Profile is empty");let n={type:"evented",name:"GPU Profile",unit:"nanoseconds",startValue:0,endValue:ie.List_last(this._resolvedEvents).timestamp,events:t},r={$schema:"https://www.speedscope.app/file-format-schema.json",shared:{frames:e},profiles:[n]},o=new Map,i=c=>(o.has(c)||(o.set(c,e.length),e.push({name:c})),o.get(c)),a="O",s="C";for(let c of this._resolvedEvents)t.push({type:c.action.type==ss.OPEN_FRAME?a:s,frame:i(c.action.name),at:c.timestamp});return JSON.stringify(r)}},ss=(t=>(t[t.OPEN_FRAME=0]="OPEN_FRAME",t[t.CLOSE_FRAME=1]="CLOSE_FRAME",t))(ss||{}),Mc=class{constructor(e,t){this.type=e,this.name=t}},Lu=class{constructor(e,t){this.action=e,this.query=t}},Vu=class{constructor(e,t){this.action=e,this.timestamp=t}},Mu;(e=>{function g(t){return ss[t]}e.GPUProfilerActionType_toString=g})(Mu||(Mu={}));var ls;(r=>{function g(o,i,a){Da?o.annotateBlock(i,a):a()}r.WebGLRenderingContext_annotateBlock=g;function e(o,i,a){return Da?o.annotateBlock(i,a):a()}r.WebGLRenderingContext_annotateBlockAndReturn=e;function t(o,i,a){Da?o.annotateProfile(i,a):a()}r.WebGLRenderingContext_annotateProfile=t;function n(o,i){return o.TEXTURE0+i}r.WebGLRenderingContext_TEXTURE_N=n})(ls||(ls={}));var Da=!1;var an;(o=>{function g(i){let a=[];for(let s=0,c=i.length;s<c;s=s+1)a.push(i[s]);return a}o.asList=g;function e(i,a,s){i.addEventListener(a,s)}o.on1=e;function t(i,a,s,c){i.addEventListener(a,s,c)}o.on2=t;function n(i,a,s){i.removeEventListener(a,s)}o.off=n;function r(i){i.preventDefault()}o.preventDefault=r})(an||(an={}));var Qr;(r=>{function g(o){try{return o.getContext("2d")}catch{}return null}r.HTMLCanvasElement_getContext2D=g;function e(o){let i=null;try{i=o.getContext("webgl")}catch{}return Da?n(o,i):i}r.HTMLCanvasElement_getContextWebGL1=e;function t(o,i){let a=null;try{a=o.getContext("webgl",i)}catch{}return Da?n(o,a):a}r.HTMLCanvasElement_getContextWebGL2=t;function n(o,i){console.log("WebGL intercepts are enabled. This records all calls.");let a=window.requestAnimationFrame,s=0,c=new Lc(i);window.requestAnimationFrame=()=>(s=s+1,c.hasPendingResults()&&c.resolveEventsIfPossible(),a.apply(window,arguments));let l=o,u=i,d=l.width,h=l.height,S=s,f=[],y={},v="  ",b=ce=>{f.push(v+ce)},m=()=>{s!=S&&(S=s,b("yield;"))},p=(ce,V)=>{m(),b(`{ // ${ce}`);let H=v;v+="  ",c.isRunning()&&c.pushFrame(ce);let M=V();return c.isRunning()&&c.popFrame(ce),v=H,b("}"),M},_=(ce,V)=>{c.isRunning()&&c.pushFrame(ce),V(),c.isRunning()&&c.popFrame(ce)},T=()=>{let ce=`function* render(gl) {

`;ce+=`  // Recorded using https://github.com/evanw/webgl-recorder
`;for(let V in y)ce+="  var "+V+`s = [];
`;for(let V of f)ce+=V+`
`;return ce+=`}
`,ce},N=(ce,V)=>{let H=document.createElement("a");H.href=URL.createObjectURL(new Blob([ce],{type:"application/javascript"})),H.download=V==null?"trace.js":V,document.body.appendChild(H),H.click(),document.body.removeChild(H)},k=ce=>{N(T(),ce==null?"trace.js":ce)},j=()=>{c.start()},te=ce=>{c.stop();let V=()=>{c.hasPendingResults()?a(V):N(c.exportSpeedscopeProfile(),`viewer-${+new Date}.speedscope.json`)};V()},Y=ce=>{if(ce instanceof WebGLActiveInfo||ce instanceof WebGLBuffer||ce instanceof WebGLFramebuffer||ce instanceof WebGLProgram||ce instanceof WebGLRenderbuffer||ce instanceof WebGLShader||ce instanceof WebGLShaderPrecisionFormat||ce instanceof WebGLTexture||ce instanceof WebGLUniformLocation){let V=ce.constructor.name,H=V in y?y[V]:y[V]=[],M=H.indexOf(ce);return M==-1&&(M=H.length,H.push(ce)),V+"s["+M+"]"}return null},_e={traceLines:f,compileTrace:T,downloadTrace:k,startProfile:j,stopProfile:te,annotateBlock:p,annotateProfile:_};b(`gl.canvas.width = ${d};`),b(`gl.canvas.height = ${h};`);for(let ce in u){let V=u[ce];if(typeof V=="function"){let H=((M,K)=>()=>{let U=[];m(),(l.width!=d||l.height!=h)&&(d=l.width,h=l.height,b(`gl.canvas.width = ${d};`),b(`gl.canvas.height = ${h};`));for(let O=0,G=arguments.length;O<G;O=O+1){let L=arguments[O];if(typeof L=="number"||typeof L=="boolean"||typeof L=="string"||Array.isArray(L)||L===null)U.push(JSON.stringify(L));else if(ArrayBuffer.isView(L))U.push(`new ${L.constructor.name}([${Array.prototype.slice.call(L)}])`);else{let $=Y(L);$!=null?U.push($):(console.warn("unsupported value:",L),U.push("null"))}}let P=`gl.${M}(`;for(let O=0,G=U.length;O<G;O=O+1)O!=0&&(P+=", "),P+=U[O];P+=");",c.isRunning()&&M.startsWith("draw")&&c.pushFrame(P);let J=K.apply(u,arguments);c.isRunning()&&M.startsWith("draw")&&c.popFrame(P);let z=Y(J);return z!=null&&(P=z+" = "+P),b(P),J})(ce,V);_e[ce]=H}else(H=>{Object.defineProperty(_e,H,{set:M=>{u[H]=M},get:()=>u[H]})})(ce)}return window.recordingContext=_e,_e}r.HTMLCanvasElement_makeRecordableContext=n})(Qr||(Qr={}));var sl;(t=>{function g(n){return n.result instanceof ArrayBuffer,n.result}t.FileReader_resultAsArrayBuffer=g;function e(n){return n.result,n.result}t.FileReader_resultAsString=e})(sl||(sl={}));var ta;(e=>{function g(t){return t&&t.now?t.now():+new Date}e.Performance_now=g})(ta||(ta={}));var $t;(_=>{function g(T,N,k){an.on1(T,N,k)}_.EventTarget_addEventListener1=g;function e(T,N,k){an.on1(T,N,k)}_.EventTarget_addEventListener2=e;function t(T,N,k){an.on1(T,N,k)}_.EventTarget_addEventListener3=t;function n(T,N,k){an.on1(T,N,k)}_.EventTarget_addEventListener4=n;function r(T,N,k){an.on1(T,N,k)}_.EventTarget_addEventListener5=r;function o(T,N,k){an.on1(T,N,k)}_.EventTarget_addEventListener6=o;function i(T,N,k){an.on1(T,N,k)}_.EventTarget_addEventListener7=i;function a(T,N,k,j){an.on2(T,N,k,j)}_.EventTarget_addEventListener8=a;function s(T,N,k,j){an.on2(T,N,k,j)}_.EventTarget_addEventListener9=s;function c(T,N,k,j){an.on2(T,N,k,j)}_.EventTarget_addEventListener10=c;function l(T,N,k,j){an.on2(T,N,k,j)}_.EventTarget_addEventListener11=l;function u(T,N,k,j){an.on2(T,N,k,j)}_.EventTarget_addEventListener12=u;function d(T,N,k,j){an.on2(T,N,k,j)}_.EventTarget_addEventListener13=d;function h(T,N,k,j){an.on2(T,N,k,j)}_.EventTarget_addEventListener14=h;function S(T,N,k){an.off(T,N,k)}_.EventTarget_removeEventListener1=S;function f(T,N,k){an.off(T,N,k)}_.EventTarget_removeEventListener2=f;function y(T,N,k){an.off(T,N,k)}_.EventTarget_removeEventListener3=y;function v(T,N,k){an.off(T,N,k)}_.EventTarget_removeEventListener4=v;function b(T,N,k){an.off(T,N,k)}_.EventTarget_removeEventListener5=b;function m(T,N,k){an.off(T,N,k)}_.EventTarget_removeEventListener6=m;function p(T,N,k){an.off(T,N,k)}_.EventTarget_removeEventListener7=p})($t||($t={}));var Br;(r=>{function g(o){return new Image}r.HTMLDocument_createElementImage=g;function e(o){return o.createElement("canvas")}r.HTMLDocument_createElementCanvas=e;function t(o,i){return an.asList(o.querySelectorAll(i))}r.HTMLDocument_querySelectorAll=t;function n(o,i){return an.asList(o.getElementsByClassName(i))}r.HTMLDocument_getElementsByClassName=n})(Br||(Br={}));var To;(e=>{function g(t){an.preventDefault(t)}e.Event_preventDefault=g})(To||(To={}));var ll;(t=>{function g(n){return an.asList(n.types)}t.DataTransfer_types=g;function e(n){return an.asList(n.files)}t.DataTransfer_files=e})(ll||(ll={}));var Bu;(e=>{function g(t){if(typeof t.buttons=="undefined"){let n=t.which;return n<2?n:n==3?2:4}return t.buttons}e.MouseEvent_buttons=g})(Bu||(Bu={}));var cl;(n=>{function g(r){return an.asList(r.touches)}n.TouchEvent_touches=g;function e(r){return an.asList(r.targetTouches)}n.TouchEvent_targetTouches=e;function t(r){return an.asList(r.changedTouches)}n.TouchEvent_changedTouches=t})(cl||(cl={}));function kr(){return self}var na=kr();var dl;(o=>{function g(a,s){let c=0;switch(s){case e.UTF8:{for(let l of a)l<128?c=c+1:l<2048?c=c+2:l<65536?c=c+3:c=c+4;break}case e.UTF16:{for(let l of a)l<65536?c=c+1:c=c+2;break}case e.UTF32:{c=a.length;break}}return c}o.codeUnitCountForCodePoints=g;let e;(l=>(l[l.UTF8=0]="UTF8",l[l.UTF16=1]="UTF16",l[l.UTF32=2]="UTF32"))(e=o.Encoding||(o.Encoding={}));let i=class{reset(s,c){return this.value=s,this.index=c,this.stop=s.length,this}countCodePointsUntil(s){let c=0;for(;this.index<s&&this.nextCodePoint()>=0;)c=c+1;return c}previousCodePoint(){if(this.index<=0)return-1;let s=this.value.charCodeAt(this.index=this.index-1);return(s&64512)!=56320?s:this.index<=0?-1:(this.value.charCodeAt(this.index=this.index-1)<<10)+s+(65536-(55296<<10)-56320)}nextCodePoint(){if(this.index>=this.stop)return-1;let s=this.value.charCodeAt((this.index=this.index+1)+-1);if((s&64512)!=55296)return s;if(this.index>=this.stop)return-1;let c=this.value.charCodeAt((this.index=this.index+1)+-1);return(s<<10)+c+(65536-(55296<<10)-56320)}constructor(){this.value="",this.index=0,this.stop=0}},t=i;t.INSTANCE=new i,o.StringIterator=t;let n;(s=>{function a(c){return e[c]}s.Encoding_toString=a})(n=o.in_Encoding||(o.in_Encoding={})),o.STRING_ENCODING=mi==1?0:mi==2||mi==3?1:2})(dl||(dl={}));var fe=class{static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:e.value==t.value}constructor(e){this.value=e}},ie;(z=>{function g(O,G){return O[0]=G}z.List_setFirst=g;function e(O,G,L){return O[G]=L}z.List_set=e;function t(O,G){return O[O.length-1]=G}z.List_setLast=t;function n(O){return O.length}z.List_count=n;function r(O,G,L){for(G>=0;O.length<G;)O.push(L);for(;O.length>G;)o(O)}z.List_resize=r;function o(O){O.length!=0,O.pop()}z.List_removeLast=o;function i(O,G){let L=0;for(let $=0,se=O.length;$<se;$=$+1)O[$]!=G&&(L<$&&(O[L]=O[$]),L=L+1);for(;L<O.length;)o(O)}z.List_removeAll=i;function a(O,G){return O[G]}z.List_get=a;function s(O){let G=0;for(let L=0,$=O.length;L<$;L=L+1){let se=!1,nt=O[L];for(let ot=0;ot<L;ot=ot+1)if(nt==O[ot]){se=!0;break}se||(G<L&&(O[G]=O[L]),G=G+1)}for(;G<O.length;)o(O)}z.List_removeDuplicates=s;function c(O){let G=O.length;for(let L=0,$=G-1;L<$;L=L+1)l(O,L,L+(Math.random()*(G-L)|0))}z.List_shuffle=c;function l(O,G,L){0<=G&&G<O.length,0<=L&&L<O.length;let $=O[G];O[G]=O[L],O[L]=$}z.List_swap=l;function u(O,G){return O.indexOf(G)!=-1}z._in=u;function d(O){return O.length==0}z.List_isEmpty=d;function h(O){return O.length!=0,O[O.length-1]}z.List_last=h;function S(O,G){G!=O;let L=G.length;for(let $=0,se=L;$<se;$=$+1)O.unshift(G[L-$-1])}z.List_prepend1=S;function f(O,G){G!=O;for(let L of G)O.push(L)}z.List_append2=f;function y(O,G,L){L!=O;for(let $ of L)O.splice(G,0,$),G=G+1}z.List_insert1=y;function v(O,G,L){O.splice(G,0,L)}z.List_insert2=v;function b(O){O.length!=0,O.shift()}z.List_removeFirst=b;function m(O,G){0<=G&&G<O.length,O.splice(G,1)}z.List_removeAt=m;function p(O,G,L){return 0<=G&&G<=L&&L<=O.length,O.splice(G,L-G)}z.List_takeRange=p;function _(O,G){O.indexOf(G)==-1&&O.push(G)}z.List_appendOne=_;function T(O,G){let L=O.indexOf(G);L>=0&&m(O,L)}z.List_removeOne=T;function N(O,G,L){0<=G&&G<=L&&L<=O.length,O.splice(G,L-G)}z.List_removeRange=N;function k(O,G){let L=0;for(let $=0,se=O.length;$<se;$=$+1)G(O[$])||(L<$&&(O[L]=O[$]),L=L+1);for(;L<O.length;)o(O)}z.List_removeIf=k;function j(O,G){if(O.length!=G.length)return!1;for(let L=0,$=O.length;L<$;L=L+1)if(O[L]!=G[L])return!1;return!0}z.List_equals=j;function te(O){O.length=0}z.List_clear=te;function Y(O,G){let L=O.slice();return L.push(G),L}z.List_cloneAndAppend=Y;function _e(O,G,L){let $=L;for(let se=0,nt=O.length;se<nt;se=se+1)$=G($,O[se],se);return $}z.List_reduce=_e;function ce(O,G){return O.slice(G)}z.List_slice1=ce;function V(O,G,L){return O.slice(G,L)}z.List_slice2=V;function H(O){return O[0]}z.List_first=H;function M(O){return O.shift()}z.List_takeFirst=M;function K(O){return O.pop()}z.List_takeLast=K;function U(O,G){return O.splice(G,1)[0]}z.List_takeAt=U;function P(){return[]}z._new=P;function J(O,G,L){if(O==null!=(G==null))return!1;if(O==null)return!0;if(O.length==G.length){for(let $=0,se=O.length;$<se;$=$+1)if(!L(O[$],G[$]))return!1;return!0}return!1}z.List_equalsWithComparison=J})(ie||(ie={}));var Me;(S=>{function g(f,y,v){f.set(y,v)}S.StringMap_set=g;function e(f,y,v){return f.set(y,v),f}S.StringMap_insert=e;function t(f,y){return f.has(y)}S._in=t;function n(f){return f.size}S.StringMap_count=n;function r(f){return f.size==0}S.StringMap_isEmpty=r;function o(f,y,v){let b=f.get(y);return b!==void 0?b:v}S.StringMap_get=o;function i(f){return Array.from(f.keys())}S.StringMap_keys=i;function a(f){return Array.from(f.values())}S.StringMap_values=a;function s(f){return new Map(f)}S.StringMap_clone=s;function c(f,y){f.delete(y)}S.StringMap_remove=c;function l(f,y){f.forEach((v,b)=>{y(b,v)})}S.StringMap_each=l;function u(f){let y={};return l(f,(v,b)=>{y[v]=b}),y}S.StringMap_toJSObject=u;function d(f,y){return f.get(y)}S.StringMap_get1=d;function h(){return new Map}S._new=h})(Me||(Me={}));var Ht;(h=>{function g(S,f,y){S.set(f,y)}h.IntMap_set=g;function e(S,f,y){return S.set(f,y),S}h.IntMap_insert=e;function t(S,f){return S.has(f)}h._in=t;function n(S){return S.size}h.IntMap_count=n;function r(S){return S.size==0}h.IntMap_isEmpty=r;function o(S,f,y){let v=S.get(f);return v!==void 0?v:y}h.IntMap_get=o;function i(S){return Array.from(S.keys())}h.IntMap_keys=i;function a(S){return Array.from(S.values())}h.IntMap_values=a;function s(S){return new Map(S)}h.IntMap_clone=s;function c(S,f){S.delete(f)}h.IntMap_remove=c;function l(S,f){S.forEach((y,v)=>{f(v,y)})}h.IntMap_each=l;function u(S,f){return S.get(f)}h.IntMap_get1=u;function d(){return new Map}h._new=d})(Ht||(Ht={}));var dt;(s=>{function g(c,l){return o(o(c,l)+l,l)}s.int_modulus=g;function e(){return-2147483647-1}s.int_MIN=e;function t(){return 2147483647}s.int_MAX=t;function n(c,l){let u=c,d=l<0?0:1;for(;l>0;)(l&1)!=0&&(d=d*u),l>>=1,u=u*u;return d}s.int_power=n;function r(c,l){return(l<c?1:0)-(l>c?1:0)}s.int_compare=r;function o(c,l){return na.hack1=c,na.hack2=l,na.hack3=na.hack1%na.hack2,na.hack3|0}s.int_remainder=o;function i(c){return parseInt(c)}s.int_fromString=i;function a(c){return c|0}s.int_fromUint=a})(dt||(dt={}));var en;(l=>{function g(u,d){return u-Math.floor(u/d)*d}l.double_modulus=g;function e(u,d){return Math.pow(u,d)}l.double_power=e;function t(u,d){return(d<u?1:0)-(d>u?1:0)}l.double_compare=t;function n(u){return isFinite(u)}l.double_isFinite=n;function r(u){return isNaN(u)}l.double_isNaN=r;function o(u){return+u}l.double_fromString=o;function i(u,d,h){return u*(1-h)+d*h}l.double_lerp=i;function a(u,d,h){return Math.min(Math.max(u,d),h)}l.double_clamp=a;function s(u,d,h){return Math.abs(u-d)<h}l.double_equals=s;function c(u,d){return u.toFixed(d)}l.double_toFixed=c})(en||(en={}));var Bn;(p=>{function g(_){return _}p.string_toString=g;function e(_){let T=new Dc;for(let N of _)T.buffer+=m(N);return T.buffer}p.string_fromCodePoints=e;function t(_,T){return(T<_|0)-(T>_|0)}p.string_compare=t;function n(_,T){return _.startsWith(T)}p.string_startsWith=n;function r(_,T){return _.endsWith(T)}p.string_endsWith=r;function o(_,T,N){return _.split(T).join(N)}p.string_replaceAll=o;function i(_,T){return _.indexOf(T)!=-1}p._in=i;function a(_){return _.length}p.string_count=a;function s(_,T){let N="";for(let k=0,j=T;k<j;k=k+1)N+=_;return N}p.string_repeat=s;function c(_,T){return T.join(_)}p.string_join=c;function l(_){let T=[];for(let N=0,k=_.length;N<k;N=N+1)T.push(_.charCodeAt(N));return T}p.string_codeUnits=l;function u(_){return String.fromCharCode(_)}p.string_fromCodeUnit=u;function d(_){let T="";for(let N of _)T+=String.fromCharCode(N);return T}p.string_fromCodeUnits=d;function h(_){return _.trim()}p.string_trim=h;function S(_){let T=[],N=dl.StringIterator.INSTANCE;for(N.reset(_,0);;){let k=N.nextCodePoint();if(k<0)return T;T.push(k)}}p.string_codePoints=S;function f(_,T){return _.slice(T)}p.string_slice1=f;function y(_,T,N){return _.slice(T,N)}p.string_slice2=y;function v(_,T){return _.charCodeAt(T)}p.string_get1=v;function b(_,T){return _[T]}p.string_get=b;function m(_){return _<65536?String.fromCharCode(_):String.fromCharCode((_-65536>>10)+55296)+String.fromCharCode((_-65536&(1<<10)-1)+56320)}p.string_fromCodePoint=m})(Bn||(Bn={}));var mi=3;var R;(u=>{function g(d){return d!="-1:-1"&&d!=""}u.isValid=g;function e(d,h){let S=n(d),f=n(h),y=dt.int_compare(S.sessionID,f.sessionID);return y==0&&(y=dt.int_compare(S.localID,f.localID)),y}u.compare=e;function t(d){return d}u.toString=t;function n(d){let h=d.split(":");if(h.length==2){let S={};return S.sessionID=parseInt(h[0]),S.localID=parseInt(h[1]),S}return null}u.toFigGUID=n;function r(){return"-1:-1"}u.invalid=r;function o(d){if(d==null)return null;let h=n(d);return h==null?null:h.sessionID<0||h.localID<0?"-1:-1":d}u.fromString=o;function i(d,h){return d<0||h<0?"-1:-1":`${d}:${h}`}u._new=i;function a(d){return i(d.sessionID,d.localID)}u.fromFigGUID=a;function s(d,h){return d==h}u.equals=s;function c(d,h){if(d.length!=h.length)return!1;for(let S=0,f=d.length;S<f;S=S+1)if(d[S]!=h[S])return!1;return!0}u.isSamePath=c;function l(d){return d=="0:0"}u.isRoot=l})(R||(R={}));var Ma=class{constructor(e,t,n){var o;let r;this._property=0,this._activeCanvasGUID=null,this._onChange=null,this._property=t,this._activeCanvasGUID=(o=e.getActiveCanvas())==null?void 0:o.id(),this._onChange=n,e.addAppObserver(this)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){if(t==null)return;this._activeCanvasGUID=t.id();let n=e==null?void 0:e.get2(this._property),r=t.get2(this._property);n!=r&&this._onChange(r)}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){var n;let t;e.property==this._property&&(!R.equals((n=e.node)==null?void 0:n.id(),this._activeCanvasGUID)||e.oldVal!=e.newVal&&this._onChange(e.newVal))}};var Mi=(d=>(d[d.NONE=0]="NONE",d[d.ZOOM_IN=1]="ZOOM_IN",d[d.ZOOM_OUT=2]="ZOOM_OUT",d[d.ZOOM_RESET=3]="ZOOM_RESET",d[d.ZOOM_TO_FIT=4]="ZOOM_TO_FIT",d[d.MIRROR_TAP=5]="MIRROR_TAP",d[d.CANVAS_MOUSE_DOWN=6]="CANVAS_MOUSE_DOWN",d[d.CANVAS_MOUSE_MOVE=7]="CANVAS_MOUSE_MOVE",d[d.CANVAS_MOUSE_DRAG=8]="CANVAS_MOUSE_DRAG",d[d.CANVAS_MOUSE_UP=9]="CANVAS_MOUSE_UP",d[d.CANVAS_TOUCH_DOWN=10]="CANVAS_TOUCH_DOWN",d[d.REQUEST_CANVAS_CHANGE=11]="REQUEST_CANVAS_CHANGE",d))(Mi||{}),ku;(e=>{function g(t){return Mi[t]}e.Action_toString=g})(ku||(ku={}));var Je;(_=>{function g(T,N,k,j,te,Y){_._internalTrackAnalyticsEvent=T,_._internalDefinedAnalyticsHandler=N,_._appTimerStart=k,_._appTimerStop=j,_._internalLoadTimeTracker=te,_._internalSocketConnectionTracker=Y}_.initialize=g;function e(T){let N=_._internalTrackAnalyticsEvent;return _._internalTrackAnalyticsEvent=T,()=>{_._internalTrackAnalyticsEvent=N}}_.mockTrackEvent=e;function t(T,N){_._internalDefinedAnalyticsHandler!==null&&_._internalDefinedAnalyticsHandler.trackDefinedEvent(T,Me.StringMap_toJSObject(N))}_.trackDefinedEvent=t;function n(T,N){_._internalTrackAnalyticsEvent!=null&&_._internalTrackAnalyticsEvent(T,Me.StringMap_toJSObject(N),void 0)}_.trackEvent1=n;function r(T,N,k){_._internalTrackAnalyticsEvent!=null&&_._internalTrackAnalyticsEvent(T,Me.StringMap_toJSObject(N),Me.StringMap_toJSObject(k))}_.trackEvent2=r;function o(T,N){i(T,N,void 0)}_.trackEventJSON1=o;function i(T,N,k){_._internalTrackAnalyticsEvent!=null&&_._internalTrackAnalyticsEvent(T,N,k)}_.trackEventJSON2=i;function a(T){_._appTimerStart!=null&&_._appTimerStart(T)}_.appTimerStart=a;function s(T){_._appTimerStop!=null&&_._appTimerStop(T)}_.appTimerStop=s;function c(){_._internalLoadTimeTracker!==null&&_._internalLoadTimeTracker.handleMultiplayerOpenConnection()}_.handleMultiplayerOpenConnection=c;function l(){_._internalLoadTimeTracker!==null&&_._internalLoadTimeTracker.handleMultiplayerIFLSatisfied()}_.handleMultiplayerIFLSatisfied=l;function u(){_._internalLoadTimeTracker!==null&&_._internalLoadTimeTracker.handleMultiplayerFirstResponse()}_.handleMultiplayerFirstResponse=u;function d(){_._internalLoadTimeTracker!==null&&_._internalLoadTimeTracker.handleIFLCompleted()}_.handleIFLCompleted=d;function h(T){_._internalSocketConnectionTracker!==null&&_._internalSocketConnectionTracker.handleSocketDisconnect(T)}_.handleMultiplayerSocketDisconnected=h;function S(T,N,k,j){_._internalSocketConnectionTracker!==null&&(T||N>3)&&_._internalSocketConnectionTracker.handleSocketConnectionAttempt(T,N,k,j)}_.handleMultiplayerSocketConnectionAttempt=S,_._internalTrackAnalyticsEvent=null,_._internalDefinedAnalyticsHandler=null,_._internalLoadTimeTracker=null,_._internalSocketConnectionTracker=null,_._appTimerStart=null,_._appTimerStop=null})(Je||(Je={}));function ze(g){let e=new Error(g);setTimeout(()=>{throw e},0)}function La(g){setTimeout(()=>{throw g},0)}function Dg(g){let e=new Error(g);setTimeout(()=>{throw e},0)}function Uu(g){Dg(g)}var Vc=class{textAlignHorizontal(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getTextAlignHorizontal(2);return Se.schema.TextAlignHorizontal[e]}setTextAlignHorizontal(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Se.schema.TextAlignHorizontal[e];x._prototypeLib.nodeTsApiGenerated().setTextAlignHorizontal(t,2)}textAlignVertical(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getTextAlignVertical(2);return Se.schema.TextAlignVertical[e]}setTextAlignVertical(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Se.schema.TextAlignVertical[e];x._prototypeLib.nodeTsApiGenerated().setTextAlignVertical(t,2)}fontSize(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getFontSize(2)}setFontSize(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setFontSize(t,2)}visible(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getVisible(2)}setVisible(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setVisible(t,2)}isBackgroundEnabled(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getBackgroundEnabled(2)}setIsBackgroundEnabled(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setBackgroundEnabled(t,2)}isMask(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getIsMask(2)}setIsMask(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setIsMask(t,2)}isMaskOutline_DEPRECATED(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getIsMaskOutline_DEPRECATED(2)}setIsMaskOutline_DEPRECATED(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setIsMaskOutline_DEPRECATED(t,2)}isInternalOnly(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getIsInternalOnly(2)}setIsInternalOnly(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setIsInternalOnly(t,2)}isFrameMaskDisabled(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getIsFrameClippingDisabled(2)}setIsFrameMaskDisabled(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setIsFrameClippingDisabled(t,2)}isResizeToFit(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getResizeToFit(2)}setIsResizeToFit(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setResizeToFit(t,2)}rectangleCornerRadiiIndependent(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getRectangleCornerRadiiIndependent(2)}setRectangleCornerRadiiIndependent(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setRectangleCornerRadiiIndependent(t,2)}horizontalConstraint(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getHorizontalConstraint(2);return Se.schema.ConstraintType[e]}setHorizontalConstraint(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Se.schema.ConstraintType[e];x._prototypeLib.nodeTsApiGenerated().setHorizontalConstraint(t,2)}verticalConstraint(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getVerticalConstraint(2);return Se.schema.ConstraintType[e]}setVerticalConstraint(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Se.schema.ConstraintType[e];x._prototypeLib.nodeTsApiGenerated().setVerticalConstraint(t,2)}blendMode(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getBlendMode(2);return Se.schema.BlendMode[e]}setBlendMode(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Se.schema.BlendMode[e];x._prototypeLib.nodeTsApiGenerated().setBlendMode(t,2)}strokeAlign(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getStrokeAlign(2);return Se.schema.StrokeAlign[e]}setStrokeAlign(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Se.schema.StrokeAlign[e];x._prototypeLib.nodeTsApiGenerated().setStrokeAlign(t,2)}overlayPositionType(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getOverlayPositionType(2);return Se.schema.OverlayPositionType[e]}setOverlayPositionType(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Se.schema.OverlayPositionType[e];x._prototypeLib.nodeTsApiGenerated().setOverlayPositionType(t,2)}overlayBackgroundInteraction(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getOverlayBackgroundInteraction(2);return Se.schema.OverlayBackgroundInteraction[e]}setOverlayBackgroundInteraction(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Se.schema.OverlayBackgroundInteraction[e];x._prototypeLib.nodeTsApiGenerated().setOverlayBackgroundInteraction(t,2)}styleType(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getStyleType(2);return Se.schema.StyleType[e]}setStyleType(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Se.schema.StyleType[e];x._prototypeLib.nodeTsApiGenerated().setStyleType(t,2)}overflowDirection(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getOverflowDirection(2);return Se.schema.ScrollDirection[e]}setOverflowDirection(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Se.schema.ScrollDirection[e];x._prototypeLib.nodeTsApiGenerated().setOverflowDirection(t,2)}scrollBehavior(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getScrollBehavior(2);return Se.schema.ScrollBehavior[e]}setScrollBehavior(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Se.schema.ScrollBehavior[e];x._prototypeLib.nodeTsApiGenerated().setScrollBehavior(t,2)}maskType(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getMaskType(2);return Se.schema.MaskType[e]}setMaskType(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Se.schema.MaskType[e];x._prototypeLib.nodeTsApiGenerated().setMaskType(t,2)}opacity(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getOpacity(2)}setOpacity(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setOpacity(t,2)}backgroundOpacity(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getBackgroundOpacity(2)}setBackgroundOpacity(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setBackgroundOpacity(t,2)}rectangleTopLeftCornerRadius(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getRectangleTopLeftCornerRadius(2)}setRectangleTopLeftCornerRadius(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setRectangleTopLeftCornerRadius(t,2)}rectangleTopRightCornerRadius(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getRectangleTopRightCornerRadius(2)}setRectangleTopRightCornerRadius(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setRectangleTopRightCornerRadius(t,2)}rectangleBottomLeftCornerRadius(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getRectangleBottomLeftCornerRadius(2)}setRectangleBottomLeftCornerRadius(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setRectangleBottomLeftCornerRadius(t,2)}rectangleBottomRightCornerRadius(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getRectangleBottomRightCornerRadius(2)}setRectangleBottomRightCornerRadius(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setRectangleBottomRightCornerRadius(t,2)}strokeWeight(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getStrokeWeight(2)}setStrokeWeight(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setStrokeWeight(t,2)}cornerRadius(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getCornerRadius(2)}setCornerRadius(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setCornerRadius(t,2)}cornerSmoothing(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getCornerSmoothing(2)}setCornerSmoothing(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setCornerSmoothing(t,2)}overrideKey(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getOverrideKey(2)}setOverrideKey(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setOverrideKey(t,2)}overriddenSymbolID(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getOverriddenSymbolID(2)}stackReverseZIndex(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getStackReverseZIndex(2)}setStackReverseZIndex(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setStackReverseZIndex(t,2)}containerSupportsFillStrokeAndCorners(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getContainerSupportsFillStrokeAndCorners(2)}setContainerSupportsFillStrokeAndCorners(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setContainerSupportsFillStrokeAndCorners(t,2)}isStateGroup(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getIsStateGroup(2)}setIsStateGroup(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setIsStateGroup(t,2)}shapeWithTextType(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getShapeWithTextType(2);return Se.schema.ShapeWithTextType[e]}setShapeWithTextType(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Se.schema.ShapeWithTextType[e];x._prototypeLib.nodeTsApiGenerated().setShapeWithTextType(t,2)}usedAsBaseScreen(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getUsedAsBaseScreen(2)}setUsedAsBaseScreen(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setUsedAsBaseScreen(t,2)}hasBeenLoaded(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApiGenerated().getHasBeenLoaded(2)}setHasBeenLoaded(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=e;x._prototypeLib.nodeTsApiGenerated().setHasBeenLoaded(t,2)}};var Rt=(q=>(q[q.MISSING__=0]="MISSING__",q[q.TEXT_ALIGN_HORIZONTAL=1]="TEXT_ALIGN_HORIZONTAL",q[q.TEXT_ALIGN_VERTICAL=2]="TEXT_ALIGN_VERTICAL",q[q.FONT_SIZE=3]="FONT_SIZE",q[q.TEXT_DATA=4]="TEXT_DATA",q[q.HYPERLINK=5]="HYPERLINK",q[q.MENTION=6]="MENTION",q[q.VISIBLE=7]="VISIBLE",q[q.IS_BACKGROUND_ENABLED=8]="IS_BACKGROUND_ENABLED",q[q.IS_MASK=9]="IS_MASK",q[q.IS_MASK_OUTLINE__DEPRECATED=10]="IS_MASK_OUTLINE__DEPRECATED",q[q.IS_INTERNAL_ONLY=11]="IS_INTERNAL_ONLY",q[q.IS_FRAME_MASK_DISABLED=12]="IS_FRAME_MASK_DISABLED",q[q.IS_RESIZE_TO_FIT=13]="IS_RESIZE_TO_FIT",q[q.RECTANGLE_CORNER_RADII_INDEPENDENT=14]="RECTANGLE_CORNER_RADII_INDEPENDENT",q[q.INTERACTION_MAINTAINED__DEPRECATED=15]="INTERACTION_MAINTAINED__DEPRECATED",q[q.TRANSITION_PRESERVE_SCROLL__DEPRECATED=16]="TRANSITION_PRESERVE_SCROLL__DEPRECATED",q[q.TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED=17]="TRANSITION_SHOULD_SMART_ANIMATE__DEPRECATED",q[q.TYPE=18]="TYPE",q[q.HORIZONTAL_CONSTRAINT=19]="HORIZONTAL_CONSTRAINT",q[q.VERTICAL_CONSTRAINT=20]="VERTICAL_CONSTRAINT",q[q.BLEND_MODE=21]="BLEND_MODE",q[q.STROKE_ALIGN=22]="STROKE_ALIGN",q[q.RELATIVE_TRANSFORM=23]="RELATIVE_TRANSFORM",q[q.PARENT_INDEX=24]="PARENT_INDEX",q[q.CONNECTION_TYPE__DEPRECATED=25]="CONNECTION_TYPE__DEPRECATED",q[q.TRANSITION_TYPE__DEPRECATED=26]="TRANSITION_TYPE__DEPRECATED",q[q.EASING_TYPE__DEPRECATED=27]="EASING_TYPE__DEPRECATED",q[q.INTERACTION_TYPE__DEPRECATED=28]="INTERACTION_TYPE__DEPRECATED",q[q.NAVIGATION_TYPE__DEPRECATED=29]="NAVIGATION_TYPE__DEPRECATED",q[q.OVERLAY_POSITION_TYPE=30]="OVERLAY_POSITION_TYPE",q[q.OVERLAY_BACKGROUND_INTERACTION=31]="OVERLAY_BACKGROUND_INTERACTION",q[q.STYLE_TYPE=32]="STYLE_TYPE",q[q.OVERFLOW_DIRECTION=33]="OVERFLOW_DIRECTION",q[q.SCROLL_BEHAVIOR=34]="SCROLL_BEHAVIOR",q[q.MASK_TYPE=35]="MASK_TYPE",q[q.OPACITY=36]="OPACITY",q[q.BACKGROUND_OPACITY=37]="BACKGROUND_OPACITY",q[q.RECTANGLE_TOP_LEFT_CORNER_RADIUS=38]="RECTANGLE_TOP_LEFT_CORNER_RADIUS",q[q.RECTANGLE_TOP_RIGHT_CORNER_RADIUS=39]="RECTANGLE_TOP_RIGHT_CORNER_RADIUS",q[q.RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS=40]="RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS",q[q.RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS=41]="RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS",q[q.STROKE_WEIGHT=42]="STROKE_WEIGHT",q[q.CORNER_RADIUS=43]="CORNER_RADIUS",q[q.CORNER_SMOOTHING=44]="CORNER_SMOOTHING",q[q.TRANSITION_DURATION__DEPRECATED=45]="TRANSITION_DURATION__DEPRECATED",q[q.TRANSITION_TIMEOUT__DEPRECATED=46]="TRANSITION_TIMEOUT__DEPRECATED",q[q.INTERACTION_DURATION__DEPRECATED=47]="INTERACTION_DURATION__DEPRECATED",q[q.SIZE=48]="SIZE",q[q.OVERRIDE_KEY=49]="OVERRIDE_KEY",q[q.OVERRIDDEN_SYMBOL_ID=50]="OVERRIDDEN_SYMBOL_ID",q[q.INHERIT_FILL_STYLE_ID=51]="INHERIT_FILL_STYLE_ID",q[q.INHERIT_FILL_STYLE_ID_FOR_STROKE=52]="INHERIT_FILL_STYLE_ID_FOR_STROKE",q[q.INHERIT_FILL_STYLE_ID_FOR_BACKGROUND=53]="INHERIT_FILL_STYLE_ID_FOR_BACKGROUND",q[q.INHERIT_TEXT_STYLE_ID=54]="INHERIT_TEXT_STYLE_ID",q[q.INHERIT_EFFECT_STYLE_ID=55]="INHERIT_EFFECT_STYLE_ID",q[q.OVERLAY_RELATIVE_POSITION__DEPRECATED=56]="OVERLAY_RELATIVE_POSITION__DEPRECATED",q[q.BACKGROUND_PAINT_DATA=57]="BACKGROUND_PAINT_DATA",q[q.FILL_PAINT_DATA=58]="FILL_PAINT_DATA",q[q.STROKE_PAINT_DATA=59]="STROKE_PAINT_DATA",q[q.EFFECT_DATA=60]="EFFECT_DATA",q[q.NAME=61]="NAME",q[q.ARC_DATA=62]="ARC_DATA",q[q.BACKGROUND_COLOR=63]="BACKGROUND_COLOR",q[q.PROTOTYPE_BACKGROUND_COLOR=64]="PROTOTYPE_BACKGROUND_COLOR",q[q.PROTOTYPE_DEVICE=65]="PROTOTYPE_DEVICE",q[q.OVERLAY_BACKGROUND_APPEARANCE=66]="OVERLAY_BACKGROUND_APPEARANCE",q[q.EXPORT_SETTINGS_DATA=67]="EXPORT_SETTINGS_DATA",q[q.PROTOTYPE_START_NODE_ID=68]="PROTOTYPE_START_NODE_ID",q[q.CONNECTION_URL_DEPRECATED=69]="CONNECTION_URL_DEPRECATED",q[q.TRANSITION_NODE_ID_DEPRECATED=70]="TRANSITION_NODE_ID_DEPRECATED",q[q.VIDEO_PLAYBACK=71]="VIDEO_PLAYBACK",q[q.FILL_GEOMETRY=72]="FILL_GEOMETRY",q[q.STROKE_GEOMETRY=73]="STROKE_GEOMETRY",q[q.SYMBOL_DATA=74]="SYMBOL_DATA",q[q.COMPILED_VECTOR_DATA=75]="COMPILED_VECTOR_DATA",q[q.STACK_MODE=76]="STACK_MODE",q[q.STACK_REVERSE_Z_INDEX=77]="STACK_REVERSE_Z_INDEX",q[q.CONTAINER_SUPPORTS_FILL_STROKE_AND_CORNERS=78]="CONTAINER_SUPPORTS_FILL_STROKE_AND_CORNERS",q[q.KEY_TRIGGER__DEPRECATED=79]="KEY_TRIGGER__DEPRECATED",q[q.IS_STATE_GROUP=80]="IS_STATE_GROUP",q[q.PROTOTYPE_INTERACTIONS=81]="PROTOTYPE_INTERACTIONS",q[q.VOICE_EVENT_PHRASE__DEPRECATED=82]="VOICE_EVENT_PHRASE__DEPRECATED",q[q.PROTOTYPE_STARTING_POINT=83]="PROTOTYPE_STARTING_POINT",q[q.SHAPE_WITH_TEXT_TYPE=84]="SHAPE_WITH_TEXT_TYPE",q[q.SCROLL_OFFSET=85]="SCROLL_OFFSET",q[q.USED_AS_BASE_SCREEN=86]="USED_AS_BASE_SCREEN",q[q.CURRENT_VIEWPORT_SIZE=87]="CURRENT_VIEWPORT_SIZE",q[q.HAS_BEEN_LOADED=88]="HAS_BEEN_LOADED",q[q.STYLE_ID_FOR_FILL=89]="STYLE_ID_FOR_FILL",q[q.STYLE_ID_FOR_STROKE_FILL=90]="STYLE_ID_FOR_STROKE_FILL",q[q.STYLE_ID_FOR_TEXT=91]="STYLE_ID_FOR_TEXT",q[q.STYLE_ID_FOR_EFFECT=92]="STYLE_ID_FOR_EFFECT",q[q.STYLE_ID_FOR_GRID=93]="STYLE_ID_FOR_GRID",q[q.PHASE=94]="PHASE",q[q.END__=95]="END__",q))(Rt||{});var Bc;(e=>{function g(){return new Map}e._new=g})(Bc||(Bc={}));var Ba=class{toString(){return this.name+" "+this.relativeChildIndex.toString()}toStringWithPrefix(e){let t=e?this.name.split("/")[0]:this.name;return t=t.trim(),t+" "+this.relativeChildIndex.toString()}constructor(e,t){this.name=e,this.relativeChildIndex=t}},Va=class{getData(e,t){let n=this.getAllDataForNode(e);return n!=null&&n.has(t)?n.get(t):null}getAllDataForNode(e){let t=this.getSubTrie(e);return t!=null?t.cache:null}insert(e,t,n){if(e.length==0){this.cache.set(t,n);return}let r=e[0].toString(),o=e.slice(1,e.length);this.children.has(r)||this.children.set(r,new Va),this.children.get(r).insert(o,t,n)}_delete(e,t){if(e.length==0){this.cache.delete(t);return}let n=e[0].toString(),r=e.slice(1,e.length);this.children.has(n)||this.children.set(n,new Va),this.children.get(n)._delete(r,t)}forEach(e){for(let t of Array.from(this.cache.keys()))e(this.cache.get(t));for(let t of Array.from(this.children.keys()))this.children.get(t).forEach(e)}getSubTrie(e){if(e.length==0)return this;let t=e[0].toString();return this.children.has(t)?this.children.get(t).getSubTrie(e.slice(1,e.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let t of Array.from(this.cache.keys()))e!=null&&e(this.cache.get(t));for(let t of Array.from(this.children.keys()))this.children.get(t).uninitialize2(e),this.children.delete(t)}toString1(){return this.toString2(null)}toString2(e){let t=this.toStringHelper(e),n="";for(let r of t)n=n+`${r}
`;return n}toStringHelper(e){let t=[];for(let n of Array.from(this.cache.keys()))t.push(e==null?n:`${n}: ${e(this.cache.get(n))}`);for(let n of Array.from(this.children.keys())){let r=this.children.get(n).toStringHelper(e);for(let o of r)t.push(`${n}/${o}`)}return t}constructor(){this.cache=Bc._new(),this.children=new Map}},ra=class{getData(e,t){if(e.length==0)return null;let n=this._shouldUseTLFStorage(e)?this._getSSTDataCacheFromTLFStorage(e):this._getSSTDataCacheFromLowerNodeStorage(this._getNodesToTraverse(e));return n!=null&&n.has(t)?n.get(t):null}getAllDataForNode(e){return e.length==0?null:this._shouldUseTLFStorage(e)?this._getSSTDataCacheFromTLFStorage(e):this._getSSTDataCacheFromLowerNodeStorage(this._getNodesToTraverse(e))}_getSSTDataCacheFromTLFStorage(e){let t=e[0].toString();return this.tlfNodeStorage.has(t)?this.tlfNodeStorage.get(t).getAllDataForNode([]):null}_getSSTDataCacheFromLowerNodeStorage(e){let t=this._getFirstNodeName(e);return this.lowerNodeStorage.has(t)?this.lowerNodeStorage.get(t).getAllDataForNode(e.slice(1,e.length)):null}insert(e,t,n){e.length!=0&&(this._shouldUseTLFStorage(e)?this._insertIntoTLFStorage(e,t,n):this._insertIntoLowerNodeStorage(this._getNodesToTraverse(e),t,n))}_delete(e,t){e.length!=0&&(this._shouldUseTLFStorage(e)?this._deleteFromTLFStorage(e,t):this._deleteFromLowerNodeStorage(this._getNodesToTraverse(e),t))}_deleteFromTLFStorage(e,t){let n=e[0].toString();!this.tlfNodeStorage.has(n)||this.tlfNodeStorage.get(n)._delete(e.slice(1,e.length),t)}_deleteFromLowerNodeStorage(e,t){let n=this._getFirstNodeName(e);!this.lowerNodeStorage.has(n)||this.lowerNodeStorage.get(n)._delete(e.slice(1,e.length),t)}_insertIntoTLFStorage(e,t,n){let r=e[0].toString();this.tlfNodeStorage.has(r)||this.tlfNodeStorage.set(r,new Va),this.tlfNodeStorage.get(r).insert(e.slice(1,e.length),t,n)}_insertIntoLowerNodeStorage(e,t,n){let r=this._getFirstNodeName(e);this.lowerNodeStorage.has(r)||this.lowerNodeStorage.set(r,new Va),this.lowerNodeStorage.get(r).insert(e.slice(1,e.length),t,n)}forEach(e){for(let t of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(t).forEach(e);for(let t of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(t).forEach(e)}getSubTrie(e){if(e.length==0)return this;if(this._shouldUseTLFStorage(e))return this.tlfNodeStorage.has(e[0].toString())?this.tlfNodeStorage.get(e[0].toString()):null;let t=this._getNodesToTraverse(e),n=this._getFirstNodeName(t);return this.lowerNodeStorage.has(n)?this.lowerNodeStorage.get(n).getSubTrie(t.slice(1,t.length)):null}uninitialize1(){this.uninitialize2(null)}uninitialize2(e){for(let t of Array.from(this.tlfNodeStorage.keys()))this.tlfNodeStorage.get(t).uninitialize2(e),this.tlfNodeStorage.delete(t);for(let t of Array.from(this.lowerNodeStorage.keys()))this.lowerNodeStorage.get(t).uninitialize2(e),this.lowerNodeStorage.delete(t)}toString1(){return this.toString2(null)}toString2(e){let t=this._toStringHelper(e),n="";for(let r of t)n=n+`${r}
`;return n}_toStringHelper(e){let t=[];for(let n of Array.from(this.lowerNodeStorage.keys())){let r=this.lowerNodeStorage.get(n).toStringHelper(e);for(let o of r)t.push(`*/${n}/${o}`)}for(let n of Array.from(this.tlfNodeStorage.keys())){let r=this.tlfNodeStorage.get(n).toStringHelper(e);for(let o of r)t.push(`[TLF]/${n}/${o}`)}return t}_shouldUseTLFStorage(e){return!Q.getFeatureFlags().prototypeStateManagement&&e.length==1}_getFirstNodeName(e){return e.length==1||!Q.getFeatureFlags().prototypeStateManagement?e[0].toStringWithPrefix(Q.getFeatureFlags().prototypeStateManagement):kc.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING}_getNodesToTraverse(e){return Q.getFeatureFlags().prototypeStateManagement?e:e.slice(1,e.length)}constructor(){this.lowerNodeStorage=new Map,this.tlfNodeStorage=new Map}},An;(s=>{function g(){s._cachedNodePaths.clear()}s.clearCachedNodePaths=g;function e(c){if(c==null)return[];if(s._cachedNodePaths.has(c.uniqueIdentifier()))return s._cachedNodePaths.get(c.uniqueIdentifier());let l=c.getSemanticNodePath();return s._cachedNodePaths.set(c.uniqueIdentifier(),l),l}s.getSemanticNodePath=e;function t(c){return c.type()=="FRAME"||c.type()=="INSTANCE"}s._isValidTLFType=t;function n(c){return c.isTopLevel()&&t(c)}s._isValidSemanticTLF=n;function r(c){if(c.isTopLevel()&&!t(c))return[];let l=[],u=!0;for(let d=c.clone();u&&d!=null;d=d.parent())l.splice(0,0,new Ba(d.name(),Q.getFeatureFlags().prototypeStateManagement?o(d):0)),n(d)&&(u=!1);return l}s.getSemanticNodePathHelper=r;function o(c){if(n(c)||c.parent()==null)return 0;let l=c.parent().clone(),u=[],d=l.childCount();for(let h=0;h<d;h=h+1){let S=l.clone();S.moveToChildAt(h),S.name()==c.name()&&u.push(S.uniqueIdentifier())}return u.indexOf(c.uniqueIdentifier())}s.getRelativeChildIndex=o,s.DEFAULT_STORAGE_KEY="storage_key",s._cachedNodePaths=new Map})(An||(An={}));var Gu;(s=>{function g(c){return c}s.SSTDataCache_asMap=g;function e(c){return Array.from(c.keys())}s.SSTDataCache_keys=e;function t(c,l){return c.has(l)}s.SSTDataCache_has=t;function n(c){return c.size}s.SSTDataCache_size=n;function r(c,l){c.delete(l)}s._delete=r;function o(c,l){return c.get(l)}s.SSTDataCache_get=o;function i(c,l,u){c.set(l,u)}s.SSTDataCache_set=i;function a(c,l){c.forEach(l)}s.SSTDataCache_forEach=a})(Gu||(Gu={}));var kc;(e=>e.SemanticStorageTrie_UNIVERSAL_TLF_NAME_FOR_MATCHING="TLF Placeholder")(kc||(kc={}));var Uc=class{constructor(e,t,n,r){this.ax=0,this.bx=0,this.cx=0,this.cy=0,this.by=0,this.ay=0,this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by}_sampleCurveX(e){return((this.ax*e+this.bx)*e+this.cx)*e}_sampleCurveY(e){return((this.ay*e+this.by)*e+this.cy)*e}_sampleCurveDerivativeX(e){return(3*this.ax*e+2*this.bx)*e+this.cx}_sampleCurveDerivativeY(e){return(3*this.ay*e+2*this.by)*e+this.cy}_solveCurveX(e,t){let n=0,r=0,o=0,i=0,a=0;o=e;for(let s=0;s<8;s=s+1){if(i=this._sampleCurveX(o)-e,Math.abs(i)<t)return o;if(a=this._sampleCurveDerivativeX(o),Math.abs(a)<1e-6)break;o=o-i/a}if(n=0,r=1,o=e,o<n)return n;if(o>r)return r;for(;n<r;){if(i=this._sampleCurveX(o),Math.abs(i-e)<t)return o;e>i?n=o:r=o,o=(r-n)*.5+n}return o}solve(e,t){return this._sampleCurveY(this._solveCurveX(e,t))}getYDerivativeForXValue(e,t){let n=this._solveCurveX(e,t),r=this._sampleCurveDerivativeX(n);return Math.abs(r)>0?this._sampleCurveDerivativeY(n)/r:this._sampleCurveDerivativeY(n)}},Gc=class{constructor(e,t){this._bezier=null,this._bezierInverse=null,this._durationSeconds=0,this._bezier=this.bezierForEasingFunction(e),this._bezierInverse=this.inverseBezierForEasingFunction(e),this._durationSeconds=t}bezierForEasingFunction(e){return e==null||e.length!=4?null:new Uc(e[0],e[1],e[2],e[3])}inverseBezierForEasingFunction(e){return e==null||e.length!=4?null:new Uc(e[1],e[0],e[3],e[2])}_solveEpsilon(e){return 1/(200*e)}getYValueForXValue(e){if(this._bezier==null)return e;let t=this._solveEpsilon(this._durationSeconds);return this._bezier.solve(e,t)}getDerivative(e,t){if(this._bezier==null)return 1;let n=this._solveEpsilon(this._durationSeconds);return this._bezier.getYDerivativeForXValue(e,n)}invert(e){if(this._bezier==null)return e;let t=this._solveEpsilon(this._durationSeconds);return this._bezierInverse.solve(e,t)}};var Hu=class{constructor(e,t,n,r){this.m_w0=0,this.m_zeta=0,this.m_wd=0,this.m_A=0,this.m_B=0,this.m_w0=Math.sqrt(t/e),this.m_zeta=n/(2*Math.sqrt(t*e)),this.m_zeta<1?(this.m_wd=this.m_w0*Math.sqrt(1-this.m_zeta*this.m_zeta),this.m_A=1,this.m_B=(this.m_zeta*this.m_w0+-r)/this.m_wd):(this.m_A=1,this.m_B=-r+this.m_w0)}solve(e){return this.m_zeta<1?e=Math.exp(-e*this.m_zeta*this.m_w0)*(this.m_A*Math.cos(this.m_wd*e)+this.m_B*Math.sin(this.m_wd*e)):e=(this.m_A+this.m_B*e)*Math.exp(-e*this.m_w0),1-e}solveInverse(e){let t=0,n=0,r=Pe.Math_PI()/this.m_w0,o=this.solve(r),i=0,a=.001,s=15;for(let c=0;c<s;c=c+1){i=(e-n)/(o-n)*(r-t)+t;let l=this.solve(i);if(Math.abs(l-e)<a)return i;l>e?(t=i,n=l):(r=i,o=l)}return i}},Hc=class{constructor(e,t){this._spring=null,this._durationSeconds=0,this._spring=this.convertFunctionToUnitSpring(e),this._durationSeconds=t}convertFunctionToUnitSpring(e){return e==null||e.length!=4?null:new Hu(e[0],e[1],e[2],e[3])}getYValueForXValue(e){if(this._spring==null)return e;let t=e*this._durationSeconds;return this._spring.solve(t)}getDerivative(e,t){return this._spring==null?1:t}invert(e){return this._spring==null?e:this._spring.solveInverse(e)/this._durationSeconds}};var I=class{constructor(e,t){this._x=0,this._y=0,this._x=e,this._y=t}x(){return this._x}y(){return this._y}setX(e){this._x=e}setY(e){this._y=e}multiply(e){return new I(this.x()*e,this.y()*e)}multiply1(e){return new I(this.x()*e.x(),this.y()*e.y())}add(e){return new I(this.x()+e,this.y()+e)}add1(e){return new I(this.x()+e.x(),this.y()+e.y())}negative(){return new I(-this.x(),-this.y())}subtract(e){return new I(this.x()-e,this.y()-e)}subtract1(e){return new I(this.x()-e.x(),this.y()-e.y())}divide(e){return new I(this.x()/e,this.y()/e)}divide1(e){return new I(this.x()/e.x(),this.y()/e.y())}clone(){return new I(this.x(),this.y())}dot(e){return this.x()*e.x()+this.y()*e.y()}equals(e){return this.x()==e.x()&&this.y()==e.y()}freeze(){return this.clone()}isZero(){return this.x()==0&&this.y()==0}isPositive(){return this.x()>0&&this.y()>0}length(){return Math.sqrt(this.x()*this.x()+this.y()*this.y())}max1(){return Math.max(this.x(),this.y())}max2(e){return new I(Math.max(this.x(),e.x()),Math.max(this.y(),e.y()))}min1(){return Math.min(this.x(),this.y())}min2(e){return new I(Math.min(this.x(),e.x()),Math.min(this.y(),e.y()))}distanceTo(e){return Math.sqrt(this.squaredDistanceTo(e))}withOnesForZeros(){return new I(this.x()==0?1:this.x(),this.y()==0?1:this.y())}area(){return this.x()*this.y()}squaredDistanceTo(e){let t=this.x()-e.x(),n=this.y()-e.y();return t*t+n*n}approximatelyEquals(e,t){return this.squaredDistanceTo(e)<=t*t}mixedWith(e,t){return new I(this.x()+(e.x()-this.x())*t,this.y()+(e.y()-this.y())*t)}flipped(){return new I(this._y,this._x)}mixWith(e,t){this._x+=(e.x()-this.x())*t,this._y+=(e.y()-this.y())*t}addUpdate(e){this._x+=e,this._y+=e}addUpdate1(e){this._x+=e.x(),this._y+=e.y()}subtractUpdate(e){this._x-=e,this._y-=e}subtractUpdate1(e){this._x-=e.x(),this._y-=e.y()}multiplyUpdate(e){this._x*=e,this._y*=e}multiplyUpdate1(e){this._x*=e.x(),this._y*=e.y()}divideUpdate(e){this._x/=e,this._y/=e}divideUpdate1(e){this._x/=e.x(),this._y/=e.y()}rounded(){return new I(Math.round(this._x),Math.round(this._y))}setTo(e,t){return this._x=e,this._y=t,this}copyFrom(e){return this._x=e.x(),this._y=e.y(),this}makeAbs(){return this._x=Math.abs(this._x),this._y=Math.abs(this._y),this}toString(){return`Vector(${this.x()}, ${this.y()})`}toJSON(){return{x:this._x,y:this._y}}static new2(){return new I(0,0)}static new3(e){return new I(e.x(),e.y())}static cross(e,t){return e.x()*t.y()-e.y()*t.x()}static lerp(e,t,n){return e.multiply(1-n).add1(t.multiply(n))}static equals_(e,t){return e==null!=(t==null)?!1:e==null?!0:e.equals(t)}},ye;(a=>{function g(){return I.new2()}a.FrozenVector_new1=g;function e(s){return s}a.FrozenVector_new2=e;function t(s){return I.new3(s)}a.FrozenVector_new3=t;function n(s,c){return new I(s,c)}a.FrozenVector_new4=n,a.FrozenVector_ZERO=g(),a.FrozenVector_ONE=n(1,1),a.FrozenVector_INFINITY=n(Pe.Math_INFINITY(),Pe.Math_INFINITY())})(ye||(ye={}));var Ur=class{static fromMinAndMax(e,t,n,r){return new Ur(e,t,n-e,r-t)}constructor(e,t,n,r){this._x=0,this._y=0,this._width=0,this._height=0,this._x=e,this._y=t,this._width=n,this._height=r}x(){return this._x}y(){return this._y}width(){return this._width}height(){return this._height}setX(e){this._x=e}setY(e){this._y=e}setWidth(e){this._width=e}setHeight(e){this._height=e}clone(){return new Ur(this.x(),this.y(),this.width(),this.height())}freeze(){return this.clone()}left(){return this.x()}top(){return this.y()}right(){return this.x()+this.width()}bottom(){return this.y()+this.height()}centerX(){return this.x()+this.width()/2}centerY(){return this.y()+this.height()/2}area(){return this.width()*this.height()}isEmpty(){return!(this.width()>0&&this.height()>0)}isInvalid(){return!(this.width()>=0&&this.height()>=0)}isFinite(){return isFinite(this._x)&&isFinite(this._y)&&isFinite(this._width)&&isFinite(this._height)}equals(e){return this.x()==e.x()&&this.y()==e.y()&&this.width()==e.width()&&this.height()==e.height()}contains1(e){return this.isEmpty()||e.isEmpty()?!1:this._x<=e.x()&&this._y<=e.y()&&this._x+this._width>=e.x()+e.width()&&this._y+this._height>=e.y()+e.height()}contains2(e){return!this.isEmpty()&&e!=null&&this.left()<=e.x()&&e.x()<this.right()&&this.top()<=e.y()&&e.y()<this.bottom()}overlaps(e){return!this.isEmpty()&&e!=null&&!e.isEmpty()&&this.left()<e.right()&&e.left()<this.right()&&this.top()<e.bottom()&&e.top()<this.bottom()}distanceTo(e){let t=Math.max(0,Math.abs(this.centerX()-e.centerX())-(this.width()+e.width())/2),n=Math.max(0,Math.abs(this.centerY()-e.centerY())-(this.height()+e.height())/2);return Math.sqrt(t*t+n*n)}topLeft(){return new I(this.left(),this.top())}topRight(){return new I(this.right(),this.top())}bottomLeft(){return new I(this.left(),this.bottom())}bottomRight(){return new I(this.right(),this.bottom())}size(){return new I(this.width(),this.height())}center(){return new I(this.x()+this.width()/2,this.y()+this.height()/2)}centerSelf(){return this.translate2(this.center().negative()),this}translate1(e,t){this._x+=e,this._y+=t}translate2(e){this._x+=e.x(),this._y+=e.y()}translatedBy(e){let t=this.clone();return t.translate2(e),t}scaleFromCenter(e){e-=1,this.expand2(this.width()*e,this.height()*e)}scaledBy1(e){return this.scaledBy2(new I(e,e))}scaledBy2(e){return this.isInvalid()?this.copyFrom(Ur.INVALID):this.isFinite()?(this._x=this._x*e.x(),this._y=this._y*e.y(),this._width=this._width*e.x(),this._height=this._height*e.y(),this):this.copyFrom(Ur.INFINITE)}expandToInts(){let e=Math.floor(this._x),t=Math.floor(this._y);this._width=Math.ceil(this._x+this._width)-e,this._height=Math.ceil(this._y+this._height)-t,this._x=e,this._y=t}setTo1(e,t,n,r){return this._x=e,this._y=t,this._width=n,this._height=r,this}setTo2(e,t){return this._x=e.x(),this._y=e.y(),this._width=t.x(),this._height=t.y(),this}copyFrom(e){return this.setX(e.x()),this.setY(e.y()),this.setWidth(e.width()),this.setHeight(e.height()),this}expand1(e){this._x-=e,this._y-=e,this._width+=2*e,this._height+=2*e}contract(e){this.expand1(-e)}expandedBy1(e){return this.expand1(e),this}expandedBy2(e,t){return this.expand2(e,t),this}expand2(e,t){this._x-=e,this._y-=t,this._width+=2*e,this._height+=2*t}expandToInclude(e){if(e.isEmpty())return;if(this.isEmpty()){this.copyFrom(e);return}let t=Math.min(this._x,e.x()),n=Math.min(this._y,e.y());this._width=Math.max(this._x+this._width,e.x()+e.width())-t,this._height=Math.max(this._y+this._height,e.y()+e.height())-n,this._x=t,this._y=n}intersectedWith(e){return this.intersectWith(e),this}intersectWith(e){if(this.isEmpty()||e.isEmpty())this.copyFrom(Kn.FrozenRect_EMPTY);else{let t=Math.max(this._x,e.x()),n=Math.max(this._y,e.y());this._width=Math.min(this._x+this._width,e.x()+e.width())-t,this._height=Math.min(this._y+this._height,e.y()+e.height())-n,this._x=t,this._y=n}}round(){let e=Math.round(this._x),t=Math.round(this._y),n=Math.round(this._x+this._width),r=Math.round(this._y+this._height);this._x=e,this._y=t,this._width=n-e,this._height=r-t}rounded(){return this.round(),this}toString(){return`Rect(${this.x()}, ${this.y()}, ${this.width()}, ${this.height()})`}transformInto1(e,t){bt.INSTANCE.reset();let n=I.new2();for(let r=0;r<4;r=r+1)n.setTo(this._x+this._width*(r&1),this._y+this._height*(r>>1)),t.transformPoint(n),bt.INSTANCE.include2(n);bt.INSTANCE.buildTo(e)}transformBy1(e){this.transformInto1(this,e)}transformInto2(e,t){bt.INSTANCE.reset();let n=I.new2();for(let r=0;r<4;r=r+1)n.setTo(this._x+this._width*(r&1),this._y+this._height*(r>>1)),t.transformPoint(n),bt.INSTANCE.include2(n);bt.INSTANCE.buildTo(e)}transformBy2(e){this.transformInto2(this,e)}leftThird(){return new Ur(this._x,this._y,this._width/3,this._height)}rightThird(){let e=this._width/3;return new Ur(this._x+2*e,this._y,this._width/3,this._height)}static new2(){return new Ur(0,0,0,0)}static new3(e){return new Ur(e.x(),e.y(),e.width(),e.height())}static new4(e,t){return new Ur(e.x(),e.y(),t.x(),t.y())}},B=Ur;B.INVALID=new Ur(Pe.Math_INFINITY(),Pe.Math_INFINITY(),-Pe.Math_INFINITY(),-Pe.Math_INFINITY()),B.INFINITE=new Ur(-Pe.Math_INFINITY(),-Pe.Math_INFINITY(),Pe.Math_INFINITY(),Pe.Math_INFINITY()),B.CLIP=Ur.fromMinAndMax(-1,-1,1,1),B.UNIT=new Ur(0,0,1,1);var zc=class{constructor(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this.reset()}isValid(){return this._minX<this._maxX&&this._minY<this._maxY}isValidOrZeroArea(){return this._minX<=this._maxX&&this._minY<=this._maxY}reset(){this._minX=1/0,this._minY=1/0,this._maxX=-1/0,this._maxY=-1/0}include1(e,t){this._minX=Math.min(this._minX,e),this._minY=Math.min(this._minY,t),this._maxX=Math.max(this._maxX,e),this._maxY=Math.max(this._maxY,t)}include2(e){this.include1(e.x(),e.y())}include3(e){e!=null&&!e.isEmpty()&&(this.include1(e.left(),e.top()),this.include1(e.right(),e.bottom()))}include4(e,t){if(!e.isEmpty()){let n=B.new2();e.transformInto1(n,t),this.include3(n)}}buildTo(e){e.setTo1(this._minX,this._minY,this._maxX-this._minX,this._maxY-this._minY)}build(){let e=B.new2();return this.buildTo(e),e}},bt=zc;bt.INSTANCE=new zc;var Li=class{constructor(){if(arguments[0]==0){let[,e,t,n,r]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=B.new4(e,t),this._nodeRadius=n,this._cornerSmoothing=r}else if(arguments[0]==1){let[,e,t,n,r]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=B.new4(e,t),this._vertexRadii=n,this._cornerSmoothing=r}else if(arguments[0]==2){let[,e,t,n,r]=arguments;this._rect=null,this._nodeRadius=0,this._vertexRadii=null,this._cornerSmoothing=0,this._rect=e,this._nodeRadius=t,this._vertexRadii=n}}clone(){var t;let e;return new Li(2,this._rect.clone(),this._nodeRadius,(t=this._vertexRadii)==null?void 0:t.slice(),this._cornerSmoothing)}cornerSmoothing(){return this._cornerSmoothing}left(){return this._rect.x()}top(){return this._rect.top()}width(){return this._rect.width()}height(){return this._rect.height()}rect(){return this._rect}nodeRadius(){return this._nodeRadius}vertexRadii(){return this._vertexRadii}isRounded(){return this._nodeRadius>0||this._vertexRadii!=null&&this._vertexRadii.some(e=>e>0)}transform(e){e.transformRect(this._rect)}contract(e){this._rect.contract(e)}expand(e){this._rect.expand1(e)}adjustCornerRadiiForSpread(e){if(this._vertexRadii!=null)for(let t=0,n=this.vertexRadii().length;t<n;t=t+1)this._vertexRadii[t]!=0&&(this._vertexRadii[t]=Math.max(this._vertexRadii[t]+e,0));else this._nodeRadius!=0&&(this._nodeRadius=Math.max(this._nodeRadius+e,0))}},Kn;(o=>{function g(){return B.new2()}o.FrozenRect_new1=g;function e(i){return i}o.FrozenRect_new2=e;function t(i){return B.new3(i)}o.FrozenRect_new3=t;function n(i,a,s,c){return new B(i,a,s,c)}o.FrozenRect_new4=n,o.FrozenRect_EMPTY=g()})(Kn||(Kn={}));var Wu=(t=>(t[t.BEZIER=0]="BEZIER",t[t.SPRING=1]="SPRING",t))(Wu||{}),pr=class{constructor(){if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this._durationSeconds=0,this._animationType=0,this._animationFunction=null,this.bounds=null,n=="GENTLE_SPRING"||n=="SPRING_PRESET_ONE"||n=="SPRING_PRESET_TWO"||n=="SPRING_PRESET_THREE"||n=="CUSTOM_SPRING"?this._animationType=1:this._animationType=0,this._durationSeconds=t,this._createAnimationUnit(e),this.bounds=pr.boundsForEasingFunction(e)}else if(arguments.length==2){let e=arguments[0],t=arguments[1];this._durationSeconds=0,this._animationType=0,this._animationFunction=null,this.bounds=null,this._animationType=0,this._durationSeconds=t,this._createAnimationUnit(e),this.bounds=pr.boundsForEasingFunction(e)}}_createAnimationUnit(e){this._animationType==0?this._animationFunction=new Gc(e,this._durationSeconds):this._animationType==1&&(this._animationFunction=new Hc(e,this._durationSeconds))}get(e){return this._animationFunction.getYValueForXValue(e)}getDerivative(e,t){return this._animationFunction.getDerivative(e,t)}invert(e){return this._animationFunction.invert(e)}static boundsForEasingFunction(e){if(e==null)return Kn.FrozenRect_new3(B.fromMinAndMax(0,0,1,1));let t=ye.FrozenVector_new4(0,0),n=ye.FrozenVector_new4(e[0],e[1]),r=ye.FrozenVector_new4(e[2],e[3]),o=ye.FrozenVector_new4(1,1),i=t.clone(),a=o.clone(),s=t.negative().add1(n),c=t.subtract1(n.multiply(2)).add1(r),l=t.negative().add1(n.multiply(3)).subtract1(r.multiply(3)).add1(o),u=c.multiply1(c).subtract1(l.multiply1(s));if(u.x()>0){u.setX(Math.sqrt(u.x()));for(let d of[(-c.x()-u.x())/l.x(),(-c.x()+u.x())/l.x()])if(d>0&&d<1){let h=1-d,S=h*h*h*t.x()+3*h*h*d*n.x()+3*h*d*d*r.x()+d*d*d*o.x();i.setX(Math.min(i.x(),S)),a.setX(Math.max(a.x(),S))}}if(u.y()>0){u.setY(Math.sqrt(u.y()));for(let d of[(-c.y()-u.y())/l.y(),(-c.y()+u.y())/l.y()])if(d>0&&d<1){let h=1-d,S=h*h*h*t.y()+3*h*h*d*n.y()+3*h*d*d*r.y()+d*d*d*o.y();i.setY(Math.min(i.y(),S)),a.setY(Math.max(a.y(),S))}}return B.fromMinAndMax(i.x(),i.y(),a.x(),a.y())}static easingValuesForPreset(e){switch(e){case"IN_CUBIC":return[.42,0,1,1];case"OUT_CUBIC":return[0,0,.58,1];case"INOUT_CUBIC":return[.42,0,.58,1];case"LINEAR":return[0,0,1,1];case"IN_BACK_CUBIC":return[.3,-.05,.7,-.5];case"OUT_BACK_CUBIC":return[.45,1.45,.8,1];case"INOUT_BACK_CUBIC":return[.7,-.4,.4,1.4];case"CUSTOM_CUBIC":return[0,0,.58,1];case"GENTLE_SPRING":return[1,100,15,0];case"SPRING_PRESET_ONE":return[1,300,20,0];case"SPRING_PRESET_TWO":return[1,600,15,0];case"SPRING_PRESET_THREE":return[1,80,20,0];case"CUSTOM_SPRING":return[1,100,15,0]}return[0,0,.58,1]}},zu;(e=>{function g(t){return Wu[t]}e.AnimationType_toString=g})(zu||(zu={}));var xn;(i=>{function g(a){return a=="PUSH_FROM_LEFT"||a=="PUSH_FROM_RIGHT"||a=="PUSH_FROM_TOP"||a=="PUSH_FROM_BOTTOM"}i.isPush=g;function e(a){return a=="MOVE_FROM_LEFT"||a=="MOVE_FROM_RIGHT"||a=="MOVE_FROM_TOP"||a=="MOVE_FROM_BOTTOM"}i.isMove=e;function t(a){return a=="SLIDE_FROM_LEFT"||a=="SLIDE_FROM_RIGHT"||a=="SLIDE_FROM_TOP"||a=="SLIDE_FROM_BOTTOM"}i.isSlide=t;function n(a){return a=="MOVE_OUT_TO_LEFT"||a=="MOVE_OUT_TO_RIGHT"||a=="MOVE_OUT_TO_TOP"||a=="MOVE_OUT_TO_BOTTOM"}i.isMoveOut=n;function r(a){return a=="SLIDE_OUT_TO_LEFT"||a=="SLIDE_OUT_TO_RIGHT"||a=="SLIDE_OUT_TO_TOP"||a=="SLIDE_OUT_TO_BOTTOM"}i.isSlideOut=r;function o(a){return g(a)||e(a)||n(a)||t(a)||r(a)}i.supportsSmartAnimate=o})(xn||(xn={}));var Vo=class{constructor(e,t,n,r,o){this._id=null,this._event=null,this._actions=null,this._allActions=null,this._isDeleted=!1,this._stateManagementVersion=0,this._hoverLastHandledFrameNum=-1,this._id=e,this._event=t,this._actions=n,this._isDeleted=r,this._stateManagementVersion=o,this._allActions=this.getAllActions()}getAllActions(){let e=[];for(let t of this.actions())if(e.push(t),t.connectionType()=="CONDITIONAL")for(let n of t.conditionalActions())for(let r of n.actions())e.push(r);return e}id(){return this._id!=null?this._id:R.invalid()}event(){return this._event!=null?this._event:Gr.createDefault()}action(){return this._actions!=null&&this._actions.length!=0?new fe(this._actions[0]):null}actions(){return this._actions!=null?this._actions:[]}allActions(){return this._allActions!=null?this._allActions:[]}isDeleted(){return this._isDeleted}stateManagementVersion(){return this._stateManagementVersion}withEvent(e){return new Vo(this._id,e,this._actions,this._isDeleted,this._stateManagementVersion)}withActions(e){return new Vo(this._id,this._event,e,this._isDeleted,this._stateManagementVersion)}withStateManagementVersion(e){return new Vo(this._id,this._event,this._actions,this._isDeleted,e)}isValid(){return this.event().interactionType()=="NONE"||this._actions==null||this._actions.length==0?!1:this.action()!=null&&this.action().value.connectionType()!="NONE"}apply(e){let t=this.action(),n=e.action(),r=[];t!=null&&n!=null?r=[t.value.apply(n.value)]:t!=null?r=[t.value]:n!=null&&(r=[n.value]);let o=this._event,i=e._event,a=null;return o!=null&&i!=null?a=o.apply(i):o!=null?a=o:i!=null&&(a=i),new Vo(this._id,a,r,e._isDeleted,e._stateManagementVersion)}setHoverLastHandledFrameNum(e){this._hoverLastHandledFrameNum=e}getHoverLastHandledFrameNum(){return this._hoverLastHandledFrameNum}debugString(){let e="";return e+="PrototypeInteraction(",this._id!=null&&(e+=`id: ${R.toString(this._id)},`),this._event!=null&&(e+=`event: ${this._event.debugString()},`),this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=`isDeleted: ${this._isDeleted},`,e+=")",e}getAllActionsWithSpecificConnectionType(e){let t=[];for(let n of this.actions())if(n.connectionType()==e)t.push(n);else if(n.connectionType()=="CONDITIONAL")for(let r of n.conditionalActions())for(let o of r.actions())n.connectionType()==e&&t.push(n);return t}getAllActionsWithSpecificTransitionType(e){let t=[];for(let n of this.actions())if(n.transitionType()==e)t.push(n);else if(n.connectionType()=="CONDITIONAL")for(let r of n.conditionalActions())for(let o of r.actions())n.transitionType()==e&&t.push(n);return t}getAllValidTransitionActionsInInteraction(){let e=[];for(let t of this.actions())if(R.isValid(t.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(t.connectionType())!=-1)e.push(t);else if(t.connectionType()=="CONDITIONAL")for(let n of t.conditionalActions())for(let r of n.actions())R.isValid(t.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(t.connectionType())!=-1&&e.push(t);return e}interactionContainsTransitionAction(){for(let e of this.actions()){if(R.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0;if(e.connectionType()=="CONDITIONAL"){for(let t of e.conditionalActions())for(let n of t.actions())if(R.isValid(e.transitionNodeID())&&["INTERNAL_NODE","BACK","CLOSE"].indexOf(e.connectionType())!=-1)return!0}}return!1}interactionContainsSpecificConnectionTypeAction(e){for(let t of this.actions()){if(t.connectionType()==e)return!0;if(t.connectionType()=="CONDITIONAL"){for(let n of t.conditionalActions())for(let r of n.actions())if(t.connectionType()==e)return!0}}return!1}getFirstActionInInteractionWithSpecificNavigation(e){for(let t of this.actions())if(t.navigationType()==e)return t;return null}static createDefault(){return new Vo(R.invalid(),Gr.createDefault(),[],!1,0)}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:R.equals(e._id,t._id)&&Gr.equals(e._event,t._event)&&ie.List_equalsWithComparison(e._actions,t._actions,(n,r)=>qn.equals(n,r))&&e._isDeleted==t._isDeleted&&e._stateManagementVersion==t._stateManagementVersion}static applyInteractions(e,t){if(e==null&&t==null)return Vo.EMPTY_LIST;if(e==null)return t;if(t==null)return e;let n=e.slice();return t.forEach(r=>{let o=!1;for(let i=0,a=e.length;i<a;i=i+1){let s=e[i];if(R.equals(s.id(),r.id())){n[i]=s.apply(r),o=!0;break}}o||n.push(r)}),n.filter(r=>!r._isDeleted).slice()}static whichAncestorToSwapState(e,t,n){let r=e!=null?e.scene().findNode1(t):null,o=r==null?void 0:r.findContainingStateGroupOrSelf();if(o==null)return null;let i=e;for(;i!=null;){let a=null;i.type()=="INSTANCE"?a=e.scene().findNode1(i.symbolID()):n==Vo.StateSwapPolicy.INCLUDE_SYMBOLS&&i.type()=="SYMBOL"&&(a=i);let s=a==null?void 0:a.findContainingStateGroupOrSelf();if(o==s)return i;i=i.parent()}return null}static whichInstanceToSwap(e,t){return Vo.whichAncestorToSwapState(e,t,Vo.StateSwapPolicy.INSTANCES_ONLY)}},jt=Vo;jt.EMPTY_LIST=[];(t=>{let g;(o=>(o[o.INCLUDE_SYMBOLS=0]="INCLUDE_SYMBOLS",o[o.INSTANCES_ONLY=1]="INSTANCES_ONLY"))(g=t.StateSwapPolicy||(t.StateSwapPolicy={}));let e;(r=>{function n(o){return t.StateSwapPolicy[o]}r.StateSwapPolicy_toString=n})(e=t.in_StateSwapPolicy||(t.in_StateSwapPolicy={}))})(jt||(jt={}));var ka=class{interactionType(){let e=this._interactionType!=null?this._interactionType:"ON_CLICK";return e=="NONE"?"ON_CLICK":e}interactionMaintained(){return this._interactionMaintained!=null?this._interactionMaintained.value:!1}interactionDuration(){return this._interactionDuration!=null&&this._interactionDuration.value>=0?this._interactionDuration.value:.3}keyTrigger(){return this._keyTrigger!=null?this._keyTrigger:{}}transitionTimeout(){return this._transitionTimeout!=null&&this._transitionTimeout.value>=0?this._transitionTimeout.value:.8}mediaHitTime(){return this._mediaHitTime!=null?this._mediaHitTime.value:0}withInteractionType(e){return new ka(e,this._interactionMaintained,this._interactionDuration,this._keyTrigger,this._transitionTimeout,this._mediaHitTime)}apply(e){let t=this._interactionType,n=this._interactionMaintained,r=this._interactionDuration,o=this._keyTrigger,i=this._transitionTimeout,a=this._mediaHitTime;return e._interactionType!=null&&(t=e._interactionType),e._interactionMaintained!=null&&(n=e._interactionMaintained),e._interactionDuration!=null&&(r=e._interactionDuration),e._keyTrigger!=null&&(o=e._keyTrigger),e._transitionTimeout!=null&&(i=e._transitionTimeout),e._mediaHitTime!=null&&(a=e._mediaHitTime),new ka(t,n,r,o,i,a)}debugString(){let e="";return e+="PrototypeEvent(",this._interactionType!=null&&(e+=`interactionType: ${this._interactionType},`),this._interactionMaintained!=null&&(e+=`interactionMaintained: ${this._interactionMaintained.value},`),this._interactionDuration!=null&&(e+=`interactionDuration: ${this._interactionDuration.value},`),this._keyTrigger!=null&&(e+=`keyTrigger: ${JSON.stringify(this._keyTrigger)},`),this._transitionTimeout!=null&&(e+=`transitionTimeout: ${this._transitionTimeout.value},`),this._mediaHitTime!=null&&(e+=`mediaHitTime: ${this._mediaHitTime.value},`),e+=")",e}static createDefault(){let e={};return e.keyCodes=[],e.triggerDevice="KEYBOARD",new ka("NONE",new fe(!1),new fe(0),e,new fe(0),new fe(0))}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:e._interactionType==t._interactionType&&fe.equals(e._interactionMaintained,t._interactionMaintained)&&fe.equals(e._interactionDuration,t._interactionDuration)&&Wc.equals(e._keyTrigger,t._keyTrigger)&&fe.equals(e._transitionTimeout,t._transitionTimeout)}constructor(e,t,n,r,o,i){this._interactionType=e,this._interactionMaintained=t,this._interactionDuration=n,this._keyTrigger=r,this._transitionTimeout=o,this._mediaHitTime=i}},Gr=ka;Gr.NULL_EVENT=new ka(null,null,null,null,null,null);var ul=class{constructor(){if(arguments.length==1){let e=arguments[0];this._actions=null,this._condition=null,this._actions=e,this._condition=""}else if(arguments.length==2){let e=arguments[0],t=arguments[1];this._actions=null,this._condition=null,this._actions=e,this._condition=t}}actions(){return this._actions}condition(){return this._condition}debugString(){let e="";return e+="ConditionalActions(",this._actions!=null&&(e+=`actions: ${this._actions[0].debugString()},`),e+=")",e}static createDefault(){return new ul([])}static equals(e,t){if(e==null!=(t==null))return!1;if(e==null)return!0;let n=ie.List_equalsWithComparison(e._actions,t._actions,(o,i)=>qn.equals(o,i)),r=e._condition==t._condition;return n&&r}},cs=ul;cs.NULL_CONDITIONAL_ACTIONS=new ul(null);var hr=class{constructor(e,t,n,r,o,i,a,s,c,l,u,d,h,S,f,y,v,b,m,p,_,T){this._transitionNodeID=null,this._transitionType=null,this._transitionDuration=null,this._easingType=null,this._easingFunctionValues=null,this._transitionShouldSmartAnimate=null,this._connectionType=null,this._connectionURL=null,this._overlayRelativePosition=null,this._navigationType=null,this._transitionPreserveScroll=null,this._extraScrollOffset=null,this._mediaAction=null,this._transitionResetVideoPosition=null,this._openUrlInNewTab=null,this._mediaSkipToTime=null,this._mediaSkipByAmount=null,this._transitionResetScrollPosition=null,this._conditionalActions=null,this._transitionResetInteractiveComponents=null,this._targetVariableID=null,this._targetVariableData=null,this.easingFunction=null,this._transitionNodeID=e,this._transitionType=t,this._transitionDuration=n,this._easingType=r,this._easingFunctionValues=o,this._transitionShouldSmartAnimate=i,this._connectionType=a,this._connectionURL=s,this._overlayRelativePosition=c,this._navigationType=l,this._transitionPreserveScroll=u,this.easingFunction=this.easingFunctionFromAction(),this._extraScrollOffset=d,this._mediaAction=h,this._transitionResetVideoPosition=S,this._openUrlInNewTab=f,this._mediaSkipToTime=y,this._mediaSkipByAmount=v,this._transitionResetScrollPosition=b,this._conditionalActions=m,this._transitionResetInteractiveComponents=p,this._targetVariableID=_,this._targetVariableData=T}transitionNodeID(){return this._connectionType==null||this.connectionType()=="INTERNAL_NODE"||this.connectionType()=="UPDATE_MEDIA_RUNTIME"?this._transitionNodeID!=null?this._transitionNodeID:R.invalid():R.invalid()}transitionType(){let e=this._transitionType!=null?this._transitionType:"INSTANT_TRANSITION";return this.navigationType()=="OVERLAY"&&(e=="FADE"||xn.isPush(e)||xn.isSlide(e))?"INSTANT_TRANSITION":e}transitionDuration(){return this.transitionType()=="INSTANT_TRANSITION"?0:this._transitionDuration!=null&&this._transitionDuration.value>=0?this._transitionDuration.value:.3}easingType(){return this._easingType!=null?this._easingType:"OUT_CUBIC"}easingFunctionValues(){switch(this.easingType()){case"CUSTOM_CUBIC":case"GENTLE_SPRING":case"SPRING_PRESET_ONE":case"SPRING_PRESET_TWO":case"SPRING_PRESET_THREE":case"CUSTOM_SPRING":return this._easingFunctionValues!=null?this._easingFunctionValues:pr.easingValuesForPreset(this.easingType());default:break}return pr.easingValuesForPreset(this.easingType())}transitionShouldSmartAnimate(){return this._transitionShouldSmartAnimate!=null?this._transitionShouldSmartAnimate.value:!1}connectionType(){return this._connectionType!=null?this._connectionType:"NONE"}connectionURL(){return this.connectionType()=="URL"?this._connectionURL:null}overlayRelativePosition(){return this._overlayRelativePosition!=null?this._overlayRelativePosition:I.new2()}navigationType(){return this._navigationType!=null?this._navigationType:"NAVIGATE"}mediaAction(){return this._mediaAction!=null?this._mediaAction:"PLAY"}transitionPreserveScroll(){return this.transitionType()=="SMART_ANIMATE"||xn.supportsSmartAnimate(this.transitionType())&&this.transitionShouldSmartAnimate()?!0:xn.isSlide(this.transitionType())||xn.isPush(this.transitionType())||xn.isMove(this.transitionType())?!1:this._transitionPreserveScroll!=null?this._transitionPreserveScroll.value:!1}transitionResetVideoPosition(){return this._transitionResetVideoPosition!=null?this._transitionResetVideoPosition.value:!1}transitionResetScrollPosition(){return this._transitionResetScrollPosition!=null?this._transitionResetScrollPosition.value:!1}transitionResetInteractiveComponents(){return this._transitionResetInteractiveComponents!=null?this._transitionResetInteractiveComponents.value:!1}openUrlInNewTab(){return this._openUrlInNewTab!=null?this._openUrlInNewTab.value:!0}extraScrollOffset(){return this._extraScrollOffset!=null?this._extraScrollOffset:I.new2()}mediaSkipToTime(){return this._mediaSkipToTime!=null&&this._mediaSkipToTime.value>=0?this._mediaSkipToTime.value:0}mediaSkipByAmount(){return this._mediaSkipByAmount!=null&&this._mediaSkipByAmount.value>=0?this._mediaSkipByAmount.value:5}conditionalActions(){return this._conditionalActions!=null?this._conditionalActions:[]}targetVariableID(){return this._targetVariableID}targetVariableData(){return this._targetVariableData}withTransitionNodeID(e){return new hr(e,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionType(e){return new hr(this._transitionNodeID,e,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionShouldSmartAnimate(e){return new hr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,new fe(e),this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withConnectionType(e){return new hr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,e,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withConnectionURL(e){return new hr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,e,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withOverlayRelativePosition(e){return new hr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,e,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withNavigationType(e){return new hr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,e,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionPreserveScroll(e){return new hr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,new fe(e),this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withMediaAction(e){return new hr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,new fe(this.transitionPreserveScroll()),this._extraScrollOffset,e,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionResetVideoPosition(e){return new hr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,new fe(e),this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withOpenUrlInNewTab(e){return new hr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,new fe(e),this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}withTransitionResetInteractiveComponents(e){return new hr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,this._transitionResetScrollPosition,this._conditionalActions,new fe(e),this._targetVariableID,this._targetVariableData)}withTransitionResetScrollPosition(e){return new hr(this._transitionNodeID,this._transitionType,this._transitionDuration,this._easingType,this._easingFunctionValues,this._transitionShouldSmartAnimate,this._connectionType,this._connectionURL,this._overlayRelativePosition,this._navigationType,this._transitionPreserveScroll,this._extraScrollOffset,this._mediaAction,this._transitionResetVideoPosition,this._openUrlInNewTab,this._mediaSkipToTime,this._mediaSkipByAmount,new fe(e),this._conditionalActions,this._transitionResetInteractiveComponents,this._targetVariableID,this._targetVariableData)}easingFunctionFromAction(){return new pr(this.easingFunctionValues(),this.transitionDuration(),this._easingType)}apply(e){let t=this._transitionNodeID,n=this._transitionType,r=this._transitionDuration,o=this._easingType,i=this._easingFunctionValues,a=this._transitionShouldSmartAnimate,s=this._connectionType,c=this._connectionURL,l=this._overlayRelativePosition,u=this._navigationType,d=this._transitionPreserveScroll,h=this._extraScrollOffset,S=this._mediaAction,f=this._transitionResetVideoPosition,y=this._openUrlInNewTab,v=this._mediaSkipToTime,b=this._mediaSkipByAmount,m=this._transitionResetScrollPosition,p=this._conditionalActions,_=this._transitionResetInteractiveComponents,T=this._targetVariableID,N=this._targetVariableData;return e._transitionNodeID!=null&&(t=e._transitionNodeID),e._transitionType!=null&&(n=e._transitionType),e._transitionDuration!=null&&(r=e._transitionDuration),e._easingType!=null&&(o=e._easingType),e._easingFunctionValues!=null&&(i=e._easingFunctionValues),e._transitionShouldSmartAnimate!=null&&(a=e._transitionShouldSmartAnimate),e._connectionType!=null&&(s=e._connectionType),e._connectionURL!=null&&(c=e._connectionURL),e._overlayRelativePosition!=null&&(l=e._overlayRelativePosition),e._navigationType!=null&&(u=e._navigationType),e._transitionPreserveScroll!=null&&(d=e._transitionPreserveScroll),e._extraScrollOffset!=null&&(h=e._extraScrollOffset),e._mediaAction!=null&&(S=e._mediaAction),e._transitionResetVideoPosition!=null&&(f=e._transitionResetVideoPosition),e._openUrlInNewTab!=null&&(y=e._openUrlInNewTab),e._mediaSkipToTime!=null&&(v=e._mediaSkipToTime),e._mediaSkipByAmount!=null&&(b=e._mediaSkipByAmount),e._transitionResetScrollPosition!=null&&(m=e._transitionResetScrollPosition),e._conditionalActions!=null&&(p=e._conditionalActions),e._transitionResetInteractiveComponents!=null&&(_=e._transitionResetInteractiveComponents),e._targetVariableID!=null&&(T=e._targetVariableID),e._targetVariableData!=null&&(N=e._targetVariableData),new hr(t,n,r,o,i,a,s,c,l,u,d,h,S,f,y,v,b,m,p,_,T,N)}debugString(){let e="";return e+="PrototypeAction(",this._transitionNodeID!=null&&(e+=`transitionNodeID: ${R.toString(this._transitionNodeID)},`),this._transitionType!=null&&(e+=`transitionType: ${this._transitionType},`),this._transitionDuration!=null&&(e+=`transitionDuration: ${this._transitionDuration.value},`),this._easingType!=null&&(e+=`easingType: ${this._easingType},`),this._easingFunctionValues!=null&&(e+=`easingFunctionValues: ${this._easingFunctionValues.map(t=>t.toString()).join(",")},`),this._transitionShouldSmartAnimate!=null&&(e+=`transitionShouldSmartAnimate: ${this._transitionShouldSmartAnimate.value},`),this._connectionType!=null&&(e+=`connectionType: ${this._connectionType},`),this._connectionURL!=null&&(e+=`connectionURL: ${Bn.string_toString(this._connectionURL)},`),this._overlayRelativePosition!=null&&(e+=`overlayRelativePosition: ${this._overlayRelativePosition},`),this._navigationType!=null&&(e+=`navigationType: ${this._navigationType},`),this._transitionPreserveScroll!=null&&(e+=`transitionPreserveScroll: ${this._transitionPreserveScroll.value},`),this._extraScrollOffset!=null&&(e+=`extraScrollOffset: ${this._extraScrollOffset},`),this._mediaAction!=null&&(e+=`mediaAction: ${this._mediaAction},`),this._transitionResetVideoPosition!=null&&(e+=`transitionResetVideoPosition: ${this._transitionResetVideoPosition.value},`),this._openUrlInNewTab!=null&&(e+=`openUrlInNewTab: ${this._openUrlInNewTab.value},`),this._mediaSkipToTime!=null&&(e+=`mediaSkipToTime: ${this._mediaSkipToTime.value},`),this._mediaSkipByAmount!=null&&(e+=`mediaSkipByAmount: ${this._mediaSkipByAmount.value},`),this._transitionResetScrollPosition!=null&&(e+=`transitionResetScrollPosition: ${this._transitionResetScrollPosition.value},`),this._conditionalActions!=null&&(e+=`conditionalActions: ${this._conditionalActions[0].debugString()},`),this._transitionResetInteractiveComponents!=null&&(e+=`transitionResetInteractiveComponents: ${this._transitionResetInteractiveComponents.value},`),e+=")",e}static createDefault(){return new hr(R.invalid(),"INSTANT_TRANSITION",new fe(0),"IN_CUBIC",pr.easingValuesForPreset("IN_CUBIC"),new fe(!1),"NONE",null,new I(0,0),"NAVIGATE",new fe(!1),new I(0,0),"PLAY",new fe(!1),new fe(!0),new fe(0),new fe(5),new fe(!1),[],new fe(!1),null,null)}static equals(e,t){return e==null!=(t==null)?!1:e==null?!0:R.equals(e._transitionNodeID,t._transitionNodeID)&&e._transitionType==t._transitionType&&fe.equals(e._transitionDuration,t._transitionDuration)&&e._easingType==t._easingType&&ie.List_equalsWithComparison(e._easingFunctionValues,t._easingFunctionValues,(n,r)=>Math.abs(n-r)<1e-6)&&fe.equals(e._transitionShouldSmartAnimate,t._transitionShouldSmartAnimate)&&e._connectionType==t._connectionType&&e._connectionURL==t._connectionURL&&I.equals_(e._overlayRelativePosition,t._overlayRelativePosition)&&e._navigationType==t._navigationType&&fe.equals(e._transitionPreserveScroll,t._transitionPreserveScroll)&&fe.equals(e._transitionResetVideoPosition,t._transitionResetVideoPosition)&&fe.equals(e._openUrlInNewTab,t._openUrlInNewTab)&&I.equals_(e._extraScrollOffset,t._extraScrollOffset)&&e._mediaAction==t._mediaAction&&fe.equals(e._mediaSkipToTime,t._mediaSkipToTime)&&fe.equals(e._mediaSkipByAmount,t._mediaSkipByAmount)&&fe.equals(e._transitionResetScrollPosition,t._transitionResetScrollPosition)&&ie.List_equalsWithComparison(e._conditionalActions,t._conditionalActions,(n,r)=>cs.equals(n,r))&&fe.equals(e._transitionResetInteractiveComponents,t._transitionResetInteractiveComponents)}},qn=hr;qn.NULL_ACTION=new hr(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[],null,null,null);var Wc;(e=>{function g(t,n){return t==null!=(n==null)?!1:t==null?!0:ie.List_equalsWithComparison(t.keyCodes,n.keyCodes,(r,o)=>r==o)&&t.triggerDevice==n.triggerDevice}e.equals=g})(Wc||(Wc={}));var Hr=class{constructor(e,t,n,r,o,i,a,s){this._styleOverrideTable=null,this._numFontSizes=0,this._hyperlinkBoxes=null,this._characters=null,this._lines=null,this._characterStyleIds=null,this._usedEmojiCodepoints=null,this._usedEmojiImages=null,this._styleOverrideTable=e,this._numFontSizes=t,this._hyperlinkBoxes=n,this._characters=r,this._lines=o,this._characterStyleIds=i,this._usedEmojiCodepoints=a,this._usedEmojiImages=s}characters(){return this._characters}characterStyleIds(){return this._characterStyleIds}lines(){return this._lines}styleOverrideTable(){return this._styleOverrideTable}hasMixedFontSizes(){return this._numFontSizes==1}hyperlinkBoxes(){return this._hyperlinkBoxes}usedEmojiCodepoints(){return this._usedEmojiCodepoints}usedEmojiImages(){return this._usedEmojiImages}static forTests1(){return new Hr(new Yn,0,[],"",[],[],[],[])}static forTests2(e){return new Hr(e,0,[],"",[],[],[],[])}static forTests3(e){return new Hr(new Yn,0,[],"",[],[],e,[])}},ds=class{constructor(e){this.paintOverrides=null,this.styleOverrideTable=null,this.paintOverrides=new ao(e),this.styleOverrideTable=e}};var ee=class{constructor(e,t,n,r,o,i){this._m00=0,this._m01=0,this._m02=0,this._m10=0,this._m11=0,this._m12=0,this._m00=e,this._m01=t,this._m02=n,this._m10=r,this._m11=o,this._m12=i}m00(){return this._m00}m01(){return this._m01}m02(){return this._m02}m10(){return this._m10}m11(){return this._m11}m12(){return this._m12}setM00(e){this._m00=e}setM01(e){this._m01=e}setM02(e){this._m02=e}setM10(e){this._m10=e}setM11(e){this._m11=e}setM12(e){this._m12=e}axisX(){return new I(this.m00(),this.m10())}axisY(){return new I(this.m01(),this.m11())}clone(){return new ee(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12())}toAngle(){return Math.atan2(-this.m01(),this.m00())}scale1(){return new I(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))}hasPerpendicularAxes(e){return Math.abs(this.m00()*this.m10()+this.m01()*this.m11())<e}isAxisAligned(e){return Math.abs(this.m00())<e&&Math.abs(this.m11())<e||Math.abs(this.m01())<e&&Math.abs(this.m10())<e}isAxisAlignedScaleInvariant(e){let t=Math.sqrt(this._m00*this._m00+this._m10*this._m10)*e,n=Math.sqrt(this._m01*this._m01+this._m11*this._m11)*e;return Math.abs(this.m00())<t&&Math.abs(this.m11())<n||Math.abs(this.m01())<t&&Math.abs(this.m10())<n}valueEquals(e,t){return e==t||isNaN(e)&&isNaN(t)}equals1(e){return this.valueEquals(this._m00,e.m00())&&this.valueEquals(this._m01,e.m01())&&this.valueEquals(this._m02,e.m02())&&this.valueEquals(this._m10,e.m10())&&this.valueEquals(this._m11,e.m11())&&this.valueEquals(this._m12,e.m12())}equals2(e,t){return Math.abs(this._m00-e.m00())<t&&Math.abs(this._m01-e.m01())<t&&Math.abs(this._m02-e.m02())<t&&Math.abs(this._m10-e.m10())<t&&Math.abs(this._m11-e.m11())<t&&Math.abs(this._m12-e.m12())<t}translation(){return new I(this._m02,this._m12)}translate1(e){this.translate2(e.x(),e.y())}translate2(e,t){this._m02+=e*this.m00()+t*this.m01(),this._m12+=e*this.m10()+t*this.m11()}translatedBy1(e){return this.translate1(e),this}translatedBy2(e,t){return this.translate2(e,t),this}rotatedBy(e){return this.rotate(e),this}rotate(e){let t=Math.sin(e),n=Math.cos(e),r=n*this.m00()+t*this.m01(),o=n*this.m01()-t*this.m00(),i=n*this.m10()+t*this.m11(),a=n*this.m11()-t*this.m10();this._m00=r,this._m01=o,this._m10=i,this._m11=a}scale2(e){this.scale4(e,e)}scale3(e){this.scale4(e.x(),e.y())}scale4(e,t){this._m00*=e,this._m01*=t,this._m10*=e,this._m11*=t}skewX(e){let t=Math.tan(e);this._m01+=this._m00*t,this._m11+=this._m10*t}skewY(e){let t=Math.tan(e);this._m00+=this._m01*t,this._m10+=this._m10*t}scaledBy1(e){return this.scale3(e),this}scaledBy2(e){return this.scale2(e),this}scaledBy3(e,t){return this.scale4(e,t),this}multiply(e){let t=this.m00()*e.m00()+this.m01()*e.m10(),n=this.m00()*e.m01()+this.m01()*e.m11(),r=this.m00()*e.m02()+this.m01()*e.m12()+this.m02(),o=this.m10()*e.m00()+this.m11()*e.m10(),i=this.m10()*e.m01()+this.m11()*e.m11(),a=this.m10()*e.m02()+this.m11()*e.m12()+this.m12();this._m00=t,this._m01=n,this._m02=r,this._m10=o,this._m11=i,this._m12=a}rightMultiply(e){this.multiply(e)}leftMultiply(e){let t=this.m00()*e.m00()+this.m10()*e.m01(),n=this.m01()*e.m00()+this.m11()*e.m01(),r=this.m02()*e.m00()+this.m12()*e.m01()+e.m02(),o=this.m00()*e.m10()+this.m10()*e.m11(),i=this.m01()*e.m10()+this.m11()*e.m11(),a=this.m02()*e.m10()+this.m12()*e.m11()+e.m12();this._m00=t,this._m01=n,this._m02=r,this._m10=o,this._m11=i,this._m12=a}multipliedBy1(e){return this.multiply(e),this}multipliedBy2(e){return this.multipliedBy1(Nt.FrozenAffineTransform_new6(e))}invert(){let e=1/(this.m00()*this.m11()-this.m01()*this.m10());if(!isFinite(e))return!1;let t=this.m11()*e,n=-this.m01()*e,r=(this.m01()*this.m12()-this.m11()*this.m02())*e,o=-this.m10()*e,i=this.m00()*e,a=(this.m10()*this.m02()-this.m00()*this.m12())*e;return this._m00=t,this._m01=n,this._m02=r,this._m10=o,this._m11=i,this._m12=a,!0}inverse(){let e=this.clone(),t=e.invert();return e}transformPoint(e){let t=this.m00()*e.x()+this.m01()*e.y()+this.m02(),n=this.m10()*e.x()+this.m11()*e.y()+this.m12();return e.setX(t),e.setY(n),e}transformPoints(e){for(let t=0,n=e.length;t<n;t=t+1){let r=e[t],o=this.m00()*r.x()+this.m01()*r.y()+this.m02(),i=this.m10()*r.x()+this.m11()*r.y()+this.m12();r.setX(o),r.setY(i)}return e}transformDirection(e){let t=this.m00()*e.x()+this.m01()*e.y(),n=this.m10()*e.x()+this.m11()*e.y();return e.setX(t),e.setY(n),e}transformRect(e){if(e.isInvalid())return e.copyFrom(B.INVALID);if(!e.isFinite())return e.copyFrom(B.INFINITE);let t=new bt;return t.include2(this.transformPoint(e.topLeft())),t.include2(this.transformPoint(e.topRight())),t.include2(this.transformPoint(e.bottomLeft())),t.include2(this.transformPoint(e.bottomRight())),t.buildTo(e),e}setTo(e,t,n,r,o,i){return this._m00=e,this._m01=t,this._m02=n,this._m10=r,this._m11=o,this._m12=i,this}copyFrom(e){return this._m00=e.m00(),this._m01=e.m01(),this._m02=e.m02(),this._m10=e.m10(),this._m11=e.m11(),this._m12=e.m12(),this}postTranslate(e){let t=ee.new2();t.translate1(e),this.leftMultiply(t)}postRotate(e){let t=ee.new2();t.rotate(e),this.leftMultiply(t)}postScale(e){let t=ee.new2();t.scale3(e),this.leftMultiply(t)}toString(){return`AffineTransform(${this.m00()}, ${this.m01()}, ${this.m02()}, ${this.m10()}, ${this.m11()}, ${this.m12()})`}static new2(){return new ee(1,0,0,0,1,0)}static new3(e){return new ee(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12())}static new4(e){return new ee(e.scale(),0,e.offset().x(),0,e.scale(),e.offset().y())}static translated(e,t){let n=ee.new2();return n.translate2(e,t),n}},Nt;(a=>{function g(){return ee.new2()}a.FrozenAffineTransform_new1=g;function e(s){return s}a.FrozenAffineTransform_new2=e;function t(s){return ee.new3(s)}a.FrozenAffineTransform_new3=t;function n(s,c,l,u,d,h){return new ee(s,c,l,u,d,h)}a.FrozenAffineTransform_new4=n;function r(s){return ee.new4(s)}a.FrozenAffineTransform_new5=r;function o(s){return ee.new4(s)}a.FrozenAffineTransform_new6=o,a.FrozenAffineTransform_IDENTITY=g()})(Nt||(Nt={}));var sn;(d=>{function g(h,S){return Bn.string_compare(h,S)}d.compare=g;function e(h,S){return h==S}d.equals=e;function t(h){return h}d.toString=t;function n(h){return h.length>0}d.isValid=n;function r(h){let S=h,f=S.length-1,y=f;for(;y>=0;){let v=S.charCodeAt(y);if(v>d.LOWER+1)return S.slice(0,y)+String.fromCharCode(v-1);y=y-1}return S.slice(0,f)+String.fromCharCode(d.LOWER)+String.fromCharCode(d.UPPER)}d.before=r;function o(h){let S=h,f=S.length-1;for(;f>=0;){let y=S.charCodeAt(f);if(y<d.UPPER)return S.slice(0,f)+String.fromCharCode(y+1);f=f-1}return S+String.fromCharCode(d.LOWER+1)}d.after=o;function i(h){if(h==null||h==""||h.charCodeAt(h.length-1)==d.LOWER)return null;for(let S=0,f=h.length;S<f;S=S+1)if(h.charCodeAt(S)<d.LOWER||h.charCodeAt(S)>d.UPPER)return null;return h}d.fromString=i;function a(h,S){let f=h,y=S,v=f.length,b=y.length,m="",p=!1;for(let _=0,T=Math.max(v,b);_<T;_=_+1){let N=_<v?f.charCodeAt(_):d.LOWER,k=_<b&&!p?y.charCodeAt(_):d.UPPER;if(N==k)m+=String.fromCharCode(N);else if(k-N>1){m+=String.fromCharCode(N+k>>1),p=!1;break}else m+=String.fromCharCode(N),p=!0}return p&&(m+=String.fromCharCode(d.LOWER+d.UPPER>>1)),m}d.between=a,d.LOWER=32,d.UPPER=126,d.FIRST_POSITION=String.fromCharCode(d.LOWER+1),d.SECOND_POSITION=String.fromCharCode(d.LOWER+2)})(sn||(sn={}));var kn=class{toString(){return`${R.toString(this.id)};${sn.toString(this.position)}`}equals(e){return R.equals(this.id,e.id)&&sn.equals(this.position,e.position)}static fromString(e){let t=e.indexOf(";");if(t==-1)return null;let n=e.slice(0,t);if(n=="-1:-1")return null;let r=R.fromString(n);return new kn(r,sn.fromString(e.slice(t+1)))}constructor(e,t){this.id=e,this.position=t}};var Z;(as=>{function g(W){try{if(t(W))return W.toString();if(n(W))return H(W).toString();if(r(W))return M(W).toString();if(s(W))return Bn.string_toString(W);if(o(W))return W.toString();if(a(W))return P(W).toString();if(c(W))return W.toString();if(h(W)){let un=W;return`${un.family} ${un.style}`}if(S(W)){let un=W;return`${un.value} ${un.units}`}if(f(W))return W.toString();if(_(W))return W.toString();if(y(W))return W.toString();if(l(W))return W.length===0?"[]":W[0]instanceof jt?`[${W.map(Fg=>Fg.debugString()).join(",")}]`:"[...]"}catch{}return"?"}as.toString=g;function e(W,un){return t(W)&&t(un)?W.equals1(un):c(W)&&c(un)?W.equals(un):(n(W)||r(W)||s(W)||a(W),W==un)}as.equals=e;function t(W){return W instanceof ee}as.isAffineTransform=t;function n(W){return typeof W=="boolean"}as.isBool=n;function r(W){return typeof W=="number"}as.isDouble=r;function o(W){return W instanceof wt}as.isGUIDPath=o;function i(W){return W.guid!==void 0&&W.ref!==void 0}as.isStyleId=i;function a(W){return xa(W)}as.isInt=a;function s(W){return typeof W=="string"}as.isString=s;function c(W){return W instanceof I}as.isVector=c;function l(W){return W instanceof Array}as.isList=l;function u(W){return W instanceof Hr}as.isTextData=u;function d(W){return W instanceof ds}as.isVectorData=d;function h(W){return W instanceof hs}as.isFontName=h;function S(W){return W instanceof ps}as.isNumber=S;function f(W){return W instanceof kn}as.isParentIndex=f;function y(W){return W instanceof Dn}as.isGeometry=y;function v(W){return typeof W=="string"}as.isGUID=v;function b(W){return typeof W=="string"}as.isScrollDirection=b;function m(W){return W instanceof Xn}as.isPrototypeDevice=m;function p(W){return W instanceof so}as.isPrototypeStartingPoint=p;function _(W){return W instanceof ti}as.isSymbolData=_;function T(W){return typeof W=="string"}as.isPosition=T;function N(W){return typeof W=="string"}as.isScrollBehavior=N;function k(W){return typeof W=="string"}as.isNavigationType=k;function j(W){return typeof W=="string"}as.isOverlayPositionType=j;function te(W){return typeof W=="string"}as.isOverlayBackgroundInteraction=te;function Y(W){return W instanceof vo}as.isOverlayBackgroundAppearance=Y;function _e(W){return typeof W=="string"}as.isShapeWithTextType=_e;function ce(W){return W.autoplay!==void 0&&W.mediaLoop!==void 0&&W.muted!==void 0}as.isVideoPlayback=ce;function V(W){return W}as.asAffineTransform=V;function H(W){return!!W}as.asBool=H;function M(W){return+W}as.asDouble=M;function K(W){return W}as.asGUIDPath=K;function U(W){return W}as.asStyleId=U;function P(W){return W|0}as.asInt=P;function J(W){return W}as.asString=J;function z(W,un){return s(W)?W:un}as.asStringEnum=z;function O(W){return W}as.asVector=O;function G(W){return W}as.asPaintList=G;function L(W){return W}as.asPaintData=L;function $(W){return W}as.asEffectList=$;function se(W){return W}as.asExportSettingsList=se;function nt(W){return W}as.asTextData=nt;function ot(W){return W}as.asVectorData=ot;function It(W){return W}as.asFontName=It;function Qe(W){return W}as.asNumber=Qe;function Gt(W){return W}as.asParentIndex=Gt;function tn(W){return W}as.asGeometry=tn;function bn(W){return W}as.asGUID=bn;function tr(W){return W}as.asSymbolData=tr;function Fn(W){return W}as.asScrollDirection=Fn;function ur(W){return W}as.asPrototypeStartingPoint=ur;function Wt(W){return W}as.asPrototypeDevice=Wt;function ut(W){return W}as.asPosition=ut;function Tt(W){return W}as.asScrollBehavior=Tt;function Le(W){return W}as.asNavigationType=Le;function Pt(W){return W}as.asOverlayPositionType=Pt;function Kt(W){return W}as.asOverlayBackgroundInteraction=Kt;function Ce(W){return W}as.asOverlayBackgroundAppearance=Ce;function cn(W){return W}as.asArcData=cn;function Ie(W){return W}as.asShapeWithTextType=Ie;function gt(W){return W}as.asPrototypeInteractionList=gt;function Lt(W){return W}as.asVideoPlayback=Lt;function Ve(W){return W}as.new1=Ve;function qe(W){return W!=null?W.clone():null}as.new2=qe;function on(W){return W}as.new3=on;function Xt(W){return W}as.new4=Xt;function Jr(W){return W}as.new5=Jr;function ft(W){return W}as.new6=ft;function A(W){return W}as.new7=A;function D(W){return W}as.new8=D;function re(W){return W}as.new9=re;function le(W){return W!=null?W.clone():null}as.new10=le;function ue(W){return W}as.new11=ue;function Fe(W){return W!=null?W.slice():null}as.new12=Fe;function Ge(W){return W!=null?W.map(un=>un.clone()):null}as.new13=Ge;function Xe(W){return W!=null?W.map(un=>un.clone()):null}as.new14=Xe;function Bt(W){return W!=null?W.map(un=>un.clone()):null}as.new15=Bt;function at(W){return W!=null?W.map(un=>un.clone()):null}as.new16=at;function Ye(W){return W}as.new17=Ye;function w(W){return W!=null?W.slice():null}as.new18=w;function F(W){return W!=null?W.map(un=>un.clone()):null}as.new19=F;function X(W){return W}as.new20=X;function oe(W){return W}as.new21=oe;function ae(W){return W}as.new22=ae;function he(W){return W}as.new23=he;function me(W){return W}as.new24=me;function Oe(W){return W}as.new25=Oe;function pe(W){return W}as.new26=pe;function ge(W){return W}as.new27=ge;function je(W){return W}as.new28=je;function De(W){return W}as.new29=De;function Be(W){return W}as.new30=Be;function st(W){return W}as.new31=st;function ke(W){return W}as.new32=ke;function q(W){return W}as.new33=q;function ht(W){return W}as.new34=ht;function He(W){return W}as.new35=He;function Vt(W){return W}as.new36=Vt;function Vn(W){return W}as.new37=Vn;function On(W){return W}as.new38=On;function Zr(W){return W}as.new39=Zr;function hi(W){return W}as.new40=hi;function yo(W){return W}as.new41=yo;function Lo(W){return W}as.new42=Lo;function xi(W){return W}as.new43=xi;function Di(W){return W}as.new44=Di;function Fa(W){return W}as.new45=Fa;function R_(W){return W}as.new46=R_;function w_(W){return W}as.new47=w_;function P_(W){return W}as.new48=P_,as.ZERO_VECTOR=ye.FrozenVector_new1(),as.IDENTITY_TRANSFORM=Nt.FrozenAffineTransform_new1(),as.EMPTY_PAINT_LIST=[],as.EMPTY_EFFECT_LIST=[],as.DEFAULT_ARC_DATA={startingAngle:0,endingAngle:2*Pe.Math_PI(),innerRadius:0}})(Z||(Z={}));var _n;(u=>{function g(d,h){let S=s();for(let f=0,y=d.length;f<y;f=f+1)n(S,d[f],h[f]);return S}u.new1=g;function e(d,h){return d.has(Rt[h])}u._in=e;function t(d,h){return Me.StringMap_get(d,Rt[h],null)}u.get1=t;function n(d,h,S){let f=Rt[h];u._remapKey.set(f,h),d.set(f,S)}u.set=n;function r(d,h,S){return Me.StringMap_get(d,Rt[h],S)}u.get=r;function o(d,h){d.delete(Rt[h])}u.remove=o;function i(d,h){Me.StringMap_each(d,(S,f)=>{h(u._remapKey.get(S),f)})}u.each=i;function a(d){let h=[];return Me.StringMap_each(d,(S,f)=>{h.push(`${S}=${Z.toString(f)}`)}),`{${h.join(", ")}}`}u.toString=a;function s(){return new Map}u._new=s,u._remapKey=new Map,u.EMPTY=s()})(_n||(_n={}));var Io;(o=>{function g(i,a){return _n._in(i,a)}o._in=g;function e(i,a){return _n.get1(i,a)}o.get1=e;function t(i,a,s){return _n.get(i,a,s)}o.get=t;function n(i,a){_n.each(i,a)}o.each=n;function r(i){return _n.toString(i)}o.toString=r})(Io||(Io={}));var Rn;(u=>{function g(d,h){u.current.set(d,Z.new8(h))}u.track1=g;function e(d,h){if(u.current.set(d,Z.new7(h)),!u.maximum.has(d))u.maximum.set(d,u.current.get(d));else{let S=u.maximum.get(d);u.maximum.set(d,Math.max(S,u.current.get(d)))}}u.track2=e;function t(d,h){if(u.current.set(d,Z.new4(h)),!u.maximum.has(d))u.maximum.set(d,u.current.get(d));else{let S=u.maximum.get(d);u.maximum.set(d,Math.max(S,u.current.get(d)))}}u.track3=t;function n(d,h){if(u.current.has(d)?u.current.set(d,Z.new4(Z.asDouble(u.current.get(d))+h)):u.current.set(d,Z.new4(h)),!u.maximum.has(d))u.maximum.set(d,u.current.get(d));else{let S=u.maximum.get(d);u.maximum.set(d,Math.max(S,u.current.get(d)))}}u.increment=n;function r(d,h){let S=Z.new7(h);if(u.current.set(d,S),!u.maximum.has(d))u.maximum.set(d,u.current.get(d));else{let f=u.maximum.get(d);u.maximum.set(d,Math.max(f,S))}}u.trackInReleaseBuilds=r;function o(d,h){if(u.current.has(d)?u.current.set(d,Z.new4(Z.asDouble(u.current.get(d))+h)):u.current.set(d,Z.new4(h)),!u.maximum.has(d))u.maximum.set(d,u.current.get(d));else{let S=u.maximum.get(d);u.maximum.set(d,Math.max(S,u.current.get(d)))}return Z.asDouble(u.current.get(d))|0}u.incrementInReleaseBuilds=o;function i(d){return u.current.has(d)?u.current.get(d):Z.new7(0)}u.getStat=i;function a(d){return u.maximum.has(d)?u.maximum.get(d):Z.new7(0)}u.getMax=a;function s(){let d=window.performance.memory;d&&d.jsHeapSizeLimit&&d.usedJSHeapSize&&(e("JS Heap size (MB)",d.jsHeapSizeLimit/(1024*1024)|0),e("Used Heap size (MB)",d.usedJSHeapSize/(1024*1024)|0));let h={};for(let S of Array.from(u.current.keys())){let f=u.current.get(S);Z.isDouble(f)?h[S]=Math.round(Z.asDouble(f)*100)/100:h[S]=Z.toString(u.current.get(S))}return h}u.getStatsForDebugging=s,u.current=new Map,u.maximum=new Map})(Rn||(Rn={}));var nr;(r=>{function g(o){return o!="NONE"}r.hasOverflow=g;function e(o){return o=="HORIZONTAL"||o=="BOTH"}r.scrollsHorizontally=e;function t(o){return o=="VERTICAL"||o=="BOTH"}r.scrollsVertically=t;function n(o,i){switch(o){case"VERTICAL":return Math.abs(i.y());case"HORIZONTAL":return Math.abs(i.x());case"BOTH":return Math.abs(i.length());default:break}return 0}r.getDirectionSimilarity=n})(nr||(nr={}));var Kc;(e=>{function g(t){let n=t,r=t.parent(),o=new I(0,0);for(;r!=null&&r.type()!="CANVAS";){let i=r.scrollDirection()!="NONE"&&r.has(85),a=n.isFixed();i&&!a&&o.addUpdate1(r.scrollOffset()),n=r,r=r.parent()}return o}e.cumulativeScrollOffsetOfAncestors=g})(Kc||(Kc={}));function Ku(g){switch(g){case"VERTICAL":return new I(0,1);case"HORIZONTAL":return new I(1,0);case"BOTH":{let e=new I(1,1);return e.divide(e.length())}default:break}return I.new2()}var ni;(a=>{function g(s,c,l,u,d){let h=s.stickyNodeInitialTopPosition,S=s.overflowingAncestorInitialTopPosition,f=h-S;if(u)return l.y()>f?ye.FrozenVector_new4(l.x(),f):l;{if(d)return ye.FrozenVector_new4(0,0);let y=c(),v=s.stickyNodeHeight,b=s.parentNodeHeight,m=s.parentNodeInitialTopPosition,_=h-m+v,T=b-_,N=y.y()>f&&y.y()<=f+T,k=y.y()>f+T;return N?ye.FrozenVector_new4(0,f-y.y()):k?ye.FrozenVector_new4(0,-T):ye.FrozenVector_new4(0,0)}}a.getRelativeScrollTranslationOfStickyScrollingNodeFromBounds=g;function e(s){let c=s.parent();if(c==null)return ye.FrozenVector_new4(0,0);let l=c.isFixed()&&c.parent()!=null&&c.parent().has(85);if(s.isStandardScrolling()&&c.has(85))return c.scrollOffset();if(s.isStickyScrolling()){let u=s.parent(),d=!0;for(;u!=null&&!u.has(85);)d=!1,u=u.parent();if(u==null)return ye.FrozenVector_new4(0,0);let h=s.absoluteTransform().m12(),S=s.size().y(),f=c.absoluteTransform().m12(),y=c.size().y(),v=u.absoluteTransform().m12(),b=new i(h,S,f,y,v);return g(b,()=>n(c),c.scrollOffset(),d,l)}return ye.FrozenVector_new4(0,0)}a.getScrollTranslationOfNodeRelativeToParent1=e;function t(s){let c=s.parent();if(c==null)return ye.FrozenVector_new4(0,0);let l=d=>d.scrollDirection()!="NONE"&&d.hasOverflowingContentInScrollDirection(),u=c.isFixed()&&c.parent()!=null&&l(c.parent());if(s.isStandardScrolling()&&l(c))return c.scrollOffset();if(s.isStickyScrolling()){let d=s.parent(),h=!0;for(;d!=null&&!l(d);)h=!1,d=d.parent();if(d==null)return ye.FrozenVector_new4(0,0);let S=s.absoluteTransform().m12(),f=s.size().y(),y=c.absoluteTransform().m12(),v=c.size().y(),b=d.absoluteTransform().m12(),m=new i(S,f,y,v,b);return g(m,()=>r(c),c.scrollOffset(),h,u)}return ye.FrozenVector_new4(0,0)}a.getScrollTranslationOfNodeRelativeToParent2=t;function n(s){let c=ye.FrozenVector_new4(0,0),l=s;for(;l!=null&&(!l.has(85)||l==s);){let u=e(l);c=c.add1(u),l=l.parent()}return c}a.getScrollTranslationOfNodeRelativeToOverflowingAncestor1=n;function r(s){let c=d=>d.scrollDirection()!="NONE"&&d.hasOverflowingContentInScrollDirection(),l=ye.FrozenVector_new4(0,0),u=s;for(;u!=null&&(!c(u)||u==s);){let d=t(u);l=l.add1(d),u=u.parent()}return l}a.getScrollTranslationOfNodeRelativeToOverflowingAncestor2=r;function o(s){let c=new I(0,0),l=s.parent();if(s.isStandardScrolling()&&l.has(85))c.addUpdate1(l.scrollOffset());else if(s.isStickyScrolling()&&l.has(85)){let u=s.absoluteTransform().m12()-l.absoluteTransform().m12(),d=Math.min(u,l.scrollOffset().y()),h=new I(l.scrollOffset().x(),d);c.addUpdate1(h)}return c}a.getScrollOffsetOfNodeFromParent_DEPRECATED=o;class i{constructor(c,l,u,d,h){this.stickyNodeInitialTopPosition=c,this.stickyNodeHeight=l,this.parentNodeInitialTopPosition=u,this.parentNodeHeight=d,this.overflowingAncestorInitialTopPosition=h}}a.StickyScrollBounds=i})(ni||(ni={}));var ri=(t=>(t[t.APPLY_SCROLLING_AND_CLIPPING=0]="APPLY_SCROLLING_AND_CLIPPING",t[t.APPLY_SCROLLING=1]="APPLY_SCROLLING",t))(ri||{}),ms=(n=>(n[n.BASE_SCREEN=0]="BASE_SCREEN",n[n.OVERLAY_OR_SUBLAYER=1]="OVERLAY_OR_SUBLAYER",n[n.DETERMINE_USING_NODE_FIELDS=2]="DETERMINE_USING_NODE_FIELDS",n))(ms||{}),qc=class{constructor(e){this._node=null,this._overrideRole=null,this._node=e}overrideRole(e){this._overrideRole=new fe(e)}clearRoleOverride(){this._overrideRole=null}_role(){return this._overrideRole!=null?this._overrideRole.value:2}canvasSpaceContentBounds(){return this.scrollDirection()=="NONE"?this._node.canvasSpaceRenderedBounds():this._scrollableContentBounds()}defaultScrollOffset(){return this._node.canvasSpaceBoundingBox().topLeft().subtract1(this.canvasSpaceContentBounds().topLeft())}minScrollOffsetX(){return-this.defaultScrollOffset().x()}minScrollOffsetY(){return-this.defaultScrollOffset().y()}maxScrollOffsetX(){return Math.max(this.minScrollOffsetX(),this.canvasSpaceContentBounds().right()-this._node.canvasSpaceBoundingBox().right())}maxScrollOffsetY(){return Math.max(this.minScrollOffsetY(),this.canvasSpaceContentBounds().bottom()-this._node.canvasSpaceBoundingBox().bottom())}hasOverflowingContentInXDirection(){return nr.scrollsHorizontally(this.scrollDirection())&&this.canvasSpaceContentBounds().width()>this._node.canvasSpaceBoundingBox().width()}hasOverflowingContentInYDirection(){return nr.scrollsVertically(this.scrollDirection())&&this.canvasSpaceContentBounds().height()>this._node.canvasSpaceBoundingBox().height()}shouldResizeToFitViewport(){return(this._role()==2?this._node.isTopLevel():this._role()==0)&&!this._node.isTooRotatedToScroll()}nodeSize(){if(this.shouldResizeToFitViewport()){let e=this._node.findContainingCanvasOrParent(),t=e.prototypeDevice(),n=e.currentViewportSize(),r=t.type=="NONE"||t.type=="PRESENTATION"?n:t.size();return new I(Math.min(this._node.fullSize().x(),r.x()),Math.min(this._node.fullSize().y(),r.y()))}else return this._node.fullSize()}nodeSpaceScrollableContentBounds(){let e=this._node.fullSize(),t=B.new2();if((this._role()==2?this._node.isTopLevel():this._role()==0)?!nr.hasOverflow(this._node.overflowDirection()):!this._node.isFrameMaskDisabled()&&this.scrollDirection()=="NONE")t.setTo1(0,0,e.x(),e.y());else{let o=this._node.canvasSpaceBoundingBox().topLeft();t.setTo1(o.x(),o.y(),e.x(),e.y());for(let i=0,a=this._node.childCount();i<a;i=i+1){let s=this._node.childAt1(i);s.isFixed()||(Rr?t.expandToInclude(s.canvasSpaceBoundingBox()):t.expandToInclude(s.canvasSpaceScrollingBounds()))}t.setX(t.x()-o.x()),t.setY(t.y()-o.y()),this._node.overflowDirection()=="VERTICAL"?(t.setX(0),t.setWidth(e.x())):this._node.overflowDirection()=="HORIZONTAL"?(t.setY(0),t.setHeight(e.y())):this._node.overflowDirection()=="BOTH"}return t}_scrollableContentBounds(){let e=this.nodeSpaceScrollableContentBounds();return e.transformInto1(e,this._node.absoluteTransform()),e}scrollDirection(){let e=this._role()==2?Z.asBool(this._node.get1(86,Z.new3(!1))):this._role()==0;return this._node.constrainsAnchoredChildren()?this._node.isTopLevel()&&e?"BOTH":this._node.overflowDirection():"NONE"}scrollDirectionWithScrollableContent(){let e=this.scrollDirection(),t=this.canvasSpaceContentBounds(),n=this._node.canvasSpaceBoundingBox(),r=nr.scrollsVertically(e)&&t.height()>n.height(),o=nr.scrollsHorizontally(e)&&t.width()>n.width();return r&&o?"BOTH":r?"VERTICAL":o?"HORIZONTAL":"NONE"}hasScrollableParent(){let e=this._node.parent();return!(e==null||e.overflowDirection()=="NONE"&&!(e.isTopLevel()&&e.type()=="FRAME"))}isFixed(){return this.hasScrollableParent()?this._node.scrollBehavior()=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME":!1}isStickyScrolling(){return!Q.getFeatureFlags().prototypeTemporaryStickyScroll&&!this.hasScrollableParent()?!1:this._node.scrollBehavior()=="STICKY_SCROLLS"}isStandardScrolling(){return!this.isFixed()&&!this.isStickyScrolling()}scrollAndClipBoundsBySelfAndAncestors(e,t){let n=e.clone(),r=this._node;for(;r.parent()!=null;){let o=Q.getFeatureFlags().prototypeTemporaryStickyScroll?ni.getScrollTranslationOfNodeRelativeToParent1(r):ni.getScrollOffsetOfNodeFromParent_DEPRECATED(r);n.translate2(o.negative());let i=r.parent();i.clipsToBoundingRectangle()&&t==0&&n.intersectWith(i.canvasSpaceBoundingBox()),r=i}return n}canvasSpaceScrolledBounds(e){return this.scrollAndClipBoundsBySelfAndAncestors(this._node.canvasSpaceBoundingBox(),e)}canvasSpaceScrolledInteractiveBounds(e){let t=Q.getFeatureFlags().mergeInteractiveBounds?this._node.canvasSpacePreviewBounds():this._node.canvasSpaceInteractiveBounds();return this.scrollAndClipBoundsBySelfAndAncestors(t,e)}scrollsInPreferredDirection(e){switch(e){case"HORIZONTAL":return nr.scrollsHorizontally(this.scrollDirection());case"VERTICAL":return nr.scrollsVertically(this.scrollDirection());case"BOTH":return this.scrollDirection()!="NONE"}return!1}hasOverflowingContentInScrollDirection(){let e=this.canvasSpaceContentBounds(),t=this._node.canvasSpaceBoundingBox();return nr.scrollsHorizontally(this.scrollDirection())&&e.width()>t.width()||nr.scrollsVertically(this.scrollDirection())&&e.height()>t.height()}},qu;(e=>{function g(t){return ri[t]}e.BoundsTransformationStrategy_toString=g})(qu||(qu={}));var Yu;(e=>{function g(t){return ms[t]}e.FrameRole_toString=g})(Yu||(Yu={}));var Ao=class{constructor(e){this._hashKey=null,this._keyByHash=new Map,this._valueByKeyHash=new Map,this._hashKey=e}count(){return this._keyByHash.size}_in(e){let t=this._hashKey(e);return this._keyByHash.has(t)}set(e,t){let n=this._hashKey(e);this._keyByHash.set(n,e),this._valueByKeyHash.set(n,t)}get1(e){let t=this._hashKey(e);return this._valueByKeyHash.get(t)}get(e,t){let n=this._hashKey(e);return Me.StringMap_get(this._valueByKeyHash,n,t)}remove(e){let t=this._hashKey(e);this._keyByHash.delete(t),this._valueByKeyHash.delete(t)}clear(){this._keyByHash=new Map,this._valueByKeyHash=new Map}keys(){return Array.from(this._keyByHash.values())}values(){return Array.from(this._valueByKeyHash.values())}each(e){this.keys().forEach(t=>{e(t,this.get1(t))})}isEmpty(){return this.count()==0}},Vi=class{constructor(e){this._hash=null,this._hash=new Ao(e)}add(e){this._hash.set(e,!0)}addList(e){for(let t of e)this.add(t)}_in(e){return this._hash._in(e)}remove(e){this._hash.remove(e)}count(){return this._hash.count()}asList(){return this._hash.keys()}each(e){this._hash.keys().forEach(e)}map(e){return this._hash.keys().map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of this._hash.keys())if(!e._in(t))return!1;return!0}};var Ju=class{constructor(){this.numTransitions=0,this.numTransitionsWithAnimation=0,this.numNodesWithSmartAnimateTransitionType=0,this.numNodesWithSmartAnimateExtension=0,this.numSlidesPushesOrMovesWithPreserveScrollPosition=0,this.numDragTriggers=0}};var hl=class{constructor(e){this._noodleMap=new Bi,this._cachedCleanedUpTransitionMapByTlf=null,this._scene=null,this._appState=null,this.triggerPotentialTimedTransition=null,this.createVideoTriggerEventsForNodesInFrame=null,this.createVideoTriggerEventsForAllNodesOnscreen=null,this._topmostScreenChangeCounter=0,this._appState=e,this._appState.addAppObserver(this)}_setPrototypeInteractionsInNoodleMap(e,t){t.some(r=>r.isValid())?this._noodleMap.update(e,t):this._noodleMap.update(e,[])}_setHyperlinkInteractionInNoodleMap(e){if(Ft.isNodeInteractableBecauseOfHyperlinks(e)){let t=Ft.createFakeHyperlinkInteraction();this._setPrototypeInteractionsInNoodleMap(e,[t].slice())}}cleanedUpInteractionMap(){return new Bi.CleanedMap(this._noodleMap,pl.CLEANED_INTERACTIONS,e=>{var r;let t,n=(r=this._scene)==null?void 0:r.findNode1(e);return Ft.cleanedInteractionsForNode(this._appState,n)})}cleanedUpTransitionMap(){return new Bi.CleanedMap(this._noodleMap,pl.CLEANED_TRANSITIONS,e=>{let t=[];return this.cleanedUpInteractionMap().getHotspotInteractions(e).forEach(n=>{n.interactionContainsTransitionAction()&&t.push(n)}),t})}cleanedUpTransitionMapByTLF(){if(this._cachedCleanedUpTransitionMapByTlf==null){let e=new Ao(t=>R.toString(t));for(let t of this.cleanedUpTransitionMap().hotspots()){let n=this._scene.findNode1(t);if(n!=null){let r=null,o=n.topLevelAncestor();o!=null&&o.visible()&&(r=o.id()),r!=null&&(e._in(r)||e.set(r,[]),ie.List_append2(e.get1(r),this.cleanedUpTransitionMap().getHotspotInteractions(t).slice()))}}this._cachedCleanedUpTransitionMapByTlf=e}return this._cachedCleanedUpTransitionMapByTlf}transitionStats__DEPRECATED(){let e=new Ju;for(let t of this.cleanedUpTransitionMap().hotspots())this.cleanedUpTransitionMap().getHotspotInteractions(t).forEach(n=>{e.numTransitions=e.numTransitions+1,n.event().interactionType()=="DRAG"&&(e.numDragTriggers=e.numDragTriggers+1);let r=n.action()!=null?n.action().value:null;if(r!=null){r.transitionDuration()>0&&(e.numTransitionsWithAnimation=e.numTransitionsWithAnimation+1),r.transitionType()=="SMART_ANIMATE"&&(e.numNodesWithSmartAnimateTransitionType=e.numNodesWithSmartAnimateTransitionType+1),xn.supportsSmartAnimate(r.transitionType())&&r.transitionShouldSmartAnimate()&&(e.numNodesWithSmartAnimateExtension=e.numNodesWithSmartAnimateExtension+1);let o=xn.isSlide(r.transitionType())||xn.isPush(r.transitionType())||xn.isMove(r.transitionType());r.transitionPreserveScroll()&&o&&(e.numSlidesPushesOrMovesWithPreserveScrollPosition=e.numSlidesPushesOrMovesWithPreserveScrollPosition+1)}});return e}rawInteractionMapForTests(){return new Bi.RawMapForTests(this._noodleMap)}rawNoodleMap(){return this._noodleMap}handleSceneChange(e,t){this._scene=t,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){this._noodleMap.noodleNodes.clear(),t!=null&&this._addConnectionsFromSubtree(t),this._cachedCleanedUpTransitionMapByTlf=null}handleActivePrototypeStartingPointChange(e,t){}_addConnectionsFromSubtree(e){this._setPrototypeInteractionsInNoodleMap(e,e.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e);for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);this._addConnectionsFromSubtree(r)}}_removeConnectionsFromSubtree(e){this._noodleMap.update(e,[]);for(let t=0,n=e.childCount();t<n;t=t+1)this._removeConnectionsFromSubtree(e.childAt1(t))}topmostScreenChangeCounter(){return this._topmostScreenChangeCounter}handleSceneGraphEvent(e){let t=!1;if((zr.isInteractionProperty(e.property)||zr.affects(e.property,81))&&(e.node.isRooted()&&(this._setPrototypeInteractionsInNoodleMap(e.node,e.node.prototypeInteractions()),this._setHyperlinkInteractionInNoodleMap(e.node),t=!0),R.equals(this._appState.baseScreenId(),e.node.id())&&e.node.prototypeInteractions().forEach(n=>{this._topmostScreenChangeCounter=this._topmostScreenChangeCounter+1,n.event().interactionType()=="AFTER_TIMEOUT"?this.triggerPotentialTimedTransition!=null&&this.triggerPotentialTimedTransition():(n.event().interactionType()=="ON_MEDIA_HIT"||n.event().interactionType()=="ON_MEDIA_END")&&this.createVideoTriggerEventsForAllNodesOnscreen!=null&&this.createVideoTriggerEventsForAllNodesOnscreen()})),e.property==7||e.property==8||e.property==13||e.property==80)t=!0,this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node),this._noodleMap.invalidateHotspotAndChildren(e.node);else if(e.property==24){let n=e.oldVal!=null&&Z.isParentIndex(e.oldVal)?Z.asParentIndex(e.oldVal):null,r=e.newVal!=null&&Z.isParentIndex(e.newVal)?Z.asParentIndex(e.newVal):null,o=n!=null?e.node.scene().findNode1(n.id):null,i=r!=null?e.node.scene().findNode1(r.id):null,a=o!=null&&o.isRooted(),s=i!=null&&i.isRooted();a&&!s?(this._removeConnectionsFromSubtree(e.node),t=!0):!a&&s&&(this._addConnectionsFromSubtree(e.node),t=!0,this.createVideoTriggerEventsForNodesInFrame!=null&&this.createVideoTriggerEventsForNodesInFrame(e.node)),a&&s&&o.id()!=i.id()&&(t=!0),this._noodleMap.invalidateBackRefsForDestinationAndChildren(e.node)}t&&(this._cachedCleanedUpTransitionMapByTlf=null)}},pl=(t=>(t[t.CLEANED_INTERACTIONS=0]="CLEANED_INTERACTIONS",t[t.CLEANED_TRANSITIONS=1]="CLEANED_TRANSITIONS",t))(pl||{}),Yc=class{invalidateCaches(){this.caches.set(0,null),this.caches.set(1,null)}constructor(){this.interactions=new Vi(e=>R.toString(e.id())),this.backReferences=new Ao(e=>R.toString(e)),this.caches=new Map([[0,null],[1,null]])}},Bi=class{update(e,t){var s,c,l;let n,r,o,i=(l=(c=(s=this.noodleNodes.get(e.id(),null))==null?void 0:s.interactions)==null?void 0:c.asList())!=null?l:[];for(let u=0,d=i.length;u<d;u=u+1){let h=i[u];this._eraseInteraction(e,h)}for(let u=0,d=t.length;u<d;u=u+1){let h=t[u];this._addInteraction(e,h)}let a=this.noodleNodes.get(e.id(),null);a!=null&&a.interactions.count()==0&&a.backReferences.count()==0&&this.noodleNodes.remove(e.id())}_addInteraction(e,t){var i;let n,r=e.id(),o=(i=this.noodleNodes.get(r,null))!=null?i:new Yc;this.noodleNodes.set(r,o),o.interactions.add(t);for(let a of t.allActions()){let s=a.transitionNodeID();if(ju(s,a.connectionType())){let c=this.noodleNodes.get(s,null);c==null&&(c=new Yc,this.noodleNodes.set(s,c)),c.backReferences.set(r,c.backReferences.get(r,0)+1)}}o.invalidateCaches()}_eraseInteraction(e,t){let n=e.id(),r=this.noodleNodes.get(n,null);r!=null&&r.interactions.remove(t);for(let o of t.allActions()){let i=o.transitionNodeID();if(ju(i,o.connectionType())){let a=this.noodleNodes.get(i,null);a!=null&&(a.backReferences.set(n,a.backReferences.get1(n)-1),a.backReferences.get1(n)<=0&&a.backReferences.remove(n))}}r.invalidateCaches()}invalidateHotspotAndChildren(e){Se.forEachNode1(e,t=>(this.noodleNodes._in(t.id())&&this.noodleNodes.get1(t.id()).invalidateCaches(),Se.Loop.CONTINUE))}invalidateBackRefsForDestinationAndChildren(e){Se.forEachNode1(e,t=>(this.noodleNodes._in(t.id())&&this.noodleNodes.get1(t.id()).backReferences.each((r,o)=>{this.noodleNodes.get1(r).invalidateCaches()}),Se.Loop.CONTINUE))}constructor(){this.noodleNodes=new Ao(e=>R.toString(e))}};(t=>{class g{_in(r){return this.noodleMap.noodleNodes._in(r)&&this.getHotspotInteractions(r).length!=0}hotspots(){return this.noodleMap.noodleNodes.keys().filter(r=>this.getHotspotInteractions(r).length!=0)}getHotspotInteractions(r){return this.noodleMap.noodleNodes.get1(r).interactions.asList()}constructor(r){this.noodleMap=r}}t.RawMapForTests=g;class e{_in(r){return this.noodleMap.noodleNodes._in(r)?this.getHotspotInteractions(r).length!=0:!1}hotspots(){return this.noodleMap.noodleNodes.keys().filter(r=>this.getHotspotInteractions(r).length!=0)}getHotspotInteractions(r){let o=this.noodleMap.noodleNodes.get1(r);return o.caches.get(this.cacheType)==null&&o.caches.set(this.cacheType,this.computeCacheForHotspot(r)),o.caches.get(this.cacheType)}constructor(r,o,i){this.noodleMap=r,this.cacheType=o,this.computeCacheForHotspot=i}}t.CleanedMap=e})(Bi||(Bi={}));var Xu;(e=>{function g(t){return pl[t]}e.NoodleCache_toString=g})(Xu||(Xu={}));function ju(g,e){return g!=null&&R.isValid(g)&&(e=="INTERNAL_NODE"||e=="UPDATE_MEDIA_RUNTIME")}var rr=class{add(e){this._hash.set(e,!0)}_in(e){return this._hash.has(e)}remove(e){this._hash.delete(e)}count(){return this._hash.size}asList(){return Array.from(this._hash.keys())}each(e){Array.from(this._hash.keys()).forEach(e)}map(e){return Array.from(this._hash.keys()).map(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of Array.from(this._hash.keys()))if(!e._in(t))return!1;return!0}static fromList(e){let t=new rr;for(let n of e)t.add(n);return t}constructor(){this._hash=new Map}};var fs=(t=>(t[t.ALL=0]="ALL",t[t.NESTED_ONLY=1]="NESTED_ONLY",t))(fs||{}),Eo=class{constructor(){if(arguments.length==1){let e=arguments[0];this.node=null,this.hyperlink=null,this.node=e}else if(arguments.length==2){let e=arguments[0],t=arguments[1];this.node=null,this.hyperlink=null,this.node=e,this.hyperlink=t}}canvasSpaceScrolledInteractiveBounds(e){let t=this.node.canvasSpaceScrolledInteractiveBounds(e);return this.hyperlink!=null?Kn.FrozenRect_new4(this.hyperlink.bounds.x+t.x(),this.hyperlink.bounds.y+t.y(),this.hyperlink.bounds.w,this.hyperlink.bounds.h):t}},oi=(t=>(t[t.NONLINEAR=0]="NONLINEAR",t[t.FRAME_LIST=1]="FRAME_LIST",t))(oi||{}),gs=class{asScreen(){return null}asSmartAnimate(){return null}constructor(){}};gs.MAX_PRERENDER_JOB_COUNT=10;var hn=class extends gs{asScreen(){return this}hash(){let e=`${R.toString(this.nodeId)}-${hn.FrameRole[this.role]}`;return this.role==hn.FrameRole.OVERLAY?e+`-${this.overlayStackPosition}`:e}static forBaseScreen(e){return new hn(e,hn.FrameRole.BASE_SCREEN,0,null,null)}static forOverlay(e,t,n,r){return new hn(e,hn.FrameRole.OVERLAY,t,n,r)}constructor(e,t,n,r,o){super();this.nodeId=e,this.role=t,this.overlayStackPosition=n,this.prototypeAction=r,this.precedingOverlays=o}};(t=>{let g;(o=>(o[o.BASE_SCREEN=0]="BASE_SCREEN",o[o.OVERLAY=1]="OVERLAY"))(g=t.FrameRole||(t.FrameRole={}));let e;(r=>{function n(o){return t.FrameRole[o]}r.FrameRole1_toString=n})(e=t.in_FrameRole1||(t.in_FrameRole1={}))})(hn||(hn={}));var $u=class extends gs{asSmartAnimate(){return this}hash(){return`Smart animate ${R.toString(this.srcNodeId)} -> ${R.toString(this.dstNodeId)} w/ ${this.transitionType}`}constructor(e,t,n,r,o){super();this.srcNodeId=e,this.dstNodeId=t,this.role=n,this.transitionType=r,this.easingFunction=o}},_s;(e=>{function g(t,n){if(n=="URL"){if(t!="ON_CLICK"&&t!="MOUSE_UP")return!1}else if(n=="BACK"&&(t=="ON_HOVER"||t=="ON_PRESS"))return!1;return!0}e.isValidForConnection=g})(_s||(_s={}));var Ft=class{constructor(e,t){this._nodeTransitionTracker=null,this._appState=null,this._emitter=null,this._cachedPrerenderJobList=[],this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1,this._appState=e,this._emitter=t,this._appState.addAppObserver(this),this._appState.prototypeState().addObserver(this),this._nodeTransitionTracker=new hl(e),this._appState.addFrameObserver(this)}nodeTransitionTracker(){return this._nodeTransitionTracker}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActiveCanvasChange(e,t){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleActivePrototypeStartingPointChange(e,t){this._cachedPrerenderJobList=null,this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0}handleSceneGraphEvent(e){if(zr.isPrototypeStructuralChange(e.property)||e.property==13||e.property==80||e.property==8||e.property==23){this._cachedPrerenderJobList=null;let t=this._appState.prototypeState();t.isApplyingStateChangeMutation()||t.isResettingStateChangeMutations()||(this._shouldNotifyTopLevelPrototypeNodesInvalidated=!0)}}onFrame(){this._shouldNotifyTopLevelPrototypeNodesInvalidated&&(this._emitter.trigger("topLevelFramesListInvalidated",null),this._emitter.trigger("navigationInfoInvalidated",null),this._shouldNotifyTopLevelPrototypeNodesInvalidated=!1)}handleStateChangeAborted(e){this._cachedPrerenderJobList=null}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){this._cachedPrerenderJobList=null}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}_scene(){return this._appState.scene()}_baseScreenId(){return this._appState.prototypeState().getCurrentBaseScreenId()}getPrerenderingJobs(e){return this._cachedPrerenderJobList==null&&(this._cachedPrerenderJobList=this.computePrerenderJobsForStartNode(this._baseScreenId(),gs.MAX_PRERENDER_JOB_COUNT)),this._cachedPrerenderJobList}currentType(){return this._scene()==null||this._appState.getActiveCanvas()==null?1:this.activePrototypeStartNodeOrDefault()!=null||Q.getViewerMode()==Q.ViewerMode.MIRROR?0:1}activePrototypeStartNodeOrDefault(){if(this._scene()==null)return null;if(this._appState.activePrototypeStartingPointNodeId()!=null){let t=this._scene().findNode1(this._appState.activePrototypeStartingPointNodeId());if(t!=null&&t.isTopLevel()&&Ua(t))return t}let e=this.topLevelPrototypeStartingPointNodeIdsSorted();return e.length>0?this._scene().findNode1(R.fromString(e[0])):null}nodeToRestartPrototypeOn(e){if(e==null||e.type()!="CANVAS"&&e.type()!="SECTION")return null;let t=this.activePrototypeStartNodeOrDefault();if(t!=null)return t;let n=Ft.visuallySortedTopLevelFrames(e);return n.length>0?n[0]:null}getDestinationFrame(e){var i,a,s;let t,n,r,o=(i=this._scene())==null?void 0:i.findNode1(e);if(o==null)return null;if(o.type()=="SECTION"){let c=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(o.id()),l=(a=this._scene())==null?void 0:a.findNode1(c);if((l==null?void 0:l.type())=="SECTION")for(;l.type()!="FRAME";)c=this._appState.prototypeState().getLastFrameOrSectionVisitedInSection(c),l=(s=this._scene())==null?void 0:s.findNode1(c);return l}return o}validDestinationForPrototypeFromId(e){let t=this.getDestinationFrame(e);return t==null||!t.isTopLevel()||!t.isVisibleInCanvas()||t.isStateGroup()?null:t}topLevelPrototypeNodesInOrder(){return this.currentType()==1||Q.getFeatureFlags().prototypeAlwaysShowFramenum?Ft.visuallySortedTopLevelFrames(this._appState.getActiveCanvas()).map(e=>R.toString(e.id())):this._appState.prototypeState().getTlfHistory()}topLevelPrototypeStartingPointNodeIdsSorted(){if(this._scene()==null)return console.error("topLevelPrototypeStartingPointNodeIdsSorted when we don't have a valid scene"),[];let e=this._appState.getActiveCanvas();return e==null||e.type()!="CANVAS"?[]:Ft.topLevelStartingPointFramesSorted(e).map(n=>R.toString(n.id()))}prototypeStartingPointsData(){let e=this._appState.getActiveCanvas();if(e==null||e.type()!="CANVAS")return null;let t=Ft.topLevelStartingPointFramesSorted(e),n=[];for(let r of t){if(r.type()=="SECTION")continue;let o={id:R.toString(r.id()),name:r.prototypeStartingPoint().name,description:r.prototypeStartingPoint().description};n.push(o)}return n}prerenderJobsForBaseScreen(){return this.prerenderJobsAfter(hn.forBaseScreen(this._baseScreenId()))}prerenderJobsAfter(e){var a;let t,n=(a=this._scene())==null?void 0:a.findNode1(e.nodeId);if(n==null)return[];let r=new Map,o=[],i=s=>{r.has(s.hash())||(r.set(s.hash(),!0),o.push(s))};if(e.role==0){let s=this.topLevelPrototypeNodesInOrder(),c=s.indexOf(R.toString(e.nodeId));if(c!=-1){let l=c+1,u=null;l<s.length?u=R.fromString(s[l]):this.currentType()==1?u=this._appState.prototypeState().getNextBaseScreenIdForFrameList():u=this._appState.prototypeState().getNextBaseScreenIdForPrototype(),u!=null&&i(hn.forBaseScreen(u))}}return this.forTransitionInFrame(n,s=>{for(let c of s.allActions()){if(c==null||!R.isValid(c.transitionNodeID()))return!0;let l=c.transitionType(),u=!1;if(c.navigationType()=="SWAP_STATE")return!0;if(e.role==0&&(l=="SMART_ANIMATE"||xn.supportsSmartAnimate(l)&&c.transitionShouldSmartAnimate())&&(u=!0),e.role==1&&l=="SMART_ANIMATE"&&c.navigationType()=="SWAP"&&(u=!0),u&&i(new $u(n.id(),c.transitionNodeID(),e.role,l,c.easingFunction)),c.navigationType()=="NAVIGATE"){i(hn.forBaseScreen(c.transitionNodeID()));let d=this._scene().findNode1(c.transitionNodeID());d!=null&&d.setUsedAsBaseScreen(!0)}else if(c.navigationType()=="OVERLAY"){let d=e.precedingOverlays!=null?e.precedingOverlays.slice():[];d.push(c.transitionNodeID()),i(hn.forOverlay(c.transitionNodeID(),e.overlayStackPosition+1,c,d));let h=this._scene().findNode1(c.transitionNodeID());h!=null&&h.setUsedAsBaseScreen(!1)}else if(c.navigationType()=="SWAP"){if(e.role==1){let d=e.precedingOverlays!=null?e.precedingOverlays.slice():null;d!=null&&(d[d.length-1]=c.transitionNodeID()),i(hn.forOverlay(c.transitionNodeID(),e.overlayStackPosition,c,d))}else i(hn.forBaseScreen(c.transitionNodeID()));this._scene().findNode1(c.transitionNodeID()).setUsedAsBaseScreen(e.role==0)}}return!0}),o}prerenderJobForPreviousNode(){return this.prerenderJobForNodeBefore(this._baseScreenId())}prerenderJobForNodeBefore(e){var i;let t;if(((i=this._scene())==null?void 0:i.findNode1(e))==null)return null;let r=this.topLevelPrototypeNodesInOrder(),o=r.indexOf(R.toString(e));if(o!=-1){let a=o-1;if(a>=0)return hn.forBaseScreen(R.fromString(r[a]))}return null}computePrerenderJobsForStartNode(e,t){if(e==null)return[];let n=[hn.forBaseScreen(e)],r=[hn.forBaseScreen(e)],o=new Map,i=0;for(o.set(n[0].hash(),!0);i<n.length;){let a=n[i],s=[],c=this.prerenderJobForNodeBefore(a.nodeId);if(c!=null&&s.push(c),ie.List_append2(s,this.prerenderJobsAfter(a)),s.forEach(l=>{if(r.length<t&&!o.has(l.hash())){let u=l.asScreen();u!=null&&n.push(u),r.push(l),o.set(l.hash(),!0)}}),n.length==t)break;i=i+1}return r}forTransitionInFrame(e,t){let n=this._nodeTransitionTracker.cleanedUpTransitionMapByTLF();if(n._in(e.id())){let r=n.get1(e.id());for(let o=0,i=r.length;o<i;o=o+1){let a=r[o];if(!t(a))return}}}forInteractionInFrame(e,t){this.forInteractionInFrames([e],t)}forInteractionInFrames(e,t){let n=this._nodeTransitionTracker.cleanedUpInteractionMap();for(let r of n.hotspots()){let o=this._scene().findNode1(r);if(o!=null)for(let i of e)i!=null&&i.isAncestorOf(o)&&n.getHotspotInteractions(r).forEach(a=>{t(o,a)})}}forHotspotInMap(e,t){for(let n of Array.from(e.keys())){let r=this._scene().findNode2(n),o=!1;if(Ft.isNodeInteractableBecauseOfHyperlinks(r)){for(let i of e.get(n))for(let a of i.allActions())if(a.connectionURL()=="HYPERLINK"){for(let s of r.textData().hyperlinkBoxes())t(new Eo(r,s)),o=!0;break}}o||t(new Eo(r))}}findPrototypeInteractionWithId(e,t){let n=this._scene().findNode2(e),r=Ft.cleanedInteractionsForNode(this._appState,n);for(let o=0,i=r.length;o<i;o=o+1){let a=r[o];if(R.toString(a.id())==t)return a}return null}findPrototypeInteractionsWithTransition(e,t){let n=this._scene().findNode2(e),r=Ft.cleanedInteractionsForNode(this._appState,n),o=[];return r.forEach(i=>{for(let a of i.getAllValidTransitionActionsInInteraction())if(a!=null&&R.toString(a.transitionNodeID())==t){o.push(i);break}}),o}findPrototypeInteractionsWithInteractionType(e,t){let n=Ft.cleanedInteractionsForNode(this._appState,e);if(n.length==0)return n;let r=[],o=[];return n.forEach(i=>{i.event().interactionType()==t&&(i.action()!=null&&i.action().value.navigationType()=="SWAP_STATE"?o.push(i):r.push(i))}),e.isInstanceSublayer()&&o.sort((i,a)=>{let s,c,l=jt.whichInstanceToSwap(e,(c=i.action())!=null?c.value.transitionNodeID():null).stablePath(),u=jt.whichInstanceToSwap(e,(s=a.action())!=null?s.value.transitionNodeID():null).stablePath();return l.guids.length<u.guids.length?-1:1}),ie.List_append2(r,o),r}findHotspotsWithInteractionFilter(e,t,n){return this.findHotspotsWithNoodleFilter(e,t,(r,o)=>n(o))}findHotspotsWithInteractionFilterWithinMultipleNodes(e,t,n){return this.findHotspotsWithNoodleFilterWithinMultipleNodes(e,t,(r,o)=>n(o))}findHotspotsWithNoodleFilter(e,t,n){let r=[];return e==null?r:this.findHotspotsWithNoodleFilterWithinMultipleNodes(new Set([e]),t,n)}findHotspotsWithNoodleFilterWithinMultipleNodes(e,t,n){let r=[];if(e==null||e.size==0)return r;let o=new Map;return this.forInteractionInFrames(Array.from(e.values()),(i,a)=>{!n(i,a)||!a.allActions().some(c=>_s.isValidForConnection(a.event().interactionType(),c.connectionType()))||(o.has(R.toString(i.id()))||o.set(R.toString(i.id()),[]),o.get(R.toString(i.id())).push(a))}),this.forHotspotInMap(o,i=>{(t==0||!e.has(i.node))&&r.push(i)}),r.sort((i,a)=>i.node.isAboveInLayerOrder(a.node)?-1:1),r}findHotspotsWithInteractionType(e,t,n){return this.findHotspotsWithInteractionFilter(e,t,r=>r.event().interactionType()==n)}findAllHotspots(e,t){return this.findHotspotsWithInteractionFilter(e,t,n=>!0)}hotspotOnPresentedNode(e,t,n,r){let o=n!="MOUSE_OUT"&&n!="MOUSE_LEAVE",i=this._appState.prototypeStructure().findHotspotsWithInteractionType(e,0,n),a=null;for(let s of i)s.canvasSpaceScrolledInteractiveBounds(0).contains2(t)==o&&(a==null||s.node.isAboveInLayerOrder(a.node))&&(a=s);return a}static createFakeHyperlinkInteraction(){let e=new Gr("ON_CLICK",null,null,{},null,null),t=new qn(null,null,null,null,null,null,"URL","HYPERLINK",null,null,null,null,null,null,null,null,null,null,null,null,null,null);return new jt(R.invalid(),e,[t],!1,0)}static hasValidTopLevelFrameInSection(e){for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);if(Ft.isValidTopLevelFrameForPrototype(r))return!0}return!1}static isValidTopLevelFrameForPrototype(e){return e==null||!e.isTopLevel()||!e.isVisibleInCanvas()||e.isStateGroup()?!1:e.type()=="SECTION"?Ft.hasValidTopLevelFrameInSection(e):e.type()=="SLIDE"?!0:!(e.type()!="FRAME"||e.isResizeToFit())}static cleanedInteractionsForNode(e,t){let n=[];if(t==null)return n;let r=t.prototypeInteractions();for(let o=0,i=r.length;o<i;o=o+1){let a=r[o];if(a.actions()==null||a.actions().length==0)continue;let s=[];for(let c=0,l=a.actions().length;c<l;c=c+1){let u=a.actions()[c],d=null;if(R.isValid(u.transitionNodeID())){let h=e.getActiveCanvas(),S=Ft.cleanedUpTransitionDestinationId(h,t==null?void 0:t.id(),u.transitionNodeID(),u.navigationType(),u.connectionType());S!==null&&S!=null&&(d=u.withTransitionNodeID(S)),u.navigationType()=="SWAP_STATE"&&!t.scene().interactiveComponentsEnabled()&&(d=null)}else t.isVisibleInCanvas()&&Ft.isPrototypeActionInteractableBecauseOfConnection(u)&&(d=u);d!=null&&s.push(d)}s.length!=0&&n.push(a.withActions(s))}return n.length==0&&Ft.isNodeInteractableBecauseOfHyperlinks(t)&&n.push(Ft.createFakeHyperlinkInteraction()),n}static cleanedUpTransitionDestinationId(e,t,n,r,o){return x._prototypeLib.modules().prototype.cleanedUpTransitionDestination(e!=null?e.handle():-1,t,n,Se.schema.NavigationType[r],Se.schema.ConnectionType[o])}static visuallySortedTopLevelFrames(e){if(e==null)return[];let t=[];for(let o=0,i=e.childCount();o<i;o=o+1){let a=e.childAt1(o);Ft.isValidTopLevelFrameForPrototype(a)&&t.push(a)}let n=Ft.visuallySortLayersLeftToRightAndTopToBottom1(t),r=[];for(let o=0,i=n.length;o<i;o=o+1){let a=n[o];Ft.isValidTopLevelFrameForPrototype(a)&&(a.type()=="SECTION"?ie.List_append2(r,Ft.visuallySortedTopLevelFrames(a)):r.push(a))}return r}static visuallySortLayersLeftToRightAndTopToBottom1(e){let t=e.slice();return t.sort((n,r)=>{let o=n.fullSizeCanvasSpaceBoundingBox(),i=r.fullSizeCanvasSpaceBoundingBox();return i.top()<=o.bottom()&&i.bottom()>=o.top()?o.x()==i.x()?Bn.string_compare(R.toString(n.id()),R.toString(r.id())):o.x()-i.x()|0:o.y()-i.y()|0}),t}static visuallySortLayersLeftToRightAndTopToBottom2(e,t){let n=[];for(let o of t){let i=e.findNode1(o);i!=null&&n.push(i)}return Ft.visuallySortLayersLeftToRightAndTopToBottom1(n).map(o=>R.toString(o.id()))}static adjacentBaseScreens(e,t){let n=t.scene(),r=new Vi(a=>R.toString(a)),o=null,i=new rr;return o=a=>{if(a==null||i._in(R.toString(a.id()))||!e._in(a.id()))return;i.add(R.toString(a.id()));let s=e.get1(a.id());for(let c=0,l=s.length;c<l;c=c+1){let u=s[c];for(let d of u.allActions()){if(d==null||!R.isValid(d.transitionNodeID()))continue;let h=n.findNode1(d.transitionNodeID());if(h==null){ze("null destination when finding reachable TLFs?");continue}let S=d.connectionType()!="UPDATE_MEDIA_RUNTIME"&&d.connectionType()!="SET_VARIABLE";d.navigationType()=="NAVIGATE"&&S||d.navigationType()=="SWAP"&&R.equals(a.id(),t.id())?r.add(h.id()):(d.navigationType()=="OVERLAY"||d.navigationType()=="SWAP")&&o(h)}}},o(t),r}static topLevelStartingPointFramesInSection(e){let t=[],n=[];for(n.push(e);n.length>0;){let r=n.shift();for(let o=0,i=r.childCount();o<i;o=o+1){let a=r.childAt1(o);a.isTopLevel()&&Ua(a)&&t.push(a),a.type()=="SECTION"&&n.push(a)}}return t}static topLevelStartingPointFramesSorted(e){let t=[];for(let n=0,r=e.childCount();n<r;n=n+1){let o=e.childAt1(n);if(o.type()=="SECTION"){let i=Ft.topLevelStartingPointFramesInSection(o);ie.List_append2(t,i)}o.isTopLevel()&&Ua(o)&&t.push(o)}return t.sort((n,r)=>sn.compare(n.prototypeStartingPoint().position,r.prototypeStartingPoint().position)),t}static isNodeInteractableBecauseOfHyperlinks(e){var r,o;let t,n;return e.type()=="TEXT"&&((o=(r=e.textData())==null?void 0:r.hyperlinkBoxes())!=null?o:[]).length>0}static isPrototypeActionInteractableBecauseOfConnection(e){return e.connectionURL()!=null||e.connectionType()=="BACK"||e.connectionType()=="CLOSE"||e.connectionType()=="SET_VARIABLE"||e.connectionType()=="UPDATE_MEDIA_RUNTIME"||e.connectionType()=="CONDITIONAL"}},Zu;(e=>{function g(t){return fs[t]}e.HotspotPredicate_toString=g})(Zu||(Zu={}));var Qu;(e=>{function g(t){return oi[t]}e.PrototypeType_toString=g})(Qu||(Qu={}));var Xc=class{seconds(){return ta.Performance_now(kr().performance)/1e3}milliseconds(){return ta.Performance_now(kr().performance)}constructor(){}};var oa=class{reset(){this._seconds=0}advanceSeconds(e){this._seconds+=e}seconds(){return this._seconds}milliseconds(){return this._seconds*1e3}constructor(){this._seconds=0}},We;(i=>{function g(a){i._implementations.push(a)}i.dangerouslyPushMockTime=g;function e(){if(i._implementations.length==1)throw new Error("Popping last time implementation");ie.List_removeLast(i._implementations)}i.popMockTime=e;function t(){return ie.List_last(i._implementations).seconds()}i.seconds=t;function n(){return ie.List_last(i._implementations).milliseconds()}i.milliseconds=n;function r(a){let s=t(),c=t();for(;c-s<a;)c=t()}i.spin=r,i._implementations=[new Xc]})(We||(We={}));var Bo=class{startAnimation(e,t){this._animationCurve=e,this._animationStartTime=We.seconds(),this._animationEndTime=this._animationStartTime+t}animationProgress(){let e=(We.seconds()-this._animationStartTime)/(this._animationEndTime-this._animationStartTime);return this._animationCurve==Bo.Curve.EASE_IN_OUT?e*=e*e*(e*(e*6-15)+10):(e=1-e,e=1-e*e*e*e*e),Math.min(e,1)}constructor(){this._animationCurve=Bo.Curve.EASE_IN_OUT,this._animationStartTime=0,this._animationEndTime=0}};(t=>{let g;(o=>(o[o.EASE_IN_OUT=0]="EASE_IN_OUT",o[o.DECAY=1]="DECAY"))(g=t.Curve||(t.Curve={}));let e;(r=>{function n(o){return t.Curve[o]}r.Curve_toString=n})(e=t.in_Curve||(t.in_Curve={}))})(Bo||(Bo={}));var E;(z=>{function g(O){return O&255}z.red=g;function e(O){return O>>8&255}z.green=e;function t(O){return O>>16&255}z.blue=t;function n(O){return O>>>24}z.alpha=n;function r(O){return g(O)/255}z.redF=r;function o(O){return e(O)/255}z.greenF=o;function i(O){return t(O)/255}z.blueF=i;function a(O){return n(O)/255}z.alphaF=a;function s(O,G){return p(g(O),e(O),t(O),G)}z.withAlpha=s;function c(O){let G=a(O);return _(r(O)*G,o(O)*G,i(O)*G,G)}z.premultiplied=c;function l(O){let G=a(O);return _(r(O)/G,o(O)/G,i(O)/G,G)}z.unpremultiplied=l;function u(O,G){return O&16777215|N(a(O)*G)<<24}z.multiplyOpacity=u;function d(O){let G=1-a(O)+a(O)*r(O),L=1-a(O)+a(O)*o(O),$=1-a(O)+a(O)*i(O);return _(G,L,$,1)}z.rgbaToRgb=d;function h(O){return`Color(${g(O)}, ${e(O)}, ${t(O)}, ${n(O)})`}z.toString=h;function S(O){return n(O)==255}z.isOpaque=S;function f(O){return"#"+Y(g(O))+Y(e(O))+Y(t(O))}z.toCSS=f;function y(O){return{red:r(O),green:o(O),blue:i(O),alpha:a(O)}}z.toColorF=y;function v(O){return{r:g(O),g:e(O),b:t(O),a:n(O)}}z.asInttoJSON=v;function b(O){return{r:r(O),g:o(O),b:i(O),a:a(O)}}z.asFloattoJSON=b;function m(O,G,L){return p(O,G,L,255)}z.new1=m;function p(O,G,L,$){return O|G<<8|L<<16|$<<24}z.new2=p;function _(O,G,L,$){return p(N(O),N(G),N(L),N($))}z.new3=_;function T(O){return _(O.red,O.green,O.blue,O.alpha)}z.fromColorF=T;function N(O){return O<0?0:O>=1?255:Math.round(O*255)|0}z._clamp=N;function k(O,G,L){return _(r(O)+(r(G)-r(O))*L,o(O)+(o(G)-o(O))*L,i(O)+(i(G)-i(O))*L,a(O)+(a(G)-a(O))*L)}z.mix=k;function j(O,G){let L=a(O),$=a(G),se=L*(1-$),nt=se+$,ot=se/nt,It=$/nt;return _(r(O)*ot+r(G)*It,o(O)*ot+o(G)*It,i(O)*ot+i(G)*It,nt)}z.blend=j;function te(O,G){return _(r(O)*(1-a(G))+r(G),o(O)*(1-a(G))+o(G),i(O)*(1-a(G))+i(G),a(O)*(1-a(G))+a(G))}z.over=te;function Y(O){let G=Vr(O.toString(16));return(G.length==1?"0"+G:G).toUpperCase()}z.asCSSComponent=Y,z.TRANSPARENT=p(0,0,0,0),z.BLACK=m(0,0,0),z.WHITE=m(255,255,255),z.RED=m(255,0,0),z.GREEN=m(0,255,0),z.BLUE=m(0,0,255),z.YELLOW=m(255,255,0),z.CYAN=m(0,255,255),z.MAGENTA=m(255,0,255)})(E||(E={}));var ep=(s=>(s[s.ROTATE_0=0]="ROTATE_0",s[s.ROTATE_90=1]="ROTATE_90",s[s.ROTATE_180=2]="ROTATE_180",s[s.ROTATE_270=3]="ROTATE_270",s[s.FLIP_ROTATE_0=4]="FLIP_ROTATE_0",s[s.FLIP_ROTATE_90=5]="FLIP_ROTATE_90",s[s.FLIP_ROTATE_180=6]="FLIP_ROTATE_180",s[s.FLIP_ROTATE_270=7]="FLIP_ROTATE_270",s))(ep||{}),ml;(d=>{function g(h,S){if(S.value+1>h.length)return null;let f=new fe(h[S.value]);return S.value=S.value+1,f}d._read8=g;function e(h,S,f){if(S.value+2>h.length)return null;let y=h[S.value],v=h[S.value+1];return S.value=S.value+2,new fe(f==o.LITTLE?y|v<<8:v|y<<8)}d._read16=e;function t(h,S,f){if(S.value+2>h.length)return null;let y=h[S.value],v=h[S.value+1],b=h[S.value+2],m=h[S.value+3];return S.value=S.value+4,new fe(f==o.LITTLE?y|v<<8|b<<16|m<<24:m|b<<8|v<<16|y<<24)}d._read32=t;function n(h){let S=[255,216,255];if(h.length<S.length)return null;for(let y=0,v=S.length;y<v;y=y+1)if(S[y]!=h[y])return null;let f=new fe(2);for(;f.value+4<=h.length;){let y=e(h,f,o.BIG);if(y==null||y.value>>8!=255)return null;let v=e(h,f,o.BIG);if(v==null||v.value<2)return null;if(f.value=f.value-2,y.value==65505){let b=r(h,f.value);if(b!=null)return b}f.value=f.value+v.value}return null}d.readFromJPEG=n;function r(h,S){let f=new fe(S),y=e(h,f,o.BIG);if(y==null||y.value<6)return null;let v=t(h,f,o.BIG);if(v==null||v.value!=1165519206)return null;let b=e(h,f,o.BIG);if(b==null||b.value!=0)return null;let m=t(h,f,o.BIG);if(m==null||m.value!=1229531648&&m.value!=1296891946)return null;let _=m.value==1229531648?o.LITTLE:o.BIG,T=t(h,f,_);if(T==null)return null;f.value=f.value+T.value-8;let N=e(h,f,_);if(N==null)return null;let k=N.value,j=-1;for(let te=0;te<k;te=te+1){let Y=e(h,f,_);if(Y==null)break;let _e=Y.value,ce=e(h,f,_);if(ce==null)break;let V=ce.value,H=t(h,f,_);if(H==null)break;let M=H.value,K=new fe(f.value);if(f.value=f.value+4,!(_e!=d.EXIF_TAG_ORIENTATION||M!=1)){if(V==d.EXIF_FORMAT_BYTE){let U=g(h,K);if(U==null)return null;j=U.value}else if(V==d.EXIF_FORMAT_SHORT){let U=e(h,K,_);if(U==null)return null;j=U.value}else if(V==d.EXIF_FORMAT_LONG||V==d.EXIF_FORMAT_SLONG){let U=t(h,K,_);if(U==null)return null;j=U.value}else continue;switch(j){case 1:return new fe(0);case 6:return new fe(1);case 3:return new fe(2);case 8:return new fe(3);case 2:return new fe(4);case 5:return new fe(5);case 4:return new fe(6);case 7:return new fe(7)}}}return null}d._decodeExifOrientation=r;let o;(f=>(f[f.BIG=0]="BIG",f[f.LITTLE=1]="LITTLE"))(o=d.Endianness||(d.Endianness={}));let i;(S=>{function h(f){return o[f]}S.Endianness_toString=h})(i=d.in_Endianness||(d.in_Endianness={})),d.EXIF_TAG_ORIENTATION=274,d.EXIF_FORMAT_BYTE=1,d.EXIF_FORMAT_SHORT=3,d.EXIF_FORMAT_LONG=4,d.EXIF_FORMAT_SLONG=9})(ml||(ml={}));var Ss;(n=>{function g(r){switch(r){case 0:case 4:return 0;case 1:case 5:return 90;case 2:case 6:return 180;case 3:case 7:return 270;default:return 0}}n.ImageOrientation_rotationDegrees=g;function e(r){return r==4||r==5||r==6||r==7}n.ImageOrientation_shouldFlip=e;function t(r){return ep[r]}n.ImageOrientation_toString=t})(Ss||(Ss={}));var gi=(t=>(t[t.ANIMATED=0]="ANIMATED",t[t.STATIC_IMAGE=1]="STATIC_IMAGE",t))(gi||{}),tp;(e=>{function g(t){return gi[t]}e.ImageType_toString=g})(tp||(tp={}));var bs;(V=>{function g(H){return H<0?0:H>255?255:H}V._clip=g;function e(H){return g(H+64>>7)}V._CF=e;function t(H,M){let K=0,U=H[M+4]<<11,P=H[M+6],J=H[M+2],z=H[M+1],O=H[M+7],G=H[M+5],L=H[M+3],$=0;if((U|P|J|z|O|G|L)==0){let se=H[M]<<3;H[M]=se,H[M+1]=se,H[M+2]=se,H[M+3]=se,H[M+4]=se,H[M+5]=se,H[M+6]=se,H[M+7]=se;return}K=(H[M]<<11)+128,$=V._W7*(z+O),z=$+(V._W1-V._W7)*z,O=$-(V._W1+V._W7)*O,$=V._W3*(G+L),G=$-(V._W3-V._W5)*G,L=$-(V._W3+V._W5)*L,$=K+U,K=K-U,U=V._W6*(J+P),P=U-(V._W2+V._W6)*P,J=U+(V._W2-V._W6)*J,U=z+G,z=z-G,G=O+L,O=O-L,L=$+J,$=$-J,J=K+P,K=K-P,P=181*(z+O)+128>>8,z=181*(z-O)+128>>8,H[M]=L+U>>8,H[M+1]=J+P>>8,H[M+2]=K+z>>8,H[M+3]=$+G>>8,H[M+4]=$-G>>8,H[M+5]=K-z>>8,H[M+6]=J-P>>8,H[M+7]=L-U>>8}V._rowInverseDCT=t;function n(H,M,K,U,P){let J=0,z=H[M+8*4]<<8,O=H[M+8*6],G=H[M+8*2],L=H[M+8*1],$=H[M+8*7],se=H[M+8*5],nt=H[M+8*3],ot=0;if((z|O|G|L|$|se|nt)==0){let It=g((H[M]+32>>6)+128);for(let Qe=8;Qe!=0;Qe=Qe-1)K[U]=It,U=U+P;return}J=(H[M]<<8)+8192,ot=V._W7*(L+$)+4,L=ot+(V._W1-V._W7)*L>>3,$=ot-(V._W1+V._W7)*$>>3,ot=V._W3*(se+nt)+4,se=ot-(V._W3-V._W5)*se>>3,nt=ot-(V._W3+V._W5)*nt>>3,ot=J+z,J=J-z,z=V._W6*(G+O)+4,O=z-(V._W2+V._W6)*O>>3,G=z+(V._W2-V._W6)*G>>3,z=L+se,L=L-se,se=$+nt,$=$-nt,nt=ot+G,ot=ot-G,G=J+O,J=J-O,O=181*(L+$)+128>>8,L=181*(L-$)+128>>8,K[U]=g((nt+z>>14)+128),U=U+P,K[U]=g((G+O>>14)+128),U=U+P,K[U]=g((J+L>>14)+128),U=U+P,K[U]=g((ot+se>>14)+128),U=U+P,K[U]=g((ot-se>>14)+128),U=U+P,K[U]=g((J-L>>14)+128),U=U+P,K[U]=g((G-O>>14)+128),U=U+P,K[U]=g((nt-z>>14)+128)}V._colInverseDCT=n;let r;(J=>(J[J.OK=0]="OK",J[J.NO_JPEG=1]="NO_JPEG",J[J.UNSUPPORTED=2]="UNSUPPORTED",J[J.SYNTAX_ERROR=3]="SYNTAX_ERROR",J[J.FINISHED=4]="FINISHED"))(r=V.Result||(V.Result={}));class o{upsampleH(){let M=this.width-3,K=0,U=0,P=new Uint8Array(this.width*this.height*2);for(let J=this.height;J!=0;J=J-1){P[U]=e(V._CF2A*this.pixels[K]+V._CF2B*this.pixels[K+1]),P[U+1]=e(V._CF3X*this.pixels[K]+V._CF3Y*this.pixels[K+1]+V._CF3Z*this.pixels[K+2]),P[U+2]=e(V._CF3A*this.pixels[K]+V._CF3B*this.pixels[K+1]+V._CF3C*this.pixels[K+2]);for(let z=0;z<M;z=z+1)P[U+z*2+3]=e(V._CF4A*this.pixels[K+z]+V._CF4B*this.pixels[K+z+1]+V._CF4C*this.pixels[K+z+2]+V._CF4D*this.pixels[K+z+3]),P[U+z*2+4]=e(V._CF4D*this.pixels[K+z]+V._CF4C*this.pixels[K+z+1]+V._CF4B*this.pixels[K+z+2]+V._CF4A*this.pixels[K+z+3]);K=K+this.stride,U=U+this.width*2,P[U+-3]=e(V._CF3A*this.pixels[K-1]+V._CF3B*this.pixels[K-2]+V._CF3C*this.pixels[K-3]),P[U+-2]=e(V._CF3X*this.pixels[K-1]+V._CF3Y*this.pixels[K-2]+V._CF3Z*this.pixels[K-3]),P[U+-1]=e(V._CF2A*this.pixels[K-1]+V._CF2B*this.pixels[K-2])}this.width<<=1,this.stride=this.width,this.pixels=P}upsampleV(){let M=this.width,K=this.stride,U=K+K,P=new Uint8Array(this.width*this.height*2);for(let J=0;J<M;J=J+1){let z=J,O=J;P[O]=e(V._CF2A*this.pixels[z]+V._CF2B*this.pixels[z+K]),O=O+M,P[O]=e(V._CF3X*this.pixels[z]+V._CF3Y*this.pixels[z+K]+V._CF3Z*this.pixels[z+U]),O=O+M,P[O]=e(V._CF3A*this.pixels[z]+V._CF3B*this.pixels[z+K]+V._CF3C*this.pixels[z+U]),O=O+M,z=z+K;for(let G=this.height-3;G!=0;G=G-1)P[O]=e(V._CF4A*this.pixels[z+-K]+V._CF4B*this.pixels[z]+V._CF4C*this.pixels[z+K]+V._CF4D*this.pixels[z+U]),O=O+M,P[O]=e(V._CF4D*this.pixels[z+-K]+V._CF4C*this.pixels[z]+V._CF4B*this.pixels[z+K]+V._CF4A*this.pixels[z+U]),O=O+M,z=z+K;z=z+K,P[O]=e(V._CF3A*this.pixels[z]+V._CF3B*this.pixels[z-K]+V._CF3C*this.pixels[z-U]),O=O+M,P[O]=e(V._CF3X*this.pixels[z]+V._CF3Y*this.pixels[z-K]+V._CF3Z*this.pixels[z-U]),O=O+M,P[O]=e(V._CF2A*this.pixels[z]+V._CF2B*this.pixels[z-K])}this.height<<=1,this.stride=this.width,this.pixels=P}constructor(){this.id=0,this.ssx=0,this.ssy=0,this.width=0,this.height=0,this.stride=0,this.quantizationTableIndex=0,this.acTableIndex=0,this.dcTableIndex=0,this.dcPred=0,this.pixels=null}}V.Component=o;class i{constructor(){}}V.Stop=i;let a;(L=>(L[L.NONE=0]="NONE",L[L.ROTATE_0=1]="ROTATE_0",L[L.FLIP_ROTATE_0=2]="FLIP_ROTATE_0",L[L.ROTATE_180=3]="ROTATE_180",L[L.FLIP_ROTATE_180=4]="FLIP_ROTATE_180",L[L.FLIP_ROTATE_90=5]="FLIP_ROTATE_90",L[L.ROTATE_90=6]="ROTATE_90",L[L.FLIP_ROTATE_270=7]="FLIP_ROTATE_270",L[L.ROTATE_270=8]="ROTATE_270"))(a=V.Orientation||(V.Orientation={}));class s{constructor(){this._bitBuffer=0,this._bitCount=0,this._block=new Int32Array(64),this._bytes=null,this._componentCount=0,this._components=[],this._error=0,this._exifOrientation=1,this._height=0,this._heightInMacroBlocks=0,this._huffmanTable=[],this._length=0,this._macroBlockSizeX=0,this._macroBlockSizeY=0,this._offset=0,this._quantizationTable=[],this._restartInterval=0,this._rgb=null,this._size=0,this._width=0,this._widthInMacroBlocks=0,this._getVLC_code=0;for(let M=0;M<4;M=M+1)this._quantizationTable.push(new Uint8Array(64)),this._huffmanTable.push(new Uint16Array(65536)),this._components.push(new o)}_throw(M){throw this._error=M,new i}_showBits(M){if(M==0)return 0;for(;this._bitCount<M;){if(this._size<=0){this._bitBuffer=this._bitBuffer<<8|255,this._bitCount=this._bitCount+8;continue}let K=this._bytes[this._offset];if(this._offset=this._offset+1,this._size=this._size-1,this._bitCount=this._bitCount+8,this._bitBuffer=this._bitBuffer<<8|K,K==255){this._size==0&&this._throw(3);let U=this._bytes[this._offset];this._offset=this._offset+1,this._size=this._size-1,U==217?this._size=0:U!=0&&U!=255&&((U&248)!=208&&this._throw(3),this._bitBuffer=this._bitBuffer<<8|U,this._bitCount=this._bitCount+8)}}return this._bitBuffer>>this._bitCount-M&(1<<M)-1}_skipBits(M){this._bitCount<M&&this._showBits(M),this._bitCount=this._bitCount-M}_getBits(M){let K=this._showBits(M);return this._skipBits(M),K}_byteAlign(){this._bitCount&=248}_skip(M){this._offset=this._offset+M,this._size=this._size-M,this._length=this._length-M,this._size<0&&this._throw(3)}_decodeBig16(M){return this._bytes[M]<<8|this._bytes[M+1]}_decodeBig32(M){return this._bytes[M]<<24|this._bytes[M+1]<<16|this._bytes[M+2]<<8|this._bytes[M+3]}_decode16(M,K){return K==s.Endianness.LITTLE?this._bytes[M]|this._bytes[M+1]<<8:this._decodeBig16(M)}_decode32(M,K){return K==s.Endianness.LITTLE?this._bytes[M]|this._bytes[M+1]<<8|this._bytes[M+2]<<16|this._bytes[M+3]<<24:this._decodeBig32(M)}_decodeLength(){this._size<2&&this._throw(3),this._length=this._decodeBig16(this._offset),this._length>this._size&&this._throw(3),this._skip(2)}_skipMarker(){this._decodeLength(),this._skip(this._length)}_decodeSOF(){let M=0,K=0,U=null;this._decodeLength(),this._length<9&&this._throw(3),this._bytes[this._offset]!=8&&this._throw(2),this._height=this._decodeBig16(this._offset+1),this._width=this._decodeBig16(this._offset+3),this._componentCount=this._bytes[this._offset+5],this._skip(6),this._componentCount!=1&&this._componentCount!=3&&this._throw(2),this._length<this._componentCount*3&&this._throw(3);for(let P=0;P<this._componentCount;P=P+1)U=this._components[P],U.id=this._bytes[this._offset],U.ssx=this._bytes[this._offset+1]>>4,U.ssy=this._bytes[this._offset+1]&15,U.quantizationTableIndex=this._bytes[this._offset+2],(U.ssx==0||U.ssy==0||(U.quantizationTableIndex&252)!=0)&&this._throw(3),((U.ssx&U.ssx-1)!=0||(U.ssy&U.ssy-1)!=0)&&this._throw(2),this._skip(3),U.ssx>M&&(M=U.ssx),U.ssy>K&&(K=U.ssy);this._componentCount==1&&(U=this._components[0],U.ssx=U.ssy=M=K=1),this._macroBlockSizeX=M<<3,this._macroBlockSizeY=K<<3,this._widthInMacroBlocks=(this._width+this._macroBlockSizeX-1)/this._macroBlockSizeX|0,this._heightInMacroBlocks=(this._height+this._macroBlockSizeY-1)/this._macroBlockSizeY|0;for(let P=0;P<this._componentCount;P=P+1)U=this._components[P],U.width=(this._width*U.ssx+M-1)/M|0,U.height=(this._height*U.ssy+K-1)/K|0,U.stride=this._widthInMacroBlocks*this._macroBlockSizeX*U.ssx/M|0,(U.width<3&&U.ssx!=M||U.height<3&&U.ssy!=K)&&this._throw(2),U.pixels=new Uint8Array(U.stride*(this._heightInMacroBlocks*this._macroBlockSizeY*U.ssy/K|0));this._rgb=new Uint8Array(this._width*this._height*3),this._skip(this._length)}_decodeDHT(){for(this._decodeLength();this._length>=17;){let M=this._bytes[this._offset];(M&236)!=0&&this._throw(3),(M&2)!=0&&this._throw(2),M=(M|M>>3)&3;let K=new Uint8Array(16);for(let O=1;O<=16;O=O+1)K[O-1]=this._bytes[this._offset+O];this._skip(17);let U=this._huffmanTable[M],P=0,J=65536,z=65536;for(let O=1;O<=16;O=O+1){z>>=1;let G=K[O-1];if(G!=0){this._length<G&&this._throw(3),J=J-(G<<16-O),J<0&&this._throw(3);for(let L=0;L<G;L=L+1){let $=this._bytes[this._offset+L];for(let se=z;se!=0;se=se-1)P<65536&&(U[P]=O<<8|$,P=P+1)}this._skip(G)}}for(;J!=0;)J=J-1,P<65536&&(U[P]=U[P]&255<<8,P=P+1)}this._length!=0&&this._throw(3)}_decodeDQT(){for(this._decodeLength();this._length>=65;){let M=this._bytes[this._offset];(M&252)!=0&&this._throw(3);let K=this._quantizationTable[M];for(let U=0;U<64;U=U+1)K[U]=this._bytes[this._offset+U+1];this._skip(65)}this._length!=0&&this._throw(3)}_decodeDRI(){this._decodeLength(),this._length<2&&this._throw(3),this._restartInterval=this._decodeBig16(this._offset),this._skip(this._length)}_getVLC(M){let K=this._showBits(16),U=M[K]>>8;return U==0&&this._throw(3),this._skipBits(U),K=M[K]&255,this._getVLC_code=K,U=K&15,U==0?0:(K=this._getBits(U),K<1<<U-1&&(K=K+((-1<<U)+1)),K)}_decodeBlock(M,K){let U=0;for(this._block=new Int32Array(64),M.dcPred=M.dcPred+this._getVLC(this._huffmanTable[M.dcTableIndex]),this._block[0]=M.dcPred*this._quantizationTable[M.quantizationTableIndex][0];U<63;){let P=this._getVLC(this._huffmanTable[M.acTableIndex]);if(this._getVLC_code==0)break;(this._getVLC_code&15)==0&&this._getVLC_code!=240&&this._throw(3),U=U+((this._getVLC_code>>4)+1),U>63&&this._throw(3),this._block[V._zigZagTable[U]]=P*this._quantizationTable[M.quantizationTableIndex][U]}for(let P=0;P<64;P=P+8)t(this._block,P);for(let P=0;P<8;P=P+1)n(this._block,P,M.pixels,K+P,M.stride)}_decodeScan(){let M=this._restartInterval,K=0;this._decodeLength(),this._length<4+2*this._componentCount&&this._throw(3),this._bytes[this._offset]!=this._componentCount&&this._throw(2),this._skip(1);for(let U=0;U<this._componentCount;U=U+1){let P=this._components[U];this._bytes[this._offset]!=P.id&&this._throw(3),(this._bytes[this._offset+1]&238)!=0&&this._throw(3),P.dcTableIndex=this._bytes[this._offset+1]>>4,P.acTableIndex=this._bytes[this._offset+1]&1|2,this._skip(2)}(this._bytes[this._offset]!=0||this._bytes[this._offset+1]!=63||this._bytes[this._offset+2]!=0)&&this._throw(2),this._skip(this._length);for(let U=0;U<this._heightInMacroBlocks;U=U+1)for(let P=0;P<this._widthInMacroBlocks;P=P+1){if((P!=0||U!=0)&&this._restartInterval!=0&&(M=M-1,M==0)){this._byteAlign();let J=this._getBits(16);((J&65528)!=65488||(J&7)!=K)&&this._throw(3),K=K+1&7,M=this._restartInterval;for(let z=0;z<4;z=z+1)this._components[z].dcPred=0}for(let J=0;J<this._componentCount;J=J+1){let z=this._components[J];for(let O=0;O<z.ssy;O=O+1)for(let G=0;G<z.ssx;G=G+1)this._decodeBlock(z,(U*z.ssy+O)*z.stride+P*z.ssx+G<<3)}}this._error=4}_decodeEXIF(){if(this._decodeLength(),this._length<6||this._decodeBig32(this._offset)!=1165519206||this._decodeBig16(this._offset+4)!=0){this._skip(this._length);return}this._skip(6);let M=this._offset;this._length<8&&this._throw(3);let K=this._decodeBig32(M),U=K==1229531648?s.Endianness.LITTLE:s.Endianness.BIG;U==s.Endianness.BIG&&K!=1296891946&&this._throw(3);let P=274,J=1,z=3,O=4,G=9,L=M+this._decode32(M+4,U),$=this._decode16(L,U);L=L+2;for(let se=0,nt=$;se<nt;se=se+1){let ot=this._decode16(L,U),It=this._decode16(L+2,U),Qe=this._decode32(L+4,U);if(L=L+8,ot==P&&Qe==1){this._exifOrientation=0,It==J?this._exifOrientation=this._bytes[L]:It==z?this._exifOrientation=this._decode16(L,U):(It==O||It==G)&&(this._exifOrientation=this._decode32(L,U)),(this._exifOrientation<1||this._exifOrientation>8)&&(this._exifOrientation=1);break}L=L+4}this._skip(this._length)}_convert(){for(let U=0;U<this._componentCount;U=U+1){let P=this._components[U];for(;P.width<this._width||P.height<this._height;)P.width<this._width&&P.upsampleH(),P.height<this._height&&P.upsampleV()}let M=this._components[0],K=this._rgb;if(this._componentCount==1){let U=0,P=0;for(let J=this._height;J!=0;J=J-1){for(let z=0;z<this._width;z=z+1){let O=M.pixels[P+z];K[U]=O,K[U+1]=O,K[U+2]=O,U=U+3}P=P+M.stride}}else{let U=this._components[1],P=this._components[2],J=0,z=0,O=0,G=0;for(let L=this._height;L!=0;L=L-1){for(let $=0;$<this._width;$=$+1){let se=M.pixels[z+$]<<8,nt=U.pixels[O+$]-128,ot=P.pixels[G+$]-128;K[J]=g(se+359*ot+128>>8),K[J+1]=g(se-88*nt-183*ot+128>>8),K[J+2]=g(se+454*nt+128>>8),J=J+3}z=z+M.stride,O=O+U.stride,G=G+P.stride}}}_orient(){if(this._exifOrientation==1)return;let M=this._width,K=this._height,U=this._exifOrientation>=5,P=U?K:M,J=U?M:K,z=this._rgb,O=new Uint8Array(P*J*3);for(let G=0,L=0;G<K;G=G+1){let $=0,se=0;switch(this._exifOrientation){case 2:{$=G*P+P-1,se=-1;break}case 3:{$=(K-G-1)*P+P-1,se=-1;break}case 4:{$=(K-G-1)*P,se=1;break}case 5:{$=G,se=P;break}case 6:{$=K-G-1,se=P;break}case 7:{$=K-G-1+P*(J-1),se=-P;break}case 8:{$=G+P*(J-1),se=-P;break}}$=$*3,se=se*3;for(let nt=0;nt<M;nt=nt+1,L=L+3)O[$]=z[L],O[$+1]=z[L+1],O[$+2]=z[L+2],$=$+se}this._width=P,this._height=J,this._rgb=O}decodeBytes(M){try{for(this._bytes=M,this._offset=0,this._size=M.length,(this._size<2||this._bytes[0]!=255||this._bytes[1]!=216)&&this._throw(1),this._skip(2);this._error==0;){(this._size<2||this._bytes[this._offset]!=255)&&this._throw(3),this._skip(2);let K=this._bytes[this._offset-1];K==192?this._decodeSOF():K==196?this._decodeDHT():K==219?this._decodeDQT():K==221?this._decodeDRI():K==218?this._decodeScan():K==225?this._decodeEXIF():K==254?this._skipMarker():(K&240)==224?this._skipMarker():this._throw(2)}this._error!=4?this._error=3:(this._convert(),this._orient(),this._error=0)}catch{}return this._error}width(){return this._width}height(){return this._height}rgb(){return this._rgb}}V.Decoder=s,(K=>{let H;(J=>(J[J.BIG=0]="BIG",J[J.LITTLE=1]="LITTLE"))(H=K.Endianness||(K.Endianness={}));let M;(P=>{function U(J){return K.Endianness[J]}P.Endianness_toString=U})(M=K.in_Endianness||(K.in_Endianness={}))})(s=V.Decoder||(V.Decoder={}));let c;(M=>{function H(K){return r[K]}M.Result_toString=H})(c=V.in_Result||(V.in_Result={}));let l;(M=>{function H(K){return a[K]}M.Orientation_toString=H})(l=V.in_Orientation||(V.in_Orientation={})),V._zigZagTable=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],V._W1=2841,V._W2=2676,V._W3=2408,V._W5=1609,V._W6=1108,V._W7=565,V._CF4A=-9,V._CF4B=111,V._CF4C=29,V._CF4D=-3,V._CF3A=28,V._CF3B=109,V._CF3C=-9,V._CF3X=104,V._CF3Y=27,V._CF3Z=-3,V._CF2A=139,V._CF2B=-11})(bs||(bs={}));var At;(T=>{function g(){return T._workerURL}T.getWorkerURL=g;function e(N){T._workerURL=N}T.setWorkerURL=e;function t(){return T._imagePrefixURL}T.getImagePrefixURL=t;function n(N){T._imagePrefixURL=N}T.setImagePrefixURL=n;function r(){return T._imageBatchURL}T.getImageBatchURL=r;function o(N){T._imageBatchURL=N}T.setImageBatchURL=o;function i(){return T._videoPrefixURL}T.getVideoPrefixUrl=i;function a(N){T._videoPrefixURL=N}T.setVideoPrefixUrl=a;function s(){return T._deviceInfoByIdentifier}T.getDeviceInfoByIdentifier=s;function c(N){T._deviceInfoByIdentifier=N}T.setDeviceInfoByIdentifier=c;function l(){return T._containerElement}T.getContainerElement=l;function u(N){T._containerElement=N}T.setContainerElement=u;function d(){return T._forceMobileOptimizations}T.forceMobileOptimizations=d;function h(N){let k=te=>{if(!(te in N))throw new Error(`Missing required parameter '${te}'`);return N[te]},j=(te,Y)=>te in N?N[te]:Y;T._workerURL=k("workerURL"),T._deviceInfoByIdentifier=j("deviceInfoByIdentifier",T._deviceInfoByIdentifierDefault),T._containerElement=k("containerElement"),T._forceMobileOptimizations=j("forceMobileOptimizations",!1)}T.initialize=h,T._workerURL=null,T._imagePrefixURL=null,T._imageBatchURL=null,T._videoPrefixURL=null,T._deviceInfoByIdentifierDefault=null,T._deviceInfoByIdentifier=T._deviceInfoByIdentifierDefault,T._containerElement=null,T._forceMobileOptimizations=!1})(At||(At={}));var Ts=(n=>(n[n.BOUNCING=0]="BOUNCING",n[n.CLAMPING=1]="CLAMPING",n[n.DEFAULT=2]="DEFAULT",n))(Ts||{}),vs=class{createBallisticScrollSimulation(e,t,n,r,o,i){return null}applyOverscrollBehavior(e,t,n,r){return t}constructor(){}},Ha=(r=>(r[r.FRICTION=0]="FRICTION",r[r.SPRING=1]="SPRING",r[r.FIXED=2]="FIXED",r[r.CURVE=3]="CURVE",r))(Ha||{}),ia=class{constructor(){this._startTime=0,this._startTime=We.seconds()}endPos(){return new I(this._xSimulation().endPos(),this._ySimulation().endPos())}pos1(){return this.pos2(this.elapsed())}pos2(e){return new I(this._xSimulation().pos(e),this._ySimulation().pos(e))}dPos(e){return new I(this._xSimulation().dPos(e),this._ySimulation().dPos(e))}elapsed(){return We.seconds()-this._startTime}isDone1(){return this.isDone2(this.elapsed())}isOverscrolled(){return!1}isDone2(e){return this._xSimulation().isDone(e)&&this._ySimulation().isDone(e)}xSimulation(e){return this._xSimulation().typeAt(e)}ySimulation(e){return this._ySimulation().typeAt(e)}},gl=class{static withDampingRatio(e,t,n){return new gl(e,t,n*2*Math.sqrt(e*t))}constructor(e,t,n){this.mass=e,this.stiffness=t,this.damping=n}},Ga=gl;Ga.DEFAULT_SPRING=gl.withDampingRatio(.5,100,1.1);var ys=class{constructor(e,t){this.velocity=e,this.distance=t}},np;(e=>{function g(t){return Ts[t]}e.ScrollPhysicsType_toString=g})(np||(np={}));var rp;(e=>{function g(t){return Ha[t]}e.SimulationType_toString=g})(rp||(rp={}));function jc(){return typeof window!="undefined"&&typeof or()=="number"?new ys(1/(.05*or()),1/or()):new ys(1/.05,1)}var Wr=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.ANDROID=1]="ANDROID",i[i.IOS=2]="IOS",i[i.LINUX=3]="LINUX",i[i.OSX=4]="OSX",i[i.WINDOWS=5]="WINDOWS",i))(Wr||{}),tt;(o=>{function g(i){return i==2||i==1}o.OS_isMobile=g;function e(i){switch(i){case 2:case 4:return 0;case 1:case 3:case 5:return 1;default:return 2}}o.OS_scrollPhysicsType=e;function t(){return o.OS__current==0&&(o.OS__current=Q.mac()?4:Q.windows()?5:Q.ios()?2:Q.android()?1:Q.linux()?3:0),o.OS__current}o.OS_current=t;function n(i){return Wr[i]}o.OS_toString=n,o.OS__current=0})(tt||(tt={}));var Jc;(e=>{function g(t,n){let r=Array.from(t);return ie.List_append2(r,Array.from(n)),new Uint8Array(r)}e.concat=g})(Jc||(Jc={}));var op;(e=>{function g(t,n){if(t.byteLength!=n.byteLength)return!1;for(let r=0,o=t.byteLength;r<o;r=r+1)if(t[r]!=n[r])return!1;return!0}e.Uint8Array_equals=g})(op||(op={}));var _l;(e=>{function g(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}e.DataView_new1=g})(_l||(_l={}));var za=class{elapsedSeconds(){return We.seconds()-this._start}reset(){this._start=We.seconds()}constructor(){this._start=We.seconds()}};var ii;(t=>{function g(n){return pako.inflateRaw(n)}t.inflateRaw=g;function e(n){return pako.deflateRaw(n)}t.deflateRaw=e})(ii||(ii={}));var fl;(n=>{class g{constructor(){}}n.Error=g;let r=class{_decode(i){for(this._count=i.length,this._view=_l.DataView_new1(i),(this._readInt()!=r._ID(137,80,78,71)||this._readInt()!=r._ID(13,10,26,10))&&r._fail();this._offset+12<=this._count;){let a=this._offset,s=this._readInt(),c=this._readInt(),l=a+8,u=l+s;switch(a+12+s>this._count&&(console.error("truncated png image"),r._fail()),c){case r._ID(73,72,68,82):{let d=this._readInt(),h=this._readInt(),S=this._readByte(),f=this._readByte(),y=this._readByte(),v=this._readByte(),b=this._readByte(),m=d<=0||h<=0||y!=0||v!=0||b!=0&&b!=1;if(!m)switch(f){case r.COLOR_TYPE_GRAY:{m=S!=1&&S!=2&&S!=4&&S!=8&&S!=16;break}case r.COLOR_TYPE_INDEXED:{m=S!=1&&S!=2&&S!=4&&S!=8;break}case r.COLOR_TYPE_RGB:case r.COLOR_TYPE_GRAY_ALPHA:case r.COLOR_TYPE_RGBA:{m=S!=8&&S!=16;break}default:{m=!0;break}}m&&(console.error("invalid png header"),r._fail()),this._width=d,this._height=h,this._bitDepth=S,this._colorType=f,this._isInterlaced=b==1;break}case r._ID(80,76,84,69):{this._palette=i.subarray(l,u),(s<3||s>256*3||dt.int_remainder(s,3)!=0)&&(console.error("invalid palette in png image"),r._fail());break}case r._ID(73,68,65,84):{this._dataStreamChunks.push(i.subarray(l,u)),this._dataStreamCount=this._dataStreamCount+s;break}case r._ID(116,82,78,83):{this._transparency=i.subarray(l,u);break}case r._ID(73,69,78,68):return n.DEBUG_LOG&&console.log(`png header: ${this._width}x${this._height}, ${this._bitDepth} bits per sample, `+new Map([[r.COLOR_TYPE_GRAY,"gray"],[r.COLOR_TYPE_RGB,"rgb"],[r.COLOR_TYPE_INDEXED,"indexed"],[r.COLOR_TYPE_GRAY_ALPHA,"gray_alpha"],[r.COLOR_TYPE_RGBA,"rgba"]]).get(this._colorType)+(this._isInterlaced?", interlaced":", non_interlaced")),this._decodeImage();default:{n.DEBUG_LOG&&console.warn(`unsupported png chunk '${Bn.string_fromCodePoints([c>>>24,c>>16&255,c>>8&255,c&255])}'`);break}}this._offset=a+s+12}return r._fail(),null}_readInt(){return this._offset=this._offset+4,this._offset>this._count&&(console.error("truncated png image"),r._fail()),this._view.getInt32(this._offset-4)}_readByte(){return this._offset=this._offset+1,this._offset>this._count&&(console.error("truncated png image"),r._fail()),this._view.getUint8(this._offset-1)}_decompressStream(){let i=new Uint8Array(this._dataStreamCount),a=0;for(let c of this._dataStreamChunks)i.set(c,a),a=a+c.length;let s=null;try{s=ii.inflateRaw(i.subarray(2))}catch{console.error("invalid zip stream in png image"),r._fail()}return s}_decodeImage(){(this._width<=0||this._height<=0||this._dataStreamCount==0)&&(console.error("incomplete png image"),r._fail());let i=this._decompressStream(),a=this._colorType==r.COLOR_TYPE_GRAY_ALPHA?2:this._colorType==r.COLOR_TYPE_RGB?3:this._colorType==r.COLOR_TYPE_RGBA?4:1,s=this._bitDepth*a,c=s+7>>3,l=this._width*s+7>>3,u=new Uint8Array(l*this._height),d=0;i.length!=(l+1)*this._height&&(console.error("invalid decompressed png stream"),r._fail());for(let f=0,y=this._height;f<y;f=f+1){let v=f*l,b=v-c,m=v-l,p=m-c,_=i[d];switch(d=d+1,_){case r.FILTER_TYPE_NONE:{u.set(i.subarray(d,d+l),v),d=d+l;break}case r.FILTER_TYPE_SUB:{for(let T=0,N=l;T<N;T=T+1)u[v+T]=i[d]+(T<c?0:u[b+T]),d=d+1;break}case r.FILTER_TYPE_UP:{for(let T=0,N=l;T<N;T=T+1)u[v+T]=i[d]+(f==0?0:u[m+T]),d=d+1;break}case r.FILTER_TYPE_AVERAGE:{for(let T=0,N=l;T<N;T=T+1){let k=T<c?0:u[b+T],j=f==0?0:u[m+T];u[v+T]=i[d]+(k+j>>1),d=d+1}break}case r.FILTER_TYPE_PAETH:{for(let T=0,N=l;T<N;T=T+1){let k=T<c?0:u[b+T],j=f==0?0:u[m+T],te=T<c||f==0?0:u[p+T],Y=k+j-te,_e=Math.abs(Y-k),ce=Math.abs(Y-j),V=Math.abs(Y-te);u[v+T]=i[d]+(_e<=ce&&_e<=V?k:ce<=V?j:te),d=d+1}break}default:{console.error(`invalid png filter type ${_}`),r._fail();break}}}if(this._bitDepth==16){let f=new Uint8Array(u.length>>1);for(let y=0,v=f.length;y<v;y=y+1)f[y]=u[y*2];u=f,s>>=1,c>>=1,l>>=1,this._bitDepth=8}let h=this._width*this._height*4,S=a==4?u:new Uint8Array(h);switch(a){case 1:{let f=0,y=0,v=(1<<s)-1,b=v==1?255:255/v|0,m=this._colorType==r.COLOR_TYPE_INDEXED,p=this._palette,_=p!=null?p.length:0,T=this._transparency,N=T!=null?T.length:0;for(let k=0,j=this._height;k<j;k=k+1){let te=0,Y=0;for(let _e=0,ce=this._width;_e<ce;_e=_e+1){te==0&&(Y=u[f],te=8,f=f+1),te=te-s;let V=Y>>te&v;if(m){let H=V*3;H>_-3&&(console.error(`invalid palette index ${V} in png image`),r._fail()),S[y]=p[H],S[y+1]=p[H+1],S[y+2]=p[H+2]}else V=V*b,S[y]=V,S[y+1]=V,S[y+2]=V;S[y+3]=m&&V<N?T[V]:255,y=y+4}}break}case 2:{for(let f=0,y=0;y<h;f=f+2,y=y+4){let v=u[f];S[y]=v,S[y+1]=v,S[y+2]=v,S[y+3]=u[f+1]}break}case 3:{for(let f=0,y=0;y<h;f=f+3,y=y+4){let v=u[f],b=u[f+1],m=u[f+2];S[y]=v,S[y+1]=b,S[y+2]=m,S[y+3]=255}break}}return new Zt(0,this._width,this._height,S)}static _fail(){throw new g}static _ID(i,a,s,c){return i<<24|a<<16|s<<8|c}static decodeBytes(i){return new r()._decode(i)}constructor(){this._count=0,this._offset=0,this._palette=null,this._transparency=null,this._view=null,this._dataStreamChunks=[],this._dataStreamCount=0,this._width=0,this._height=0,this._bitDepth=0,this._colorType=0,this._isInterlaced=!1}},e=r;e.COLOR_TYPE_GRAY=0,e.COLOR_TYPE_RGB=2,e.COLOR_TYPE_INDEXED=3,e.COLOR_TYPE_GRAY_ALPHA=4,e.COLOR_TYPE_RGBA=6,e.FILTER_TYPE_NONE=0,e.FILTER_TYPE_SUB=1,e.FILTER_TYPE_UP=2,e.FILTER_TYPE_AVERAGE=3,e.FILTER_TYPE_PAETH=4,n.Decoder=e,n.DEBUG_LOG=!1})(fl||(fl={}));var Zc=(n=>(n[n.PENDING=0]="PENDING",n[n.FULFILLED=1]="FULFILLED",n[n.REJECTED=2]="REJECTED",n))(Zc||{}),lo=class{constructor(){this._state=0,this._promise=null,this._resolve=null,this._reject=null,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}realPromise(){return this._promise}then1(e){this.then2(e,null)}then2(e,t){this._promise.then(e,t)}resolve(e){return this._state==0&&(this._state=1,this._resolve(e)),this}reject(e){return this._state==0&&(this._state=2,this._reject(e)),this}state(){return this._state}},Qc=class{constructor(){}},ir=Qc;ir.VOID=new Qc;var ip;(e=>{function g(t){return Zc[t]}e.PromiseState_toString=g})(ip||(ip={}));function Sl(g){Promise.resolve(ir.VOID).then(e=>{g()})}var cp=(r=>(r[r.UNSENT=0]="UNSENT",r[r.SENT=1]="SENT",r[r.CANCELED=2]="CANCELED",r[r.COMPLETE=3]="COMPLETE",r))(cp||{}),Is=(t=>(t[t.STRING=0]="STRING",t[t.BYTES=1]="BYTES",t))(Is||{}),bl=class{constructor(e){this.status=e}},Kr=class{state(){return this._state}get(){return this.send3("GET")}put(){return this.send3("PUT")}head(){return this.send3("HEAD")}setProgressCallback(e){this._progressCallback=e}header(e,t){return this._headers.set(e,t),this}format(e){return this._format=e,this}send1(e,t,n){if(2==0)return this.send3(e);if(mi==3){this._blob=t;for(let r of Array.from(n.keys()))this._headers.set(r,n.get(r));return this.send3(e)}else throw new Error("unimplemented")}send2(e,t){if(2==0)return this.send3(e);if(mi==3)return this._blob=t,this.send3(e);throw new Error("unimplemented")}send3(e){if(2==0)return new Promise((t,n)=>{if(lp==null){n(new bl(0));return}let r=lp(this._url);if(r==200){let o=new $c;o.status=200,t(o)}else n(new bl(r))});if(mi==3){this._xhr.open(e,this._url);let t=null,n=null,r=new Promise((o,i)=>{t=o,n=i});r.then(null,o=>{this.cancel()});for(let o of Array.from(this._headers.keys()))this._xhr.setRequestHeader(o,this._headers.get(o));switch(this._format){case 1:{this._xhr.responseType="arraybuffer";break}}return this._xhr.onload=()=>{if(this._state==2)return;let o=new $c;switch(o.status=this._xhr.status,o.contentType=this._xhr.getResponseHeader("Content-Type"),this._format){case 0:{o.text=this._xhr.response;break}case 1:{o.bytes=new Uint8Array(this._xhr.response);break}}t(o)},this._xhr.onprogress=o=>{this._state!=2&&this._progressCallback!=null&&o.lengthComputable&&this._progressCallback(o.loaded/o.total)},this._xhr.onloadend=()=>{n(new bl(this._xhr.status))},this._formData!=null?this._xhr.send(this._formData):this._xhr.send(this._blob),this._state=1,r}else throw new Error("unimplemented")}cancel(){if(2!=0)if(mi==3)this._state==1&&this._xhr.abort(),(this._state==0||this._state==1)&&(this._state=2);else throw new Error("unimplemented")}constructor(e){this._url=e,this._method=null,this._headers=new Map,this._state=0,this._format=0,this._progressCallback=null,this._xhr=new XMLHttpRequest,this._formData=null,this._blob=null}},$c=class{mimeType(){let e=this.contentType!=null?this.contentType.indexOf(";"):-1;return e!=-1?this.contentType.slice(0,e):this.contentType}wasSuccessful(){return this.status>=200&&this.status<=299}constructor(){this.status=0,this.contentType=null,this.text=null,this.bytes=null}},ap;(e=>{function g(t){return cp[t]}e.HTTPRequestState_toString=g})(ap||(ap={}));var sp;(e=>{function g(t){return Is[t]}e.HTTPRequestFormat_toString=g})(sp||(sp={}));var lp=null;var ki=class{constructor(e){this._worker=null,this._queue=[],this._workerFailedToDownload=!1,this.onmessage=null,this.mainThreadFallback=null;let t=()=>{this._workerFailedToDownload=!0,this.mainThreadFallback!=null&&console.warn(`failed to download worker code from ${e}, falling back to running it on the main thread (this is slower)`);for(let n of this._queue)this.postMessage2(n.message,n.transfer)};new Kr(e).get().then(n=>{if(n.wasSuccessful()){try{this._worker=new Worker(URL.createObjectURL(new Blob([n.text])))}catch{t();return}this._worker.onmessage=r=>{this.onmessage!=null&&this.onmessage(r)};for(let r of this._queue)this.postMessage2(r.message,r.transfer)}else t()},n=>{t()})}postMessage1(e){this.postMessage2(e,null)}postMessage2(e,t){this._workerFailedToDownload?this.mainThreadFallback!=null&&this.onmessage!=null&&setTimeout(()=>{this.onmessage({data:this.mainThreadFallback(e)})},0):this._worker==null?this._queue.push(new ki.Item(e,t)):t!=null?this._worker.postMessage(e,t):this._worker.postMessage(e)}};(e=>{class g{constructor(n,r){this.message=n,this.transfer=r}}e.Item=g})(ki||(ki={}));var $e=class{constructor(){if(arguments[0]==0){let[,e,t,n]=arguments;this.width=0,this.height=0,this.pixels=null,this.gif=null,this.width=e,this.height=t,this.pixels=new $e.Pixels(0,n)}else if(arguments[0]==1){let[,e]=arguments;this.width=0,this.height=0,this.pixels=null,this.gif=null,this.width=e.width,this.height=e.height,this.pixels=new $e.Pixels(1,e)}else if(arguments[0]==2){let[,e,t,n]=arguments;this.width=0,this.height=0,this.pixels=null,this.gif=null,this.width=e,this.height=t,this.pixels=new $e.Pixels(2,n)}else if(arguments[0]==3){let[,e,t,n]=arguments;this.width=0,this.height=0,this.pixels=null,this.gif=null,this.width=e,this.height=t,this.pixels=null,this.gif=n}}static isPowerOf2(e){return e!=0&&(e&e-1)==0}static nextPowerOf2(e){return e=e-1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e=e+1,e}isGIF(){return this.gif!=null}pixelAtIndex(e,t){if(e<0||e>=this.width||t<0||t>=this.height)return E.TRANSPARENT;if(this.pixels.array!=null){let n=this.pixels.array,r=t*this.width*4+e*4,o=n[r],i=n[r+1],a=n[r+2],s=n[r+3];return E.new2(o,i,a,s)}else{if(this.pixels.img!=null)throw new Error("pixelAtIndex not implemented for image-based buffers");{let n=Qr.HTMLCanvasElement_getContext2D(this.pixels.canvas).getImageData(e,t,1,1).data;return E.new2(n[0],n[1],n[2],n[3])}}}expandToPowerOfTwo(){if(this.isGIF())return console.warn("ImageBuffer#expandToPowerOfTwo: unimplemented for GIF resources"),this;if(this.pixels.array!=null){let e=this.pixels.array,t=$e.nextPowerOf2(this.width),n=$e.nextPowerOf2(this.height),r=new Uint8Array(t*n*4);for(let o=0;o<t;o=o+1)for(let i=0;i<n;i=i+1)for(let a=0;a<4;a=a+1)r[a+(o+i*t)*4]=o<this.width&&i<this.height?e[a+(o+i*this.width)*4]:0;return new $e(0,t,n,r)}else{if(this.pixels.img!=null)throw new Error("expandToPowerOfTwo not implemented for image-based buffers");{let e=document.createElement("canvas");return e.width=$e.nextPowerOf2(this.width),e.height=$e.nextPowerOf2(this.height),Qr.HTMLCanvasElement_getContext2D(e).drawImage(this.pixels.canvas,0,0,this.pixels.canvas.width,this.pixels.canvas.height),new $e(1,e)}}}static initialize(){var t;let e;$e._worker==null&&($e._worker=new ki((t=At.getWorkerURL())!=null?t:"imagedecoder.js"),$e._worker.mainThreadFallback=n=>$e.handleWorkerEvent(n),$e._worker.onmessage=n=>{let r=n.data;if(r==null){console.log("No data received from image decode worker");return}let o=Ht.IntMap_get($e._pendingRequests,r.id,null);if(o==null)return;if($e._pendingRequests.delete(r.id),r.width>0&&r.height>0&&r.pixels!=null){let d=new $e(0,r.width,r.height,r.pixels);$e.dimensionsNeedDownsizing(r.width,r.height,$e.computeMaxRes())&&(console.log("downsampling after worker"),d=$e._downsampleBilinear(d,$e.getMaxRes())),console.log(`image decode succeeded, got ${d.width}x${d.height} image`),o.resolve(d);return}else if(r.width>0&&r.height>0&&r.gif!=null){let d=new $e(3,r.width,r.height,r.gif);console.log(`GIF decode succeeded, got ${d.width}x${d.height} image`),o.resolve(d);return}console.log("image decode failed, falling back to the browser's image decoder instead");let i=Br.HTMLDocument_createElementImage(document),a=ml.readFromJPEG(o.bytes),s=a!=null?Ss.ImageOrientation_rotationDegrees(a.value):0,c=a!=null?Ss.ImageOrientation_shouldFlip(a.value):!1,l=URL.createObjectURL(new Blob([o.bytes]));i.onerror=()=>{URL.revokeObjectURL(l),o.reject()};let u=()=>{URL.revokeObjectURL(l);let d=$e._context!=null?$e._context:$e._context=Qr.HTMLCanvasElement_getContext2D(Br.HTMLDocument_createElementCanvas(document)),h=d.canvas;if(i.width>0&&i.height>0){console.log(`image decode fallback succeeded, got ${i.width}x${i.height} image`);let S=s==0||s==180?i.width:i.height,f=s==0||s==180?i.height:i.width;h.width=S,h.height=f,d.save(),c&&(d.translate(h.width,0),d.scale(-1,1)),s==90?(d.translate(S,0),d.rotate(s*Pe.Math_PI()/180)):s==180?(d.translate(S/2|0,f/2|0),d.rotate(s*Pe.Math_PI()/180),d.translate(-S/2|0,-f/2|0)):s==270&&(d.translate(0,f),d.rotate(s*Pe.Math_PI()/180)),d.drawImage(i,0,0,i.width,i.height),d.restore();let y=new $e(0,S,f,new Uint8Array(d.getImageData(0,0,S,f).data.buffer));$e.dimensionsNeedDownsizing(S,f,$e.computeMaxRes())&&(y=$e._downsampleBilinear(y,$e.getMaxRes())),o.resolve(y);return}console.log("image decode fallback failed, giving up"),o.reject()};i.onload=()=>{Q.htmlImageDecodeMethodIsPresent()?i.decode().then(d=>{u()},d=>{Un.trackImageDecodeFailure("Slow decode fallback decode"),u()}):u()},i.src=l})}static setRamInUse(e){$e._ramInUse=e}static setVRamInUse(e){$e._vramInUse=e}static setMaxRes(e){$e._maxRes=e}static getMaxRes(){return $e._maxRes}static computeMaxRes(){if(!(tt.OS_isMobile(tt.OS_current())||tt.OS_current()==4&&navigator.maxTouchPoints>0||At.forceMobileOptimizations()))return $e._maxRes;let e=2048;return $e._vramInUse>200||$e._ramInUse>200?e=256:$e._vramInUse>150||$e._ramInUse>150?e=512:($e._vramInUse>100||$e._ramInUse>100)&&(e=1024),e!=$e._maxRes&&($e._maxRes=e),e}static decodeImageBuffer(e,t){return e=new Uint8Array(e),new Promise((n,r)=>{$e.initialize(),$e._worker.postMessage1(new up($e._nextID,e,$e.computeMaxRes(),t)),$e._pendingRequests.set($e._nextID,new $e.PendingRequest(e,n,()=>{r(new ir)})),$e._nextID=$e._nextID+1})}static dimensionsNeedDownsizing(e,t,n){return n<=0||e<=$e._maxRes&&t<=$e._maxRes&&(e<13||t<13)||e*t<n*n*.5?!1:e>n||t>n}static handleWorkerEvent(e){var r;let t,n=null;if(e.isGIF)n=ai.Decoder.decodeBytes(e.bytes);else{try{n=fl.Decoder.decodeBytes(e.bytes)}catch{}n==null&&(n=$e._decodeJPEG(e.bytes)),n!=null&&$e.dimensionsNeedDownsizing(n.width,n.height,e.maxRes)&&(n=$e._downsampleBilinear(n,e.maxRes))}return new yl(e.id,n!=null?n.width:0,n!=null?n.height:0,n!=null?(r=n.pixels)==null?void 0:r.array:null,n!=null?n.gif:null)}static _decodeJPEG(e){let t=new bs.Decoder;if(t.decodeBytes(e)!=bs.Result.OK)return null;let n=t.width(),r=t.height(),o=t.rgb(),i=new Uint8Array(n*r*4),a=0,s=0;for(let c=0,l=n*r;c<l;c=c+1)i[s]=o[a],i[s+1]=o[a+1],i[s+2]=o[a+2],i[s+3]=255,a=a+3,s=s+4;return new $e(0,n,r,i)}static redIndex(e,t,n){return(t*n+e)*4}static _downsampleBilinear(e,t){let n=Math.max(e.width,e.height);if(n<=0||t<=0)return e;let r=t/n,o=1/r,i=e.width*r|0,a=e.height*r|0,s=new Uint8Array(i*a*4),c=e.pixels.array;for(let l=0;l<a;l=l+1){let u=o*l,d=u-(u|0),h=l*i*4;for(let S=0;S<i;S=S+1){let f=o*S,y=f-(f|0),v=$e.redIndex(S*o|0,l*o|0,e.width),b=c[v],m=c[v+1],p=c[v+2],_=c[v+3];S<i-1&&(v=$e.redIndex((S*o|0)+1,l*o|0,e.width));let T=c[v],N=c[v+1],k=c[v+2],j=c[v+3];l<a-1?v=$e.redIndex(S*o|0,(l*o|0)+1,e.width):v=$e.redIndex(S*o|0,l*o|0,e.width);let te=c[v],Y=c[v+1],_e=c[v+2],ce=c[v+3];l<a-1&&S<i-1&&(v=$e.redIndex((S*o|0)+1,(l*o|0)+1,e.width));let V=c[v],H=c[v+1],M=c[v+2],K=c[v+3],U=1-y,P=1-d;s[h]=(b*U+T*y)*P+(te*U+V*y)*d|0,s[h+1]=(m*U+N*y)*P+(Y*U+H*y)*d|0,s[h+2]=(p*U+k*y)*P+(_e*U+M*y)*d|0,s[h+3]=(_*U+j*y)*P+(ce*U+K*y)*d|0,h=h+4}}return new $e(0,i,a,s)}},Zt=$e;Zt._pendingRequests=new Map,Zt._worker=null,Zt._nextID=0,Zt._context=null,Zt._handleResponse=null,Zt._ramInUse=0,Zt._vramInUse=0,Zt._maxRes=4096;(t=>{class g{constructor(){if(arguments[0]==0){let[,r]=arguments;this.array=null,this.canvas=null,this.img=null,this.array=r}else if(arguments[0]==1){let[,r]=arguments;this.array=null,this.canvas=null,this.img=null,this.canvas=r}else if(arguments[0]==2){let[,r]=arguments;this.array=null,this.canvas=null,this.img=null,this.img=r}}}t.Pixels=g;class e{constructor(r,o,i){this.bytes=r,this.resolve=o,this.reject=i}}t.PendingRequest=e})(Zt||(Zt={}));var up=class{constructor(e,t,n,r){this.id=0,this.bytes=null,this.maxRes=0,this.isGIF=!1,this.id=e,this.bytes=t,this.maxRes=n,this.isGIF=r==0}},yl=class{static empty(e){return new yl(e,0,0,null,null)}constructor(e,t,n,r,o){this.id=e,this.width=t,this.height=n,this.pixels=r,this.gif=o}},pp=(r=>(r[r.UNLOADED=0]="UNLOADED",r[r.LOADING=1]="LOADING",r[r.LOADED=2]="LOADED",r[r.FAILED=3]="FAILED",r))(pp||{}),dp;(e=>{function g(t){return pp[t]}e.ImageWorkerState_toString=g})(dp||(dp={}));var hp=class{constructor(e){this._byteLength=0,this._cachedPx=null,this._cachedFrameIdx=null,this._byteLength=e,this._cachedPx=new Uint8Array(this._byteLength)}save(e,t){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(this._cachedPx.set(t),this._cachedFrameIdx=new fe(e))}saveEmpty(e){this._cachedFrameIdx!=null&&this._cachedFrameIdx.value==e||(e!=0&&ze("Saving empty frame for idx \u2260 0"),this._cachedPx.fill(0),this._cachedFrameIdx=new fe(e))}getLastNonDisposedFrame(){return this._cachedFrameIdx==null&&ze("Attempting to get cached non-disposed frame while cache index has not been set"),this._cachedPx}},Uo=class{constructor(e){this._width=0,this._height=0,this._frameCount=0,this._loopCount=0,this._currentLoop=0,this._frameByteLength=0,this._buf=null,this._frameInfos=null,this._startedPlayingMs=-1,this._currentFrame=-1,this._desiredFrameStartTimeMs=0,this._currentFramePx=null,this._prevDisposal=0,this._needPreviousFrame=!1,this._previousFrameCache=null,this._width=e.width,this._height=e.height,this._frameCount=e.frameCount,this._loopCount=e.loopCount,this._frameByteLength=this._width*this._height*4,this._buf=e.buf,this._frameInfos=e.frameInfos,this._currentFramePx=new Uint8Array(this._frameByteLength),this._needPreviousFrame=e.needLastNonDisposed,this._needPreviousFrame&&(this._previousFrameCache=new hp(this._frameByteLength))}width(){return this._width}height(){return this._height}frameCount(){return this._frameCount}loopCount(){return this._loopCount}loopsForever(){return this._loopCount==0}frameInfo(e){return(e<0||e>=this._frameInfos.length)&&Uo._fail("Frame index out of range."),this._frameInfos[e]}_shouldAdvance(){if(!this.loopsForever()&&this._currentFrame==this._frameCount-1&&(this._loopCount==-1||this._loopCount==this._currentLoop))return Uo.ShouldAdvance.NO;if(this._startedPlayingMs<0)return this._startedPlayingMs=We.milliseconds(),Uo.ShouldAdvance.ONCE;let e=this.loopsForever()?Uo.ShouldAdvance.UNTIL_CAUGHT_UP:Uo.ShouldAdvance.ONCE;return We.milliseconds()-this._startedPlayingMs>=this._desiredFrameStartTimeMs?e:Uo.ShouldAdvance.NO}_advanceFrame(){this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=dt.int_remainder(this._currentFrame,this._frameCount));let e=this.frameInfo(this._currentFrame).delay*10;return e<=10&&(e=100),this._desiredFrameStartTimeMs+=e,this._blitFrame()}nextFrameIfNecessary(){let e=this._shouldAdvance();if(e==Uo.ShouldAdvance.NO)return null;let t=We.milliseconds(),n=this._advanceFrame();if(e==Uo.ShouldAdvance.UNTIL_CAUGHT_UP)for(;this._shouldAdvance()!=Uo.ShouldAdvance.NO;){if(We.milliseconds()-t>=16){this._desiredFrameStartTimeMs=We.milliseconds()+this.frameInfo(this._currentFrame).delay*10-this._startedPlayingMs;break}n=this._advanceFrame()}return n}nextFrameForTesting(){return this._currentFrame=this._currentFrame+1,this._currentFrame>=this._frameCount&&(this._currentLoop=this._currentLoop+1,this._currentFrame=dt.int_remainder(this._currentFrame,this._frameCount)),this._blitFrame()}restart(){this._startedPlayingMs=-1,this._desiredFrameStartTimeMs=0,this._currentFrame=-1,this._currentLoop=0}toString(){let e=r=>"["+r.map(o=>`${o}`).join(", ")+"]",t=this._loopCount==0?"infinite":`${this._loopCount}`,n=this._frameInfos.map(r=>r.disposal);return ie.List_removeDuplicates(n),`GIF
 size: ${this._width} x ${this._height}
 loopCount: ${t}
 frameCount: ${this._frameCount}
 disposals: ${e(n)}`}_forEachRowIndexPairInSubrect(e,t){for(let n=e.y,r=e.y+e.height;n<r;n=n+1){let o=this.width()*4*n;t(o+e.x*4,o+(e.x+e.width)*4)}}_clearLastFrameToBackground(){let e=this._currentFrame>0?this._frameInfos[this._currentFrame-1]:null;e==null||e.width==this.width()&&e.height==this.height()?this._currentFramePx.fill(0):this._forEachRowIndexPairInSubrect(e,(t,n)=>{this._currentFramePx.subarray(t,n).fill(0)})}_blitFrame(){let e=this._frameInfos[this._currentFrame];if(this._currentFrame==0)this._clearLastFrameToBackground();else switch(this._prevDisposal){case 0:case 1:break;case 2:{this._clearLastFrameToBackground();break}case 3:{let S=this._currentFrame>0?this._currentFrame-1:this._frameCount-1,f=this._frameInfos[S],y=this._previousFrameCache.getLastNonDisposedFrame();f==null||y==null?this._clearLastFrameToBackground():f.width==this.width()&&f.height==this.height()?this._currentFramePx.set(y):this._forEachRowIndexPairInSubrect(f,(v,b)=>{let m=this._currentFramePx.subarray(v,b),p=y.subarray(v,b);m.set(p)});break}default:{console.error(`Disposal flag ${this._prevDisposal} not recognized`);break}}let t=e.width*e.height,n=new Uint8Array(t);this._LZWOutputIndexStream(this._buf,e.dataOffset,n,t);let r=e.paletteOffset,o=e.transparentIndex,i=e.width,a=this.width()-i,s=i,c=(e.y*this.width()+e.x)*4,l=((e.y+e.height)*this.width()-(this.width()-e.width-e.x))*4,u=c,d=a*4;e.interlaced&&(d=d+this.width()*4*7);let h=8;for(let S=0,f=n.length;S<f;S=S+1){let y=n[S];if(s==0&&(u=u+d,s=i,u>=l&&(d=a*4+this.width()*4*(h-1),u=c+(i+a)*(h<<1),h>>=1)),y==o)u=u+4;else{let v=this._buf[r+y*3],b=this._buf[r+y*3+1],m=this._buf[r+y*3+2];this._currentFramePx[(u=u+1)+-1]=v,this._currentFramePx[(u=u+1)+-1]=b,this._currentFramePx[(u=u+1)+-1]=m,this._currentFramePx[(u=u+1)+-1]=255}s=s-1}return this._prevDisposal=e.disposal,this._needPreviousFrame&&(this._prevDisposal<2?this._previousFrameCache.save(this._currentFrame,this._currentFramePx):this._currentFrame==0&&this._previousFrameCache.saveEmpty(this._currentFrame)),this._currentFramePx}_LZWOutputIndexStream(e,t,n,r){let o=e[(t=t+1)+-1],i=1<<o,a=i+1,s=a+1,c=o+1,l=(1<<c)-1,u=0,d=0,h=0,S=e[(t=t+1)+-1],f=new Int32Array(4096),y=-1;for(;;){for(;u<16&&S!=0;)d|=e[(t=t+1)+-1]<<u,u=u+8,S==1?S=e[(t=t+1)+-1]:S=S-1;if(u<c)break;let v=d&l;if(d>>=c,u=u-c,v==i){s=a+1,c=o+1,l=(1<<c)-1,y=-1;continue}else if(v==a)break;let b=v<s?v:y,m=0,p=b;for(;p>i;)p=f[p]>>8,m=m+1;let _=p;if(h+m+(b!=v?1:0)>r){console.warn("Warning, gif stream longer than expected.");return}n[(h=h+1)+-1]=_,h=h+m;let N=h;for(b!=v&&(n[(h=h+1)+-1]=_),p=b;(m=m-1)- -1!=0;)p=f[p],n[N=N-1]=p&255,p>>=8;y!=-1&&s<4096&&(f[(s=s+1)+-1]=y<<8|_,s>=l+1&&c<12&&(c=c+1,l=l<<1|1)),y=v}if(h!=r){console.warn("Warning, gif stream shorter than expected.");return}}decodedSize(){return this._buf.length}static _fail(e){throw new Error(e)}},ai=Uo;ai.DEBUG_LOG=!1;(o=>{let g;(c=>(c[c.ONCE=0]="ONCE",c[c.UNTIL_CAUGHT_UP=1]="UNTIL_CAUGHT_UP",c[c.NO=2]="NO"))(g=o.ShouldAdvance||(o.ShouldAdvance={}));class e{constructor(a,s,c,l,u,d,h){this.width=a,this.height=s,this.frameCount=c,this.loopCount=l,this.buf=u,this.frameInfos=d,this.needLastNonDisposed=h}}o.DecodeResult=e;class t{toString(){return`Frame [x=${this.x}, y=${this.y}] [w=${this.width}, h=${this.height}] [delay=${this.delay}] [localPalette=${this.hasLocalPalette}] [interlaced=${this.interlaced}]`}constructor(a,s,c,l,u,d,h,S,f,y,v,b,m){this.x=a,this.y=s,this.width=c,this.height=l,this.hasLocalPalette=u,this.paletteOffset=d,this.paletteSize=h,this.dataOffset=S,this.dataLength=f,this.transparentIndex=y,this.interlaced=v,this.delay=b,this.disposal=m}}o.Frame=t;class n{_decode(a){let s=0;(a[(s=s+1)+-1]!=71||a[(s=s+1)+-1]!=73||a[(s=s+1)+-1]!=70||a[(s=s+1)+-1]!=56||(a[(s=s+1)+-1]+1&253)!=56||a[(s=s+1)+-1]!=97)&&o._fail("Invalid GIF 87a/89a header.");let c=a[(s=s+1)+-1]|a[(s=s+1)+-1]<<8,l=a[(s=s+1)+-1]|a[(s=s+1)+-1]<<8,u=a[(s=s+1)+-1],d=!!(u>>7),h=u&7,S=1<<h+1;s=s+1,s=s+1;let f=0,y=0;d&&(f=s,y=S,s=s+S*3);let v=!0,b=[],m=!1,p=0,_=256,T=0,N=-1,k=!0;e:for(;v&&s<a.length;)switch(a[(s=s+1)+-1]){case 33:{switch(a[(s=s+1)+-1]){case 255:{if(a[s]!=11||a[s+1]==78&&a[s+2]==69&&a[s+3]==84&&a[s+4]==83&&a[s+5]==67&&a[s+6]==65&&a[s+7]==80&&a[s+8]==69&&a[s+9]==50&&a[s+10]==46&&a[s+11]==48&&a[s+12]==3&&a[s+13]==1&&a[s+16]==0)s=s+14,N=a[(s=s+1)+-1]|a[(s=s+1)+-1]<<8,s=s+1;else for(s=s+12;;){let j=a[(s=s+1)+-1];if(j>=0||o._fail("Invalid block size"),j==0)break;s=s+j}break}case 249:{(a[(s=s+1)+-1]!=4||a[s+4]!=0)&&o._fail("Invalid graphics extension block.");let j=a[(s=s+1)+-1];p=a[(s=s+1)+-1]|a[(s=s+1)+-1]<<8,_=a[(s=s+1)+-1],(j&1)==0&&(_=256),T=j>>2&7,!m&&T==3&&(m=!0),(j>>1&1)==1,s=s+1;break}case 254:case 1:{for(;;){let j=a[(s=s+1)+-1];if(j>=0||o._fail("Invalid block size"),j==0)break;s=s+j}break}default:{let j=a[s-1].toString(16);o._fail(`Unknown graphic control label: 0x${j}`);break}}break}case 44:{let j=a[(s=s+1)+-1]|a[(s=s+1)+-1]<<8,te=a[(s=s+1)+-1]|a[(s=s+1)+-1]<<8,Y=a[(s=s+1)+-1]|a[(s=s+1)+-1]<<8,_e=a[(s=s+1)+-1]|a[(s=s+1)+-1]<<8,ce=a[(s=s+1)+-1],V=!!(ce>>7),H=ce>>6&1,M=ce&7,K=1<<M+1,U=f,P=y,J=!1;V&&(J=!0,U=s,P=K,s=s+K*3);let z=s,O=!1;for(s=s+1;;){let G=a[(s=s+1)+-1];if(G===void 0){O=!0;break}if(G>=0||o._fail("Invalid block size"),G==0)break;s=s+G}O||b.push(new o.Frame(j,te,Y,_e,J,U,P,z,s-z,_,!!H,p,T)),(Y==c&&_e==l||!J||p>0)&&(k=!1);break}case 59:{v=!1;break e}default:{let j=a[s-1].toString(16);o._fail(`Unknown gif block: 0x${j}`);break}}if(k){let j="May have encountered multi-image/single-canvas GIF";j+=`
  GIF metadata: [${c} x ${l}], loopCount=${N}, disposal=${T}`;for(let te of b)j+=`
    ${te}`;console.warn(j)}return new o.DecodeResult(c,l,b.length,N,a,b,m)}static decodeBytes(a){{let s=new o.Decoder()._decode(a);return new Zt(3,s.width,s.height,s)}}constructor(){}}o.Decoder=n;let r;(a=>{function i(s){return o.ShouldAdvance[s]}a.ShouldAdvance_toString=i})(r=o.in_ShouldAdvance||(o.in_ShouldAdvance={}))})(ai||(ai={}));var As=(r=>(r[r.NONE=0]="NONE",r[r.FETCHING=1]="FETCHING",r[r.DECODED=2]="DECODED",r[r.FAILED=3]="FAILED",r))(As||{}),Tl=(t=>(t[t.CANVAS_ONLY=0]="CANVAS_ONLY",t[t.ANY=1]="ANY",t))(Tl||{}),vl=(n=>(n[n.FETCH=0]="FETCH",n[n.DECODE=1]="DECODE",n[n.ABORT=2]="ABORT",n))(vl||{}),qr=class{width(){return this.texture()!=null?this.texture().width():this._decodedData!=null?this._decodedData.width:0}height(){return this.texture()!=null?this.texture().height():this._decodedData!=null?this._decodedData.height:0}constructor(e,t,n,r){this._compressedData=null,this._url=null,this._downloadUrl=null,this._hash=null,this._allowDownscaling=!0,this._imageType=1,this._gif=null,this._fetchAndDecodePromise=null,this._decodedData=null,this._texture=null,this._url=e,this._downloadUrl=e,this._imageType=t,this._hash=n,this._allowDownscaling=r,n!=null&&!Rr&&At.getImageBatchURL()!=null&&fp(n)}primeWithCompressedData(e){this._compressedData=e,this._downloadUrl=URL.createObjectURL(new Blob([this._compressedData]))}imageType(){return this._imageType}isGIF(){return this._imageType==0}gif(){return this._gif}url(){return this._url}hash(){return this._hash}state(){return this.isDecoded()?2:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==2?3:this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.state()==0?1:0}loadDidFail(){return this.state()==3}_fetchImageBytesForSlowDecode(){let e=new lo;return this._compressedData!=null?e.resolve(this._compressedData):new Kr(this._downloadUrl).format(1).get().then(t=>{t.wasSuccessful()?e.resolve(t.bytes):(console.error(`failed to fetch image '${this}'`),e.reject(0))},t=>{e.reject(0)}),e}decodedData(){return this._decodedData}texture(){return this._texture}setTexture(e){this._texture=e}isDecoded(){return this._gif!=null||this._decodedData!=null||this._texture!=null}fetchAndDecode(e,t,n){if(this._decodedData!=null){t(this._decodedData);return}let r=this._fetchAndDecodePromise!=null;r||(this._fetchAndDecodePromise=new lo),this._fetchAndDecodePromise.then2(t,n),!r&&(this._hash==null||At.getImageBatchURL()==null?this._fetchAndDecode(e):fp(this._hash).then2(o=>{this._fetchAndDecodePromise!=null&&(this._downloadUrl=o,this._fetchAndDecode(e))},o=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(o)}))}_fetchAndDecode(e){this._canUseFastFetchAndDecode()?this._fastFetchAndDecode(e):this._slowFetchAndDecode()}_canUseFastFetchAndDecode(){return qr.browserSupportsFastImageDecoding()&&this._imageType==1}_fetchHTMLImageObject(){let e=new lo,t=Br.HTMLDocument_createElementImage(document);return t.crossOrigin="anonymous",t.src=this._downloadUrl,t.onload=()=>{e.resolve(t)},t.onerror=()=>{e.reject(0)},e}_fastFetchAndDecode(e){this._fetchHTMLImageObject().then2(t=>{this._fetchAndDecodePromise!=null&&t.decode().then(n=>{if(this._fetchAndDecodePromise==null)return;if(e!=0){this._handleDecodeSuccess(new Zt(2,t.naturalWidth,t.naturalHeight,t));return}let r=document.createElement("canvas");if(!(this._allowDownscaling&&(tt.OS_isMobile(tt.OS_current())||tt.OS_current()==4&&navigator.maxTouchPoints>0||At.forceMobileOptimizations())))r.width=t.naturalWidth,r.height=t.naturalHeight;else{let a=Math.max(t.naturalWidth,t.naturalHeight),c=Math.min(2048,a)/a;r.width=Math.round(t.naturalWidth*c)|0,r.height=Math.round(t.naturalHeight*c)|0}let i=Qr.HTMLCanvasElement_getContext2D(r);i==null?(qr.trackImageDecodeFailure("Canvas context creation failed"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(1)):(i.drawImage(t,0,0,r.width,r.height),this._handleDecodeSuccess(new Zt(1,r)))},n=>{qr.trackImageDecodeFailure("Image.decode"),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(1)})},t=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(0)})}_handleDecodeSuccess(e){this._fetchAndDecodePromise!=null&&(this._decodedData=e,this._imageType==0?(this._gif=new ai(e.gif),Zt.setRamInUse(Rn.incrementInReleaseBuilds("Decoded image data in RAM (MB)",1*this._gif.decodedSize()/(1024*1024)))):Zt.setRamInUse(Rn.incrementInReleaseBuilds("Decoded image data in RAM (MB)",1*e.width*e.height*4/(1024*1024))),this._fetchAndDecodePromise.resolve(e),Rn.increment("# Decoded images",1))}_slowFetchAndDecode(){this._fetchImageBytesForSlowDecode().then2(e=>{this._fetchAndDecodePromise!=null&&Zt.decodeImageBuffer(e,this._imageType).then(t=>{this._handleDecodeSuccess(t)},t=>{qr.trackImageDecodeFailure("unknown"),console.error(`failed to load image '${this}'`),this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(1)})},e=>{this._fetchAndDecodePromise!=null&&this._fetchAndDecodePromise.reject(e)})}freeMemoryForDecodedData(){let e=!1;return this._decodedData!=null&&(Rn.increment("# Decoded images",-1),Zt.setRamInUse(Rn.incrementInReleaseBuilds("Decoded image data in RAM (MB)",-1*this.width()*this.height()*4/(1024*1024))),this._decodedData=null,e=!0),e}freeMemoryForDecodedDataAndTexture(){let e=!1;return this.freeMemoryForDecodedData(),this._gif!=null&&(Zt.setRamInUse(Rn.incrementInReleaseBuilds("Decoded image data in RAM (MB)",-1*this._gif.decodedSize()/(1024*1024))),this._gif=null,e=!0),this.texture()!=null&&(this.texture()._delete(),this.setTexture(null),e=!0),this._fetchAndDecodePromise!=null&&(this._fetchAndDecodePromise.reject(2),this._fetchAndDecodePromise=null,e=!0),e}objectHash(){return`ImageResourceImpl(${this._url}, ${gi[this._imageType]})`}toString(){return`ImageResourceImpl(${this._url}, ${gi[this._imageType]})`}static browserSupportsFastImageDecoding(){return(Q.chrome()&&Q.isBrowserVersionAtLeast("81")||Q.firefox()&&Q.isBrowserVersionAtLeast("77")||Q.safari()&&!Q.ios()&&Q.isBrowserVersionAtLeast("13.1")||Q.safari()&&Q.ios()&&Q.isBrowserVersionAtLeast("13.4")||Q.safari()&&Q.ios()&&Q.isOSVersionAtLeast("13.4.1"))&&Q.htmlImageDecodeMethodIsPresent()}static getEmojiImageUrl(e){let t=e.map(i=>i.toString(16)).join("-"),n=Q.getFeatureFlags().fontIndex220528&&Q.getFeatureFlags().fontIndexEmoji,r=Q.getFeatureFlags().fontIndexEmojiLowRes;return(n?r?"https://static.figma.com/emoji/4/64/":"https://static.figma.com/emoji/4/160/":"https://static.figma.com/emoji/1/64/")+t+".png"}static createEmojiImage1(e){let t=e.map(n=>n.toString(16)).join("-");return qr.createEmojiImage2(t)}static createEmojiImage2(e){let t=Q.getFeatureFlags().fontIndex220528&&Q.getFeatureFlags().fontIndexEmoji,n=Q.getFeatureFlags().fontIndexEmojiLowRes,o=(t?n?"https://static.figma.com/emoji/4/64/":"https://static.figma.com/emoji/4/160/":"https://static.figma.com/emoji/1/64/")+e+".png";return new qr(o,1,null,!0)}static createDeviceImage(e){let t=e.url,n=kr().INITIAL_OPTIONS,r=n?n.cluster_name:"missing-cluster",o=t+`?cachebreaker=${r}`;return new qr(o,1,null,!1)}static createImage(e,t,n){let r=qr.bytesToHex(e),o=At.getImagePrefixURL(),a=`${o.endsWith("/")?o:o+"/"}${r}`,s=new qr(a,n,r,!0);return t!=null&&s.primeWithCompressedData(t),s}static bytesToHex(e){let t="";for(let n=0,r=e.length;n<r;n=n+1)t+=(e[n]|256).toString(16).slice(-2);return t}static hexToBytes(e){let t=[];for(let n=0;n<e.length;n=n+2)t.push(parseInt(e.substr(n,2),16));return new Uint8Array(t)}static trackImageDecodeFailure(e){qr.numDecodeFailuresLogged>=qr.LOG_MAX_DECODE_FAILURES||(Je.trackEvent1("image_decode_failed",new Map([["reason",e]])),qr.numDecodeFailuresLogged=qr.numDecodeFailuresLogged+1)}},Un=qr;Un.LOG_MAX_DECODE_FAILURES=3,Un.numDecodeFailuresLogged=0;var mp;(e=>{function g(t){return As[t]}e.ImageState_toString=g})(mp||(mp={}));var gp;(e=>{function g(t){return Tl[t]}e.DecodeOutput_toString=g})(gp||(gp={}));var _p;(e=>{function g(t){return vl[t]}e.ImageFailure_toString=g})(_p||(_p={}));function Lg(){let g=At.getImageBatchURL(),e=td;td=[],ed=0;let t=r=>{let o=new Kr(g),i=new Map,a=kr().INITIAL_OPTIONS.user_data;a&&i.set("x-figma-user-id",a.id),o.send1("POST",new Blob([JSON.stringify({sha1s:r})],{type:"application/json"}),i).then(c=>{if(!c.wasSuccessful()){for(let d of r){let h=g+":"+d;Co.has(h)&&Co.get(h).reject(0)}return}let u=JSON.parse(c.text).meta.s3_urls;for(let d of Object.keys(u)){let h=g+":"+d;if(Co.has(h)){let S=Co.get(h);S.state()==0&&S.resolve(u[d])}}for(let d of r)if(!(d in u)){let h=g+":"+d;Co.has(h)&&Co.get(h).reject(0)}},c=>{for(let l of r){let u=g+":"+l;Co.has(u)&&Co.get(u).reject(0)}})},n=200;for(let r=0;r<=((e.length-1)/n|0);r=r+1){let o=e.slice(r*n,Math.min((r+1)*n,e.length));t(o)}}function fp(g){let e=At.getImageBatchURL()+":"+g;return Co.has(e)||(td.push(g),Co.set(e,new lo),ed==0&&(ed=setTimeout(()=>{Lg()},0))),Co.get(e)}var ed=0,td=[],Co=new Map;var nd=class{equals(e){return this.url==e.url&&this.scaleFactor==e.scaleFactor&&this.nonRotatedImageSize.equals(e.nonRotatedImageSize)&&this.nonRotatedOffset.equals(e.nonRotatedOffset)&&this.nonRotatedFramePresetSize.equals(e.nonRotatedFramePresetSize)}constructor(e,t,n,r,o){this.url=e,this.scaleFactor=t,this.nonRotatedImageSize=n,this.nonRotatedOffset=r,this.nonRotatedFramePresetSize=o}},Go=class{static deserializeVector(e){return new I(e.x,e.y)}static initialize(){let e=At.getDeviceInfoByIdentifier();if(e!==null){Go._infoByIdentifier=new Map;for(let t in e){let n=e[t];Go._infoByIdentifier.set(t,new nd(n.url,n.scaleFactor,Go.deserializeVector(n.imageSize),Go.deserializeVector(n.offset),Go.deserializeVector(n.framePresetSize)))}}}static infoForDevice(e){return Go._infoByIdentifier==null||e==null||e.type!="PRESET"?null:Me.StringMap_get(Go._infoByIdentifier,e.presetIdentifier,null)}static adjustNodeBoundsForDevice(e,t){let n=Go.infoForDevice(t);if(n==null)return e;let r=t.canvasSpaceTopLeftOffset(n),o=t.canvasSpaceImageSize(n),i=e.clone();return i.setX(e.x()-r.x()),i.setY(e.y()-r.y()),i.setWidth(o.x()),i.setHeight(o.y()),i}static canvasSpaceContentSize(e,t){let n=Go.infoForDevice(t);return n==null?e:t.canvasSpaceImageSize(n)}clearOnContextReset(){for(let e of Array.from(this._imageByURL.keys()))this._imageByURL.delete(e)}getImage(e,t){this._imageByURL.has(e.url)||this._imageByURL.set(e.url,Un.createDeviceImage(e));let n=this._imageByURL.get(e.url);return n.texture()==null&&n.fetchAndDecode(0,r=>{let o=C.in_Context.Context_createTexture1(t,C.TextureFormat.RGBA_LINEAR_CLAMP,1,1,"DeviceImage");n.setTexture(o);let i=r.expandToPowerOfTwo();n.texture().resize1(i.width,i.height,i,!0)},r=>{}),n}constructor(){this._imageByURL=new Map}},wr=Go;wr._infoByIdentifier=null;var Tr=class{constructor(e,t){this._offset=null,this._scale=0,this._offset=e,this._scale=t}offset(){return this._offset}scale(){return this._scale}setOffset(e){this._offset=e}setScale(e){this._scale=e}clone(){return new Tr(this.offset(),this.scale())}equals(e){return this._offset.equals(e.offset())&&this._scale==e.scale()}translate1(e,t){this._offset.setX(this._offset.x()+e*this._scale),this._offset.setY(this._offset.y()+t*this._scale)}translate2(e){this.translate1(e.x(),e.y())}translatedBy1(e){return this.translatedBy2(e.x(),e.y())}translatedBy2(e,t){return this.translate1(e,t),this}scaledBy(e){return this._scale=this._scale*e,this}multiply(e){this._offset=this._offset.add1(e.offset().multiply(this._scale)),this._scale=this._scale*e.scale()}multipliedBy(e){return this.multiply(e),this}transformRect(e){if(e.isInvalid())return e.copyFrom(B.INVALID);if(!e.isFinite())return e.copyFrom(B.INFINITE);let t=new bt;return t.include2(this.transformPoint(e.topLeft())),t.include2(this.transformPoint(e.bottomRight())),t.buildTo(e),e}inverseTransformRect(e){if(e.isInvalid())return e.copyFrom(B.INVALID);if(!e.isFinite())return e.copyFrom(B.INFINITE);let t=new bt;return t.include2(this.inverseTransformPoint(e.topLeft())),t.include2(this.inverseTransformPoint(e.bottomRight())),t.buildTo(e),e}transformPoint(e){return e.multiplyUpdate(this._scale),e.addUpdate1(this._offset),e}inverseTransformPoint(e){return e.subtractUpdate1(this._offset),e.divideUpdate(this._scale),e}transformDirection(e){return e.multiplyUpdate(this._scale),e}inverseTransformDirection(e){return e.divideUpdate(this._scale),e}invert(){let e=1/this.scale();return isNaN(e)?!1:(this._offset=this._offset.negative().multiply(e),this._scale=e,!0)}copyFrom(e){return this._offset.copyFrom(e.offset()),this._scale=e.scale(),this}toString(){return`SimpleTransform({${this.offset().x()}, ${this.offset().y()}}, ${this.scale()})`}static new2(){return new Tr(I.new2(),1)}static new3(e){return new Tr(e.offset(),e.scale())}},Sp;(o=>{function g(){return Tr.new2()}o.FrozenSimpleTransform_new1=g;function e(i){return i}o.FrozenSimpleTransform_new2=e;function t(i){return Tr.new3(i)}o.FrozenSimpleTransform_new3=t;function n(i,a){return new Tr(i,a)}o.FrozenSimpleTransform_new4=n,o.FrozenSimpleTransform_IDENTITY=g()})(Sp||(Sp={}));var Cs=(t=>(t[t.NOT_ANIMATED=0]="NOT_ANIMATED",t[t.ANIMATED=1]="ANIMATED",t))(Cs||{}),vp=(t=>(t[t.SNAP_VIEWPORT_TO_PIXEL_VIEW_SPACE=0]="SNAP_VIEWPORT_TO_PIXEL_VIEW_SPACE",t[t.DISABLE_VIEWPORT_PIXEL_ADJUSTMENT=1]="DISABLE_VIEWPORT_PIXEL_ADJUSTMENT",t))(vp||{}),Ns=(t=>(t[t.RESET=0]="RESET",t[t.PRESERVE=1]="PRESERVE",t))(Ns||{}),si=class{zoomScale(){return this._boundsMapping.viewPixelsPerCanvasPixel()}viewSpaceBounds(){return this._boundsMapping.viewSpaceBounds()}resetStateForTests(){this._boundsMapping=new Es,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._dummyOffset=I.new2(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._boundsOfDevicePreview=B.new2(),this._minZoom=0,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=I.new2(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=B.new2()}pixelSpaceBounds(e){let t=this.viewSpaceBounds();return new B(t.left()*e,t.top()*e,t.width()*e,t.height()*e)}_clampingBoundsForCanvasSpaceOffset(){return this._boundsMapping.clampingBoundsForCanvasSpaceOffset()}copyFrom(e){this._boundsMapping=e._boundsMapping.clone(),this._boundsOfDevicePreview.copyFrom(e._boundsOfDevicePreview),this._isInvalid=e._isInvalid,this._minZoom=e._minZoom,this._scrollPadding=e._scrollPadding}offsetX(){return this.offset().x()}offsetY(){return this.offset().y()}offset(){return this._boundsMapping.canvasSpaceOrigin().negative()}_setCanvasSpaceOffsetTo(e){this._boundsMapping.setCanvasSpaceOriginTo(e.negative())}canvasSpaceToViewSpace1(){return Q.isInlinePreview()?this.canvasSpaceToViewSpace2(1):this.canvasSpaceToViewSpace2(0)}canvasSpaceToViewSpace2(e){return this._boundsMapping.canvasSpaceToViewSpace(e)}viewSpaceToCanvasSpace1(){return Q.isInlinePreview()?this._boundsMapping.viewSpaceToCanvasSpace(1):this._boundsMapping.viewSpaceToCanvasSpace(0)}viewSpaceToCanvasSpace2(e){return this._boundsMapping.viewSpaceToCanvasSpace(e)}viewSpaceToClipSpace(){let e=ee.new2().copyFrom(Nt.FrozenAffineTransform_IDENTITY);return e.copyFrom(Nt.FrozenAffineTransform_IDENTITY),e.scale4(1,-1),e.translate2(-1,-1),e.scale4(2/this.viewSpaceBounds().width(),2/this.viewSpaceBounds().height()),e}canvasSpaceToClipSpace1(){return Q.isInlinePreview()?this.canvasSpaceToClipSpace2(1):this.canvasSpaceToClipSpace2(0)}canvasSpaceToClipSpace2(e){let t=this.viewSpaceToClipSpace();return t.multipliedBy2(this.canvasSpaceToViewSpace2(e)),t}computeCanvasSpaceBounds1(e){Q.isInlinePreview()?this.computeCanvasSpaceBounds2(e,1):this.computeCanvasSpaceBounds2(e,0)}computeCanvasSpaceBounds2(e,t){this._boundsMapping.computeCanvasSpaceBounds(e,t)}isInvalid(){return this._isInvalid}invalidate(){this._isInvalid=!0}setBounds(e){(this.viewSpaceBounds()==null||!this.viewSpaceBounds().equals(e))&&(this._boundsMapping.setViewSpaceBounds(e),this._isInvalid=!0)}_setCamera1(e,t,n,r){e==1?this._setCameraWithAnimation(t,n,Bo.Curve.EASE_IN_OUT,r):(this._isAnimating=!1,(!this.offset().equals(t)||this.zoomScale()!=n)&&(this._setCanvasSpaceOffsetTo(t),this._boundsMapping.setViewPixelsPerCanvasPixel(n),this._isInvalid=!0))}_setCamera2(e,t,n){this._setCamera1(e,t,n,si.ANIMATION_DURATION)}_setCameraWithAnimation(e,t,n,r){this._animationManager.startAnimation(n,r),this._animationOffsetStart=this.offset().clone(),this._animationOffsetEnd=e.clone(),this._animationZoomScaleStart=this.zoomScale(),this._animationZoomScaleEnd=this._clampedZoomScale(t),this._calculateBoundsForClamping(this._animationZoomScaleEnd,this._animationEndBounds),this._clampedAnimationOffsetEnd.setTo(Pe.Math_clamp1(e.x(),this._animationEndBounds.left(),this._animationEndBounds.right()),Pe.Math_clamp1(e.y(),this._animationEndBounds.top(),this._animationEndBounds.bottom())),this._isAnimating=!0,this._isInvalid=!0}_clampCameraOffset(){if(!this._useClamping)return;this._dummyOffset.copyFrom(this.offset()),this._updateBoundsForClamping(),this._setCanvasSpaceOffsetTo(this._dummyOffset);let e=Pe.Math_clamp1(this.offsetX(),this._clampingBoundsForCanvasSpaceOffset().left(),this._clampingBoundsForCanvasSpaceOffset().right()),t=Pe.Math_clamp1(this.offsetY(),this._clampingBoundsForCanvasSpaceOffset().top(),this._clampingBoundsForCanvasSpaceOffset().bottom()),n=1e-6;if(Math.abs(this.offsetX()-e)>n||Math.abs(this.offsetY()-t)>n)if(this._isAnimating&&this._animationZoomScaleStart==this._animationZoomScaleEnd)this.offsetX()!=e&&(this._animationOffsetStart=new I(e,this._animationOffsetStart.y()),this._animationOffsetEnd=new I(e,this._animationOffsetEnd.y()),this._setCanvasSpaceOffsetTo(new I(e,this.offset().y()))),this.offsetY()!=t&&(this._animationOffsetStart=new I(this._animationOffsetStart.x(),t),this._animationOffsetEnd=new I(this._animationOffsetEnd.x(),t),this._setCanvasSpaceOffsetTo(new I(this.offset().x(),t))),this._animationOffsetStart.equals(this._animationOffsetEnd)&&(this._isAnimating=!1);else if(this._isAnimating){if(this._alreadySetAnimationClamp)return;this._animationOffsetStart=this.offset(),this._animationOffsetEnd=this._clampedAnimationOffsetEnd,this._alreadySetAnimationClamp=!0}else this._setCamera2(0,new I(e,t),this.zoomScale());this.zoomScale()<this._minZoom&&this._boundsMapping.setViewPixelsPerCanvasPixel(this._minZoom)}setCameraZoom(e,t){let n=e==1&&this._isAnimating;this._setCamera2(e,n?this._animationOffsetEnd:this.offset(),t)}adjustCameraZoom1(e,t){let n=e==1&&this._isAnimating;this._setCamera2(e,n?this._animationOffsetEnd:this.offset(),(n?this._animationZoomScaleEnd:this.zoomScale())*t)}adjustCameraZoom2(e,t,n){let r=e==1&&this._isAnimating;this._setCamera1(e,r?this._animationOffsetEnd:this.offset(),(r?this._animationZoomScaleEnd:this.zoomScale())*t,n)}adjustCameraZoomRounded(e,t){let n=e==1&&this._isAnimating;this.setCameraZoom(1,Math.pow(2,Math.round(Math.log((n?this._animationZoomScaleEnd:this.zoomScale())*t)/Math.log(2))))}setCameraOffset1(e,t){this.setCameraOffset2(e,t,si.ANIMATION_DURATION)}setCameraOffset2(e,t,n){let r=e==1&&this._isAnimating;this._setCamera1(e,t,r?this._animationZoomScaleEnd:this.zoomScale(),n),this._clampCameraOffset()}panCamera(e){this._setCamera2(0,this.offset().add1(e.divide(this.zoomScale())),this.zoomScale()),this._clampCameraOffset()}flingCameraOffset(e,t){this._setCameraWithAnimation((this._isAnimating?this._animationOffsetEnd:this.offset()).add1(e.divide(this.zoomScale())),this._isAnimating?this._animationZoomScaleEnd:this.zoomScale(),Bo.Curve.DECAY,t),this._clampCameraOffset()}adjustCameraZoomWithPin(e,t){let n=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add1(t.subtract1(this.viewSpaceBounds().size().divide(2)).multiply(1/n-1/this.zoomScale())),n),this._clampCameraOffset()}adjustCameraZoomAndOffset(e,t,n){let r=this._clampedZoomScale(this.zoomScale()*e);this._setCamera2(0,this.offset().add1(n.subtract1(this.viewSpaceBounds().size().divide(2)).divide(r)).subtract1(t.subtract1(this.viewSpaceBounds().size().divide(2)).divide(this.zoomScale())),r),this._clampCameraOffset()}zoomToFit1(e,t,n){this._zoomToFit(e,t,si.ZOOM_TO_FIT_PADDING,n)}zoomToFit2(e,t){this._zoomToFit(e,t,si.ZOOM_TO_FIT_PADDING,si.ANIMATION_DURATION)}zoomToFitExactly(e,t){this._zoomToFit(e,t,0,si.ANIMATION_DURATION)}_zoomToFit(e,t,n,r){t.isEmpty()||(this._setCamera1(e,t.center().negative(),this.viewSpaceBounds().size().subtract(2*n).divide1(t.size()).min1(),r),this._clampCameraOffset())}prepareForRendering(){if(this._isAnimating){let e=this._animationManager.animationProgress();e>=1?(this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.clone()),this._boundsMapping.setViewPixelsPerCanvasPixel(this._animationZoomScaleEnd),this._isAnimating=!1,this._alreadySetAnimationClamp=!1):(this._boundsMapping.setViewPixelsPerCanvasPixel(1/(1/this._animationZoomScaleStart+(1/this._animationZoomScaleEnd-1/this._animationZoomScaleStart)*e)),this._setCanvasSpaceOffsetTo(this._animationOffsetEnd.subtract1(this._animationOffsetStart).multiply(e).add1(this._animationOffsetStart)))}this._isInvalid=this._isAnimating}getScaleFactorForCurrentTlf(e,t,n){let r=wr.canvasSpaceContentSize(e,n);switch(t){case 5:return r.x()>this.viewSpaceBounds().width()?this.viewSpaceBounds().width()/r.x():1;case 6:return this.viewSpaceBounds().width()/r.x();case 2:case 1:{let o=1/Math.max(r.x()/this.viewSpaceBounds().width(),r.y()/this.viewSpaceBounds().height());return t==2&&(o=Math.min(o,1)),o=Math.ceil(o*e.y())/e.y(),o}case 3:return 1;case 0:return 1;case 4:return 0;default:return 1}}_clampedZoomScale(e){let t=Math.max(this._minZoom,si.ZOOM_MIN);return Math.max(t,Math.min(e,si.ZOOM_MAX))}setScrollPadding(e){this._scrollPadding=e}previewBoundsIncludingDeviceFrame(e,t,n){return n!=null&&Ui.hasDevice(n.type)?wr.adjustNodeBoundsForDevice(e,n):Q.isInlinePreview()?e:t}_snapOffsetToPixelGrid(e,t){let n=e.add1(t).multiply(this.zoomScale()*2);n.setX(Math.floor(n.x())),n.setY(Math.floor(n.y()));let r=n.divide(this.zoomScale()*2).subtract1(t);return t.add1(r.subtract1(e))}_calculateBoundsForClamping(e,t){let n=this._boundsOfDevicePreview.isInvalid()?B.new2():this._boundsOfDevicePreview,r=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[2])/e,n.width()/2),o=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[3])/e,n.height()/2),i=Math.min((this.viewSpaceBounds().width()/2-this._scrollPadding[0])/e,n.width()/2),a=Math.min((this.viewSpaceBounds().height()/2-this._scrollPadding[1])/e,n.height()/2),s=-n.right()+r,c=-n.bottom()+o,l=-n.left()-i,u=-n.top()-a,d=l-s,h=u-c;t.setTo1(s,c,d,h)}_updateBoundsForClamping(){let e=B.new2();this._calculateBoundsForClamping(this.zoomScale(),e),this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(e)}updateForBaseScreen(e,t,n){this.updateForCurrentPreview(e==null?void 0:e.canvasSpaceBoundingBox(),e==null?void 0:e.canvasSpacePreviewBounds(),t,n)}updateForCurrentPreview(e,t,n,r){if(t==null||e==null){this._useClamping=!1;return}switch(this._boundsOfDevicePreview.copyFrom(this.previewBoundsIncludingDeviceFrame(e,t,r)),this._minZoom=this.getScaleFactorForCurrentTlf(t.size(),n,r),n){case 4:{this._useClamping=!1;break}case 3:case 5:case 0:case 6:{this._useClamping=!0,this._updateBoundsForClamping(),this._clampCameraOffset();let o=r!=null&&r.type!="NONE";aa.FitMode_userCanManuallyZoom(n,o)||this.setCameraZoom(0,this._minZoom);break}case 1:case 2:{this._useClamping=!0;let o=this._snapOffsetToPixelGrid(t.topLeft(),this._boundsOfDevicePreview.center().negative());this._boundsMapping.setClampingBoundsForCanvasSpaceOffset(new B(o.x(),o.y(),0,0)),this._setCamera2(0,o,this._minZoom);break}}}constructor(){this._boundsMapping=new Es,this._useClamping=!1,this._alreadySetAnimationClamp=!1,this._boundsOfDevicePreview=B.new2(),this._dummyOffset=I.new2(),this._isInvalid=!0,this._scrollPadding=[0,0,0,0],this._minZoom=0,this._animationManager=new Bo,this._isAnimating=!1,this._animationOffsetStart=null,this._animationOffsetEnd=null,this._clampedAnimationOffsetEnd=I.new2(),this._animationZoomScaleStart=1,this._animationZoomScaleEnd=1,this._animationEndBounds=B.new2()}},$r=si;$r.ZOOM_MIN=Math.pow(2,-6),$r.ZOOM_MAX=Math.pow(2,8),$r.ZOOM_TO_FIT_PADDING=50,$r.ANIMATION_DURATION=.2;var Es=class{canvasSpaceOrigin(){return this._defaultCanvasSpaceOrigin().add1(this._canvasSpaceOriginDelta)}setCanvasSpaceOriginTo(e){this._canvasSpaceOriginDelta=e.subtract1(this._defaultCanvasSpaceOrigin())}viewSpaceBounds(){return this._viewSpaceBounds}setViewSpaceBounds(e){this._viewSpaceBounds=e}viewPixelsPerCanvasPixel(){return this._viewPixelsPerCanvasPixel}setViewPixelsPerCanvasPixel(e){this._viewPixelsPerCanvasPixel=e}clampingBoundsForCanvasSpaceOffset(){return this._clampingBoundsForCanvasSpaceOffset}setClampingBoundsForCanvasSpaceOffset(e){this._clampingBoundsForCanvasSpaceOffset.copyFrom(e)}canvasSpaceToViewSpace(e){let t=Tr.new2().translatedBy2(this._viewSpaceBounds.width()/2,this._viewSpaceBounds.height()/2).scaledBy(this._viewPixelsPerCanvasPixel).translatedBy1(this.canvasSpaceOrigin().negative()),n=Tr.new2();if(e==0){let r=I.new3(this.canvasSpaceOrigin()).rounded(),o=t.transformPoint(r),i=-(o.x()-Math.floor(o.x())),a=-(o.y()-Math.floor(o.y()));n.translate1(i,a)}return n.multiply(t),n}viewSpaceToCanvasSpace(e){let t=this.canvasSpaceToViewSpace(e).clone();return t.invert(),t}computeCanvasSpaceBounds(e,t){this._viewSpaceBounds.transformInto2(e,this.viewSpaceToCanvasSpace(t))}_defaultCanvasSpaceOrigin(){return this._clampingBoundsForCanvasSpaceOffset!=null?this._clampingBoundsForCanvasSpaceOffset.bottomRight().negative():ye.FrozenVector_ZERO}clone(){let e=new Es;return e._canvasSpaceOriginDelta=this._canvasSpaceOriginDelta.clone(),e._viewPixelsPerCanvasPixel=this._viewPixelsPerCanvasPixel,e._viewSpaceBounds=this._viewSpaceBounds.clone(),e._clampingBoundsForCanvasSpaceOffset=this._clampingBoundsForCanvasSpaceOffset.clone(),e}constructor(){this._canvasSpaceOriginDelta=I.new2(),this._viewPixelsPerCanvasPixel=1,this._viewSpaceBounds=null,this._clampingBoundsForCanvasSpaceOffset=B.new2()}},bp;(e=>{function g(t){return Cs[t]}e.ViewportUpdateType_toString=g})(bp||(bp={}));var yp;(e=>{function g(t){return vp[t]}e.ViewportPixelAdjustment_toString=g})(yp||(yp={}));var Tp;(e=>{function g(t){return Ns[t]}e.StatePreserveType_toString=g})(Tp||(Tp={}));var Ho=class{static getStateGroupID(e){var o;let t,n=e!=null?e.scene().findNode1(e==null?void 0:e.symbolID()):null,r=(o=n==null?void 0:n.findContainingStateGroupOrSelf())==null?void 0:o.id();return r==null?R.invalid():r}constructor(e,t,n){this._appState=null,this._prototypeState=null,this._semanticChangeHistoryStorage=new ra,this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set,this._swapStateCallback=null,this._appState=e,this._prototypeState=t,this._swapStateCallback=n,Q.getFeatureFlags().prototypeStateManagement&&(this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this))}getComponentHistory(e,t){if(e.length==0)return[];let n=this._semanticChangeHistoryStorage.getData(e,R.toString(t));return n==null?[]:n}setComponentHistory(e,t,n){this._semanticChangeHistoryStorage.insert(e,R.toString(t),n)}handleStateChangeCommitted(e,t){}_transferChildComponentStates(e){e!=null&&e.forEachChild(t=>{this._setInstanceChangeHistory(t),this._transferChildComponentStates(t)})}_hasStateToTranfer(e,t){return t.length>0&&e.symbolID()!=ie.List_last(t).newStateId()}_setInstanceChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let t=An.getSemanticNodePath(new Jt(e)),n=this.getComponentHistory(t,Ho.getStateGroupID(e)),r=this._prototypeState.getStateMachineOrNull(e.stablePath());r!=null&&this._hasStateToTranfer(e,n)&&!this._stateAlreadyManagedByVariables(e)&&(r.setChangeHistory(n),this._swapStateCallback(e.stablePath(),ie.List_last(n).newStateId(),0),Je.trackDefinedEvent("prototype.viewer_interaction_state_transferred",new Map))}}_resetChildComponentStates(e,t){e!=null&&e.forEachChild(n=>{this._clearInstanceChangeHistory(n,t),this._resetChildComponentStates(n,t)})}_nodeIsInstance(e){return e!=null&&e.type()=="INSTANCE"}_nodeHasStoredState(e,t){let n=x._prototypeLib;return!t&&n!=null&&this._nodeIsInstance(e)?n.nodeHasLocalSymbolChanges(e.id()):!1}_clearInstanceChangeHistory(e,t){let n,r;if(e!=null&&(this._isInteractiveComponent(e)||this._nodeHasStoredState(e,t))&&!this._stateAlreadyManagedByVariables(e)){Je.trackDefinedEvent("prototype.viewer_interaction_state_reset",new Map),t?(r=x._prototypeLib)!=null&&r.resetLocalNestedInstanceChanges([e.id()]):(n=x._prototypeLib)!=null&&n.resetLocalInstanceChanges([e.id()]);let o=An.getSemanticNodePath(new Jt(e));this._semanticChangeHistoryStorage._delete(o,R.toString(Ho.getStateGroupID(e)))}}_hasStateToStore(e,t,n){if(t==null||t.length==0)return!1;if(n==null||n.length==0)return!0;let r=ie.List_last(n);return e.symbolID()!=r.newStateId()}_storeChangeHistory(e){if(e!=null&&this._isInteractiveComponent(e)&&this._nodeHasBeenInteractedWith(e)){let t=this._prototypeState.getStateMachineOrNull(e.stablePath());if(t!=null){let n=An.getSemanticNodePath(new Jt(e)),r=Ho.getStateGroupID(e),o=this.getComponentHistory(n,r),i=t.changeHistory();this._hasStateToStore(e,i,o)&&!this._stateAlreadyManagedByVariables(e)&&this.setComponentHistory(n,r,i)}}}_storeChangeHistoryForChildren(e){e!=null&&e.forEachChild(t=>{this._storeChangeHistory(t),this._storeChangeHistoryForChildren(t)})}_semanticPathToString(e){let t=An.getSemanticNodePath(new Jt(e)),n=":/:",r=R.toString(Ho.getStateGroupID(e));return t.length==1?t[0].toStringWithPrefix(!0):ie.List_reduce(t,(o,i,a)=>a==0?o:o+i.toString()+n,"")+n+r}_recordInteraction(e,t){if(t.transitionParameters.navigationType=="SWAP_STATE"&&!qt.TransitionAction_isTransientAction(t.cause)){let n=this._appState.scene().findNode3(e);if(n==null)return;let r=this._semanticPathToString(n);this._semanticPathInteracted.add(r)}}_semanticPathHasBeenInteractedWith(e){return this._semanticPathInteracted.has(this._semanticPathToString(e))}_nodeHasBeenInteractedWith(e){return Ho.getStateGroupID(e)!=R.invalid()?this._semanticPathHasBeenInteractedWith(e):!1}_isInteractiveComponent(e){return this._nodeIsInstance(e)?Ho.getStateGroupID(e)!=R.invalid():!1}_stateAlreadyManagedByVariables(e){return e!=null&&e.getBoundVariables().componentProperties}handleStateChangeAborted(e){}handleStateChangeInitiated(e){if(e.stateManagementVersion()==1){let t=e.oldStateAndOverlays.topId(),n=e.newStateAndOverlays.topId(),r=this._appState.scene().findNode1(t),o=this._appState.scene().findNode1(n);this._storeChangeHistory(r),this._storeChangeHistoryForChildren(r),e.resetInteractiveComponents()==0?(this._clearInstanceChangeHistory(o,!1),this._resetChildComponentStates(o,!1)):(this._setInstanceChangeHistory(o),this._transferChildComponentStates(o))}}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._semanticChangeHistoryStorage.uninitialize1(),this._stateGroupsInteracted=new Set,this._semanticPathInteracted=new Set}handleHsmAborted(e,t){}handleHsmCommitted(e,t,n){t.stateManagementVersion()==1&&this._recordInteraction(e,t)}handleHsmRequested(e,t){if(t.stateManagementVersion()==1){let n=this._appState.scene().findNode3(e);this._storeChangeHistoryForChildren(n)}}handleHsmInitiated(e,t){if(t.stateManagementVersion()==1){let n=this._appState.scene().findNode3(e);t.resetInteractiveComponents()!=0?this._transferChildComponentStates(n):this._resetChildComponentStates(n,!0)}}debugString(){return this._semanticChangeHistoryStorage.toString2(e=>{var a;let t,n,r,o="",i=Math.max(e.length-4,0);i!=0&&(o="..., ");for(let s=i,c=e.length;s<c;s=s+1){let l=e[s];o+=`${(a=(r=l.oldStateId())!=null?R.toString(r):null)!=null?a:"null"}->${(t=l.newStateId())!=null?R.toString(t):null}`,s!=e.length-1&&(o+=", ")}return o})}};var Wa=class{constructor(e,t,n,r,o){this.id=null,this.overlayDataModelId=null,this.openingHotspotStablePath=null,this.openingInteractionId=null,this.openingTransition=null,this.id=e,this.overlayDataModelId=t,this.openingHotspotStablePath=n,this.openingInteractionId=r,this.openingTransition=o}cloneWithId(e){return new Wa(e,this.overlayDataModelId,this.openingHotspotStablePath,this.openingInteractionId,this.openingTransition)}openingTransitionType(){return this.openingTransition.transitionType}},Rs=class{constructor(e,t,n,r,o,i,a,s){this.overlayId=e,this.overlayNode=t,this.bounds=n,this.baseTlfCursor=r,this.backgroundAppearance=o,this.backgroundTransitionProgress=i,this.transform=a,this.animationTransform=s}},Gi=class{constructor(){if(arguments.length==0)this._multiOverlayMap=null,this._hasTransitionComputed=!1,this._hasTransition=!1,this._multiOverlayMap=new Map;else if(arguments.length==1){let e=arguments[0];this._multiOverlayMap=null,this._hasTransitionComputed=!1,this._hasTransition=!1,this._multiOverlayMap=e}}hasTransition(){if(this._hasTransitionComputed)return this._hasTransition;for(let e of Array.from(this._multiOverlayMap.keys()))if(this._multiOverlayMap.get(e).backgroundTransitionProgress!=null||this._multiOverlayMap.get(e).transform!=null||this._multiOverlayMap.get(e).animationTransform!=null){this._hasTransition=!0,this._hasTransitionComputed=!0;break}return this._hasTransition}count(){return this._multiOverlayMap.size}addEntry(e,t){this._multiOverlayMap.set(e,t),this._hasTransitionComputed=!1}removeEntry(e){this._multiOverlayMap.delete(e),this._hasTransitionComputed=!1}get1(e){return Me.StringMap_get(this._multiOverlayMap,e,null)}get2(e){return Me.StringMap_get(this._multiOverlayMap,e,null)}keys(){return Array.from(this._multiOverlayMap.keys())}overlayCacheKey(){let e=[];for(let t of this.keys())e.push(t);return new wt(e)}},Il=class{id(){return this._data.id}overlayDataModelId(){return this._data.overlayDataModelId}openingHotspotStablePath(){return this._data.openingHotspotStablePath}previousOverlay(){return this._previousOverlay}openingTransitionType(){return this._data.openingTransitionType()}node(){return this.scene.findNode1(this.id())}backgroundInteraction(){let e=this.scene.findNode1(this._data.overlayDataModelId);return e==null?"NONE":e.overlayBackgroundInteraction()}backgroundAppearance(){let e=this.scene.findNode1(this._data.overlayDataModelId);return e==null?new vo:e.overlayBackgroundAppearance()}positionType(){let e=this.scene.findNode1(this._data.overlayDataModelId);return e==null?"CENTER":e.overlayPositionType()}relativePosition(){return this._data.openingTransition.overlayRelativePosition}renderedOrigin(e){let t=this.node();if(t==null)return ye.FrozenVector_new1();let n=null;if(this.positionType()=="MANUAL"){if(this._stackPosition>0){let o=this.scene.findNode1(this._previousOverlay.id()).canvasSpaceBoundingBox(),i=this._previousOverlay.renderedOrigin(e),a=this.scene.findNode3(this.openingHotspotStablePath());a!=null?n=a.canvasSpaceScrolledBounds(1).topLeft().add1(i.subtract1(o.topLeft())):ze("Could not find hotspot on previous overlay")}if(n==null){let r=this.scene.findNode3(this.openingHotspotStablePath());r!=null?n=r.canvasSpaceScrolledBounds(1).topLeft():ze("Could not find hotspot on base screen TLF")}if(n==null)return ye.FrozenVector_new1()}return Os.BoundOverlay_computeOrigin(t,e,this._data.openingTransition,n,this.positionType())}renderedBounds(e){let t=this.scene.findNode1(this._data.id);if(t==null)return Kn.FrozenRect_new1();let n=t.canvasSpaceBoundingBox().size(),r=this.renderedOrigin(e);return Kn.FrozenRect_new4(r.x(),r.y(),n.x(),n.y())}deltaFromRenderedPositionToCanvasSpacePosition(e){let t=this.scene.findNode1(this._data.id);return t==null?new I(0,0):this.renderedOrigin(e).subtract1(t.canvasSpaceBoundingBox().topLeft())}baseTlfSpaceToOverlaySpace1(e,t){let n=this.scene.findNode1(this._data.id);if(n==null||t==null||e==null)return ye.FrozenVector_ZERO;let r=this.renderedOrigin(e),o=n.canvasSpaceBoundingBox().topLeft();return t.add1(o).subtract1(r)}baseTlfSpaceToOverlaySpace2(e,t){return B.new4(this.baseTlfSpaceToOverlaySpace1(e,t.topLeft()),t.size())}overlaySpaceToBaseTlfSpace1(e,t){let n=this.baseTlfSpaceToOverlaySpace1(e,t);return t.add1(t.subtract1(n))}overlaySpaceToBaseTlfSpace2(e,t){return B.new4(this.overlaySpaceToBaseTlfSpace1(e,t.topLeft()),t.size())}constructor(e,t,n,r){this.scene=e,this._data=t,this._previousOverlay=n,this._stackPosition=r}},Os;(t=>{function g(n,r,o,i,a){if(n==null)return I.new2();let s=n.canvasSpaceBoundingBox().size();if(a=="MANUAL")return new I(i.x()+o.overlayRelativePosition.x(),i.y()+o.overlayRelativePosition.y());{let c=r.canvasSpaceBoundingBox(),l=c.topLeft(),u=c.size(),d=l.x();switch(a){case"TOP_LEFT":case"BOTTOM_LEFT":break;case"TOP_CENTER":case"CENTER":case"BOTTOM_CENTER":{d+=u.x()/2-s.x()/2;break}case"TOP_RIGHT":case"BOTTOM_RIGHT":{d+=u.x()-s.x();break}}let h=l.y();switch(a){case"TOP_LEFT":case"TOP_CENTER":case"TOP_RIGHT":break;case"CENTER":{h+=u.y()/2-s.y()/2;break}case"BOTTOM_LEFT":case"BOTTOM_CENTER":case"BOTTOM_RIGHT":{h+=u.y()-s.y();break}}return new I(d,h)}}t.BoundOverlay_computeOrigin=g;function e(n,r,o,i,a){let s=n.canvasSpaceBoundingBox().size(),c=g(n,r,o,i,a);return Kn.FrozenRect_new4(c.x(),c.y(),s.x(),s.y())}t.BoundOverlay_computeNewBounds=e})(Os||(Os={}));var Ip="precision highp float;uniform mat3 u;attribute vec4 ha,jb;varying vec2 e;varying vec4 N;void main(){e=ha.zw,N=jb,gl_Position=vec4(u*vec3(ha.xy,1),0).xywz;}",Ap="precision highp float;varying vec2 e;varying vec4 N;void main(){gl_FragColor=N*min(1.,min(e.x,e.y));}",Ep="precision highp float;uniform mat3 u;attribute vec4 ha;varying vec4 W;void main(){vec2 a=(u*vec3(ha.xy,1)).xy;W=vec4(a.xy,ha.zw),gl_Position=vec4(a,0,1);}",Cp="precision highp float;uniform float bb;uniform vec2 Qa;uniform vec4 kb;varying vec4 W;const vec3 cb=vec3(.188235,.760784,1);bool lb(vec4 a,vec2 b){return a.z>=0.&&a.w>=0.&&clamp(b.x,a.x,a.x+a.z)==b.x&&clamp(b.y,a.y,a.y+a.w)==b.y;}void main(){vec2 b=W.xy,a=W.zw;gl_FragColor=lb(kb,b)?a.x<Qa.x||a.x>1.-Qa.x||a.y<Qa.y||a.y>1.-Qa.y?vec4(cb,1.*bb):vec4(cb,.5*bb):vec4(0);}",Np="precision highp float;uniform mat3 u;attribute vec4 ha;varying vec4 W;void main(){vec2 a=(u*vec3(ha.xy,1)).xy;W=vec4(a.xy,ha.zw),gl_Position=vec4(a,0,1);}",Op="precision highp float;uniform sampler2D f;varying vec4 W;void main(){vec2 a=W.zw;a.y=1.-a.y,gl_FragColor=texture2D(f,a);}",Rp="precision highp float;uniform vec4 s,Ma;attribute vec2 n;varying vec2 e;void main(){e=mix(Ma.xy,Ma.zw,n),gl_Position=vec4(mix(s.xy,s.zw,n)*2.-1.,0,1);}",wp="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform sampler2D f;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}void main(){gl_FragColor=O(texture2D(f,e));}",rd="precision highp float;uniform vec4 s,Ma;attribute vec2 n;varying vec2 e;void main(){e=mix(Ma.xy,Ma.zw,n),gl_Position=vec4(mix(s.xy,s.zw,n)*2.-1.,0,1);}",Pp="precision highp float;uniform sampler2D f;varying vec2 e;void main(){gl_FragColor=texture2D(f,e);}",Fp="precision highp float;uniform sampler2D f;uniform float db,ia;uniform vec4 I;varying vec2 e;void main(){vec2 b=e*vec2(db),c=floor(b-vec2(.5))+.5,a=c*ia,i=a+vec2(ia,0),m=a+vec2(0,ia),t=a+vec2(ia,ia);float D=texture2D(f,a).a,E=texture2D(f,i).a,J=texture2D(f,m).a,P=texture2D(f,t).a,X=float(D>0.),Y=float(E>0.),ua=float(J>0.),va=float(P>0.),d=b.x-c.x,g=1.-d,h=b.y-c.y,Ka=1.-h,Ya=(X*g+Y*d)*Ka+(ua*g+va*d)*h;gl_FragColor=Ya*I;}";var xp="precision highp float;uniform mat3 mb;uniform vec4 eb,fb;attribute vec2 n;varying vec2 e;void main(){e=mix(eb.xy,eb.zw,n),gl_Position=vec4((mb*vec3(mix(fb.xy,fb.zw,n),1)).xy,0,1);}",Dp="precision highp float;uniform sampler2D f;uniform float p;uniform vec4 Ra;varying vec2 e;void main(){vec2 a=clamp(e,Ra.xy,Ra.zw);gl_FragColor=texture2D(f,a)*p;}",Ka="precision highp float;attribute vec2 n;varying vec2 e;void main(){e=n,gl_Position=vec4(n*2.-1.,0,1);}",od="precision highp float;uniform sampler2D f;uniform float p;varying vec2 e;void main(){gl_FragColor=texture2D(f,e)*p;}",Mp="precision highp float;uniform sampler2D f;uniform float p;varying vec2 e;void main(){vec4 a=.25*(texture2D(f,e+vec2(-4.882813e-4,-4.882813e-4))+texture2D(f,e+vec2(4.882813e-4,-4.882813e-4))+texture2D(f,e+vec2(4.882813e-4,4.882813e-4))+texture2D(f,e+vec2(-4.882813e-4,4.882813e-4)));gl_FragColor=a*p;}",Lp="precision highp float;uniform sampler2D f;uniform float p;varying vec2 e;void main(){vec4 a=.444444*texture2D(f,e+vec2(-3.255208e-4,3.255208e-4))+.222222*texture2D(f,e+vec2(6.510417e-4,3.255208e-4))+.222222*texture2D(f,e+vec2(-3.255208e-4,-6.510417e-4))+.111111*texture2D(f,e+vec2(6.510417e-4,-6.510417e-4));gl_FragColor=a*p;}",Vp="precision highp float;uniform mat3 u;attribute vec2 n;attribute vec3 nb;varying vec3 wa;void main(){wa=nb,gl_Position=vec4(u*vec3(n,1),0).xywz;}",Bp="precision highp float;varying vec3 wa;void main(){if(wa.x*wa.x*wa.x>wa.y*wa.z)discard;}",Yr="precision highp float;uniform vec4 s;attribute vec2 n;varying vec2 e;void main(){e=mix(s.xy,s.zw,n),gl_Position=vec4(e*2.-1.,0,1);}",kp="precision highp float;uniform sampler2D f;uniform float v;uniform vec2 F;uniform vec4 y;varying vec2 e;void main(){vec2 a=clamp(e,y.xy,y.zw);float t=v;vec4 ua=texture2D(f,a)*t;float va=t;for(int m=1;m<32;m+=2){if(float(m)>v)break;float b=float(m),c=min(b+1.,v);vec2 d=a-F*b,g=a+F*b,h=a-F*c,i=a+F*c;float D=(v-b)*float(d==clamp(d,y.xy,y.zw)),E=(v-b)*float(g==clamp(g,y.xy,y.zw)),J=(v-c)*float(h==clamp(h,y.xy,y.zw)),P=(v-c)*float(i==clamp(i,y.xy,y.zw)),X=D+J,Y=E+P;vec2 Ka=(d*D+h*J)/X,Ya=(g*E+i*P)/Y;ua+=texture2D(f,Ka)*X+texture2D(f,Ya)*Y,va+=X+Y;}gl_FragColor=ua/va;}",Up="precision highp float;uniform sampler2D f;uniform float v;uniform vec2 F;varying vec2 e;void main(){float i=v;vec4 m=texture2D(f,e)*i;float t=i;for(int h=1;h<32;h+=2){if(float(h)>v)break;float a=float(h),b=min(a+1.,v);vec2 D=e-F*a,E=e+F*a,J=e-F*b,P=e+F*b;float c=v-a,d=v-b,g=c+d;vec2 X=(D*c+J*d)/g,Y=(E*c+P*d)/g;m+=g*(texture2D(f,X)+texture2D(f,Y)),t+=2.*g;}gl_FragColor=m/t;}",Gp="precision highp float;uniform sampler2D f,k;uniform float p;uniform vec4 Sa,Ta;varying vec2 e;void main(){vec4 a=all(greaterThan(e,Sa.xy))&&all(lessThan(e,Sa.zw))?texture2D(f,e):vec4(0),b=all(greaterThan(e,Ta.xy))&&all(lessThan(e,Ta.zw))?texture2D(k,e):vec4(0);gl_FragColor=mix(a,b,p);}",Hp="precision highp float;uniform mat3 u;uniform float Z;uniform vec4 s;attribute vec2 n;varying vec4 N;void main(){vec2 a=mix(s.xy-Z,s.zw+Z,n);N=(vec4(a,a)-s)/Z,gl_Position=vec4(u*vec3(a,1),0).xywz;}",zp="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform vec4 I;varying vec4 N;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}float K(float a){return a<-1.?0.:a<0.?.5*(a+1.)*(a+1.):a<1.?.5-.5*a*(a-2.):1.;}void main(){float a=(K(N.x)-K(N.z))*(K(N.y)-K(N.w));gl_FragColor=O(I*a);}",Wp="precision highp float;uniform mat3 u;uniform float Z;uniform vec4 s;attribute vec2 n;varying vec2 e;void main(){vec2 b=(s.xy+s.zw)*.5,a=mix(s.xy-Z,s.zw+Z,n);e=(a-b)/Z,gl_Position=vec4(u*vec3(a,1),0).xywz;}",Kp="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform float gb;uniform vec2 La;uniform vec4 I;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}float K(float a){return a<-1.?0.:a<0.?.5*(a+1.)*(a+1.):a<1.?.5-.5*a*(a-2.):1.;}float hb(float a){return max(0.,1.-abs(a));}float ob(float b,float h,float a,vec2 c){float d=min(c.y-a-abs(h),0.),g=c.x-a+sqrt(max(0.,a*a-d*d));vec2 i=vec2(b+g,b-g);return K(i.x)-K(i.y);}void main(){float c;if(all(lessThan(abs(e),La-vec2(gb+1.))))c=1.;else{float d=e.y-La.y,g=e.y+La.y,a=clamp(-1.,d,g),b=clamp(1.,d,g);if(a==b)c=0.;else{float i=(b-a)/4.,h=a+i*.5,m=0.,t=0.;for(int D=0;D<4;D++){float E=hb(h);t+=ob(e.x,e.y-h,gb,La)*E,m+=E,h+=i;}float J=(K(b)-K(a))/m;c=t*J;}}gl_FragColor=O(I*c);}",qp="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){gl_FragColor=texture2D(f,e)*texture2D(k,e).a;}",Yp="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){vec3 a=texture2D(k,e).rgb,b=vec3(.299,.587,.114);float c=dot(a*a,b),d=sqrt(c);gl_FragColor=texture2D(f,e)*d*texture2D(k,e).a;}",Xp="precision highp float;uniform sampler2D f,k,sa;varying vec2 e;void main(){vec3 a=texture2D(sa,e).rgb,b=vec3(.299,.587,.114);float c=dot(a*a,b),d=sqrt(c);gl_FragColor=mix(texture2D(k,e),texture2D(f,e),texture2D(sa,e).a*d);}",jp="precision highp float;uniform sampler2D f,k,sa;varying vec2 e;void main(){gl_FragColor=mix(texture2D(k,e),texture2D(f,e),texture2D(sa,e).a);}",Jp="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){gl_FragColor=texture2D(f,e)*float(texture2D(k,e).a==0.);}",Zp="precision highp float;uniform sampler2D f,k,sa;varying vec2 e;void main(){float a=texture2D(sa,e).a;gl_FragColor=mix(texture2D(k,e),texture2D(f,e)*float(a==0.),1.-a);}",Qp="precision highp float;uniform sampler2D f;uniform vec4 I;varying vec2 e;void main(){gl_FragColor=float(texture2D(f,e).a>0.)*I;}",$p="precision highp float;uniform sampler2D f,k;uniform vec4 I;varying vec2 e;void main(){gl_FragColor=(1.-texture2D(f,e).a)*texture2D(k,e).a*I;}",eh="precision highp float;uniform sampler2D f,k;uniform vec4 I;varying vec2 e;void main(){float a=float(texture2D(k,e).a>0.);gl_FragColor=(1.-texture2D(f,e).a)*a*I;}",th="precision highp float;uniform sampler2D f,k;varying vec2 e;void main(){if(texture2D(k,e).a==0.)discard;gl_FragColor=texture2D(f,e);}",nh="precision highp float;uniform mat3 u;attribute vec2 n;varying vec2 e;void main(){e=n,gl_Position=vec4(u*vec3(n,1),0).xywz;}",Al="precision highp float;uniform float p;uniform vec4 I;void main(){gl_FragColor=I*p;}",ws="precision highp float;uniform mat3 u,_;attribute vec2 n;varying vec2 e;void main(){e=(_*vec3(n,1)).xy,gl_Position=vec4(u*vec3(n,1),0).xywz;}",id="precision highp float;uniform mat3 u,_,Ua;attribute vec2 n;varying vec2 e,xa;void main(){e=(_*vec3(n,1)).xy,xa=(Ua*vec3(n,1)).xy,gl_Position=vec4(u*vec3(n,1),0).xywz;}",rh="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f;uniform float p;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}void main(){vec2 a=aa(e);gl_FragColor=O(texture2D(f,a)*p);}",oh="precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f,k;uniform float p,G;varying vec2 e;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}void main(){vec2 a=aa(e);vec4 b=mix(texture2D(f,a),texture2D(k,a),G);gl_FragColor=O(b*p);}",ih="precision highp float;uniform sampler2D f;uniform bool L,M;uniform float p;varying vec2 e;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=j(f,e);a.rgb*=a.a,gl_FragColor=a*p;}",ah="precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float p,G;varying vec2 e,xa;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=mix(j(f,e),j(k,xa),G);a.rgb*=a.a,gl_FragColor=a*p;}",sh="precision highp float;uniform sampler2D f;uniform bool L,M;uniform float p,ya,za,ba,ca,Aa,Ba,Ca;varying vec2 e;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=j(f,e);a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*p;}",lh="precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float p,G,ya,za,ba,ca,Aa,Ba,Ca;varying vec2 e,xa;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}void main(){vec4 a=mix(j(f,e),j(k,xa),G);a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*p;}",ch="precision highp float;uniform int l;uniform sampler2D f,k;uniform float p;varying vec2 e;float Na(vec3 a){return min(min(a.r,a.g),a.b);}float Za(vec3 a){return max(max(a.r,a.g),a.b);}float Va(vec3 a){return Za(a)-Na(a);}float Wa(vec3 a){return dot(a,vec3(.3,.59,.11));}vec3 _a(vec3 c,vec3 d){float b=Wa(d);vec3 a=c+(b-Wa(c));float g=Na(a),h=Za(a);a=g<0.?mix(vec3(b),a,b/(b-g)):h>1.?mix(vec3(b),a,(1.-b)/(h-b)):a;return a;}vec3 ib(vec3 a,vec3 b,vec3 g){float c=Va(a);vec3 d=vec3(0);if(c>0.){float h=Na(a),i=Va(b);d=(a-h)*i/c;}return _a(d,g);}void main(){vec4 m=texture2D(f,e)*p,t=texture2D(k,e);float c=m.a,a=t.a;vec3 b=t.rgb;if(c==0.)gl_FragColor=vec4(b,a);else{vec3 d=m.rgb,h=d*(1.-a)+b*(1.-c);if(l==2)h+=min(d*a,b*c);else if(l==3)h+=d*b;else if(l==4)h=max(vec3(0),d+b-c*a);else if(l==5){vec3 X=max(d*a,.003922),Y=(a-b)*c*step(.003922,a-b);h+=c*a*(1.-min(vec3(1),Y/X));}else if(l==6)h+=max(d*a,b*c);else if(l==7)h=d+b-d*b;else if(l==8)h=min(vec3(1),d+b);else if(l==9){vec3 ua=max(a*(c-d),.003922),va=b*c*step(.003922,b);h+=c*a*min(vec3(1),va/ua);}else if(l==10)h+=mix(c*a-2.*(a-b)*(c-d),2.*d*b,vec3(lessThanEqual(2.*b,vec3(a))));else if(l==12)h+=mix(2.*d*b,c*a-2.*(a-b)*(c-d),vec3(greaterThan(2.*d,vec3(c))));else if(l==13)h+=abs(b*c-d*a);else if(l==14)h+=d*a+b*c-2.*d*b;else{vec3 D=vec3(0),i=d,g=b;if(c>0.)i/=c;if(a>0.)g/=a;if(l==11){vec3 Ka=1.-g,J=(16.*g-12.)*g+3.,P=inversesqrt(g+1e-6)-1.,E=mix(J,P,vec3(greaterThan(g,vec3(.25))));E=mix(E,Ka,vec3(greaterThan(i,vec3(.5)))),D=g*(1.+E*(2.*i-1.));}else D=l==15?ib(i,g,g):l==16?ib(g,i,g):l==17?_a(i,g):l==18?_a(g,i):D;h+=c*a*D;}gl_FragColor=vec4(h,c+a-c*a);}}",dh="precision highp float;uniform mat3 u;attribute vec2 n;uniform vec2 Oa,fa;varying vec2 w;vec2 ta(in vec2 a){return (a-vec2(.5,.5))*Oa+vec2(.5,.5);}void main(){vec2 a=ta(n);w=a*fa,gl_Position=vec4(u*vec3(n,1),0).xywz;}",Ps="precision highp float;uniform mat3 u,_;uniform float Ja;attribute vec2 n;uniform vec2 Oa,fa;varying vec2 w,ja,o,q;const vec2 Xa=vec2(.0625,.0625);void ab(vec2 a){vec2 b=1./fa/Ja;o=(_*vec3(a,1)).xy,q=(_*vec3(a+Xa*b,1)).xy-o;}vec2 ta(in vec2 a){return (a-vec2(.5,.5))*Oa+vec2(.5,.5);}void main(){vec2 a=ta(n);w=a*fa,ja=(_*vec3(a,1)).xy,ab(a),gl_Position=vec4(u*vec3(n,1),0).xywz;}",ad="precision highp float;uniform mat3 u,_,Ua;uniform float Ja;attribute vec2 n;uniform vec2 Oa,fa;varying vec2 w,ja,o,z,q,C;const vec2 Xa=vec2(.0625,.0625);void ab(vec2 a){vec2 b=1./fa/Ja;o=(_*vec3(a,1)).xy,q=(_*vec3(a+Xa*b,1)).xy-o;}void pb(vec2 a){vec2 b=1./fa/Ja;z=(Ua*vec3(a,1)).xy,C=(Ua*vec3(a+Xa*b,1)).xy-z;}vec2 ta(in vec2 a){return (a-vec2(.5,.5))*Oa+vec2(.5,.5);}void main(){vec2 a=ta(n);w=a*fa,ja=(_*vec3(a,1)).xy,ab(a),pb(a),gl_Position=vec4(u*vec3(n,1),0).xywz;}",uh=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform float p;uniform int A;uniform vec2 Q,R;uniform vec4 I,S,T;varying vec2 w;float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){float a=H(w);gl_FragColor=I*p*a;}`,ph=`#extension GL_OES_standard_derivatives:enable
precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f;uniform float p;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,ja;float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){float a=H(w);vec2 b=aa(ja);gl_FragColor=O(texture2D(f,b)*p)*a;}`,hh=`#extension GL_OES_standard_derivatives:enable
precision highp float;float x(){vec2 a=gl_FragCoord.xy;return fract(sin(dot(vec2(12.9898,78.233),a))*43758.5453);}uniform int l;uniform sampler2D f,k;uniform float p,G;vec4 O(vec4 a){float b=(x()-.5)*.007843;return a.a>0.?min(abs(a+b),1.):a;}vec2 aa(in vec2 b){vec2 a=b-.5;float c=l==1?a.x+.5:l==2?2.*length(a):l==3?fract(atan(a.y,a.x)/6.283185):l==4?2.*max(abs(a.x+a.y),abs(a.y-a.x)):0.;return vec2(c,.251953);}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,ja;float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){float b=H(w);vec2 a=aa(ja);vec4 c=mix(texture2D(f,a),texture2D(k,a),G);gl_FragColor=O(c*p)*b;}`,mh=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f;uniform bool L,M;uniform float p;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,q;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*q)+j(f,o+la*q)+j(f,o+ma*q)+j(f,o+na*q)+j(f,o+oa*q)+j(f,o+pa*q)+j(f,o+qa*q)+j(f,o+ra*q))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 a=ga();a.rgb*=a.a,gl_FragColor=a*p*H(w);}`,gh=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float p,G;vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,z,q,C;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*q)+j(f,o+la*q)+j(f,o+ma*q)+j(f,o+na*q)+j(f,o+oa*q)+j(f,o+pa*q)+j(f,o+qa*q)+j(f,o+ra*q))/8.;}vec4 Pa(){return (j(k,z+ka*C)+j(k,z+la*C)+j(k,z+ma*C)+j(k,z+na*C)+j(k,z+oa*C)+j(k,z+pa*C)+j(k,z+qa*C)+j(k,z+ra*C))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 b=ga(),c=Pa(),a=mix(b,c,G);a.rgb*=a.a,gl_FragColor=a*p*H(w);}`,_h=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f;uniform bool L,M;uniform float p,ya,za,ba,ca,Aa,Ba,Ca;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,q;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*q)+j(f,o+la*q)+j(f,o+ma*q)+j(f,o+na*q)+j(f,o+oa*q)+j(f,o+pa*q)+j(f,o+qa*q)+j(f,o+ra*q))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 a=ga();a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*p*H(w);}`,fh=`#extension GL_OES_standard_derivatives:enable
precision highp float;uniform sampler2D f,k;uniform bool L,M;uniform float p,G,ya,za,ba,ca,Aa,Ba,Ca;const vec3 r=vec3(.2126,.7152,.0722);vec3 Da(vec3 a){a=pow(a,vec3(2.2));return a;}vec3 Ea(vec3 a){a=pow(a,vec3(.454545));return a;}float da(vec3 b,float c,float d){float a=dot(b,r)-pow(.5,2.2);return .75*a/sqrt(1.+4.*a*a)*(a>0.?d:-c*.999);}vec3 Fa(vec3 a,float b){float d=pow(10.,2.*b)-1.,g=3.,c=dot(a,r);g*=1.+c*c*min(0.,b)/(.2-min(0.,b)),a+=(c-a)*.75;if(b<0.)a*=1.+b/16.,c*=1.+b/16.;a*=(d+1.)/(a*d+1.),c*=(d+1.)/(c*d+1.),a+=(a-c)*g,a=clamp(a,0.,1.);return a;}vec3 Ga(vec3 a,float c){float b=dot(a,r);if(c<=0.)a-=(b-a)*c;else{float g=b/(b-min(min(a.r,a.g),a.b)+1e-6),h=(1.-b)/(max(max(a.r,a.g),a.b)-b+1e-6),d=mix(1.,min(g,h),c);d=min(d,2.),a+=(b-a)*(1.-d);}return a;}float ea(float b,float c,float a){a=clamp((a-b)/(c-b),0.,1.);return a*a*a*(a*(a*6.-15.)+10.);}vec3 Ha(vec3 d,float g,float h,float c){vec3 a=mat3(.412456,.212673,.019334,.357576,.715152,.119192,.180438,.072175,.950304)*d;a.x/=.95047,a.z/=1.08883,a=pow(a,vec3(.333333));vec3 b=vec3(116.*a.y-16.,500.*(a.x-a.y),200.*(a.y-a.z));b.y+=30.*h,b.z+=30.*g;float i=c<0.?(b.x-50.)*.2+50.:b.x,m=c<0.?b.x:ea(20.,80.,b.x)*100.,t=c<0.?c+1.:c;b.x=mix(i,m,t),a.y=(b.x+16.)/116.,a.x=b.y/500.+a.y,a.z=a.y-b.z/200.,a*=a*a,a.x*=.95047,a.z*=1.08883,d=mat3(3.240454,-.969266,.055643,-1.537138,1.876011,-.204026,-.498531,.041556,1.057225)*a,d=clamp(d,0.,1.);return d;}vec3 Ia(vec3 a){a=Da(a);float b=da(a,ba,ca);a=Ha(a,Ba,ya,Ca),a=Fa(a,Aa+b),a=Ga(a,clamp(za,-1.,1.)),a=Ea(a);return a;}vec4 j(sampler2D b,vec2 a){a=L?fract(a):a;vec4 c=texture2D(b,a);M&&a!=clamp(a,0.,1.)?c.a=0.:0.;return c;}uniform int A;uniform vec2 Q,R;uniform vec4 S,T;varying vec2 w,o,z,q,C;const vec2 ka=vec2(-3,-5),la=vec2(5,1),ma=vec2(-1,3),na=vec2(7,-7),oa=vec2(1,-3),pa=vec2(-5,5),qa=vec2(3,7),ra=vec2(-7,-1);vec4 ga(){return (j(f,o+ka*q)+j(f,o+la*q)+j(f,o+ma*q)+j(f,o+na*q)+j(f,o+oa*q)+j(f,o+pa*q)+j(f,o+qa*q)+j(f,o+ra*q))/8.;}vec4 Pa(){return (j(k,z+ka*C)+j(k,z+la*C)+j(k,z+ma*C)+j(k,z+na*C)+j(k,z+oa*C)+j(k,z+pa*C)+j(k,z+qa*C)+j(k,z+ra*C))/8.;}float U(in vec2 a,in vec2 c,in vec2 b){a-=c;return a.x*a.x/(b.x*b.x)+a.y*a.y/(b.y*b.y)-1.;}float V(in vec2 m,in vec4 b,vec4 c){vec2 d=(b.zw-b.xy)/2.,a=m-d,g=a.x>0.?c.zy:c.wx;float h=a.y>0.?g.x:g.y;vec2 i=abs(a)-d+h;return min(max(i.x,i.y),0.)+length(max(i,0.))-h;}float B(in vec2 a){if(A==0)return U(a,Q,R);else if(A==1)return V(a,S,T);return 0.;}float H(vec2 c){float a=B(c),b=fwidth(a);b=max(b,1e-5);float d=a/b;return 1.-smoothstep(-.5,.5,d);}void main(){vec4 b=ga(),c=Pa(),a=mix(b,c,G);a.rgb=Ia(a.rgb)*a.a,gl_FragColor=a*p*H(w);}`,Yt="f",mr="k",qa="l",sd="n",wn="p",gr="s",yn="u",Sh="v",bh="y",ld="A",yh="F",sa="G",No="I",Th="L",vh="M",Ih="Q",Ah="R",Eh="S",Ch="T",cd="Z",zo="_",dd="ba",ud="ca",Nh="fa",El="ha",Oh="ia",Cl="sa",pd="ya",hd="za",md="Aa",gd="Ba",_d="Ca",fd="Ja",Rh="La",Nl="Ma",wh="Oa",Ph="Qa",Fh="Ra",xh="Sa",Dh="Ta",Ol="Ua",Mh="bb",Lh="db",Vh="eb",Bh="fb",kh="gb",Sd="jb",Uh="kb",Gh="mb",Hh="nb";var bd=class{constructor(e,t){this._context=null,this._bufferPool=null,this._deviceImageManager=new wr,this._deviceFrameMaterial=null,this._deviceFrameQuad=null,this._hasPendingFrame=!1,this._context=e,this._bufferPool=t;let n=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._deviceFrameQuad=this._bufferPool.allocate(C.VertexFormat.POSITION_F4,n),this._deviceFrameMaterial=this._context.createMaterial("deviceFrame",C.VertexFormat.POSITION_F4,Np,Op)}clearOnContextReset(){this._hasPendingFrame=!1,this._deviceImageManager.clearOnContextReset()}flush(){this._hasPendingFrame&&(C.in_Context.Context_setPremultipliedBlendState(this._context),this._context.draw(C.Primitive.TRIANGLE_STRIP,this._deviceFrameMaterial,this._deviceFrameQuad),this._hasPendingFrame=!1)}isWaitingForDeviceFrameToLoad(e){let t=wr.infoForDevice(e);if(t==null)return!1;let n=this._deviceImageManager.getImage(t,this._context);return!n.isDecoded()&&!n.loadDidFail()}canRenderDeviceFrame(e){let t=wr.infoForDevice(e);return t==null?!1:this._deviceImageManager.getImage(t,this._context).isDecoded()}pixelAtPosition(e,t,n){if(t==null)return E.TRANSPARENT;let r=wr.infoForDevice(n);if(r==null)return E.TRANSPARENT;let o=this._deviceImageManager.getImage(r,this._context);if(!o.isDecoded()||o.width()<=0||o.height()<=0)return E.TRANSPARENT;let i=o.decodedData(),a=n.canvasSpaceTopLeftOffset(r),s=t.topLeft().subtract1(a),c=n.canvasSpaceImageSize(r),l=e.subtract1(s).divide1(c);switch(n.rotation){case"NONE":break;case"CCW_90":{l=new I(1-l.y(),l.x());break}default:break}let u=l.x()*r.nonRotatedImageSize.x()|0,d=l.y()*r.nonRotatedImageSize.y()|0;return i.pixelAtIndex(u,d)}drawPrototypeDeviceIfAny(e,t,n,r){if(n==null)return;let o=wr.infoForDevice(t);if(o==null)return;let i=this._deviceImageManager.getImage(o,this._context);if(!i.isDecoded()&&!i.loadDidFail()){e.invalidate();return}if(i.width()<=0||i.height()<=0)return;let a=i.texture().width()/o.scaleFactor,s=i.texture().height()/o.scaleFactor,c=o.nonRotatedOffset,l=n.topLeft().subtract1(c),u=B.new2();u.setTo1(l.x(),l.y(),a,s);let d=ee.new2();d.copyFrom(r),d.translate2(u.x(),u.y()),t.rotation=="CCW_90"&&(d.translate1(o.nonRotatedOffset),d.rotate(-Pe.Math_PI()/2),d.translate1(o.nonRotatedOffset.negative()),d.translate2(-o.nonRotatedFramePresetSize.x(),0)),d.scale4(u.width(),u.height()),C.in_Material.Material_setUniformMat32(this._deviceFrameMaterial,yn,d),this._deviceFrameMaterial.setUniformSampler(Yt,i.texture(),0),this._hasPendingFrame=!0}};var Rl=class{constructor(e){this._dirtyNewBoundsBuilder=new bt,this._dirtyOldBoundsBuilder=new bt,this._onBoundsInvalidate=null,this._cachedCanvasSpaceBounds=new Map,this._dirtyNodes=new Map,this._canvasSpaceDirtyNewBounds=B.new2(),this._canvasSpaceDirtyOldBounds=B.new2(),this._onBoundsInvalidate=e}initCanvas(e){this._dirtyNodes=new Map,this._cachedCanvasSpaceBounds=new Map,e!=null&&this._initCachedBounds(e)}handleSceneGraphEvent(e){switch(e.property){case 61:case 25:case 69:case 27:case 47:case 15:case 28:case 68:case 45:case 70:case 16:case 46:case 26:case 29:case 85:break;case 19:case 20:case 33:case 65:{this.dirtyNode(e.node);break}default:{this.dirtyNode(e.node);break}}}handleImageLoaded(e){this.dirtyNode(e)}dirtyNode(e){this._dirtyNodes.set(R.toString(e.id()),e.id())}invalidateDirtyTiles(e,t){if(e==null||this._dirtyNodes.size==0)return;let n=[],r=new Map;this._dirtyOldBoundsBuilder.reset(),this._dirtyNewBoundsBuilder.reset(),Me.StringMap_each(this._dirtyNodes,(o,i)=>{let a=e.scene().findNode1(i);if(a!=null&&a.type()=="CANVAS"){this._onBoundsInvalidate(null);return}let s=a==null?void 0:a.topLevelAncestor();if(s!=null){if(!s.hasBeenLoaded())return;r.set(R.toString(s.id()),!0)}let c=Me.StringMap_get(this._cachedCanvasSpaceBounds,o,null),l=a==null?void 0:a.canvasSpaceRenderedBounds();if(c!=null&&this._dirtyOldBoundsBuilder.include3(c),l!=null?(this._dirtyNewBoundsBuilder.include3(l),this._cachedCanvasSpaceBounds.set(o,l)):this._cachedCanvasSpaceBounds.delete(o),t.overlayRenderData()!=null){let u=t.overlayRenderData();if(u!=null)for(let d of u.keys()){let h=u.get2(d),S=c!=null&&c.overlaps(h.bounds),f=l!=null&&l.overlaps(h.bounds);(S||f)&&r.set(h.overlayId,!0)}}}),e.invalidateNestedBackgroundBlurRenderTrees(r,n);for(let o=0,i=n.length;o<i;o=o+1){let a=n[o];this._dirtyOldBoundsBuilder.include3(a)}this._dirtyOldBoundsBuilder.isValid()&&(this._dirtyOldBoundsBuilder.buildTo(this._canvasSpaceDirtyOldBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyOldBounds)),this._dirtyNewBoundsBuilder.isValid()&&(this._dirtyNewBoundsBuilder.buildTo(this._canvasSpaceDirtyNewBounds),this._onBoundsInvalidate(this._canvasSpaceDirtyNewBounds)),this._dirtyNodes=new Map}_initCachedBounds(e){for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);this._cachedCanvasSpaceBounds.set(R.toString(r.id()),r.canvasSpaceRenderedBounds()),this._initCachedBounds(r)}}};var yd=class{onClick(){this._timeOfLastClick=We.seconds()}getOpacity(){let e=We.seconds()-this._timeOfLastClick;return e<this._animationDuration?1-this._easingFunction.get(e):0}constructor(){this._animationDuration=.7,this._easingFunction=new pr([0,0,.58,1],.7),this._timeOfLastClick=0}},Td=class{constructor(e,t){this._hotspotMaterial=null,this._hotspotQuad=null,this._context=null,this._context=e,this._hotspotMaterial=this._context.createMaterial("hotspot",C.VertexFormat.POSITION_F4,Ep,Cp);let n=new Uint8Array(new Float32Array([0,0,0,1,0,1,0,0,1,0,1,1,1,1,1,0]).buffer);this._hotspotQuad=t.allocate(C.VertexFormat.POSITION_F4,n)}draw(e,t,n,r,o){if(r<=0)return;let i=e;for(let a of n){let s=ee.new2();s.copyFrom(i);let c=a.canvasSpaceBounds;s.translate2(c.x(),c.y()),s.scale4(c.width(),c.height());let l=B.new2();a.canvasSpaceClipBounds.transformInto1(l,i);let u=new I(2/c.width(),2/c.height());u.divideUpdate(t*o),C.in_Material.Material_setUniformMat32(this._hotspotMaterial,yn,s),C.in_Material.Material_setUniformVec22(this._hotspotMaterial,Ph,u),this._hotspotMaterial.setUniformVec41(Uh,l.x(),l.y(),l.width(),l.height()),this._hotspotMaterial.setUniformFloat(Mh,r),C.in_Context.Context_setUnpremultipliedBlendState(this._context),this._context.draw(C.Primitive.TRIANGLE_STRIP,this._hotspotMaterial,this._hotspotQuad)}}},wl=class{constructor(e,t){this.canvasSpaceBounds=e,this.canvasSpaceClipBounds=t}},vd=class{constructor(){this.backgroundColor=0,this.hotspots=null,this.hotspotOpacity=0,this.particles=null,this.mouse=null,this.renderDots=!1}};var Tn;(t=>{let g;(s=>(s[s.NON_RENDERABLE=0]="NON_RENDERABLE",s[s.RENDERABLE_GEOMETRY=1]="RENDERABLE_GEOMETRY",s[s.RENDERABLE_TEXT=2]="RENDERABLE_TEXT",s[s.RENDERABLE_GROUP=3]="RENDERABLE_GROUP",s[s.CUSTOM_RENDER_TREE=4]="CUSTOM_RENDER_TREE"))(g=t.RenderableContentType||(t.RenderableContentType={}));let e;(r=>{function n(o){return t.RenderableContentType[o]}r.RenderableContentType_toString=n})(e=t.in_RenderableContentType||(t.in_RenderableContentType={}))})(Tn||(Tn={}));var ar=class{constructor(){if(arguments.length==0)this._bytes=null,this._view=null,this._count=0,this._capacity=0,this._capacity=256,this._bytes=new Uint8Array(this._capacity),this._view=new DataView(this._bytes.buffer);else if(arguments.length==1){let e=arguments[0];this._bytes=null,this._view=null,this._count=0,this._capacity=0,this._bytes=e,this._count=this._capacity=e.length,this._view=new DataView(e.buffer,e.byteOffset,e.length)}}clear(){this._count=0}clone(){return new ar(new Uint8Array(this.bytes()))}isEmpty(){return this._count==0}byteCount(){return this._count}bytes(){return this._bytes.subarray(0,this._count)}floatAt(e){return this._view.getFloat32(e,!0)}byteAt(e){return this._bytes[e]}appendFloat(e){return this._count+4>this._capacity&&this._grow(this._count+4),this._view.setFloat32(this._count,e,!0),this._count=this._count+4,this}appendByte(e){return this._count+1>this._capacity&&this._grow(this._count+1),this._bytes[this._count]=e,this._count=this._count+1,this}prependBytes(e){let t=e.byteCount();return this._count+t>this._capacity&&this._grow(this._count+t),this._bytes.set(this.bytes(),t),this._bytes.set(e.bytes()),this._count=this._count+t,this}appendBytes(e){let t=e.byteCount();return this._count+t>this._capacity&&this._grow(this._count+t),this._bytes.set(e.bytes(),this._count),this._count=this._count+t,this}setFloatAt(e,t){this._view.setFloat32(e,t,!0)}_grow(e){this._capacity=e*2;let t=new Uint8Array(this._capacity);this._bytes!=null&&t.set(this._bytes),this._bytes=t,this._view=new DataView(t.buffer)}},Pl;(e=>{function g(t,n){if(t==null||n==null||t.byteCount()!=n.byteCount())return!1;for(let r=0,o=t.byteCount();r<o;r=r+1)if(t.byteAt(r)!=n.byteAt(r))return!1;return!0}e.FrozenDataArray_equals=g})(Pl||(Pl={}));var jn=class{recomposed(){let e=ee.new2();e.setM00(this.m00),e.setM01(this.m01),e.setM10(this.m10),e.setM11(this.m11),e.setM02(this.translation.x()),e.setM12(this.translation.y());let t=Pe.Math_PI()/180*this.angleDegrees,n=Math.cos(t),r=Math.sin(t),o=ee.new2();return o.setM00(n),o.setM01(-r),o.setM10(r),o.setM11(n),e.multiply(o),e.setM00(e.m00()*this.scale.x()),e.setM01(e.m01()*this.scale.y()),e.setM10(e.m10()*this.scale.x()),e.setM11(e.m11()*this.scale.y()),e}static from(e){let t=new jn,n=e.m00(),r=e.m10(),o=e.m01(),i=e.m11();t.translation=I.new3(e.translation()),t.scale=I.new3(e.scale1()),n*i-r*o<0&&(n<i?t.scale.setX(-t.scale.x()):t.scale.setY(-t.scale.y())),t.scale.x()!=0&&(n*=1/t.scale.x(),r*=1/t.scale.x()),t.scale.y()!=0&&(o*=1/t.scale.y(),i*=1/t.scale.y());let s=Math.atan2(r,n);if(s!=0){let c=-r,l=n,u=n,d=r,h=o,S=i;n=l*u+c*h,r=l*d+c*S,o=-c*u+l*h,i=-c*d+l*S}return t.angleDegrees=180/Pe.Math_PI()*s,t.m00=n,t.m10=r,t.m01=o,t.m11=i,t}static lerp1(e,t,n){let r=jn.from(e),o=jn.from(t);return jn.lerp2(r,o,n).recomposed()}static lerp2(e,t,n){(e.scale.x()<0&&t.scale.y()<0||e.scale.y()<0&&t.scale.x()<0)&&(e.scale.setX(-e.scale.x()),e.scale.setY(-e.scale.y()),e.angleDegrees+=e.angleDegrees<0?180:-180),e.angleDegrees==0&&(e.angleDegrees=360),t.angleDegrees==0&&(t.angleDegrees=360),Math.abs(e.angleDegrees-t.angleDegrees)>180&&(e.angleDegrees>t.angleDegrees?e.angleDegrees-=360:t.angleDegrees-=360);let r=new jn;return r.translation=e.translation.multiply(1-n).add1(t.translation.multiply(n)),r.scale=e.scale.multiply(1-n).add1(t.scale.multiply(n)),r.angleDegrees=e.angleDegrees*(1-n)+t.angleDegrees*n,r.m00=e.m00*(1-n)+t.m00*n,r.m10=e.m10*(1-n)+t.m10*n,r.m01=e.m01*(1-n)+t.m01*n,r.m11=e.m11*(1-n)+t.m11*n,r}constructor(){this.translation=I.new2(),this.scale=I.new2(),this.angleDegrees=0,this.m00=0,this.m01=0,this.m10=0,this.m11=0}};var zh;(t=>{function g(){return[]}t.new1=g;function e(n){return n.slice()}t.new2=e})(zh||(zh={}));var nn;(m=>{function g(p){return p.length}m.FrozenList_count=g;function e(p){return p.length==0}m.FrozenList_isEmpty=e;function t(p,_){return p[_]}m.FrozenList_get=t;function n(p){return ie.List_last(p)}m.FrozenList_last=n;function r(p,_){return p.some(_)}m.FrozenList_any=r;function o(p,_){return p.filter(_)}m.FrozenList_filter=o;function i(p,_){p.forEach(_)}m.FrozenList_each=i;function a(p){return p[0]}m.FrozenList_first=a;function s(p,_){return p.map(_)}m.FrozenList_map=s;function c(p){return p.slice()}m.FrozenList_clone=c;function l(p,_,T){return p.slice(_,T)}m.FrozenList_slice=l;function u(p,_){let T=p.slice();return ie.List_appendOne(T,_),T}m.FrozenList_cloneAndAppendOne=u;function d(p,_){let T=p.slice();return ie.List_removeOne(T,_),T}m.FrozenList_cloneAndRemoveOne=d;function h(p,_,T){return ie.List_equalsWithComparison(p,_,T)}m.FrozenList_equals=h;function S(p,_,T){return ie.List_reduce(p,_,T)}m.FrozenList_reduce=S;function f(p,_){return p.indexOf(_)!=-1}m._in=f;function y(p,_){for(let T of p)if(_(T))return!0;return!1}m.FrozenList_contains=y;function v(p,_){let T=p.slice();return T.sort(_),T}m.FrozenList_sorted=v;function b(p,_){let T=p.slice();return T.push(_),T}m.FrozenList_cloneAndAppend=b})(nn||(nn={}));var la;(t=>{function g(n){return n=="GRADIENT_LINEAR"||n=="GRADIENT_RADIAL"||n=="GRADIENT_ANGULAR"||n=="GRADIENT_DIAMOND"}t.isGradient=g;function e(n){return n=="GRADIENT_ANGULAR"}t.shouldWrap=e})(la||(la={}));var lt=class{constructor(e,t){this.color=e,this.position=t}};lt.COMPARE=(e,t)=>en.double_compare(e.position,t.position),lt.EQUALS=(e,t)=>e.color==t.color&&e.position==t.position;var xl=class{id(){return this._id}asSinglePaint(){return null}asVolatilePaint(){return null}debugString(){return""}isGradient(){switch(this.type()){case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":return!0}return!1}constructor(){this._id=xl._previousID=xl._previousID+1}},Fl=xl;Fl._previousID=0;var Oo=class extends Fl{constructor(e){super();this._type=null,this._color=E.TRANSPARENT,this._opacity=1,this._isEnabled=!0,this._colorStops=null,this._blendMode="NORMAL",this._image=null,this._imageThumbnail=null,this._video=null,this._videoPlaybackParams="",this._transform=Nt.FrozenAffineTransform_IDENTITY,this._rotationDeg=0,this._scalingFactor=1,this._imageScaleMode="STRETCH",this._filterColorAdjust=null,this._originalImageWidth=0,this._originalImageHeight=0,this._decodedImageIsReady=!1,this._decodedImageThumbnailIsReady=!1,this._type=e}type(){return this._type}color(){return this._color}opacity(){return this._opacity}isEnabled(){return this._isEnabled}isVolatile(){return!1}isVisible(){return this._isEnabled&&this._opacity>0}blendMode(){return this._blendMode}transform(){return this._transform}setIsEnabled(e){this._isEnabled=e}debugString(){return`SinglePaint id=${this._id} type=${this._type} blend=${this._blendMode} opacity=${this._opacity}${this._isEnabled?"":" [hidden]"}`}image(){return this._image}imageThumbnail(){return this._imageThumbnail}video(){return this._video}imageScaleMode(){return this._imageScaleMode}rotationDeg(){return this._rotationDeg}scalingFactor(){return this._scalingFactor}filterColorAdjust(){return this._filterColorAdjust}decodedImageIsReady(){return this._decodedImageIsReady}decodedImageThumbnailIsReady(){return this._decodedImageThumbnailIsReady}colorStops(){return this._colorStops}lastStopIsTransparent(){return this._colorStops.length!=0&&E.alpha(ie.List_last(this._colorStops).color)==0}isImageAvailable(){return this._image!=null&&this._image.isDecoded()}isImageThumbnailAvailable(){return this._image!=null&&this._image.isDecoded()}setType(e){this._type=e}setColor(e){this._color=e}setBlendMode(e){this._blendMode=e}setImage(e){this._image=e}setImageThumbnail(e){this._imageThumbnail=e}setVideo(e){this._video!=null&&e==null&&console.log(new Error().stack),this._video=e}videoPlaybackParams(e){this._videoPlaybackParams=e}setTransform(e){this._transform=e}setTransform1(e){this._transform=e.clone()}setImageScaleMode(e){this._imageScaleMode=e}setRotationDeg(e){this._rotationDeg=e}setScalingFactor(e){this._scalingFactor=e}setFilterColorAdjust(e){this._filterColorAdjust=e}setDecodedImageIsReady(e){this._decodedImageIsReady=e}setDecodedImageThumbnailIsReady(e){this._decodedImageThumbnailIsReady=e}setColorStops(e){this._colorStops=e}setColorStops1(e){this._colorStops=e.slice()}setOpacity(e){this._opacity=e}setOriginalImageWidth(e){this._originalImageWidth=e}setOriginalImageHeight(e){this._originalImageHeight=e}allocateBoundsToImageRatio(e,t){let n=I.new3(e);return this._rotationDeg!=0&&(ee.new2().rotatedBy(this._rotationDeg*(Pe.Math_PI()/180)).transformPoint(t),t.makeAbs()),n.divideUpdate1(t),n}allocateImageSize(){let e=this._video!=null&&this._video.didLoad(this),t=this._image!=null&&this._image.isDecoded(),n=this._imageThumbnail!=null&&this._imageThumbnail.isDecoded();return e?this._video.size(this):t?new I(this._image.width(),this._image.height()):n?this._originalImageWidth!=0&&this._originalImageHeight!=0?new I(this._originalImageWidth,this._originalImageHeight):new I(this._imageThumbnail.width(),this._imageThumbnail.height()):null}allocateImageTransformForGeometrySize(e){let t=this._rotationDeg*(Pe.Math_PI()/180),n=ee.new2(),r=this.allocateImageSize();r==null&&ze("Trying to render image before it is loaded");let o=this.allocateBoundsToImageRatio(e,r);switch(this.imageScaleMode()){case"FILL":{n=n.translatedBy2(.5,.5).rotatedBy(-t).scaledBy3(o.x()/o.max1(),o.y()/o.max1()).translatedBy2(-.5,-.5);break}case"FIT":{n=n.translatedBy2(.5,.5).rotatedBy(-t).scaledBy3(o.x()/o.min1(),o.y()/o.min1()).translatedBy2(-.5,-.5);break}case"STRETCH":{n.copyFrom(this.transform());break}case"TILE":{n=n.translatedBy2(.5,.5).rotatedBy(-t).translatedBy2(-.5,-.5).scaledBy2(1/this.scalingFactor()).scaledBy1(o);break}}return n}decodedImage(){return this.image().isDecoded()?this.image():null}decodedImageThumbnail(){return this.imageThumbnail().isDecoded()?this.imageThumbnail():null}scalingFactorForImage(e){return this.image()==null||e==null||e.width()==0||this.image().width()==0?this.scalingFactor():this.scalingFactor()*(this.image().width()/e.width())}colorAdjustIsActive(){return this._filterColorAdjust!=null&&(this._filterColorAdjust.tint!=0||this._filterColorAdjust.vibrance!=0||this._filterColorAdjust.shadows!=0||this._filterColorAdjust.highlights!=0||this._filterColorAdjust.exposure!=0||this._filterColorAdjust.contrast!=0||this._filterColorAdjust.temperature!=0)}colorAdjustSetData(e){e.setUniformFloat(pd,this._filterColorAdjust.tint),e.setUniformFloat(hd,this._filterColorAdjust.vibrance),e.setUniformFloat(dd,this._filterColorAdjust.shadows),e.setUniformFloat(ud,this._filterColorAdjust.highlights),e.setUniformFloat(md,this._filterColorAdjust.exposure),e.setUniformFloat(_d,this._filterColorAdjust.contrast),e.setUniformFloat(gd,this._filterColorAdjust.temperature)}isEnabledAndVisible(){if(!this.isEnabled()||this.opacity()<=0)return!1;switch(this.type()){case"SOLID":return E.alpha(this.color())>0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let e=0,t=this.colorStops().length;e<t;e=e+1)if(E.alpha(this.colorStops()[e].color)>0)return!0;return!1}}return!0}hasAnyFullyTransparentAreas(){if(!this.isEnabled()||this.opacity()<=0)return!0;switch(this.type()){case"SOLID":return E.alpha(this.color())==0;case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":{for(let e=0,t=this.colorStops().length;e<t;e=e+1)if(E.alpha(this.colorStops()[e].color)==0)return!0;return!1}case"EMOJI":case"IMAGE":case"VIDEO":return!0}return!0}hasAnimatingMedia(){return this.image()!=null&&this.image().gif()!=null||this.video()!=null}optimized(){if(this.isGradient()&&this.colorStops().length!=0){let e=this.colorStops()[0].color;for(let t=1,n=this.colorStops().length;t<n;t=t+1)if(e!=this.colorStops()[t].color)return this;return Oo.create("SOLID",this.opacity(),this.blendMode(),this.isEnabled(),e)}return this}equals1(e){return e.isVolatile()?!1:this.equals2(e.asSinglePaint())}equals2(e){if(this._colorStops==null||e.colorStops()==null){if(this._colorStops==null!=(e.colorStops()==null))return!1}else if(!nn.FrozenList_equals(this._colorStops,e.colorStops(),lt.EQUALS))return!1;if(this._transform==null||e.transform()==null){if(this._transform==null!=(e.transform()==null))return!1}else if(!this.transform().equals1(e.transform()))return!1;if(this._video==null||e.video()==null){if(this._video==null!=(e.video()==null))return!1}else if(this._video.hash()!=e.video().hash())return!1;if(this._image==null||e.image()==null){if(this._image==null!=(e.image()==null))return!1}else if(this._image.objectHash()!=e.image().objectHash())return!1;if(this._imageThumbnail==null||e.imageThumbnail()==null){if(this._imageThumbnail==null!=(e.imageThumbnail()==null))return!1}else if(this._imageThumbnail.objectHash()!=e.imageThumbnail().objectHash())return!1;return this._type==e.type()&&this._blendMode==e.blendMode()&&this._color==e.color()&&this._isEnabled==e.isEnabled()&&this._opacity==e.opacity()&&this._rotationDeg==e.rotationDeg()&&this._scalingFactor==e.scalingFactor()&&this._imageScaleMode==e.imageScaleMode()&&this._filterColorAdjust==e.filterColorAdjust()&&this._decodedImageIsReady==e.decodedImageIsReady()&&this._decodedImageThumbnailIsReady==e.decodedImageThumbnailIsReady()}clone(){return this.cloneAsSinglePaint()}cloneAsSinglePaint(){let e=new Oo(this._type);return e._blendMode=this._blendMode,e._color=this.color(),e._colorStops=this._colorStops,e._image=this._image,e._imageThumbnail=this._imageThumbnail,e._video=this._video,e._isEnabled=this._isEnabled,e._opacity=this._opacity,e._transform=this._transform,e._rotationDeg=this._rotationDeg,e._scalingFactor=this._scalingFactor,e._imageScaleMode=this._imageScaleMode,e._filterColorAdjust=this._filterColorAdjust,e._decodedImageIsReady=this._decodedImageIsReady,e._decodedImageThumbnailIsReady=this._decodedImageThumbnailIsReady,e._originalImageWidth=this._originalImageWidth,e._originalImageHeight=this._originalImageHeight,e}isOpaque(){if(this.opacity()<1||this.blendMode()!="NORMAL")return!1;switch(this.type()){case"SOLID":return E.isOpaque(this._color);case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{for(let e=0,t=this._colorStops.length;e<t;e=e+1){let n=this._colorStops[e];if(!E.isOpaque(n.color))return!1}return!0}case"EMOJI":case"IMAGE":case"VIDEO":return!1}return!1}flattenedStops(){let e=this._colorStops.slice();if(e.sort((t,n)=>en.double_compare(t.position,n.position)),la.shouldWrap(this.type())&&e.length>=2){let t=e[0],n=ie.List_last(e);if(t.position>0)if(n.position<1){let r=E.mix(t.color,n.color,t.position/(1-n.position+t.position));e.unshift(new lt(r,0)),e.push(new lt(r,1))}else e.unshift(new lt(n.color,0));else n.position<1&&e.push(new lt(t.color,1))}return e}asSinglePaint(){return this}getCanvasSpaceUnclippedImageSize(e){if(!this.isImageAvailable()&&!this.isImageThumbnailAvailable())return ye.FrozenVector_ZERO;let t=this.allocateImageSize(),n=null;switch(this.imageScaleMode()){case"STRETCH":{n=e.divide1(this._transform.scale1());break}case"FILL":{let r=this.allocateBoundsToImageRatio(e,t);r.x()>r.y()?n=new I(e.x(),r.x()*this._image.height()):n=new I(r.y()*this._image.width(),e.y());break}case"FIT":{let r=this.allocateBoundsToImageRatio(e,t);r.x()>r.y()?n=new I(r.y()*this._image.width(),e.y()):n=new I(e.x(),r.x()*this._image.height());break}case"TILE":return ye.FrozenVector_ZERO;default:return console.warn(`Unimplemented imageScaleMode ${this.imageScaleMode()} in getCanvasSpaceUnclippedImageSize`),ye.FrozenVector_ZERO}return n}static create(e,t,n,r,o){let i=new Oo(e);return i.setOpacity(t),i.setBlendMode(n),i.setIsEnabled(r),i.setColor(o),i}static createSolid(e,t){return Oo.create("SOLID",t*E.alphaF(e),"NORMAL",!0,E.withAlpha(e,255))}static createLinearGradient(e){let t=Oo.create("GRADIENT_LINEAR",1,"NORMAL",!0,E.BLACK);return t.setColorStops1(e),t}static createRadialGradient(e){let t=Oo.create("GRADIENT_RADIAL",1,"NORMAL",!0,E.BLACK);return t.setColorStops1(e),t}static createAngularGradient(e){let t=Oo.create("GRADIENT_ANGULAR",1,"NORMAL",!0,E.BLACK);return t.setColorStops1(e),t}static createDiamondGradient(e){let t=Oo.create("GRADIENT_DIAMOND",1,"NORMAL",!0,E.BLACK);return t.setColorStops1(e),t}},ne=Oo;ne.TRANSPARENT=Oo.create("SOLID",0,"NORMAL",!0,E.BLACK),ne.SOLID_BLACK=Oo.create("SOLID",1,"NORMAL",!0,E.BLACK);var ca=class extends Fl{constructor(e,t,n,r,o){super();this._from=null,this._to=null,this._getEasedT=null,this._fromCanvasSpaceNodeSize=null,this._toCanvasSpaceNodeSize=null,this._cachedFromTransform=null,this._cachedToTransform=null,this._cachedFromOffsetFromCenter=null,this._cachedToOffsetFromCenter=null,this._cachedFromImageOnCanvasSize=null,this._cachedToImageOnCanvasSize=null,this._from=e,this._to=t,this._getEasedT=n,this._fromCanvasSpaceNodeSize=r,this._toCanvasSpaceNodeSize=o,this._needsImageDimensionsForInterpolation()&&this._computeCachedImageDimensions()}_needsImageDimensionsForInterpolation(){return this.type()!="IMAGE"&&this.type()!="VIDEO"||!this._from.isImageAvailable()&&!this._from.isImageThumbnailAvailable()||!this._to.isImageAvailable()&&!this._to.isImageThumbnailAvailable()?!1:this._from.imageScaleMode()!="TILE"&&this._to.imageScaleMode()!="TILE"&&(this._from.imageScaleMode()=="STRETCH"||this._to.imageScaleMode()=="STRETCH"||this._from.imageScaleMode()!=this._to.imageScaleMode())}_computeCachedImageDimensions(){this.from().imageScaleMode()!="STRETCH"?(this._cachedFromTransform=this._from.allocateImageTransformForGeometrySize(this._fromCanvasSpaceNodeSize),this._cachedFromOffsetFromCenter=new I(0,0)):(this._cachedFromTransform=this.from().transform(),this._cachedFromOffsetFromCenter=new I(.5,.5).subtract1(this._cachedFromTransform.scale1().divide(2).add1(this._cachedFromTransform.translation()))),this.to().imageScaleMode()!="STRETCH"?(this._cachedToTransform=this._to.allocateImageTransformForGeometrySize(this._toCanvasSpaceNodeSize),this._cachedToOffsetFromCenter=new I(0,0)):(this._cachedToTransform=this.to().transform(),this._cachedToOffsetFromCenter=new I(.5,.5).subtract1(this._cachedToTransform.scale1().divide(2).add1(this._cachedToTransform.translation()))),this._cachedFromImageOnCanvasSize=this.from().getCanvasSpaceUnclippedImageSize(this._fromCanvasSpaceNodeSize),this._cachedToImageOnCanvasSize=this.to().getCanvasSpaceUnclippedImageSize(this._toCanvasSpaceNodeSize)}isEnabled(){return this._from.isEnabled()||this._to.isEnabled()}isVisible(){return this.isEnabled()&&(this._from.opacity()>0||this._to.opacity()>0)}isVolatile(){return!0}type(){return this._from.type()}blendMode(){return this._from.blendMode()}setIsEnabled(e){this._from.setIsEnabled(e),this._to.setIsEnabled(e)}isEnabledAndVisible(){return this._from.isEnabledAndVisible()||this._to.isEnabledAndVisible()}debugString(){return`VolatilePaint from=[${this._from.debugString()}] to=[${this._to.debugString()}]`}t(){return this._getEasedT()}from(){return this._from}to(){return this._to}color(){return E.mix(this._from.color(),this._to.color(),this._getEasedT())}isOpaque(){return this._from.isOpaque()&&this._to.isOpaque()}transform(){let e=new I(.5,.5),t=this._from.transform().clone().translatedBy1(e),n=this._to.transform().clone().translatedBy1(e);return jn.lerp1(t,n,this.t()).translatedBy1(e.negative())}allocateImageTransformForGeometrySize(e){let t=ee.new2(),n=I.lerp(this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize,this.t());if(this.from().imageScaleMode()=="STRETCH"||this.to().imageScaleMode()=="STRETCH"||this.from().imageScaleMode()!=this.to().imageScaleMode()){(this._cachedFromTransform==null||this._cachedToTransform==null||this._cachedFromOffsetFromCenter==null||this._cachedToOffsetFromCenter==null||this._cachedFromImageOnCanvasSize==null||this._cachedToImageOnCanvasSize==null)&&this._computeCachedImageDimensions();let r=I.lerp(this._cachedFromImageOnCanvasSize,this._cachedToImageOnCanvasSize,this.t()),o=n.divide1(r),i=I.lerp(this._cachedFromOffsetFromCenter,this._cachedToOffsetFromCenter,this.t()),a=new I(.5,.5).subtract1(i).subtract1(o.divide(2)),s=en.double_lerp(this._cachedFromTransform.toAngle(),this._cachedToTransform.toAngle(),this.t());return t.translatedBy1(a).rotatedBy(s).scaledBy1(o)}else{let r=this._from.allocateImageTransformForGeometrySize(n),o=this._to.allocateImageTransformForGeometrySize(n);return t.copyFrom(jn.lerp1(r,o,this.t())),t}}opacity(){return en.double_clamp(en.double_lerp(this.from().opacity(),this.to().opacity(),this.t()),0,1)}colorAdjustIsActive(){return this._from.colorAdjustIsActive()||this._to.colorAdjustIsActive()}colorAdjustSetData(e){e.setUniformFloat(pd,en.double_clamp(en.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().tint:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().tint:0,this.t()),-1,1)),e.setUniformFloat(hd,en.double_clamp(en.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().vibrance:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().vibrance:0,this.t()),-1,1)),e.setUniformFloat(dd,en.double_clamp(en.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().shadows:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().shadows:0,this.t()),-1,1)),e.setUniformFloat(ud,en.double_clamp(en.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().highlights:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().highlights:0,this.t()),-1,1)),e.setUniformFloat(md,en.double_clamp(en.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().exposure:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().exposure:0,this.t()),-1,1)),e.setUniformFloat(_d,en.double_clamp(en.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().contrast:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().contrast:0,this.t()),-.3,.3)),e.setUniformFloat(gd,en.double_clamp(en.double_lerp(this.from().filterColorAdjust()!=null?this.from().filterColorAdjust().temperature:0,this.to().filterColorAdjust()!=null?this.to().filterColorAdjust().temperature:0,this.t()),-1,1))}equals1(e){return e.isVolatile()?this.equals2(e.asVolatilePaint()):!1}equals2(e){if(!e.isVolatile())return!1;let t=e;return this._from.equals2(t._from.asSinglePaint())&&this._to.equals2(t._to.asSinglePaint())&&this._getEasedT==t._getEasedT&&this._fromCanvasSpaceNodeSize.equals(t._fromCanvasSpaceNodeSize)&&this._toCanvasSpaceNodeSize.equals(t._toCanvasSpaceNodeSize)}clone(){return this.cloneAsVolatilePaint()}cloneAsVolatilePaint(){return new ca(this._from.cloneAsSinglePaint(),this._to.cloneAsSinglePaint(),this._getEasedT,this._fromCanvasSpaceNodeSize,this._toCanvasSpaceNodeSize)}hasAnyFullyTransparentAreas(){return this._from.hasAnyFullyTransparentAreas()&&this._to.hasAnyFullyTransparentAreas()}asVolatilePaint(){return this}eitherPaint(e){return e(this._from)||e(this._to)}static create(e,t,n,r,o){return new ca(e,t,o,n,r)}},Wh;(e=>e.FrozenPaint_EMPTY_LIST=[])(Wh||(Wh={}));var Re;(V=>{function g(H,M){return[ne.createSolid(H,M)]}V.createFromSolidColor=g;function e(H){return H}V.create1=e;function t(H){return H}V.create2=t;function n(H){return[H].slice()}V.fromPaint=n;function r(H){return H}V.asPaintList=r;function o(H){return H.length==0}V.isEmpty=o;function i(H){return H.length}V.count=i;function a(H,M){return H[M]}V.get=a;function s(H){return H[0]}V.first=s;function c(H){return ie.List_last(H)}V.last=c;function l(H){return H.slice()}V.clone=l;function u(H){let M=!1;for(let K=0,U=H.length;K<U;K=K+1)H[K].type()=="EMOJI"&&(M=!0);return M}V.hasEmoji=u;function d(H,M){return nn.FrozenList_equals(H,M,(K,U)=>K==null||U==null?K==null==(U==null):K.equals1(U))}V.equals=d;function h(H){return H.length==1?H[0]:null}V.onlyPaintOrNull=h;function S(H){let M=h(H);return M!=null&&M.type()=="SOLID"&&!M.isVolatile()?M:null}V.onlySolidPaintOrNull=S;function f(H){for(let M=0,K=H.length;M<K;M=M+1){let U=H.length-1-M;if(!H[U].isEnabledAndVisible())continue;let P=H[U];return P!=null&&P.type()=="SOLID"&&!P.isVolatile()&&P.asSinglePaint().isOpaque()?P:null}return null}V.firstPaintIfSolidAndOpaqueOrNull=f;function y(H){return H.length==1&&H[0].type()=="EMOJI"}V.isEmojiPaint=y;function v(H){for(let M=0,K=H.length;M<K;M=M+1){let U=H[M].asSinglePaint();if(U!=null){if(U.blendMode()!="NORMAL"&&U.blendMode()!="PASS_THROUGH")return!1}else{let P=H[M].asVolatilePaint();if(P!=null&&P.eitherPaint(J=>J.blendMode()!="NORMAL"&&J.blendMode()!="PASS_THROUGH"))return!1}}return!0}V.isIsolated=v;function b(H){for(let M=0,K=H.length;M<K;M=M+1)if(H[M].isEnabledAndVisible())return!0;return!1}V.containsAtLeastOneVisiblePaint=b;function m(H){for(let M=0,K=H.length;M<K;M=M+1){let U=H[M].asSinglePaint(),P=H[M].asVolatilePaint();if(U==null&&P!=null&&P.isVisible()||U!=null&&U.isVisible()&&!U.hasAnyFullyTransparentAreas())return!0}return!1}V.containsAtLeastOneVisibleNotFullyTransparentPaint=m;function p(H){for(let M=0,K=H.length;M<K;M=M+1){if(!H[M].isEnabledAndVisible())continue;let U=H[M].asSinglePaint();if(U!=null){if(U.isOpaque())return!0}else{let P=H[M].asVolatilePaint();if(P!=null&&P.isOpaque())return!0}}return!1}V.containsAtLeastOneVisibleOpaquePaint=p;function _(H){for(let M=0,K=H.length;M<K;M=M+1){let U=H[M].asSinglePaint();if(U!=null){if(!U.isOpaque())return!0}else{let P=H[M].asVolatilePaint();if(P!=null&&!P.isOpaque())return!0}}return!1}V.containsAtLeastOneNonOpaquePaint=_;function T(H){for(let M=0,K=H.length;M<K;M=M+1){let U=H[M].asSinglePaint();if(U==null&&H[M].asVolatilePaint()!=null||!U.hasAnyFullyTransparentAreas())return!1}return!0}V.hasAnyFullyTransparentAreas=T;function N(H){for(let M=0,K=H.length;M<K;M=M+1){let U=H[M].asSinglePaint();if(U!=null){if(U.hasAnimatingMedia())return!0}else{let P=H[M].asVolatilePaint();if(P!=null&&P.eitherPaint(J=>J.hasAnimatingMedia()))return!0}}return!1}V.hasAnimatingMediaPaints=N;function k(H){for(let M=0,K=H.length;M<K;M=M+1)if(H[M].isVolatile())return!0;return!1}V.hasVolatilePaints=k;function j(H,M){var P,J;let K,U;for(let z=0,O=H.length;z<O;z=z+1){let G=H[z].asSinglePaint();(G==null?void 0:G.video())!=null&&M(G);let L=H[z].asVolatilePaint();((P=L==null?void 0:L.to())==null?void 0:P.video())!=null&&M(L.to()),((J=L==null?void 0:L.from())==null?void 0:J.video())!=null&&M(L.from())}}V.forEachPaintWithVideo=j;function te(H){if(v(H))return[H].slice();let M=[],K="NORMAL",U=[];for(let P=0,J=H.length;P<J;P=P+1){let z=H[P];(z.blendMode()!=K||z.blendMode()!="NORMAL")&&U.length!=0&&(M.push(U.slice()),U.length=0),K=z.blendMode(),U.push(z)}return U.length!=0&&M.push(U.slice()),M}V.isolatedPaints=te;function Y(H){if(k(H))return H;if(H.length==2&&H[0].type()=="SOLID"&&ie.List_last(H).asSinglePaint().isGradient()){let K=H[0].asSinglePaint(),U=E.multiplyOpacity(K.color(),K.opacity()),P=ie.List_last(H).clone(),J=[],z=-1,O=!0,G=P.colorStops();for(let L=0,$=G.length;L<$;L=L+1){let se=G[L];if(z>=0&&z!=E.alpha(se.color)){O=!1;break}z=E.alpha(se.color);let nt=E.multiplyOpacity(se.color,P.opacity());J.push(new lt(E.blend(U,nt),se.position))}if(O)return P.setOpacity(1),P.setColorStops1(J),Y([P].slice())}let M=H.length;for(let K=0;K<M;K=K+1){let U=H[K].asSinglePaint().optimized();if(U==H[K])continue;let P=H.slice().slice(0,K);for(P.push(U);(K=K+1)<M;)P.push(H[K].asSinglePaint().optimized());return P}return H}V.optimize=Y,V.SOLID_BLACK=[ne.createSolid(E.BLACK,1)],V.EMPTY=[]})(Re||(Re={}));var Ir=class{constructor(e,t){this.a=e,this.b=t}};var Pr=class{constructor(){this._float=null,this._int=null,this._value=0,this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer)}reset(){this._value=0}value(){return this._value}hash1(e){this._float[0]=e,this._value=Pr.combine(this._value,this._int[0])}hash2(e){this._value=Pr.combine(this._value,e)}static combine(e,t){return t+-1640531527+(e<<6)+(e>>2)}};var Dl=class{constructor(e,t){this.bounds=e,this.isRect=t}},ve=class{constructor(){if(arguments.length==1){let e=arguments[0];this._data=null,this._cachedInfo=null,this._hash=null,this.VERTEX_PATTERN_COUNT=5,this.VERTEX_PATTERN=[null,null,null,null,null],this._data=e,this._cachedInfo=null,this._hash=null}else if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this._data=null,this._cachedInfo=null,this._hash=null,this.VERTEX_PATTERN_COUNT=5,this.VERTEX_PATTERN=[null,null,null,null,null],this._data=e,this._cachedInfo=t,this._hash=new fe(n)}}_invalidateCachedData(){this._cachedInfo=null,this._hash=null}equals2(e){return e instanceof ve?this.equals1(e):!1}equals1(e){return this._data.byteCount()!=e._data.byteCount()||this.hash()!=e.hash()?!1:Pl.FrozenDataArray_equals(this._data,e._data)}clone(){return this.getMutableClone()}getMutableClone(){return new vt(this._data.clone())}isEmpty(){return this._data.isEmpty()}start(){return 0}bounds(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.bounds}isRect(){return this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._cachedInfo.isRect}canBeAnalyticallyAntialiased(){return!1}hash(){if(this._cachedInfo==null&&(this._cachedInfo=this._computeBoundsAndRectInfo()),this._hash==null){let e=new Pr;for(let t=0,n=this._data.byteCount();t<n;t=t+1)e.hash2(this._data.byteAt(t));this._hash=new fe(e.value())}return this._hash.value}countCommands(){let e=0;for(let t=this.start();ve.Command.isValid(t,this);t=ve.Command.next(t,this))e=e+1;return e}_computeBoundsAndRectInfo(){let e=bt.INSTANCE;e.reset();for(let c=0,l=this.VERTEX_PATTERN_COUNT;c<l;c=c+1)this.VERTEX_PATTERN[c]=null;let t=!1,n=!1,r=0,o=I.new2(),i=c=>{r<this.VERTEX_PATTERN_COUNT&&(this.VERTEX_PATTERN[r]=c),e.include2(c),r=r+1};for(let c=this.start();ve.Command.isValid(c,this);c=ve.Command.next(c,this))switch(ve.Command.kind(c,this)){case ve.Command.Kind.CLOSE:{n=!1;break}case ve.Command.Kind.MOVE_TO:{o=ve.Command.point(c,this),n=!1;break}case ve.Command.Kind.LINE_TO:case ve.Command.Kind.QUADRATIC_TO:case ve.Command.Kind.CUBIC_TO:{n||(i(o),n=!0),ve.Command.kind(c,this)==ve.Command.Kind.QUADRATIC_TO?(e.include2(ve.Command.control1(c,this)),t=!0):ve.Command.kind(c,this)==ve.Command.Kind.CUBIC_TO&&(e.include2(ve.Command.control1(c,this)),e.include2(ve.Command.control2(c,this)),t=!0),o=ve.Command.point(c,this),i(o);break}default:break}let a=e.isValid()?e.build():B.INVALID,s=!t&&r<=this.VERTEX_PATTERN_COUNT&&Kh(this.VERTEX_PATTERN,r,a);return new Dl(a,s)}toBezierPath(){return this}toString(){let e="";for(let t=this.start();ve.Command.isValid(t,this);t=ve.Command.next(t,this))switch(t!=this.start()&&(e+=" "),ve.Command.kind(t,this)){case ve.Command.Kind.CLOSE:{e+="Z";break}case ve.Command.Kind.MOVE_TO:{e+=`M ${ve.Command.moveToX(t,this)} ${ve.Command.moveToY(t,this)}`;break}case ve.Command.Kind.LINE_TO:{e+=`L ${ve.Command.lineToX(t,this)} ${ve.Command.lineToY(t,this)}`;break}case ve.Command.Kind.QUADRATIC_TO:{e+=`Q ${ve.Command.quadraticToFirstX(t,this)} ${ve.Command.quadraticToFirstY(t,this)} ${ve.Command.quadraticToX(t,this)} ${ve.Command.quadraticToY(t,this)}`;break}case ve.Command.Kind.CUBIC_TO:{e+=`C ${ve.Command.cubicToFirstX(t,this)} ${ve.Command.cubicToFirstY(t,this)} ${ve.Command.cubicToSecondX(t,this)} ${ve.Command.cubicToSecondY(t,this)} ${ve.Command.cubicToX(t,this)} ${ve.Command.cubicToY(t,this)}`;break}default:{break}}return e}};(e=>{let g;(G=>{function t(L,$){return $._data.byteAt(L)}G.kind=t;function n(L,$){let se=t(L,$);return L+(se==z.CUBIC_TO?1+4*6:se==z.QUADRATIC_TO?1+4*4:se==z.CLOSE?1:1+4*2)}G.next=n;function r(L,$){if(L>=$._data.byteCount())return!1;let se=0;switch(t(L,$)){case z.CLOSE:{se=1;break}case z.MOVE_TO:case z.LINE_TO:{se=1+1*8;break}case z.QUADRATIC_TO:{se=1+2*8;break}case z.CUBIC_TO:{se=1+3*8;break}default:return!1}return L+se<=$._data.byteCount()}G.isValid=r;function o(L,$){return s(L,$,t(L,$)==z.QUADRATIC_TO?1:t(L,$)==z.CUBIC_TO?2:0)}G.point=o;function i(L,$){return s(L,$,0)}G.control1=i;function a(L,$){return s(L,$,1)}G.control2=a;function s(L,$,se){return new I($._data.floatAt(L+1+8*se),$._data.floatAt(L+1+8*se+4))}G.pointAtIndex=s;function c(L,$){return $._data.floatAt(L+1)}G.moveToX=c;function l(L,$){return $._data.floatAt(L+(1+4))}G.moveToY=l;function u(L,$,se){$.setFloatAt(L+1,se)}G.setMoveToX=u;function d(L,$,se){$.setFloatAt(L+(1+4),se)}G.setMoveToY=d;function h(L,$){return $._data.floatAt(L+1)}G.lineToX=h;function S(L,$){return $._data.floatAt(L+(1+4))}G.lineToY=S;function f(L,$,se){$.setFloatAt(L+1,se)}G.setLineToX=f;function y(L,$,se){$.setFloatAt(L+(1+4),se)}G.setLineToY=y;function v(L,$){return $._data.floatAt(L+1)}G.quadraticToFirstX=v;function b(L,$){return $._data.floatAt(L+(1+4))}G.quadraticToFirstY=b;function m(L,$){return $._data.floatAt(L+(1+4*2))}G.quadraticToX=m;function p(L,$){return $._data.floatAt(L+(1+4*3))}G.quadraticToY=p;function _(L,$,se){$.setFloatAt(L+1,se)}G.setQuadraticToFirstX=_;function T(L,$,se){$.setFloatAt(L+(1+4),se)}G.setQuadraticToFirstY=T;function N(L,$,se){$.setFloatAt(L+(1+4*2),se)}G.setQuadraticToX=N;function k(L,$,se){$.setFloatAt(L+(1+4*3),se)}G.setQuadraticToY=k;function j(L,$){return $._data.floatAt(L+1)}G.cubicToFirstX=j;function te(L,$){return $._data.floatAt(L+(1+4))}G.cubicToFirstY=te;function Y(L,$){return $._data.floatAt(L+(1+4*2))}G.cubicToSecondX=Y;function _e(L,$){return $._data.floatAt(L+(1+4*3))}G.cubicToSecondY=_e;function ce(L,$){return $._data.floatAt(L+(1+4*4))}G.cubicToX=ce;function V(L,$){return $._data.floatAt(L+(1+4*5))}G.cubicToY=V;function H(L,$,se){$.setFloatAt(L+1,se)}G.setCubicToFirstX=H;function M(L,$,se){$.setFloatAt(L+(1+4),se)}G.setCubicToFirstY=M;function K(L,$,se){$.setFloatAt(L+(1+4*2),se)}G.setCubicToSecondX=K;function U(L,$,se){$.setFloatAt(L+(1+4*3),se)}G.setCubicToSecondY=U;function P(L,$,se){$.setFloatAt(L+(1+4*4),se)}G.setCubicToX=P;function J(L,$,se){$.setFloatAt(L+(1+4*5),se)}G.setCubicToY=J;let z;(It=>(It[It.CLOSE=0]="CLOSE",It[It.MOVE_TO=1]="MOVE_TO",It[It.LINE_TO=2]="LINE_TO",It[It.QUADRATIC_TO=3]="QUADRATIC_TO",It[It.CUBIC_TO=4]="CUBIC_TO"))(z=G.Kind||(G.Kind={}));let O;($=>{function L(se){return z[se]}$.Kind_toString=L})(O=G.in_Kind||(G.in_Kind={}))})(g=e.Command||(e.Command={}))})(ve||(ve={}));var Et=class extends ve{constructor(e){super(e)}static mutableData(e){return e._data}append(e){this._invalidateCachedData(),!this.isEmpty()&&!e.isEmpty()&&ve.Command.kind(e.start(),e)!=1&&this.moveTo1(0,0),this._data.appendBytes(e._data)}setFloatAt(e,t){this._invalidateCachedData(),this._data.setFloatAt(e,t)}moveTo1(e,t){return this._invalidateCachedData(),this._data.appendByte(1),this._data.appendFloat(e),this._data.appendFloat(t),this}moveTo2(e){return this.moveTo1(e.x(),e.y())}lineTo(e,t){return this._invalidateCachedData(),this._data.appendByte(2),this._data.appendFloat(e),this._data.appendFloat(t),this}quadraticTo(e,t,n,r){return this._invalidateCachedData(),this._data.appendByte(3),this._data.appendFloat(e),this._data.appendFloat(t),this._data.appendFloat(n),this._data.appendFloat(r),this}cubicTo1(e,t,n,r,o,i){return this._invalidateCachedData(),this._data.appendByte(4),this._data.appendFloat(e),this._data.appendFloat(t),this._data.appendFloat(n),this._data.appendFloat(r),this._data.appendFloat(o),this._data.appendFloat(i),this}cubicTo2(e,t,n){return this.cubicTo1(e.x(),e.y(),t.x(),t.y(),n.x(),n.y())}close(){return this._invalidateCachedData(),this._data.appendByte(0),this}transformBy(e){this._invalidateCachedData(),!this.isEmpty()&&ve.Command.kind(this.start(),this)!=1&&this._data.prependBytes(new Et(new ar).moveTo1(0,0)._data);for(let t=this.start();ve.Command.isValid(t,this);t=ve.Command.next(t,this))switch(ve.Command.kind(t,this)){case 0:break;case 1:{Et._p0.setTo(ve.Command.moveToX(t,this),ve.Command.moveToY(t,this)),e.transformPoint(Et._p0),ve.Command.setMoveToX(t,this,Et._p0.x()),ve.Command.setMoveToY(t,this,Et._p0.y());break}case 2:{Et._p0.setTo(ve.Command.lineToX(t,this),ve.Command.lineToY(t,this)),e.transformPoint(Et._p0),ve.Command.setLineToX(t,this,Et._p0.x()),ve.Command.setLineToY(t,this,Et._p0.y());break}case 3:{Et._p0.setTo(ve.Command.quadraticToFirstX(t,this),ve.Command.quadraticToFirstY(t,this)),e.transformPoint(Et._p0),ve.Command.setQuadraticToFirstX(t,this,Et._p0.x()),ve.Command.setQuadraticToFirstY(t,this,Et._p0.y()),Et._p0.setTo(ve.Command.quadraticToX(t,this),ve.Command.quadraticToY(t,this)),e.transformPoint(Et._p0),ve.Command.setQuadraticToX(t,this,Et._p0.x()),ve.Command.setQuadraticToY(t,this,Et._p0.y());break}case 4:{Et._p0.setTo(ve.Command.cubicToFirstX(t,this),ve.Command.cubicToFirstY(t,this)),e.transformPoint(Et._p0),ve.Command.setCubicToFirstX(t,this,Et._p0.x()),ve.Command.setCubicToFirstY(t,this,Et._p0.y()),Et._p0.setTo(ve.Command.cubicToSecondX(t,this),ve.Command.cubicToSecondY(t,this)),e.transformPoint(Et._p0),ve.Command.setCubicToSecondX(t,this,Et._p0.x()),ve.Command.setCubicToSecondY(t,this,Et._p0.y()),Et._p0.setTo(ve.Command.cubicToX(t,this),ve.Command.cubicToY(t,this)),e.transformPoint(Et._p0),ve.Command.setCubicToX(t,this,Et._p0.x()),ve.Command.setCubicToY(t,this,Et._p0.y());break}default:break}}static new2(){return new Et(new ar)}static fromRect(e){return Et._fromRect(e.x(),e.y(),e.width(),e.height())}static _fromRect(e,t,n,r){let o=Et.new2();return o.moveTo1(e,t).lineTo(e+n,t).lineTo(e+n,t+r).lineTo(e,t+r).close(),o}static fromRoundedRectWithSpread(e,t){return e.adjustCornerRadiiForSpread(t),Et.fromRoundedRect1(e)}static fromRoundedRect1(e){return e.vertexRadii()!=null?Et.fromRoundedRect3(e.left(),e.top(),e.width(),e.height(),e.vertexRadii()):Et.fromRoundedRect2(e.left(),e.top(),e.width(),e.height(),e.nodeRadius())}static fromRoundedRect2(e,t,n,r,o){if(o=Math.min(o,Math.min(n/2,r/2)),o==0)return Et._fromRect(e,t,n,r);let i=Et.new2(),a=Et.CIRCLE_APPROXIMATION_CONSTANT*o;return i.moveTo1(e,t+o).cubicTo1(e,t+o-a,e+o-a,t,e+o,t).lineTo(e+n-o,t).cubicTo1(e+n-o+a,t,e+n,t+o-a,e+n,t+o).lineTo(e+n,t+r-o).cubicTo1(e+n,t+r-o+a,e+n-o+a,t+r,e+n-o,t+r).lineTo(e+o,t+r).cubicTo1(e+o-a,t+r,e,t+r-o+a,e,t+r-o).close(),i}static fromRoundedRect3(e,t,n,r,o){let i=!0;for(let c=0,l=o.length;c<l;c=c+1)o[c]!=0&&(i=!1),o[c]=Math.min(o[c],Math.min(n/2,r/2));if(i)return Et._fromRect(e,t,n,r);let a=Et.new2(),s=o.map(c=>Et.CIRCLE_APPROXIMATION_CONSTANT*c);return a.moveTo1(e,t+o[0]).cubicTo1(e,t+o[0]-s[0],e+o[0]-s[0],t,e+o[0],t).lineTo(e+n-o[1],t).cubicTo1(e+n-o[1]+s[1],t,e+n,t+o[1]-s[1],e+n,t+o[1]).lineTo(e+n,t+r-o[2]).cubicTo1(e+n,t+r-o[2]+s[2],e+n-o[2]+s[2],t+r,e+n-o[2],t+r).lineTo(e+o[3],t+r).cubicTo1(e+o[3]-s[3],t+r,e,t+r-o[3]+s[3],e,t+r-o[3]).close(),a}static forEllipse(e){let t=new I(e.left()+e.width()/2,e.top()+e.height()/2),n=new I(e.width()/2,0),r=new I(0,e.height()/2),o=n.multiply(Et.CIRCLE_APPROXIMATION_CONSTANT),i=r.multiply(Et.CIRCLE_APPROXIMATION_CONSTANT),a=Et.new2();return a.moveTo2(t.add1(n)).cubicTo2(t.add1(n).add1(i),t.add1(o).add1(r),t.add1(r)).cubicTo2(t.subtract1(o).add1(r),t.subtract1(n).add1(i),t.subtract1(n)).cubicTo2(t.subtract1(n).subtract1(i),t.subtract1(o).subtract1(r),t.subtract1(r)).cubicTo2(t.add1(o).subtract1(r),t.add1(n).subtract1(i),t.add1(n)).close(),a}static forCenterStrokeAroundRect(e,t){let n=e.x(),r=e.y(),o=e.width(),i=e.height(),a=t/2,s=Et.new2();return s.moveTo1(n-a,r-a).lineTo(n+o+a,r-a).lineTo(n+o+a,r+i+a).lineTo(n-a,r+i+a).lineTo(n-a,r-a).lineTo(n+a,r+a).lineTo(n+a,r+i-a).lineTo(n+o-a,r+i-a).lineTo(n+o-a,r+a).lineTo(n+a,r+a).close(),s}},vt=Et;vt.CIRCLE_APPROXIMATION_CONSTANT=4/3*(Math.sqrt(2)-1),vt._p0=I.new2(),vt._p1=I.new2(),vt._p2=I.new2(),vt._p3=I.new2(),vt._r=B.new2();var Wo=class{constructor(e,t,n){this.center=null,this.xRadius=0,this.yRadius=0,this._hash=0,this._cachedBezier=null,this.center=e,this.xRadius=t,this.yRadius=n,Wo.hasher.reset(),Wo.hasher.hash1(this.center.x()),Wo.hasher.hash1(this.center.y()),Wo.hasher.hash1(this.xRadius),Wo.hasher.hash1(this.yRadius),this._hash=Wo.hasher.value()}bounds(){return new B(this.center.x()-this.xRadius,this.center.y()-this.yRadius,this.xRadius*2,this.yRadius*2)}equals2(e){return e instanceof Wo?this.equals1(e):!1}equals1(e){return this.center.equals(e.center)&&this.xRadius==e.xRadius&&this.yRadius==e.yRadius}clone(){return new Wo(this.center.clone(),this.xRadius,this.yRadius)}hash(){return this._hash}isRect(){return!1}canBeAnalyticallyAntialiased(){return C.supportsWebGLExtensionOESStandardDerivatives()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=vt.forEllipse(this.bounds())),this._cachedBezier}static fromBounds(e){return new Wo(e.center(),e.width()/2,e.height()/2)}},Ko=Wo;Ko.hasher=new Pr;var Fr=class{constructor(e,t){this._rect=null,this._radii=null,this._hash=0,this._cachedBezier=null,this._rect=e,this._radii=t.clippedForRectOfBounds(e),Fr.hasher.reset(),Fr.hasher.hash1(this._rect.x()),Fr.hasher.hash1(this._rect.y()),Fr.hasher.hash1(this._rect.width()),Fr.hasher.hash1(this._rect.height()),Fr.hasher.hash1(this._radii.topLeft),Fr.hasher.hash1(this._radii.topRight),Fr.hasher.hash1(this._radii.bottomRight),Fr.hasher.hash1(this._radii.bottomLeft),this._hash=Fr.hasher.value()}radii(){return this._radii}bounds(){return this._rect}equals2(e){return e instanceof Fr?this.equals1(e):!1}equals1(e){return this._rect.equals(e._rect)&&this._radii.equals(e._radii)}clone(){return new Fr(this._rect.clone(),this._radii)}hash(){return this._hash}isRect(){return this._radii.isZeros()}canBeAnalyticallyAntialiased(){return C.supportsWebGLExtensionOESStandardDerivatives()}toBezierPath(){return this._cachedBezier==null&&(this._cachedBezier=vt.fromRoundedRect3(this._rect.x(),this._rect.y(),this._rect.width(),this._rect.height(),this._radii.toList())),this._cachedBezier}static fromRect(e){return new Fr(e,eo.fromNodeRadius(0))}static fromRoundedRect(e){let t=e.vertexRadii()!=null?eo.fromList(e.vertexRadii()):e.nodeRadius()!=0?eo.fromNodeRadius(e.nodeRadius()):eo.ZEROS;return new Fr(e.rect(),t)}static isRoundedRectSupported(e){if(e.cornerSmoothing()!=0)return!1;let t=e.vertexRadii();if(t!=null){let n=Math.max(Math.max(t[0],t[1]),Math.max(t[2],t[3])),r=Math.min(e.width()/2,e.height()/2);if(n>r)return!1}return!0}},Dt=Fr;Dt.hasher=new Pr;var Hi=class{constructor(e,t,n,r){this.topLeft=0,this.topRight=0,this.bottomRight=0,this.bottomLeft=0,this.topLeft=Math.max(e,0),this.topRight=Math.max(t,0),this.bottomRight=Math.max(n,0),this.bottomLeft=Math.max(r,0)}isZeros(){return this.topLeft==0&&this.topRight==0&&this.bottomRight==0&&this.bottomLeft==0}isUniform(){return this.topRight==this.topLeft&&this.bottomRight==this.topLeft&&this.bottomLeft==this.topLeft}equals(e){return this.topLeft==e.topLeft&&this.topRight==e.topRight&&this.bottomRight==e.bottomRight&&this.bottomLeft==e.bottomLeft}clippedForRectOfBounds(e){let t=Math.min(e.width()/2,e.height()/2);return new Hi(Math.min(this.topLeft,t),Math.min(this.topRight,t),Math.min(this.bottomRight,t),Math.min(this.bottomLeft,t))}toList(){return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft]}static fromList(e){return new Hi(e[0],e[1],e[2],e[3])}static fromNodeRadius(e){return new Hi(e,e,e,e)}static fromRoundedRect(e){return e.vertexRadii()!=null?Hi.fromList(e.vertexRadii()):Hi.fromNodeRadius(e.nodeRadius())}},eo=Hi;eo.ZEROS=new Hi(0,0,0,0);var to=class{constructor(e){this.handle=0,this._cachedInfo=null,this._hash=0,this.handle=e}_updateCachedInfoIfNecessary(){if(this._cachedInfo==null){let e=x._prototypeLib.modules().uniquePath_Internal.bounds(this.handle),t=e.max.x-e.min.x,n=e.max.y-e.min.y,r=new B(e.min.x,e.min.y,t,n);this._cachedInfo=new Dl(r,x._prototypeLib.modules().uniquePath_Internal.isRect(this.handle))}}bounds(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.bounds}equals2(e){return e instanceof to?this.handle==e.handle:!1}clone(){return new to(this.handle)}hash(){return this._hash==null&&(this._hash=x._prototypeLib.modules().uniquePath_Internal.getHash(this.handle)),this._hash}isRect(){return this._updateCachedInfoIfNecessary(),this._cachedInfo.isRect}canBeAnalyticallyAntialiased(){return!1}toBezierPath(){throw new Error("We should never need to copy UniquePath data into JS")}compileLoopBlinnAndReturnVolatileTriangles(){let e=x._prototypeLib.modules().uniquePath_Internal.loopBlinnCompile(this.handle);return e==null?(ze("Failed to compile UniquePath"),Bg):e}},Bg=new Uint8Array([]);var Ne;(Ye=>{function g(w,F,X){if(X!=null){let ae=w.getCachedRenderTree();if(ae!=null&&(ae.value==null||!X.overlaps(ae.value.maxBounds)))return null}let oe=null;switch(F.mode){case Le.NORMAL:{oe=w.renderTree();break}case Le.WITHOUT_BACKGROUND_BLURS:{oe=w.renderTreeWithoutBackgroundBlurs();break}case Le.SHADOW:{oe=F.shadowOwnerID==w.uniqueIdentifier()?w.renderTreeForShadowRoot():w.renderTreeForShadowDescendant();break}case Le.KNOCKOUT_SHADOW:{oe=F.shadowOwnerID==w.uniqueIdentifier()?w.renderTreeForKnockoutShadowRoot():w.renderTreeForKnockoutShadowDescendant();break}default:throw new Error(`Unhandled render tree GenerateArgs mode: ${Le[F.mode]}`)}return X!=null&&(oe==null||!X.overlaps(oe.maxBounds))?null:oe}Ye._generateRenderTreeForChild=g;function e(w){return w.scrollDirection()!="NONE"&&w.hasOverflowingContentInScrollDirection()}Ye._nodeCanScroll=e;function t(w,F,X){return Q.useBackgroundBlurOpts()?X==null?!0:X.hasVolatileContent()?!1:!N(w,F):!1}Ye._canSkipWrappingInVolatileTransforms=t;function n(w,F){if(w.isRoot())return F;F=j(F,w);let X=w.indexInParent();if(w.moveToParent(),e(w)&&X<a(w)){let oe=w.clone(),ae=Ct.forScrollOffset(w.uniqueIdentifier());F=et.forTranslation(F,ae,()=>oe.scrollOffset().negative())}return F=n(w,F),w.moveToChildAt(X),F}Ye._wrapInVolatileTransformsForAncestors=n;function r(w,F,X,oe,ae,he){return Q.getFeatureFlags().prototypeTemporaryStickyScroll?o(w,F,X,oe,ae,he):i(w,F,X,oe,ae,he)}Ye._generateChildrenWithMasking=r;function o(w,F,X,oe,ae,he){let me=e(w),Oe=F.clone(),pe=me?w.clone():null,ge=[],je=[],De=X,Be=oe;for(;De<Be;){w.moveToChildAt((De=De+1)+-1);let ht=ge.length==0||!ie.List_last(ge).isStandardScrolling(),He=w.parent()!=null&&w.isStickyScrolling(),Vt=pe!=null&&w.isFixed();He?(ge.push(new Ie("STICKY_SCROLLS")),ie.List_last(ge).stickyScrollSceneNodes.push(w.clone())):!He&&!Vt&&ht&&ge.push(new Ie("SCROLLS"));let On=Vt?je:ie.List_last(ge).nodes,Zr=pe==null||w.isFixed()?ae:null;if(!w.isVisibleMask()){let Fa=g(w,Oe,Zr);Fa!=null&&On.push(Fa),w.moveToParent();continue}let hi=w.maskType(),yo=Oe.clone(),Lo=g(w,yo,Zr),xi=[];w.moveToParent();let Di=a(w);for(;De<Be;){if(w.moveToChildAt(De),w.stopsMaskPropagation()||De==Di){w.moveToParent();break}if(Lo!=null){let Fa=g(w,Oe,Zr);Fa!=null&&xi.push(Fa)}De=De+1,w.moveToParent()}Lo!=null&&xi.length!=0&&(he==cn.IGNORE&&De==Be?On.push(Ue.wrap(xi)):hi=="LUMINANCE"?On.push(fn.createForLuminanceMask(Lo,Ue.wrap(xi))):On.push(new fn(Lo,Ue.wrap(xi))))}let st=ge.filter(ht=>ht.nodes.length!=0),ke=Ct.forScrollOffset(w.uniqueIdentifier()),q=[];for(let ht of st)if(ht.isStandardScrolling())if(pe!=null){let He=s(pe,Ue.wrap(ht.nodes).optimized());q.push(et.forTranslation(He,ke,()=>pe.scrollOffset().negative()))}else ie.List_append2(q,ht.nodes);else if(ht.isStickyScrolling()){let He=[];for(let Vn=0,On=ht.nodes.length;Vn<On;Vn=Vn+1){let Zr=ht.nodes[Vn],hi=ht.stickyScrollSceneNodes[Vn];He.push(new Ir(Zr,hi))}let Vt=He.map(Vn=>{let On=Vn.a,Zr=Vn.b;return et.forTranslation(On,ke,()=>ni.getScrollTranslationOfNodeRelativeToParent2(Zr).negative())});ie.List_append2(q,Vt)}if(je.length!=0){let ht=Ue.wrap(je).optimized();q.push(ht)}return new Ue(q).optimized()}Ye._generateChildrenWithMaskingNew=o;function i(w,F,X,oe,ae,he){let me=e(w),Oe=F.clone(),pe=me?w.clone():null,ge=[],je=[],De=X,Be=oe;for(;De<Be;){w.moveToChildAt((De=De+1)+-1);let q=ge.length==0||!ie.List_last(ge).isStandardScrolling(),ht=w.isStandardScrolling()||pe==null,He=pe!=null&&w.isFixed();pe!=null&&w.isStickyScrolling()?(ge.push(new Ie("STICKY_SCROLLS")),ie.List_last(ge).stickyScrollNodeStartingTopBounds_DEPRECATED.push(w.absoluteTransform().m12())):ht&&q&&ge.push(new Ie("SCROLLS"));let Vn=He?je:ie.List_last(ge).nodes,On=pe==null||w.isFixed()?ae:null;if(!w.isVisibleMask()){let Di=g(w,Oe,On);Di!=null&&Vn.push(Di),w.moveToParent();continue}let Zr=w.maskType(),hi=Oe.clone(),yo=g(w,hi,On),Lo=[];w.moveToParent();let xi=a(w);for(;De<Be;){if(w.moveToChildAt(De),w.stopsMaskPropagation()||De==xi){w.moveToParent();break}if(yo!=null){let Di=g(w,Oe,On);Di!=null&&Lo.push(Di)}De=De+1,w.moveToParent()}yo!=null&&Lo.length!=0&&(he==cn.IGNORE&&De==Be?Vn.push(Ue.wrap(Lo)):Zr=="LUMINANCE"?Vn.push(fn.createForLuminanceMask(yo,Ue.wrap(Lo))):Vn.push(new fn(yo,Ue.wrap(Lo))))}let st=ge.filter(q=>q.nodes.length!=0);if(pe!=null){let q=Ct.forScrollOffset(w.uniqueIdentifier()),ht=[];for(let He of st)if(He.isStandardScrolling()){let Vt=s(pe,Ue.wrap(He.nodes).optimized());ht.push(et.forTranslation(Vt,q,()=>pe.scrollOffset().negative()))}else if(He.isStickyScrolling()){let Vt=[];for(let On=0,Zr=He.nodes.length;On<Zr;On=On+1){let hi=He.nodes[On],yo=He.stickyScrollNodeStartingTopBounds_DEPRECATED[On];Vt.push(new Ir(hi,yo))}let Vn=Vt.map(On=>{let Zr=On.a,yo=On.b-pe.absoluteTransform().m12();return et.forTranslation(Zr,q,()=>pe.scrollOffset().y()>yo?ye.FrozenVector_new4(pe.scrollOffset().x(),yo).negative():pe.scrollOffset().negative())});ie.List_append2(ht,Vn)}if(je.length!=0){let He=Ue.wrap(je).optimized();ht.push(He)}return new Ue(ht).optimized()}let ke=[];for(let q of st)q.isStandardScrolling()?ie.List_append2(ke,q.nodes):ze("If the parent frame is not scrolling, there should be no fixed or sticky nodes");return Ue.wrap(ke).optimized()}Ye._generateChildrenWithMaskingWithoutTemporaryStickyScroll=i;function a(w){for(let F=w.childCount()-1;F>=0;F=F-1){if(w.moveToChildAt(F),!w.isFixed())return w.moveToParent(),F+1;w.moveToParent()}return 0}Ye._indexOfFirstValidFixedChild=a;function s(w,F){if(F.hasAnimatingMedia()||F.hasVolatileContent()||F.hasBackgroundBlurs()||!F.hasNonIsolatedBlends())return F;let X=Re.firstPaintIfSolidAndOpaqueOrNull(w.fillPaintsToRender());return X==null?F:Ue.wrapWithSolidBackground(F,X.color())}Ye._wrapScrollingContentWithSolidBackground=s;function c(w,F,X,oe,ae,he,me){if(Q.useBackgroundBlurOpts(),F.parent()==null)return null;let Oe=F.indexInParent();F.moveToParent();let pe=l(w,F,X,oe,ae,he,Oe,me);return F.moveToChildAt(Oe),pe}Ye._generateBackground=c;function l(w,F,X,oe,ae,he,me,Oe){let pe=new Kt(Le.WITHOUT_BACKGROUND_BLURS),ge=r(F,pe,0,me,X,cn.IGNORE);if(oe!=null){if(e(F)&&me<a(F)){let Be=F.clone(),st=Ct.forScrollOffset(Be.uniqueIdentifier());oe=et.forTranslation(oe,st,()=>Be.scrollOffset().negative())}ge==null?ge=oe:ge=Ue.wrap([ge,oe]).optimized()}ge=H(ge,F.clone(),pe,Lt.WITH_INNER_SHADOWS_ONLY,ae);let je=!1;F.isFrameLike()&&F.clipsChildren()&&(je=Re.containsAtLeastOneVisibleOpaquePaint(F.fillPaintsToRender()));let De=Q.getViewerMode()==Q.ViewerMode.PROTOTYPE&&F.isTopLevel();if(!F.isRoot()&&!je&&!De)ge=c(pe,F,X,ge,ae,he,Oe);else{let Be=!Oe&&!t(he,F,ge);Be&&(ge=n(F,ge)),ge!=null&&(ge=new Ue([ge,v(he,new Kt(Le.WITHOUT_BACKGROUND_BLURS))]),k(he)&&Be&&(ge=et.forInverseTransform(ge)))}return ge}Ye._generateBackgroundFromParent=l;function u(w,F,X){let oe=null;switch(F){case Le.SHADOW:{oe=w.renderTreeForShadowRoot();break}case Le.KNOCKOUT_SHADOW:{oe=w.renderTreeForKnockoutShadowRoot();break}default:throw new Error(`Unhandled shadow mode: ${Le[F]}`)}if(oe!=null&&X!=null){if(w.shouldOptimizeShadowForAnimation(X)){let ae=w.clone(),he=ae.absoluteTransform(),me=he.inverse();oe=et.forTransform(oe,Ct.forShadowTransformation(ae.uniqueIdentifier()),()=>{let Oe=ae.absoluteTransform(),pe=Oe.inverse();pe.multiply(ee.new2().translatedBy1(X)),pe.multiply(Oe);let ge=ee.new2();return ge.multiply(he),ge.multiply(pe),ge.multiply(me),ge})}else{let ae=ee.translated(X.x(),X.y());oe=new qo(oe,ae)}oe=oe.optimized()}return oe}Ye._generateRenderTreeForShadow=u;function d(w,F){if(F.effects()!=null)for(let X=0,oe=F.effects().length;X<oe;X=X+1){let ae=F.effects()[X];if(ae.type()!="INNER_SHADOW"||!ae.isVisibleForRendering())continue;let he=u(F,Le.SHADOW,null);if(he!=null){let me=u(F,Le.SHADOW,ae.blurOffset());if(me==null)me=new Ue([]);else{if(ae.spread()!=0&&(me=y(me,-ae.spread(),F,ae.type()),me==null))continue;me=new Dr(me,E.BLACK)}he=new Dr(he,E.BLACK);let Oe=fn.createForInnerShadow(he,new Ar(ae.blurRadius(),me,B.INVALID),E.withAlpha(ae.blurColor(),Math.ceil(ae.opacity()*255)|0));Oe=new xr(ae.blendMode(),1,Oe),w!=null?w=new co(new Ue([w,Oe])):w=Oe}}return w}Ye._wrapWithInnerShadows=d;function h(w){let F=w.renderableContentType();if(F!=Tn.RenderableContentType.RENDERABLE_GEOMETRY&&F!=Tn.RenderableContentType.RENDERABLE_TEXT&&F!=Tn.RenderableContentType.RENDERABLE_GROUP||F==Tn.RenderableContentType.RENDERABLE_GROUP&&w.childCount()>0&&!w.clipsChildren())return!1;let X=w.fillPaints(),oe=w.strokePaints(),ae=w.fillGeometry(),he=ae!=null&&ae.regions.length!=0,me=w.strokeGeometry(),Oe=me!=null&&me.regions.length!=0,pe=he&&X!=null&&Re.containsAtLeastOneVisibleOpaquePaint(X),ge=!Oe||oe==null||Re.containsAtLeastOneVisibleOpaquePaint(oe);if(F==Tn.RenderableContentType.RENDERABLE_TEXT){let De=w.textData().styleOverrideTable().styleByID2();for(let Be of Array.from(De.keys())){let st=De.get(Be),ke=_n.get(st,58,null);if(ke!=null&&!Re.containsAtLeastOneVisibleOpaquePaint(Z.asPaintData(ke))){pe=!1;break}}}return pe&&(ge||w.strokeAlign()=="INSIDE")}Ye._hasOpaqueGeometry=h;function S(w,F){let X=w.isInsideOutlineMask(),oe=[],ae=[],he=null,me=V(F,w,Ve.FILL_PAINT_DATA),Oe=V(F,w,Ve.STROKE_PAINT_DATA);if(w.renderableContentType()==Tn.RenderableContentType.RENDERABLE_TEXT)G(oe,w,me,w.scene(),X,F);else{let ke=F.mode==Le.KNOCKOUT_SHADOW?Pt.INCLUDE:Pt.IGNORE;O(oe,w,Ce.FILL,me,w.uniqueIdentifier(),F,ke)}O(ae,w,Ce.STROKE,Oe,w.uniqueIdentifier(),F,Pt.IGNORE);let pe=w.size().withOnesForZeros(),ge=w.strokeAlign();F.isForShadows()&&ge=="INSIDE"&&tn(oe)&&tn(ae)&&(ae.length=0);let je=w.effects(),De=w.absoluteTransform();if(It(oe)&&It(ae)&&!F.isForShadows()&&Gt(je)&&!(Ye.emulateFullscreenRenderingBugs&&Qe(je,"FOREGROUND_BLUR")&&Qe(je,"INNER_SHADOW"))){let ke=[],q=[];L(De,oe,pe,ke);let ht=d(Ue.wrap(ke),w);return he=new fe(Lt.WITHOUT_LAYER_WRAPS),q.push(ht),ge=="CENTER"?L(De,ae,pe,q):nt(ge,De,oe,ae,pe,q),new gt(Ue.wrap(q),he)}if(ge=="CENTER"||oe.length==0){let ke=[];for(let q of[oe,ae])L(De,q,pe,ke);return new gt(Ue.wrap(ke),he)}if(me!=null&&Oe!=null&&(Re.isIsolated(me)&&Re.isIsolated(Oe)||F.isForShadows())&&ae.length!=0){let ke=[],q=[];for(let He of oe)Re.isEmojiPaint(He.paints)?ke.push(He):q.push(He);let ht=[];return L(De,ke,pe,ht),ht.push(new Ya(De,q,ae,pe,ge=="INSIDE"?0:1)),new gt(Ue.wrap(ht),he)}let st=[];return L(De,oe,pe,st),nt(ge,De,oe,ae,pe,st),new gt(Ue.wrap(st),he)}Ye._generateRenderTreeForGeometry=S;function f(w,F){if(!w.visible()||w.opacity()<=0&&(2&w.willChange())==0)return null;let X=null,oe=Lt.WITH_INNER_SHADOWS_AND_TOP_STROKE;switch(w.renderableContentType()){case Tn.RenderableContentType.NON_RENDERABLE:return null;case Tn.RenderableContentType.RENDERABLE_GEOMETRY:case Tn.RenderableContentType.RENDERABLE_TEXT:{let ae=S(w,F);X=ae.node,ae.layerWrap!=null&&(oe=ae.layerWrap.value);break}case Tn.RenderableContentType.RENDERABLE_GROUP:{!(F.isForShadows()&&w.clipsChildren()&&Re.containsAtLeastOneVisibleNotFullyTransparentPaint(w.fillPaintsToRender()))&&(X=r(w,F,0,w.childCount(),null,cn.INCLUDE));break}case Tn.RenderableContentType.CUSTOM_RENDER_TREE:{oe=Lt.WITHOUT_LAYER_WRAPS,X=w.customRenderTree(F);break}}return H(X,w,F,oe,0)}Ye.generateRenderTree=f;function y(w,F,X,oe){if(!X.isSpreadEligibleNode())return w;if(w.op()==10){let He=w,Vt=y(He.child,F,X,oe);return Vt==null?null:new et(Vt,He.id,He.property,He.getter)}else if(w.op()==11){let He=w,Vt=y(He.child,F,X,oe);return Vt==null?null:new qo(Vt,He.transform)}else if(w.op()==2){let Vt=y(w.child,F,X,oe);return Vt==null?null:new co(Vt)}else if(w.op()==12){let He=w,Vt=He.startChild!=null?y(He.startChild,F,X,oe):null,Vn=He.endChild!=null?y(He.endChild,F,X,oe):null;return Vt!=null||Vn!=null?new Jn(Vt,Vn,He.id,He.progressFn):null}let ae=X.fillGeometry()!=null&&X.fillGeometry().regions.length!=0&&Re.containsAtLeastOneVisiblePaint(X.fillPaints()),he=X.strokeGeometry()!=null&&X.strokeGeometry().regions.length!=0&&Re.containsAtLeastOneVisiblePaint(X.strokePaints()),me=ae&&!he,Oe=!ae&&he,pe=null,ge=w,je=()=>{Je.trackEvent1("unexpected_spread_shadow_node",new Map([["sceneNode",X.paintsDebugString()],["renderNode",w.debugString1()]]))};for(;pe==null;)switch(ge.op()){case 3:case 4:{pe=ge;break}case 5:{ge=ge.alpha;break}case 7:{ge=ge.child;break}case 1:{let He=null;Mt.visitEachNodeInTree(ge,Vt=>{(Vt.op()==3||Vt.op()==4)&&(He==null||Mt.geometryNodePaintSize(Vt).area()>Mt.geometryNodePaintSize(He).area())&&(He=Vt)},null),ge=He;break}case 0:{ge=ge.child,je();break}case 9:{ge=ge.alpha,je();break}case 6:{ge=ge.child,je();break}default:return je(),ze("Unexpected wrapped node for spread shadow"),w}if(pe==null||pe.op()!=3&&pe.op()!=4)return ze(`Failed to find geometryNode after search; got ${sr[pe.op()]}`),w;let De=null,Be=null,st=null;switch(pe.op()){case 3:{let He=pe;De=Be=He.paintSize,st=He.transform;break}case 4:{let He=pe;De=Be=He.paintSize,st=He.transform;break}default:return ze(`Unexpected node type ${sr[pe.op()]}`),w}if(he&&X.strokeAlign()!="INSIDE"){let He=X.strokeAlign()=="OUTSIDE"?2:1;De=De.add(X.strokeWeight()*He)}if(oe=="DROP_SHADOW"){if(De.x()<=-(2*F)||De.y()<=-(2*F))return null}else oe=="INNER_SHADOW"&&(F=Math.max(F,-Math.min(De.x(),De.y())/2));let ke=Be.add(2*F),q=ke.divide1(Be),ht=ee.new2().translatedBy2(-F,-F).scaledBy1(q);if(me){let He=X.fillGeometryForSpread(ht,F,Re.SOLID_BLACK);return new Sn(st,He,ke)}else if(Oe){let He=X.strokeGeometryForSpread(ht,F,Be,Re.SOLID_BLACK);if(He==null){if(oe=="DROP_SHADOW")return null;He=new Qt(new xt(Dt.fromRect(Kn.FrozenRect_EMPTY),"NONZERO"),Re.SOLID_BLACK)}return new Sn(st,He,ke)}else{let He=X.strokeGeometryForSpread(ht,F,Be,Re.SOLID_BLACK);return He==null?null:new Sn(st,He,ke)}}Ye._blurChildWithSpread=y;function v(w,F){let X=[];for(let oe=0,ae=w.effects().length;oe<ae;oe=oe+1){let he=w.effects()[oe];if(he.type()=="DROP_SHADOW"&&he.isVisibleForRendering()){if(F.mode==Le.WITHOUT_BACKGROUND_BLURS&&!he.showShadowBehindNode())continue;let me=u(w,Le.SHADOW,he.blurOffset());if(me!=null){if(he.spread()!=0&&(me=y(me,he.spread(),w,he.type()),me==null))continue;let Oe=new Dr(me,E.multiplyOpacity(he.blurColor(),he.opacity())),pe=null,ge=Oe.optimized();if(ge!=null&&(pe=new Ar(he.blurRadius(),new co(ge),B.INVALID)),pe!=null&&!he.showShadowBehindNode()&&!h(w)){let je=u(w,Le.KNOCKOUT_SHADOW,null);pe=new co(fn.createForKnockoutShadow(je,pe))}pe!=null&&X.push(new xr(he.blendMode(),1,pe))}}}return new Ue(X)}Ye._dropShadowsForNode=v;function b(w){let F=w.parent();if(F==null)return w.absoluteTransform();let X=F.absoluteTransform().clone();return X.invert()?(X.multiply(w.absoluteTransform()),X):ee.new2()}Ye._transformRelativeToParent=b;function m(w,F,X,oe,ae,he){let me=F.size(),Oe=oe>0&&F.clipsChildren()&&X!=Lt.WITH_INNER_SHADOWS_AND_TOP_STROKE,pe=null,ge=null,je=V(he,F,Ve.FILL_PAINT_DATA);he.isForShadows()&&Re.containsAtLeastOneVisibleNotFullyTransparentPaint(je)&&(je=ot(Xt.HAS_VISIBLE_PAINTS)),Re.forEachPaintWithVideo(je,st=>{let ke=st.video().getVideoManager();ke!=null&&ke.associatePaintWithNode(st,F)});let De=F.absoluteTransform(),Be=[];if(Oe){pe=xt.getOrCreate(Dt.fromRect(B.new4(ye.FrozenVector_ZERO,me).expandedBy1(oe)),"ODD");let st=Re.isolatedPaints(je);for(let ke=0,q=st.length;ke<q;ke=ke+1)ae.push(new Qt(pe,st[ke]))}else if(F.fillGeometry()!=null&&F.fillGeometry().regions.length!=0)O(ae,F,Ce.FILL,je,F.uniqueIdentifier(),he,Pt.IGNORE);else if(z(Ce.FILL,F)){ge=xt.getOrCreate(Dt.fromRect(B.new4(ye.FrozenVector_ZERO,me)),"ODD");let st=Re.isolatedPaints(je);for(let ke=0,q=st.length;ke<q;ke=ke+1)ae.push(new Qt(ge,st[ke]))}if(L(De,ae,me,Be),!F.clipsChildren()){let st=[],ke=V(he,F,Ve.STROKE_PAINT_DATA);O(st,F,Ce.STROKE,ke,F.uniqueIdentifier(),he,Pt.IGNORE),F.strokeAlign()=="CENTER"||ae.length==0?L(De,st,me,Be):nt(F.strokeAlign(),De,ae,st,me,Be)}return w!=null&&Be.push(w),w=Ue.wrap(Be),w}Ye._wrapTreeWithFrameFillPaints=m;function p(w,F,X,oe,ae){let he=F.size(),me=oe>0&&F.clipsChildren()&&X!=Lt.WITH_INNER_SHADOWS_AND_TOP_STROKE,Oe=null,pe=null,ge=F.absoluteTransform();if(me?Oe=xt.getOrCreate(Dt.fromRect(B.new4(ye.FrozenVector_ZERO,he).expandedBy1(oe)),"ODD"):pe=xt.getOrCreate(Dt.fromRect(B.new4(ye.FrozenVector_ZERO,he)),"ODD"),F.clipsChildren()){let je=[],De=[];me?je.push(new Qt(Oe,ot(Xt.HAS_VISIBLE_PAINTS))):F.fillGeometry()!=null&&F.fillGeometry().regions.length!=0?O(je,F,Ce.FILL,ot(Xt.HAS_VISIBLE_PAINTS),F.uniqueIdentifier(),ae,Pt.IGNORE):je.push(new Qt(pe,ot(Xt.HAS_VISIBLE_PAINTS))),L(ge,je,he,De),w=new fn(Ue.wrap(De),w)}return w}Ye._wrapTreeWithFrameMasks=p;function _(w){return w.containerSupportsFillStrokeAndCorners()?w.fillPaints():w.fillPaintsToRender()}Ye._fillPaintsToRender=_;function T(w,F,X,oe){let ae=F.size();if(!ae.isZero()){let he=null,me=F.clipsChildren(),Oe=_(F);if(Re.containsAtLeastOneVisiblePaint(Oe)){let pe=[],ge=[],je=null;X.isForShadows()&&Re.containsAtLeastOneVisibleNotFullyTransparentPaint(Oe)?je=ot(Xt.HAS_VISIBLE_PAINTS):je=U(X,Oe,Ve.FILL_PAINT_DATA),he=xt.getOrCreate(Dt.fromRect(B.new4(ye.FrozenVector_ZERO,ae).expandedBy1(me?oe:0)),"ODD");let De=Re.isolatedPaints(je);for(let Be=0,st=De.length;Be<st;Be=Be+1){let ke=De[Be];pe.push(new Qt(he,ke))}L(F.absoluteTransform(),pe,ae,ge),w!=null&&ge.push(w),w=Ue.wrap(ge)}if(w!=null&&me){he==null&&(he=xt.getOrCreate(Dt.fromRect(B.new4(ye.FrozenVector_ZERO,ae).expandedBy1(oe)),"ODD"));let pe=new Qt(he,ot(Xt.HAS_VISIBLE_PAINTS));w=new fn(new Sn(F.absoluteTransform(),pe,ae),w)}}return w}Ye._wrapTreeWithFrameBackgroundOrFillIgnoringGeometry=T;function N(w,F){let X=w.clone(),oe=X.parent(),ae=!0;for(;X!=null;){if(F!=null&&X.uniqueIdentifier()==F.uniqueIdentifier())return!1;if((1&X.willChange())!=0||X.overlayRenderData()!=null)return!0;if(oe==null||F!=null&&oe.uniqueIdentifier()==F.uniqueIdentifier())return!1;if(!ae){let he=X.indexInParent();if(e(oe)&&he<a(oe))return!0}ae=!1,X=oe,oe=oe.parent()}return!1}Ye._hasVolatileTransformOnAncestor=N;function k(w){return Q.useBackgroundBlurOpts()?N(w,null):!0}Ye._needInverseTransform=k;function j(w,F){if((1&F.willChange())!=0){let X=Nt.FrozenAffineTransform_IDENTITY,oe=F.parent();oe!=null&&(X=oe.absoluteTransform());let ae=F.absoluteTransform().clone(),he=ae.invert(),me=F.clone();w=et.forTransform(w,Ct.forAnimateableTranslation(F.uniqueIdentifier()),()=>{let pe=ee.new2();return pe.multiply(X),pe.multiply(b(me)),pe.multiply(ae),pe});let Oe=F.maxTransformScale();Oe!=1&&(w=et.forMaxTransformScale(Oe,w))}return w}Ye._wrapTreeInVolatileTransform=j;function te(w,F){if(w.backgroundAppearance.backgroundType=="NONE")return null;let X=J(w.backgroundAppearance,F.scene().findNode1(F.overrideKey()).canvasSpaceBoundingBox());return X!=null?(w.backgroundTransitionProgress!=null&&(X=et.forOpacity(X,Ct.OVERLAY_BACKGROUND,w.backgroundTransitionProgress)),et.forInverseTransform(X)):null}Ye._generateRenderTreeForOverlayBackground=te;function Y(w,F,X){let oe=[];for(let ae=0,he=w.count();ae<he;ae=ae+1){let me=w.keys()[ae];if(me==F)break;let Oe=w.get2(me),pe=Oe.overlayNode,ge=te(Oe,X.clone()),je=pe.renderTreeWithoutBackgroundBlurs();if(ge!=null&&oe.push(ge),je!=null){let De=Oe.bounds.center(),Be=pe.canvasSpaceBoundingBox().center(),st=De.subtract1(Be),ke=ht=>()=>ht,q=et.forInverseTransform(et.forTranslation(je,Ct.forOverlayPosition(ae),ke(st)));oe.push(q)}}return new Ue(oe)}Ye._generateIntermediateOverlays=Y;function _e(w,F,X,oe,ae){let he=B.new2();he.copyFrom(w.bounds);let me=w.baseTlfCursor.clone(),Oe=F.overlayRenderData(),pe=[],ge=l(oe,me.clone(),he,null,ae,F.clone(),me.childCount(),!1);ge!=null&&pe.push(ge);let je=Y(Oe,w.overlayId,me.clone());je!=null&&pe.push(je);let De=te(w,me);De!=null&&pe.push(De);let Be=null;return w.overlayId!=F.uniqueIdentifier()&&(Be=c(oe,F,X,null,ae,F.clone(),!0),Be!=null&&(Be=et.forInverseTransform(et.forTranslation(Be,Ct.ENTERING_OVERLAY,()=>(w.transform!=null?w.transform():ye.FrozenVector_new4(0,0)).add1(w.animationTransform!=null?w.animationTransform():ye.FrozenVector_new4(0,0)))))),Be!=null&&pe.push(Be),new Ue(pe)}Ye._generateBackgroundBlurForOverlays=_e;function ce(w,F,X,oe){let ae=u(w,Le.SHADOW,null);if(ae!=null){let he=null,me=null;if(Q.useBackgroundBlurOpts()&&(he=B.new2(),he.copyFrom(ae.maxBounds)),w.overlayRenderData()!=null){let Oe=w.clone(),pe=null,ge=w.overlayRenderData();for(;Oe!=null&&(pe=ge.get2(Oe.uniqueIdentifier()),pe==null);)Oe=Oe.parent();if(Oe==null||pe==null)return ze("Blurred node with overlay data cannot be found in an overlay"),F;he=B.new2(),he.copyFrom(pe.bounds),me=_e(pe,w.clone(),ae.maxBounds,X,oe)}else me=c(X,w,he,null,oe,w.clone(),!1);if(me!=null){let Oe=null,pe=Ml(ae),ge=pe.op()==3?pe:null;ge!=null&&ge.geometry.type==li.PaintedGeometryType.STATIC?Oe=ge.geometryBounds():Oe=ae.maxBounds;let je=new Ar(oe,me,Oe),De=fn.createForBackgroundBlur(ae,je);F=new Ue([De,F])}F=ci.createForBackgroundBlur(F)}return F}Ye._generateBackgroundBlur=ce;function V(w,F,X){let oe=F.isInsideOutlineMask(),ae=X==Ve.FILL_PAINT_DATA?F.fillPaints():F.strokePaints(),he=ae!=null&&Re.containsAtLeastOneVisiblePaint(ae);return oe?ot(he?Xt.HAS_VISIBLE_PAINTS:Xt.ALL_PAINTS_INVISIBLE):U(w,ae,X)}Ye._getFinalizedPaintData=V;function H(w,F,X,oe,ae){let he=[],me=oe==Lt.WITH_INNER_SHADOWS_AND_TOP_STROKE&&F.isFrameLike()&&F.containerSupportsFillStrokeAndCorners()&&!F.isGroup()&&F.clipsChildren(),Oe=F.isFrameLike()&&!F.size().isZero(),pe=Q.getFeatureFlags().omitDropShadowsOnTLFs&&F.isTopLevel()&&F.isFrameLike()&&Re.containsAtLeastOneVisibleOpaquePaint(F.fillPaintsToRender()),ge=!F.containerSupportsFillStrokeAndCorners()||F.isGroup(),je=Oe&&!ge;Oe&&(ge?w=T(w,F,X,ae):w=m(w,F,oe,ae,he,X)),w!=null&&(w=w.optimized());let De=!X.isForShadows()&&F.effects()!=null,Be=[];if(De)if(w!=null){if(X.mode==Le.NORMAL)for(let q=0,ht=F.effects().length;q<ht;q=q+1){let He=F.effects()[q];if(He.type()=="BACKGROUND_BLUR"){He.isVisibleForRendering()&&!h(F)&&(w=ce(F,w,X,He.blurRadius()));break}}(oe==Lt.WITH_INNER_SHADOWS_ONLY||oe==Lt.WITH_INNER_SHADOWS_AND_TOP_STROKE)&&(w=d(w,F)),pe||Be.push(v(F,X))}else pe||Be.push(v(F,X));if(w==null&&Be.length==0&&!me)return w;let st=me&&F.strokeAlign()=="INSIDE";if(je&&!st&&w!=null&&(w=p(w,F,oe,ae,X)),me&&!$(F,X,he)){let q=F.absoluteTransform(),ht=[],He=V(X,F,Ve.STROKE_PAINT_DATA),Vt=[];w!=null&&Vt.push(w),O(ht,F,Ce.STROKE,He,F.uniqueIdentifier(),X,Pt.IGNORE),F.strokeAlign()=="CENTER"||he.length==0||st?L(q,ht,F.size(),Vt):nt(F.strokeAlign(),q,he,ht,F.size(),Vt),w=Ue.wrap(Vt)}else st=!1;if(me&&F.strokeAlign()=="OUTSIDE"&&F.clipsChildren()&&(w=co.thatShouldNotBeUnwrappedInOptimization(w)),je&&st&&w!=null&&(w=p(w,F,oe,ae,X)),w!=null?w=new Ue([new Ue(Be),w]):w=new Ue(Be),w!=null&&De)for(let q=0,ht=F.effects().length;q<ht;q=q+1){let He=F.effects()[q];if(He.type()=="FOREGROUND_BLUR"){He.isVisibleForRendering()&&(w=new Ar(He.blurRadius(),w,B.INVALID));break}}if(X.isForShadows()&&X.shadowOwnerID==F.uniqueIdentifier())return w.optimized();let ke=(2&F.willChange())!=0?1:F.opacity();if(w=new xr(F.blendMode(),ke,w),w=w.optimized(),w!=null&&(2&F.willChange())!=0){let q=F.clone();w=new et(w,Ct.forAnimateableOpacity(q.uniqueIdentifier()),4,()=>q.opacity())}return w!=null&&(w=j(w,F)),w}Ye._wrapTreeWithLayerProperties=H;function M(w){if(w==null)return null;let F=!1;for(let oe=0,ae=w.length;oe<ae;oe=oe+1){let he=w[oe].asVolatilePaint();if(he!=null){if(he.from().image()!=null&&he.from().image().isDecoded()||he.from().imageThumbnail()!=null&&he.from().imageThumbnail().isDecoded()||he.to().image()!=null&&he.to().image().isDecoded()||he.to().imageThumbnail()!=null&&he.to().imageThumbnail().isDecoded()){F=!0;break}}else if(w[oe].asSinglePaint()!=null){let me=w[oe].asSinglePaint();if(me.image()!=null&&me.image().isDecoded()||me.imageThumbnail()!=null&&me.imageThumbnail().isDecoded()){F=!0;break}}if(!w[oe].isEnabledAndVisible()){F=!0;break}}if(!F)return w;let X=[];for(let oe=0,ae=w.length;oe<ae;oe=oe+1){if(!w[oe].isEnabledAndVisible())continue;let he=w[oe].asVolatilePaint();if(he!=null){let me=he.cloneAsVolatilePaint();me.from().setDecodedImageIsReady(me.from().image()!=null&&me.from().image().isDecoded()),me.to().setDecodedImageIsReady(me.to().image()!=null&&me.to().image().isDecoded()),me.from().setDecodedImageThumbnailIsReady(me.from().imageThumbnail()!=null&&me.from().imageThumbnail().isDecoded()),me.to().setDecodedImageThumbnailIsReady(me.to().imageThumbnail()!=null&&me.to().imageThumbnail().isDecoded()),X.push(me)}else if(w[oe].asSinglePaint()!=null){let me=w[oe].asSinglePaint().cloneAsSinglePaint();me.setDecodedImageIsReady(me.image()!=null&&me.image().isDecoded()),me.setDecodedImageThumbnailIsReady(me.imageThumbnail()!=null&&me.imageThumbnail().isDecoded()),X.push(me)}}return X}Ye._filteredPaintsWithImageAvailability=M;function K(w,F,X){if(w!=Le.KNOCKOUT_SHADOW||X==Ve.STROKE_PAINT_DATA&&F.length==0)return F;let oe=[];for(let ae=0,he=F.length;ae<he;ae=ae+1){let me=F[ae];if(me.type()=="IMAGE"||me.type()=="EMOJI"||me.type()=="VIDEO")oe.push(me);else return[ne.createSolid(E.BLACK,1)]}return oe.length==0&&oe.push(ne.SOLID_BLACK),oe}Ye._filteredPaintsForKnockoutShadow=K;function U(w,F,X){return K(w.mode,M(F),X)}Ye._substitutePaintsAsNeeded=U;function P(w,F,X,oe,ae,he){let me=40*1e3*1e3;if(R.equals(F.overrideKey(),R._new(me,2)))return!1;let Oe=F.strokeGeometry()!=null&&F.strokeGeometry().regions.length!=0&&Re.containsAtLeastOneVisiblePaint(F.strokePaints());if(oe!=Ce.FILL||Oe&&!se(F,he,ae))return!1;for(let pe of X.regions)if(pe.type==1)return!1;switch(F.type()){case"ELLIPSE":{if(F.arcData()==null||Re.hasEmoji(ae))return!1;let pe=F.arcData(),ge=pe.innerRadius<=0,je=pe.endingAngle-pe.startingAngle,De=Math.abs(je)>2*Pe.Math_PI()-.001,Be=F.size().withOnesForZeros();if(ge&&De&&X.regions.length==1&&X.regions[0].type==0){let ke=Be.divide(2),q=new Ko(ke,ke.x(),ke.y()),ht=new xt(q,"NONZERO"),He=Re.isolatedPaints(ae);for(let Vt=0,Vn=He.length;Vt<Vn;Vt=Vt+1){let On=He[Vt];w.push(new Qt(ht,On))}return!0}break}case"RECTANGLE":case"ROUNDED_RECTANGLE":case"FRAME":case"STAMP":case"SYMBOL":case"INSTANCE":{let pe=F.roundedRectInfo();if(!Dt.isRoundedRectSupported(pe))return!1;let ge=Dt.fromRoundedRect(pe),je=new xt(ge,"NONZERO"),De=Re.isolatedPaints(ae);for(let Be=0,st=De.length;Be<st;Be=Be+1){let ke=De[Be];w.push(new Qt(je,ke))}return!0}}return!1}Ye._attemptToGenerateAAAGeometry=P;function J(w,F){switch(w.backgroundType){case"NONE":return null;case"SOLID_COLOR":{if(F==null)return null;let X=w.backgroundColor,oe=1;return Sn.solidColorRect(F,X,oe)}}throw new Error(`Unhandled backgroundType ${w.backgroundType}`)}Ye.renderTreeForOverlayBackground=J;function z(w,F){if(w==Ce.FILL){let X=F.fillPaints(),oe=F!=null&&F.clipsChildren();return F!=null&&(oe||Re.containsAtLeastOneVisiblePaint(X)||F.strokeAlign()!="CENTER"&&z(Ce.STROKE,F))}else if(w==Ce.STROKE){let X=F.strokePaints();return Re.containsAtLeastOneVisiblePaint(X)&&F.hasNonZeroStrokeWeight()}return!1}Ye._isGeometryNecessary=z;function O(w,F,X,oe,ae,he,me){let Oe=X==Ce.FILL?F.fillGeometry():F.strokeGeometry();if(X==Ce.FILL&&me==Pt.IGNORE&&!z(X,F)&&(Oe=null),Oe==null||oe==null)return;if(Re.forEachPaintWithVideo(oe,ge=>{let je=ge.video().getVideoManager();je!=null&&je.associatePaintWithNode(ge,F)}),F.hasPerRegionFillPaints()&&X==Ce.FILL){F.forEachRegionWithFillPaintBatch((ge,je)=>{let De=Re.isolatedPaints(je);for(let Be=0,st=De.length;Be<st;Be=Be+1){let ke=M(De[Be]);Re.forEachPaintWithVideo(ke,ht=>{let He=ht.video().getVideoManager();He!=null&&He.associatePaintWithNode(ht,F)});let q=xt.getOrCreate(ge.path(),ge.windingRule);w.push(new Qt(q,ke))}});return}if(P(w,F,Oe,X,oe,he))return;let pe=Re.isolatedPaints(oe);for(let ge=0,je=pe.length;ge<je;ge=ge+1){let De=pe[ge],Be=null,st=()=>{if(Be!=null){let ke=Be.compilePaths(),q=xt.getOrCreate(ke,Be.windingRule);w.push(new Qt(q,De)),Be=null}};for(let ke of Oe.regions)ke.bounds().isEmpty()||(ke.type==0?Be!=null&&Be.canAddRegion(ke)?Be.add(ke):(st(),Be=new on(ke)):(st(),w.push(new zi(()=>new xt(ke.path(),ke.windingRule),De,ke.bounds(),Ct.forDynamicGeometry(ae)))));st()}}Ye._generateGeometries=O;function G(w,F,X,oe,ae,he){let me=F.textGeometry();if(me==null||X==null)return;let Oe=ge=>{var Be;let je,De=Un.getEmojiImageUrl(ge);for(let st of(Be=F.textData())==null?void 0:Be.usedEmojiImages())if(st.url()==De){let ke=new ne("EMOJI");ke.setOpacity(1),ke.setBlendMode("NORMAL"),ke.setImage(st);let q=[ke].slice();return U(he,q,Ve.FILL_PAINT_DATA)}return null},pe=ge=>{let je=me.paintOverrides.get(ge,oe);return je!=null?U(he,je,Ve.FILL_PAINT_DATA):U(he,X,Ve.FILL_PAINT_DATA)};for(let ge=0,je=me.regions.length;ge<je;ge=ge+1){let De=me.regions[ge];if(me.emojiCodepoints[ge].length>0){let ke=xt.getOrCreate(De.path(),De.windingRule),q=Oe(me.emojiCodepoints[ge]);if(q==null)continue;w.push(new Qt(ke,q));continue}let Be=pe(De.styleID);if(Be==null)continue;for(let ke=0,q=Be.length;ke<q;ke=ke+1){let ht=Be[ke].asSinglePaint();(ht==null?void 0:ht.video())!=null&&ht.video().getVideoManager().associatePaintWithNode(ht,F)}let st=Re.isolatedPaints(Be);for(let ke=0,q=st.length;ke<q;ke=ke+1){let ht=st[ke];if(!De.bounds().isEmpty()){let He=xt.getOrCreate(De.path(),De.windingRule);w.push(new Qt(He,ht))}}}}Ye._generateGeometriesForText=G;function L(w,F,X,oe){for(let ae=0,he=F.length;ae<he;ae=ae+1){let me=F[ae];if(Re.containsAtLeastOneVisiblePaint(me.paints)){let Oe=new Sn(w,me,X),pe=me.paints;pe.length!=0&&pe[0].blendMode()!="NORMAL"?oe.push(new xr(pe[0].blendMode(),1,Oe)):oe.push(Oe)}}}Ye._generateFills=L;function $(w,F,X){if(F.mode!=Le.SHADOW||w.strokeAlign()!="INSIDE")return!1;for(let oe=0,ae=X.length;oe<ae;oe=oe+1){let he=X[oe];if(Re.containsAtLeastOneVisibleOpaquePaint(he.paints))return!0}return!1}Ye._canSkipInsideStrokesForShadows1=$;function se(w,F,X){return F.mode!=Le.SHADOW||w.strokeAlign()!="INSIDE"?!1:Re.containsAtLeastOneVisibleOpaquePaint(X)}Ye._canSkipInsideStrokesForShadows2=se;function nt(w,F,X,oe,ae,he){let me=[];for(let Oe=0,pe=X.length;Oe<pe;Oe=Oe+1){let ge=X[Oe];me.push(new Qt(ge.path(),Re.EMPTY))}for(let Oe=0,pe=oe.length;Oe<pe;Oe=Oe+1){let ge=oe[Oe],je=ge.paints,De=[ge],Be=new Ya(F,me,De,ae,w=="INSIDE"?0:1);je.length!=0&&he.push(new xr(je[0].blendMode(),1,Be))}}Ye._generateFillStrokes=nt;function ot(w){return w==Xt.HAS_VISIBLE_PAINTS?Re.SOLID_BLACK:Re.EMPTY}Ye._outlineMaskPaintData=ot;function It(w){for(let F=0,X=w.length;F<X;F=F+1){let oe=w[F];if(Re.containsAtLeastOneVisiblePaint(oe.paints))return!0}return!1}Ye._isAnyGeometryVisible=It;function Qe(w,F){for(let X=0,oe=w.length;X<oe;X=X+1){let ae=w[X];if(ae.type()==F&&ae.isEnabledAndVisible())return!0}return!1}Ye._hasVisibleEffectsOfType=Qe;function Gt(w){for(let F=0,X=w.length;F<X;F=F+1)if(w[F].isEnabledAndVisible())return!0;return!1}Ye._hasVisibleEffects=Gt;function tn(w){if(w.length!=1)return!1;let F=w[0].paints;return F.length==1&&F[0].type()=="SOLID"}Ye._isSingleSolidGeometry=tn;function bn(){return Ye._flushBeforeMasks}Ye.flushBeforeMasks=bn;function tr(w){Ye._flushBeforeMasks=w}Ye.setFlushBeforeMasks=tr;function Fn(w,F,X){if(w>Ye.GEN_DURATION_LOG_THRESHOLD_S){let oe=`${ms[F]}${X}`;Ye._trackingKeys.has(oe)||(Je.trackEvent1("Slow Render Tree Generation",new Map([["duration",w],["frameRole",F],["callSite",X]])),Ye._trackingKeys.add(oe))}}Ye._logIfNecessary=Fn;function ur(w,F){let X=new za;Je.appTimerStart("generateRenderTree");let oe=w.renderTree();return Je.appTimerStop("generateRenderTree"),Fn(X.elapsedSeconds(),1,F),oe}Ye.renderTreeWithPerfLogging1=ur;function Wt(w,F,X){let oe=new za;Je.appTimerStart("generateRenderTree");let ae=w.renderTree2(F);return Je.appTimerStop("generateRenderTree"),Fn(oe.elapsedSeconds(),1,X),ae}Ye.renderTreeWithPerfLogging2=Wt;function ut(w,F,X){let oe=new za;Je.appTimerStart("generateRenderTree");let ae=w.renderTreeForBaseScreen2(F);return Je.appTimerStop("generateRenderTree"),Fn(oe.elapsedSeconds(),0,X),ae}Ye.renderTreeForBaseScreenWithPerfLogging=ut;function Tt(w,F,X){let oe=new za;Je.appTimerStart("generateRenderTree");let ae=w.renderTreeForOverlay(F);return Je.appTimerStop("generateRenderTree"),Fn(oe.elapsedSeconds(),1,X),ae}Ye.renderTreeForOverlayWithPerfLogging=Tt;let Le;(ae=>(ae[ae.NORMAL=0]="NORMAL",ae[ae.SHADOW=1]="SHADOW",ae[ae.WITHOUT_BACKGROUND_BLURS=2]="WITHOUT_BACKGROUND_BLURS",ae[ae.KNOCKOUT_SHADOW=3]="KNOCKOUT_SHADOW"))(Le=Ye.RenderMode||(Ye.RenderMode={}));let Pt;(X=>(X[X.INCLUDE=0]="INCLUDE",X[X.IGNORE=1]="IGNORE"))(Pt=Ye.IncludeUnnecessaryGeometry||(Ye.IncludeUnnecessaryGeometry={}));class Kt{constructor(){if(arguments.length==2){let F=arguments[0],X=arguments[1];this.mode=0,this.shadowOwnerID=null,this.mode=F,this.shadowOwnerID=X}else if(arguments.length==1){let F=arguments[0];this.mode=0,this.shadowOwnerID=null,this.mode=F,this.shadowOwnerID=null}}clone(){return new Kt(this.mode,this.shadowOwnerID)}isForShadows(){return this.mode==1||this.mode==3}}Ye.GenerateArgs=Kt;let Ce;(X=>(X[X.FILL=0]="FILL",X[X.STROKE=1]="STROKE"))(Ce=Ye.GeometryType||(Ye.GeometryType={}));let cn;(X=>(X[X.IGNORE=0]="IGNORE",X[X.INCLUDE=1]="INCLUDE"))(cn=Ye.LastMask||(Ye.LastMask={}));class Ie{constructor(F){this.nodes=null,this.scrollBehavior=null,this.stickyScrollSceneNodes=null,this.stickyScrollNodeStartingTopBounds_DEPRECATED=null,this.nodes=[],this.scrollBehavior=F,this.stickyScrollSceneNodes=[],this.stickyScrollNodeStartingTopBounds_DEPRECATED=[]}isFixed(){return this.scrollBehavior=="FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"}isStickyScrolling(){return this.scrollBehavior=="STICKY_SCROLLS"}isStandardScrolling(){return this.scrollBehavior=="SCROLLS"}}Ye.ContiguousRenderNodes=Ie;class gt{constructor(F,X){this.node=F,this.layerWrap=X}}Ye.GeometryRenderTreeResult=gt;let Lt;(oe=>(oe[oe.WITH_INNER_SHADOWS_AND_TOP_STROKE=0]="WITH_INNER_SHADOWS_AND_TOP_STROKE",oe[oe.WITH_INNER_SHADOWS_ONLY=1]="WITH_INNER_SHADOWS_ONLY",oe[oe.WITHOUT_LAYER_WRAPS=2]="WITHOUT_LAYER_WRAPS"))(Lt=Ye.LayerWrap||(Ye.LayerWrap={}));let Ve;(X=>(X[X.FILL_PAINT_DATA=0]="FILL_PAINT_DATA",X[X.STROKE_PAINT_DATA=1]="STROKE_PAINT_DATA"))(Ve=Ye.PaintType||(Ye.PaintType={}));class qe{constructor(F){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.minX=F.left(),this.maxX=F.right(),this.minY=F.top(),this.maxY=F.bottom()}}Ye.RBushRect=qe;class on{constructor(F){this.windingRule=null,this._uniquePathsOnly=!1,this._collisionTracker=new RBush,this._paths=[],this.windingRule=F.windingRule,this._uniquePathsOnly=F.path()instanceof to,this.add(F)}compilePaths(){if(this._paths.length==1)return this._paths[0];if(this._uniquePathsOnly){let X=[];for(let he of this._paths)X.push(he.handle);let oe=x._prototypeLib.modules().uniquePathHelpers.getVolatileConcatenatedPaths(X),ae=new Uint8Array(oe);return new ve(new ar(ae))}let F=this._paths[0].toBezierPath().getMutableClone();for(let X=1,oe=this._paths.length;X<oe;X=X+1)F.append(this._paths[X].toBezierPath());return F}canAddRegion(F){return F.windingRule==this.windingRule&&this._uniquePathsOnly==F.path()instanceof to&&!this._collisionTracker.collides(new qe(F.path().bounds()))}add(F){this._paths.push(F.path()),this._collisionTracker.insert(new qe(F.path().bounds()))}}Ye.PathBatch=on;let Xt;(X=>(X[X.ALL_PAINTS_INVISIBLE=0]="ALL_PAINTS_INVISIBLE",X[X.HAS_VISIBLE_PAINTS=1]="HAS_VISIBLE_PAINTS"))(Xt=Ye.PaintVisibility||(Ye.PaintVisibility={}));let Jr;(F=>{function w(X){return Le[X]}F.RenderMode_toString=w})(Jr=Ye.in_RenderMode||(Ye.in_RenderMode={}));let ft;(F=>{function w(X){return Pt[X]}F.IncludeUnnecessaryGeometry_toString=w})(ft=Ye.in_IncludeUnnecessaryGeometry||(Ye.in_IncludeUnnecessaryGeometry={}));let A;(F=>{function w(X){return Ce[X]}F.GeometryType_toString=w})(A=Ye.in_GeometryType||(Ye.in_GeometryType={}));let D;(F=>{function w(X){return cn[X]}F.LastMask_toString=w})(D=Ye.in_LastMask||(Ye.in_LastMask={}));let re;(F=>{function w(X){return Lt[X]}F.LayerWrap_toString=w})(re=Ye.in_LayerWrap||(Ye.in_LayerWrap={}));let le;(F=>{function w(X){return Ve[X]}F.PaintType_toString=w})(le=Ye.in_PaintType||(Ye.in_PaintType={}));let ue;(F=>{function w(X){return Xt[X]}F.PaintVisibility_toString=w})(ue=Ye.in_PaintVisibility||(Ye.in_PaintVisibility={})),Ye.EPSILON=.001,Ye.emulateFullscreenRenderingBugs=!0,Ye._flushBeforeMasks=!1,Ye.GEN_DURATION_LOG_THRESHOLD_S=.15,Ye._trackingKeys=new Set})(Ne||(Ne={}));var dn=class{addProperty(e){return this.transition=e(this.transition!=null?this.transition:new Zn),this}dissolve(){return this.isDissolve=!0,this.transition=new Zn().transform(this.transition.from().transform1(),this.transition.to().transform1()),this}static buildStrategy(e,t){let n=new dn;for(let r of dn.propertyFunctions)if(r(e,t,n),n.isDissolve)return n;return n}static forDiscreteProperties(e,t,n){return n=dn.nodeTypeToRenderSetMap.get(e.type())==dn.nodeTypeToRenderSetMap.get(t.type())?n:n.dissolve(),n=e.blendMode()==t.blendMode()?n:n.dissolve(),n=e.clipsToBoundingRectangle()==t.clipsToBoundingRectangle()?n:n.dissolve(),n=e.isFixed()==t.isFixed()?n:n.dissolve(),n}static forSizes(e,t,n){let r=e.size(),o=t.size();if(n.addProperty(s=>s.transformOrigin(r.divide(2),o.divide(2))),n.transition.hasLegacyTransitioningSizesForImageRect()||n.transition.hasTransitioningGeometryForRoundedRectangles()||e.type()=="ROUNDED_RECTANGLE"&&t.type()=="ROUNDED_RECTANGLE")return n;let i=t.isResizeToFit()||ln.isFrameLike(t.type())&&!t.clipsToBoundingRectangle();return(e.isResizeToFit()||ln.isFrameLike(e.type())&&!e.clipsToBoundingRectangle())&&dn._filterPaints3(e.fillPaintsToRender()).length==0&&i&&dn._filterPaints3(t.fillPaintsToRender()).length==0||r.equals(o)?n:n.dissolve()}static forOpacity(e,t,n){return n.addProperty(r=>r.opacity(e,t))}static forRelativeTransforms(e,t,n){return n.addProperty(r=>r.transform(e,t))}static forFillPaints(e,t,n){let r=dn._filterPaints2(e),o=dn._filterPaints2(t);return dn._maybeInterpolatePaints(r,o,n,i=>i.fillPaints1(r,o))}static forStrokePaints(e,t,n){let r=dn._filterPaints2(e),o=dn._filterPaints2(t);return dn._maybeInterpolatePaints(r,o,n,i=>i.strokePaints1(r,o))}static _filterPaints1(e){return dn._filterPaints2(e)}static _filterPaints2(e){return e.filter(t=>t.isEnabled())}static _filterPaints3(e){return dn._filterPaints2(e)}static _maybeInterpolatePaints(e,t,n,r){return!n.transition.hasTransitioningGeometryForRoundedRectangles()&&nn.FrozenList_equals(e,t,(o,i)=>o.equals1(i))?n:nn.FrozenList_equals(e,t,(o,i)=>o.type()==i.type()&&o.blendMode()==i.blendMode())?n.addProperty(r):n.dissolve()}static forGeometryAndPaints(e,t,n){var S,f,y,v;let r,o,i,a,s=e.supportsGeometry(),c=t.supportsGeometry();if(!s&&!c)return n;if(s!=c)return n.dissolve();let l=(f=(S=e.fillGeometry())==null?void 0:S.regions)!=null?f:[],u=(v=(y=t.fillGeometry())==null?void 0:y.regions)!=null?v:[],d=(ln.isFrameLike(e.type())&&e.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(e.type())!=-1)&&e.strokePaints().length==0&&l.length==1&&Dt.isRoundedRectSupported(e.roundedRectInfo()),h=(ln.isFrameLike(t.type())&&t.containerSupportsFillStrokeAndCorners()||["RECTANGLE","ROUNDED_RECTANGLE"].indexOf(t.type())!=-1)&&t.strokePaints().length==0&&u.length==1&&Dt.isRoundedRectSupported(t.roundedRectInfo());if(d&&h){if(l.length!=0&&u.length!=0){let b=e.fillGeometry().regions[0].bounds().size(),m=t.fillGeometry().regions[0].bounds().size(),p=eo.fromRoundedRect(e.roundedRectInfo()),_=eo.fromRoundedRect(t.roundedRectInfo());(!p.equals(_)||!b.equals(m))&&n.addProperty(T=>T.transitionGeometryForRoundedRectangles(b,p,m,_))}}else{let b=!1;if(e.isAxisAlignedRectFill()&&t.isAxisAlignedRectFill())for(let m of[e.fillPaints(),t.fillPaints()]){for(let p=0,_=m.length;p<_;p=p+1)if(m[p].type()=="IMAGE"||m[p].type()=="VIDEO"){b=!0;break}if(b)break}if(b&&!e.fillOrTextGeometry().geometryEquals(t.fillOrTextGeometry())){let m=dn._filterPaints1(e.fillRegionPaints()[0]),p=dn._filterPaints1(t.fillRegionPaints()[0]);if(nn.FrozenList_equals(m,p,(_,T)=>_.type()==T.type()))return n.addProperty(_=>_.fillPaints1(m,p)),n.addProperty(_=>_.shouldDoLegacyImageRectSizeTransition(!0)),n}n=dn._forGeometryStructure(e.fillOrTextGeometry(),t.fillOrTextGeometry(),n)}return n=dn._forGeometryPaints(e.fillRegionPaints(),t.fillRegionPaints(),n,(b,m,p)=>dn.forFillPaints(b,m,p)),n=dn._forGeometryStructure(e.strokeGeometry(),t.strokeGeometry(),n),n=dn._forGeometryPaints(e.strokeRegionPaints(),t.strokeRegionPaints(),n,(b,m,p)=>dn.forStrokePaints(b,m,p)),n}static forEffects(e,t,n){let r=e.filter(i=>i.isVisibleForRendering()),o=t.filter(i=>i.isVisibleForRendering());return ie.List_equalsWithComparison(r,o,(i,a)=>i.equals(a))?n:n.dissolve()}static _forGeometryStructure(e,t,n){return e!=null&&t!=null?e.geometryEquals(t)?n:n.dissolve():e==null&&t==null?n:n.dissolve()}static _forGeometryPaints(e,t,n,r){if(e.length==t.length){for(let o=0,i=e.length;o<i;o=o+1)if(n=r(e[o],t[o],n),n.isDissolve)return n;return n}return n.dissolve()}constructor(){this.isDissolve=!1,this.transition=new Zn}},pa=dn;pa.propertyFunctions=[(e,t,n)=>{dn.forRelativeTransforms(e.relativeTransformAccountingForFixedOffset(),t.relativeTransformAccountingForFixedOffset(),n)},(e,t,n)=>{dn.forGeometryAndPaints(e,t,n)},(e,t,n)=>{dn.forSizes(e,t,n)},(e,t,n)=>{dn.forDiscreteProperties(e,t,n)},(e,t,n)=>{dn.forOpacity(e.opacity(),t.opacity(),n)},(e,t,n)=>{dn.forEffects(e.effects(),t.effects(),n)}],pa.nodeTypeToRenderSetMap=ie.List_reduce([["NONE","DOCUMENT","SLICE"].slice(),["CANVAS","GROUP","FRAME","SYMBOL","INSTANCE","CONNECTOR","STICKY","SHAPE_WITH_TEXT","CODE_BLOCK","MEDIA","SECTION_OVERLAY","TABLE","TABLE_CELL","SLIDE"].slice(),["ELLIPSE","LINE","RECTANGLE","REGULAR_POLYGON","ROUNDED_RECTANGLE","STAR","VECTOR","STAMP","WASHI_TAPE"].slice(),["BOOLEAN_OPERATION"].slice(),["TEXT"].slice()].slice(),(e,t,n)=>(t.forEach(r=>{e.set(r,n)}),e),new Map);var _r;(v=>{function g(b,m,p,_){var _e,ce,V,H;let T,N,k,j;m.result+=m.indent,p||(m.result+=_?"\u2514\u2500":"\u251C\u2500");let te=m.indent.length;p||(m.indent+=_?"  ":"\u2502 "),m.result+=`${(ce=(_e=b.oldSceneNode)==null?void 0:_e.name())!=null?ce:"null"} -> ${(H=(V=b.newSceneNode)==null?void 0:V.name())!=null?H:"null"}`,b.forceMask&&(m.result+=" (.MASK)");let Y=b.transition;if(Y!=null){m.result+=b.dissolve?" (dissolve)":"",m.result+=Y.hasTransitioningPaints()&&(u.FILL_PAINT_DATA&b.enabledTraits)!=0?" (paints)":"",m.result+=Y.hasTransitioningGeometryForRoundedRectangles()&&(u.GEOMETRY&b.enabledTraits)!=0?" (geometry)":"";let M=Y.from(),K=Y.to();if((M.opacity1()!=1||M.opacity1()!=K.opacity1())&&(m.result+=` (opacity: ${M.opacity1()} -> ${K.opacity1()})`),M.translation1().equals(K.translation1())||(m.result+=` (translation: ${M.translation1()} -> ${K.translation1()})`),!M.transform1().equals1(K.transform1())){let U=jn.from(M.transform1()),P=jn.from(K.transform1());U.translation.approximatelyEquals(P.translation,1e-6)||(m.result+=` (translation: ${U.translation} -> ${P.translation})`),U.scale.approximatelyEquals(P.scale,1e-6)||(m.result+=` (scale: ${U.scale} -> ${P.scale})`),U.angleDegrees!=P.angleDegrees&&(m.result+=` (angle: ${U.angleDegrees} deg -> ${P.angleDegrees} deg)`)}}m.result+=`
`;for(let M=0,K=b.children.length;M<K;M=M+1)g(b.children[M],m,!1,M==b.children.length-1);b.dissolve&&(g(b.forDissolveStart1(),m,!1,!1),g(b.forDissolveEnd1(),m,!1,!0)),m.indent=m.indent.slice(0,te)}v._debugStringRecursive=g;function e(b,m,p,_,T,N){let k=pa.buildStrategy(b,p);if(k.transition.hasLegacyTransitioningSizesForImageRect()){let _e=k.transition;_e.scaling(new I(1,1),p.size().divide1(b.size()));let ce=new d(b,m,p,_);return ce.dissolve=!1,ce.transition=_e,ce}let j=a(b,m,p,_,T,null,b.isFixed()?_t.DISSOLVE:N);return m.clone().multiply(b.absoluteTransform()),_.clone().multiply(p.absoluteTransform()),j.dissolve=k.isDissolve,j.transition=k.transition,j}v._generatePlanForMatchedNodes=e;function t(b,m,p){let _=new d(b,m,null,null);if(p!=null&&p.isDissolve()){let T=new Zn().opacity(b.opacity(),0);T.transform(b.relativeTransformAccountingForFixedOffset(),b.relativeTransformAccountingForFixedOffset()),_.transition=T}else{let T=new Zn().transform(b.relativeTransformAccountingForFixedOffset(),b.relativeTransformAccountingForFixedOffset());p!=null?(T.translation(p.exitingFrameTransition().from().translation1(),p.exitingFrameTransition().to().translation1()),T.opacity(b.opacity()*p.exitingFrameTransition().from().opacity1(),b.opacity()*p.exitingFrameTransition().to().opacity1())):T.opacity(b.opacity(),b.opacity()),_.transition=T}return b.forEachChild(T=>{_.appendChild(t(T,m,null))}),_}v._generatePlanForRemovedNode=t;function n(b,m,p){let _=new d(null,null,b,m);if(p!=null&&p.isDissolve()){let T=new Zn().opacity(0,b.opacity());T.transform(b.relativeTransformAccountingForFixedOffset(),b.relativeTransformAccountingForFixedOffset()),_.transition=T}else{let T=new Zn().transform(b.relativeTransformAccountingForFixedOffset(),b.relativeTransformAccountingForFixedOffset());p!=null?(T.translation(p.enteringFrameTransition().from().translation1(),p.enteringFrameTransition().to().translation1()),T.opacity(b.opacity()*p.enteringFrameTransition().from().opacity1(),b.opacity()*p.enteringFrameTransition().to().opacity1())):T.opacity(b.opacity(),b.opacity()),_.transition=T}return b.forEachChild(T=>{_.appendChild(n(T,m,null))}),_}v._generatePlanForInsertedNode=n;function r(b){return b.name()}v._matchKey=r;function o(b,m,p,_){if(!_&&(b.type()=="BOOLEAN_OPERATION"||m.type()=="BOOLEAN_OPERATION"))return;let T=new Map;m.forEachChild(N=>{if(!N.visible())return;let k=r(N),j=null;T.has(k)?j=T.get(k):(j=[],T.set(k,j)),j.push(N)}),b.forEachChild(N=>{if(!N.visible())return;let k=r(N),j=Me.StringMap_get(T,k,null);if(j==null||j.length==0)return;let te=j.shift();p.set(R.toString(N.id()),te),p.set(R.toString(te.id()),N),o(N,te,p,_)})}v._getNodeMatches=o;function i(b,m){let p=new Map;return o(b,m,p,!1),p}v.getNodeMatches=i;function a(b,m,p,_,T,N,k){N==null&&(N=new Zn);let j=b.isTopLevel()&&p.isTopLevel(),te=new d(b,m,p,_);if(b.type()=="BOOLEAN_OPERATION"||p.type()=="BOOLEAN_OPERATION")return te;for(let _e=0;_e<p.childCount();_e=_e+1){let ce=p.childAt2(_e,!0),V=Me.StringMap_get(T,R.toString(ce.id()),null);V==null?te.appendChild(n(ce,_,k)):te.appendChild(e(V,m,ce,_,T,k))}let Y=0;for(;Y<b.childCount();){let _e=[],ce=Y,V=Y;for(;Y<b.childCount();){let J=b.childAt2(Y,!0);if(T.has(R.toString(J.id())))break;_e.push(t(J,m,k)),V=Y,Y=Y+1}if(_e.length==0){Y=Y+1;continue}let H=-1,M=te.children.length;if(ce-1>=0){let J=b.childAt2(ce-1,!0);if(J!=null){let z=Me.StringMap_get(T,R.toString(J.id()),null);z!=null&&(H=te.indexOfSceneNodeInChildren(z))}}if(V+1<b.childCount()){let J=b.childAt2(V+1,!0);if(J!=null){let z=Me.StringMap_get(T,R.toString(J.id()),null);z!=null&&(M=te.indexOfSceneNodeInChildren(z))}}let K=Math.min(H,M),U=Math.max(H,M),P=k.drawsEnteringFrameOnTopOfExitingFrame()?K+1:U;te.insertChildren(P,_e)}if(j){te.enabledTraits&=~u.FILL_PAINT_DATA,te.enabledTraits&=~u.STROKE_PAINT_DATA,te.enabledTraits&=~u.EFFECT_DATA,te.enabledTraits&=~u.CLIPPING,te.enabledTraits&=~u.BLENDING,te.enabledTraits&=~u.MASKING;let _e=b.clipsToBoundingRectangle()&&b.containerSupportsFillStrokeAndCorners()||p.clipsToBoundingRectangle()&&p.containerSupportsFillStrokeAndCorners(),ce=new d(b,m,p,_);ce.enabledTraits=u.FILL_PAINT_DATA|u.STROKE_PAINT_DATA|u.GEOMETRY|u.MASKING,_e&&(ce.enabledTraits&=~u.STROKE_PAINT_DATA),ce.dissolve=!0,ce.transition=new Zn;let V=_e;if(b.fillGeometry()!=null&&p.fillGeometry()!=null&&(V=V&&!b.fillGeometry().geometryEquals(p.fillGeometry())),V){let K=te,U=new d(b,m,p,_);U.enabledTraits=u.FILL_PAINT_DATA|u.GEOMETRY,U.transition=new Zn,U.forceMask=!0,U.dissolve=!0,te=new d(b,m,p,_),te.enabledTraits=0,te.dissolve=!1,te.transition=new Zn,te.appendChild(U),te.appendChild(K)}else te.enabledTraits|=u.CLIPPING|u.MASKING;let H=[ce,te];if(_e){let K=new d(b,m,p,_);K.enabledTraits=u.STROKE_PAINT_DATA|u.GEOMETRY,K.dissolve=!0,K.transition=new Zn,H.push(K)}N.opacity(b.opacity(),p.opacity());let M=new d(b,m,p,_);return M.enabledTraits=u.EFFECT_DATA|u.BLENDING|u.MASKING,M.insertChildren(0,H),M.transition=N,M}else return te}v.getMagicMovePlan1=a;function s(b,m){var te,Y;let p,_,T=i(b,m),N=(Y=(te=m.parent())==null?void 0:te.absoluteTransform())!=null?Y:Nt.FrozenAffineTransform_IDENTITY,k=e(b,Nt.FrozenAffineTransform_IDENTITY,m,Nt.FrozenAffineTransform_IDENTITY,T,_t.DISSOLVE),j=k.transition;return k.transition=j.clone().transform(N.clone().multipliedBy1(j.from().transform1()),N.clone().multipliedBy1(j.to().transform1())),v.VERBOSE_LOGS&&(console.log("------------------------------"),console.log("getMagicMovePlanForStateSwapTransition between interactive component states"),console.log(k.debugString()),console.log("------------------------------")),k}v.getMagicMovePlanForStateSwapTransition=s;function c(b,m,p,_,T){let N=i(b,p),k=new Zn().transform(m.clone().multipliedBy1(b.absoluteTransform()),_.clone().multipliedBy1(p.absoluteTransform()));return a(b,m,p,_,N,k,T)}v.getMagicMovePlan2=c;function l(b,m,p,_,T){let N=ee.new2().copyFrom(b.absoluteTransform());N.invert();let k=ee.new2();k.leftMultiply(N),k.leftMultiply(m.absoluteTransform());let j=Nt.FrozenAffineTransform_IDENTITY,te=b.size().max2(m.size()),Y=c(b,k,m,j,T.withScaledTranslation(te)),_e=!0,ce=()=>_e?0:p(),V=new S(Y,null,ce,_),H=Ne.renderTreeWithPerfLogging1(V,"renderTreeForMagicMove");return v.VERBOSE_LOGS&&(console.log("------------------------------"),console.log(`renderTreeForMagicMove between top-level frames ${R.toString(b.id())} -> ${R.toString(m.id())}`),console.log(Y.debugString()),console.log(H.debugString1()),console.log("------------------------------")),_e=!1,H}v.renderTreeForMagicMove=l;let u;(Y=>(Y[Y.__NONE=0]="__NONE",Y[Y.SCROLL_BEHAVIOR=1]="SCROLL_BEHAVIOR",Y[Y.CLIPPING=2]="CLIPPING",Y[Y.FILL_PAINT_DATA=4]="FILL_PAINT_DATA",Y[Y.STROKE_PAINT_DATA=8]="STROKE_PAINT_DATA",Y[Y.GEOMETRY=16]="GEOMETRY",Y[Y.BLENDING=32]="BLENDING",Y[Y.EFFECT_DATA=64]="EFFECT_DATA",Y[Y.MASKING=128]="MASKING"))(u=v.Traits||(v.Traits={}));class d{forDissolveStart1(){return this.forDissolveStart2(null)}forDissolveStart2(m){let p=new d(this.oldSceneNode,this.oldCanvasToRenderTreeTransform,null,null);p.enabledTraits=this.enabledTraits,p.forceMask=this.forceMask;let _=this.transition.clone().opacity(this.oldSceneNode.opacity(),this.oldSceneNode.opacity());return this.oldSceneNode!=null&&this.newSceneNode!=null&&(this.oldSceneNode.type()=="TEXT"||this.newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this.oldSceneNode,this.newSceneNode,T=>{_.scaling(ye.FrozenVector_ONE,new I(T,T))},_.to().transform1(),T=>{_.transform(_.from().transform1(),T)}):_.hasTransitioningGeometryForRoundedRectangles()||_.scaling(ye.FrozenVector_ONE,Ll(this.newSceneNode).divide1(Ll(this.oldSceneNode))),_.transformOrigin(this.oldSceneNode.size().divide(2),this.newSceneNode.size().divide(2))),p.dissolve=!1,p.transition=_,m!=null&&(_.from().scaling1().divide1(_.to().scaling1()).equals(m.from().scaling1().divide1(m.to().scaling1()))||(p.scalesIndependentlyOfParent=!0)),this.children.forEach(T=>{T.oldSceneNode!=null&&p.appendChild(T.forDissolveStart2(_))}),p}forDissolveEnd1(){return this.forDissolveEnd2(null)}forDissolveEnd2(m){let p=new d(null,null,this.newSceneNode,this.newCanvasToRenderTreeTransform);p.enabledTraits=this.enabledTraits,p.forceMask=this.forceMask;let _=this.transition.clone().opacity(this.newSceneNode.opacity(),this.newSceneNode.opacity());return this.oldSceneNode!=null&&this.newSceneNode!=null&&(this.oldSceneNode.type()=="TEXT"||this.newSceneNode.type()=="TEXT"?this._maybeUpdateDissolveTransitionsForText(this.newSceneNode,this.oldSceneNode,T=>{_.scaling(new I(T,T),ye.FrozenVector_ONE)},_.from().transform1(),T=>{_.transform(T,_.to().transform1())}):_.hasTransitioningGeometryForRoundedRectangles()||_.scaling(Ll(this.oldSceneNode).divide1(Ll(this.newSceneNode)),ye.FrozenVector_ONE),_.transformOrigin(this.oldSceneNode.size().divide(2),this.newSceneNode.size().divide(2))),p.dissolve=!1,p.transition=_,m!=null&&(_.from().scaling1().divide1(_.to().scaling1()).equals(m.from().scaling1().divide1(m.to().scaling1()))||(p.scalesIndependentlyOfParent=!0)),this.children.forEach(T=>{T.newSceneNode!=null&&p.appendChild(T.forDissolveEnd2(_))}),p}_maybeUpdateDissolveTransitionsForText(m,p,_,T,N){if(p.type()!="TEXT"||m.type()!="TEXT")return;let k=p.textGeometry(),j=m.textGeometry(),te=1;!p.textData().hasMixedFontSizes()&&!m.textData().hasMixedFontSizes()&&p.fontSize()>0&&m.fontSize()>0&&(te=p.fontSize()/m.fontSize(),_(te));let Y=I.new2(),_e=B.new4(p.relativeTransform().translation(),p.size()),ce=B.new4(m.relativeTransform().translation(),m.size()),V=null,H=null,M=B.new2();switch(p.textAlignHorizontal()==m.textAlignHorizontal()?(V=k.bounds,H=j.bounds):(V=_e,H=ce),M.copyFrom(H).scaledBy1(te),m.textAlignHorizontal()){case"RIGHT":{Y.setX(V.right()-H.right()-(M.right()-H.right()));break}case"CENTER":case"JUSTIFIED":{Y.setX(V.center().x()-H.center().x()-(M.center().x()-H.center().x()));break}}switch(p.textAlignVertical()==m.textAlignVertical()?(V=k.bounds,H=j.bounds):(V=_e,H=ce),M.copyFrom(H).scaledBy1(te),m.textAlignVertical()){case"BOTTOM":{Y.setY(V.bottom()-H.bottom()-(M.bottom()-H.bottom()));break}case"CENTER":{Y.setY(V.center().y()-H.center().y()-(M.center().y()-H.center().y()));break}}if(!Y.equals(I.new2())){let K=ee.new3(T);K.translate1(Y),N(K)}}sceneNode(){var m;return(m=this.oldSceneNode)!=null?m:this.newSceneNode}isEverVisible(){return this._isSceneNodeEverVisible(this.oldSceneNode)||this._isSceneNodeEverVisible(this.newSceneNode)}_isSceneNodeEverVisible(m){return m!=null&&m.visible()&&m.opacity()>0}absoluteTransform1(m){return this.absoluteTransform2(m,!0)}absoluteTransform2(m,p){let _=ee.new2();if(this.transition!=null){let T=this.transition.interpolateTranslation(m);_.translate1(T)}if(this.parent!=null&&_.multiply(this.parent.absoluteTransform2(m,!1)),this.transition!=null){let T=this.transition.interpolateTransform(m);if(_.multiply(T),p){let N=this.transition.interpolateScaling(m);_.scale3(N)}}return _}rotatesOrScales1(){return this.rotatesOrScales2(!0)}rotatesOrScales2(m){let p=this.transition!=null;return m?p=p&&!this.transition.from().equalTransformsUpToTranslation(this.transition.to(),1e-10):p=p&&!this.transition.from().equalTransformsUpToTranslationAndScaling(this.transition.to(),1e-10),this.parent!=null&&(p=p||this.parent.rotatesOrScales2(!1)),p}appendChild(m){m.parent=this,this.children.push(m)}insertChildren(m,p){for(let _ of p)_.parent=this;ie.List_insert1(this.children,m,p)}debugString(){let m=new h;return g(this,m,!0,!0),m.result}indexOfSceneNodeInChildren(m){for(let p=0;p<this.children.length;p=p+1){let _=this.children[p];if(_.oldSceneNode==m||_.newSceneNode==m)return p}return-1}indexInParent(){return this.parent!=null?this.parent.children.indexOf(this):-1}constructor(m,p,_,T){this.oldSceneNode=m,this.oldCanvasToRenderTreeTransform=p,this.newSceneNode=_,this.newCanvasToRenderTreeTransform=T,this.children=[],this.enabledTraits=f.Traits_ALL,this.parent=null,this.transition=null,this.dissolve=!1,this.scalesIndependentlyOfParent=!1,this.forceMask=!1}}v.AnimationPlanNode=d;class h{constructor(){this.result="",this.indent=""}}v.GenerateStringState=h;class S{constructor(){if(arguments.length==4){let m=arguments[0],p=arguments[1],_=arguments[2],T=arguments[3];this._planNode=null,this._node=null,this._sceneNodeCursor=null,this._getEasedT=null,this._easingFunction=null,this.initialize(m,p,_,T)}else if(arguments.length==3){let m=arguments[0],p=arguments[1],_=arguments[2];this._planNode=null,this._node=null,this._sceneNodeCursor=null,this._getEasedT=null,this._easingFunction=null,this.initialize(m,null,p,_)}}initialize(m,p,_,T){this._planNode=m,this._node=p,this._getEasedT=_,this._easingFunction=T,this._updateSceneNodeCursorForCurrentPlanNode()}clone(){return new S(this._planNode,this._node,this._getEasedT,this._easingFunction)}_updateSceneNodeCursorForCurrentPlanNode(){let m=this._planNode.sceneNode();if(m==null){this._sceneNodeCursor=null;return}this._sceneNodeCursor==null?this._sceneNodeCursor=new Jt(m):this._sceneNodeCursor.setNode(m)}moveToChildAt(m){this._planNode=this._planNode.children[m],this._node=this._node!=null&&m<this._node.childCount()?this._node.childAt2(m,!0):null,this._updateSceneNodeCursorForCurrentPlanNode()}moveToParent(){this._planNode=this._planNode.parent,this._node=this._node!=null?this._node.parent():null,this._updateSceneNodeCursorForCurrentPlanNode()}isRoot(){return this._planNode.parent==null}hasTransitioningPaints(){return this._planNode.transition.hasTransitioningPaints()}indexInParent(){return this._planNode.indexInParent()}renderableContentType(){return this.hasCustomRenderTree()?Tn.RenderableContentType.CUSTOM_RENDER_TREE:(16&this._planNode.enabledTraits)==0?Tn.RenderableContentType.RENDERABLE_GROUP:this._sceneNodeCursor!=null?this._sceneNodeCursor.renderableContentType():Tn.RenderableContentType.NON_RENDERABLE}isFrameLike(){return this._planNode.dissolve?!1:ln.isFrameLike(this.type())}isTopLevel(){return!1}paintsDebugString(){return`AnimationPlanNode [from=${this._planNode.oldSceneNode.paintsDebugString()}] [to=${this._planNode.newSceneNode.paintsDebugString()}]`}willChange(){if(this._planNode.transition==null||!this._planNode.isEverVisible())return 0;let m=0;return this._planNode.transition.from().opacity1()!=this._planNode.transition.to().opacity1()&&(m|=2),(this._planNode.transition.hasTransitioningTranslation()||this._planNode.transition.hasTransitioningTransform()||this._planNode.transition.hasTransitioningScaling()||this._planNode.transition.hasTransitioningTransformOrigin())&&(m|=1),this._planNode.scalesIndependentlyOfParent&&(m|=1),m}size(){return this._planNode.sceneNode().size()}shouldOptimizeShadowForAnimation(m){return m==null||m.equals(ye.FrozenVector_ZERO)?!1:this._planNode.rotatesOrScales1()}hasCustomRenderTree(){return this._planNode.dissolve}customRenderTree(m){let p,_,T,N;if(this._planNode.dissolve){let k=this._planNode.indexInParent(),j=this._planNode.forDissolveStart1();(N=this._planNode.parent)!=null&&N.insertChildren(k,[j]);let te=Ne.generateRenderTree(new S(j,this._getEasedT,this._easingFunction),m);(T=this._planNode.parent)!=null&&ie.List_removeAt(T.children,k);let Y=null;if(this._node!=null&&this._node.hasBackgroundBlurs())Y=Ne.generateRenderTree(new Jt(this._node),m);else{let V=this._planNode.forDissolveEnd1();(_=this._planNode.parent)!=null&&_.insertChildren(k,[V]),Y=Ne.generateRenderTree(new S(V,this._getEasedT,this._easingFunction),m),(p=this._planNode.parent)!=null&&ie.List_removeAt(p.children,k)}let _e=new Jn(te,Y,Ct.forAnimateableDissolve(R.toString(this._planNode.sceneNode().id())),this._getEasedT),ce=this._planNode.transition.clone().transform(ee.new2(),ee.new2());return this._planNode.transition=ce,_e}throw new Error("Unhandled customRenderTree case")}opacity(){return(32&this._planNode.enabledTraits)==0?1:this._planNode.transition!=null?this._planNode.transition.interpolateOpacity(this._getEasedT()):this._sceneNodeCursor.opacity()}absoluteTransform(){return this._planNode.absoluteTransform1(this._getEasedT())}maxTransformScale(){let m=this._planNode.transition;if(m==null)return 1;let p=m.from().scaling1(),T=m.to().scaling1().divide1(p).min1();return Math.max(T,1)}scene(){return this._sceneNodeCursor.scene()}parent(){if(this._planNode.parent==null)return null;let m=this._node!=null?this._node.parent():null;return new S(this._planNode.parent,m,this._getEasedT,this._easingFunction)}blendMode(){return(32&this._planNode.enabledTraits)==0?"PASS_THROUGH":this._sceneNodeCursor.blendMode()}visible(){return this._sceneNodeCursor.visible()}isVisibleMask(){return this._planNode.forceMask?!0:(128&this._planNode.enabledTraits)==0?!1:this._sceneNodeCursor.isVisibleMask()}maskType(){return this._sceneNodeCursor.maskType()}isSpreadEligibleNode(){return this._sceneNodeCursor.isSpreadEligibleNode()}type(){return this._sceneNodeCursor.type()}childCount(){return this._planNode.children.length}clipsChildren(){return(2&this._planNode.enabledTraits)==0?!1:this._sceneNodeCursor.clipsChildren()}stopsMaskPropagation(){return this._planNode.forceMask?!0:(128&this._planNode.enabledTraits)==0?!1:this._sceneNodeCursor.stopsMaskPropagation()}strokeAlign(){return this._sceneNodeCursor.strokeAlign()}strokeWeight(){return this._sceneNodeCursor.strokeWeight()}uniqueIdentifier(){return R.toString(this._sceneNodeCursor.id())}isInsideOutlineMask(){return this._sceneNodeCursor.isInsideOutlineMask()}textData(){return this._sceneNodeCursor.textData()}arcData(){return this._sceneNodeCursor.arcData()}roundedRectInfo(){return this._sceneNodeCursor.roundedRectInfo()}fillGeometry(){return(16&this._planNode.enabledTraits)==0?null:this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles()?this._planNode.transition.fillGeometryForRoundedRectangles(this._getEasedT,this._easingFunction.bounds):this._sceneNodeCursor.fillGeometry()}strokeGeometry(){return(16&this._planNode.enabledTraits)==0?null:this._sceneNodeCursor.strokeGeometry()}fillGeometryForSpread(m,p,_){return(16&this._planNode.enabledTraits)!=0&&this._planNode.transition!=null&&this._planNode.transition.hasTransitioningGeometryForRoundedRectangles()?this._planNode.transition.fillGeometryForSpreadDynamic(m,p,this._getEasedT,_,this.uniqueIdentifier(),this._easingFunction.bounds):this._sceneNodeCursor.fillGeometryForSpread(m,p,_)}strokeGeometryForSpread(m,p,_,T){return this._sceneNodeCursor.strokeGeometryForSpread(m,p,_,T)}textGeometry(){return(16&this._planNode.enabledTraits)==0?null:this._sceneNodeCursor.textGeometry()}getCachedRenderTree(){return null}renderTree(){let m=new Ne.GenerateArgs(Ne.RenderMode.NORMAL);return Ne.generateRenderTree(this.clone(),m)}renderTreeWithoutBackgroundBlurs(){let m=new Ne.GenerateArgs(Ne.RenderMode.WITHOUT_BACKGROUND_BLURS);return Ne.generateRenderTree(this.clone(),m)}renderTreeForShadowRoot(){let m=new Ne.GenerateArgs(Ne.RenderMode.SHADOW,this.uniqueIdentifier());return Ne.generateRenderTree(this.clone(),m)}renderTreeForShadowDescendant(){let m=new Ne.GenerateArgs(Ne.RenderMode.SHADOW);return Ne.generateRenderTree(this.clone(),m)}renderTreeForKnockoutShadowRoot(){let m=new Ne.GenerateArgs(Ne.RenderMode.KNOCKOUT_SHADOW,this.uniqueIdentifier());return Ne.generateRenderTree(this.clone(),m)}renderTreeForKnockoutShadowDescendant(){let m=new Ne.GenerateArgs(Ne.RenderMode.KNOCKOUT_SHADOW);return Ne.generateRenderTree(this.clone(),m)}isFixed(){return this._sceneNodeCursor.isFixed()}isStandardScrolling(){return this._sceneNodeCursor.isStandardScrolling()}isStickyScrolling(){return this._sceneNodeCursor.isStickyScrolling()}scrollOffset(){return(1&this._planNode.enabledTraits)==0?ye.FrozenVector_ZERO:this._sceneNodeCursor.scrollOffset()}scrollDirection(){return(1&this._planNode.enabledTraits)==0?"NONE":this._sceneNodeCursor.scrollDirection()}hasOverflowingContentInScrollDirection(){return(1&this._planNode.enabledTraits)==0?!1:this._sceneNodeCursor.hasOverflowingContentInScrollDirection()}effects(){return this._planNode.dissolve||(64&this._planNode.enabledTraits)==0?[]:this._sceneNodeCursor.effects()}fillPaints(){var T,N;let m,p;if((4&this._planNode.enabledTraits)==0)return Re.EMPTY;if(this._planNode.forceMask)return[ne.createSolid(E.BLACK,1)];let _=(N=(T=this._planNode.transition)==null?void 0:T.fillPaints2(this._getEasedT))!=null?N:[];return _.length==0?this._sceneNodeCursor.fillPaints():_}strokePaints(){var T,N;let m,p;if((8&this._planNode.enabledTraits)==0)return Re.EMPTY;let _=(N=(T=this._planNode.transition)==null?void 0:T.strokePaints2(this._getEasedT))!=null?N:[];return _.length==0?this._sceneNodeCursor.strokePaints():_}fillPaintsToRender(){return(4&this._planNode.enabledTraits)==0?Re.EMPTY:this._sceneNodeCursor.fillPaintsToRender()}videoPlayback(){return this._sceneNodeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._sceneNodeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._sceneNodeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._sceneNodeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._sceneNodeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(m){this._sceneNodeCursor.forEachRegionWithFillPaintBatch(m)}overrideKey(){return this._sceneNodeCursor.node.overrideKey()}name(){return this._sceneNodeCursor.node.name()}getSemanticNodePath(){return this._sceneNodeCursor.getSemanticNodePath()}hasBackgroundBlurs(){return this._sceneNodeCursor.hasBackgroundBlurs()}overlayRenderData(){return this._sceneNodeCursor.overlayRenderData()}}v.AnimationPlanCursor=S;let f;(m=>m.Traits_ALL=~0)(f=v.in_Traits||(v.in_Traits={})),v.VERBOSE_LOGS=!1})(_r||(_r={}));function Ll(g){if(g.fillGeometry()!=null&&g.fillGeometry().regions.length!=0)return g.size();let e=g.size().x()<=.1,t=g.size().y()<=.1;if(e==t)return g.size();let n=Math.max(g.strokeWeight(),.1),r=I.new3(g.size());return e?r.setX(n):r.setY(n),r}var uo=class{constructor(){var e,t;if(arguments.length==3){let n=arguments[0],r=arguments[1],o=arguments[2];if(this._sceneCursor=null,this._planTrees=null,this._activeCursor=null,this._activeTransitionKey=null,this._activeTransitionIndexInParent=-1,this.transitionMap=null,this._planTrees=new Map,this.transitionMap=r,n.transitioningFrom!=null){let i=n.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=i;let a=this._getOrCreateSmartAnimatePlanTreeAt(n,this._activeTransitionKey);if(a!=null){let s=this.transitionMap.get(i).progress,c=this.transitionMap.get(i).change.transitionParameters;this._activeCursor=new _r.AnimationPlanCursor(a,n,s,c.easingFunction);return}}this._sceneCursor=new Jt(n,o),this._activeCursor=this._sceneCursor}else if(arguments.length==1){let n=arguments[0],r,o;this._sceneCursor=null,this._planTrees=null,this._activeCursor=null,this._activeTransitionKey=null,this._activeTransitionIndexInParent=-1,this.transitionMap=null,this._sceneCursor=(e=n._sceneCursor)==null?void 0:e.clone(),this._planTrees=n._planTrees,n._activeCursor==n._sceneCursor?this._activeCursor=this._sceneCursor:this._activeCursor=(t=n._activeCursor)==null?void 0:t.clone(),this._activeTransitionKey=n._activeTransitionKey,this._activeTransitionIndexInParent=n._activeTransitionIndexInParent,this.transitionMap=n.transitionMap}}clone(){return new uo(this)}_getOrCreateSmartAnimatePlanTreeAt(e,t){let n=this.transitionMap.get(t).change.transitionParameters;if(n.transitionType=="SMART_ANIMATE"||xn.supportsSmartAnimate(n.transitionType)&&n.transitionShouldSmartAnimate){if(!this._planTrees.has(t)){let r=_r.getMagicMovePlanForStateSwapTransition(e.transitioningFrom.exitingTransitionRoot,e);this._planTrees.set(t,r)}return this._planTrees.get(t)}return null}moveToChildAt(e){if(this._activeTransitionKey==null&&this._sceneCursor!=null){let t=this._sceneCursor.node.childAt2(e,!0);if(t.transitioningFrom!=null){this._activeTransitionIndexInParent=e;let n=t.transitioningFrom.swappedStablePath.toString();this._activeTransitionKey=n;let r=this._getOrCreateSmartAnimatePlanTreeAt(t,this._activeTransitionKey);if(r!=null){let o=this.transitionMap.get(n).progress,i=this.transitionMap.get(n).change.transitionParameters;this._sceneCursor.moveToChildAt(e),this._activeCursor=new _r.AnimationPlanCursor(r,t,o,i.easingFunction);return}}}this._activeCursor.moveToChildAt(e)}moveToParent(){this._activeCursor.isRoot()?(this._sceneCursor.moveToParent(),this._activeCursor=this._sceneCursor,this._activeTransitionIndexInParent=-1,this._activeTransitionKey=null):(this._activeCursor==this._sceneCursor&&(this._activeTransitionKey=null),this._activeCursor.moveToParent())}isRoot(){return this._activeCursor.isRoot()?this._sceneCursor==null||this._sceneCursor==this._activeCursor:!1}indexInParent(){return!this.isRoot()&&this._activeCursor.isRoot()?this._activeTransitionIndexInParent:this._activeCursor.indexInParent()}renderableContentType(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?Tn.RenderableContentType.CUSTOM_RENDER_TREE:this._activeCursor.renderableContentType()}isFrameLike(){return this._activeCursor==this._sceneCursor&&this._sceneCursor.node.transitioningFrom!=null?!1:this._activeCursor.isFrameLike()}isTopLevel(){return this._activeTransitionKey!=null||this._sceneCursor==null?!1:this._sceneCursor.node.isTopLevel()}paintsDebugString(){return`PlaybackCursor ${this._sceneCursor.node.paintsDebugString()}`}willChange(){return this._activeCursor.willChange()}shouldOptimizeShadowForAnimation(e){return this._activeCursor.shouldOptimizeShadowForAnimation(e)}customRenderTree(e){if(this._sceneCursor==this._activeCursor&&this._sceneCursor.node.transitioningFrom!=null){let t=this.transitionMap.get(this._activeTransitionKey).progress,n=this.transitionMap.get(this._activeTransitionKey).change,r=n.transitionParameters,o=_t.get(r.transitionType);n.direction==1&&(o=o.reversed());let i=this._sceneCursor.node,a=i.transitioningFrom.exitingTransitionRoot,s=Ne.generateRenderTree(new Jt(i),e),c=Ne.generateRenderTree(new Jt(a),e),l=i.size().max2(a.size()),u=null;s!=null&&(u=et.forTransformIsolation(s)),u!=null?(u=et.forOpacity(u,Ct.forAnimateableOpacity(R.toString(i.id())),()=>o.enteringFrameTransition().interpolateOpacity(t())),u=et.forTranslation(u,Ct.forAnimateableTranslation(R.toString(i.id())),()=>l.multiply1(o.enteringFrameTransition().interpolateTranslation(t())))):u=new Ue([]);let d=null;if(c!=null&&(d=et.forTransformIsolation(c)),d!=null?(d=et.forOpacity(d,Ct.forAnimateableOpacity(R.toString(a.id())),()=>o.exitingFrameTransition().interpolateOpacity(t())),d=et.forTranslation(d,Ct.forAnimateableTranslation(R.toString(a.id())),()=>l.multiply1(o.exitingFrameTransition().interpolateTranslation(t())))):d=new Ue([]),o.isDissolve()){let h=Ct.forAnimateableDissolve(R.toString(i.id()));return new Jn(d,u,h,t)}else return o.drawsEnteringFrameOnTopOfExitingFrame()?Ue.wrap([d,u]):Ue.wrap([u,d])}return this._activeCursor.customRenderTree(e)}name(){return this._activeCursor.name()}scene(){return this._activeCursor.scene()}parent(){if(this.isRoot())return null;let e=this.clone();return e.moveToParent(),e}blendMode(){return this._activeCursor.blendMode()}opacity(){return this._activeCursor.opacity()}visible(){return this._activeCursor.visible()}isVisibleMask(){return this._activeCursor.isVisibleMask()}maskType(){return this._activeCursor.maskType()}isSpreadEligibleNode(){return this._activeCursor.isSpreadEligibleNode()}type(){return this._activeCursor.type()}childCount(){return this._activeCursor.childCount()}absoluteTransform(){return this._activeCursor.absoluteTransform()}maxTransformScale(){return this._activeCursor.maxTransformScale()}clipsChildren(){return this._activeCursor.clipsChildren()}stopsMaskPropagation(){return this._activeCursor.stopsMaskPropagation()}arcData(){return this._activeCursor.arcData()}roundedRectInfo(){return this._activeCursor.roundedRectInfo()}fillGeometry(){return this._activeCursor.fillGeometry()}strokeGeometry(){return this._activeCursor.strokeGeometry()}fillGeometryForSpread(e,t,n){return this._activeCursor.fillGeometryForSpread(e,t,n)}strokeGeometryForSpread(e,t,n,r){return this._activeCursor.strokeGeometryForSpread(e,t,n,r)}size(){return this._activeCursor.size()}strokeAlign(){return this._activeCursor.strokeAlign()}strokeWeight(){return this._activeCursor.strokeWeight()}uniqueIdentifier(){return this._activeCursor.uniqueIdentifier()}isInsideOutlineMask(){return this._activeCursor.isInsideOutlineMask()}textData(){return this._activeCursor.textData()}textGeometry(){return this._activeCursor.textGeometry()}getCachedRenderTree(){return this._activeCursor.getCachedRenderTree()}_shouldPreemptivelyMarkAsVolatile(){if(Q.shouldPreventVolatileCaching())return!1;let e=this._sceneCursor.node.canvas().parent().scene(),t=this._sceneCursor.node;if(!t.isInstance())return!1;let n=1;if(t.stablePath().guids.length>n+1)return!1;let r=e.findNode1(t.symbolID());return(r==null?void 0:r.parent())==null?!1:r.parent().isStateGroup()}renderTree(){if(this._sceneCursor==null){let e=new Ne.GenerateArgs(Ne.RenderMode.NORMAL);return Ne.generateRenderTree(this.clone(),e)}else if(this._activeCursor==this._sceneCursor){let e=this._sceneCursor.node.renderTree2(this);return this._activeCursor.scene().interactiveComponentsEnabled()&&this._shouldPreemptivelyMarkAsVolatile()&&e!=null?et.forStateSwap(e):e}else{if(this._activeCursor.isRoot())return this._sceneCursor.node.renderTree2(this);{let e=new Ne.GenerateArgs(Ne.RenderMode.NORMAL);return Ne.generateRenderTree(this.clone(),e)}}}renderTreeWithoutBackgroundBlurs(){return this._activeCursor.renderTreeWithoutBackgroundBlurs()}renderTreeForShadowRoot(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowRoot2(this);{let e=new Ne.GenerateArgs(Ne.RenderMode.SHADOW,this.uniqueIdentifier());return Ne.generateRenderTree(this.clone(),e)}}renderTreeForShadowDescendant(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForShadowDescendant2(this);{let e=new Ne.GenerateArgs(Ne.RenderMode.SHADOW);return Ne.generateRenderTree(this.clone(),e)}}renderTreeForKnockoutShadowRoot(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowRoot2(this);{let e=new Ne.GenerateArgs(Ne.RenderMode.KNOCKOUT_SHADOW,this.uniqueIdentifier());return Ne.generateRenderTree(this.clone(),e)}}renderTreeForKnockoutShadowDescendant(){if(this._sceneCursor!=null&&(this._activeCursor==this._sceneCursor||this._activeCursor.isRoot()))return this._sceneCursor.node.renderTreeForKnockoutShadowDescendant2(this);{let e=new Ne.GenerateArgs(Ne.RenderMode.KNOCKOUT_SHADOW);return Ne.generateRenderTree(this.clone(),e)}}isFixed(){return this._activeCursor.isFixed()}isStandardScrolling(){return this._activeCursor.isStandardScrolling()}isStickyScrolling(){return this._activeCursor.isStickyScrolling()}scrollOffset(){return this._activeCursor.scrollOffset()}scrollDirection(){return this._activeCursor.scrollDirection()}hasOverflowingContentInScrollDirection(){return this._activeCursor.hasOverflowingContentInScrollDirection()}effects(){return this._activeCursor.effects()}fillPaints(){return this._activeCursor.fillPaints()}strokePaints(){return this._activeCursor.strokePaints()}fillPaintsToRender(){return this._activeCursor.fillPaintsToRender()}videoPlayback(){return this._activeCursor.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this._activeCursor.containerSupportsFillStrokeAndCorners()}isGroup(){return this._activeCursor.isGroup()}hasNonZeroStrokeWeight(){return this._activeCursor.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this._activeCursor.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this._activeCursor.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this._activeCursor.overrideKey()}getSemanticNodePath(){return An.getSemanticNodePathHelper(this)}hasBackgroundBlurs(){return this._activeCursor.hasBackgroundBlurs()}overlayRenderData(){return this._activeCursor.overlayRenderData()}};var qh=class{constructor(e,t,n,r){this.key=e,this.value=t,this.prev=n,this.next=r,this.lastUsedGeneration=0}},Fs=class{constructor(){if(arguments.length==1){let e=arguments[0];this._nodeByKey=new Map,this._maxElements=0,this._size=0,this._head=null,this._tail=null,this._afterEvict=null,this._generation=1,this._maxElements=e}else if(arguments.length==2){let e=arguments[0],t=arguments[1];this._nodeByKey=new Map,this._maxElements=0,this._size=0,this._head=null,this._tail=null,this._afterEvict=null,this._generation=1,this._maxElements=e,this._afterEvict=t}}maximumCapacity(){return this._maxElements}atMaximumCapacity(){return this._size==this._maxElements}increaseCapacity(e){this._maxElements=this._maxElements+e}capacityUsedForGeneration(){return this.atMaximumCapacity()?this._tail.lastUsedGeneration==this._generation:!1}incrementGeneration(){if(this._generation===Number.MAX_SAFE_INTEGER-1){this._generation=1;for(let e of Array.from(this._nodeByKey.keys()))this._nodeByKey.get(e).lastUsedGeneration=0}else this._generation=this._generation+1}keys(){return Array.from(this._nodeByKey.keys())}_in(e){return this._nodeByKey.has(e)?(this._moveElemToHead(this._nodeByKey.get(e)),!0):!1}count(){return this._size}get1(e){return this._moveElemToHead(this._nodeByKey.get(e)),this._nodeByKey.get(e).value}get(e,t){let n=Me.StringMap_get(this._nodeByKey,e,null);return n==null?t:(this._moveElemToHead(n),n.value)}tailElement(){return this._tail.value}set(e,t){let n=Me.StringMap_get(this._nodeByKey,e,null);if(n!=null)this._moveElemToHead(n),n.value=t;else if(n=new qh(e,t,null,null),this._addElemAsHead(n),this._nodeByKey.set(e,n),this._size=this._size+1,this._size>this._maxElements){let r=this._tail.value,o=this._tail.key;this.remove(this._tail.key),this._afterEvict!=null&&this._afterEvict(o,r)}}remove(e){let t=Me.StringMap_get(this._nodeByKey,e,null);t!=null&&(this._nodeByKey.delete(t.key),this._removeFromList(t),this._size=this._size-1)}removeValue(e){let t=[];Me.StringMap_each(this._nodeByKey,(n,r)=>{r.value==e&&t.push(n)}),t.forEach(n=>{this.remove(n)})}makeLeastRecent(e){let t=Me.StringMap_get(this._nodeByKey,e,null);t!=null&&(this._removeFromList(t),this._addElemAsTail(t))}_moveElemToHead(e){this._removeFromList(e),this._addElemAsHead(e)}_removeFromList(e){let t=e.prev,n=e.next;t!=null&&(t.next=n),n!=null&&(n.prev=t),e==this._tail&&(this._tail=t),e==this._head&&(this._head=n),e.next=e.prev=null}_addElemAsHead(e){this._head==null?this._head=this._tail=e:(e.prev=null,e.next=this._head,e.next.prev=e,this._head=e),this._head.lastUsedGeneration=this._generation}_addElemAsTail(e){this._tail==null?this._tail=this._head=e:(e.next=null,e.prev=this._tail,e.prev.next=e,this._tail=e),this._tail.lastUsedGeneration=0}};var po=class{static numInitialTextures(){return tt.OS_isMobile(tt.OS_current())||tt.OS_current()==4&&navigator.maxTouchPoints>0||At.forceMobileOptimizations()?3:6}static numInitialTiles(e){return po.numInitialTextures()*e*e}_createNewTexture(){let e=C.in_Context.Context_createTexture1(this._context,C.TextureFormat.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP,this._tilesPerSide*po.TILE_SIZE,this._tilesPerSide*po.TILE_SIZE,"TileAtlas"),t=this._context.createTextureSet(e,null,"Tile Atlas");this._tileCacheTextureSets.push(t)}allocateTile(){let e=`tile${this._tileIdCounter}`;this._tileIdCounter=this._tileIdCounter+1,this._tilesLRU.capacityUsedForGeneration()&&(this._createNewTexture(),this._tilesLRU.increaseCapacity(this._tilesPerSide*this._tilesPerSide),console.warn("allocated new texture in the atlas to handle demand for current frame"));let t=this._tilesLRU.atMaximumCapacity()?this._tilesLRU.tailElement().tileIndex:this._tilesLRU.count();return this._tilesLRU.set(e,new po.CachedTileMetadata(t,!1,this._context.maxTextureSize())),e}maximumCapacity(){return this._tilesLRU.maximumCapacity()}prepareForNewFrame(){this._tilesLRU.incrementGeneration()}totalVRAM(){let e=0;for(let t of this._tileCacheTextureSets)e=e+C.in_Texture.Texture_totalVRAM(t.colorTexture());return e}tilesPerTexture(){return this._tilesPerSide*this._tilesPerSide}tileIsStillValid(e){return this._tilesLRU._in(e)}textureSetForTile(e){let t=this._tilesLRU.get1(e).tileIndex;return this._tileCacheTextureSets[t/(this._tilesPerSide*this._tilesPerSide)|0]}devalueTile(e){this._tilesLRU.makeLeastRecent(e)}getTexture(e){return this._tileCacheTextureSets[e].colorTexture()}viewportForTile(e,t){let n=this._tilesLRU.get1(e).tileIndex,r=dt.int_remainder(n,this._tilesPerSide),o=dt.int_remainder(n/this._tilesPerSide|0,this._tilesPerSide);t.setTo1(r*po.TILE_SIZE,o*po.TILE_SIZE,po.TILE_SIZE,po.TILE_SIZE)}clearCache(){let t=this._tileCacheTextureSets.length*this._tilesPerSide*this._tilesPerSide;this._tilesLRU=new Fs(t,this._afterEvictOrNull)}constructor(e,t){this._afterEvictOrNull=null,this._tileIdCounter=0,this._tilesLRU=null,this._tilesPerSide=0,this._tileCacheTextureSets=[],this._context=null,this._afterEvictOrNull=t,this._tilesPerSide=e.maxTextureSize()/po.TILE_SIZE|0,this._tilesLRU=new Fs(po.numInitialTiles(this._tilesPerSide),this._afterEvictOrNull),e.addContextResetHandler(()=>{this.clearCache()}),this._context=e;for(let n=0,r=po.numInitialTextures();n<r;n=n+1)this._createNewTexture()}},pn=po;pn.TILE_SIZE=512;(e=>{class g{cacheViewport(){let n=this.maxTextureSize/e.TILE_SIZE|0,r=dt.int_remainder(this.tileIndex,n),o=dt.int_remainder(this.tileIndex/n|0,n);return new B(r*e.TILE_SIZE,o*e.TILE_SIZE,e.TILE_SIZE,e.TILE_SIZE)}constructor(n,r,o){this.tileIndex=0,this.isValid=!1,this.includesBackgroundColor=!1,this.maxTextureSize=0,this.tileIndex=n,this.includesBackgroundColor=r,this.isValid=!0,this.maxTextureSize=o}}e.CachedTileMetadata=g})(pn||(pn={}));var Ad=class{constructor(e,t){this.key=e,this.value=t}},_i=class{each(e){Ht.IntMap_each(this._buckets,(t,n)=>{for(let r of n)e(r.key,r.value)})}getOrInsertFallback(e){let t=this._hash(e),n=Ht.IntMap_get(this._buckets,t,null);if(n!=null){for(let o of n)if(this._equals(e,o.key))return o.value}else n=[],this._buckets.set(t,n);let r=this._fallback(e);return n.push(new Ad(e,r)),r}get(e,t){let n=this._hash(e),r=Ht.IntMap_get(this._buckets,n,null);if(r!=null){for(let o of r)if(this._equals(e,o.key))return o.value}return t}set(e,t){let n=this._hash(e),r=Ht.IntMap_get(this._buckets,n,null);r==null&&(r=[],this._buckets.set(n,r));for(let o of r)if(this._equals(e,o.key)){o.value=t;return}r.push(new Ad(e,t))}remove(e){let t=this._hash(e),n=Ht.IntMap_get(this._buckets,t,null);if(n!=null){for(let r=0,o=n.length;r<o;r=r+1)if(this._equals(e,n[r].key)){ie.List_removeAt(n,r),n.length==0&&this._buckets.delete(t);break}}}constructor(e,t,n){this._buckets=new Map,this._hash=e,this._equals=t,this._fallback=n}};var Yh=class{constructor(e,t){this.tree=null,this.bounds=null,this.hash=0,this.tree=e,this.bounds=t;let n=new Pr;n.hash1(t.x()),n.hash1(t.y()),n.hash1(t.width()),n.hash1(t.height()),this.hash=n.value()}equals(e){return this.bounds.equals(e.bounds)&&this.tree.equals(e.tree)}},Ed=class{constructor(e,t){this._tileAtlas=null,this._keyToTileHandle=null,this._keyToNeededImages=null,this._tileHandleToKey=null,this._resetMaps();let n=(r,o)=>{o.isValid=!1;let i=Me.StringMap_get(this._tileHandleToKey,r,null);i!=null&&(this._tileHandleToKey.delete(r),this._keyToTileHandle.remove(i),this._keyToNeededImages.remove(i))};this._tileAtlas=new pn(e,n)}_resetMaps(){this._keyToTileHandle=new _i(e=>e.hash,(e,t)=>e.equals(t),e=>null),this._keyToNeededImages=new _i(e=>e.hash,(e,t)=>e.equals(t),e=>null),this._tileHandleToKey=new Map}_allocateTileHandle(e){let t=this._tileAtlas.allocateTile();return this._tileHandleToKey.set(t,e),this._keyToTileHandle.set(e,t),t}getOrInsertOrNull(e,t){let n=new fn(Sn.solidColorRect(t,E.BLACK,1),e).optimized();if(n==null)return null;let r=new Yh(n,t),o=new Cd(r,this);return o.tileHandleOrNull=this._keyToTileHandle.get(r,null),o.neededImagesOrNull=this._keyToNeededImages.get(r,null),o}setNeededImagesForTile(e,t){this._keyToNeededImages.set(e.key,t),e.neededImagesOrNull=t}maximumCapacity(){return this._tileAtlas.maximumCapacity()}tilesPerAtlasTexture(){return this._tileAtlas.tilesPerTexture()}prepareForNewFrame(){this._tileAtlas.prepareForNewFrame()}totalVRAM(){return this._tileAtlas.totalVRAM()}hasValidRenderedContent(e){return e.tileHandleOrNull!=null&&this._tileAtlas.tileIsStillValid(e.tileHandleOrNull)}prepareToRenderTo(e,t){return this.hasValidRenderedContent(e)||(e.tileHandleOrNull=this._allocateTileHandle(e.key)),this._tileAtlas.viewportForTile(e.tileHandleOrNull,t),this._tileAtlas.textureSetForTile(e.tileHandleOrNull)}textureRegionOrNull(e){if(!this.hasValidRenderedContent(e))return null;let t=B.new2();this._tileAtlas.viewportForTile(e.tileHandleOrNull,t);let n=this._tileAtlas.textureSetForTile(e.tileHandleOrNull).colorTexture();return new C.TextureRegion(n,t.scaledBy1(1/n.width()))}clear(){this._tileAtlas.clearCache(),this._resetMaps()}};function xs(g,e){let t=new WeakMap,n=null;return r=>{let o=e(r);if(o===null)return n==null&&(n=new fe(g(r))),n.value;if(t.has(o))return t.get(o);let i=g(r);return t.set(o,i),i}}function Nd(g){return xs(g,e=>e)}function Ug(g,e,t){let n=xs(r=>xs(o=>g(r,o),t),e);return(r,o)=>n(r)(o)}function Xh(g,e,t,n){let r=Ug((o,i)=>xs(a=>g(o,i,a),n),e,t);return(o,i,a)=>r(o,i)(a)}function Od(g,e,t,n,r){let o=Xh((i,a,s)=>xs(c=>g(i,a,s,c),r),e,t,n);return(i,a,s,c)=>o(i,a,s)(c)}var ha=class{constructor(e,t,n){this._context=null,this._compositeTileCache=null,this._renderer=null,this._boundsCache=Ki._new(),this._backbuffer=null,this._prepareForEfficientCompositingMemoized=null,this._context=e,this._compositeTileCache=t,this._renderer=n,this._prepareForEfficientCompositingMemoized=Nd(r=>{let o=this._prepareForEfficientCompositing(r);return ha._VERBOSE_LOGS&&(console.log("Before Preparation for Rasterization"),console.log("--------------"),console.log(r.debugString1()),console.log(""),console.log("After Preparation for Rasterization"),console.log("--------------"),console.log(o.debugString1())),o})}beginFrameAndCreateBudget(){this._compositeTileCache.prepareForNewFrame(),Ki.clear(this._boundsCache);let e=.016,t=2,n=this._compositeTileCache.maximumCapacity();return n>=1e3&&(ha._alreadyLoggedTooManyTiles||(Je.trackEvent1("viewer_prototype_too_many_tiles",new Map([["numTiles",n]])),ha._alreadyLoggedTooManyTiles=!0)),new ha.FrameBudget(e,t,n)}prepareForEfficientCompositing(e){return this._prepareForEfficientCompositingMemoized(e)}_prepareForEfficientCompositing(e){if(e!=null&&e.isAxisAlignedRectFill()){let t=e;if(Re.onlySolidPaintOrNull(t.geometry.paints)!=null)return e}if(e.canCacheRasterized())return new Rd(e,this._compositeTileCache);switch(e.op()){case 0:{let t=e;return new ci(this._prepareForEfficientCompositing(t.child),t.flags)}case 2:{let t=e;return new co(this._prepareForEfficientCompositing(t.child))}case 1:{let t=e,n=[],r=[];for(let o of t.children)if(o.canCacheRasterized())r.push(o);else{if(r.length!=0){let i=Ue.wrap(r);n.push(this._prepareForEfficientCompositing(i)),r=[]}n.push(this._prepareForEfficientCompositing(o))}if(r.length!=0){let o=Ue.wrap(r);n.push(this._prepareForEfficientCompositing(o))}return Ue.wrap(n)}case 5:{let t=e;return new fn(this._prepareForEfficientCompositing(t.alpha),this._prepareForEfficientCompositing(t.color),t.type,t.innerShadowFill,t.innerShadowAlphaRequiresHardMask)}case 6:{let t=e;return t.radius>=1?t:new Ar(t.radius,this._prepareForEfficientCompositing(t.child),t.clamp)}case 7:{let t=e;return new xr(t.blendMode,t.opacity,this._prepareForEfficientCompositing(t.child))}case 9:{let t=e;return new Dr(this._prepareForEfficientCompositing(t.alpha),t.color)}case 10:{let t=e;return new et(this._prepareForEfficientCompositing(t.child),t.id,t.property,t.getter)}case 11:{let t=e;return new qo(this._prepareForEfficientCompositing(t.child),t.transform)}case 12:{let t=e;return new Jn(this._prepareForEfficientCompositing(t.startChild),this._prepareForEfficientCompositing(t.endChild),t.id,t.progressFn)}case 3:case 4:{if(e.hasAnimatingMedia()||e.hasVolatileContent()&&e.op()!=8)return e;throw new Error(`Unexpectedly received ${sr[e.op()]} node`)}case 8:throw new Error(`Unexpectedly received ${sr[e.op()]} node`);default:throw new Error(`Node type ${sr[e.op()]} is unhandled`)}}getPrioritizedListOfTilesToPopulate(e,t,n,r){let o=[ee.new2()],i=[ee.new2()],a=[1],s=[],c=u=>{switch(u.op()){case 10:{let d=u;switch(d.property){case 2:{let h=ee.new3(ie.List_last(o));h.multipliedBy1(d.transform()),o.push(h);let S=ee.new3(d.transform());S.invert()||S.copyFrom(Nt.FrozenAffineTransform_IDENTITY),S.multipliedBy1(ie.List_last(i)),i.push(S);break}case 0:{let h=ee.new3(ie.List_last(o));h.multipliedBy1(ie.List_last(i)),o.push(h);let S=ee.new2();i.push(S);break}case 1:{i.push(ee.new2());break}case 3:{a.push(d.maxTransformScale());break}}break}case 11:{let d=u,h=ee.new3(ie.List_last(o));h.multipliedBy1(d.transform),o.push(h);let S=ee.new3(d.transform);S.invert()||S.copyFrom(Nt.FrozenAffineTransform_IDENTITY),S.multipliedBy1(ie.List_last(i)),i.push(S);break}case 8:{let d=u,h=ie.List_last(o),S=ee.new3(h);S.invert();let f=B.new3(n);S.transformRect(f);let y=B.new3(t);S.transformRect(y);let v=e*ie.List_last(a);for(let b=0;b<10;b=b+1){d.setDevicePixelPerCanvasPixel(v);let m=d.numTilesNeededForBounds(y),p=this._compositeTileCache.tilesPerAtlasTexture();if(m>p){v/=2;continue}break}d.forEachTileWithinBounds(0,f,b=>{let p=b.bounds().distanceTo(y)*h.scale1().max1();s.push(new ha.TileWithPriority(b,p))});break}}},l=u=>{switch(u.op()){case 10:{let d=u.property;(d==2||d==0||d==1)&&ie.List_removeLast(i),(d==2||d==0)&&ie.List_removeLast(o),d==3&&ie.List_removeLast(a);break}case 11:{ie.List_removeLast(i),ie.List_removeLast(o);break}}};return Mt.visitEachNodeInTree(r,c,l),s.sort((u,d)=>u.canvasSpaceDistanceToViewport<d.canvasSpaceDistanceToViewport?-1:1),s}ensureTileIsPopulated(e,t,n){if(t.recordTileCacheSlotWasUsed(),this._compositeTileCache.hasValidRenderedContent(e))return 1;let r=B.new2(),o=this._compositeTileCache.prepareToRenderTo(e,r),i=!1,a=E.TRANSPARENT,s=!0,c=!0,l=new Ro.Options(e.key.tree,i,a,s,this._boundsCache,n,!1,c,!0),u=this._renderer.drawTile2(r,e.canvasSpaceBounds().x(),e.canvasSpaceBounds().y(),e.canvasSpaceBounds().width(),o,l);return t.recordTileWasRendered(),this._compositeTileCache.setNeededImagesForTile(e,u.neededImagesOrNull),0}drawToScreen(e,t,n,r,o,i){this._context.annotate("Composite",()=>{let a=Tr.new2();a.copyFrom(t);let s=a.invert();if(this._backbuffer==null||this._backbuffer.colorTexture().width()!=(n.size().x()|0)||this._backbuffer.colorTexture().height()!=(n.size().y()|0)){this._backbuffer!=null&&this._backbuffer._delete();let T=C.in_Context.Context_createTexture1(this._context,C.TextureFormat.RGBA_LINEAR_CLAMP,n.size().x()|0,n.size().y()|0,"Compositor Backbuffer"),N=C.in_Context.Context_createTexture1(this._context,C.TextureFormat.STENCIL,n.size().x()|0,n.size().y()|0,"Compositor Backbuffer");this._backbuffer=this._context.createTextureSet(T,N,"Compositor Backbuffer")}let c=this._context.currentTextureSet();this._context.setTextureSet(this._backbuffer),C.in_Context.Context_clear1(this._context,C.Clear.ALL),this._context.setTextureSet(c);let l=pn.TILE_SIZE,u=new B(0,0,l,l),d=B.new2();Q.internalDebugTools()&&(e=this._renderer.treeToRender(e));let h=!1,S=E.TRANSPARENT,f=!1,y=!0,v=!0,b=new Ro.Options(e,h,S,f,this._boundsCache,i,y,v,!1);for(let T=n.left();T<=n.right();T+=l)for(let N=n.top();N<=n.bottom();N+=l)u.setX(T),u.setY(N),d.copyFrom(u),a.transformRect(d),u.translate2(n.topLeft().negative()),this._renderer.drawTile2(u,d.x(),d.y(),d.width(),this._backbuffer,b);Q.internalDebugTools()&&this._renderer.finishLayerByLayerDrawToScreen();let m=ee.new2();m.translate2(-1,1),m.scale4(2/r.width(),-2/r.height());let p=B.new2();p.copyFrom(n),p.transformBy1(m),p.setY(p.y()+p.height()),p.setHeight(-p.height()),this._context.setTextureSet(null),this._context.setViewport(r.left()|0,r.top()|0,r.width()|0,r.height()|0),this._context.clear2(C.Clear.ALL,o);let _=B.UNIT;this._renderer.drawTextureToCurrentTextureSet(this._backbuffer.colorTexture(),_,null,p,Nt.FrozenAffineTransform_IDENTITY,1,1),this._renderer.context().endFrame()})}},Wi=ha;Wi._VERBOSE_LOGS=!1,Wi._alreadyLoggedTooManyTiles=!1;(t=>{class g{overlapsViewport(){return this.canvasSpaceDistanceToViewport==0}constructor(r,o){this.node=r,this.canvasSpaceDistanceToViewport=o}}t.TileWithPriority=g;class e{constructor(r,o,i){this._renderingDeadline=0,this._tileRenderingBudgetRemaining=0,this._tileCacheCapacityRemaining=0,this._overrideFrameBudget=!1,this._renderingDeadline=We.seconds()+r,this._tileRenderingBudgetRemaining=o,this._tileCacheCapacityRemaining=i}recordTileWasRendered(){this._tileRenderingBudgetRemaining=this._tileRenderingBudgetRemaining-1}recordTileCacheSlotWasUsed(){this._tileCacheCapacityRemaining=this._tileCacheCapacityRemaining-1}tileCacheCapacityRemaining(){return this._tileCacheCapacityRemaining}permitsMoreWork(){return this._overrideFrameBudget?!0:!(We.seconds()>=this._renderingDeadline||this._tileRenderingBudgetRemaining<=0||this._tileCacheCapacityRemaining<=0)}permitWorkAfterBudgetExceeded(){this._overrideFrameBudget=!0}forbidWorkAfterBudgetExceeded(){this._overrideFrameBudget=!1}}t.FrameBudget=e})(Wi||(Wi={}));var vn=class{willStartTransitionWithDuration(e){this._durationSeconds=e,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=We.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0,this._progressAtStart=0,this._lastProgress=0}transitionEnded(){this._lastProgress=-1,this._progressType=vn.ProgressType.FORWARD,this._externalOnTickProgress=null;let e=this._externalOnTransitionEnded;return this._externalOnTransitionEnded=null,e!=null?e():vn.TransitionEndedAction.COMMIT}isTransitionInProgress(){return this.isProgressControlledExternally()?!0:this._progressType==vn.ProgressType.REVERSE?0<this._lastProgress&&this._lastProgress<=1:0<=this._lastProgress&&this._lastProgress<1}duration(){return this._durationSeconds}progress(){return this._lastProgress}isProgressControlledExternally(){return this._progressType==vn.ProgressType.EXTERNAL}pinProgressToRealTimeWithDuration(e,t,n){this._progressAtStart=e,this._durationSeconds=t,this._progressType=n?vn.ProgressType.REVERSE:vn.ProgressType.FORWARD,this._elapsedSeconds=0,this._timeOfLastTransitionFrame=We.seconds(),this._timeOfTransitionStart=this._timeOfLastTransitionFrame,this.frameTimesMs.length=0}pinProgressToExternalControl(e,t){this._externalOnTickProgress=e,this._externalOnTransitionEnded=t,this._progressType=vn.ProgressType.EXTERNAL,this._timeOfTransitionStart=We.seconds(),this.frameTimesMs.length=0}advanceToNextFrame(){if(this.isProgressControlledExternally())this._lastProgress=this._externalOnTickProgress();else if(this._durationSeconds>0){let e=We.seconds(),t=e-this._timeOfLastTransitionFrame;this.frameTimesMs.push(1e3*t),t=Math.min(t,1/30),this._elapsedSeconds+=t,this._timeOfLastTransitionFrame=e;let n=this._progressType==vn.ProgressType.REVERSE?-1:1;this._lastProgress=Pe.Math_clamp1(n*this._elapsedSeconds/this._durationSeconds+this._progressAtStart,0,1)}else this._lastProgress=this._progressType==vn.ProgressType.REVERSE?0:1}constructor(){this._lastProgress=-1,this._durationSeconds=-1,this._elapsedSeconds=-1,this._timeOfLastTransitionFrame=-1,this._progressAtStart=0,this._timeOfTransitionStart=-1,this.frameTimesMs=[],this._progressType=vn.ProgressType.FORWARD,this._externalOnTickProgress=null,this._externalOnTransitionEnded=null}};(r=>{let g;(s=>(s[s.FORWARD=0]="FORWARD",s[s.REVERSE=1]="REVERSE",s[s.EXTERNAL=2]="EXTERNAL"))(g=r.ProgressType||(r.ProgressType={}));let e;(a=>(a[a.ABORT=0]="ABORT",a[a.COMMIT=1]="COMMIT"))(e=r.TransitionEndedAction||(r.TransitionEndedAction={}));let t;(i=>{function o(a){return r.ProgressType[a]}i.ProgressType_toString=o})(t=r.in_ProgressType||(r.in_ProgressType={}));let n;(i=>{function o(a){return r.TransitionEndedAction[a]}i.TransitionEndedAction_toString=o})(n=r.in_TransitionEndedAction||(r.in_TransitionEndedAction={}))})(vn||(vn={}));var ga;(t=>{function g(n,r){n(r)}t.applyTo=g;function e(n){return n}t._new=e})(ga||(ga={}));var wd=class{constructor(e){this._dragToAnimateBehavior=null,this._canvasView=null,this._canvasView=e}clearDrag(e){this._dragToAnimateBehavior==e&&(this._canvasView.removeInteractionObserver(this._dragToAnimateBehavior),this._dragToAnimateBehavior=null)}removeFrom(e){this.clearDrag(this._dragToAnimateBehavior)}getTransitionMixin(e,t,n){let r=t.interactionAddress.hotspotStablePath!=null?e.findNode3(t.interactionAddress.hotspotStablePath):null;if(r==null)return null;switch(t.cause){case 5:{if(!n&&qt.TransitionAction_getControlSource(t.cause)!=0){let o=mn.computeDragVector2(t,r,e);if(o!=null&&o.length()>0)return ga._new(i=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new mn(this,o,i,t.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}getTransitionMixinForStateSwap(e,t,n){switch(t.cause){case 5:{if(!n&&qt.TransitionAction_getControlSource(t.cause)!=0){let r=mn.computeDragVectorForStateSwap(t,e);if(r!=null&&r.length()>0)return ga._new(o=>{this._dragToAnimateBehavior!=null&&this.clearDrag(this._dragToAnimateBehavior),this._dragToAnimateBehavior=new mn(this,r,o,t.easingFunction()),this._canvasView.addInteractionObserver(this._dragToAnimateBehavior)})}break}}return null}},fi=class{static computeOverlaySwipeDragVector(e,t,n){let r=n.size(),o=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return r.multiply1(o.to().translation1().subtract1(o.from().translation1()))}static computeScreenSwipeDragVector(e,t,n){let r=t.size().max2(n.size()),o=e.drawsEnteringFrameOnTopOfExitingFrame()?e.enteringFrameTransition():e.exitingFrameTransition();return r.multiply1(o.to().translation1().subtract1(o.from().translation1()))}static computeSmartAnimateDragVector(e,t,n){if(t!=null&&n!=null&&e!=null){let r=_r.getNodeMatches(t,n),o=Me.StringMap_get(r,R.toString(e.id()),null);if(o!=null){let i=t.absoluteTransform().inverse().multipliedBy1(e.absoluteTransform()).transformPoint(e.size().divide(2));return n.absoluteTransform().inverse().multipliedBy1(o.absoluteTransform()).transformPoint(o.size().divide(2)).subtract1(i)}}return null}static computeDragVectorImpl(e,t,n,r,o,i,a){if(e==null)return null;if(t!=null&&n!=null){if(o=="SMART_ANIMATE"||xn.supportsSmartAnimate(o)&&a){let l=fi.computeSmartAnimateDragVector(e,t,n);if(l!=null&&l.length()>0)return l}if(["DISSOLVE","INSTANT_TRANSITION","SMART_ANIMATE"].indexOf(o)==-1){let l=_t.get(o);r==1&&(l=l.reversed());let u=null;if(["OVERLAY","SWAP"].indexOf(i)!=-1?u=fi.computeOverlaySwipeDragVector(l,t,n):u=fi.computeScreenSwipeDragVector(l,t,n),u.length()>0)return u}}return null}static computeDragVector1(e,t,n,r,o){if(e==null||t==null)return null;let i=null;for(let S of t.allActions())if(["INTERNAL_NODE","BACK","CLOSE"].indexOf(S.connectionType())!=-1){i=S;break}if(i==null)return null;let a=i.connectionType(),s=null,c=null,l=i.transitionShouldSmartAnimate(),u=0,d=n,h=null;if(a=="INTERNAL_NODE")if(c=i.navigationType(),s=i.transitionType(),c=="SWAP_STATE"){let S=jt.whichInstanceToSwap(e,i.transitionNodeID());S!=null&&(d=S,h=e.scene().findNode1(i.transitionNodeID()))}else c=="SWAP"&&(d=e.topLevelAncestor()),h=r.getDestinationFrame(i.transitionNodeID());else if(a=="BACK"){let S=o.getPreviousNonTransientChange();if(S==null)return null;h=r.getDestinationFrame(S.oldStateId()),s=S.transitionParameters.transitionType,c="NAVIGATE",u=1}else if(a=="CLOSE"){h=e.topLevelAncestor();let S=o.getOpenOverlayData(h.id());if(S==null)return null;s=S.openingTransitionType(),c="OVERLAY",u=1}return fi.computeDragVectorImpl(e,d,h,u,s,c,l)}static computeDragVector2(e,t,n){let r=null,o=null;if(e.oldStateId()==e.newStateId()&&e.oldOverlayData().length>0&&e.oldOverlayData().length==e.newOverlayData().length){let a=e.oldOverlayData()[e.oldOverlayData().length-1],s=e.newOverlayData()[e.newOverlayData().length-1];r=n.findNode1(a.id),o=n.findNode1(s.id)}else if(r=n.findNode1(e.oldStateId()),e.transitionParameters.navigationType=="OVERLAY"){let a=e.direction==1?e.getRemovedFrameIds():e.getInsertedFrameIds();o=n.findNode1(a[0])}else o=n.findNode1(e.newStateId());return fi.computeDragVectorImpl(t,r,o,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}static computeDragVectorForStateSwap(e,t){var s,c;let n,r,o=t.findNode3(e.stablePath),i=(s=o==null?void 0:o.transitioningFrom)==null?void 0:s.exitingTransitionRoot,a=(c=o==null?void 0:o.transitioningFrom)==null?void 0:c.hotspotInExitingTree;return fi.computeDragVectorImpl(a,i,o,e.direction,e.transitionParameters.transitionType,e.transitionParameters.navigationType,e.transitionParameters.transitionShouldSmartAnimate)}constructor(e,t,n,r){let o;this._dragStartPosition=null,this._currPointerPosition=null,this._lastPointerPosition=null,this._currPointerTime=-1,this._lastPointerTime=-1,this._didRecordPointerPosition=!1,this._pointerVelocity=null,this._shouldRevertTransition=!1,this._behaviorManager=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._lastPointerTime=We.seconds(),this._behaviorManager=e,this._dragVector=t,this._easingFunction=r,this._transitionProgress=n,(o=this._transitionProgress)!=null&&o.pinProgressToExternalControl(()=>this.onTickProgress(),()=>this.onTransitionEnded())}handleDrag(e){this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,this._currPointerTime=We.seconds(),this._currPointerPosition=e,this._didRecordPointerPosition=!0}handleDragStart(e){this._dragStartPosition=e}handleRelease(e){if(this._transitionProgress!=null&&this._transitionProgress.isProgressControlledExternally()){let t=this._transitionProgress.progress(),n=this._easingFunction!=null?this._easingFunction.invert(t):t,r=this.signedDragSpeed(),o=this._transitionProgress.duration(),i=o>0?fi.DRAG_SPEED_THRESHOLD_MULTIPLE/o:0,a=r>=i,s=r<=-i;this._shouldRevertTransition=!1,t>=.5?this._shouldRevertTransition=s:this._shouldRevertTransition=!a;let c=1;if(this._shouldRevertTransition&&(c=Pe.Math_clamp1(Math.log(n+.5)/Math.log(2)+1,.02,1)),Math.abs(r)>=1/o){let l=this._easingFunction!=null?this._easingFunction.getDerivative(n,r):1;c=Math.abs(r/l)}this._transitionProgress.pinProgressToRealTimeWithDuration(n,o/c,this._shouldRevertTransition)}}onTickProgress(){if(this._dragVector!=null){if(this._currPointerPosition!=null&&this._dragStartPosition!=null){if(this._lastPointerPosition!=null&&this._lastPointerTime!=-1){let n=this._currPointerTime;this._didRecordPointerPosition||(this._lastPointerTime=this._currPointerTime,this._lastPointerPosition=this._currPointerPosition,n=We.seconds(),this._currPointerTime=n),this._pointerVelocity=this._currPointerPosition.subtract1(this._lastPointerPosition).divide(n-this._lastPointerTime)}let e=this._currPointerPosition.subtract1(this._dragStartPosition),t=Pe.Math_clamp1(e.dot(this._dragVector)/Math.pow(this._dragVector.length(),2),0,1);return this._didRecordPointerPosition=!1,t}return this._didRecordPointerPosition=!1,0}return this._didRecordPointerPosition=!1,1}onTransitionEnded(){return this._dragStartPosition=null,this._dragVector=null,this._easingFunction=null,this._transitionProgress=null,this._behaviorManager!=null&&this._behaviorManager.clearDrag(this),this._shouldRevertTransition?vn.TransitionEndedAction.ABORT:vn.TransitionEndedAction.COMMIT}signedDragSpeed(){return this._pointerVelocity==null||this._dragVector==null?0:this._dragVector.length()>0?this._pointerVelocity.dot(this._dragVector)/Math.pow(this._dragVector.length(),2):0}},mn=fi;mn.DRAG_SPEED_THRESHOLD_MULTIPLE=.15;var fr=class{static logVerbose(e){fr.VERBOSE_LOGS&&console.log("[IncrementalFrameLoader]",e())}static MAX_SLIDESHOW_PRELOAD_DISTANCE(){return Q.protoPreloadMore()?3:2}constructor(e,t,n){this._multiplayer=null,this._appState=null,this._emitter=null,this._canvas=null,this._deferredUpdateDeadline=null,this._currentQueries=new wo,this._previousSceneGraphReply=new wo,this._rootLevelSceneGraphQuery=Qn.create(R._new(0,0),1),this._requestSectionsOnCanvas=!1,this._requestedTlfIds=new rr,this._currentTlfIds=[],this._requestedSectionsQueue=[],this._pendingNodeToRequest=null,this._multiplayer=t,this._multiplayer.addObserver(this),this._appState=e,e.addAppObserver(this),e.prototypeState().addObserver(this),this._emitter=n,this._emitter.on("Slow incremental load",r=>{Je.trackEventJSON1("Slow incremental load",r)}),console.debug("Using incremental frame loading")}simulateRepliedQueriesForTests(e){this._currentQueries=wo.fromList(e),this.handleSceneGraphReply(0,e)}requestTlf(e){return this._setCurrentTlfIds([e]),this._isFullyLoaded(e)?!0:(this._requestedTlfIds.add(R.toString(e)),this._redeferUpdate(0),!1)}_setCurrentTlfIds(e){this._currentTlfIds=e}_requestTlfs(e){this._setCurrentTlfIds(e);for(let t of e)this._isFullyLoaded(t)||(this._requestedTlfIds.add(R.toString(t)),this._redeferUpdate(0))}_isFullyLoaded(e){var o;let t,n=(o=this._multiplayer.scene())==null?void 0:o.findNode1(e);if(n==null)return!1;let r=n;for(;r!=null;){if(this._previousSceneGraphReply.containsExactQuery(Qn.create(r.id(),0)))return!0;r=r.parent()}return!1}_isQueryPresent(e,t){for(let n of t)if(Sr.equals(n,e))return!0;return!1}_getQueriesToLoad(){let e=new wo;return Q.getFeatureFlags().prototypeSectionsIncFrameLoading?this._requestedSectionsQueue.length!=0&&this._getSectionSceneGraphQueries().each(n=>{e.add(n)}):this._requestSectionsOnCanvas&&(this._getSectionSceneGraphQueriesGivenNode(this._canvas).each(n=>{e.add(n)}),this._requestSectionsOnCanvas=!1),this._addRequestedTlfs(e),this._appState.scene()!=null&&this._addScreenAdjacencies(e),e}_getSectionSceneGraphQueriesGivenNode(e){let t=new wo;if(this._multiplayer.scene()!=null){if(e==null||e.type()!="DOCUMENT"&&e.type()!="CANVAS"&&e.type()!="SECTION")return t;Se.forEachNode2(e,n=>{if(n.type()=="SECTION"){let r=Qn.create(n.id(),0);t.add(r)}})}return t}_getSectionSceneGraphQueries(){var r;let e,t=new wo,n=[];if(this._multiplayer.scene()!=null){for(;this._requestedSectionsQueue.length!=0;){let o=this._requestedSectionsQueue.shift(),i=(r=this._multiplayer.scene())==null?void 0:r.findNode1(o);i==null||i.type()!="DOCUMENT"&&i.type()!="CANVAS"&&i.type()!="SECTION"||Se.forEachNode2(i,a=>{if(a.id()!=i.id()&&a.type()=="SECTION"){let s=Qn.create(a.id(),1);t.add(s),n.push(a.id())}})}this._requestedSectionsQueue=n}return t}_addRequestedTlfs(e){var n;let t;fr.logVerbose(()=>"Visiting requestedTlfs for next queries:"+this._requestedTlfIds.asList().map(r=>Bn.string_toString(r)).join(","));for(let r of this._requestedTlfIds.asList()){let o=R.fromString(r);if(o==null)continue;if(!this._previousSceneGraphReply.containsNodeById(o)){e.add(Qn.create(o,1));continue}let a=(n=this._multiplayer.scene())==null?void 0:n.findNode1(o);if(this._requestedTlfIds.remove(R.toString(o)),a==null){let s=R._new(0,0);e.add(Qn.create(s,1)),this._requestedTlfIds.add(R.toString(s))}else if(a.type()=="DOCUMENT"){this._emitter.trigger("redirectingToFirstPageDueToInvalidStartNode",null);let s=this._multiplayer.scene().firstUserCanvasOrNull();if(s==null){console.error("No user-visible canvases");continue}this._requestedTlfIds.add(R.toString(s.id())),e.add(Qn.create(s.id(),1))}else if(a.type()=="CANVAS"){let s=!1;if(Q.getFeatureFlags().prototypeSectionsIncFrameLoading){this._requestedSectionsQueue.push(a.id());let l=this._getSectionSceneGraphQueries();s=l.count()>0,l.each(u=>{e.add(u)})}else{let l=this._getSectionSceneGraphQueriesGivenNode(a);s=l.count()>0,l.each(u=>{e.add(u)})}let c=this._appState.prototypeStructure().nodeToRestartPrototypeOn(a);if(c==null){s||console.error("No top-level frames present");continue}this._requestedTlfIds.add(R.toString(c.id())),e.add(Qn.create(c.id(),0)),this._setCurrentTlfIds([c.id()])}else{for(;a!=null&&!a.isTopLevel();)a=a.parent();a!=null&&(e.add(Qn.create(a.id(),0)),this._canvas=a.findContainingCanvasOrParent(),e.add(Qn.create(this._canvas.id(),1)),Q.getFeatureFlags().prototypeSectionsIncFrameLoading?(this._requestedSectionsQueue.push(this._canvas.id()),this._getSectionSceneGraphQueries().each(c=>{e.add(c)}),this._requestedSectionsQueue.length==0&&this._requestedSectionsQueue.push(this._canvas.id())):(this._getSectionSceneGraphQueriesGivenNode(this._canvas).each(c=>{e.add(c)}),this._requestSectionsOnCanvas=!0))}}}_addScreenAdjacencies(e){Q.getViewerMode()==Q.ViewerMode.PROTOTYPE&&this._appState.prototypeStructure().currentType()==1?this._addScreenAdjacenciesForSlideshow(e):this._addScreenAdjacenciesForPrototype(e)}_addScreenAdjacenciesForSlideshow(e){let t=Ft.visuallySortedTopLevelFrames(this._appState.getActiveCanvas()),n=t.map(o=>R.toString(o.id()));if(this._currentTlfIds.length==0||!R.isValid(this._currentTlfIds[0]))return;let r=n.indexOf(R.toString(this._currentTlfIds[0]));if(!(r<0))for(let o=r-fr.MAX_SLIDESHOW_PRELOAD_DISTANCE(),i=r+fr.MAX_SLIDESHOW_PRELOAD_DISTANCE()+1;o<i;o=o+1)o>=0&&o<t.length&&e.add(Qn.create(t[o].id(),0))}_addScreenAdjacenciesForPrototype(e){if(this._currentTlfIds.length==0||!R.isValid(this._currentTlfIds[0]))return;let t=new fr.Queue;for(let c=this._currentTlfIds.length-1;c>=0;c=c-1)t.pushBackIfUnseen(this._currentTlfIds[c],0);let n=0,r=[],o=this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF();for(;t.nonempty()&&(t.front().depth<=1||n<fr.MAX_PROTOTYPE_BFS_COUNT);){let c=t.popFront(),l=c.guid,u=this._previousSceneGraphReply.containsExactQuery(Qn.create(l,0));r.push(new fr.WorkingSetItem(l,u));let d=this._appState.scene().findNode1(l);if(d==null||(c.depth>0&&(n=n+1),c.depth>=fr.MAX_PROTOTYPE_BFS_DEPTH))continue;let h=Ft.adjacentBaseScreens(o,d);Se.forEachNode2(d,S=>{let f;(f=S.prototypeInteractions())!=null&&f.forEach(y=>{for(let v of y.allActions())if(R.isValid(v.transitionNodeID())&&h.add(v.transitionNodeID()),v.connectionType()=="BACK"){let b=this._appState.prototypeState().getLastChangeInHistory();b!=null&&b.getRemovedFrameIds().forEach(m=>{m!=null&&h.add(m)})}})});for(let S of h.asList())t.pushBackIfUnseen(S,c.depth+1)}let i=this._appState.prototypeState().getInitiatedChange();if(i!=null)for(let c of i.oldStateAndOverlays.statesAndOverlaysIncluded().asList()){let l=R.fromString(c);r.unshift(new fr.WorkingSetItem(l,this._previousSceneGraphReply.containsExactQuery(Qn.create(l,0))))}Rn.track2("[IFL] Working set size",r.length);let a=0,s=0;for(let c of r)if(e.add(Qn.create(c.nodeId,0)),c.isAlreadySubscribed?s=s+1:a=a+1,a>=fr.MAX_PROTOTYPE_TLF_BATCH_SIZE)break;Rn.track2("[IFL] Working set frames loaded",s)}_requestNextQueriesToLoad(e){if(e.add(this._rootLevelSceneGraphQuery),e.equals(this._currentQueries))return;Q.protoUseFrameEviction()?(this._multiplayer.scene()!=null&&this._currentQueries.each(n=>{let r=this._multiplayer.scene().findNode2(_a.toString(n.startingNode));r!=null&&(r.type()=="DOCUMENT"||r.type()=="CANVAS"||r.type()=="SECTION")&&e.add(n)}),this._currentQueries=e):e.each(n=>{this._currentQueries.add(n)});let t=[];for(let n of this._currentQueries.asList())t.push(n);fr.logVerbose(()=>"setting scene graph queries:"+t.map(n=>Sr.toString(n)).join(",")),this._multiplayer.setSceneGraphQueries(t)}_redeferUpdate(e){this._deferredUpdateDeadline!=null&&this._deferredUpdateDeadline.cancel(),this._deferredUpdateDeadline=new Xa(()=>{fr.logVerbose(()=>`update............
`+(fr.VERBOSE_LOGS_SHOW_SCENEGRAPH?this._multiplayer.scene().root().hierarchyString():"")),this._requestNextQueriesToLoad(this._getQueriesToLoad()),this._deferredUpdateDeadline=null},e)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._redeferUpdate(0)}handleActiveCanvasChange(e,t){this._redeferUpdate(0)}handleActivePrototypeStartingPointChange(e,t){}handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){this._redeferUpdate(0)}handleStateChangeRequested(e){let t=e.newStateAndOverlays.statesAndOverlaysIncluded(),n=[];for(let r of t.asList())n.push(R.fromString(r));this._requestTlfs(n)}handleFitModeChange(e,t){}handleRestartPrototype(){}handleConnect(e,t){e==0&&(this._previousSceneGraphReply=new wo,this._currentQueries=new wo,this._redeferUpdate(0),Q.getViewerMode()==Q.ViewerMode.PROTOTYPE&&t==null&&(t=R._new(0,0)),t!=null&&(this._pendingNodeToRequest=t))}handleDisconnect(){}handleJoinStart(e,t,n){this._pendingNodeToRequest!=null&&this.requestTlf(this._pendingNodeToRequest),this._pendingNodeToRequest=null}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){}handleSceneChangedLoadingPhase(e,t){}handleSceneGraphReply(e,t){Je.handleMultiplayerFirstResponse(),fr.logVerbose(()=>{let o="";return o+=`
-----handleSceneGraphReply-----
`,o+="sceneGraphQueries:"+t.map(i=>Sr.toString(i)).join(",")+`
`,fr.VERBOSE_LOGS_SHOW_SCENEGRAPH&&(o+=this._multiplayer.scene().root().hierarchyString()+`
`),o+="-----------------------------------",o}),this._previousSceneGraphReply=wo.fromList(t);let n=this._getQueriesToLoad();n.isSubsetOf(this._previousSceneGraphReply)?(Je.handleMultiplayerIFLSatisfied(),fr.logVerbose(()=>"All queries satisfied! Calling finishIncrementalLoading..."),this._multiplayer.finishIncrementalLoading(),Je.handleIFLCompleted()):this._requestNextQueriesToLoad(n)}handleSceneGraphEvent(e){if(zr.isPrototypeStructuralChange(e.property)){if(e.node.type()=="SECTION"&&e.property==24&&(this._requestSectionsOnCanvas=!0),this._deferredUpdateDeadline!=null&&this._deferredUpdateDeadline.delayMs==0)return;this._redeferUpdate(Si||Rr?0:250)}}},Po=fr;Po.VERBOSE_LOGS=!1,Po.VERBOSE_LOGS_SHOW_SCENEGRAPH=!1,Po.MAX_PROTOTYPE_BFS_DEPTH=2,Po.MAX_PROTOTYPE_BFS_COUNT=4,Po.MAX_PROTOTYPE_TLF_BATCH_SIZE=4;(n=>{class g{constructor(o,i){this.guid=o,this.depth=i}}n.Entry=g;class e{constructor(o,i){this.nodeId=o,this.isAlreadySubscribed=i}}n.WorkingSetItem=e;class t{nonempty(){return this._queue.length>0}pushBackIfUnseen(o,i){let a=R.toString(o);this._seen.has(a)||(this._seen.set(a,!0),this._queue.push(new n.Entry(o,i)))}front(){return this._queue[0]}popFront(){return this._queue.shift()}constructor(){this._queue=[],this._seen=new Map}}n.Queue=t})(Po||(Po={}));var wo=class{add(e){let t=Sr.nodeIdString(e);if(!this._hash.has(t))this._hash.set(t,e);else{let n=this._hash.get(t);if(n.depth==0)return;(e.depth==0||e.depth>n.depth)&&this._hash.set(t,e)}}containsNodeById(e){return e!=null&&this._hash.has(R.toString(e))}containsExactQuery(e){return this.containsNodeById(R.fromFigGUID(e.startingNode))?this._hash.get(Sr.nodeIdString(e)).depth==e.depth:!1}remove(e){this._hash.delete(Sr.hash(e))}count(){return this._hash.size}asList(){return Array.from(this._hash.values())}each(e){Array.from(this._hash.values()).forEach(e)}equals(e){if(e==null||this.count()!=e.count())return!1;for(let t of Array.from(this._hash.values()))if(!e.containsExactQuery(t))return!1;return!0}isSubsetOf(e){if(e==null||this.count()>e.count())return!1;for(let t of Array.from(this._hash.values()))if(!e.containsExactQuery(t))return!1;return!0}toJSObject(){return Me.StringMap_toJSObject(this._hash)}static fromList(e){let t=new wo;for(let n of e)t.add(n);return t}constructor(){this._hash=new Map}},Yo=class{constructor(e,t){this.delayMs=0,this.callback=null,this._timeoutID=0,this.callback=e,this._timeoutID=Yo._setTimeout(e,t),this.delayMs=t}cancel(){Yo._clearTimeout(this._timeoutID)}static _setTimeout(e,t){if(2==0){let n=(Yo._nextMockTimeoutID=Yo._nextMockTimeoutID+1)+-1;return Yo._mockTimeouts.set(n,e),n}else return setTimeout(e,t)}static _clearTimeout(e){2==0?Yo._mockTimeouts.delete(e):clearTimeout(e)}static fireAllMockedTimeouts(){let e=Array.from(Yo._mockTimeouts.keys());for(let t of e)Yo._mockTimeouts.get(t)(),Yo._mockTimeouts.delete(t)}},Xa=Yo;Xa._nextMockTimeoutID=1,Xa._mockTimeouts=new Map;var kl=class{constructor(){if(arguments[0]==0){let[,e]=arguments;this.ws=null,this.ws=e}else if(arguments[0]==1){let[,e]=arguments;this.ws=null,this.ws=new WebSocket(e)}}url(){return this.ws.url}readyState(){return this.ws.readyState}setBinaryType(e){this.ws.binaryType=e}binaryType(){return this.ws.binaryType}setOnclose(e){this.ws.onclose=t=>{e(t)}}setOnerror(e){this.ws.onerror=t=>{e(t)}}setOnmessage(e){this.ws.onmessage=t=>{e(new jh(t))}}setOnopen(e){this.ws.onopen=t=>{e(t)}}close(){this.ws.close()}send1(e){this.ws.send(e)}send2(e){this.ws.send(e)}equals(e){var n;let t;return this.ws==((n=e==null?void 0:e.asHTMLSocket())==null?void 0:n.ws)}asHTMLSocket(){return this}asMockSocket(){return null}},Fd=class{simulateDidOpen(){if(this._readyState=jo.Socket_OPEN,this._onopen!=null){let e={meta:"Fake open event for testing"};this._onopen(e)}}simulateDidClose(){if(this._readyState=jo.Socket_CLOSED,this._onclose!=null){let e={meta:"Fake close event for testing"};this._onclose(e)}}simulateMessage(e){this._onmessage!=null&&this._onmessage(e)}url(){return Fd.FAKE_URL}readyState(){return this._readyState}setBinaryType(e){this._binaryType=e}binaryType(){return this._binaryType}setOnclose(e){this._onclose=e}setOnerror(e){this._onerror=e}setOnmessage(e){this._onmessage=e}setOnopen(e){this._onopen=e}close(){this._readyState=jo.Socket_CLOSING}send1(e){this.sent.push(new Uint8Array(e))}send2(e){this.sent.push(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}equals(e){return(e==null?void 0:e.asMockSocket())==this}asHTMLSocket(){return null}asMockSocket(){return this}constructor(){this._readyState=jo.Socket_CONNECTING,this._binaryType="blob",this._onclose=null,this._onerror=null,this._onmessage=null,this._onopen=null,this.sent=[]}},Pd=Fd;Pd.FAKE_URL="ws://fake_url_for_tests_value_does_not_matter.com";var jh=class{isArrayBuffer(){return this.messageEvent.data instanceof ArrayBuffer}isBlob(){return this.messageEvent.data instanceof Blob}isString(){return typeof this.messageEvent.data=="string"}dataAsArrayBuffer(){return this.messageEvent.data}dataAsBlob(){return this.messageEvent.data}dataAsString(){return this.messageEvent.data}constructor(e){this.messageEvent=e}},jo;(r=>(r.Socket_CONNECTING=0,r.Socket_OPEN=1,r.Socket_CLOSING=2,r.Socket_CLOSED=3))(jo||(jo={}));var lr=class{add(e){this._observers=nn.FrozenList_cloneAndAppendOne(this._observers,e)}remove(e){this._observers=nn.FrozenList_cloneAndRemoveOne(this._observers,e)}forEach(e){let t=this._observers;t.forEach(n=>{(t==this._observers||this._observers.indexOf(n)!=-1)&&e(n)})}constructor(){this._observers=[]}};var Dd=class{version(){return mpGlobal.version}sock(){return mpGlobal.sock!=null?new kl(0,mpGlobal.sock):null}setSock(e){if(e!=null){let t=e.asHTMLSocket();t==null&&console.warn("Ignoring invalid socket binding for mpGlobal"),mpGlobal.sock=t.ws}else mpGlobal.sock=null}msgs(){return mpGlobal.msgs}setMsgs(e){mpGlobal.msgs=e}perfMetrics(){return mpGlobal.perfMetrics}setPerfMetrics(e){mpGlobal.perfMetrics=e}url(e){return mpGlobal.url(e)}preconnect(e){mpGlobal.preconnect(e)}newSocket(e){return new kl(1,e)}constructor(){}},Ul=class{static attemptToParseFrom(e){try{let t=JSON.parse(e);return new Ul(t.url,t.type)}catch{ze("Failed to parse TooManyConnectionsPayload")}return null}constructor(e,t){this.url=e,this.type=t}},Gl=(t=>(t[t.FLUSH_AT_NEXT_INTERVAL=0]="FLUSH_AT_NEXT_INTERVAL",t[t.FORCE_FLUSH=1]="FORCE_FLUSH",t))(Gl||{}),Fo=class{static hasPrefix(e,t){if(e.length>=t.length){for(let n=0,r=t.length;n<r;n=n+1)if(e[n]!=t.charCodeAt(n))return!1;return!0}return!1}constructor(e,t,n,r){this._appState=null,this._isWindowActive=null,this._emitter=null,this._mpContext=null,this._incrementalLoader=null,this._role="viewer",this._scene=null,this._userSyncing=null,this._heartbeatTimeout=0,this._consecutiveFailedConnectionAttempts=0,this._attemptsSinceLastConnectionSuccess=0,this._hasConnectedAtLeastOnce=!1,this._onlineChangeHandler=null,this._reconnectionTimeout=0,this._isConnected=!1,this._isJoined=!1,this._shouldReconnect=!0,this._socket=null,this._url=null,this._fileKey=null,this._oauthToken=null,this._nodeId=null,this._partialSnapshotInfo=new xd(null,null,null),this._reconnectKey=null,this._previousTlfID=null,this._previousCanvasSpaceMouseLocation=null,this._sessionID=0,this._observingSessionID=-1,this._presenterSessionID=null,this._sessionsNominatingCurrentUser=new Set,this._sessionNominatedByCurrentUser=null,this._cachedNextUserChange=null,this._canvasSpaceClicks=[],this._nextCanvasSpaceClickID=0,this._pendingSceneGraphQueriesOrNull=null,this._lastSceneGraphQueryTime=0,this._lastSceneGraphQueryConcurrency=0,this._lastSentSceneGraphQueriesOrNull=null,this._observers=new lr,this._sceneLoadingPhase=0,this._prototypeLibCppEnabledForPendingFile=1,this._connectType=0,this._sessionSchema=null,this._staticFileRequest=null,this.maxScrollPositionsToStore=10,this._recentlyChangedScrollPositions=[],this._lastFlush=-1,this._appState=e,this._isWindowActive=t,this._emitter=n,this._appState.addAppObserver(this),e.prototypeState().addObserver(this),e.prototypeState().addHsmObserver(this),this._mpContext=r,this._incrementalLoader=new Po(this._appState,this,this._emitter)}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}fileKey(){return this._fileKey}observingSessionID(){return this._observingSessionID}setObservingSessionID(e){this._observingSessionID=e,this._getOrCreateNextUserChange().observing=[e]}observedUser(){let e;return(e=this._userSyncing)!=null?Ht.IntMap_get(e.userBySessionID(),this._observingSessionID,null):null}isObserving(){return this.observingSessionID()!=-1}presenterSessionID(){return this._presenterSessionID}removeNominator(e){this._sessionsNominatingCurrentUser.delete(e)}sessionsNominatingCurrentUser(){return Array.from(this._sessionsNominatingCurrentUser.values())}sessionNominatedByCurrentUser(){return this._sessionNominatedByCurrentUser}setPresenterSessionID(e){this._presenterSessionID=e}scene(){return this._scene}incrementalLoader(){return this._incrementalLoader}socketForTesting(){var t;let e;return(t=this._socket)==null?void 0:t.asMockSocket()}setMultiplayerUserSyncing(e){this._userSyncing=e}setScene(e){this._scene=e}isConnected(){return this._isConnected}fulfilledMultiplayerQueries(){return this._partialSnapshotInfo.fulfilledQueries}_setSceneLoadingPhase(e){let t=this._sceneLoadingPhase;switch(this._sceneLoadingPhase=e,t!=e&&this._observers.forEach(n=>{n.handleSceneChangedLoadingPhase(t,e)}),e){case 0:break;case 1:{console.log("sceneWillRebuildAfterReconnecting"),this._emitter.trigger("sceneWillRebuildAfterReconnecting",null);break}case 2:{t==0?this._appState.fontListPromise().then(n=>{console.debug("sceneDidCompleteInitialLoad"),this._emitter.trigger("sceneDidCompleteInitialLoad",null)}):t==1&&(console.log("sceneDidRebuildAfterReconnecting"),this._emitter.trigger("sceneDidRebuildAfterReconnecting",null)),this._socket!=null&&this._sendSignal("client-rendered","");break}}}setNodeLoadedStatusesAndUpdate(e){this._setCanvasLoadedStatuses(e),this._setTlfLoadedStatuses(e),this._appState.prototypeState().tryToInitiateRequestedStateChange(En.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED),this._appState.trySettingRequestedActiveCanvas()}_setCanvasLoadedStatuses(e){this.scene().root().forEachChild(t=>{t.type()!="CANVAS"||t.isInternalOnly()||(e==null||e.some(n=>Sr.fullyLoadsNode(n,t)))&&t.setHasBeenLoaded(!0)})}_setTlfLoadedStatuses(e){var a,s;let t,n,r,o=0,i=0;Fo.VERBOSE&&(console.log("-----------_setTlfLoadedStatuses-----------"),((a=this.scene())==null?void 0:a.root())!=null&&this.scene().root().forEachChild(c=>{c.forEachChild(l=>{l.hasBeenLoaded()&&(o=o+1)})})),this.scene().setTlfsLoaded(c=>e==null||e.some(l=>Sr.fullyLoadsNode(l,c))),Fo.VERBOSE&&(((s=this.scene())==null?void 0:s.root())!=null&&this.scene().root().forEachChild(c=>{c.forEachChild(l=>{l.hasBeenLoaded()&&(i=i+1)})}),console.log(`\u{1F69A} numLoaded ${i-o} (${o} -> ${i})`),console.log("--------------------------------------------")),(t=x._prototypeLib)!=null&&t.applyExistingVariableChangesToIFLLoadedNodes()}_finishLoadingIfNecessary(){var n;let e;if(this._sceneLoadingPhase==2)return;this._appState.setCurrentFileKey(this._fileKey),this._appState.setScene(this._scene);let t=null;if(this._nodeId!=null){let r=this._appState.scene().findNode1(this._nodeId),o=r==null?void 0:r.findContainingCanvasOrSelf();o!=null&&this._appState.setActiveCanvas(o),t=(n=this._appState.prototypeStructure())==null?void 0:n.validDestinationForPrototypeFromId(this._nodeId)}t!=null?this._appState.prototypeState().navigateToFrameAndCloseOverlays1(t.id()):this._appState.prototypeState().restartPrototype(0),Q.getFeatureFlags().prototypeIflDelaySceneLoad?this._scene.isLoadedTlfsEmpty()||this._setSceneLoadingPhase(2):this._setSceneLoadingPhase(2)}finishIncrementalLoading(){this._finishLoadingIfNecessary(),this._emitter.trigger("incrementalLoadingInfo",{type:"finishIncrementalLoading",fileKey:this._fileKey})}sessionID(){return this._sessionID}role(){return this._role}setRole(e){this._role=e}currentSceneGraphQueries(){return this._pendingSceneGraphQueriesOrNull!=null?this._pendingSceneGraphQueriesOrNull:this._lastSentSceneGraphQueriesOrNull!=null?this._lastSentSceneGraphQueriesOrNull:[]}connectTo(e,t,n,r){this._connectTo(e,Xo.INITIAL,t,n,r)}attemptReconnect(){var r,o;let e,t;if(this._scene==null||this._sceneLoadingPhase==0){this._scene!=null&&this._sceneLoadingPhase==0&&Je.trackEvent1("Viewer reconnected during initial load",new Map),this._connectTo(this._fileKey,Xo.INITIAL,this._nodeId,this._oauthToken,this._prototypeLibCppEnabledForPendingFile);return}let n=(o=this._appState.baseScreenId())!=null?o:(r=this._appState.getActiveCanvas())==null?void 0:r.id();this._connectTo(this._fileKey,Xo.RECONNECT,n,this._oauthToken,this._prototypeLibCppEnabledForPendingFile)}_connectTo(e,t,n,r,o){this._attemptsSinceLastConnectionSuccess=this._attemptsSinceLastConnectionSuccess+1,Je.handleMultiplayerOpenConnection(),this.disconnect(),this._fileKey=e,this._connectType=t,this._oauthToken=r,this._nodeId=n,this._prototypeLibCppEnabledForPendingFile=o,this._staticFileRequest!=null&&(this._staticFileRequest.cancel(),this._staticFileRequest=null);let i="";switch(t){case Xo.INITIAL:{i="initial-load",this._lastSentSceneGraphQueriesOrNull=null,this._pendingSceneGraphQueriesOrNull=null,this._partialSnapshotInfo=new xd(null,null,null);break}case Xo.RECONNECT:{i="reconnect",this._pendingSceneGraphQueriesOrNull==null&&this._lastSentSceneGraphQueriesOrNull!=null&&(this._pendingSceneGraphQueriesOrNull=this._lastSentSceneGraphQueriesOrNull,this._lastSentSceneGraphQueriesOrNull=null);break}}let a=this._mpContext.url({fileKey:e,role:this._role,oauthToken:r,connectionType:i}),s=this._partialSnapshotInfo.isValid()&&this._pendingSceneGraphQueriesOrNull!=null&&this._queriesAreEqual(this._partialSnapshotInfo.fulfilledQueries,this._pendingSceneGraphQueriesOrNull);this._scene!=null&&s&&(this._partialSnapshotInfo.snapshotHash!=null&&(a+=`&snapshot-hash=${encodeURIComponent(this._partialSnapshotInfo.snapshotHash)}`),this._partialSnapshotInfo.reconnectSequenceNumber!=null&&(a+=`&reconnect-sequence-number=${encodeURIComponent(this._partialSnapshotInfo.reconnectSequenceNumber.value.toString())}`),a+=`&scenegraph-queries=${encodeURIComponent(Qn.serializeListForMultiplayerURL(this._pendingSceneGraphQueriesOrNull))}`,this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,ja.SKIP),this._pendingSceneGraphQueriesOrNull=null),this._reconnectKey!=null&&(console.log(`reconnecting with reconnect key ${this._reconnectKey}`),a+=`&reconnect-key=${encodeURIComponent(this._reconnectKey)}`),this._url=a,console.debug(`attempting to connect to ${a}`);let c=this._mpContext.sock(),l=this._mpContext.msgs();if(c!=null&&c.url()==a&&(c.readyState()==jo.Socket_CONNECTING||c.readyState()==jo.Socket_OPEN))console.debug(`Applied the preconnect optimization for URL ${a}`),this._mpContext.setSock(null),this._mpContext.setMsgs([]),this._mpContext.setPerfMetrics([]);else{if(c!=null){console.warn(`Preconnect URL ${c.url()} doesn't match URL ${a}, skipping preconnect optimization`);try{c.close()}catch{}}c=this._mpContext.newSocket(a),c.setBinaryType("arraybuffer"),l=[]}let u=()=>this._socket==null?c==null:this._socket.equals(c),d=!0,h=null;c.setOnopen(f=>{if(!u()){console.warn("ignoring 'open' event on old socket");return}this._consecutiveFailedConnectionAttempts=0,h()}),h=()=>{this._isConnected=!0,console.debug(`connected to ${this._url}`),Je.handleMultiplayerSocketConnectionAttempt(!0,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this._hasConnectedAtLeastOnce=!0,this._attemptsSinceLastConnectionSuccess=0,this._observers.forEach(f=>{f.handleConnect(t,n)})};let S=null;c.setOnmessage(f=>{if(!u()){console.warn("ignoring 'message' event on old socket");return}if(!f.isArrayBuffer()){console.warn("ignoring 'message' event without an ArrayBuffer payload");return}let y=new Uint8Array(f.dataAsArrayBuffer());S(y)}),S=f=>{if(d){if(d=!1,!x._prototypeLib.modules().prototype.handleServerSchema(f)){this.disconnect();return}this._sendSignal("feature-flags",JSON.stringify(Q.getFeatureFlags().originalObject))}else x._prototypeLib.modules().prototype.handleCompressedMultiplayerMessage(f,this.sessionID(),this._sceneLoadingPhase,Si)},c.setOnclose(f=>{if(!u()){console.warn("ignoring 'close' event on old socket");return}if(this._isConnected?Je.handleMultiplayerSocketDisconnected(this._isWindowActive()):Je.handleMultiplayerSocketConnectionAttempt(!1,this._attemptsSinceLastConnectionSuccess,!this._hasConnectedAtLeastOnce,this._isWindowActive()),this.disconnect(),!this._shouldReconnect){console.warn("File too busy, not reconnecting");return}let y=null,v=()=>{clearTimeout(this._reconnectionTimeout),this._onlineChangeHandler!=null&&($t.EventTarget_removeEventListener1(window,"online",this._onlineChangeHandler),this._onlineChangeHandler=null),this._isWindowActive()?this.attemptReconnect():y()};y=()=>{let b=Math.min(Fo.RECONNECTION_DELAY_MAX,Fo.RECONNECTION_DELAY_MIN*Math.pow(2,this._consecutiveFailedConnectionAttempts)),m=Fo.RECONNECTION_DELAY_MIN+(b-Fo.RECONNECTION_DELAY_MIN)*Math.random();console.debug(`attempting to reconnect to ${this._url} in ${m}s`),this._reconnectionTimeout=setTimeout(v,m*1e3|0),this._onlineChangeHandler=()=>{console.log("attempting to reconnect due to connectivity change"),navigator.onLine&&(this._consecutiveFailedConnectionAttempts=0,v())},$t.EventTarget_addEventListener1(window,"online",this._onlineChangeHandler)},y(),this._consecutiveFailedConnectionAttempts=this._consecutiveFailedConnectionAttempts+1}),this._socket=c,c.readyState()==jo.Socket_OPEN&&h(),l.forEach(S)}_decodeConcatenatedUncompressedMessages(e,t){let n=new this._sessionSchema.ByteBuffer(e);for(;n.length!==n._index;){let r=null;try{r=this._sessionSchema.decodeMessage(n)}catch(o){console.error(`decoding failed: '${o.message}'`);return}Fo.VERBOSE&&console.log(`got message of type '${r.type}'`),t(r)}}handleUncompressedMessage(e,t){this._decodeConcatenatedUncompressedMessages(e,n=>{switch(n.type){case"JOIN_START":case"JOIN_START_SKIP_RELOAD":{this._handleJoinStartOrJoinStartSkipReload(n,this._connectType);break}case"JOIN_END":{this._handleJoinEnd();break}case"SCENE_GRAPH_REPLY":{this._handleSceneGraphReply(n);break}case"NODE_CHANGES":throw new Error("handleUncompressedMessage cannot handle a NODE_CHANGES payload. Did you mean to process this message in C++ and call PrototypeApp::didReceiveNodeChanges instead?");case"USER_CHANGES":{this._userSyncing!=null&&this._userSyncing.handleUserChanges(n,this);break}case"SIGNAL":{this._handleSignal(n);break}case"NOTIFY_SHOULD_UPGRADE":{this._handleNotifyShouldUpgrade();break}case"CLIENT_BROADCAST":{this._handleClientBroadcast(n);break}}})}handleUncompressedSchema(e){try{this._sessionSchema=kiwi.compileSchema(kiwi.decodeBinarySchema(e))}catch(t){return console.error(`schema decoding failed: '${t.message}'; uncompressedBytes is ${e.length}`),!1}return!0}didReceiveNodeChanges(e,t){if(this._scene==null){console.warn("ignoring 'NODE_CHANGES' event without a scene");return}this._emitter.trigger("incrementalLoadingInfo",{type:"receiveNodeChanges",size:e}),this._partialSnapshotInfo.snapshotHash=null,t!==null&&t!=null&&(this._partialSnapshotInfo.reconnectSequenceNumber=new fe(t)),this._observers.forEach(n=>{n.handleNodeChanges()}),this._isJoined||(console.log("server sent the full document (vs. incrementally loading)"),this.setNodeLoadedStatusesAndUpdate(null),this._finishLoadingIfNecessary())}_handleJoinStartOrJoinStartSkipReload(e,t){let n=0;if(e.type=="JOIN_START"?n=qi.NORMAL:(n=qi.SKIP_RELOAD,console.debug("performing fast reconnect to skip scene reload")),t==Xo.INITIAL?this._setSceneLoadingPhase(0):t==Xo.RECONNECT&&n!=qi.SKIP_RELOAD&&this._setSceneLoadingPhase(1),this._sessionID=e.sessionID,n!=qi.SKIP_RELOAD){let r=yt.createScene(this._sessionID,this._prototypeLibCppEnabledForPendingFile);this.setScene(r),r.setFileKey(this.fileKey()),this._appState.setScene(null)}else this._sendSignal("client-rendered","");this._observers.forEach(r=>{r.handleJoinStart(n,e.sessionID,e.fileVersion)})}_handleJoinEnd(){this._isJoined=!0,this._enableHeartbeatTimer(),this._cachedNextUserChange!=null&&(this._getOrCreateNextUserChange().recentClicks=[]),this._pendingSceneGraphQueriesOrNull!=null&&(this._sendSceneGraphQueries(this._pendingSceneGraphQueriesOrNull,ja.DO_NOT_SKIP),this._pendingSceneGraphQueriesOrNull=null),this._observers.forEach(e=>{e.handleJoinEnd()}),this.handleStateChangeInitiated(new Gn(0,En.ROOT_STABLE_PATH()))}_handleSceneGraphReply(e){this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency-1,Rn.increment("[IFL] sceneGraphQueriesReceived",1),Rn.track2("[IFL] Total Loaded Nodes",e.sceneGraphQueries.length),this._emitter.trigger("incrementalLoadingInfo",{type:"receiveSceneGraphReply",queries:e.sceneGraphQueries.map(t=>Sr.toString(t))}),this._partialSnapshotInfo.fulfilledQueries=e.sceneGraphQueries,this.setNodeLoadedStatusesAndUpdate(e.sceneGraphQueries),this._observers.forEach(t=>{t.handleSceneGraphReply(this._lastSceneGraphQueryConcurrency,e.sceneGraphQueries)}),this.handleStateChangeInitiated(new Gn(0,En.ROOT_STABLE_PATH()))}_handleSignal(e){if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="invalid-permissions"){console.warn("received 'invalid-permissions' message."),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="client-too-old"){console.warn("received 'client-too-old' message. refreshing!"),location.reload();return}if(e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="snapshot-hash"&&(this._partialSnapshotInfo.snapshotHash=e.signalPayload),e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-sequence-number"&&(this._partialSnapshotInfo.reconnectSequenceNumber=new fe(parseInt(e.signalPayload))),e.signalName!==void 0&&e.signalName=="reconnect-immediately"&&(console.log("received 'reconnect-immediately' signal. reconnecting."),this.attemptReconnect()),e.signalName!==void 0&&e.signalPayload!==void 0&&e.signalName=="reconnect-key"&&(this._reconnectKey=e.signalPayload,console.debug(`server sent reconnect key ${this._reconnectKey}`)),e.signalName!==void 0&&e.signalName=="too-many-connections"){let t=Ul.attemptToParseFrom(e.signalPayload!==void 0?e.signalPayload:"");t!=null&&(this._staticFileRequest=new Kr(t.url).format(1),this._staticFileRequest.get().then(n=>{this._observers.forEach(r=>{r.handleJoinStart(qi.NORMAL,-1,-1)}),this._appState.serialization().decodeSceneForViewerAndPrototypeLib1(n.bytes,this._prototypeLibCppEnabledForPendingFile).then1(r=>{r!=null?(this._scene=r,this.setNodeLoadedStatusesAndUpdate(null),this._observers.forEach(o=>{o.handleJoinEnd()}),this._finishLoadingIfNecessary()):ze("Failed to parse scene")})})),console.warn("too many connections to multiplayer or example file, not reconnecting"),this._shouldReconnect=!1}}_handleNotifyShouldUpgrade(){console.warn("received NOTIFY_SHOULD_UPGRADE message. refreshing!"),location.reload()}_handleClientBroadcast(e){for(let t of e.broadcasts)t.prototypePresenter!=null&&(t.prototypePresenter.nomination!=null?this.updateNominatedPresenter(t.prototypePresenter.nomination,t.sessionID):(this.setPresenterSessionID(new fe(t.prototypePresenter.sessionID)),this._presenterSessionID!=null&&(this._sessionsNominatingCurrentUser.clear(),this._sessionNominatedByCurrentUser=null)));this._observers.forEach(t=>{t.handlePresenterChange()})}updateNominatedPresenter(e,t){e.isCancelled?(e.sessionID==this._sessionID&&(t==this._sessionID?this._sessionsNominatingCurrentUser.clear():this._sessionsNominatingCurrentUser.delete(t)),this._sessionNominatedByCurrentUser!=null&&this._sessionNominatedByCurrentUser.value==e.sessionID&&(this._sessionNominatedByCurrentUser=null)):(e.sessionID==this._sessionID&&this._sessionsNominatingCurrentUser.add(t),t==this._sessionID&&(this._sessionNominatedByCurrentUser=new fe(e.sessionID)))}disconnect(){if(this._isJoined=!1,this._socket!=null){try{this._socket.close()}catch{}this._socket=null}this._lastSceneGraphQueryConcurrency=0,clearTimeout(this._heartbeatTimeout),clearTimeout(this._reconnectionTimeout),this._isConnected&&(console.debug(`disconnected from ${this._url}`),this._isConnected=!1,this._observers.forEach(e=>{e.handleDisconnect()}))}_enableHeartbeatTimer(){if(2==0)return;let e=null,t=()=>{if(this._isWindowActive()){console.debug("sending heartbeat message");let n={};n.type="USER_CHANGES",n.userChanges=[],this._sendMessage(n)}e()};e=()=>{this._heartbeatTimeout=setTimeout(t,Fo.HEARTBEAT_DELAY)},e()}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){e.property==94&&Z.asString(e.newVal)=="CREATED"&&this._partialSnapshotInfo.fulfilledQueries!=null&&this._partialSnapshotInfo.fulfilledQueries.some(t=>Sr.fullyLoadsNode(t,e.node))&&e.node.setHasBeenLoaded(!0)}handleStateUpdate(e,t){this.pushAllInstanceStateChanges()}handleStateChangeAborted(e){e!=null&&(this.handleStateUpdate(e,"ABORTED"),this.handlePresentedStateChange(null,e.oldStateAndOverlays,null))}handleStateChangeCommitted(e,t){this.handleStateUpdate(e,"COMMITTED")}handleStateChangeInitiated(e){if(e==null||e.oldStateAndOverlays.stateId==null&&e.newStateAndOverlays.stateId==null)return;this.handleStateUpdate(e,"INITIATED");let t=this._getSynchronizableHotspotId_instanceHACK(e.interactionAddress.hotspotStablePath);this.handlePresentedStateChange(t,e.newStateAndOverlays,e.interactionAddress.interactionId)}handleStateChangeRequested(e){}_pushInstanceStateChange(e,t,n){let r=pt.encodeInstanceStateChange(t,n);r.hotspotStablePath==null&&(r.hotspotStablePath=pt.encodeGUIDPath(e)),this._getOrCreateNextUserChange().instanceStateChanges==null&&(this._getOrCreateNextUserChange().instanceStateChanges=[]),this._getOrCreateNextUserChange().instanceStateChanges.push(r)}handleHsmAborted(e,t){this._pushInstanceStateChange(e,t,"ABORTED")}handleHsmCommitted(e,t,n){this._pushInstanceStateChange(e,t,"COMMITTED")}handleHsmInitiated(e,t){this._pushInstanceStateChange(e,t,"INITIATED")}handleHsmRequested(e,t){}pushAllInstanceStateChanges(){let e=this._appState.prototypeState();e.getOnscreenStates().forEach(t=>{let n=e.getStateMachineLastChangeInHistory(t.a);this._pushInstanceStateChange(t.a,n,"INITIATED"),this._pushInstanceStateChange(t.a,n,"COMMITTED")})}onTransitionFrame(e){this._getOrCreateNextUserChange()}_getSynchronizableHotspotId_instanceHACK(e){var o,i;let t,n;return(i=(o=this._appState.scene())==null?void 0:o.findNode3(e))==null?void 0:i.id()}_createTriggeredOverlaysDataForMultiplayer(e,t){let n=[];return t.overlays.forEach(r=>{let o=this._getSynchronizableHotspotId_instanceHACK(r.openingHotspotStablePath);n.push(pt.encodeOverlayData(r,o))}),n}_updateNextUserChangeForOverlay(e,t){this.observedUser()==null&&(this._getOrCreateNextUserChange().triggeredOverlaysData=this._createTriggeredOverlaysDataForMultiplayer(e,t))}handlePresentedStateChange(e,t,n){let r=this._previousTlfID,o=this._appState.baseScreenId();R.equals(r,o)||(this._previousTlfID=o,this._getOrCreateNextUserChange().selection=[],o!=null&&this._getOrCreateNextUserChange().selection.push(R.toFigGUID(o))),e!=null&&(this._getOrCreateNextUserChange().lastTriggeredHotspot=pt.encodeGUID(e)),n!=null&&(this._getOrCreateNextUserChange().lastTriggeredPrototypeInteractionID=pt.encodeGUID(n)),this._updateNextUserChangeForOverlay(e,t)}handleFitModeChange(e,t){}handleRestartPrototype(){}_getOrCreateNextUserChange(){return this._cachedNextUserChange==null&&(this._cachedNextUserChange={},this._cachedNextUserChange.sessionID=this._sessionID,this._cachedNextUserChange.instanceStateChanges=null),this._cachedNextUserChange}getParticles(){var t;let e;return(t=this.observedUser())==null?void 0:t.remainingParticles()}getMouse(){var t;let e;return(t=this.observedUser())==null?void 0:t.canvasSpaceMouse}getScrollPositions(){var t;let e;return(t=this.observedUser())==null?void 0:t.scrollPositions}setCanvasSpaceMouse(e){let t=this._previousCanvasSpaceMouseLocation;if(e==null&&t==null||e!=null&&t!=null&&e.equals(t))return;this._previousCanvasSpaceMouseLocation=e==null?void 0:e.clone();let n={};e!=null?(n.x=e.x(),n.y=e.y()):(n.x=Pe.Math_NAN(),n.y=Pe.Math_NAN());let r={};r.canvasSpaceLocation=n,r.cursor="DEFAULT",this._getOrCreateNextUserChange().mouse=r}recordCanvasSpaceClick(e){for(;this._canvasSpaceClicks.length>10;)ie.List_removeFirst(this._canvasSpaceClicks);let t={};t.x=e.x(),t.y=e.y();let n={};n.id=this._nextCanvasSpaceClickID=this._nextCanvasSpaceClickID+1,n.point=t,this._canvasSpaceClicks.push(n),this._getOrCreateNextUserChange().recentClicks=this._canvasSpaceClicks.slice()}setScrollPosition(e,t){for(ie.List_removeIf(this._recentlyChangedScrollPositions,n=>n.nodeId==e);this._recentlyChangedScrollPositions.length>this.maxScrollPositionsToStore;)ie.List_removeFirst(this._recentlyChangedScrollPositions);this._recentlyChangedScrollPositions.push(new Md(e,t)),this._getOrCreateNextUserChange().scrollPositions=this._recentlyChangedScrollPositions.map(n=>{let r={};return r.node=pt.encodeGUID(R.fromString(n.nodeId)),r.scrollOffset=pt.encodeVector2(n.offset),r})}maybeFlushNextUserChange(e){let t=We.seconds();(this._lastFlush==-1||t-this._lastFlush>Fo.FLUSH_INTERVAL_SEC||e==1)&&(this._flushNextUserChange(),this._lastFlush=t)}_flushNextUserChange(){if(this._isJoined&&this._cachedNextUserChange!=null){let e={};e.type="USER_CHANGES",e.userChanges=[this._cachedNextUserChange],Fo.debugUserChanges&&console.log("flushNextUserChange",this._cachedNextUserChange),this._sendMessage(e),this._cachedNextUserChange=null}}_queriesAreEqual(e,t){let n=new Map;for(let o of e)n.set(Sr.hash(o),!0);let r=new Map;for(let o of t)r.set(Sr.hash(o),!0);if(n.size!=r.size)return!1;for(let o of Array.from(n.keys()))if(!r.has(o))return!1;return!0}setSceneGraphQueries(e){this._queriesAreEqual(e,this.currentSceneGraphQueries())||(this._isJoined?this._sendSceneGraphQueries(e,ja.DO_NOT_SKIP):this._pendingSceneGraphQueriesOrNull=e)}_sendSceneGraphQueries(e,t){if(this._lastSceneGraphQueryConcurrency==0&&(this._lastSceneGraphQueryTime=We.milliseconds()),this._lastSceneGraphQueryConcurrency=this._lastSceneGraphQueryConcurrency+1,e.length>0&&(this._lastSentSceneGraphQueriesOrNull=e,t==ja.DO_NOT_SKIP)){let n={};n.type="SCENE_GRAPH_QUERY",n.sceneGraphQueries=e,Rn.increment("[IFL] sceneGraphQueriesSent",1),this._emitter.trigger("incrementalLoadingInfo",{type:"sendSceneGraphQuery",queries:n.sceneGraphQueries.map(r=>Sr.toString(r))}),this._sendMessage(n)}}_sendSignal(e,t){let n={};n.type="SIGNAL",n.signalName=e,n.signalPayload=t,this._sendMessage(n)}nominatePresenter(e){let t=this.presenterClientBroadcastMessageWithNomination(e,!1);this._sendClientBroadcast(t)}cancelPresenterNomination(e){let t=this.presenterClientBroadcastMessageWithNomination(e,!0);this._sendClientBroadcast(t)}presenterClientBroadcastMessageWithNomination(e,t){let n={};n.type="CLIENT_BROADCAST";let r={};r.sessionID=this._sessionID;let o={},i={};return this._presenterSessionID!=null&&(o.sessionID=this._presenterSessionID.value),i.sessionID=e,i.isCancelled=t,o.nomination=i,r.prototypePresenter=o,n.broadcasts=[r],n}startPresenting(){let e=this.presenterClientBroadcastMessage(!0);this._sendClientBroadcast(e)}stopPresenting(){let e=this.presenterClientBroadcastMessage(!1);this._sendClientBroadcast(e)}presenterClientBroadcastMessage(e){let t={};t.type="CLIENT_BROADCAST";let n={},r={};return e&&(r.sessionID=this._sessionID),n.prototypePresenter=r,t.broadcasts=[n],t}_sendClientBroadcast(e){this._socket!=null&&this._sendMessage(e)}_sendMessage(e){Q.getFeatureFlags().logAllWebsocket&&console.log(e),this._socket.send2(ii.deflateRaw(Se.schema.encodeMessage(e)))}},Lr=Fo;Lr.debugUserChanges=!1,Lr.VERBOSE=!1,Lr.SCHEMA_PREFIX="fig-wire\0\0\0",Lr.SCHEMA_PREFIX_BYTES=new Uint8Array([102,105,103,45,119,105,114,101,1,0,0,0]),Lr.RECONNECTION_DELAY_MIN=1,Lr.RECONNECTION_DELAY_MAX=128,Lr.FLUSH_INTERVAL_SEC=1/30,Lr.HEARTBEAT_DELAY=60*1e3;var qi=(t=>(t[t.NORMAL=0]="NORMAL",t[t.SKIP_RELOAD=1]="SKIP_RELOAD",t))(qi||{}),ja=(t=>(t[t.SKIP=0]="SKIP",t[t.DO_NOT_SKIP=1]="DO_NOT_SKIP",t))(ja||{}),xd=class{constructor(e,t,n){this.snapshotHash=null,this.reconnectSequenceNumber=null,this.fulfilledQueries=null,this.snapshotHash=e,this.reconnectSequenceNumber=t,this.fulfilledQueries=n}isValid(){return(this.snapshotHash!=null||this.reconnectSequenceNumber!=null)&&this.fulfilledQueries!=null}},Xo=(t=>(t[t.INITIAL=0]="INITIAL",t[t.RECONNECT=1]="RECONNECT",t))(Xo||{});var Qn;(t=>{function g(n,r){let o={};return o.startingNode=R.toFigGUID(n),o.depth=r,o}t.create=g;function e(n){if(n==null)return"";let r="";for(let o of n)r+=Sr.serializeForMultiplayerURL(o),r+=",";return r.slice(0,r.length-1)}t.serializeListForMultiplayerURL=e})(Qn||(Qn={}));var _a;(t=>{function g(n){return`${n.sessionID}:${n.localID}`}t.toString=g;function e(n,r){return n.sessionID==r.sessionID&&n.localID==r.localID}t.equals=e})(_a||(_a={}));var Ms;(e=>{function g(t){return t.guid!==void 0?"VariableID:"+_a.toString(t.guid):t.assetRef!==void 0&&t.assetRef.key!=null&&t.assetRef.version!=null?"VariableID:"+Bn.string_toString(t.assetRef.key)+"/"+Bn.string_toString(t.assetRef.version):""}e.toString=g})(Ms||(Ms={}));var Sr;(i=>{function g(a){let s=a.depth!==void 0?a.depth:-1;return`${n(a)}-${s}`}i.hash=g;function e(a,s){return g(a)==g(s)}i.equals=e;function t(a){return g(a)}i.toString=t;function n(a){let s=a.startingNode!==void 0?a.startingNode:null;return s!=null?`${s.sessionID}:${s.localID}`:"-1:-1"}i.nodeIdString=n;function r(a){let s=a.startingNode!==void 0?a.startingNode:null,c=s!=null?`${s.sessionID}:${s.localID}`:"-1:-1",l=a.depth!==void 0?a.depth:-1;return`${c}-${l}`}i.serializeForMultiplayerURL=r;function o(a,s){if((a.depth!==void 0?a.depth:-1)!=0)return!1;let l=a.startingNode!==void 0?a.startingNode:null;for(;s!=null;){if(_a.equals(R.toFigGUID(s.id()),l))return!0;s=s.parent()}return!1}i.fullyLoadsNode=o})(Sr||(Sr={}));var Jh;(e=>{function g(t){return Gl[t]}e.FlushThrottling_toString=g})(Jh||(Jh={}));var Zh;(e=>{function g(t){return qi[t]}e.JoinKind_toString=g})(Zh||(Zh={}));var Qh;(e=>{function g(t){return ja[t]}e.ShouldSkipSendQueryMessage_toString=g})(Qh||(Qh={}));var $h;(e=>{function g(t){return Xo[t]}e.ConnectType_toString=g})($h||($h={}));var Ld=class{age(){return Pe.Math_clamp1((We.seconds()-this.startTimestamp)/Ld.LIFETIME,0,1)}constructor(e,t,n){this.sessionID=e,this.canvasSpaceLocation=t,this.startTimestamp=n}},fa=Ld;fa.LIFETIME=.25,fa.RADIUS=25;var Md=class{constructor(e,t){this.nodeId=e,this.offset=t}},em=class{remainingParticles(){let e,t=We.seconds(),n=null;return(e=this.particles)!=null&&ie.List_removeIf(e,r=>t-r.startTimestamp>fa.LIFETIME?!0:(n==null&&(n=[]),n.push(r),!1)),n}toJSON(){return{sessionID:this.sessionID,userID:this.userID,name:this.name,color:this.color!=E.TRANSPARENT?E.toCSS(this.color):null,imageURL:this.imageURL,deviceName:this.deviceName,currentFrame:this.currentFrame!=null?R.toString(this.currentFrame):null}}constructor(e){this.sessionID=e,this.userID=null,this.name=null,this.color=E.TRANSPARENT,this.imageURL=null,this.deviceName=null,this.currentFrame=null,this.canvasSpaceMouse=null,this.largestClickID=-1,this.particles=null,this.scrollPositions=new Map,this.observedSessions=[],this.lastTriggeredHotspot=null,this.lastTriggeredPrototypeInteractionID=null,this.triggeredOverlaysData=[],this.instanceStateChanges=[]}},Hl=class{userBySessionID(){return this._userBySessionID}handleUserChanges(e,t){if(e.userChanges===void 0){console.error("decoded node change message with missing required field: 'userChanges'");return}let n=!1,r=0;for(let o of e.userChanges){if(o.sessionID===void 0){ze("skipping user change message without sessionID");continue}r=o.sessionID;let i=Lr.debugUserChanges&&t!=null&&r!=t.sessionID();o.connected!==void 0&&(o.connected?(this._userBySessionID.set(r,new em(r)),i&&console.log(`user sessionID ${r} connected`,this._userBySessionID.get(r).toJSON()),t!=null&&t.pushAllInstanceStateChanges()):(i&&this._userBySessionID.has(r)&&console.log(`user sessionID ${r} disconnected`,this._userBySessionID.get(r).toJSON()),t!=null&&t.removeNominator(r),this._userBySessionID.delete(r)),n=!0);let a=Ht.IntMap_get(this._userBySessionID,r,null);a!=null?(n=this._applyChangeToUser(o,a,i)||n,this._applyNullChecksToUserStrings(a)):i&&ze("could not find existing user to apply user change message"),i&&console.log("recvUserChange",o,n)}n&&this.onChange!=null&&this.onChange(r)}_applyNullChecksToUserStrings(e){e.userID==null&&(e.userID=""),e.name==null&&(e.name=""),e.imageURL==null&&(e.imageURL="")}_applyChangeToUser(e,t,n){let r=!1,o=e.sessionID;if(e.color!==void 0&&(t.color=pt.decodeColor(e.color),r=!0),e.name!==void 0&&(t.name=e.name,r=!0),e.deviceName!==void 0&&(t.deviceName=e.deviceName,r=!0),e.imageURL!==void 0&&(t.imageURL=e.imageURL,r=!0),e.userID!==void 0&&(t.userID=e.userID,r=!0),e.observing!==void 0&&(t.observedSessions=e.observing,r=!0),e.selection!==void 0){let i=e.selection;t.currentFrame=i.length==1?pt.decodeGUID(i[0]):null,r=!0}if(e.mouse!==void 0){let i=e.mouse;if(i.canvasSpaceLocation!==void 0){let a=pt.decodeVector(i.canvasSpaceLocation);(t.canvasSpaceMouse==null||!t.canvasSpaceMouse.equals(a))&&(t.canvasSpaceMouse=a.equals(a)?a:null,this.onMouseCursorChange!=null&&this.onMouseCursorChange(o))}}if(e.recentClicks!==void 0)if(t.particles==null){t.particles=[];for(let i of e.recentClicks)i.id>t.largestClickID&&(t.largestClickID=i.id)}else for(let i of e.recentClicks)i.id>t.largestClickID&&(t.largestClickID=i.id,t.particles.push(new fa(o,pt.decodeVector(i.point),We.seconds())),this.onMouseCursorChange!=null&&this.onMouseCursorChange(o));if(e.scrollPositions!==void 0)for(let i of e.scrollPositions)t.scrollPositions.set(R.toString(pt.decodeGUID_instanceHACK(i.node)),pt.decodeVector(i.scrollOffset));return e.lastTriggeredHotspot!==void 0&&(t.lastTriggeredHotspot=pt.decodeGUID_instanceHACK(e.lastTriggeredHotspot),r=!0),e.lastTriggeredPrototypeInteractionID!==void 0&&(t.lastTriggeredPrototypeInteractionID=pt.decodeGUID(e.lastTriggeredPrototypeInteractionID),r=!0),e.triggeredOverlaysData!==void 0&&(t.triggeredOverlaysData=e.triggeredOverlaysData.slice(),r=!0),e.instanceStateChanges!==void 0&&(e.instanceStateChanges.forEach(i=>{t.instanceStateChanges.push(i)}),r=!0),n&&console.log("_applyChangeToUser",e,t.toJSON()),r}constructor(){this._sessionID=-1,this._userBySessionID=new Map,this.onChange=null,this.onMouseCursorChange=null}};var Sa;(i=>{function g(){let a=null;try{a=localStorage}catch{return 1}let s=+a.getItem("cursorScaleFactor");return s||1}i._globalCursorScaleFactor=g;function e(a,s,c,l,u,d){let h=B.new2(),S=B.new2(),f=c.clone(),y=1/s;if(Q.isInlinePreview()&&f.expand1(3),S.copyFrom(l),S.expand1(y),S.left()<f.left()&&a.fillRect(h.setTo1(S.left(),S.top(),f.left()-S.left(),S.height()),u),f.right()<S.right()&&a.fillRect(h.setTo1(f.right(),S.top(),S.right()-f.right(),S.height()),u),S.top()<f.top()&&a.fillRect(h.setTo1(f.left()-y,S.top(),f.width()+2*y,f.top()-S.top()),u),f.bottom()<S.bottom()&&a.fillRect(h.setTo1(f.left()-y,f.bottom(),f.width()+2*y,S.bottom()-f.bottom()),u),d>0){f.expand1(y);let v=d*Math.cos(Pe.Math_PI()/4);a.fillConvexPolygon([f.topLeft(),f.topLeft().add1(new I(v,0)),f.topLeft().add1(new I(0,v))],u),a.fillConvexPolygon([f.topRight(),f.topRight().add1(new I(0,v)),f.topRight().add1(new I(-v,0))],u),a.fillConvexPolygon([f.bottomRight(),f.bottomRight().add1(new I(-v,0)),f.bottomRight().add1(new I(0,-v))],u),a.fillConvexPolygon([f.bottomLeft(),f.bottomLeft().add1(new I(0,-v)),f.bottomLeft().add1(new I(v,0))],u)}}i.drawPreviewStencil=e;function t(a,s,c,l){for(let u of s){let d=I.new3(u.canvasSpaceLocation);if(!l.contains2(d))continue;let h=[],S=u.age(),f=S*fa.RADIUS,y=Math.max(8,(f|0)*2);for(let v=0;v<y;v=v+1){let b=Pe.Math_PI()*2*v/y;h.push(new I(d.x()+Math.cos(b)*f*c,d.y()+Math.sin(b)*f*c))}a.fillConvexPolygon(h,E.new3(.9,.9,.9,.5*(1-S)))}}i.drawParticles=t;function n(a,s,c){let l=s.x(),u=s.y(),d=g()/c,h=[],S=[];for(let m of i.cursorOutlineOuter)h.push(I.new2());for(let m of i.cursorOutlineInner)S.push(I.new2());let f=2,y=.5,v=(f+1)*(f+1)*(f+1)*(f+1),b=y/v;for(let m=-f,p=f+1;m<p;m=m+1)for(let _=-f,T=f+1;_<T;_=_+1){let k=(f+1-Math.abs(m))*(f+1-Math.abs(_))*b;if(!(k<1/255)){for(let j=0,te=i.cursorOutlineOuter.length;j<te;j=j+1){let Y=i.cursorOutlineOuter[j],_e=h[j];_e.setX(l+(Y.x()+m)*d),_e.setY(u+(Y.y()+_+1)*d)}a.fillConvexPolygon(h,E.new3(0,0,0,k))}}for(let m=0,p=i.cursorOutlineOuter.length;m<p;m=m+1){let _=i.cursorOutlineOuter[m],T=h[m];T.setX(l+_.x()*d),T.setY(u+_.y()*d)}a.fillConvexPolygon(h,E.WHITE);for(let m=0,p=i.cursorOutlineInner.length;m<p;m=m+1){let _=i.cursorOutlineInner[m],T=S[m];T.setX(l+_.x()*d),T.setY(u+_.y()*d)}a.fillConvexPolygon(S,E.BLACK)}i.drawMouseCursor=n,i.cursorOutlineOuter=[new I(14.933,9.027),new I(7.755,10.975),new I(3.57,17.299),new I(0,0)],i.cursorOutlineInner=[new I(12.416,8.674),new I(7.13,10.109),new I(4.063,14.742),new I(1.442,2.04)]})(Sa||(Sa={}));var bi;(c=>{function g(){let l=Qr.HTMLCanvasElement_getContextWebGL1(Br.HTMLDocument_createElementCanvas(document));if(l==null)return!1;let u=l.canvas;document.body.appendChild(u);let d=l.createProgram(),h=l.createShader(l.VERTEX_SHADER);l.shaderSource(h,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),l.compileShader(h),l.attachShader(d,h);let S=l.createShader(l.FRAGMENT_SHADER);l.shaderSource(S,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0., 0., 0., 1.);
        }
      `),l.compileShader(S),l.attachShader(d,S),l.bindAttribLocation(d,0,"pos"),l.linkProgram(d);let f=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,f);let y=new Float32Array([0,0,1,0,0,1,1,1]);l.bufferData(l.ARRAY_BUFFER,y.length*4,l.DYNAMIC_DRAW),l.bufferSubData(l.ARRAY_BUFFER,0,y),l.enableVertexAttribArray(0),l.vertexAttribPointer(0,2,l.FLOAT,!1,8,0),l.canvas.width=10,l.canvas.height=1;let v=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,v);let b=l.createTexture();l.bindTexture(l.TEXTURE_2D,b),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.bindTexture(l.TEXTURE_2D,b),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.canvas.width,l.canvas.height,0,l.RGBA,l.UNSIGNED_BYTE,null),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,b,0),l.useProgram(d),l.bindFramebuffer(l.FRAMEBUFFER,v),l.viewport(0,0,l.canvas.width/2|0,l.canvas.height),l.drawArrays(l.TRIANGLE_STRIP,0,4),l.bindFramebuffer(l.FRAMEBUFFER,null),l.viewport(0,0,l.canvas.width/2|0,l.canvas.height),l.drawArrays(l.TRIANGLE_STRIP,0,4);let m=new Uint8Array(4);return l.readPixels((l.canvas.width/2|0)+2,0,1,1,l.RGBA,l.UNSIGNED_BYTE,m),document.body.removeChild(u),m[3]!=0}c._featureDetectViewportBug=g;function e(){let l=Qr.HTMLCanvasElement_getContextWebGL1(Br.HTMLDocument_createElementCanvas(document));if(l==null)return!1;let u=l.canvas;document.body.appendChild(u),l.canvas.width=1,l.canvas.height=1;let d=l.createTexture();l.bindTexture(l.TEXTURE_2D,d),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.bindTexture(l.TEXTURE_2D,d),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.canvas.width,l.canvas.height,0,l.RGBA,l.UNSIGNED_BYTE,null),l.bindTexture(l.TEXTURE_2D,d);let h=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,h),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,d,0);let S=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,S),l.bufferData(l.ARRAY_BUFFER,32,l.DYNAMIC_DRAW),l.bufferSubData(l.ARRAY_BUFFER,0,new Float32Array([1,1,1,-1,-1,1,-1,-1])),l.vertexAttribPointer(0,2,l.FLOAT,!1,8,0),l.enableVertexAttribArray(0),l.bindBuffer(l.ARRAY_BUFFER,S);let f=l.createProgram(),y=l.createShader(l.VERTEX_SHADER);l.shaderSource(y,`
        precision highp float;
        attribute vec2 pos;
        varying vec2 uv;
        void main(){
          uv = (pos + vec2(1.0)) / 2.0;
          gl_Position=vec4(pos*2.-1.,0.,1.);
        }
      `),l.compileShader(y),l.attachShader(f,y);let v=l.createShader(l.FRAGMENT_SHADER);l.shaderSource(v,`
        precision highp float;
        uniform sampler2D texture;
        varying vec2 uv;
        void main(){
          gl_FragColor=texture2D(texture, uv);
        }
      `),l.compileShader(v),l.attachShader(f,v),l.linkProgram(f);let b=l.createProgram(),m=l.createShader(l.VERTEX_SHADER);l.shaderSource(m,`
        precision highp float;
        attribute vec2 pos;
        void main(){
          gl_Position=vec4(pos,0.,1.);
        }
      `),l.compileShader(m),l.attachShader(b,m);let p=l.createShader(l.FRAGMENT_SHADER);l.shaderSource(p,`
        precision highp float;
        void main(){
          gl_FragColor=vec4(0.,0.,1.,1.);
        }
      `),l.compileShader(p),l.attachShader(b,p),l.bindAttribLocation(b,0,"pos"),l.linkProgram(b),l.clearColor(1,0,0,1),l.bindFramebuffer(l.FRAMEBUFFER,h),l.useProgram(b),l.drawArrays(l.TRIANGLE_STRIP,0,4),l.bindFramebuffer(l.FRAMEBUFFER,null),l.useProgram(f),l.drawArrays(l.TRIANGLE_STRIP,0,4),l.bindFramebuffer(l.FRAMEBUFFER,h),l.clear(l.COLOR_BUFFER_BIT),l.bindFramebuffer(l.FRAMEBUFFER,null),l.useProgram(f),l.drawArrays(l.TRIANGLE_STRIP,0,4);let _=new Uint8Array(4);return l.readPixels(0,0,1,1,l.RGBA,l.UNSIGNED_BYTE,_),document.body.removeChild(u),_[0]!=255}c._featureDetectDrawClearReorderingBug=e;function t(){return c._hasViewportBug==null?(ze("Called hasViewportBug before running feature detection"),!1):c._hasViewportBug.value}c.hasViewportBug=t;function n(){return c._hasDrawClearReorderingBug==null?(ze("Called hasDrawClearReorderingBug before running feature detection"),!1):c._hasDrawClearReorderingBug.value}c.hasDrawClearReorderingBug=n;function r(){return c._hasUnexpectedCompositingBug==null?(ze("Called hasDrawClearReorderingBug before running feature detection"),!1):c._hasUnexpectedCompositingBug.value}c.hasUnexpectedCompositingBug=r;function o(){c._hasViewportBug=new fe(g()),t()&&console.warn("GPUBugs: device has buggy implementation of gl.viewport. Will apply workarounds."),c._hasDrawClearReorderingBug=new fe(e()),n()&&console.warn("GPUBugs: Device may re-order draw/clear commands. Will apply workarounds.");let l=navigator.userAgent,u=(l.indexOf("iPhone OS 14_0")|0)!=-1,d=(l.indexOf("iPhone OS 14_1")|0)!=-1,h=u||d,S=(l.indexOf("iPad; CPU OS 14_0")|0)!=-1,f=(l.indexOf("iPad; CPU OS 14_1")|0)!=-1,y=S||f,b=(l.indexOf("Version/14")|0)!=-1&&(l.indexOf("Safari")|0)!=-1&&(navigator.maxTouchPoints|0)>0;c._hasUnexpectedCompositingBug=new fe(h||y||b)}c.detect=o,c._hasViewportBug=null,c._hasDrawClearReorderingBug=null,c._hasUnexpectedCompositingBug=null})(bi||(bi={}));var zl=class{constructor(e,t,n,r){this._delayFrames=0,this._onChange=null,this._equals=null,this._nextUpdateAfterFrameCount=-1,this._value=null,this._queuedValue=null,this._delayFrames=t,this._equals=n,this._onChange=r,e(this)}onFrame(){this._nextUpdateAfterFrameCount>0&&(this._nextUpdateAfterFrameCount=this._nextUpdateAfterFrameCount-1,this._nextUpdateAfterFrameCount<=0&&(this._value=this._queuedValue,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1,this._onChange()))}_updateQueuedValue(e){this._queuedValue=new fe(e),this._nextUpdateAfterFrameCount=this._delayFrames}hasQueuedValue(){return this._queuedValue!=null}queueValue(e){if(this._value==null){this._value=new fe(e),this._onChange();return}if(this._queuedValue!=null){if(this._equals(this._queuedValue.value,e))return;this._updateQueuedValue(e);return}else this._equals(this._value.value,e)||this._updateQueuedValue(e)}getValue(){return this._value.value}clear(){this._value=null,this._queuedValue=null,this._nextUpdateAfterFrameCount=-1}unregister(e){e(this)}};var Ct;(b=>{function g(m){return`SCROLL_OFFSET::${m}`}b.forScrollOffset=g;function e(m){return`OVERLAY_POSITION::${m}`}b.forOverlayPosition=e;function t(m){return`ANIMATEABLE_TRANSLATION::${m}`}b.forAnimateableTranslation=t;function n(m){return`SHADOW_TRANSFORMATION::${m}`}b.forShadowTransformation=n;function r(m){return`ANIMATEABLE_OPACITY::${m}`}b.forAnimateableOpacity=r;function o(m){return`ANIMATEABLE_DISSOLVE::${m}`}b.forAnimateableDissolve=o;function i(m){return`DYNAMIC_GEOMETRY::${m}`}b.forDynamicGeometry=i;function a(m){return m.id.startsWith("SCROLL_OFFSET")}b.isScrollingTransform=a,b.ENTERING_TLF="ENTERING_TLF",b.EXITING_TLF="EXITING_TLF",b.ENTERING_OVERLAY="ENTERING_OVERLAY",b.EXITING_OVERLAY="EXITING_OVERLAY",b.ENTERING_OVERLAY_BACKGROUND="ENTERING_OVERLAY_BACKGROUND",b.EXITING_OVERLAY_BACKGROUND="EXITING_OVERLAY_BACKGROUND",b.OVERLAY_BACKGROUND="OVERLAY_BACKGROUND",b.SMART_ANIMATE_OVERLAY_TRANSLATION="SMART_ANIMATE_OVERLAY_TRANSLATION",b.OVERLAY_BACKGROUND_DISSOLVE="OVERLAY_BACKGROUND_DISSOLVE",b.DISSOLVE_TRANSITION="DISSOLVE_TRANSITION"})(Ct||(Ct={}));var no=class{toggleRenderTreePrinting(){this._printRenderTree=!this._printRenderTree,this._printRenderTree&&this._activeRenderTree!=null&&console.log(this._activeRenderTree.debugString1())}_currentBaseScreenId(){var t;let e;return(t=this._appState.prototypeState().getCurrentBaseScreenNode())==null?void 0:t.id()}_currentOverlayData(){return this._appState.prototypeState().getCurrentOverlayData()}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}setBackgroundEnabled(e){}constructor(e,t,n){this._context=null,this._bufferPool=null,this._compositeTileCache=null,this._compositor=null,this._renderer=null,this._viewport=null,this._dirtinessTracker=null,this._appState=null,this._hotspotRenderer=null,this._smoothPath=null,this._deviceRenderer=null,this._prerenderViewport=new $r,this._devicePixelRatio=0,this._needsBlit=!0,this._isAnimatedMediaPlaying=!1,this._printRenderTree=!1,this._activeRenderTree=null,this._overlayBaseScreenId=null,this._generatedOverlays=new Map,this._debouncedDevicePixelsPerCanvasPixel=null,this._didRasterizeContentOnLastDraw=!0,this._observers=new lr,this._blittingDueToScroll=!1,this._requestImageOnScreen=null,this._requestImageForPrerendering=null,this.PORTION_TO_LOG=50/100,this.MAX_TRANSITION_LOGS=50,this._numTransitionsLogged=0,this._transitionStats=new Map,this._transitionWasInterruptedByVisibilityChange=!1,this._visibilityListener=null,this.HEADERS=["frame_count","transition_count","mean_frame_ms","median_transition_mean","median_transition_max","count_0_to_20ms","count_20_to_40ms","count_40_to_80ms","count_80_to_160ms","count_160_to_320ms","count_320_to_640ms","count_640_ms_or_higher"],this._ongoingTransition=null,this._drewFirstFrameOfTransition=!0,this._transitionProgressTracker=new vn,this._hsmTransitionMap=new Map,this._renderTreeForMagicMoveBaseScreen=null,this._renderTreeForMagicMoveOverlay=null,this._context=this._createContext(),this._bufferPool=new C.BufferPool(this._context),this._compositeTileCache=new Ed(this._context,this._bufferPool),this._renderer=new Ro(this._context,this._bufferPool),this._compositor=new Wi(this._context,this._compositeTileCache,this._renderer),this._viewport=e,this._appState=t,this._appState.addAppObserver(this),this._renderer.context().addContextResetHandler(()=>{this._deviceRenderer.clearOnContextReset(),this._viewport.invalidate(),(tt.OS_isMobile(tt.OS_current())||tt.OS_current()==4&&navigator.maxTouchPoints>0||At.forceMobileOptimizations())&&n.clearQueuesAndDecodedDataForAllImages(this._canvas())}),n.onImageLoaded=o=>{o.invalidateRenderTreeForSelfAndParents(),this._dirtinessTracker.handleImageLoaded(o),this._viewport.invalidate()};let r=o=>{this._onBoundsInvalidate(o)};this._dirtinessTracker=new Rl(r),this._smoothPath=new C.SmoothPath(this._context,this._bufferPool),this._deviceRenderer=new bd(this._context,this._bufferPool),this._hotspotRenderer=new Td(this._context,this._bufferPool),this._debouncedDevicePixelsPerCanvasPixel=new zl(o=>{t.addFrameObserver(o)},2,(o,i)=>o==i,()=>{this.setNeedsBlit(!0)}),this._initMagicMoveRenderTreeCache(),this._requestImageOnScreen=(o,i)=>{let a=cr.forOnScreenPurpose(i);n.requestImageForRendering(o,a)},this._requestImageForPrerendering=(o,i)=>{let a=cr.forPrerenderPurpose(i);n.requestImageForRendering(o,a)},console.debug(`Graphics card: '${this._context.graphicsCardName()}'`),no.PERF_TRACKING&&(this._initTransitionStats(),window.getTransitionStats=o=>this._formatStatsForGoogleSheets(this.getAggregateTransitionStats(),o!=null?o:!1))}_uninitialize(){this._debouncedDevicePixelsPerCanvasPixel.unregister(e=>{this._appState.removeFrameObserver(e)}),this._appState.removeAppObserver(this)}internalInitPerfTracking(){3==0&&(no.PERF_TRACKING=!0,this._initTransitionStats())}isRenderingDone(){return!this._didRasterizeContentOnLastDraw}getContext(){return this._context}graphicsCardName(){return this._context.graphicsCardName()}setNeedsBlit(e){e||(this._blittingDueToScroll=!1),this._needsBlit=e,this._observers.forEach(t=>{t.handleSetNeedsBlit(e)})}checkNeedsBlit(){return this.setNeedsBlit(this._needsBlit||this._viewport.isInvalid()||this.isTopLevelTransitionOngoing()||this._animatedMediaPlaying()||this._hsmTransitionMap.size>0),this._needsBlit||bi.hasUnexpectedCompositingBug()}deviceRenderer(){return this._deviceRenderer}changeFitMode(e){this._viewport.invalidate()}setZoomScale(e){}updateScroll(e){this._blittingDueToScroll=!0,this.setNeedsBlit(!0)}handleSceneChange(e,t){this._debouncedDevicePixelsPerCanvasPixel.clear()}handleActiveCanvasChange(e,t){this._renderer.setCanvas(t),e!=null&&e.scene().removeObserver(this._dirtinessTracker),t!=null&&t.scene().addObserver(this._dirtinessTracker),this._dirtinessTracker.initCanvas(t)}handleActivePrototypeStartingPointChange(e,t){}resize(e,t,n,r){let i=new I(e,t).multiply(r),a=this._context.resize(Math.round(i.x())|0,Math.round(i.y())|0);return this._devicePixelRatio=r,this.setZoomScale(n),this._debouncedDevicePixelsPerCanvasPixel.clear(),new C.ComputedCanvasSize(a.canvasSize.divide(r),a.webGLDidAdjustCanvasSize)}drawBlank(){this._context.annotate("Draw blank",()=>{Q.isInlinePreview()&&this._ongoingTransition!=null&&this._onBeforeFrameForTransition(),this._renderer.context().beginFrame(),C.in_Context.Context_clear1(this._renderer.context(),C.Clear.ALL),this._renderer.context().endFrame()})}_renderTreeToDraw(e){if(this.isTopLevelTransitionOngoing())return this._renderTreeForTransition(e);{let t=this._appState.prototypeState().getCurrentBaseScreenNode(),n=this._appState.prototypeState().bindOverlays(this._currentOverlayData());return this._dirtinessTracker.invalidateDirtyTiles(this._canvas(),new uo(this._canvas(),this._hsmTransitionMap,new Gi(this._generatedOverlays))),this._generatedOverlays=new Map,this._renderTreeForBaseScreenAndOverlays(t,n)}}_renderTreeForBaseScreenAndOverlays(e,t){if(e==null)return null;let n=Ne.renderTreeForBaseScreenWithPerfLogging(e,new uo(e,this._hsmTransitionMap,null),"_renderTreeForBaseScreenAndOverlays");return n==null?null:et.forTransformIsolation(Ue.wrap([this._compositor.prepareForEfficientCompositing(n),this._renderTreeForOverlays(e,t)]).optimized())}_renderTreeForOverlays(e,t){let n=[],r=new Gi;for(let o=0,i=t.length;o<i;o=o+1){let a=Ne.renderTreeForOverlayBackground(t[o].backgroundAppearance(),e.canvasSpaceBoundingBox());a!=null&&n.push(a);let s=this._renderTreeForOverlay1(t[o],e,o,r,null);s!=null&&n.push(s)}return Ue.wrap(n)}_renderTreeForOverlay1(e,t,n,r,o){return this._renderTreeForOverlay2(e,t,n,null,r,o)}_renderTreeForOverlay2(e,t,n,r,o,i){if(t==null)return null;let a=e.node();if(a==null)return null;let s=e.renderedBounds(t),c=a.canvasSpaceBoundingBox(),l=s.center().subtract1(c.center());this._overlayBaseScreenId!=null&&t.id()!=this._overlayBaseScreenId&&(a.invalidateRenderTreeForSelfAndParents(),a.invalidateRenderTreeForChildren()),this._overlayBaseScreenId=t.id();let u=new Jt(t,null),d=new Rs(e.id(),e.node(),s,u,e.backgroundAppearance(),r,()=>l,i);o.addEntry(e.id(),d),this._generatedOverlays.set(e.id(),d);let h=Ne.renderTreeForOverlayWithPerfLogging(a,new uo(a,this._hsmTransitionMap,o),"_renderTreeForOverlay");if(h==null)return null;let S=this._compositor.prepareForEfficientCompositing(h);return S=et.forTranslation(S,Ct.forOverlayPosition(n),()=>l),S}_animatedMediaPlaying(){return this._isAnimatedMediaPlaying}_setAnimatedMediaPlaying(e){this._isAnimatedMediaPlaying=e}draw(e,t,n,r){var i;let o;return this._didRasterizeContentOnLastDraw=!1,this._renderer.context().isContextLost()?1:((i=this._canvas())==null?void 0:i.scene())==null?1:this._currentTlf()==null?1:n.viewSpaceBounds().isEmpty()?1:this._context.annotateAndReturn("draw",()=>{var p;let a,s=this._compositor.beginFrameAndCreateBudget(),c=s.tileCacheCapacityRemaining();this._renderer.context().beginFrame();let l=this._ongoingTransition!=null,u=this.isTopLevelTransitionOngoing();l&&this._onBeforeFrameForTransition(),this._onBeforeFrameForHsm();let d=this._renderTreeToDraw(n);this._activeRenderTree=d,d!=null&&this._setAnimatedMediaPlaying(d.hasAnimatingMedia()),this._debouncedDevicePixelsPerCanvasPixel.queueValue(n.zoomScale()*this._devicePixelRatio);let h=this._debouncedDevicePixelsPerCanvasPixel.hasQueuedValue()&&!(u&&!this._drewFirstFrameOfTransition);this._drewFirstFrameOfTransition=!0;let S=[],f=0,y=B.new2();n.computeCanvasSpaceBounds1(y);let v=this.currentCanvasSpacePreviewBounds(),b=this.currentCanvasSpaceFrameBounds()!=null?this.currentCanvasSpaceFrameBounds().topLeft():new I(0,0);v.intersectWith(y);let m=!1;if(this._context.annotate("On-screen tiles",()=>{if(!h){let _=B.new3(v);_.expandedBy1(v.height()),S=this._compositor.getPrioritizedListOfTilesToPopulate(this._debouncedDevicePixelsPerCanvasPixel.getValue(),v,_,d);let T=Q.respectRenderBudgetOnScroll()&&this._blittingDueToScroll;for(T||s.permitWorkAfterBudgetExceeded();f<S.length;){let N=S[f];if(!N.overlapsViewport())break;if(T&&!s.permitsMoreWork()){m=!0;break}let k=this._compositor.ensureTileIsPopulated(N.node,s,this._requestImageOnScreen);k==0&&(this._didRasterizeContentOnLastDraw=!0),k==0&&no.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame INSIDE of viewport. Capacity left: ${s.tileCacheCapacityRemaining()} / ${c}`),f=f+1}T||s.forbidWorkAfterBudgetExceeded()}}),this._needsBlit){this._printRenderTree&&console.log(d.debugString1());let _=B.new2(),T=0,N=(p=this._canvas())==null?void 0:p.prototypeDevice();N!=null&&N.type=="PRESET"?(_.setTo2(b,N.size()),T=E.BLACK):(_.copyFrom(v),T=r.backgroundColor);let k=Tr.new2().scaledBy(this._devicePixelRatio).multipliedBy(n.canvasSpaceToViewSpace1());k.transformRect(_),_.round();let j=n.viewSpaceBounds(),te=new B(j.left()*this._devicePixelRatio,j.top()*this._devicePixelRatio,j.width()*this._devicePixelRatio,j.height()*this._devicePixelRatio).rounded();this._compositor.drawToScreen(d,k,_,te,T,this._requestImageOnScreen),this._drawUI(n,r),this.setNeedsBlit(!1)}return this._context.annotate("Off-screen tiles",()=>{if(!h){for(;s.permitsMoreWork()&&f<S.length;){let _=this._compositor.ensureTileIsPopulated(S[f].node,s,this._requestImageForPrerendering);_==0&&(this._didRasterizeContentOnLastDraw=!0),_==0&&no.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendered tile for current frame OUTSIDE of viewport. Capacity left: ${s.tileCacheCapacityRemaining()} / ${c}`),f=f+1}if(t){let _=this._appState.prototypeState().bindOverlays(this._currentOverlayData()),T=null,N=this._appState.baseScreenNode().canvasSpaceBoundingBox().topLeft();for(let k of this._appState.prototypeStructure().getPrerenderingJobs(()=>s.permitsMoreWork())){let j=null,te=null,Y=null,_e=null,ce=k.asScreen(),V=k.asSmartAnimate();if(ce!=null){if(ce.role==hn.FrameRole.BASE_SCREEN&&R.equals(ce.nodeId,this._currentBaseScreenId())||(Y=this._canvas().scene().findNode1(ce.nodeId),Y==null||!Y.hasBeenLoaded()))continue;if(!s.permitsMoreWork())break;let P=null;if(ce.role==hn.FrameRole.OVERLAY){let z=In.fromPrototypeAction(ce.prototypeAction,0);P=Os.BoundOverlay_computeNewBounds(Y,this._appState.baseScreenNode(),z,N,Y.overlayPositionType()),N=P.topLeft();let O=new Jt(this._appState.baseScreenNode(),null),G=new Rs(Y.id(),Y,P,O,Y.overlayBackgroundAppearance(),null,()=>Y.canvasSpaceBoundingBox().topLeft().negative().add1(N),null);this._generatedOverlays.set(Y.id(),G),T==null&&(T=new Gi),T.addEntry(Y.id(),G),j==null&&ce.precedingOverlays!=null&&(j=new Gi)}if(ce.role==hn.FrameRole.OVERLAY&&_.some(z=>R.equals(ce.nodeId,z.id())))continue;if(_e=this.canvasSpacePreviewBoundsForTransition(Y,Y),j!=null){let z=!1;for(let O of ce.precedingOverlays){let G=T.get2(O);if(G==null){z=!0;break}j.addEntry(O,G)}if(z)break}let J=new uo(Y,this._hsmTransitionMap,j);te=ce.role==hn.FrameRole.BASE_SCREEN?Ne.renderTreeForBaseScreenWithPerfLogging(Y,J,"_draw"):Ne.renderTreeForOverlayWithPerfLogging(Y,J,"_draw")}else if(V!=null){let P=this._canvas().scene().findNode1(V.srcNodeId),J=this._canvas().scene().findNode1(V.dstNodeId);if(P==null||J==null||!P.hasBeenLoaded()||!J.hasBeenLoaded())continue;_e=this.canvasSpacePreviewBoundsForTransition(P,J);let z=_t.get(V.transitionType);te=this._renderTreeForMagicMove(P,J,z,V.role,V.easingFunction),Y=J}if(te==null)continue;if(!s.permitsMoreWork())break;let H=this._compositor.prepareForEfficientCompositing(te);if(!s.permitsMoreWork())break;this._prerenderViewport.copyFrom(this._viewport),this._prerenderViewport.updateForCurrentPreview(Y.canvasSpaceBoundingBox(),_e,this._appState.currentFitMode(),this._appState.activePrototypeDevice());let M=B.new2();this._prerenderViewport.computeCanvasSpaceBounds1(M),_e.intersectWith(M);let K=this._prerenderViewport.zoomScale()*this._devicePixelRatio,U=this._compositor.getPrioritizedListOfTilesToPopulate(K,_e,_e,H);for(let P of U)if(s.tileCacheCapacityRemaining()==0||this._compositor.ensureTileIsPopulated(P.node,s,this._requestImageForPrerendering)==0&&(this._didRasterizeContentOnLastDraw=!0,no.VERBOSE_LOGS&&console.log(`ProtoRenderManager: Rendering tile for future frame. Capacity left: ${s.tileCacheCapacityRemaining()} / ${c}`),!s.permitsMoreWork()))break}}}}),m&&this.setNeedsBlit(!0),this._context.endFrame(),0})}_canvas(){return this._appState.getActiveCanvas()}_currentTlf(){let e;return(e=this._canvas())!=null?e.scene().findNode1(this._currentBaseScreenId()):null}_drawUI(e,t){this._context.annotate("Draw UI",()=>{if(this._appState.getActiveCanvas()==null)return;let n=this.currentCanvasSpacePreviewBounds(),r=this.currentCanvasSpaceFrameBounds().topLeft(),o=B.new2();e.computeCanvasSpaceBounds1(o);let a=e.zoomScale()*this._devicePixelRatio,s=1/a;if(n==null)return;this._smoothPath.setTransformAndPixelScale(e.canvasSpaceToClipSpace1(),s);let c=this._canvas().prototypeDevice(),l=!Q.getFeatureFlags().removePreviewStencil,u=0;if(c!=null&&c.type=="PRESET"&&(c.presetIdentifier.startsWith("APPLE_IPHONE_14_PRO")||c.presetIdentifier.startsWith("APPLE_IPHONE_14_PLUS"))&&(l=!0,u=25),l)if(c==null||c.type!="PRESET")n.intersectWith(o),Sa.drawPreviewStencil(this._smoothPath,e.zoomScale(),n,o,t.backgroundColor,u);else{let d=B.new2();d.setTo2(r,c.size()),d.expand1(1/e.zoomScale()),n.intersectWith(o),d.intersectWith(o),Sa.drawPreviewStencil(this._smoothPath,e.zoomScale(),d,o,t.backgroundColor,u)}3!=0&&(this._drawDeviceFrameIfNecessary(this._smoothPath,e,this._currentTlf().canvasSpaceBoundingBox(),o),t.particles!=null&&Sa.drawParticles(this._smoothPath,t.particles,1/e.zoomScale(),n),t.mouse!=null&&n.contains2(t.mouse)&&Sa.drawMouseCursor(this._smoothPath,t.mouse,e.zoomScale()),t.hotspots!=null&&this._hotspotRenderer.draw(e.canvasSpaceToClipSpace1(),e.zoomScale(),t.hotspots,t.hotspotOpacity,this._devicePixelRatio),this._smoothPath.flush(),this.deviceRenderer().flush())})}_drawDeviceFrameIfNecessary(e,t,n,r){this._canvas()!=null&&this._context.annotate("Draw device frame",()=>{var i;let o;if(this.deviceRenderer().drawPrototypeDeviceIfAny(t,this._canvas().prototypeDevice(),n,t.canvasSpaceToClipSpace1()),this.deviceRenderer().isWaitingForDeviceFrameToLoad(this._canvas().prototypeDevice())){let a=Wl((i=this._appState.baseScreenNode())==null?void 0:i.id(),this._appState.currentFitMode(),this._canvas());e.fillRect(r,a)}})}_totalVRAM(){let e=0;return e=e+this._bufferPool.totalVRAM(),e=e+this._compositeTileCache.totalVRAM(),e=e+this._renderer.totalVRAM(),e}_onBoundsInvalidate(e){this._viewport.invalidate()}clearTileCaches(){this._compositeTileCache.clear()}_initTransitionStats(){if(this._visibilityListener===null){let e=()=>{this._transitionWasInterruptedByVisibilityChange=!0};$t.EventTarget_addEventListener1(document,"visibilitychange",e)}this._transitionWasInterruptedByVisibilityChange=!1;for(let e of["SA","nonSA"])this._transitionStats.set(e,new Map([["transition_mean",[]],["transition_max",[]],["frame_counts",[]],["count_0_to_20ms",0],["count_20_to_40ms",0],["count_40_to_80ms",0],["count_80_to_160ms",0],["count_160_to_320ms",0],["count_320_to_640ms",0],["count_640_ms_or_higher",0]]))}_maybeLogPerformanceMetricsForTransition(){let e=this._transitionWasInterruptedByVisibilityChange;if(this._transitionWasInterruptedByVisibilityChange=!1,!(e||document.hidden)&&!this._transitionProgressTracker.isProgressControlledExternally()&&this._transitionProgressTracker.duration()>0){let t=Math.random()<this.PORTION_TO_LOG&&this._numTransitionsLogged<this.MAX_TRANSITION_LOGS;if(no.VERBOSE_LOGS||t||no.PERF_TRACKING){let n=this._transitionProgressTracker.frameTimesMs,r=n.length,o=0,i=0,a=0,s=0,c=0,l=0,u=0,d=0,h=0;for(let m of n)d=Math.max(d,m),h+=m,m<20?o=o+1:m<40?i=i+1:m<80?a=a+1:m<160?s=s+1:m<320?c=c+1:m<640?l=l+1:u=u+1;if(d>60*1e3)return;let S=h/r,f=this._ongoingTransition.change,y=f.transitionParameters.transitionType,v=y=="SMART_ANIMATE"||xn.supportsSmartAnimate(y)&&f.transitionParameters.transitionShouldSmartAnimate,b=new Map([["is_smart_animate",v],["mean_frame_ms",S],["max_frame_ms",d],["frame_count",r],["count_0_to_20ms",o],["count_20_to_40ms",i],["count_40_to_80ms",a],["count_80_to_160ms",s],["count_160_to_320ms",c],["count_320_to_640ms",l],["count_640_ms_or_higher",u]]);no.VERBOSE_LOGS&&(console.group("ProtoRenderManager: Transition complete"),console.table(Me.StringMap_toJSObject(b)),console.groupEnd()),t&&(Je.trackEvent1("viewer_transition_frame_times_v2",b),this._numTransitionsLogged=this._numTransitionsLogged+1),no.PERF_TRACKING&&this._aggregateTransitionStats(b)}}}_aggregateTransitionStats(e){let t=e.get("is_smart_animate")?"SA":"nonSA",n=this._transitionStats.get(t);n.get("frame_counts").push(e.get("frame_count")),n.get("transition_mean").push(e.get("mean_frame_ms")),n.get("transition_max").push(e.get("max_frame_ms"));for(let r of["count_0_to_20ms","count_20_to_40ms","count_40_to_80ms","count_80_to_160ms","count_160_to_320ms","count_320_to_640ms","count_640_ms_or_higher"])n.set(r,n.get(r)+e.get(r))}getAggregateTransitionStats(){let e=new Map;for(let t of["SA"]){let n=new Map(this._transitionStats.get(t)),r=0;for(let a=0,s=n.get("transition_mean").length;a<s;a=a+1)r=r+n.get("transition_mean")[a]*n.get("frame_counts")[a];n.set("frame_count",n.get("frame_counts").reduce((a,s,c)=>a+s,0)),n.delete("frame_counts"),n.set("mean_frame_ms",r/n.get("frame_count")|0),n.get("transition_mean").sort(),n.get("transition_max").sort();let o=n.get("transition_mean").length%2===0,i=Math.floor(n.get("transition_mean").length/2);for(let a of["mean","max"]){let s=n.get(`transition_${a}`)[i];o&&(s+=n.get(`transition_${a}`)[i-1],s/=2),n.set(`median_transition_${a}`,s)}return n.set("transition_count",n.get("transition_mean").length),n.set("max_frame_ms",n.get("transition_max")[n.get("transition_max").length-1]),n.delete("transition_mean"),n.delete("transition_max"),n}return Me.StringMap_toJSObject(e)}_formatStatsForGoogleSheets(e,t){let n=`
`;t&&(n+=`=SPLIT("${this.HEADERS.join(",")}", ",")
`);let r=[];for(let o of this.HEADERS)r.push(e.get(o).toString());return n+=`=SPLIT("${r.join(",")}", ",")
`,n}triggerTransition(e,t,n){this._drewFirstFrameOfTransition=!1,this._ongoingTransition=new no.TransitionState(e,t),this._transitionProgressTracker.willStartTransitionWithDuration(e.transitionParameters.transitionDuration),n!=null&&ga.applyTo(n,this._transitionProgressTracker)}handleAbortedTransition(e){var n;let t;e==((n=this._ongoingTransition)==null?void 0:n.change)&&(this._ongoingTransition=null)}handleCommittedTransition(e){var n;let t;e==((n=this._ongoingTransition)==null?void 0:n.change)&&(this._ongoingTransition=null)}triggerHsmTransition(e,t,n){let r=e.toString(),o=new vn;o.willStartTransitionWithDuration(t.transitionParameters.transitionDuration),n!=null&&ga.applyTo(n,o),this._hsmTransitionMap.set(r,new no.InstanceSwapTransition(o,()=>{let i=o.progress();return t.transitionParameters.easingFunction==null||o.isProgressControlledExternally()?i:t.easingFunction().get(i)},t))}abortHsmTransition(e,t){this._hsmTransitionMap.delete(e.toString())}commitHsmTransition(e,t){this._hsmTransitionMap.delete(e.toString())}isTopLevelTransitionOngoing(){return this._ongoingTransition!=null&&this._transitionProgressTracker.isTransitionInProgress()}easedTransitionProgress(){let e=this._ongoingTransition;if(e==null)return 0;let t=this._transitionProgressTracker.progress();return e.change.easingFunction()==null||this._transitionProgressTracker.isProgressControlledExternally()?t:e.change.easingFunction().get(t)}_renderTreeForTransition(e){let t=this._ongoingTransition;return t==null?null:t.cachedRenderTree!=null?t.cachedRenderTree:R.equals(t.change.oldStateId(),t.change.newStateId())?this._renderTreeForOverlayTransition(t):this._renderTreeForBaseScreenTransition(t,e)}_initMagicMoveRenderTreeCache(){let e=i=>Ne.renderTreeWithPerfLogging2(i,new uo(i,this._hsmTransitionMap,null),"_initMagicMoveRenderTreeCache"),t=i=>Ne.renderTreeForBaseScreenWithPerfLogging(i,new uo(i,this._hsmTransitionMap,null),"_initMagicMoveRenderTreeCache"),n=i=>i,r=i=>i,o=(i,a,s,c)=>{let l=null;try{l=_r.renderTreeForMagicMove(i,a,()=>this.easedTransitionProgress(),c,s)}catch(u){l=new Ue([]),La(u)}return no.VERBOSE_LOGS&&(console.log("Smart animate render tree"),console.log("-------------------------"),console.log(l.debugString1())),l};this._renderTreeForMagicMoveBaseScreen=Od(o,t,t,n,r),this._renderTreeForMagicMoveOverlay=Od(o,e,e,n,r)}_renderTreeForMagicMove(e,t,n,r,o){return r==hn.FrameRole.OVERLAY?this._renderTreeForMagicMoveOverlay(e,t,n,o):this._renderTreeForMagicMoveBaseScreen(e,t,n,o)}_preparedRenderTreeForMagicMove(e,t,n,r,o,i){let a=this._renderTreeForMagicMove(n,r,t,o,i);return e.cachedRenderTree=this._compositor.prepareForEfficientCompositing(a),e.cachedRenderTree}_renderTreeForBaseScreenTransition(e,t){let n=e.change,r=e.viewportBeforeTransition.zoomScale()*this._devicePixelRatio,o=this._appState.prototypeState().lastNodeForBaseScreen();if(o==null)return null;let i=t.zoomScale()*this._devicePixelRatio,a=this._appState.prototypeState().nextNodeForBaseScreen();if(a==null)return null;let s=n.oldOverlays(this._appState.prototypeState()),c=n.newOverlays(this._appState.prototypeState()),l=_t.get(n.transitionParameters.transitionType);n.direction==1&&(l=l.reversed());let u=n.transitionParameters.transitionType=="SMART_ANIMATE"||xn.supportsSmartAnimate(n.transitionParameters.transitionType)&&n.transitionParameters.transitionShouldSmartAnimate,d=s.length!=0;if(u){let v=this._preparedRenderTreeForMagicMove(e,l,o,a,hn.FrameRole.BASE_SCREEN,n.easingFunction());if(d){let b=a.size().max2(o.size()),m=ee.new2(),p=this._renderTreeForOverlays(o,s);if(p=et.forOpacity(p,Ct.EXITING_TLF,()=>l.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),p=et.forTransform(p,Ct.EXITING_TLF,()=>m.copyFrom(Nt.FrozenAffineTransform_IDENTITY).translatedBy1(b.multiply1(l.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress()))).translatedBy1(a.canvasSpaceBoundingBox().center()).scaledBy2(r/i).translatedBy1(o.canvasSpaceBoundingBox().center().negative())),n.transitionParameters.transitionType=="SMART_ANIMATE"){let _=Ct.DISSOLVE_TRANSITION;p=new Jn(p,v,_,()=>this.easedTransitionProgress())}return e.cachedRenderTree=Ue.wrap([v,p]).optimized(),e.cachedRenderTree}else return v}let h=a.size().max2(o.size()),S=ee.new2(),f=this._renderTreeForBaseScreenAndOverlays(o,s);f!=null?(f=et.forOpacity(f,Ct.EXITING_TLF,()=>l.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),f=et.forTransform(f,Ct.EXITING_TLF,()=>S.copyFrom(Nt.FrozenAffineTransform_IDENTITY).translatedBy1(h.multiply1(l.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress()))).translatedBy1(a.canvasSpaceBoundingBox().center()).scaledBy2(r/i).translatedBy1(o.canvasSpaceBoundingBox().center().negative()))):f=new Ue([]);let y=this._renderTreeForBaseScreenAndOverlays(a,c);if(y!=null?(y=et.forOpacity(y,Ct.ENTERING_TLF,()=>l.enteringFrameTransition().interpolateOpacity(this.easedTransitionProgress())),y=et.forTranslation(y,Ct.ENTERING_TLF,()=>h.multiply1(l.enteringFrameTransition().interpolateTranslation(this.easedTransitionProgress())))):y=new Ue([]),l.isDissolve()){let v=Ct.DISSOLVE_TRANSITION;e.cachedRenderTree=new Jn(f,y,v,()=>this.easedTransitionProgress())}else l.drawsEnteringFrameOnTopOfExitingFrame()?e.cachedRenderTree=Ue.wrap([f,y]):e.cachedRenderTree=Ue.wrap([y,f]);return e.cachedRenderTree}_renderTreeForOverlayTransition(e){var T,N,k,j;let t,n,r,o,i=e.change,a=i.oldOverlays(this._appState.prototypeState()),s=i.newOverlays(this._appState.prototypeState()),c=this._appState.prototypeState().lastNodeForBaseScreen(),l=c.canvasSpaceBoundingBox().topLeft();if(c==null)return null;let u=Ne.renderTreeForBaseScreenWithPerfLogging(c,new uo(c,this._hsmTransitionMap,null),"_renderTreeForOverlayTransition");if(u==null)return null;let d=[],h=this._compositor.prepareForEfficientCompositing(u);h!=null&&d.push(et.forTransformIsolation(h));let S=i.getFramePairTransition(),f=new Gi,y=0;for(let te=0,Y=Math.min(a.length,s.length);te<Y&&R.equals(a[te].id(),s[te].id());te=te+1){let _e=Ne.renderTreeForOverlayBackground(a[te].backgroundAppearance(),c.canvasSpaceBoundingBox());_e!=null&&d.push(_e);let ce=this._renderTreeForOverlay1(a[te],c,te,f,null);ce!=null&&d.push(ce),y=y+1}if(a.length==s.length&&y==a.length-1&&i.transitionParameters.transitionType=="SMART_ANIMATE"){let te=a[a.length-1],Y=s[s.length-1],_e=this._appState.prototypeState().lastNodeForOverlayAt(a.length-1),ce=this._appState.prototypeState().nextNodeForOverlayAt(s.length-1);if(_e!=null&&ce!=null){let V=[];ie.List_append2(V,d);let H=Ne.renderTreeForOverlayBackground(te.backgroundAppearance(),c.canvasSpaceBoundingBox()),M=Ne.renderTreeForOverlayBackground(Y.backgroundAppearance(),c.canvasSpaceBoundingBox());(H!=null||M!=null)&&V.push(new Jn(H,M,Ct.OVERLAY_BACKGROUND_DISSOLVE,()=>this.easedTransitionProgress()));let K=this._preparedRenderTreeForMagicMove(e,S,_e,ce,hn.FrameRole.OVERLAY,i.easingFunction());return K=et.forTranslation(K,Ct.SMART_ANIMATE_OVERLAY_TRANSLATION,()=>{let U=Y.deltaFromRenderedPositionToCanvasSpacePosition(c),P=te.renderedOrigin(c).subtract1(ce.canvasSpaceBoundingBox().topLeft());return U.multiply(this.easedTransitionProgress()).add1(P.multiply(1-this.easedTransitionProgress()))}),V.push(K),e.cachedRenderTree=Ue.wrap(V).optimized(),e.cachedRenderTree}}let m=[];for(let te=y,Y=a.length;te<Y;te=te+1){let _e=Ne.renderTreeForOverlayBackground(a[te].backgroundAppearance(),c.canvasSpaceBoundingBox()),ce=null;_e!=null&&(ce=()=>1-this.easedTransitionProgress(),m.push(et.forOpacity(_e,Ct.EXITING_OVERLAY_BACKGROUND,ce)));let V=a[te].renderedOrigin(c).subtract1(l),H=(N=(T=a[te].node())==null?void 0:T.size())!=null?N:ye.FrozenVector_new1(),M=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(i.transitionParameters.transitionType)!=-1?c.size().subtract1(V.add1(H)):V,K=H.add1(M),U=()=>K.multiply1(S.exitingFrameTransition().interpolateTranslation(this.easedTransitionProgress())),P=this._renderTreeForOverlay2(a[te],c,te,ce,f,U);f!=null&&f.removeEntry(a[te].id()),P!=null&&(P=et.forOpacity(P,Ct.EXITING_OVERLAY,()=>S.exitingFrameTransition().interpolateOpacity(this.easedTransitionProgress())),P=et.forTranslation(P,Ct.EXITING_OVERLAY,U),m.push(P))}let p=[];for(let te=y,Y=s.length;te<Y;te=te+1){let _e=Ne.renderTreeForOverlayBackground(s[te].backgroundAppearance(),c.canvasSpaceBoundingBox()),ce=null;_e!=null&&(ce=()=>this.easedTransitionProgress(),p.push(et.forOpacity(_e,Ct.ENTERING_OVERLAY_BACKGROUND,ce)));let V=s[te].renderedOrigin(c).subtract1(l),H=(j=(k=s[te].node())==null?void 0:k.size())!=null?j:ye.FrozenVector_new1(),M=["MOVE_FROM_RIGHT","MOVE_FROM_BOTTOM"].indexOf(i.transitionParameters.transitionType)!=-1?c.size().subtract1(V.add1(H)):V,K=H.add1(M),U=()=>K.multiply1(S.enteringFrameTransition().interpolateTranslation(this.easedTransitionProgress())),P=this._renderTreeForOverlay2(s[te],c,te,ce,f,U);P!=null&&(P=et.forOpacity(P,Ct.ENTERING_OVERLAY,()=>S.enteringFrameTransition().interpolateOpacity(this.easedTransitionProgress())),P=et.forTranslation(P,Ct.ENTERING_OVERLAY,U),p.push(P))}let _=[];if(ie.List_append2(_,d),S.isDissolve()){let te=Ct.DISSOLVE_TRANSITION,Y=Ue.wrap(m),_e=Ue.wrap(p);_.push(new Jn(Y,_e,te,()=>this.easedTransitionProgress()))}else ie.List_append2(_,m),ie.List_append2(_,p);return e.cachedRenderTree=Ue.wrap(_),e.cachedRenderTree}_onBeforeFrameForTransition(){if(this._ongoingTransition!=null&&(this._transitionProgressTracker.advanceToNextFrame(),!this._transitionProgressTracker.isTransitionInProgress()))switch(this._maybeLogPerformanceMetricsForTransition(),this._transitionProgressTracker.transitionEnded()){case vn.TransitionEndedAction.COMMIT:{this._appState.prototypeState().commitStateChange();break}case vn.TransitionEndedAction.ABORT:{this._appState.prototypeState().abortStateChange();break}}}_onBeforeFrameForHsm(){this._hsmTransitionMap.size!=0&&Array.from(this._hsmTransitionMap.keys()).forEach(e=>{if(Array.from(this._hsmTransitionMap.keys()).indexOf(e)!=-1){let t=this._hsmTransitionMap.get(e),n=t.tracker;if(n.advanceToNextFrame(),!n.isTransitionInProgress()){let r=n.transitionEnded(),o=this._appState.prototypeState(),i=t.change;if(o.getStateMachineInitiatedChange(i.stablePath)==i)switch(r){case vn.TransitionEndedAction.COMMIT:{o.commitChangesBelowInstanceTransitionRoot(i.stablePath);let a=this._appState.scene().findNode3(i.stablePath);a!=null&&this._dirtinessTracker.dirtyNode(a);break}case vn.TransitionEndedAction.ABORT:{o.abortInstanceStateChange(i.stablePath);break}}}}})}currentCanvasSpacePreviewBounds(){var r;let e;if(this._ongoingTransition!=null&&this.ongoingPrototypeStateChange().transitionParameters.transitionType!="INSTANT_TRANSITION"){let i=this._appState.prototypeState(),a=i.lastNodeForBaseScreen(),s=(r=i.nextNodeForBaseScreen())!=null?r:i.lastNodeForBaseScreen();return this.canvasSpacePreviewBoundsForTransition(a,s)}let n=this._appState.baseScreenNode();return this.canvasSpacePreviewBoundsForTransition(n,n)}currentCanvasSpaceFrameBounds(){var r;let e;if(this._ongoingTransition!=null&&this.ongoingPrototypeStateChange().transitionParameters.transitionType!="INSTANT_TRANSITION"){let i=this._appState.prototypeState(),a=i.lastNodeForBaseScreen(),s=(r=i.nextNodeForBaseScreen())!=null?r:i.lastNodeForBaseScreen();return this.canvasSpaceFrameBoundsForTransition(a,s)}let n=this._appState.baseScreenNode();return this.canvasSpaceFrameBoundsForTransition(n,n)}canvasSpacePreviewBoundsForTransition(e,t){if(e==null&&t==null)return null;if(!R.equals(e==null?void 0:e.id(),t==null?void 0:t.id())){let n=ye.FrozenVector_ZERO,r=ye.FrozenVector_ZERO,o=0,i=0;e!=null&&(n=e.canvasSpaceBoundingBox().size(),e.strokeGeometry()!=null&&e.strokeGeometry().bounds.isFinite()&&e.strokeAlign()!="INSIDE"&&(o=Math.abs(e.strokeGeometry().bounds.left()))),r=t.canvasSpaceBoundingBox().size(),t.strokeGeometry()!=null&&t.strokeGeometry().bounds.isFinite()&&t.strokeAlign()!="INSIDE"&&(i=Math.abs(t.strokeGeometry().bounds.left()));let a=n.max2(r),s=new B(0,0,a.x(),a.y()),c=Math.max(o,i),l=ee.new2().translatedBy1(t.canvasSpaceBoundingBox().center()).translatedBy1(s.center().negative());return s.transformInto1(s,l),s.expand1(c),s}return t.canvasSpacePreviewBounds()}canvasSpaceFrameBoundsForTransition(e,t){if(e==null&&t==null)return null;if(!R.equals(e==null?void 0:e.id(),t==null?void 0:t.id())){let n=e!=null?e.size():ye.FrozenVector_ZERO,r=t.size(),o=n.max2(r),i=new B(0,0,o.x(),o.y());return i.transformInto1(i,t.absoluteTransform()),i}return e.canvasSpaceBoundingBox()}ongoingPrototypeStateChange(){var t;let e;return(t=this._ongoingTransition)==null?void 0:t.change}transitionProgressTracker(){return this._transitionProgressTracker}renderLayerByLayerActivate(e){this._renderer.renderLayerByLayerActivate(e)}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}_createContext(){return new C.HTMLContext}attachTo(e){e.element().appendChild(this._context.gl().canvas)}removeFrom(e){e.element().removeChild(this._context.gl().canvas),this._uninitialize()}},yi=no;yi.VERBOSE_LOGS=!1,yi.PERF_TRACKING=!1;(t=>{class g{constructor(r,o){this.change=null,this.viewportBeforeTransition=null,this.cachedRenderTree=null,this.change=r,this.viewportBeforeTransition=new $r,this.viewportBeforeTransition.copyFrom(o)}}t.TransitionState=g;class e{constructor(r,o,i){this.tracker=r,this.progress=o,this.change=i}}t.InstanceSwapTransition=e})(yi||(yi={}));var Ls=class{opacity1(){return this._opacity}translation1(){return this._translation}transform1(){return this._transform}scaling1(){return this._scaling}transformOrigin1(){return this._transformOrigin}fillPaints1(){return this._fillPaints}strokePaints1(){return this._strokePaints}cornerRadii1(){return this._cornerRadii}rectangleSize1(){return this._rectangleSize}clone(){var r,o;let e,t,n=new Ls;return n._opacity=this._opacity,n._translation=this._translation.clone(),n._transform=this._transform.clone(),n._scaling=this._scaling,n._transformOrigin=(r=this._transformOrigin)==null?void 0:r.clone(),n._fillPaints=this._fillPaints,n._strokePaints=this._strokePaints,n._cornerRadii=this._cornerRadii,n._rectangleSize=(o=this._rectangleSize)==null?void 0:o.clone(),n}_areVectorsEqual(e,t){return e==null&&t==null?!0:e==null||t==null?!1:e.equals(t)}equals(e){return this._opacity==e.opacity1()&&this._transform.equals1(e.transform1())&&this._scaling.equals(e.scaling1())&&this._areVectorsEqual(this._transformOrigin,e.transformOrigin1())&&this.translation1().equals(e.translation1())&&nn.FrozenList_equals(this._fillPaints,e.fillPaints1(),(t,n)=>t.equals1(n))&&nn.FrozenList_equals(this._strokePaints,e.strokePaints1(),(t,n)=>t.equals1(n))&&this._cornerRadii.equals(e.cornerRadii1())&&this._areVectorsEqual(this._rectangleSize,e.rectangleSize1())}equalTransformsUpToTranslation(e,t){return this.equalTransformsUpToTranslationAndScaling(e,t)&&this._scaling.equals(e.scaling1())}equalTransformsUpToTranslationAndScaling(e,t){let n=jn.from(this.transform1()),r=jn.from(e.transform1()),o=Math.abs(n.angleDegrees-r.angleDegrees)<=t,i=Math.abs(n.m00-r.m00)<=t&&Math.abs(n.m01-r.m01)<=t&&Math.abs(n.m10-r.m10)<=t&&Math.abs(n.m11-r.m11)<=t;return o&&i}opacity2(e){return this._opacity=e,this}translation2(e){return this._translation=e,this}transform2(e){return e!=null,this._transform=e,this}scaling2(e){return this._scaling=e,this}transformOrigin2(e){return this._transformOrigin=e,this}fillPaints2(e){return this._fillPaints=e,this}strokePaints2(e){return this._strokePaints=e,this}cornerRadii2(e){return this._cornerRadii=e,this}rectangleSize2(e){return this._rectangleSize=e,this}withScaledTranslation(e){return this.clone().translation2(this._translation.multiply1(e))}constructor(){this._opacity=1,this._translation=I.new2(),this._transform=Nt.FrozenAffineTransform_new1(),this._scaling=I.new2().withOnesForZeros(),this._transformOrigin=null,this._fillPaints=[],this._strokePaints=[],this._cornerRadii=eo.ZEROS,this._rectangleSize=null}},Zn=class{constructor(){if(arguments.length==0)this._from=null,this._to=null,this._shouldDoLegacyImageRectSizeTransition=!1,this._shouldTransitionGeometryForRoundedRectangles=!1,this._isTransformEqual=!1,this._from=new Ls,this._to=new Ls,this._isTransformEqual=!0;else if(arguments.length==1){let e=arguments[0];this._from=null,this._to=null,this._shouldDoLegacyImageRectSizeTransition=!1,this._shouldTransitionGeometryForRoundedRectangles=!1,this._isTransformEqual=!1,this._from=e._from.clone(),this._to=e._to.clone(),this._shouldDoLegacyImageRectSizeTransition=e._shouldDoLegacyImageRectSizeTransition,this._shouldTransitionGeometryForRoundedRectangles=e._shouldTransitionGeometryForRoundedRectangles,this._isTransformEqual=e._isTransformEqual}}from(){return this._from}to(){return this._to}opacity(e,t){return this._from.opacity2(e),this._to.opacity2(t),this}translation(e,t){return this._from.translation2(e),this._to.translation2(t),this}transform(e,t){return this._isTransformEqual=e.equals2(t,1e-6),this._from.transform2(e),this._to.transform2(t),this}scaling(e,t){return this._from.scaling2(e),this._to.scaling2(t),this}shouldDoLegacyImageRectSizeTransition(e){return this._shouldDoLegacyImageRectSizeTransition=e,this}transitionGeometryForRoundedRectangles(e,t,n,r){return this._from.rectangleSize2(e),this._from.cornerRadii2(t),this._to.rectangleSize2(n),this._to.cornerRadii2(r),this._shouldTransitionGeometryForRoundedRectangles=!0,this}transformOrigin(e,t){return this._from.transformOrigin2(e),this._to.transformOrigin2(t),this}fillPaints1(e,t){return this._from.fillPaints2(e),this._to.fillPaints2(t),this}strokePaints1(e,t){return this._from.strokePaints2(e),this._to.strokePaints2(t),this}_getPaints(e,t,n){let r=[];for(let o=0,i=t.length;o<i;o=o+1){let a=t[o],s=n[o];if(a.equals2(s))r.push(a);else{let c=a,l=s;c.opacity()==0&&(c=s.cloneAsSinglePaint(),c.setOpacity(0)),l.opacity()==0&&(l=a.cloneAsSinglePaint(),l.setOpacity(0)),r.push(ca.create(c,l,this._from.transformOrigin1().multiply(2),this._to.transformOrigin1().multiply(2),e))}}return r}fillGeometryForRoundedRectangles(e,t){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let n=Math.max(1-t.top(),t.bottom(),1),r=B.new4(ye.FrozenVector_ZERO,this._from.rectangleSize1().multiply(n).max2(this._to.rectangleSize1().multiply(n))),o=new Kl("NONZERO",0,()=>{let i=I.lerp(this._from.rectangleSize1(),this._to.rectangleSize1(),e()),a=this._from.cornerRadii1().toList(),s=this._to.cornerRadii1().toList(),c=[];for(let l=0;l<4;l=l+1)c.push(Math.max(en.double_lerp(a[l],s[l],e()),0));return new Dt(new B(0,0,Math.abs(i.x()),Math.abs(i.y())),eo.fromList(c))},r);return new Dn([o],[],r,null)}fillGeometryForSpreadDynamic(e,t,n,r,o,i){if(!this._shouldTransitionGeometryForRoundedRectangles||this._from.rectangleSize1()==null||this._to.rectangleSize1()==null)return null;let a=this._from.rectangleSize1().add(2*t),s=this._to.rectangleSize1().add(2*t),c=Math.max(1-i.top(),i.bottom(),1),l=B.new4(ye.FrozenVector_ZERO,this._from.rectangleSize1().multiply(c).max2(this._to.rectangleSize1().multiply(c))).expandedBy1(t),u=this._from.cornerRadii1().toList(),d=this._to.cornerRadii1().toList();for(let S=0;S<4;S=S+1)u[S]=u[S]==0?0:u[S]+t,d[S]=d[S]==0?0:d[S]+t;let h=new Kl("NONZERO",0,()=>{let S=I.lerp(a,s,n()),f=[];for(let y=0;y<4;y=y+1)f.push(Math.max(en.double_lerp(u[y],d[y],n()),0));return new Dt(new B(-t,-t,Math.abs(S.x()),Math.abs(S.y())),eo.fromList(f))},l);return new zi(()=>new xt(h.path(),h.windingRule),r,h.bounds(),Ct.forDynamicGeometry(o))}fillPaints2(e){return this._getPaints(e,this._from.fillPaints1(),this._to.fillPaints1())}strokePaints2(e){return this._getPaints(e,this._from.strokePaints1(),this._to.strokePaints1())}hasTransitioningPaints(){return this._to.fillPaints1().length!=0&&this._from.fillPaints1().length!=0||this._to.strokePaints1().length!=0&&this._from.strokePaints1().length!=0}hasLegacyTransitioningSizesForImageRect(){return this._shouldDoLegacyImageRectSizeTransition}hasTransitioningGeometryForRoundedRectangles(){return this._shouldTransitionGeometryForRoundedRectangles}hasTransitioningTranslation(){return this._from.translation1()==null&&this._to.translation1()==null?!1:this._from.translation1()==null||this.to().translation1()==null?!0:!this._from.translation1().equals(this.to().translation1())}hasTransitioningTransform(){return this._from.transform1()==null&&this._to.transform1()==null?!1:this._from.transform1()==null||this.to().transform1()==null?!0:!this._from.transform1().equals1(this.to().transform1())}hasTransitioningScaling(){return this._from.scaling1()==null&&this._to.scaling1()==null?!1:this._from.scaling1()==null||this.to().scaling1()==null?!0:!this._from.scaling1().equals(this.to().scaling1())}hasTransitioningTransformOrigin(){return this._from.transformOrigin1()==null&&this._to.transformOrigin1()==null?!1:this._from.transformOrigin1()==null||this.to().transformOrigin1()==null?!0:!this._from.transformOrigin1().equals(this.to().transformOrigin1())}interpolateOpacity(e){return en.double_clamp(en.double_lerp(this.from().opacity1(),this.to().opacity1(),e),0,1)}interpolateTranslation(e){return I.lerp(this.from().translation1(),this.to().translation1(),e)}interpolateTransform(e){let t=this.from().transform1(),n=this.to().transform1();if(t.toAngle()!=n.toAngle()&&this.from().transformOrigin1()!=null&&this.to().transformOrigin1()!=null){let r=t.clone().translatedBy1(this.from().transformOrigin1()),o=n.clone().translatedBy1(this.to().transformOrigin1()),i=jn.lerp1(r,o,e),a=I.lerp(this.from().transformOrigin1(),this.to().transformOrigin1(),e),s=ee.new2().translatedBy1(a.negative());return i.multiply(s),i}else return this._isTransformEqual?t:jn.lerp1(t,n,e)}interpolateScaling(e){return I.lerp(this.from().scaling1(),this.to().scaling1(),e)}clone(){return new Zn(this)}withScaledTranslation(e){let t=this.clone();return t._from=t._from.withScaledTranslation(e),t._to=t._to.withScaledTranslation(e),t}},xe=class{constructor(){if(arguments.length==0)this._enteringFrameTransition=null,this._exitingFrameTransition=null,this._drawsEnteringFrameOnTopOfExitingFrame=!1,this._isDissolve=!1,this._reversed=null,this._enteringFrameTransition=new Zn,this._exitingFrameTransition=new Zn,this._drawsEnteringFrameOnTopOfExitingFrame=!0,this._isDissolve=!1;else if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._enteringFrameTransition=null,this._exitingFrameTransition=null,this._drawsEnteringFrameOnTopOfExitingFrame=!1,this._isDissolve=!1,this._reversed=null,this._enteringFrameTransition=e,this._exitingFrameTransition=t,this._drawsEnteringFrameOnTopOfExitingFrame=n,this._isDissolve=r}}enteringFrameTransition(){return this._enteringFrameTransition}exitingFrameTransition(){return this._exitingFrameTransition}drawsEnteringFrameOnTopOfExitingFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame}isDissolve(){return this._isDissolve}enteringFrameTranslation(e,t){return this._enteringFrameTransition.translation(e,t),this._reversed=null,this}enteringFrameOpacity(e,t){return this._enteringFrameTransition.opacity(e,t),this._reversed=null,this}exitingFrameTranslation(e,t){return this._exitingFrameTransition.translation(e,t),this._reversed=null,this}exitingFrameOpacity(e,t){return this._exitingFrameTransition.opacity(e,t),this._reversed=null,this}drawExitingFrameOnTopOfEnteringFrame(){return this._drawsEnteringFrameOnTopOfExitingFrame=!1,this._reversed=null,this}dissolve(){return this._isDissolve=!0,this._reversed=null,this}freeze(){return this}clone(){return new xe(this._enteringFrameTransition.clone(),this._exitingFrameTransition.clone(),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}reversed(){if(this._reversed==null){let e=new xe().enteringFrameTranslation(this.exitingFrameTransition().to().translation1(),this.exitingFrameTransition().from().translation1()).enteringFrameOpacity(this.exitingFrameTransition().to().opacity1(),this.exitingFrameTransition().from().opacity1()).exitingFrameTranslation(this.enteringFrameTransition().to().translation1(),this.enteringFrameTransition().from().translation1()).exitingFrameOpacity(this.enteringFrameTransition().to().opacity1(),this.enteringFrameTransition().from().opacity1());this.isDissolve()&&e.dissolve(),this.drawsEnteringFrameOnTopOfExitingFrame()&&e.drawExitingFrameOnTopOfEnteringFrame(),this._reversed=e}return this._reversed}withScaledTranslation(e){return new xe(this._enteringFrameTransition.withScaledTranslation(e),this._exitingFrameTransition.withScaledTranslation(e),this._drawsEnteringFrameOnTopOfExitingFrame,this._isDissolve)}static get(e){switch(e){case"INSTANT_TRANSITION":return xe.INSTANT_TRANSITION;case"DISSOLVE":return xe.DISSOLVE;case"SMART_ANIMATE":return xe.DISSOLVE;case"SLIDE_FROM_LEFT":return xe.SLIDE_FROM_LEFT;case"SLIDE_FROM_RIGHT":return xe.SLIDE_FROM_RIGHT;case"SLIDE_FROM_TOP":return xe.SLIDE_FROM_TOP;case"SLIDE_FROM_BOTTOM":return xe.SLIDE_FROM_BOTTOM;case"PUSH_FROM_LEFT":return xe.PUSH_FROM_LEFT;case"PUSH_FROM_RIGHT":return xe.PUSH_FROM_RIGHT;case"PUSH_FROM_TOP":return xe.PUSH_FROM_TOP;case"PUSH_FROM_BOTTOM":return xe.PUSH_FROM_BOTTOM;case"MOVE_FROM_LEFT":return xe.MOVE_FROM_LEFT;case"MOVE_FROM_RIGHT":return xe.MOVE_FROM_RIGHT;case"MOVE_FROM_TOP":return xe.MOVE_FROM_TOP;case"MOVE_FROM_BOTTOM":return xe.MOVE_FROM_BOTTOM;case"SLIDE_OUT_TO_LEFT":return xe.SLIDE_OUT_TO_LEFT;case"SLIDE_OUT_TO_RIGHT":return xe.SLIDE_OUT_TO_RIGHT;case"SLIDE_OUT_TO_TOP":return xe.SLIDE_OUT_TO_TOP;case"SLIDE_OUT_TO_BOTTOM":return xe.SLIDE_OUT_TO_BOTTOM;case"MOVE_OUT_TO_LEFT":return xe.MOVE_OUT_TO_LEFT;case"MOVE_OUT_TO_RIGHT":return xe.MOVE_OUT_TO_RIGHT;case"MOVE_OUT_TO_TOP":return xe.MOVE_OUT_TO_TOP;case"MOVE_OUT_TO_BOTTOM":return xe.MOVE_OUT_TO_BOTTOM;case"FADE":return xe.DISSOLVE;case"MAGIC_MOVE":return xe.DISSOLVE}throw new Error(`Unhandled transition type ${e}`)}},_t=xe;_t.SLIDE_BACK_FRAME_OPACITY_START=1,_t.SLIDE_BACK_FRAME_OPACITY_END=.5,_t.OFFSCREEN_LEFT=new I(-1,0),_t.OFFSCREEN_RIGHT=new I(1,0),_t.OFFSCREEN_TOP=new I(0,-1),_t.OFFSCREEN_BOTTOM=new I(0,1),_t.CENTER=I.new2(),_t.INSTANT_TRANSITION=new xe().freeze(),_t.DISSOLVE=new xe().dissolve().freeze(),_t.SLIDE_FROM_LEFT=new xe().enteringFrameTranslation(xe.OFFSCREEN_LEFT,xe.CENTER).exitingFrameTranslation(xe.CENTER,xe.OFFSCREEN_RIGHT.divide(4)).exitingFrameOpacity(xe.SLIDE_BACK_FRAME_OPACITY_START,xe.SLIDE_BACK_FRAME_OPACITY_END).freeze(),_t.SLIDE_FROM_RIGHT=new xe().enteringFrameTranslation(xe.OFFSCREEN_RIGHT,xe.CENTER).exitingFrameTranslation(xe.CENTER,xe.OFFSCREEN_LEFT.divide(4)).exitingFrameOpacity(xe.SLIDE_BACK_FRAME_OPACITY_START,xe.SLIDE_BACK_FRAME_OPACITY_END).freeze(),_t.SLIDE_FROM_TOP=new xe().enteringFrameTranslation(xe.OFFSCREEN_TOP,xe.CENTER).exitingFrameTranslation(xe.CENTER,xe.OFFSCREEN_BOTTOM.divide(4)).exitingFrameOpacity(xe.SLIDE_BACK_FRAME_OPACITY_START,xe.SLIDE_BACK_FRAME_OPACITY_END).freeze(),_t.SLIDE_FROM_BOTTOM=new xe().enteringFrameTranslation(xe.OFFSCREEN_BOTTOM,xe.CENTER).exitingFrameTranslation(xe.CENTER,xe.OFFSCREEN_TOP.divide(4)).exitingFrameOpacity(xe.SLIDE_BACK_FRAME_OPACITY_START,xe.SLIDE_BACK_FRAME_OPACITY_END).freeze(),_t.SLIDE_OUT_TO_LEFT=xe.SLIDE_FROM_RIGHT.reversed(),_t.SLIDE_OUT_TO_RIGHT=xe.SLIDE_FROM_LEFT.reversed(),_t.SLIDE_OUT_TO_TOP=xe.SLIDE_FROM_BOTTOM.reversed(),_t.SLIDE_OUT_TO_BOTTOM=xe.SLIDE_FROM_TOP.reversed(),_t.PUSH_FROM_LEFT=new xe().enteringFrameTranslation(xe.OFFSCREEN_LEFT,xe.CENTER).exitingFrameTranslation(xe.CENTER,xe.OFFSCREEN_RIGHT).freeze(),_t.PUSH_FROM_RIGHT=xe.PUSH_FROM_LEFT.reversed(),_t.PUSH_FROM_TOP=new xe().enteringFrameTranslation(xe.OFFSCREEN_TOP,xe.CENTER).exitingFrameTranslation(xe.CENTER,xe.OFFSCREEN_BOTTOM).freeze(),_t.PUSH_FROM_BOTTOM=xe.PUSH_FROM_TOP.reversed(),_t.MOVE_FROM_LEFT=new xe().enteringFrameTranslation(xe.OFFSCREEN_LEFT,xe.CENTER).freeze(),_t.MOVE_FROM_RIGHT=new xe().enteringFrameTranslation(xe.OFFSCREEN_RIGHT,xe.CENTER).freeze(),_t.MOVE_FROM_TOP=new xe().enteringFrameTranslation(xe.OFFSCREEN_TOP,xe.CENTER).freeze(),_t.MOVE_FROM_BOTTOM=new xe().enteringFrameTranslation(xe.OFFSCREEN_BOTTOM,xe.CENTER).freeze(),_t.MOVE_OUT_TO_LEFT=xe.MOVE_FROM_RIGHT.reversed(),_t.MOVE_OUT_TO_RIGHT=xe.MOVE_FROM_LEFT.reversed(),_t.MOVE_OUT_TO_TOP=xe.MOVE_FROM_BOTTOM.reversed(),_t.MOVE_OUT_TO_BOTTOM=xe.MOVE_FROM_TOP.reversed();var Mr=(t=>(t[t.FORWARD=0]="FORWARD",t[t.REVERSE=1]="REVERSE",t))(Mr||{}),Jo=(n=>(n[n.IGNORE=0]="IGNORE",n[n.REMEMBER=1]="REMEMBER",n[n.RESET=2]="RESET",n))(Jo||{}),ql=class{constructor(e,t){this.hotspotStablePath=e,this.interactionId=t}},Xr=ql;Xr.EXTERNAL_INTERACTION_ID=R._new(-1,-2),Xr.EXTERNAL=new ql(null,ql.EXTERNAL_INTERACTION_ID);var In=class{static getDefault(){let e=Q.getFeatureFlags().prototypeStateManagement?1:0;return new In("INSTANT_TRANSITION",0,null,!1,ye.FrozenVector_new1(),"NAVIGATE",!1,ye.FrozenVector_new1(),!1,!0,!1,!1,e)}static fromPrototypeAction(e,t){return e==null?In.getDefault():new In(e.transitionType(),e.transitionDuration(),e.easingFunction,e.transitionShouldSmartAnimate(),e.overlayRelativePosition(),e.navigationType(),e.transitionPreserveScroll(),e.extraScrollOffset(),e.transitionResetVideoPosition(),e.openUrlInNewTab(),e.transitionResetScrollPosition(),e.transitionResetInteractiveComponents(),t)}withTransitionPreserveScroll(e){return new In(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,e,this.extraScrollOffset,this.transitionResetVideoPosition,this.openUrlInNewTab,this.transitionResetScrollPosition,this.transitionResetInteractiveComponents,this.stateManagementVersion)}withDefaultStateManagementSettings(){return new In(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,!1,this.openUrlInNewTab,!1,!1,this.stateManagementVersion)}withStateManagementSettings(e){return e==null?this:new In(this.transitionType,this.transitionDuration,this.easingFunction,this.transitionShouldSmartAnimate,this.overlayRelativePosition,this.navigationType,this.transitionPreserveScroll,this.extraScrollOffset,e.transitionResetVideoPosition,this.openUrlInNewTab,e.transitionResetScrollPosition,e.transitionResetInteractiveComponents,e.stateManagementVersion)}constructor(e,t,n,r,o,i,a,s,c,l,u,d,h){this.transitionType=e,this.transitionDuration=t,this.easingFunction=n,this.transitionShouldSmartAnimate=r,this.overlayRelativePosition=o,this.navigationType=i,this.transitionPreserveScroll=a,this.extraScrollOffset=s,this.transitionResetVideoPosition=c,this.openUrlInNewTab=l,this.transitionResetScrollPosition=u,this.transitionResetInteractiveComponents=d,this.stateManagementVersion=h}},Cn=class{topId(){return this.overlays.length>0?ie.List_last(this.overlays).id:this.stateId}debugString(e){let t=o=>{var c;let i,a=e.findNode1(o);return`[nodeId.toString]: ${(c=a==null?void 0:a.name())!=null?c:"null"}`},n="  ",r="[";for(let o=0,i=this.overlays.length;o<i;o=o+1){let a=this.overlays[o];r+=n+t(a.id),o!=this.overlays.length-1&&(r+=`,
`)}return r+="]",`PresentedState(
`+n+t(this.stateId)+`
`+n+`,
`+n+r+`
)`}statesAndOverlaysIncluded(){let e=new rr;this.stateId!=null&&R.isValid(this.stateId)&&e.add(R.toString(this.stateId));for(let t of this.overlays.slice())R.isValid(t.id)&&e.add(R.toString(t.id));return e}constructor(e,t){this.stateId=e,this.overlays=t}},Gn=class{constructor(){if(arguments[0]==0){let[,e]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=In.getDefault(),this.interactionAddress=Xr.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new Cn(null,[]),this.newStateAndOverlays=new Cn(null,[])}else if(arguments[0]==1){let[,e,t,n]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=In.getDefault(),this.interactionAddress=Xr.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=n}else if(arguments[0]==2){let[,e,t,n,r,o,i,a]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=In.getDefault(),this.interactionAddress=Xr.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=new Cn(t,[]),this.newStateAndOverlays=new Cn(n,[]),this.direction=0,this.cause=a,this.interactionAddress=r,this.transitionParameters=i,this.canvasSpaceTriggerBoundsOrNull=o}else if(arguments[0]==3){let[,e,t,n,r,o,i,a,s]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=In.getDefault(),this.interactionAddress=Xr.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=n,this.direction=a,this.cause=s,this.interactionAddress=r,this.transitionParameters=i,this.canvasSpaceTriggerBoundsOrNull=o}else if(arguments[0]==4){let[,e,t,n,r,o,i,a]=arguments;this.stablePath=null,this.oldStateAndOverlays=null,this.newStateAndOverlays=null,this.cause=0,this.canvasSpaceTriggerBoundsOrNull=null,this.direction=0,this.transitionParameters=In.getDefault(),this.interactionAddress=Xr.EXTERNAL,this.stablePath=e,this.oldStateAndOverlays=t,this.newStateAndOverlays=n,this.interactionAddress=o,this.direction=i,this.transitionParameters=a,this.cause=r}}static forClosingTopNOverlays(e,t,n,r,o,i){let s=n[n.length-e].openingTransition.withTransitionPreserveScroll(!0).withDefaultStateManagementSettings();return new Gn(3,En.ROOT_STABLE_PATH(),new Cn(t,n),new Cn(t,n.slice().slice(0,n.length-e)),r,o,s,1,i)}oldStateId(){var t;let e;return(t=this.oldStateAndOverlays)==null?void 0:t.stateId}newStateId(){var t;let e;return(t=this.newStateAndOverlays)==null?void 0:t.stateId}oldOverlayData(){var t;let e;return(t=this.oldStateAndOverlays)==null?void 0:t.overlays}newOverlayData(){var t;let e;return(t=this.newStateAndOverlays)==null?void 0:t.overlays}oldOverlays(e){var n;let t;return e.bindOverlays((n=this.oldStateAndOverlays)==null?void 0:n.overlays)}newOverlays(e){var n;let t;return e.bindOverlays((n=this.newStateAndOverlays)==null?void 0:n.overlays)}isTransientChange(){let e=R.equals(this.oldStateAndOverlays.stateId,this.newStateAndOverlays.stateId);switch(this.transitionParameters.navigationType){case"OVERLAY":case"SWAP":case"SCROLL_TO":return!0;default:break}return qt.TransitionAction_isTransientAction(this.cause)||e}debugString(e){var r,o;let t,n;return`${(r=this.oldStateAndOverlays)==null?void 0:r.debugString(e)}
=>
${(o=this.newStateAndOverlays)==null?void 0:o.debugString(e)}`}easingFunction(){return this.transitionParameters.easingFunction}preserveScroll(){return this.transitionParameters.transitionPreserveScroll?1:0}resetScroll(){return this.transitionParameters.transitionResetScrollPosition?0:1}resetInteractiveComponents(){return this.transitionParameters.transitionResetInteractiveComponents?0:1}stateManagementVersion(){return this.transitionParameters.stateManagementVersion}getFramePairTransition(){let e=_t.get(this.transitionParameters.transitionType);return this.direction==1?e.reversed():e}getNewOrChangedFrameIds(){let e=[];!R.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.newStateId());for(let t=0,n=this.newOverlayData().length;t<n;t=t+1)(t>=this.oldOverlayData().length||!R.equals(this.oldOverlayData()[t].id,this.newOverlayData()[t].id))&&e.push(this.newOverlayData()[t].id);return e}getInsertedFrameIds(){let e=[];!R.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.newStateId());let t=new rr;this.oldOverlayData().forEach(n=>{t.add(R.toString(n.id))});for(let n=0,r=this.newOverlayData().length;n<r;n=n+1){let o=this.newOverlayData()[n].id;t._in(R.toString(o))||e.push(o)}return e}getRemovedFrameIds(){let e=[];!R.equals(this.oldStateId(),this.newStateId())&&this.newStateId()!=null&&e.push(this.oldStateId());let t=new rr;this.newOverlayData().forEach(n=>{t.add(R.toString(n.id))});for(let n=0,r=this.oldOverlayData().length;n<r;n=n+1){let o=this.oldOverlayData()[n].id;t._in(R.toString(o))||e.push(o)}return e}},zn=class{static getDefaultExternalExecution(){return new zn(Xr.EXTERNAL,In.getDefault(),null)}static forNoodle(e,t,n){let r=new Xr(zn.stablePathForHotspot(e),t.id()),o=t.action().value;if(n!=null)o=n;else for(let s of t.getAllValidTransitionActionsInInteraction()){o=s;break}let i=In.fromPrototypeAction(o,Q.getFeatureFlags().prototypeStateManagement?t.stateManagementVersion():0),a=t.event().interactionType()=="ON_HOVER"?e.canvasSpaceInteractiveBounds():null;return new zn(r,i,a)}static forExternalOpenOverlay(e){let t=new Xr(zn.stablePathForHotspot(e),R._new(-1,-2));return new zn(t,In.getDefault(),null)}static stablePathForHotspot(e){let t=null;return t=e.stablePath(),t}constructor(e,t,n){this.interactionAddress=e,this.transitionParameters=t,this.canvasSpaceTriggerBoundsOrNull=n}},tm;(e=>{function g(t){return Mr[t]}e.TransitionDirection_toString=g})(tm||(tm={}));var nm;(e=>{function g(t){return Jo[t]}e.HistoryPolicy_toString=g})(nm||(nm={}));var Vs;(i=>{function g(a,s,c){a.set(s,c)}i.Map_set1=g;function e(a,s){return a.get(s)}i.Map_get1=e;function t(a,s,c){let l=a.get(s);return l!==void 0?l:c}i.Map_getOrDefault=t;function n(a){return Array.from(a.keys())}i.Map_keys=n;function r(a){return Array.from(a.values())}i.Map_values=r;function o(a,s){let c=new Map;for(let l=0,u=a.length;l<u;l=l+1)c.set(a[l],s[l]);return c}i.Map_new1=o})(Vs||(Vs={}));var rm;(n=>{function g(r,o){return r.get(o)}n.WeakMap_get1=g;function e(r,o,i){r.set(o,i)}n.WeakMap_set1=e;function t(r,o){let i=new WeakMap;for(let a=0,s=r.length;a<s;a=a+1)i.set(r[a],o[a]);return i}n.WeakMap_new1=t})(rm||(rm={}));var sm=(r=>(r[r.REQUESTED=0]="REQUESTED",r[r.INITIATED=1]="INITIATED",r[r.ABORTED=2]="ABORTED",r[r.COMMITTED=3]="COMMITTED",r))(sm||{}),En=class{static ROOT_STABLE_PATH(){return new wt([])}constructor(e,t){this.VERBOSE_LOGS=!1,this._appState=null,this._observers=new lr,this._isNotifyingStateChangeObservers=!1,this._emitter=null,this._interactionsEnabled=!0,this._disableNewStateChanges=!1,this._currentFitMode=vr.NONE,this.componentStateSyncer=null,this._onStateSwapFailedDueToCycle=null,this._isDragging=!1,this._actionCounter=0,this._transitionOnClick=!0,this._changeHistory=[],this._initiatedChange=null,this._initiatedHistory=null,this._lastInitiatedTopLevelStateChange=null,this._ongoingNavigateRepairsInvalidState=!1,this._shouldNotifyNavigationInfoInvalidated=!1,this._tlfHistory=[],this._upcomingTlfs=new Set,this._screensNeedValidating=!1,this._removedPrimaryInstances=[],this._enqueueUpcomingTlfsDeadline=0,this._forceInitiateStateChangeForTests=!1,this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._visitedScreenIds=new rr,this._isApplyingStateChangeMutation=!1,this._isResettingStateChangeMutations=!1,this._hsmRoot=null,this._initiatedInstanceChanges=new Map,this._lastInitiatedInstanceStateChange=null,this._hsmObservers=new lr,this._appState=e,this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this.componentStateSyncer=new Ho(this._appState,this,(n,r,o)=>this._getFullscreenNodeChangesForStateSwap(n,r,o)),this._emitter=t,this._hsmRoot=new Bs(this),this._onStateSwapFailedDueToCycle=()=>{this._emitter.trigger("stateSwapFailedDueToCycle",{})},this.resetState()}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._hsmRoot=new Bs(this),this._initiatedInstanceChanges=new Map,t!=null&&this.createOrRepairStateMachinesForInsertedSubtree(t.root()),this._visitedScreenIds=new rr,this._enforceValidPrototypeState()}resetState(){this.resetPrototype(),this._currentFitMode=vr.NONE,this._transitionOnClick=!0}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){this._enforceValidPrototypeState()}handleSceneGraphEvent(e){var n;let t;if(zr.isPrototypeStructuralChange(e.property)&&(this._screensNeedValidating=!0,this._deferEnqueueUpcomingTlfs()),e.property==94)Z.asString(e.newVal)=="REMOVED"&&!this.isApplyingStateChangeMutation()&&e.node.isPrimaryInstance()&&this._removedPrimaryInstances.push(e.node.id());else if(e.property==74&&e.node.isInstance()){let r=(n=e.node.symbolID())!=null?n:R.invalid();R.isValid(r)||console.warn("Unexpected invalid symbolID for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(e.node,r)}else if(e.property==24){let r=e.oldVal!=null&&Z.isParentIndex(e.oldVal)?Z.asParentIndex(e.oldVal):null,o=e.newVal!=null&&Z.isParentIndex(e.newVal)?Z.asParentIndex(e.newVal):null,i=r!=null?e.node.scene().findNode1(r.id):null,a=o!=null?e.node.scene().findNode1(o.id):null,s=i!=null&&i.isRooted(),c=a!=null&&a.isRooted();!s&&c?this.createOrRepairStateMachinesForInsertedSubtree(e.node):s&&!c&&(this.isApplyingStateChangeMutation()||Se.forEachNode1(e.node,l=>{if(l.isInstance()){let u=this._getStateMachineOrNull(l.stablePath());if(u!=null)return this.commitInstanceStateChange(u),Se.Loop.SKIP}return Se.Loop.CONTINUE}))}else e.property==61&&An.clearCachedNodePaths()}didApplyNodeChanges(){if(this._screensNeedValidating&&(this._enforceValidPrototypeState(),this._screensNeedValidating=!1),this._removedPrimaryInstances.length>0){for(let e of this._removedPrimaryInstances)this.commitChangesBelowInstanceTransitionRoot(new wt([e])),this._hsmRoot.removeChild(e);this._removedPrimaryInstances=[]}}onFrame(){this._shouldNotifyNavigationInfoInvalidated&&(this._emitter.trigger("navigationInfoInvalidated",null),this._shouldNotifyNavigationInfoInvalidated=!1),this._enqueueUpcomingTlfsDeadline!=0&&We.milliseconds()>this._enqueueUpcomingTlfsDeadline&&this._enqueueUpcomingTlfs()}_filterOverlays(e){let t=e.length;for(let n=0;n<e.length;n=n+1){let r=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e[n].id);if(r==null){t=n;break}r.setUsedAsBaseScreen(!1)}return t==e.length?e:e.slice(0,t)}_filterPresentedState(e){if(e==null)return null;if(e.stateId==null&&e.overlays.length==0)return e;let t=this._appState.prototypeStructure().validDestinationForPrototypeFromId(e.stateId);if(t==null)return new Cn(null,[]);t.setUsedAsBaseScreen(!0);let n=this._filterOverlays(e.overlays);return n==e.overlays?e:new Cn(e.stateId,n)}_filterChange(e){if(e==null)return null;let t=this._filterPresentedState(e.oldStateAndOverlays),n=this._filterPresentedState(e.newStateAndOverlays);return t==e.oldStateAndOverlays&&n==e.newStateAndOverlays?e:new Gn(1,En.ROOT_STABLE_PATH(),t,n)}enforceValidPrototypeStateForTesting(){this._enforceValidPrototypeState()}_enforceValidPrototypeState(){let e=!1;if(this._initiatedChange!=null){let r=this._initiatedChange.oldStateId()!=null&&this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.oldStateId())==null,o=this._appState.prototypeStructure().validDestinationForPrototypeFromId(this._initiatedChange.newStateId())==null;e=r||o}else if(this._changeHistory.length>0){let r=ie.List_last(this._changeHistory).newStateId();e=this._appState.prototypeStructure().validDestinationForPrototypeFromId(r)==null}else return;if(e){this.restartPrototype(xo.FIX_INVALID_STATE);return}let t=null,n=null;if(this._initiatedChange!=null){let r=this._filterChange(this._initiatedChange);this._initiatedChange!=r&&(n=this._initiatedHistory.slice(),t=r)}else if(this._changeHistory.length>0){let r=ie.List_last(this._changeHistory),o=this._filterChange(r);o!=r&&(n=this._changeHistory.slice(),t=o)}t!=null&&n!=null&&(ie.List_removeLast(n),n.push(t),this._requestStateChange(t,n),this.commitStateChange())}getTlfHistory(){return this._tlfHistory}getLastChangeInHistory(){return this._changeHistory.length<1?null:ie.List_last(this._changeHistory)}getHistoryCount(){return this._changeHistory.length}getInitiatedChange(){return this._initiatedChange}getCurrentBaseScreenId(){return this._initiatedChange!=null?this._initiatedChange.newStateAndOverlays.stateId:this._changeHistory.length>0?ie.List_last(this._changeHistory).newStateAndOverlays.stateId:null}getCurrentBaseScreenNode(){var n;let e,t=this.getCurrentBaseScreenId();return t==null?null:(n=this._appState.scene())==null?void 0:n.findNode1(t)}getCurrentBaseScreenIndex(){let e=this.getCurrentBaseScreenId();return e==null?-1:this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(R.toString(e))}getNextBaseScreenIdForPrototype(){let e=this.getCurrentBaseScreenIndex(),t=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();return e<0?null:e>=t.length-1?this._getUpcomingTlf():R.fromString(t[e+1])}getNextBaseScreenNodeForPrototype(){return this._appState.scene().findNode1(this.getNextBaseScreenIdForPrototype())}getNextBaseScreenIdForFrameList(){let e=this.getCurrentBaseScreenIndex(),t=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder();return e<0||e>=t.length-1?null:R.fromString(t[e+1])}getNextBaseScreenNodeForFrameList(){return this._appState.scene().findNode1(this.getNextBaseScreenIdForFrameList())}getPreviousBaseScreenId(){let e=this._appState.prototypeStructure().topLevelPrototypeNodesInOrder(),t=this.getCurrentBaseScreenIndex();return t<1?null:R.fromString(e[t-1])}getPreviousBaseScreenNode(){return this._appState.scene().findNode1(this.getPreviousBaseScreenId())}getCurrentOverlays(){return this.bindOverlays(this.getCurrentOverlayData())}getCurrentOverlayData(){return this._initiatedChange!=null?this._initiatedChange.newOverlayData():this._changeHistory.length>0?ie.List_last(this._changeHistory).newOverlayData():[]}getCurrentOverlayIds(){return this.getCurrentOverlays().map(e=>e.id())}getOpenOverlayData(e){let t=this.getCurrentOverlays();for(let n=0,r=t.length;n<r;n=n+1){let o=t[n];if(R.equals(o.id(),e))return o}return null}getTopmostScreen(){var t;let e;return(t=this.getTopmostOverlayNode())!=null?t:this.getCurrentBaseScreenNode()}getTopmostScreenId(){var t;let e;return(t=this.getTopmostOverlayId())!=null?t:this.getCurrentBaseScreenId()}getTopmostOverlay(){let e=this.getCurrentOverlays();return e.length>0?ie.List_last(e):null}getTopmostOverlayId(){let e=this.getCurrentOverlays();return e.length>0?ie.List_last(e).id():null}getTopmostOverlayNode(){var n;let e,t=this.getCurrentOverlays();return t.length==0?null:(n=this._appState.scene())==null?void 0:n.findNode1(ie.List_last(t).id())}getSecondTopmostOverlayNodeOrBaseScreen(){var n;let e,t=this.getCurrentOverlays();return t.length==0?null:t.length==1?this.getCurrentBaseScreenNode():(n=this._appState.scene())==null?void 0:n.findNode1(t[t.length-2].id())}getLayersIds(){let e=this.getCurrentBaseScreenId();if(e==null)return[];let t=this.getCurrentOverlayIds().slice();return t.unshift(e),t}getPreviousNonTransientChange(){let e=this._changeHistory.slice();for(;e.length>0&&ie.List_last(e).isTransientChange();)e.pop();if(e.length==0)return null;for(;e.length>0;){let t=e.pop();if(!(e.length>0&&ie.List_last(e).isTransientChange()||this._appState.prototypeStructure().validDestinationForPrototypeFromId(t.oldStateId())==null))return t}return null}bindOverlays(e){let t=[];for(let n=0,r=e.length;n<r;n=n+1)t.push(new Il(this._appState.scene(),e[n],n>0?t[n-1]:null,n));return t}getOngoingNavigateRepairsInvalidState(){return this._ongoingNavigateRepairsInvalidState}lastNodeForBaseScreen(){var n;let e,t=null;return this._initiatedChange!=null?t=this._initiatedChange.oldStateId():this._changeHistory.length>0&&(t=ie.List_last(this._changeHistory).newStateId()),t==null?null:(n=this._appState.scene())==null?void 0:n.findNode1(t)}nextNodeForBaseScreen(){var n,r;let e,t;return((n=this._initiatedChange)==null?void 0:n.newStateId())==null?null:(r=this._appState.scene())==null?void 0:r.findNode1(this._initiatedChange.newStateId())}lastNodeForOverlayAt(e){var r;let t,n=null;if(this._initiatedChange!=null)n=this._initiatedChange.oldOverlayData();else if(this._changeHistory.length>0)n=ie.List_last(this._changeHistory).newOverlayData();else return null;return n.length<=e?null:(r=this._appState.scene())==null?void 0:r.findNode1(n[e].id)}nextNodeForOverlayAt(e){var r;let t;if(this._initiatedChange==null)return null;let n=this._initiatedChange.newOverlayData();return n.length<=e?null:(r=this._appState.scene())==null?void 0:r.findNode1(n[e].id)}displayedOverlayCount(){return this._initiatedChange!=null?Math.max(this._initiatedChange.oldOverlayData().length,this._initiatedChange.newOverlayData().length):this._changeHistory.length>0?ie.List_last(this._changeHistory).newOverlayData().length:0}nodeForOverlayAt(e){var r;let t,n=this.getCurrentOverlayData();return n.length<=e?null:(r=this._appState.scene())==null?void 0:r.findNode1(n[e].id)}getCurrentFitMode(){return this._currentFitMode}setFitModeFromParameter(e){let t=vr.SCALE_DOWN;switch(e){case"contain":{t=vr.CONTAIN;break}case"scale-down":{t=vr.SCALE_DOWN;break}case"min-zoom":{t=vr.MIN_ZOOM;break}case"scale-down-width":{t=vr.SCALE_DOWN_TO_FIT_WIDTH;break}case"fit-width":{t=vr.FIT_WIDTH;break}case"free":{t=vr.FREE;break}default:break}if(t!=this._currentFitMode){let n=this._currentFitMode;this._currentFitMode=t,this._notifyFitModeChange(n,this._currentFitMode)}}_notifyFitModeChange(e,t){this._observers.forEach(n=>{n.handleFitModeChange(e,t)})}actionCounter(){return this._actionCounter}setTransitionOnClick(e){this._transitionOnClick=e}getTransitionOnClick(){return this._transitionOnClick}setInteractionsEnabled(e){this._interactionsEnabled=e}interactionsEnabled(){return this._interactionsEnabled}isDragging(){return this._isDragging}setIsDragging(e){this._isDragging=e}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}closeOverlayAtAndAbove(e,t){let n=zn.getDefaultExternalExecution();this._closeOverlayAtAndAbove(e,n.interactionAddress,n.canvasSpaceTriggerBoundsOrNull,0,null,t)}closeOverlayForHotspot(e,t,n,r){var l;let o,i=null,a=null,s=0;e!=null&&t!=null?(i=(l=e.topLevelAncestor())==null?void 0:l.id(),a=zn.forNoodle(e,t,r),s=qt.TransitionAction_fromInteractionType(t.event().interactionType())):(ze("closeOverlayForHotspot called with null hotspot"),i=this.getTopmostOverlayId(),a=zn.getDefaultExternalExecution(),s=0);let c=this.getCurrentOverlayData();for(let u=c.length-1;u>=0;u=u-1)if(R.equals(c[u].id,i)){this._closeOverlayAtAndAbove(u,a.interactionAddress,a.canvasSpaceTriggerBoundsOrNull,s,null,n);return}}_closeOverlayAtAndAbove(e,t,n,r,o,i){if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let a=this.getCurrentOverlayData();if(a.length>e){let s=Gn.forClosingTopNOverlays(a.length-e,this.getCurrentBaseScreenId(),a,t,n,r);if(o==null)switch(i){case 0:{o=this._changeHistory.slice();break}case 1:{o=nn.FrozenList_cloneAndAppendOne(this._changeHistory,s);break}case 2:{o=[s].slice();break}}this._requestStateChange(s,o)}}navigateToFrameAndCloseOverlays1(e){this.navigateToFrameAndCloseOverlays3(e,null,2,0,0,null,null)}navigateToFrameAndCloseOverlays2(e,t){var r;let n;if(e!=null&&R.isValid(e)){let o=(r=this._appState.scene())==null?void 0:r.findNode1(e),i=e;t!=null&&R.isValid(t)&&(this._appState.setActivePrototypeStartingPointNodeId(t),o!=null&&o.topLevelAncestor()==null&&(i=t)),this.navigateToFrameAndCloseOverlays3(i,null,2,0,0,null,null)}}navigateToFrameAndCloseOverlays3(e,t,n,r,o,i,a){var p;let s;if(!this._allowNewStateChanges())return;this._clearInitiatedChangesBeforeNewChange();let c=this.getCurrentBaseScreenNode(),l=(p=this._appState.prototypeStructure())==null?void 0:p.getDestinationFrame(e);if(l!=null)l.setUsedAsBaseScreen(!0),e=l.id();else if(!Q.isInlinePreview())return;let u=this.getCurrentOverlayData();if(R.equals(e,c==null?void 0:c.id())&&(c==null?void 0:c.scene())==(l==null?void 0:l.scene())&&u.length==0)return;let d=c!=null?c.id():null,h=[],S=t!=null&&i!=null?zn.forNoodle(t,i,a):zn.getDefaultExternalExecution(),f=new Gn(3,En.ROOT_STABLE_PATH(),new Cn(d,u),new Cn(e,h),S.interactionAddress,S.canvasSpaceTriggerBoundsOrNull,S.transitionParameters,r,o),y=null;switch(n){case 0:{y=this._changeHistory;break}case 1:{y=nn.FrozenList_cloneAndAppendOne(this._changeHistory,f);break}case 2:{y=[f].slice();break}}let v=!1,b=l,m=c;if(l!=null&&c!=null&&(b=l.findNearestAncestorSectionOrNull(),m=c.findNearestAncestorSectionOrNull(),v=b!=null&&m!=null),v){let _=this._getStateMachineOrNull(new wt([b.id()]));if(_==null||this._shouldDisableNewChangesInStateMachine(_))return;_.clearInitiatedChangesInSelfAndSubstates();let T=null;switch(n){case 0:{T=_.changeHistory();break}case 1:{T=nn.FrozenList_cloneAndAppendOne(_.changeHistory(),f);break}case 2:{T=[f].slice();break}}if(this._requestAndSaveSectionStateChange(_,f,T,y),b!=m&&b.parent()==m){let N=new Gn(3,En.ROOT_STABLE_PATH(),new Cn(d,u),new Cn(b.id(),h),S.interactionAddress,S.canvasSpaceTriggerBoundsOrNull,S.transitionParameters,r,o),k=this._getStateMachineOrNull(new wt([m.id()]));if(k==null||this._shouldDisableNewChangesInStateMachine(k))return;switch(k.clearInitiatedChangesInSelfAndSubstates(),n){case 0:{T=k.changeHistory();break}case 1:{T=nn.FrozenList_cloneAndAppendOne(k.changeHistory(),N);break}case 2:{T=[N].slice();break}}this._saveSectionStateChange(k,N,T)}}else this._requestStateChange(f,y)}overlayFrame(e,t,n,r,o,i,a){var y;let s;if(!this._allowNewStateChanges()||this.getCurrentBaseScreenId()==null||t==null)return;this._clearInitiatedChangesBeforeNewChange();let c=i!=null?zn.forNoodle(t,i,a):zn.forExternalOpenOverlay(t),l=this.getCurrentOverlayData(),u=(y=this._appState.prototypeStructure())==null?void 0:y.getDestinationFrame(e);if(u==null){ze("tried to open to null overlay");return}let d=new Wa(u.id(),e,c.interactionAddress.hotspotStablePath,c.interactionAddress.interactionId,c.transitionParameters),h=this.getCurrentBaseScreenId(),S=new Gn(3,En.ROOT_STABLE_PATH(),new Cn(h,l),new Cn(h,nn.FrozenList_cloneAndAppendOne(l,d)),c.interactionAddress,c.canvasSpaceTriggerBoundsOrNull,c.transitionParameters,r,o);u.setUsedAsBaseScreen(!1);let f=nn.FrozenList_cloneAndAppendOne(this._changeHistory,S);this._requestStateChange(S,f)}resetSectionsState(){let e=this._appState.getActiveCanvas();if(e!=null){let t=e.findAllSectionsInNode();for(let n of t){let r=this._getStateMachineOrNull(new wt([n.id()]));r!=null&&r.resetHistoryToFirstFrameInSection(n)}}}resetPrototype(){let e;this._appState.scene()!=null&&(this._clearInitiatedChangesBeforeNewChange(),this._isResettingStateChangeMutations=!0,(e=x._prototypeLib)!=null&&e.resetLocalChanges(),this._initiatedInstanceChanges=new Map,this._isResettingStateChangeMutations=!1,this.resetSectionsState(),An.clearCachedNodePaths(),this.componentStateSyncer.handleRestartPrototype()),this._initiatedChange=null,this._initiatedHistory=null,this._changeHistory=[],this._tlfHistory=[],this._upcomingTlfs=new Set,this._actionCounter=this._actionCounter+1,this._lastInitiatedTopLevelStateChange=null,this._lastInitiatedInstanceStateChange=null}restartPrototype(e){var o;let t;if(this.logVerbose(()=>`[PrototypeState] restartPrototype started for ${xo[e]}`),this.resetPrototype(),this._observers.forEach(i=>{i.handleRestartPrototype()}),Q.getViewerMode()==Q.ViewerMode.MIRROR)return;if(((o=this._appState.scene())==null?void 0:o.findNode1(this._appState.activePrototypeStartingPointNodeId()))==null){let i=this._appState.prototypeStructure().activePrototypeStartNodeOrDefault();i!=null&&this._appState.setActivePrototypeStartingPointNodeId(i.id())}let r=this._appState.prototypeStructure().nodeToRestartPrototypeOn(this._appState.getActiveCanvas());r!=null&&(e==xo.FIX_INVALID_STATE&&(this._ongoingNavigateRepairsInvalidState=!0),this.navigateToFrameAndCloseOverlays1(r.id()),this.tryToInitiateRequestedStateChange(En.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW)),this.logVerbose(()=>`[PrototypeState] restartPrototype finished for ${xo[e]}`)}returnToState1(e){this.returnToState2(null,null,e,0,null,null)}returnToState2(e,t,n,r,o,i){var d;let a;if(!this._allowNewStateChanges()||this._changeHistory.length<=1)return;let s=n!=Ti.BEFORE_LAST_ANY_STATE,c=null;this._clearInitiatedChangesBeforeNewChange();let l=this._changeHistory.slice(),u=null;for(e!=null&&t!=null?u=zn.forNoodle(e,t,i):u=zn.getDefaultExternalExecution();l.length>1&&(s&&ie.List_last(l).isTransientChange());)c=l.pop();if(n==Ti.LAST_NONTRANSIENT_STATE||l.length<=1){((d=t==null?void 0:t.event())==null?void 0:d.interactionType())=="DRAG"&&this._returnToOverlayState(u,r,c==null?void 0:c.oldOverlayData(),c,l);return}for(c=ie.List_last(l);l.length>1;){let h=l.pop();if(l.length>1&&s&&ie.List_last(l).isTransientChange())continue;let f=h.oldStateId();if(R.equals(f,this.getCurrentBaseScreenId()))this._returnToOverlayState(u,r,h.oldOverlayData(),c,l);else{if(this._appState.prototypeStructure().validDestinationForPrototypeFromId(h.oldStateId())==null)continue;this._returnToFrame(f,u,r,c,l,o)}break}}_returnToFrame(e,t,n,r,o,i){var S;let a,s=(S=this._appState.prototypeStructure())==null?void 0:S.getDestinationFrame(e),c=r.transitionParameters.withStateManagementSettings(i),l=new Gn(4,En.ROOT_STABLE_PATH(),new Cn(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new Cn(e,[]),n,t.interactionAddress,1,c);if(s!=null)s.setUsedAsBaseScreen(!0);else{ze("tried to return to deleted frame");return}let u=!1,d=s.findNearestAncestorSectionOrNull(),h=this.getCurrentBaseScreenNode().findNearestAncestorSectionOrNull();if(d!=null&&h!=null){if(d==h||d==h.parent()){let f=this._getStateMachineOrNull(new wt([d.id()])),y=ie.List_last(f.changeHistory()),v=nn.FrozenList_cloneAndRemoveOne(f.changeHistory(),y);this._requestAndSaveSectionStateChange(f,l,v,o),u=!0}else if(h==d.parent()){l=new Gn(4,En.ROOT_STABLE_PATH(),new Cn(this.getCurrentBaseScreenId(),this.getCurrentOverlayData()),new Cn(d.id(),[]),n,t.interactionAddress,1,r.transitionParameters);let f=this._getStateMachineOrNull(new wt([h.id()])),y=ie.List_last(f.changeHistory()),v=nn.FrozenList_cloneAndRemoveOne(f.changeHistory(),y);this._requestAndSaveSectionStateChange(f,l,v,o),u=!0}}u||this._requestStateChange(l,o)}_returnToOverlayState(e,t,n,r,o){var s;let i,a=this.getCurrentOverlayData();if(n.length<a.length)this._closeOverlayAtAndAbove(n.length,e.interactionAddress,e.canvasSpaceTriggerBoundsOrNull,t,o,0);else{for(let u=0,d=n.length;u<d;u=u+1){let h=(s=this._appState.prototypeStructure())==null?void 0:s.getDestinationFrame(n[u].id);if(h==null)break;h.setUsedAsBaseScreen(!1)}let c=this.getCurrentBaseScreenId(),l=new Gn(4,En.ROOT_STABLE_PATH(),new Cn(c,this.getCurrentOverlayData()),new Cn(c,n),t,e.interactionAddress,1,r.transitionParameters);this._requestStateChange(l,o)}}swapTopOverlay(e,t,n,r,o){var f;let i;if(!this._allowNewStateChanges())return;let a=this.getCurrentOverlayData(),s=this.getCurrentBaseScreenId();if(s==null||a.length==0)return;this._clearInitiatedChangesBeforeNewChange();let c=(f=this._appState.prototypeStructure())==null?void 0:f.getDestinationFrame(e),l=a.slice();ie.List_setLast(l,ie.List_last(l).cloneWithId(c.id()));let u=null,d=0;t!=null&&r!=null?(u=zn.forNoodle(t,r,o),d=qt.TransitionAction_fromInteractionType(r.event().interactionType())):(u=zn.getDefaultExternalExecution(),d=0);let h=new Gn(3,En.ROOT_STABLE_PATH(),new Cn(s,a),new Cn(s,l),u.interactionAddress,u.canvasSpaceTriggerBoundsOrNull,u.transitionParameters,0,d);if(c==null){ze("tried to swap to null overlay");return}c.setUsedAsBaseScreen(!1);let S=nn.FrozenList_cloneAndAppendOne(this._changeHistory,h);this._requestStateChange(h,S)}_clearInitiatedChangesBeforeNewChange(){this._disableNewStateChanges=!0,this._appState.scene()!=null&&this._forEachTransitioningStateMachine(e=>{let t=this._getStateMachineOrNull(e);return t!=null&&t.clearInitiatedChangesInSelfAndSubstates(),Se.Loop.CONTINUE}),this._initiatedChange!=null&&this.commitStateChange(),this._disableNewStateChanges=!1}_allowNewStateChanges(){return this.interactionsEnabled()&&!this._disableNewStateChanges}abortStateChange(){if(this._initiatedChange==null)return;let e=this._initiatedChange;this._initiatedChange=null,this._initiatedHistory=null,this._broadcastStateChange(e,2,null),this._enforceValidPrototypeState()}commitStateChange(){if(this._initiatedChange==null)return;let e=this._initiatedChange;this._changeHistory=this._initiatedHistory,this._initiatedChange=null,this._initiatedHistory=null,this.logVerbose(()=>`[PrototypeState] commitTopLevelChange ${e.debugString(this._appState.scene())}`);let t=[],n=r=>{t.push(r)};if(this._broadcastStateChange(e,3,n),this._allowNewStateChanges())for(let r of t)r();Q.isInlinePreview()||this._enforceValidPrototypeState()}_enqueueUpcomingTlfs(){let e=this.getCurrentBaseScreenNode();if(e==null)return;let t=Ft.adjacentBaseScreens(this._appState.prototypeStructure().nodeTransitionTracker().cleanedUpTransitionMapByTLF(),e);for(let n of t.asList())this._upcomingTlfs.add(R.toString(n));this._shouldNotifyNavigationInfoInvalidated=!0,this._enqueueUpcomingTlfsDeadline=0}_getUpcomingTlf(){for(;this._upcomingTlfs.size>0;){let e=Ft.visuallySortLayersLeftToRightAndTopToBottom2(this._appState.scene(),Array.from(this._upcomingTlfs.values()).map(t=>R.fromString(t)))[0];if(this._appState.prototypeStructure().topLevelPrototypeNodesInOrder().indexOf(e)>=0){this._upcomingTlfs.delete(e);continue}return this._appState.scene().findNode2(e)==null?null:R.fromString(e)}return null}setForceInitiateStateChangeForTests(e){this._forceInitiateStateChangeForTests=e}_requestStateChange(e,t){this._broadcastStateChange(e,0,null),this._requestedStateChange=new En.StateChangeRequest(e,t),this._requestedStateChangeAtMs=We.milliseconds(),this._emitter.trigger("requestedStateChange",{}),this._disableNewStateChanges=!0,this.tryToInitiateRequestedStateChange(En.InitiateRequestedStateChangePolicy.WAIT_UNTIL_DESTINATIONS_LOADED)}_requestAndSaveSectionStateChange(e,t,n,r){this._appState.scene()!=null&&(e.stage(t,n),this._requestStateChange(t,r),R.equals(t.oldStateId(),t.newStateId())||this.commitSectionStateChange(e))}_saveSectionStateChange(e,t,n){this._appState.scene()!=null&&(e.stage(t,n),R.equals(t.oldStateId(),t.newStateId())||this.commitSectionStateChange(e))}tryToInitiateRequestedStateChange(e){this._requestedStateChange!=null&&(this._forceInitiateStateChangeForTests||e==En.InitiateRequestedStateChangePolicy.FORCE_INITIATE_NOW?this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history):this._requestedStateChange.change.newStateAndOverlays.statesAndOverlaysIncluded().asList().every(r=>{var a;let o,i=(a=this._appState.scene())==null?void 0:a.findNode2(r);return i==null?!1:i.hasBeenLoaded()})&&this._initiateStateChange(this._requestedStateChange.change,this._requestedStateChange.history))}_maybeTrackStateChangeInitiated(e){let t=e.newStateAndOverlays.statesAndOverlaysIncluded();for(let n of t.asList())this._visitedScreenIds._in(n)||this._visitedScreenIds.add(n);if(this._requestedStateChangeAtMs>0){let n=We.milliseconds()-this._requestedStateChangeAtMs;n>100&&Je.trackEvent1("viewer_reached_unloaded_frame",new Map([["prototypeType",oi[this._appState.prototypeStructure().currentType()]],["incrementalFrameLoading",!0],["timeWaitedForLoadingMs",n]]))}}_initiateStateChange(e,t){this._disableNewStateChanges=!0;for(let o of e.getRemovedFrameIds())this._forEachMaterializedStateInTlf(o,i=>i.changeHistory().length>0&&ie.List_last(i.changeHistory()).isTransientChange()?(this.returnInstanceToState(i.stablePath,Ti.LAST_NONTRANSIENT_STATE,0),i.clearInitiatedChangesInSelfAndSubstates(),Se.Loop.SKIP):Se.Loop.CONTINUE);this._emitter.trigger("requestedStateChangeInitiated",{}),this._maybeTrackStateChangeInitiated(e),this._requestedStateChange=null,this._requestedStateChangeAtMs=-1,this._disableNewStateChanges=!1,this._initiatedChange=e,this._initiatedHistory=t;let n=e.newStateId();this._tlfHistory.indexOf(R.toString(n))<0&&ie.List_appendOne(this._tlfHistory,R.toString(n)),this._shouldNotifyNavigationInfoInvalidated=!0,this.logVerbose(()=>`[PrototypeState] initiateTopLevelChange ${e.debugString(this._appState.scene())}`),this._lastInitiatedTopLevelStateChange=e,this._actionCounter=this._actionCounter+1,this._broadcastStateChange(e,1,null),(e==null?void 0:e.oldStateId())!=(e==null?void 0:e.newStateId())&&(this._ongoingNavigateRepairsInvalidState=!1),e.direction==1&&e.transitionParameters.transitionType=="INSTANT_TRANSITION"&&this.commitStateChange(),this._deferEnqueueUpcomingTlfs()}lastInitiatedTopLevelStateChange(){return this._lastInitiatedTopLevelStateChange}_broadcastStateChange(e,t,n){let r=this._isNotifyingStateChangeObservers;switch(r&&ze("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,t){case 0:{this._observers.forEach(o=>{o.handleStateChangeRequested(e)});break}case 1:{this._observers.forEach(o=>{o.handleStateChangeInitiated(e)});break}case 2:{this._observers.forEach(o=>{o.handleStateChangeAborted(e)});break}case 3:{this._observers.forEach(o=>{o.handleStateChangeCommitted(e,n)});break}}this._isNotifyingStateChangeObservers=r}debugHSMTree(){Q.getFeatureFlags().prototypeStateManagement&&(console.log("== Component SST =="),console.log(this.componentStateSyncer.debugString()),console.log("== Component HSM ==")),console.log(this._hsmRoot.debugHierarchy(this._appState.scene()))}addHsmObserver(e){this._hsmObservers.add(e)}removeHsmObserver(e){this._hsmObservers.remove(e)}_getStateMachineOrNull(e){let t=e==null?void 0:e.guids;if(t==null)return null;let n=this._hsmRoot;for(let r of t){if(n==null)break;n=n.childOrNull(r)}return n}getStateMachineOrNull(e){return this._getStateMachineOrNull(e)}_getStateMachineOrNullWithString(e){return this._getStateMachineOrNull(wt.fromString(e))}_getParentStateMachineOrNull(e){return e.guids.length==0?null:this._getStateMachineOrNull(e.slice2(0,e.guids.length-1))}_forMaterializedStateMachineAndDescendants(e,t){var i;let n,o=[this._getStateMachineOrNull(e)];for(;o.length>0;){let a=o.pop();if(a!=null){let s=((i=this._appState.scene())==null?void 0:i.findNode3(a.stablePath))==null,c=0;s?a==this._hsmRoot?c=Se.Loop.CONTINUE:c=Se.Loop.SKIP:c=t(a);let l=!1;switch(c){case Se.Loop.BREAK:{l=!0;break}case Se.Loop.CONTINUE:{ie.List_append2(o,a.getChildren());break}case Se.Loop.SKIP:continue}if(l)break}}}createOrRepairStateMachinesForInsertedSubtree(e){Se.forEachNode2(e,t=>{var r;let n;if(t.isInstance()){let o=(r=t.symbolID())!=null?r:R.invalid();R.isValid(o)||console.warn("Unexpected null symbolData for instance in instance generation"),this.createOrRepairInstanceStateMachineIfNeeded(t,o)}else t.type()=="SECTION"&&this.createOrRepairSectionStateMachineIfNeeded(t,t.id())})}createOrRepairSectionStateMachineIfNeeded(e,t){let n=this._getParentStateMachineOrNull(e.stablePath());if(n==null){ze("Could not create or repair state machine for section with null parent");return}let r=ie.List_last(e.stablePath().guids),o=n.childOrNull(r);if(o!=null)if(R.equals(o.stateId(),t)){this._isResettingStateChangeMutations&&o.resetHistoryToFirstFrameInSection(e);return}else o.initiatedChange()!=null&&this.commitSectionStateChange(o);n.setChild(r,new Bs(this,e,t,!0))}createOrRepairInstanceStateMachineIfNeeded(e,t){let n=this._getParentStateMachineOrNull(e.stablePath());if(n==null){ze("Could not create or repair state machine with null parent");return}let r=ie.List_last(e.stablePath().guids),o=n.childOrNull(r);if(o!=null){if(R.equals(o.stateId(),t)){this._isResettingStateChangeMutations&&o.resetHistoryToState(t);return}else if(o.initiatedChange()!=null){if(this.isApplyingStateChangeMutation())return;this.commitInstanceStateChange(o)}}n.setChild(r,new Bs(this,e,t))}actionCounterForState(e){let t=this._getStateMachineOrNull(e);return t==null?-1:t.actionCounter}actionCountersForStateAndAncestors(e){let t=[this.actionCounter()];for(let n=0,r=e.guids.length;n<r;n=n+1)t.push(this.actionCounterForState(e.slice2(0,n+1)));return t}getStateMachineInitiatedChange(e){let t=this._getStateMachineOrNull(e);return t==null?void 0:t.initiatedChange()}getStateMachineLastChangeInHistory(e){let t=this._getStateMachineOrNull(e);return t==null||t.changeHistory().length==0?null:t!=null?ie.List_last(t.changeHistory()):null}getLastFrameOrSectionVisitedInSection(e){if(e==null)return null;let t=this.getStateMachineLastChangeInHistory(new wt([e]));return t!=null?t.newStateAndOverlays.stateId:null}getState(e){let t=this._getStateMachineOrNull(e);return t==null?void 0:t.stateId()}_forEachMaterializedStateInTlf(e,t){var o;let n,r=(o=this._appState.scene())==null?void 0:o.findNode1(e);r==null||!r.isTopLevel()||Se.forEachNode1(r,i=>{if(i.isInstance()){let a=this._getStateMachineOrNull(i.stablePath());if(a!=null)return t(a)}return Se.Loop.CONTINUE})}_forEachTransitioningStateMachine(e){for(let t of Array.from(this._initiatedInstanceChanges.keys()))if(Array.from(this._initiatedInstanceChanges.keys()).indexOf(t)!=-1){let n=this._initiatedInstanceChanges.get(t);if(e(n.stablePath)==Se.Loop.BREAK)break}}getOnscreenStates(){let e=[],t=this.getLayersIds();for(let n of t)this._forEachMaterializedStateInTlf(n,r=>{if(2==0){let o=this._appState.scene().findNode3(r.stablePath)}return e.push(new Ir(r.stablePath,r.stateId())),Se.Loop.CONTINUE});return e}forMaterializedStateInstanceAndDescendants(e,t){this._forMaterializedStateMachineAndDescendants(e,n=>t(n.stablePath))}_deferEnqueueUpcomingTlfs(){this._enqueueUpcomingTlfsDeadline=We.milliseconds()+(Si?0:250)}lastInitiatedInstanceStateChange(){return this._lastInitiatedInstanceStateChange}_forStateMachineAndParents(e,t){let n=e.guids,r=[],o=this._hsmRoot,i=0;for(;o!=null&&i<n.length;)o=o.childOrNull(n[i]),o!=null&&r.push(o),i=i+1;if(!(r.length==0||!wt.equals(ie.List_last(r).stablePath,e))){for(let a=r.length-1;a>=0;a=a-1)if(t(r[a])==Se.Loop.BREAK)return}}_shouldDisableNewChangesInStateMachine(e){var o;let t,n=(o=this._appState.scene())==null?void 0:o.findNode3(e.stablePath);if(n==null)return!0;let r=n;for(;r!=null;){let i=this._getStateMachineOrNull(r.stablePath());if(i!=null&&i.isClearingChangesInSelfAndSubstates())return!0;r=r.parent()}return!1}swapInstanceToState1(e,t,n,r,o,i){this.swapInstanceToState2(e,t,n,r,o,i,null)}swapInstanceToState2(e,t,n,r,o,i,a){this.logVerbose(()=>`[HSM] >>>>>>>> swap instance ${e} to state -> ${R.toString(t)} cause: ${Pn[r]}`);let s=this._getStateMachineOrNull(e);if(s==null||this._shouldDisableNewChangesInStateMachine(s)||this._validatedStateSwapDestination(s.stateId(),t)==null)return;s.clearInitiatedChangesInSelfAndSubstates();let l=n!=null&&o!=null?zn.forNoodle(n,o,a):zn.getDefaultExternalExecution(),u=new Gn(2,s.stablePath,s.stateId(),t,l.interactionAddress,l.canvasSpaceTriggerBoundsOrNull,l.transitionParameters,r),d=null;switch(i){case 0:{d=s.changeHistory();break}case 1:{d=nn.FrozenList_cloneAndAppendOne(s.changeHistory(),u);break}case 2:{d=[u].slice();break}}let h=this._shouldDisallowSwap(e,t);h==1?this._onStateSwapFailedDueToCycle():h==0&&this._requestInstanceStateChange(s,u,d)}returnInstanceToState(e,t,n){this.logVerbose(()=>`[HSM] >>>>>>>> return instance ${e} to previous state cause: ${Pn[n]}`);let r=this._getStateMachineOrNull(e);if(r==null||this._shouldDisableNewChangesInStateMachine(r)||(r.clearInitiatedChangesInSelfAndSubstates(),r.changeHistory().length<=1))return;let o=r.cloneHistoryForReturnToState(t,(u,d)=>this._validatedStateSwapDestination(u,d)),i=o.a,a=o.b,s=this._validatedStateSwapDestination(r.stateId(),ie.List_last(a).newStateId());if(s==null)return;let c=new Gn(2,r.stablePath,r.stateId(),s.id(),i.interactionAddress,i.canvasSpaceTriggerBoundsOrNull,i.transitionParameters,n),l=this._shouldDisallowSwap(r.stablePath,s.id());l==1?this._onStateSwapFailedDueToCycle():l==0&&this._requestInstanceStateChange(r,c,a)}_requestInstanceStateChange(e,t,n){this._forMaterializedStateMachineAndDescendants(e.stablePath,o=>o!=e&&o.changeHistory().length>0&&ie.List_last(o.changeHistory()).isTransientChange()?(this.returnInstanceToState(o.stablePath,Ti.LAST_NONTRANSIENT_STATE,0),o.clearInitiatedChangesInSelfAndSubstates(),Se.Loop.SKIP):Se.Loop.CONTINUE);let r=this._appState.scene();if(r!=null){e.stage(t,n),this._initiatedInstanceChanges.set(e.stablePath.toString(),t),this._lastInitiatedInstanceStateChange=t;let o=this._appState.scene().findNode3(t.interactionAddress.hotspotStablePath),i=new Map,a=null;this._isApplyingStateChangeMutation=!0,e.broadcastHsmStateChange(this._hsmObservers,t,0,null),r.dangerouslyDeferNodeRemovalScope(()=>{let l=this._getFullscreenNodeChangesForStateSwap(e.stablePath,t.newStateId(),0);for(let u of l.cloneOps)u.clone.copyNodeCachedTransformAndBounds(u.source),i.set(u.source,u.clone);a=this._appState.scene().findNode3(l.transitionRootStablePath)});let s=Vs.Map_getOrDefault(i,o,null),c=Vs.Map_getOrDefault(i,a,null);a!=null&&c!=null?a.transitioningFrom=new Yl(c,t.stablePath,s):ze("Failed to find swapped out node after state swap"),R.equals(t.oldStateId(),t.newStateId())||(this._forEachTransitioningStateMachine(l=>{if(!wt.equals(t.stablePath,l)){let u=r.findNode3(l);if(a!=null&&a.isAncestorOf(u)){let d=this._getStateMachineOrNull(l);this.commitInstanceStateChange(d)}}return Se.Loop.CONTINUE}),this._deferEnqueueUpcomingTlfs()),this._isApplyingStateChangeMutation=!1}e.actionCounter=e.actionCounter+1,e.broadcastHsmStateChange(this._hsmObservers,t,1,null),this.logVerbose(()=>`[HSM] initiate ${R.toString(t.oldStateId())} -> ${R.toString(t.newStateId())} finished for ${e.stablePath} -- ${t.transitionParameters.transitionType} !`)}commitChangesBelowStablePath(e){var o,i;let t,n,r=(o=this._appState.scene())==null?void 0:o.findNode3(e);for(let a of Array.from(this._initiatedInstanceChanges.keys())){let s=this._initiatedInstanceChanges.get(a),c=this._getStateMachineOrNull(s.stablePath);c!=null&&r!=null&&r.isAncestorOf((i=this._appState.scene())==null?void 0:i.findNode3(c.stablePath))&&this.commitInstanceStateChange(c)}}commitChangesBelowInstanceTransitionRoot(e){let t=this._findTransitionRootForSwappedPath(e),n=t==null?e:t.stablePath();this.commitChangesBelowStablePath(n)}commitInstanceStateChange(e){if(e.initiatedChange()==null)return;let t=e.initiatedChange();e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null),this._initiatedInstanceChanges.delete(e.stablePath.toString()),R.equals(t.oldStateId(),t.newStateId())||this._finishStateSwapMutation(t.stablePath);let n=[],r=o=>{n.push(o)};if(e.broadcastHsmStateChange(this._hsmObservers,t,3,r),!e.isClearingChangesInSelfAndSubstates())for(let o of n)o();this.logVerbose(()=>`[HSM] commit ${R.toString(t.oldStateId())} -> ${R.toString(t.newStateId())} finished for ${t.stablePath} -- ${t.transitionParameters.transitionType} !`)}commitSectionStateChange(e){e.initiatedChange()!=null&&(e.setChangeHistory(e.initiatedChangeHistory()),e.stage(null,null))}abortInstanceStateChange(e){let t=this._getStateMachineOrNull(e);if(t==null||t.initiatedChange()==null)return;let n=t.initiatedChange();if(this._appState.scene()!=null){t.stage(null,null),this._initiatedInstanceChanges.delete(t.stablePath.toString());let o=this._findTransitionRootForSwappedPath(e),i=o.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,o.transitioningFrom=null,i.removeSelfAndSubtree(),t.broadcastHsmStateChange(this._hsmObservers,n,0,null),this._getFullscreenNodeChangesForStateSwap(t.stablePath,n.oldStateId(),1),this._isApplyingStateChangeMutation=!1}t.broadcastHsmStateChange(this._hsmObservers,n,2,null),this.logVerbose(()=>`[HSM] abort ${R.toString(n.oldStateId())} -> ${R.toString(n.newStateId())} finished for ${t.stablePath} -- ${n.transitionParameters.transitionType} !`)}_validatedStateSwapDestination(e,t){var c,l;let n,r,o=(c=this._appState.scene())==null?void 0:c.findNode1(e),i=o==null?void 0:o.parent();if((o==null?void 0:o.type())!="SYMBOL"||i==null||!i.isStateGroup())return null;let a=(l=this._appState.scene())==null?void 0:l.findNode1(t),s=a==null?void 0:a.parent();return(a==null?void 0:a.type())!="SYMBOL"||s==null||!s.isStateGroup()||R.equals(e,t)?null:R.equals(i.id(),s.id())?a:null}isApplyingStateChangeMutation(){return this._isApplyingStateChangeMutation}isResettingStateChangeMutations(){return this._isResettingStateChangeMutations}_findTransitionRootForSwappedPath(e){var r;let t,n=(r=this._appState.scene())==null?void 0:r.findNode3(e);for(;n!=null;){if(n.transitioningFrom!=null&&n.transitioningFrom.swappedStablePath==e)return n;n=n.parent()}return null}_finishStateSwapMutation(e){let t=this._findTransitionRootForSwappedPath(e);if(this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation started for ${e}`),t==null)return;let n=t.transitioningFrom.exitingTransitionRoot;this._isApplyingStateChangeMutation=!0,t.transitioningFrom=null,n.removeSelfAndSubtree(),this._isApplyingStateChangeMutation=!1,t.invalidateRenderTreeForSelfAndParents(),t.invalidateRenderTreeForChildren(),this.logVerbose(()=>`[PrototypeState] _finishStateSwapMutation finished for ${e}`)}_getFullscreenNodeChangesForStateSwap(e,t,n){return x._prototypeLib.getNodeChangesForSwap(e,t,n)}_shouldDisallowSwap(e,t){return x._prototypeLib.shouldDisallowSwap(e,t)}logVerbose(e){this.VERBOSE_LOGS&&(this.debugHSMTree(),console.log(e()))}};(n=>{class g{constructor(o,i){this.change=o,this.history=i}}n.StateChangeRequest=g;let e;(i=>(i[i.WAIT_UNTIL_DESTINATIONS_LOADED=0]="WAIT_UNTIL_DESTINATIONS_LOADED",i[i.FORCE_INITIATE_NOW=1]="FORCE_INITIATE_NOW"))(e=n.InitiateRequestedStateChangePolicy||(n.InitiateRequestedStateChangePolicy={}));let t;(o=>{function r(i){return n.InitiateRequestedStateChangePolicy[i]}o.InitiateRequestedStateChangePolicy_toString=r})(t=n.in_InitiateRequestedStateChangePolicy||(n.in_InitiateRequestedStateChangePolicy={}))})(En||(En={}));var xo=(t=>(t[t.FIX_INVALID_STATE=0]="FIX_INVALID_STATE",t[t.USER_REQUESTED=1]="USER_REQUESTED",t))(xo||{}),Ti=(n=>(n[n.LAST_NONTRANSIENT_STATE=0]="LAST_NONTRANSIENT_STATE",n[n.BEFORE_LAST_NONTRANSIENT_STATE=1]="BEFORE_LAST_NONTRANSIENT_STATE",n[n.BEFORE_LAST_ANY_STATE=2]="BEFORE_LAST_ANY_STATE",n))(Ti||{}),vr=(a=>(a[a.NONE=0]="NONE",a[a.CONTAIN=1]="CONTAIN",a[a.SCALE_DOWN=2]="SCALE_DOWN",a[a.MIN_ZOOM=3]="MIN_ZOOM",a[a.FREE=4]="FREE",a[a.SCALE_DOWN_TO_FIT_WIDTH=5]="SCALE_DOWN_TO_FIT_WIDTH",a[a.FIT_WIDTH=6]="FIT_WIDTH",a))(vr||{});var Vd=class{handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){this.callback(e)}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}constructor(e){this.callback=e}},Bs=class{constructor(){if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this.stablePath=null,this._changeHistory=null,this._initiatedChange=null,this._initiatedChangeHistory=null,this._isNotifyingStateChangeObservers=!1,this.actionCounter=0,this._children=new Map,this._isClearingChangesInSelfAndSubstates=!1,this._prototypeState=null,this._prototypeState=e,this.stablePath=t.stablePath(),this.resetHistoryToState(n)}else if(arguments.length==1){let e=arguments[0];this.stablePath=null,this._changeHistory=null,this._initiatedChange=null,this._initiatedChangeHistory=null,this._isNotifyingStateChangeObservers=!1,this.actionCounter=0,this._children=new Map,this._isClearingChangesInSelfAndSubstates=!1,this._prototypeState=null,this._prototypeState=e,this.stablePath=new wt([]),this.setChangeHistory([])}else if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this.stablePath=null,this._changeHistory=null,this._initiatedChange=null,this._initiatedChangeHistory=null,this._isNotifyingStateChangeObservers=!1,this.actionCounter=0,this._children=new Map,this._isClearingChangesInSelfAndSubstates=!1,this._prototypeState=null,this._prototypeState=e,this.stablePath=t.stablePath(),r?this.resetHistoryToFirstFrameInSection(t):this.resetHistoryToState(n)}}changeHistory(){return this._changeHistory}setChangeHistory(e){this._changeHistory=e}debugHierarchy(e){return this._debugHierarchy(0,e)}_debugHierarchy(e,t){var p,_,T,N;let n,r,o,i,a,s,c,l,u="";for(let k=0,j=e;k<j;k=k+1)u+="  ";u+=this.stablePath.toString()+": ";let d="missing state name",h="(N/A)";if(this.stateId()!=null){let k=t.findNode1(this.stateId());k!=null&&(d=(p=k.name())!=null?p:"null state name"),h="("+R.toString(this.stateId())+")"}u+="<"+d+" "+h+">";let S="[",f=0,y=3,v=this.changeHistory();v.length>y&&(S+="..., ",f=v.length-y);for(let k=f,j=v.length;k<j;k=k+1){let te=v[k];S+=`${(_=(c=te.oldStateId())!=null?R.toString(c):null)!=null?_:"null"}->${(a=te.newStateId())!=null?R.toString(a):null}`,k!=v.length-1&&(S+=", ")}S+="]",u+=" "+S;let b=t.findNode3(this.stablePath);if(b!=null){let k=(T=b.name())!=null?T:"null node name";u+=" "+k}let m=this.initiatedChange()!=null?`{${(N=(o=this.initiatedChange().oldStateId())!=null?R.toString(o):null)!=null?N:"null"}->${(n=this.initiatedChange().newStateId())!=null?R.toString(n):null}}`:"";u+=" "+m+`
`;for(let k of Array.from(this._children.values()))u+=k._debugHierarchy(e+1,t);return u}removeChild(e){this._children.delete(R.toString(e))}setChild(e,t){this._children.set(R.toString(e),t)}childOrNull(e){return Me.StringMap_get(this._children,R.toString(e),null)}getChildren(){return Array.from(this._children.values())}stage(e,t){this._initiatedChange=e,this._initiatedChangeHistory=t}initiatedChange(){return this._initiatedChange}initiatedChangeHistory(){return this._initiatedChangeHistory}stateId(){var r,o;let e,t;if(((r=this.initiatedChange())==null?void 0:r.newStateId())!=null)return(o=this.initiatedChange())==null?void 0:o.newStateId();let n=this.changeHistory();return n!=null&&n.length>0?ie.List_last(n).newStateId():R.invalid()}clearInitiatedChangesInSelfAndSubstates(){this._isClearingChangesInSelfAndSubstates=!0,this._prototypeState.commitChangesBelowInstanceTransitionRoot(this.stablePath),this._isClearingChangesInSelfAndSubstates=!1}isClearingChangesInSelfAndSubstates(){return this._isClearingChangesInSelfAndSubstates}cloneHistoryForReturnToState(e,t){let n=e!=2,r=null,o=this.changeHistory().slice();for(;o.length>1&&(n&&ie.List_last(o).isTransientChange());)r=o.pop();if(e==0||o.length<=1)return new Ir(r,o);for(r=ie.List_last(o);o.length>1;){let i=o.pop();if(!(o.length>1&&n&&ie.List_last(o).isTransientChange()||t(i.newStateId(),i.oldStateId())==null))break}return new Ir(r,o)}resetHistoryToState(e){let t=new Gn(2,this.stablePath,null,e,Xr.EXTERNAL,null,In.getDefault(),0);this.setChangeHistory([t].slice())}resetHistoryToFirstFrameInSection(e){let t=Ft.visuallySortedTopLevelFrames(e);if(t.length>0){let n=t[0];if(n!=null){let r=new Gn(2,this.stablePath,null,n.id(),Xr.EXTERNAL,null,In.getDefault(),0);this.setChangeHistory([r].slice())}}else this.setChangeHistory([].slice())}broadcastHsmStateChange(e,t,n,r){let o=this._isNotifyingStateChangeObservers;switch(o&&console.warn("[PrototypeState] An observer performed a prototype state change while another state change was still being broadcasted."),this._isNotifyingStateChangeObservers=!0,n){case 0:{e.forEach(i=>{i.handleHsmRequested(this.stablePath,t)});break}case 1:{e.forEach(i=>{i.handleHsmInitiated(this.stablePath,t)});break}case 2:{e.forEach(i=>{i.handleHsmAborted(this.stablePath,t)});break}case 3:{e.forEach(i=>{i.handleHsmCommitted(this.stablePath,t,r)});break}}this._isNotifyingStateChangeObservers=o}},om;(e=>{function g(t){return sm[t]}e.StateChangePhase_toString=g})(om||(om={}));var im;(e=>{function g(t){return xo[t]}e.RestartCause_toString=g})(im||(im={}));var am;(e=>{function g(t){return Ti[t]}e.ReturnTo_toString=g})(am||(am={}));var aa;(n=>{function g(r,o){return r!=1&&r!=2&&r!=5&&r!=6&&!(r==3&&o)}n.FitMode_userCanManuallyZoom=g;function e(r){return r!=1&&r!=2&&r!=0&&r!=4}n.FitMode_topLevelFramesCanScroll=e;function t(r){return vr[r]}n.FitMode_toString=t})(aa||(aa={}));var Bd=class{activate(e){this.reset(),this._isEnabled=!0,this._invalidateFn=e}deactivate(){!this.isEnabled()||(this._invalidateFn(),this.reset())}isEnabled(){return this._isEnabled}reset(){this._isPlaying=!1,this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._framesUntilUpdate=this._frameDelay,this._filteredTree=null,this._invalidateFn=null,this._frameDelay=this._defaultFrameDelay}play(){!this.isEnabled()||(this._isPlaying=!0,this._invalidateFn())}pause(){!this.isEnabled()||(this._isPlaying=!1)}forward(){!this.isEnabled()||(this._maxLayersToRender=Math.min(this._maxLayersToRender+1,this._totalLayersInRenderTree),this._invalidateFn())}backward(){!this.isEnabled()||(this._maxLayersToRender=Math.max(this._maxLayersToRender-1,1),this._invalidateFn())}rewind(){!this.isEnabled()||(this._maxLayersToRender=1,this._invalidateFn())}increaseSpeed(){!this.isEnabled()||(this._frameDelay=Math.max(this._minFrameDelay,this._frameDelay-5))}decreaseSpeed(){!this.isEnabled()||(this._frameDelay=Math.min(this._maxFrameDelay,this._frameDelay+5))}finishLayerByLayerDrawToScreen(){!this.isEnabled()||!this._isPlaying||this._maxLayersToRender>=this._totalLayersInRenderTree||(this._invalidateFn(),this._framesUntilUpdate=this._framesUntilUpdate-1,this._framesUntilUpdate<=0&&(this._maxLayersToRender=this._maxLayersToRender+1,this._framesUntilUpdate=this._frameDelay))}_filterCompositeTileGridNodes(e){switch(e.op()){case 0:{let t=e;return new ci(this._filterCompositeTileGridNodes(t.child),t.flags)}case 2:{let t=e;return new co(this._filterCompositeTileGridNodes(t.child))}case 1:{let t=e,n=[];for(let r=0,o=t.children.length;r<o;r=r+1){let i=this._filterCompositeTileGridNodes(t.children[r]);n.push(i)}return new Ue(n,t.isFirstChildSolidBackground())}case 3:case 4:return e;case 5:{let t=e,n=this._filterCompositeTileGridNodes(t.alpha),r=this._filterCompositeTileGridNodes(t.color);return new fn(n,r,t.type,t.innerShadowFill,t.innerShadowAlphaRequiresHardMask)}case 6:{let t=e;return new Ar(t.radius,this._filterCompositeTileGridNodes(t.child),t.clamp)}case 7:{let t=e;return new xr(t.blendMode,t.opacity,this._filterCompositeTileGridNodes(t.child))}case 9:{let t=e;return new Dr(this._filterCompositeTileGridNodes(t.alpha),t.color)}case 8:{let t=e;return this._filterCompositeTileGridNodes(t.tree)}case 10:{let t=e;return new et(this._filterCompositeTileGridNodes(t.child),t.id,t.property,t.getter)}case 11:{let t=e;return new qo(this._filterCompositeTileGridNodes(t.child),t.transform)}case 12:{let t=e,n=this._filterCompositeTileGridNodes(t.startChild),r=this._filterCompositeTileGridNodes(t.endChild);return new Jn(n,r,t.id,t.progressFn)}default:throw new Error(`Unhandled node op ${sr[e.op()]}`)}return null}_renderTreeWithNLayers(e,t){let n=(i,a)=>new Ir(i,a);if(t<=0)return n(null,0);let r=[];switch(e.op()){case 0:{let i=e;r.push(i.child);break}case 2:{let i=e;r.push(i.child);break}case 1:{let i=e;for(let a=0,s=i.children.length;a<s;a=a+1){let c=i.children[a];r.push(c)}break}case 3:case 4:return n(e,t-1);case 5:{let i=e;r.push(i.color),r.push(i.alpha);break}case 6:{let i=e;r.push(i.child);break}case 7:{let i=e;r.push(i.child);break}case 9:{let i=e;r.push(i.alpha);break}case 8:{let i=e;r.push(i.tree);break}case 10:{let i=e;r.push(i.child);break}case 11:{let i=e;r.push(i.child);break}case 12:{let i=e;r.push(i.startChild),r.push(i.endChild);break}default:throw new Error(`Unhandled node op ${sr[e.op()]}`)}let o=[];for(let i=0,a=r.length;i<a;i=i+1){let s=r[i],c=this._renderTreeWithNLayers(s,t);if(t=c.b,o.push(c.a),t<=0)return n(new Ue(o).optimized(),0)}return this._isRenderableLayer(e)?t>0?n(e,t-1):n(new Ue(o).optimized(),0):n(e,t)}_isRenderableLayer(e){switch(e.op()){case 8:case 1:case 0:return!1}return!0}_countLayers(e){let t=0;switch(e.op()){case 0:{let n=e;t=t+this._countLayers(n.child);break}case 2:{let n=e;t=t+this._countLayers(n.child);break}case 1:{let n=e;for(let r=0,o=n.children.length;r<o;r=r+1){let i=n.children[r];t=t+this._countLayers(i)}break}case 3:case 4:break;case 5:{let n=e;t=t+this._countLayers(n.alpha),t=t+this._countLayers(n.color);break}case 6:{let n=e;t=t+this._countLayers(n.child);break}case 7:{let n=e;t=t+this._countLayers(n.child);break}case 9:{let n=e;t=t+this._countLayers(n.alpha);break}case 8:{let n=e;t=t+this._countLayers(n.tree);break}case 10:{let n=e;t=t+this._countLayers(n.child);break}case 11:{let n=e;t=t+this._countLayers(n.child);break}case 12:{let n=e;t=t+this._countLayers(n.startChild),t=t+this._countLayers(n.endChild);break}default:throw new Error(`Unhandled node op ${sr[e.op()]}`)}return this._isRenderableLayer(e)&&(t=t+1),t}treeToRender(e){if(!this.isEnabled())return e;e!=this._originalTree&&(this._totalLayersInRenderTree=this._countLayers(e),this._filteredTree=this._filterCompositeTileGridNodes(e),this._originalTree=e);let t=this._renderTreeWithNLayers(this._filteredTree,this._maxLayersToRender).a;return t!=this._lastTreeToRender&&console.log(`LayerByLayerRendering: rendering ${this._maxLayersToRender} instructions out of ${this._totalLayersInRenderTree}
`+t.debugString1()),this._lastTreeToRender=t,t}constructor(){this._isEnabled=!1,this._maxLayersToRender=1,this._totalLayersInRenderTree=0,this._maxFrameDelay=60,this._defaultFrameDelay=45,this._minFrameDelay=5,this._frameDelay=60,this._framesUntilUpdate=0,this._filteredTree=null,this._originalTree=null,this._invalidateFn=null,this._isPlaying=!1,this._lastTreeToRender=null}};var Gs=(n=>(n[n.FULL_SIZE=0]="FULL_SIZE",n[n.THUMBNAIL=1]="THUMBNAIL",n[n.EMOJI=2]="EMOJI",n))(Gs||{}),vi=class{hash(){return`${this.image.objectHash()}:${Gs[this.purpose]}`}constructor(e,t){this.image=e,this.purpose=t}},pm=(t=>(t[t.TILE_WAS_EMPTY=0]="TILE_WAS_EMPTY",t[t.HAS_CONTENT=1]="HAS_CONTENT",t))(pm||{}),ks;(r=>{function g(){return new Map}r._new=g;function e(o,i){o.set(i.hash(),i)}r.add=e;function t(o){let i=o;return Array.from(i.values())}r.asList=t;function n(o,i){let a=i,s=o;Me.StringMap_each(a,(c,l)=>{s.set(c,l)})}r.addAllImagesInSet=n})(ks||(ks={}));var hm=class{needsMultipleAAPasses(){return this.status==1}constructor(e,t,n){this.includesBackgroundColor=e,this.status=t,this.neededImagesOrNull=n}},Ro=class{context(){return this._context}bufferPool(){return this._bufferPool}totalVRAM(){let e=0;return e=e+this._pathRasterizer.totalVRAM(),e=e+this._tileStack.totalVRAM(),e}upscaleRectForSSAA(e){let t=gn.SSAA_SIZE()/pn.TILE_SIZE|0;return e.scaledBy1(t)}downscaleRectForSSAA(e){let t=pn.TILE_SIZE/gn.SSAA_SIZE();return e.scaledBy1(t)}setBackgroundEnabled(e){this._backgroundEnabled=e}currentTextureSize(){return this._currentTile1().tileSize()}drawTile1(e,t,n,r,o,i,a,s,c){let l,u=(l=this._canvas)!=null?l.scene().findNode1(i):null;u==null&&(u=this._canvas);let d=u==this._canvas,h=u==this._canvas&&this._backgroundEnabled?this._canvas.computedBackgroundColor():E.TRANSPARENT,S=!1,f=new Ro.Options(u.renderTree1(),d,h,S,null,a,!1,s,c);return this.drawTile2(e,t,n,r,o,f)}markDidDraw(){this._didDraw=!0}pushSSAARenderState(e){let t;if(this._shouldDisableAllAntialiasing){ze("Pushing SSAA state during final composite");return}if(this._ssaaState.level==0){this._tileStack.setSSAARenderState(),this._ssaaState.mode=e==null?Us.PATHS_ONLY:Us.GROUP;let n=null;this._tileStack.isEmpty()||(n=this.upscaleRectForSSAA(C.FrozenScissors.last(this._currentTile1().scissors()).clone())),e!=null&&this._needsBackgroundColor(e)?(this.duplicateTile1(n),this._downsampleNeedsBlend=!0):(this._downsampleNeedsBlend=!1,this._tileStack.pushTileWithScissors1(n))}(t=this._ssaaState).level=t.level+1}popSSAARenderState(){let e;if(this._shouldDisableAllAntialiasing){ze("Popping SSAA state during final composite");return}if((e=this._ssaaState).level=e.level-1,this._ssaaState.level==0){let t=this._tileStack.popTile();this._tileStack.unsetSSAARenderState(),this._downsampleNeedsBlend?C.in_Context.Context_setCopyBlendState(this._context):C.in_Context.Context_setPremultipliedBlendState(this._context),this.downsampleSuperSSAATile(t),this._tileStack.freeTileToPool(t)}}supersampleState(){return this._ssaaState}currentTile(){return this._currentTile1()}computeTileTransform(){return ee.new2().scaledBy2(1/this._canvasSpaceTileBounds.size().x()).translatedBy1(new I(-this._canvasSpaceTileBounds.x(),-this._canvasSpaceTileBounds.y()))}canvasSpaceToViewSpaceScale(){return pn.TILE_SIZE/this._canvasSpaceTileBounds.size().x()}drawTile2(e,t,n,r,o,i){return this._context.annotateAndReturn(`Draw tile (${t}, ${n})`,()=>{let a=o.colorTexture().format(),s=i.shouldRenderDirectlyToOutputTexture;s&&(i.shouldDisableAllAntialiasing,a!=C.TextureFormat.RGBA_LINEAR_CLAMP&&o.colorTexture().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP)),this._requestImage=i.requestImage,this._boundsCache=i.boundsCache,this._canvasSpaceTileBounds=new B(t,n,r,r),this._shouldDisableAllAntialiasing=i.shouldDisableAllAntialiasing,this._neededImagesOrNull=i.shouldCollectNeededImages?ks._new():null;let c=this.computeTileTransform(),l=i.renderTree,u=new mm(l,c,i.backgroundClearColor);if(this._didDraw=!1,this._includesBackgroundColor=!1,this._includesBackgroundColor=l!=null&&this.nodeNeedsBackgroundColor(l,c),this._includesBackgroundColor){let h=E.premultiplied(i.backgroundClearColor);s?this._tileStack.pushTileBackedByExistingTextureSetAndClearToColor(o,e,i.outputTextureNeedsClear,h):this._tileStack.pushTileAndClearToColor(h)}else s?this._tileStack.pushTileBackedByExistingTextureSet(o,e,i.outputTextureNeedsClear):this._tileStack.pushTile1();if(l!=null){let h=this.allocateAndComputeTileScissor(c,this.bounds(l));this._tileStack.last().pushScissor2(h);let S=ee.new2();this.visit(l,ee.new3(c),S),this._tileStack.popScissorFromCurrentTile()}let d=this.drawTileFinish(u,e,o,s);return s&&a!=C.TextureFormat.RGBA_LINEAR_CLAMP&&o.colorTexture().setFormat(a),d})}setCanvas(e){this._canvas!=e&&(this._canvas=e,this._pathRasterizer.clearGradientCache())}drawToCurrentTile(e,t,n){let r=this._currentTile1().needsColorClear(),o=this._context.currentStencilState().isEnabled&&this._currentTile1().needsDepthStencilClear();if(r||o){let i=this._context.currentStencilState(),a=this._context.currentBlendState();this._context.setStencilState(C.StencilState.NONE),C.in_Context.Context_setCopyBlendState(this._context);let s=r&&o?C.Clear.ALL:r?C.Clear.COLOR:C.Clear.DEPTH_STENCIL;this._currentTile1().doDeferredClear(s),this._context.setStencilState(i),this._context.setBlendState(a)}this._context.draw(e,t,n),this._currentTile1().setIsColorClear(!1)}clear(e,t){this._context.setTextureSet(t);let n=this._context.graphicsCardName();if(tt.OS_current()==5||n=="Intel Iris Pro OpenGL Engine"||n=="Intel(R) Iris(TM) Graphics 6100"||n=="Intel(R) Iris(TM) Pro Graphics 6200"||n=="Intel Iris OpenGL Engine"||n=="Intel(R) HD Graphics 6000"||n=="Intel(R) HD Graphics 5300"||n=="Intel HD Graphics 5000 OpenGL Engine"||Q.getFeatureFlags().viewerWebGLClearWorkaround){let o=this._context.currentStencilState();C.in_Material.Material_setUniformVec42(this._clearOnWindowsMaterial,No,e),this._clearOnWindowsMaterial.setUniformFloat(wn,1),this._context.setStencilState(C.StencilState.NONE),C.in_Context.Context_setCopyBlendState(this._context),this._context.draw(C.Primitive.TRIANGLE_STRIP,this._clearOnWindowsMaterial,this._quadArea),this._context.setStencilState(o);return}this._context.clear2(C.Clear.COLOR,e)}_currentTile1(){return this._tileStack.last()}_currentTile2(e){return this._tileStack.get(this._tileStack.count()-e-1)}_needsBackgroundColor(e){return e.hasNonIsolatedBlends()||e.hasBackgroundBlurs()}bounds(e){return e.currentBounds(this._boundsCache)}nodeNeedsBackgroundColor(e,t){let n=B.new3(this.bounds(e));t.transformRect(n);let r=B.UNIT.overlaps(n);if(e==null||!this._needsBackgroundColor(e)||!r)return!1;if(e.op()==1){let o=e;for(let i of o.children){let a=B.new3(this.bounds(i)),s=B.UNIT.overlaps(t.transformRect(a));if(this._needsBackgroundColor(i)&&s)return!0}return!1}return!0}drawTileFinish(e,t,n,r){this._includesBackgroundColor&&!this._didDraw&&(this._tileStack.last().clearToColor(E.TRANSPARENT),this._includesBackgroundColor=!1),this._currentTile1().needsColorClear()&&this._currentTile1().doDeferredClear(C.Clear.COLOR);let o=this._tileStack.popTile();return r||(this._context.setTextureSet(n),this._context.setViewport(t.x()|0,t.y()|0,t.width()|0,t.height()|0),C.in_Context.Context_setCopyBlendState(this._context),this._blendTextureMaterial.setUniformFloat(wn,1),this._blendTextureMaterial.setUniformSampler(Yt,o.colorTextureForSampling(),0),this._context.draw(C.Primitive.TRIANGLE_STRIP,this._blendTextureMaterial,this._quadArea),this._tileStack.freeTileToPool(o)),this._tileStack.assertPoolAfterRender(),new hm(this._includesBackgroundColor,this._didDraw?1:0,this._neededImagesOrNull)}visit(e,t,n){let r=B.new3(B.UNIT),o=ee.new3(t);o.invert();let i=o.transformRect(r);this.visitWithCanvasSpaceTileBounds(e,t,i,n)}visitWithCanvasSpaceTileBounds(e,t,n,r){this._context.annotateProfile(e.opProfileString(),()=>{this._visitWithCanvasSpaceTileBounds(e,t,n,r)})}_visitWithCanvasSpaceTileBounds(e,t,n,r){var i,a;let o;if(!!n.overlaps(this.bounds(e))&&!C.FrozenScissors.isEmpty(this._currentTile1().scissors()))switch(e.op()){case 0:{let s=e;this.visitWithCanvasSpaceTileBounds(s.child,t,n,r);break}case 2:{let s=e;this._shouldDisableAllAntialiasing?this.visitWithCanvasSpaceTileBounds(s.child,t,n,r):(this.pushSSAARenderState(s.child),this.visitWithCanvasSpaceTileBounds(s.child,t,n,r),this.popSSAARenderState());break}case 1:{let s=e;for(let c of s.children){if(!C.FrozenScissors.last(this._currentTile1().scissors()).overlaps(this.allocateAndComputeTileScissor(t,this.bounds(c))))continue;let u=this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.currentBatchAA().value==2,d=c.desiredAntialiasing()==2&&!this._shouldDisableAllAntialiasing;d&&!u?this._pathRasterizer.beginBatch(2):!d&&u&&this._pathRasterizer.finishBatch(),d?c.op()==3?this._pathRasterizer.renderFill(t,c):c.op()==4&&this._pathRasterizer.renderFillStroke(t,c):this.visitWithCanvasSpaceTileBounds(c,t,n,r)}this._pathRasterizer.currentBatchAA()!=null&&this._pathRasterizer.finishBatch();break}case 3:{let s=e,c=this._shouldDisableAllAntialiasing?0:s.desiredAntialiasing();this._pathRasterizer.beginBatch(c),this._pathRasterizer.renderFill(t,s),this._pathRasterizer.finishBatch();break}case 4:{let s=e,c=this._shouldDisableAllAntialiasing?0:s.desiredAntialiasing();this._pathRasterizer.beginBatch(c),this._pathRasterizer.renderFillStroke(t,s),this._pathRasterizer.finishBatch();break}case 5:{let s=e,c=(s.type==0||s.type==4||s.type==1)&&s.hasNonIsolatedBlends(),l=this.allocateAndComputeTileScissor(t,this.bounds(s.color)),u=s.type==0&&!s.hasNonIsolatedBlends()&&s.alpha.isAxisAlignedRectFill()&&s.alpha.op()==3&&Re.containsAtLeastOneVisibleOpaquePaint(s.alpha.geometry.paints),d=u?s.alpha.geometryBounds():this.bounds(s.alpha),h=s.type==2||Ne.emulateFullscreenRenderingBugs&&s.type==3?this.allocateAndComputeTileScissor(t,d):s.type==4?l:this.allocateAndComputeTileScissor(t,d).intersectedWith(l);if(u){let v=this._tileStack.takeScissorFromCurrentTile();h.intersectWith(v),this._tileStack.pushScissor(h),this.visitWithCanvasSpaceTileBounds(s.color,t,n,r),this._tileStack.popScissorFromCurrentTile(),this._tileStack.pushScissor(v);return}let S=B.new3(C.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(h);if(S.isEmpty())return;c?(this.duplicateTile1(S),this.duplicateTile1(S)):s.type==3?(this._tileStack.pushTileAndClearToColor(E.premultiplied(this._canvas.computedBackgroundColor())),this._tileStack.pushScissor(S)):this._tileStack.pushTileWithScissors1(S),this.visitWithCanvasSpaceTileBounds(s.color,t,n,r),this._tileStack.pushTileWithScissors1(S),this.visitWithCanvasSpaceTileBounds(s.alpha,t,n,r);let f=this._tileStack.popTile(),y=this._tileStack.popTile();switch(s.type){case 0:{if(c){let v=this._tileStack.popTile();this.maskTilePassThrough(v,f,y,S),this._tileStack.freeTileToPool(v)}else this.maskTile(f,y,S);break}case 1:{if(c){let v=this._tileStack.popTile();this.maskTileLuminancePassThrough(v,f,y,S),this._tileStack.freeTileToPool(v)}else this.maskTileLuminance(f,y,S);break}case 4:{if(c){let v=this._tileStack.popTile();this.maskKnockoutShadowTilePassThrough(v,f,y,S),this._tileStack.freeTileToPool(v)}else this.maskKnockoutShadowTile(f,y,S);break}case 3:{this.maskBackgroundBlurTile(f,y,S);break}case 2:{this.maskInnerShadowTile(f,y,S,s.innerShadowFill,s.innerShadowAlphaRequiresHardMask);break}}this._tileStack.freeTileToPool(f),this._tileStack.freeTileToPool(y);break}case 9:{let s=e,c=this.allocateAndComputeTileScissor(t,this.bounds(s.alpha)),l=B.new3(C.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(c);if(l.isEmpty())return;this._tileStack.pushTileWithScissors1(l),this.visitWithCanvasSpaceTileBounds(s.alpha,t,n,r);let u=this._tileStack.popTile();this.hardMaskTileWithColor(u,s.color,l),this._tileStack.freeTileToPool(u);break}case 6:{let s=e,c=B.new3(this.bounds(s));t.transformRect(c),c.scaledBy1(this.currentTextureSize());let l=s.radius*t.scale1().max1(),u=B.new3(C.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(c);if(u.isEmpty())return;if(l<1/this.currentTextureSize()){this.visitWithCanvasSpaceTileBounds(s.child,t,n,r);return}let d=_m(s.child),h=d.a,S=(i=d.b)!=null?i:Nt.FrozenAffineTransform_IDENTITY,f=h.isRectFill()?h:null;if(f!=null&&s.clamp.isInvalid()){let v=Re.onlySolidPaintOrNull(f.geometry.paints);if(v!=null){let b=ee.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(t).multipliedBy1(S).multipliedBy1(f.transform);this.renderBlurredRectangle(b,f.geometry.path().bounds(),E.multiplyOpacity(v.color(),v.opacity()),s.radius);return}}let y=h.isRoundedRectFill()?h:null;if(y!=null&&s.clamp.isInvalid()){let v=y.geometry.path().path(),b=v.radii();if(b.isUniform()){let m=Re.onlySolidPaintOrNull(y.geometry.paints);if(m!=null){let p=b.topLeft,_=ee.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(t).multipliedBy1(S).multipliedBy1(y.transform);this.renderBlurredRoundedRectangle(_,v.bounds(),p,E.multiplyOpacity(m.color(),m.opacity()),s.radius);return}}}this.renderBlur(e,t,l,u,r,s.clamp);break}case 7:{let s=e,c=this.allocateAndComputeTileScissor(t,this.bounds(s.child)),l=Hg(s.blendMode)&&(this._currentTile1().isColorClear()||this._currentTile1().needsColorClear())&&s.opacity==1,u=B.new3(C.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(c);if(u.isEmpty())return;l?this._currentTile1().pushScissor2(u.clone()):s.blendMode=="PASS_THROUGH"?this.duplicateTile1(u):this._tileStack.pushTileWithScissors1(u),this.visitWithCanvasSpaceTileBounds(s.child,t,n,r),l&&this._currentTile1().popScissor(),l||this.blendAndPopTile(s.blendMode,s.opacity);break}case 8:{let s=e;this.visitCompositeChildWithOpacity(s,1,t,n);break}case 10:{let s=e;switch(s.property){case 2:{let c=ee.new3(t);c.multipliedBy1(s.transform());let l=ee.new3(s.transform());l.invert()||l.copyFrom(Nt.FrozenAffineTransform_IDENTITY),l.multipliedBy1(r),this.visit(s.child,c,l);break}case 1:{let c=ee.new2();this.visitWithCanvasSpaceTileBounds(s.child,t,n,c);break}case 0:{let c=ee.new2(),l=ee.new2();c.copyFrom(t).multipliedBy1(r),this.visit(s.child,c,l);break}case 4:{let c=s.opacity(),l=!1;if(c==1)this.visitWithCanvasSpaceTileBounds(s.child,t,n,r),l=!0;else if(c==0)l=!0;else if(s.child.op()==3){let u=s.child,d=(a=Re.onlyPaintOrNull(u.geometry.paints))==null?void 0:a.asSinglePaint();if(d!=null){let h=d.cloneAsSinglePaint();h.setOpacity(h.opacity()*c);let S=[h].slice();this.visitWithCanvasSpaceTileBounds(u.withPaints(S),t,n,r),l=!0}}else if(s.child.op()==8){let u=s.child;this.visitCompositeChildWithOpacity(u,c,t,n),l=!0}if(!l){let u=this.allocateAndComputeTileScissor(t,this.bounds(s.child)),d=B.new3(C.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(u);s.child.hasNonIsolatedBlends()?this.duplicateTile1(d):this._tileStack.pushTileWithScissors1(d),this.visitWithCanvasSpaceTileBounds(s.child,t,n,r),s.child.hasNonIsolatedBlends()?this.blendAndPopTile("PASS_THROUGH",c):this.blendAndPopTile("NORMAL",c)}break}case 3:{this.visitWithCanvasSpaceTileBounds(s.child,t,n,r);break}case 5:{this.visitWithCanvasSpaceTileBounds(s.child,t,n,r);break}default:throw new Error(`Unhandled VolatileProperty value ${Yi.VolatileProperty_toString(s.property)}`)}break}case 11:{let s=e,c=ee.new3(t);c.multipliedBy1(s.transform);let l=ee.new3(s.transform);l.invert()||l.copyFrom(Nt.FrozenAffineTransform_IDENTITY),l.multipliedBy1(r),this.visit(s.child,c,l);break}case 12:{let s=e,c=this.allocateAndComputeTileScissor(t,this.bounds(s.startChild)),l=this.allocateAndComputeTileScissor(t,this.bounds(s.endChild)),u=B.new2();u.copyFrom(C.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(c);let d=u.clone().scaledBy1(1/this.currentTextureSize());s.startChild.hasNonIsolatedBlends()?this.duplicateTile1(u):this._tileStack.pushTileWithScissors1(u),this.visitWithCanvasSpaceTileBounds(s.startChild,t,n,r);let h=this._tileStack.popTile();u.copyFrom(C.FrozenScissors.last(this._currentTile1().scissors())).intersectedWith(l);let S=u.clone().scaledBy1(1/this.currentTextureSize());s.endChild.hasNonIsolatedBlends()?this.duplicateTile1(u):this._tileStack.pushTileWithScissors1(u),this.visitWithCanvasSpaceTileBounds(s.endChild,t,n,r);let f=this._tileStack.popTile();this._lerpTileMaterial.setUniformSampler(Yt,h.colorTextureForSampling(),0),this._lerpTileMaterial.setUniformSampler(mr,f.colorTextureForSampling(),1),C.in_Material.Material_setUniformVec43(this._lerpTileMaterial,xh,d),C.in_Material.Material_setUniformVec43(this._lerpTileMaterial,Dh,S),this._lerpTileMaterial.setUniformFloat(wn,en.double_clamp(s.progress(),0,1)),C.in_Context.Context_setPremultipliedBlendState(this._context);let y=this.allocateAndComputeTileScissor(t,this.bounds(e));this._tileStack.pushScissor(y),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._lerpTileMaterial,this._quadArea),this._tileStack.popScissorFromCurrentTile(),this._tileStack.freeTileToPool(f),this._tileStack.freeTileToPool(h);break}}}visitCompositeChildWithOpacity(e,t,n,r){let o=ee.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(n),i=this.allocateAndComputeTileScissor(n,this.bounds(e));this._tileStack.pushScissor(i),e.forEachTileWithinBounds(1,r,a=>{let s=a.textureRegionOrNull();if(s!=null&&(this.drawTextureRegion2(s,a.canvasSpaceBounds(),o,ma.BLEND,t),a.neededImagesOrNull!=null)){let c=ks.asList(a.neededImagesOrNull);for(let l of c)this.getOrCreateImageTexture(l)}}),this._tileStack.popScissorFromCurrentTile()}allocateAndComputeTileScissor(e,t){let n=B.new3(t);return e.transformRect(n),n.scaledBy1(this.currentTextureSize()).rounded()}renderBlurredRectangle(e,t,n,r){E.alpha(n)!=0&&(C.in_Material.Material_setUniformMat32(this._rectangleBlurMaterial,yn,e),C.in_Material.Material_setUniformVec42(this._rectangleBlurMaterial,No,E.premultiplied(n)),C.in_Material.Material_setUniformVec43(this._rectangleBlurMaterial,gr,t),this._rectangleBlurMaterial.setUniformFloat(cd,r),C.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._rectangleBlurMaterial,this._quadArea),this._didDraw=!0)}renderBlurredRoundedRectangle(e,t,n,r,o){E.alpha(r)!=0&&(C.in_Material.Material_setUniformMat32(this._roundedRectangleBlurMaterial,yn,e),C.in_Material.Material_setUniformVec42(this._roundedRectangleBlurMaterial,No,E.premultiplied(r)),C.in_Material.Material_setUniformVec43(this._roundedRectangleBlurMaterial,gr,t),this._roundedRectangleBlurMaterial.setUniformFloat(kh,n/o),C.in_Material.Material_setUniformVec22(this._roundedRectangleBlurMaterial,Rh,t.size().divide(2*o)),this._roundedRectangleBlurMaterial.setUniformFloat(cd,o),C.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._roundedRectangleBlurMaterial,this._quadArea),this._didDraw=!0)}renderBlur(e,t,n,r,o,i){let a=e,s=32,c=.5,l=1/(1+2*n),u=Math.min(s,l*n*this.currentTextureSize()),d=u/this.currentTextureSize(),h=d/n;h>2/c/this.currentTextureSize()&&(h=Math.round(h*(this.currentTextureSize()*c))/(this.currentTextureSize()*c),u=Math.min(s/c,h*n*this.currentTextureSize()),d=u/this.currentTextureSize());let S=ee.new2().translatedBy2(.5,.5).scaledBy2(h).translatedBy2(-.5,-.5),f=B.new3(r).scaledBy1(1/this.currentTextureSize());S.transformRect(f);let y=B.new3(f).expandedBy2(0,d),v=B.new3(y).expandedBy2(d,0),b=S.multipliedBy1(t),m=null;if(!i.isInvalid()){m=b.transformRect(i.clone()),m.scaledBy1(this.currentTextureSize());let N=Math.ceil(m.left()-.5)+.5,k=Math.ceil(m.top()-.5)+.5,j=Math.floor(m.right()+.5)-.5,te=Math.floor(m.bottom()+.5)-.5;m=new B(N,k,j-N,te-k),m.scaledBy1(1/this.currentTextureSize())}let p=u>4,_=p&&a.child.op()==9;if(this._tileStack.pushTileWithScissors1(B.new3(v).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded()),_){let N=a.child;this.visit(N.alpha,b,o)}else this.visit(a.child,b,o);let T=!1;if(p){let N=u*c,k=B.new3(v).scaledBy1(c),j=B.new3(y).scaledBy1(c),te=B.new3(f).scaledBy1(c),Y=null;if(m!=null){Y=B.new3(m).scaledBy1(c),Y.scaledBy1(this.currentTextureSize());let P=Math.ceil(Y.left()-.5)+.5,J=Math.ceil(Y.top()-.5)+.5,z=Math.floor(Y.right()+.5)-.5,O=Math.floor(Y.bottom()+.5)-.5;Y=new B(P,J,z-P,O-J),Y.scaledBy1(1/this.currentTextureSize())}let _e=this._tileStack.popTile(),ce=B.new3(k).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();if(this._tileStack.pushTileWithScissors2(ce,T),_){let P=a.child;this.hardMaskWithColorAndDownscaleTile(_e,P.color,k,v)}else this.downscaleTile(_e,k,v);this._tileStack.freeTileToPool(_e);let V=this._tileStack.popTile(),H=B.new3(j).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTileWithScissors2(H,T),this.blurTile(V,1/this.currentTextureSize(),0,B.new3(H).scaledBy1(1/this.currentTextureSize()),N,Y),this._tileStack.freeTileToPool(V);let M=this._tileStack.popTile(),K=B.new3(te).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTileWithScissors2(K,T),this.blurTile(M,0,1/this.currentTextureSize(),B.new3(K).scaledBy1(1/this.currentTextureSize()),N,Y),this._tileStack.freeTileToPool(M);let U=this._tileStack.popTile();this.upscaleTile(U,r.scaledBy1(1/this.currentTextureSize()),te),this._tileStack.freeTileToPool(U)}else{let N=this._tileStack.popTile(),k=B.new3(y).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTileWithScissors2(k,T),this.blurTile(N,1/this.currentTextureSize(),0,B.new3(k).scaledBy1(1/this.currentTextureSize()),u,m),this._tileStack.freeTileToPool(N);let j=this._tileStack.popTile(),te=B.new3(f).scaledBy1(this.currentTextureSize()).expandedBy1(1).rounded();this._tileStack.pushTileWithScissors2(te,T),this.blurTile(j,0,1/this.currentTextureSize(),B.new3(te).scaledBy1(1/this.currentTextureSize()),u,m),this._tileStack.freeTileToPool(j);let Y=this._tileStack.popTile();this.upscaleTile(Y,r.scaledBy1(1/this.currentTextureSize()),f),this._tileStack.freeTileToPool(Y)}}hardMaskTileWithColor(e,t,n){let r=B.new3(n);C.in_Material.Material_setUniformVec43(this._hardMaskTileWithColorMaterial,gr,this.scissorQuad(r)),C.in_Material.Material_setUniformVec42(this._hardMaskTileWithColorMaterial,No,E.premultiplied(t)),e.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._hardMaskTileWithColorMaterial.setUniformSampler(Yt,e.colorTextureForSampling(),0),C.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._hardMaskTileWithColorMaterial,this._quadArea),this._didDraw=!0,e.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP)}blurTile(e,t,n,r,o,i){let a=null;i==null?a=this._unclampedBlurMaterial:(a=this._clampedBlurMaterial,C.in_Material.Material_setUniformVec43(a,bh,i)),C.in_Material.Material_setUniformVec43(a,gr,r),a.setUniformFloat(Sh,o),a.setUniformVec21(yh,t,n),a.setUniformSampler(Yt,e.colorTextureForSampling(),0),C.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,a,this._quadArea),this._didDraw=!0}scissorQuad(e){return e.scaledBy1(1/this.currentTextureSize())}blendAndPopTile(e,t){if(e=="PASS_THROUGH"||e=="NORMAL"||e=="SCREEN"){let n=this._tileStack.popTile(),r=this.scissorQuad(B.new3(C.FrozenScissors.last(n.scissors())));C.in_Material.Material_setUniformVec43(this._blendTileSimpleMaterial,gr,r),e=="PASS_THROUGH"?(this._blendTileSimpleMaterial.setUniformFloat(wn,1),C.in_Context.Context_setInterpolateBlendState(this._context,t)):(this._blendTileSimpleMaterial.setUniformFloat(wn,t),e=="SCREEN"?C.in_Context.Context_setScreenBlendState(this._context):C.in_Context.Context_setPremultipliedBlendState(this._context)),n.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._blendTileSimpleMaterial.setUniformSampler(Yt,n.colorTextureForSampling(),0),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._blendTileSimpleMaterial,this._quadArea),this._didDraw=!0,n.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(n)}else{this.duplicateTile2(C.FrozenScissors.last(this._currentTile1().scissors()),1);let n=this._tileStack.popTile(),r=this._tileStack.popTile(),o=this.scissorQuad(B.new3(C.FrozenScissors.last(r.scissors())));C.in_Material.Material_setUniformVec43(this._blendTileCustomMaterial,gr,o),this._blendTileCustomMaterial.setUniformInt(qa,zg.get(e)),this._blendTileCustomMaterial.setUniformFloat(wn,t),r.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),n.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._blendTileCustomMaterial.setUniformSampler(Yt,r.colorTextureForSampling(),0),this._blendTileCustomMaterial.setUniformSampler(mr,n.colorTextureForSampling(),1),C.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._blendTileCustomMaterial,this._quadArea),this._didDraw=!0,n.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),r.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),this._tileStack.freeTileToPool(n),this._tileStack.freeTileToPool(r)}}upscaleTile(e,t,n){C.in_Material.Material_setUniformVec43(this._upscaleTileMaterial,gr,t),C.in_Material.Material_setUniformVec43(this._upscaleTileMaterial,Nl,n),this._upscaleTileMaterial.setUniformSampler(Yt,e.colorTextureForSampling(),0),C.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._upscaleTileMaterial,this._quadArea),this._didDraw=!0}downscaleTile(e,t,n){C.in_Material.Material_setUniformVec43(this._downscaleTileMaterial,gr,t),C.in_Material.Material_setUniformVec43(this._downscaleTileMaterial,Nl,n),this._downscaleTileMaterial.setUniformSampler(Yt,e.colorTextureForSampling(),0),C.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._downscaleTileMaterial,this._quadArea),this._didDraw=!0}hardMaskWithColorAndDownscaleTile(e,t,n,r){C.in_Material.Material_setUniformVec43(this._hardMaskWithColorAndDownscaleTileMaterial,gr,n),C.in_Material.Material_setUniformVec43(this._hardMaskWithColorAndDownscaleTileMaterial,Nl,r),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformSampler(Yt,e.colorTextureForSampling(),0),C.in_Material.Material_setUniformVec42(this._hardMaskWithColorAndDownscaleTileMaterial,No,E.premultiplied(t)),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformFloat(Lh,this.currentTextureSize()),this._hardMaskWithColorAndDownscaleTileMaterial.setUniformFloat(Oh,1/this.currentTextureSize()),C.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._hardMaskWithColorAndDownscaleTileMaterial,this._quadArea),this._didDraw=!0}_advanceGIFAndUpload(e,t){let n=e.gif().nextFrameIfNecessary();n!=null&&C.in_Texture.Texture_resize3(t,e.width(),e.height(),new Zt(0,e.width(),e.height(),n))}getOrCreateImageTexture(e){var a,s;let t,n;if((e==null?void 0:e.image)==null)return null;this._neededImagesOrNull!=null&&ks.add(this._neededImagesOrNull,e);let r=e.image,o=e.purpose,i=r.texture();return i!=null?r.gif()!=null&&this._advanceGIFAndUpload(r,i):(((a=r.decodedData())==null?void 0:a.pixels)!=null||r.gif()!=null)&&(i=C.in_Context.Context_createTexture1(this._context,C.TextureFormat.RGBA_NEAREST_CLAMP,r.width(),r.height(),"Image"),i.setShouldUnloadImageBuffer(tt.OS_isMobile(tt.OS_current())||tt.OS_current()==4&&navigator.maxTouchPoints>0||At.forceMobileOptimizations()),r.setTexture(i),((s=r.decodedData())==null?void 0:s.pixels)!=null?(C.in_Texture.Texture_resize3(r.texture(),r.width(),r.height(),r.decodedData()),(tt.OS_isMobile(tt.OS_current())||tt.OS_current()==4&&navigator.maxTouchPoints>0||At.forceMobileOptimizations())&&r.freeMemoryForDecodedData()):r.gif()!=null&&this._advanceGIFAndUpload(r,i)),r.state()==0&&this._requestImage(r,o),i}duplicateTile1(e){this.duplicateTile2(e,0)}duplicateTile2(e,t){let n=this._currentTile2(t),r=n.isColorClear()||n.needsColorClear(),o=r;this._tileStack.pushTile2(o);let i=this._currentTile1();if(this._tileStack.pushScissor(e),i.bind(),r)return;let a=n.colorTextureForSampling();a.setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP);let s=n.uvSpaceRect(),c=this.scissorQuad(B.new3(e)),l=new B(s.x()+s.width()*c.x(),s.y()+s.height()*c.y(),s.width()*c.width(),s.height()*c.height()),u=new B(-1+2*c.x(),-1+2*c.y(),2*c.width(),2*c.height());this.drawTexture1(a,l,null,u,ma.REPLACE),a.setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP)}maskBackgroundBlurTile(e,t,n){Ne.flushBeforeMasks()&&this._context.flush();let r=B.new3(n);C.in_Material.Material_setUniformVec43(this._maskBackgroundBlurTileMaterial,gr,this.scissorQuad(r)),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._maskBackgroundBlurTileMaterial.setUniformSampler(Yt,t.colorTextureForSampling(),0),this._maskBackgroundBlurTileMaterial.setUniformSampler(mr,e.colorTextureForSampling(),1),C.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._maskBackgroundBlurTileMaterial,this._quadArea),this._didDraw=!0,e.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP)}maskInnerShadowTile(e,t,n,r,o){Ne.flushBeforeMasks()&&this._context.flush();let i=B.new3(n),a=o?this._maskInnerShadowTileAndFirstHardMaskAlpha:this._maskInnerShadowTileMaterial;C.in_Material.Material_setUniformVec43(a,gr,this.scissorQuad(i)),C.in_Material.Material_setUniformVec42(a,No,E.premultiplied(r)),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),a.setUniformSampler(Yt,t.colorTextureForSampling(),0),a.setUniformSampler(mr,e.colorTextureForSampling(),1),C.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,a,this._quadArea),e.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTile(e,t,n){Ne.flushBeforeMasks()&&this._context.flush();let r=B.new3(n);C.in_Material.Material_setUniformVec43(this._maskTileMaterial,gr,this.scissorQuad(r)),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTileMaterial.setUniformSampler(Yt,t.colorTextureForSampling(),0),this._maskTileMaterial.setUniformSampler(mr,e.colorTextureForSampling(),1),C.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._maskTileMaterial,this._quadArea),e.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminance(e,t,n){Ne.flushBeforeMasks()&&this._context.flush();let r=B.new3(n);C.in_Material.Material_setUniformVec43(this._maskTileLuminanceMaterial,gr,this.scissorQuad(r)),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTileLuminanceMaterial.setUniformSampler(Yt,t.colorTextureForSampling(),0),this._maskTileLuminanceMaterial.setUniformSampler(mr,e.colorTextureForSampling(),1),C.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._maskTileLuminanceMaterial,this._quadArea),e.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTileLuminancePassThrough(e,t,n,r){Ne.flushBeforeMasks()&&this._context.flush();let o=B.new3(r);C.in_Material.Material_setUniformVec43(this._maskTileLuminancePassThroughMaterial,gr,this.scissorQuad(o)),n.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTileLuminancePassThroughMaterial.setUniformSampler(Yt,n.colorTextureForSampling(),0),this._maskTileLuminancePassThroughMaterial.setUniformSampler(mr,e.colorTextureForSampling(),1),this._maskTileLuminancePassThroughMaterial.setUniformSampler(Cl,t.colorTextureForSampling(),2),C.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._maskTileLuminancePassThroughMaterial,this._quadArea),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskTilePassThrough(e,t,n,r){Ne.flushBeforeMasks()&&this._context.flush();let o=B.new3(r);C.in_Material.Material_setUniformVec43(this._maskTilePassThroughMaterial,gr,this.scissorQuad(o)),n.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._maskTilePassThroughMaterial.setUniformSampler(Yt,n.colorTextureForSampling(),0),this._maskTilePassThroughMaterial.setUniformSampler(mr,e.colorTextureForSampling(),1),this._maskTilePassThroughMaterial.setUniformSampler(Cl,t.colorTextureForSampling(),2),C.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._maskTilePassThroughMaterial,this._quadArea),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTile(e,t,n){Ne.flushBeforeMasks()&&this._context.flush();let r=B.new3(n);C.in_Material.Material_setUniformVec43(this._maskKnockoutShadowTileMaterial,gr,this.scissorQuad(r)),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),e.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._maskKnockoutShadowTileMaterial.setUniformSampler(Yt,t.colorTextureForSampling(),0),this._maskKnockoutShadowTileMaterial.setUniformSampler(mr,e.colorTextureForSampling(),1),C.in_Context.Context_setPremultipliedBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._maskKnockoutShadowTileMaterial,this._quadArea),e.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}maskKnockoutShadowTilePassThrough(e,t,n,r){Ne.flushBeforeMasks()&&this._context.flush();let o=B.new3(r);C.in_Material.Material_setUniformVec43(this._maskKnockoutShadowTilePassThroughMaterial,gr,this.scissorQuad(o)),n.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(Yt,n.colorTextureForSampling(),0),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(mr,e.colorTextureForSampling(),1),this._maskKnockoutShadowTilePassThroughMaterial.setUniformSampler(Cl,t.colorTextureForSampling(),2),C.in_Context.Context_setCopyBlendState(this._context),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._maskKnockoutShadowTilePassThroughMaterial,this._quadArea),t.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),n.colorTextureForSampling().setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),this._didDraw=!0}downsampleSuperSSAATile(e){let t=this.downscaleRectForSSAA(C.FrozenScissors.last(e.scissors()).clone());t.expand1(1),t.round(),this._tileStack.pushScissor(t);let n=null;switch(gn.SUPERSAMPLE_COUNT()){case 4:{n=this._superSSAA4x4DownsampleMaterial;break}case 3:{n=this._superSSAA3x3DownsampleMaterial;break}case 2:{n=this._blendTextureMaterial;break}default:throw new Error(`Unrecognized SUPERSAMPLE_COUNT (${gn.SUPERSAMPLE_COUNT()}) when downsampling`)}n.setUniformFloat(wn,1),n.setUniformSampler(Yt,e.colorTextureForSampling(),0),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,n,this._quadArea),this._tileStack.popScissorFromCurrentTile()}drawTextureRegion1(e,t,n){this.drawTextureRegion2(e,t,Nt.FrozenAffineTransform_IDENTITY,n,1)}drawTextureRegion2(e,t,n,r,o){let i=e.uvSpaceRect,a=null;if(e.texture.format().minFilter==C.PixelFilter.LINEAR||e.texture.format().magFilter==C.PixelFilter.LINEAR){a=i.clone();let s=1/e.texture.width();a.contract(s/2)}this.drawTexture2(e.texture,e.uvSpaceRect,a,t,n,r,o)}drawTexture1(e,t,n,r,o){this.drawTexture2(e,t,n,r,Nt.FrozenAffineTransform_IDENTITY,o,1)}drawTexture2(e,t,n,r,o,i,a){this._setupDrawTextureState(e,t,n,r,o,i,a),this.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._drawTextureMaterial,this._quadArea),this._didDraw=!0}drawTextureToCurrentTextureSet(e,t,n,r,o,i,a){this._setupDrawTextureState(e,t,n,r,o,i,a),this._context.draw(C.Primitive.TRIANGLE_STRIP,this._drawTextureMaterial,this._quadArea)}_setupDrawTextureState(e,t,n,r,o,i,a){switch(i){case ma.REPLACE:{C.in_Context.Context_setCopyBlendState(this._context);break}case ma.BLEND:{C.in_Context.Context_setPremultipliedBlendState(this._context);break}}C.in_Material.Material_setUniformVec43(this._drawTextureMaterial,Fh,n!=null?n:t),C.in_Material.Material_setUniformVec43(this._drawTextureMaterial,Vh,t),C.in_Material.Material_setUniformMat32(this._drawTextureMaterial,Gh,o),C.in_Material.Material_setUniformVec43(this._drawTextureMaterial,Bh,r),this._drawTextureMaterial.setUniformFloat(wn,a),this._drawTextureMaterial.setUniformSampler(Yt,e,0)}constructor(e,t){this._canvas=null,this._backgroundEnabled=!0,this._didDraw=!1,this._includesBackgroundColor=!1,this._boundsCache=null,this._canvasSpaceTileBounds=null,this._neededImagesOrNull=null,this._context=null,this._quadArea=null,this._bufferPool=null,this._transparentClearTexture=null,this._tileStack=null,this._ssaaState=new gm,this._downsampleNeedsBlend=!1,this._shouldDisableAllAntialiasing=!1,this._clampedBlurMaterial=null,this._unclampedBlurMaterial=null,this._rectangleBlurMaterial=null,this._roundedRectangleBlurMaterial=null,this._upscaleTileMaterial=null,this._downscaleTileMaterial=null,this._hardMaskWithColorAndDownscaleTileMaterial=null,this._blendTextureMaterial=null,this._lerpTileMaterial=null,this._blendTileSimpleMaterial=null,this._blendTileCustomMaterial=null,this._maskInnerShadowTileMaterial=null,this._maskInnerShadowTileAndFirstHardMaskAlpha=null,this._maskBackgroundBlurTileMaterial=null,this._maskTileMaterial=null,this._maskTileLuminanceMaterial=null,this._maskTileLuminancePassThroughMaterial=null,this._maskTilePassThroughMaterial=null,this._maskKnockoutShadowTileMaterial=null,this._maskKnockoutShadowTilePassThroughMaterial=null,this._hardMaskTileWithColorMaterial=null,this._drawTextureMaterial=null,this._clearOnWindowsMaterial=null,this._superSSAA4x4DownsampleMaterial=null,this._superSSAA3x3DownsampleMaterial=null,this._requestImage=null,this._pathRasterizer=null,this._layerByLayerRendering=new Bd,this._context=e,this._bufferPool=t,this._quadArea=this._bufferPool.allocate(C.VertexFormat.POSITION_F2_COORD_F3,new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._transparentClearTexture=e.createTexture2(C.TextureFormat.RGBA_LINEAR_CLAMP,1,1,new Uint8Array([0,0,0,0]),"Transparent clear texture"),this._tileStack=new Ro.TileStack(e,(r,o)=>{this.clear(r,o)},this._transparentClearTexture),this._pathRasterizer=new gn(this,this._context,this._bufferPool);let n=this._context.graphicsCardName();Ne.setFlushBeforeMasks(n.indexOf("NVIDIA")!=-1&&n.indexOf("Direct3D11")!=-1||Q.getFeatureFlags().flushBeforeMasks),this._clampedBlurMaterial=this._context.createMaterial("clampedBlur",C.VertexFormat.POSITION_F2_COORD_F3,Yr,kp),this._unclampedBlurMaterial=this._context.createMaterial("unclampedBlur",C.VertexFormat.POSITION_F2_COORD_F3,Yr,Up),this._rectangleBlurMaterial=this._context.createMaterial("rectangleBlur",C.VertexFormat.POSITION_F2_COORD_F3,Hp,zp),this._roundedRectangleBlurMaterial=this._context.createMaterial("roundedRectangleBlur",C.VertexFormat.POSITION_F2_COORD_F3,Wp,Kp),this._upscaleTileMaterial=this._context.createMaterial("upscaleTile",C.VertexFormat.POSITION_F2_COORD_F3,Rp,wp),this._downscaleTileMaterial=this._context.createMaterial("downscaleTile",C.VertexFormat.POSITION_F2_COORD_F3,rd,Pp),this._hardMaskWithColorAndDownscaleTileMaterial=this._context.createMaterial("hardMaskWithColorAndDownscaleTile",C.VertexFormat.POSITION_F2_COORD_F3,rd,Fp),this._blendTextureMaterial=this._context.createMaterial("blendTexture",C.VertexFormat.POSITION_F2_COORD_F3,Ka,od),this._lerpTileMaterial=this._context.createMaterial("lerpTexture",C.VertexFormat.POSITION_F2_COORD_F3,Ka,Gp),this._clearOnWindowsMaterial=this._context.createMaterial("clearOnWindows",C.VertexFormat.POSITION_F2_COORD_F3,Ka,Al),this._blendTileSimpleMaterial=this._context.createMaterial("blendTileSimple",C.VertexFormat.POSITION_F2_COORD_F3,Yr,od),this._blendTileCustomMaterial=this._context.createMaterial("blendTileCustom",C.VertexFormat.POSITION_F2_COORD_F3,Yr,ch),this._maskInnerShadowTileMaterial=this._context.createMaterial("maskInnerShadowTile",C.VertexFormat.POSITION_F2_COORD_F3,Yr,$p),this._maskInnerShadowTileAndFirstHardMaskAlpha=this._context.createMaterial("maskInnerShadowTileAndFirstHardMaskAlpha",C.VertexFormat.POSITION_F2_COORD_F3,Yr,eh),this._maskBackgroundBlurTileMaterial=this._context.createMaterial("maskBackgroundBlurTile",C.VertexFormat.POSITION_F2_COORD_F3,Yr,th),this._maskTileMaterial=this._context.createMaterial("maskTile",C.VertexFormat.POSITION_F2_COORD_F3,Yr,qp),this._maskTileLuminanceMaterial=this._context.createMaterial("maskTileLuminance",C.VertexFormat.POSITION_F2_COORD_F3,Yr,Yp),this._maskTileLuminancePassThroughMaterial=this._context.createMaterial("maskTileLuminancePassThrough",C.VertexFormat.POSITION_F2_COORD_F3,Yr,Xp),this._maskTilePassThroughMaterial=this._context.createMaterial("maskTilePassThrough",C.VertexFormat.POSITION_F2_COORD_F3,Yr,jp),this._maskKnockoutShadowTileMaterial=this._context.createMaterial("maskKnockoutShadowTile",C.VertexFormat.POSITION_F2_COORD_F3,Yr,Jp),this._maskKnockoutShadowTilePassThroughMaterial=this._context.createMaterial("maskKnockoutShadowTile",C.VertexFormat.POSITION_F2_COORD_F3,Yr,Zp),this._hardMaskTileWithColorMaterial=this._context.createMaterial("hardMaskWithColor",C.VertexFormat.POSITION_F2_COORD_F3,Yr,Qp),this._drawTextureMaterial=this._context.createMaterial("drawTexture",C.VertexFormat.POSITION_F2_COORD_F3,xp,Dp),this._superSSAA4x4DownsampleMaterial=this._context.createMaterial("superSSAA4x4Downsample",C.VertexFormat.POSITION_F2_COORD_F3,Ka,Mp),this._superSSAA3x3DownsampleMaterial=this._context.createMaterial("superSSAA3x3Downsample",C.VertexFormat.POSITION_F2_COORD_F3,Ka,Lp)}renderLayerByLayerActivate(e){this._layerByLayerRendering.activate(e)}renderLayerByLayerDeactivate(){this._layerByLayerRendering.deactivate()}finishLayerByLayerDrawToScreen(){this._layerByLayerRendering.finishLayerByLayerDrawToScreen()}isLayerByLayerRenderingEnabled(){return this._layerByLayerRendering.isEnabled()}treeToRender(e){return this._layerByLayerRendering.treeToRender(e)}renderLayerByLayerPlay(){this._layerByLayerRendering.play()}renderLayerByLayerPause(){this._layerByLayerRendering.pause()}renderLayerByLayerForward(){this._layerByLayerRendering.forward()}renderLayerByLayerBackward(){this._layerByLayerRendering.backward()}renderLayerByLayerRewind(){this._layerByLayerRendering.rewind()}renderLayerByLayerIncreaseSpeed(){this._layerByLayerRendering.increaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._layerByLayerRendering.decreaseSpeed()}};(n=>{class g{constructor(){if(arguments.length==7){let o=arguments[0],i=arguments[1],a=arguments[2],s=arguments[3],c=arguments[4],l=arguments[5],u=arguments[6];this.renderTree=null,this.isRenderingWholeCanvas=!1,this.backgroundClearColor=0,this.boundsCache=null,this.shouldCollectNeededImages=!1,this.requestImage=null,this.shouldDisableAllAntialiasing=!1,this.shouldRenderDirectlyToOutputTexture=!1,this.outputTextureNeedsClear=!1,this.renderTree=o,this.isRenderingWholeCanvas=i,this.backgroundClearColor=a,this.shouldCollectNeededImages=s,this.boundsCache=c,this.requestImage=l,this.shouldDisableAllAntialiasing=u}else if(arguments.length==9){let o=arguments[0],i=arguments[1],a=arguments[2],s=arguments[3],c=arguments[4],l=arguments[5],u=arguments[6],d=arguments[7],h=arguments[8];this.renderTree=null,this.isRenderingWholeCanvas=!1,this.backgroundClearColor=0,this.boundsCache=null,this.shouldCollectNeededImages=!1,this.requestImage=null,this.shouldDisableAllAntialiasing=!1,this.shouldRenderDirectlyToOutputTexture=!1,this.outputTextureNeedsClear=!1,this.renderTree=o,this.isRenderingWholeCanvas=i,this.backgroundClearColor=a,this.shouldCollectNeededImages=s,this.boundsCache=c,this.requestImage=l,this.shouldDisableAllAntialiasing=u,this.shouldRenderDirectlyToOutputTexture=d,this.outputTextureNeedsClear=h}}}n.Options=g;class e{constructor(o,i,a){this._context=null,this._clear=null,this._transparentClearTexture=null,this._tilePools=new Map([[pn.TILE_SIZE,[]],[gn.SSAA_SIZE(),[]]]),this._stack=[],this._tileSizeState=n.TileStack.TileSizeState.REGULAR,this._liveTileCount=new Map([[pn.TILE_SIZE,0],[gn.SSAA_SIZE(),0]]),this._sharedStencilTexture=null,this._sharedSSAAStencilTexture=null,this._context=o,this._clear=i,this._transparentClearTexture=a}setSSAARenderState(){this._tileSizeState=n.TileStack.TileSizeState.SUPERSAMPLING}unsetSSAARenderState(){this._tileSizeState=n.TileStack.TileSizeState.REGULAR}isEmpty(){return this._stack.length==0}count(){return this._stack.length}get(o){return this._stack[o]}last(){return this._stack.length==0?null:ie.List_last(this._stack)}assertPoolAfterRender(){}popScissorFromCurrentTile(){ie.List_last(this._stack).popScissor()}takeScissorFromCurrentTile(){return ie.List_last(this._stack).takeScissor()}freeTileToPool(o){o.clearScissors(),o.setIsColorClear(!1),o.setNeedsColorClear(!0),o.setNeedsDepthStencilClear(!0),o.tileSize()==gn.SSAA_SIZE()?this._tilePools.get(gn.SSAA_SIZE()).push(o):this._tilePools.get(pn.TILE_SIZE).push(o)}pushScissor(o){ie.List_last(this._stack).pushScissor2(o.clone())}pushTileWithScissors1(o){this.pushTileWithScissors2(o,!0)}pushTileWithScissors2(o,i){this.pushTile2(i),this.pushScissor(o)}pushTile1(){this.pushTile2(!0)}pushTile2(o){let i=this._allocateTileFromPool();this._stack.push(i),i.bind(),o||i.setNeedsColorClear(!1),i.backingColorTexture().hasContentBeenInitialized()||i.setNeedsColorClear(!0),i.backingDepthStencilTexture()!=null&&!i.backingDepthStencilTexture().hasContentBeenInitialized()&&i.setNeedsDepthStencilClear(!0)}pushTileAndClearToColor(o){this.pushTile1(),o!=E.TRANSPARENT&&ie.List_last(this._stack).clearToColor(o)}pushTileBackedByExistingTextureSet(o,i,a){let s=!a,c=new n.TileStackTile(1,this._context,o,i,this._clear,s,this._transparentClearTexture);this._stack.push(c),c.bind(),c.setNeedsColorClear(a),c.setNeedsDepthStencilClear(a)}pushTileBackedByExistingTextureSetAndClearToColor(o,i,a,s){this.pushTileBackedByExistingTextureSet(o,i,a),s!=E.TRANSPARENT&&ie.List_last(this._stack).clearToColor(s)}popTile(){let o=this._stack.pop(),i=this.last();return i!=null?i.bind():this._context.setTextureSet(null),o}totalVRAM(){let o=0;this._sharedStencilTexture!=null&&(o=o+C.in_Texture.Texture_totalVRAM(this._sharedStencilTexture));for(let i of this._tilePools.get(pn.TILE_SIZE))o=o+C.in_Texture.Texture_totalVRAM(i.backingColorTexture());for(let i of this._tilePools.get(gn.SSAA_SIZE()))o=o+C.in_Texture.Texture_totalVRAM(i.backingColorTexture());for(let i of this._stack)o=o+C.in_Texture.Texture_totalVRAM(i.backingColorTexture());return o}_pool(){return this._tileSizeState==n.TileStack.TileSizeState.REGULAR?this._tilePools.get(pn.TILE_SIZE):this._tilePools.get(gn.SSAA_SIZE())}_size(){return this._tileSizeState==n.TileStack.TileSizeState.REGULAR?pn.TILE_SIZE:gn.SSAA_SIZE()}_purpose(){return this._tileSizeState==n.TileStack.TileSizeState.REGULAR?"TileStack":"SSAATileStack"}_allocateTileFromPool(){let o=this._pool(),i=this._size(),a=this._purpose(),s=null;if(o!=null&&o.length!=0)s=o.pop();else{this._liveTileCount.set(i,this._liveTileCount.get(i)+1);let c=null;a=="TileStack"?(this._sharedStencilTexture==null&&(this._sharedStencilTexture=C.in_Context.Context_createTexture1(this._context,C.TextureFormat.STENCIL,i,i,a)),c=this._sharedStencilTexture):a=="SSAATileStack"&&(this._sharedSSAAStencilTexture==null&&(this._sharedSSAAStencilTexture=C.in_Context.Context_createTexture1(this._context,C.TextureFormat.STENCIL,i,i,a)),c=this._sharedSSAAStencilTexture),s=new n.TileStackTile(0,i,a,c,this._context,this._clear,this._transparentClearTexture)}return s}_isAllocatedUnusedTile(o){return o!=null&&o!=this.last()&&this._stack.indexOf(o)==-1&&this._tilePools.get(pn.TILE_SIZE).indexOf(o)==-1&&this._tilePools.get(gn.SSAA_SIZE()).indexOf(o)==-1}}n.TileStack=e,(i=>{let r;(c=>(c[c.REGULAR=0]="REGULAR",c[c.SUPERSAMPLING=1]="SUPERSAMPLING"))(r=i.TileSizeState||(i.TileSizeState={}));let o;(s=>{function a(c){return n.TileStack.TileSizeState[c]}s.TileSizeState_toString=a})(o=i.in_TileSizeState||(i.in_TileSizeState={}))})(e=n.TileStack||(n.TileStack={}));class t{constructor(){if(arguments[0]==0){let[,o,i,a,s,c,l]=arguments;this._context=null,this._clear=null,this._textureSet=null,this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=null,this._isColorClear=!1,this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=s,this._clear=c,this._textureSet=this._context.createTextureSet(C.in_Context.Context_createTexture1(this._context,C.TextureFormat.RGBA_LINEAR_CLAMP,o,o,i),a,i),this._textureSet.setViewport(0,0,o,o),this._isBackedBySingleTileTexture=!0,this._transparentClearTexture=l,this._isColorClear=!0}else if(arguments[0]==1){let[,o,i,a,s,c,l]=arguments;this._context=null,this._clear=null,this._textureSet=null,this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=null,this._isColorClear=!1,this._needsColorClear=!1,this._needsDepthStencilClear=!1,this._context=o,this._clear=s,this._textureSet=i,this._textureSet.setViewport(a.x()|0,a.y()|0,pn.TILE_SIZE,pn.TILE_SIZE),this._isBackedBySingleTileTexture=!1,this._transparentClearTexture=l,this._isColorClear=c}}uvSpaceRect(){if(this._isBackedBySingleTileTexture)return B.UNIT;{let o=this._textureSet.viewport(),i=this._textureSet.colorTexture();return new B(o.x()/i.width(),o.y()/i.height(),o.width()/i.width(),o.height()/i.height())}}tileSize(){return this._textureSet.viewport().width()|0}colorTextureForSampling(){return this._isColorClear||this._needsColorClear?this._transparentClearTexture:this._textureSet.colorTexture()}backingColorTexture(){return this._textureSet.colorTexture()}backingDepthStencilTexture(){return this._textureSet.depthStencilTexture()}context(){return this._context}textureSet(){return this._textureSet}isBackedBySingleTileTexture(){return this._isBackedBySingleTileTexture}_delete(){this._textureSet._delete()}popScissor(){this._textureSet.popScissor()}takeScissor(){let o=this._textureSet.takeScissor();if(this._isBackedBySingleTileTexture)return o;let i=this._textureSet.viewport();return o.setX(o.x()-i.x()),o.setY(o.y()-i.y()),o}scissors(){let o=this._textureSet.scissors();if(this._isBackedBySingleTileTexture)return o;let i=[],a=this._textureSet.viewport();for(let s=0,c=C.FrozenScissors.count(o);s<c;s=s+1){let l=B.new3(C.FrozenScissors.get(o,s));l.setX(l.x()-a.x()),l.setY(l.y()-a.y()),i.push(l)}return i}pushScissor1(o,i,a,s){if(this._isBackedBySingleTileTexture)this._textureSet.pushScissor1(o,i,a,s);else{let c=this._textureSet.viewport();this._textureSet.pushScissor1((c.x()|0)+o,(c.y()|0)+i,a,s)}}pushScissor2(o){this.pushScissor1(o.x()|0,o.y()|0,o.width()|0,o.height()|0)}clearScissors(){this._textureSet.clearScissors()}updateScissor(){this._textureSet.updateScissor()}bind(){this._context.setTextureSet(this._textureSet)}clearToColor(o){if(this.needsColorClear()||this.needsDepthStencilClear()){let a=this.needsColorClear()&&this.needsDepthStencilClear()?C.Clear.ALL:this.needsColorClear()?C.Clear.COLOR:C.Clear.DEPTH_STENCIL;this.doDeferredClear(a)}if(o==E.TRANSPARENT&&this.isColorClear())return;let i=this._textureSet.takeAllScissors();if(!this._isBackedBySingleTileTexture){let a=this._textureSet.viewport();this._textureSet.pushScissor1(a.x()|0,a.y()|0,a.width()|0,a.height()|0)}this._clear(o,this._textureSet),this._isBackedBySingleTileTexture||this._textureSet.popScissor(),this._textureSet.replaceAllScissors(i),this._isColorClear=o==E.TRANSPARENT}doDeferredClear(o){let i=this._textureSet.takeAllScissors();if(!this._isBackedBySingleTileTexture){let a=this._textureSet.viewport();this._textureSet.pushScissor1(a.x()|0,a.y()|0,a.width()|0,a.height()|0)}C.in_Context.Context_clear1(this._context,o),this._isBackedBySingleTileTexture||this._textureSet.popScissor(),this._textureSet.replaceAllScissors(i),(o==C.Clear.ALL||o==C.Clear.COLOR)&&(this._needsColorClear=!1,this._isColorClear=!0),(o==C.Clear.ALL||o==C.Clear.DEPTH_STENCIL)&&(this._needsDepthStencilClear=!1)}setNeedsColorClear(o){this._needsColorClear=o}needsColorClear(){return this._needsColorClear}setNeedsDepthStencilClear(o){this._needsDepthStencilClear=o}needsDepthStencilClear(){return this._needsDepthStencilClear}setIsColorClear(o){this._isColorClear=o}isColorClear(){return this._isColorClear}}n.TileStackTile=t})(Ro||(Ro={}));var mm=class{constructor(e,t,n){this.node=e,this.transform=t,this.backgroundColor=n}},ma=(t=>(t[t.REPLACE=0]="REPLACE",t[t.BLEND=1]="BLEND",t))(ma||{}),Us=(t=>(t[t.PATHS_ONLY=0]="PATHS_ONLY",t[t.GROUP=1]="GROUP",t))(Us||{}),gm=class{constructor(){this.level=0,this.mode=0}},lm;(e=>{function g(t){return Gs[t]}e.ImagePurpose_toString=g})(lm||(lm={}));var cm;(e=>{function g(t){return pm[t]}e.DrawTileWorkStatus_toString=g})(cm||(cm={}));var dm;(e=>{function g(t){return ma[t]}e.CompositeMode_toString=g})(dm||(dm={}));var um;(e=>{function g(t){return Us[t]}e.SupersampleMode_toString=g})(um||(um={}));function Wl(g,e,t){return t==null?E.BLACK:g!=null?e==4?t.computedBackgroundColor():Q.prototypeBackgroundColorOverride!=null&&Q.prototypeBackgroundColorOverride.value!=E.TRANSPARENT?E.rgbaToRgb(Q.prototypeBackgroundColorOverride.value):t.prototypeBackgroundColor()!=E.TRANSPARENT?E.rgbaToRgb(t.prototypeBackgroundColor()):E.BLACK:t.computedBackgroundColor()}function Hg(g){switch(g){case"PASS_THROUGH":case"NORMAL":case"DARKEN":case"MULTIPLY":case"LINEAR_BURN":case"COLOR_BURN":case"LIGHTEN":case"SCREEN":case"LINEAR_DODGE":case"COLOR_DODGE":case"OVERLAY":case"SOFT_LIGHT":case"HARD_LIGHT":case"DIFFERENCE":case"EXCLUSION":case"HUE":case"SATURATION":case"COLOR":case"LUMINOSITY":return!0;default:break}return!1}var zg=new Map([["PASS_THROUGH",0],["NORMAL",1],["DARKEN",2],["MULTIPLY",3],["LINEAR_BURN",4],["COLOR_BURN",5],["LIGHTEN",6],["SCREEN",7],["LINEAR_DODGE",8],["COLOR_DODGE",9],["OVERLAY",10],["SOFT_LIGHT",11],["HARD_LIGHT",12],["DIFFERENCE",13],["EXCLUSION",14],["HUE",15],["SATURATION",16],["COLOR",17],["LUMINOSITY",18]]),Xl=new Map([["SOLID",0],["GRADIENT_LINEAR",1],["GRADIENT_RADIAL",2],["GRADIENT_ANGULAR",3],["GRADIENT_DIAMOND",4],["IMAGE",5],["EMOJI",6],["VIDEO",7]]);var br=class{count(){return this._heap.length}peek(){if(this.count()==0)throw new Error("Peeking on an empty queue");return this._heap[br.ROOT_INDEX].value}insertOrUpdate(e,t){if(this._indexByElement.has(e)){this.remove(e),this.insertOrUpdate(e,t);return}let n=new br.Element(e,t);this._heap.push(n),this._indexByElement.set(n.value,this.count()-1),this._siftUp(this.count()-1)}getPriority(e){if(!this._indexByElement.has(e))return null;let t=this._indexByElement.get(e),n=this._heap[t];return new fe(n.priority)}remove(e){if(!this._indexByElement.has(e))return;let t=this._indexByElement.get(e),n=this.count()-1;n>t&&this._swap(t,n);let r=this._heap.pop();this._indexByElement.delete(r.value),t!=n&&(this._siftDown(t),this._siftUp(t))}allValues(){return this._heap.map(e=>e.value)}maxPriority(){if(this.count()==0)throw new Error("Calling maxPriority on an empty queue");return this._heap[br.ROOT_INDEX].priority}pop(){if(this.count()==0)throw new Error("Popping an empty queue");let e=this.peek();return this.remove(e),e}_isGreater(e,t){return this._compare(this._heap[e].priority,this._heap[t].priority)>0}_swap(e,t){let n=this._heap[e];this._heap[e]=this._heap[t],this._heap[t]=n,this._indexByElement.set(this._heap[e].value,e),this._indexByElement.set(this._heap[t].value,t)}_siftUp(e){let t=e;for(;t>br.ROOT_INDEX&&this._isGreater(t,br.indexOfParent(t));)this._swap(t,br.indexOfParent(t)),t=br.indexOfParent(t)}_siftDown(e){let t=e;for(;br.indexOfLeftChild(t)<this.count()&&this._isGreater(br.indexOfLeftChild(t),t)||br.indexOfRightChild(t)<this.count()&&this._isGreater(br.indexOfRightChild(t),t);){let n=br.indexOfRightChild(t)<this.count()&&this._isGreater(br.indexOfRightChild(t),br.indexOfLeftChild(t))?br.indexOfRightChild(t):br.indexOfLeftChild(t);this._swap(t,n),t=n}}static indexOfParent(e){return((e+1)/2|0)-1}static indexOfLeftChild(e){return e*2+1}static indexOfRightChild(e){return(e+1)*2}constructor(e){this._heap=[],this._indexByElement=new Map,this._compare=e}},Ii=br;Ii.ROOT_INDEX=0;(e=>{class g{constructor(n,r){this.value=n,this.priority=r}}e.Element=g})(Ii||(Ii={}));var Ja=(o=>(o[o.OTHER=0]="OTHER",o[o.PRERENDER_FULLSIZE=1]="PRERENDER_FULLSIZE",o[o.PRERENDER_THUMB=2]="PRERENDER_THUMB",o[o.ON_SCREEN_FULLSIZE=3]="ON_SCREEN_FULLSIZE",o[o.ON_SCREEN_THUMB=4]="ON_SCREEN_THUMB",o))(Ja||{}),Ai=class{compare(e){let t=dt.int_compare(this.type,e.type);return t!=0?t:dt.int_compare(this.generation,e.generation)}toString(){return`${Ja[this.type]}:${this.generation}`}static advanceGeneration(){Ai._generation=Ai._generation+1}static forType(e){return new Ai(e,Ai._generation)}static forOnScreenPurpose(e){let t=Xi.ImagePriorityType_forOnScreenPurpose(e);return Ai.forType(t)}static forPrerenderPurpose(e){let t=Xi.ImagePriorityType_forPrerenderPurpose(e);return Ai.forType(t)}static max(e,t){return e.compare(t)>0?e:t}constructor(e,t){this.type=e,this.generation=t}},cr=Ai;cr.OTHER=new Ai(0,0),cr._generation=0;var kd=class{insertOrUpdate(e,t){let n=this._queue.getPriority(e);(n==null||t.compare(n.value)>0)&&this._queue.insertOrUpdate(e,t)}peek(){return this._queue.peek()}getPriority(e){let t=this._queue.getPriority(e);return t!=null?new fe(t.value):null}maxPriority(){return this._queue.count()==0?null:new fe(this._queue.maxPriority())}remove(e){this._queue.remove(e)}clear(){this._queue=new Ii((e,t)=>e.compare(t))}allImages(){return this._queue.allValues()}count(){return this._queue.count()}isEmpty(){return this.count()==0}takeFirst(){return this._queue.pop()}constructor(){this._queue=new Ii((e,t)=>e.compare(t))}},Xi;(o=>{function g(i){return i==3||i==4}o.ImagePriorityType_isOnScreen=g;function e(i){return i==1||i==2}o.ImagePriorityType_isPrerender=e;function t(i){switch(i){case 0:return 3;case 1:case 2:return 4}throw new Error("Unhandled case")}o.ImagePriorityType_forOnScreenPurpose=t;function n(i){switch(i){case 0:return 1;case 1:case 2:return 2}throw new Error("Unhandled case")}o.ImagePriorityType_forPrerenderPurpose=n;function r(i){return Ja[i]}o.ImagePriorityType_toString=r})(Xi||(Xi={}));var jl=class{constructor(e){this._imagesByNodeId=null,this._nodeIdsByImage=null,e.addAppObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage=new Ao(t=>t.objectHash())}imagesUsedByNode(e){return Me.StringMap_get(this._imagesByNodeId,R.toString(e),new Map)}nodesUsedByImage(e){return Array.from(this._nodeIdsByImage.get(e,new Map).values())}nodesThatUseAnImage(){return Array.from(this._imagesByNodeId.keys())}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._imagesByNodeId=new Map,this._nodeIdsByImage.clear(),t!=null&&this._addImageNodeReferencesInSubtree(t.root())}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}_trackImageUse(e,t){this._imagesByNodeId.has(R.toString(e.id()))||this._imagesByNodeId.set(R.toString(e.id()),new Map),this._imagesByNodeId.get(R.toString(e.id())).set(t.objectHash(),t),this._nodeIdsByImage._in(t)||this._nodeIdsByImage.set(t,new Map),this._nodeIdsByImage.get1(t).set(R.toString(e.id()),e.id())}_removeImageUse(e,t){Array.from(this._imagesByNodeId.keys()).indexOf(R.toString(e.id()))!=-1&&(this._imagesByNodeId.get(R.toString(e.id())).delete(t.objectHash()),this._imagesByNodeId.get(R.toString(e.id())).size==0&&this._imagesByNodeId.delete(R.toString(e.id()))),this._nodeIdsByImage._in(t)&&(this._nodeIdsByImage.get1(t).delete(R.toString(e.id())),this._nodeIdsByImage.get1(t).size==0&&this._nodeIdsByImage.remove(t))}handleSceneGraphEvent(e){let t=zr.affectsImagesUsedByNode(e.property);if(!(!(t||e.property==7||e.property==24)||!(e.node.isVisibleInCanvas()||e.property==7&&Z.asBool(e.oldVal)&&!Z.asBool(e.newVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1)))){if(t){let r=e.node.collectUniqueUsedImages(),o=Me.StringMap_get(this._imagesByNodeId,R.toString(e.node.id()),new Map);for(let i of Array.from(o.keys()))r.has(i)||this._removeImageUse(e.node,o.get(i));for(let i of Array.from(r.keys()))o.has(i)||this._trackImageUse(e.node,r.get(i))}else if(e.property==7){let r=Z.asBool(e.oldVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1),o=Z.asBool(e.newVal)&&(e.node.parent()!=null?e.node.parent().isVisibleInCanvas():!1);!r&&o?this._addImageNodeReferencesInSubtree(e.node):r&&!o&&this._removeImageNodeReferencesInSubtree(e.node)}else if(e.property==24){let r=e.oldVal!=null&&Z.isParentIndex(e.oldVal)?Z.asParentIndex(e.oldVal):null,o=e.newVal!=null&&Z.isParentIndex(e.newVal)?Z.asParentIndex(e.newVal):null,i=r!=null?e.node.scene().findNode1(r.id):null,a=o!=null?e.node.scene().findNode1(o.id):null,s=i!=null&&i.isRooted(),c=a!=null&&a.isRooted();s&&!c?this._removeImageNodeReferencesInSubtree(e.node):!s&&c&&this._addImageNodeReferencesInSubtree(e.node)}}}_removeImageNodeReferencesInSubtree(e){for(let t=0,n=e.childCount();t<n;t=t+1)this._removeImageNodeReferencesInSubtree(e.childAt1(t));e.forEachSinglePaint(t=>{(t.type()=="IMAGE"||t.type()=="EMOJI"||t.type()=="VIDEO")&&(t.image()!=null&&this._removeImageUse(e,t.image()),t.imageThumbnail()!=null&&this._removeImageUse(e,t.imageThumbnail()))}),e.forEachEmojiInTextData(t=>{this._removeImageUse(e,t)})}_addImageNodeReferencesInSubtree(e){if(!!e.visible()){for(let t=0,n=e.childCount();t<n;t=t+1)this._addImageNodeReferencesInSubtree(e.childAt1(t));e.forEachSinglePaint(t=>{(t.type()=="IMAGE"||t.type()=="EMOJI"||t.type()=="VIDEO")&&(t.image()!=null&&this._trackImageUse(e,t.image()),t.imageThumbnail()!=null&&this._trackImageUse(e,t.imageThumbnail()))}),e.forEachEmojiInTextData(t=>{this._trackImageUse(e,t)})}}};var Gd=class{clear(){this._images=[],this._imageByHash=new Map}allImages(){return this._images}appendIfMissing(e){this._imageByHash.has(e.objectHash())||(this._imageByHash.set(e.objectHash(),e),this._images.push(e))}count(){return this._images.length}isEmpty(){return this.count()==0}takeFirst(){let e=this._images.shift();return this._imageByHash.delete(e.objectHash()),e}constructor(){this._images=[],this._imageByHash=new Map}},bm=(t=>(t[t.ON_SCREEN=0]="ON_SCREEN",t[t.PRERENDERING=1]="PRERENDERING",t))(bm||{}),Hd=(t=>(t[t.IS_EMOJI=0]="IS_EMOJI",t[t.IS_NOT_EMOJI=1]="IS_NOT_EMOJI",t))(Hd||{}),Ud=class{constructor(e,t,n,r){this._loadType=null,this._delaySeconds=0,this._startCondition=null,this._endCondition=null,this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0,this._numGIFs=0,this._loadType=e,this._delaySeconds=t,this._startCondition=n,this._endCondition=r}reset(){this._startConditionSeconds=-1,this._endConditionSeconds=-1,this._numSuccesses=0,this._numFailures=0}_hasMetStartCondition(){return this._startConditionSeconds>=0}_hasMetEndCondition(){return this._endConditionSeconds>=0}onFrame(){!this._hasMetStartCondition()&&this._startCondition()&&(this._startConditionSeconds=We.seconds()),this._hasMetStartCondition()&&!this._hasMetEndCondition()&&this._endCondition()&&(this._endConditionSeconds=We.seconds()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&We.seconds()-this._endConditionSeconds>=this._delaySeconds&&(this.trackEvent(),this.reset()),this._hasMetStartCondition()&&this._hasMetEndCondition()&&!this._endCondition()&&(this._endConditionSeconds=-1)}trackSuccess(e){this._hasMetStartCondition()&&(this._numSuccesses=this._numSuccesses+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackFailure(e){this._hasMetStartCondition()&&(this._numFailures=this._numFailures+1),e==0&&(this._numGIFs=this._numGIFs+1)}trackEvent(){Je.trackEvent2("images_loaded",new Map([["viewer_mode",Q.getViewerMode()],["load_type",this._loadType],["num_successes",this._numSuccesses],["num_failures",this._numFailures],["num_gifs",this._numGIFs],["duration_s",this._endConditionSeconds-this._startConditionSeconds],["fast_image_decode",Un.browserSupportsFastImageDecoding()]]),new Map([["forwardToDatadog",!0]]))}};var ya=class{delayBetweenInvalidations(){return Rr||di?0:2}constructor(e,t){this._scene=null,this._appState=null,this._prototypeStructure=null,this._previousFileKey="",this._imageResources=new Map,this._emojiResources=new Map,this._imageUseTracker=null,this.MAX_SIMULTANEOUS_PRELOADING=4,this._imageQueue=new kd,this._outboundRequestPriorities=new Map,this._thumbLoadTracker=null,this._fullsizeImageLoadTracker=null,this._requestsInFlight=0,this._needsUpdate=!1,this._needAllThumbnails=!0,this._newlyLoadedImages=new Gd,this._topLevelGuidsNeeded=new rr,this.onImageLoaded=null,this.lastImageLoadedCallbackTime=0,this._pendingRequestSuccessForImage=new Map,this._pendingRequestFailureForImage=new Map,this._shouldInvestigateNextImageFailure=!0,this._showImageFetchFailureUI=null,kr()!==null&&!kr().getImageMemoryStats&&(kr().getImageMemoryStats=()=>{let r=Rn.getMax("WEBGL_TEXTURE (Image)"),o=Rn.getMax("Decoded image data in RAM (MB)");return{vramMaxForImages:r,ramMaxForImages:o}},kr().getNumRequestsInFlight=()=>this._requestsInFlight),this._imageUseTracker=new jl(e),this._appState=e,this._prototypeStructure=e.prototypeStructure(),this._showImageFetchFailureUI=t,e.addAppObserver(this),e.addFrameObserver(this),e.prototypeState().addObserver(this);let n=2==0?0:2.5;this._thumbLoadTracker=new Ud("thumbs_loaded",n,()=>this._computeTopImagePriority().type==4,()=>this._computeTopImagePriority().type<4),this._fullsizeImageLoadTracker=new Ud("fullsize_images_loaded",n,()=>this._computeTopImagePriority().type>=3,()=>this._computeTopImagePriority().type<3)}handleStateChangeAborted(e){}handleStateChangeCommitted(e,t){}handleStateChangeInitiated(e){var r,o;let t,n;if(cr.advanceGeneration(),e.oldStateId()==null&&this._onTransitionGraphChange(),this._restartGIFsOnEnteringScreens(e),this.clearUnneededTextures(e),this._needAllThumbnails){let i=(o=(r=this._scene)==null?void 0:r.findNode1(e.newStateId()))==null?void 0:o.canvas();this.preloadAllThumbnails(i)}}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){}clearQueuesAndDecodedDataForAllImages(e){this._imageQueue.clear(),this._clearDecodedDataForAllImagesRecursive(e)}_clearDecodedDataForAllImagesRecursive(e){if(e!=null){this.clearDecodedDataForAllImages(e);for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);this._clearDecodedDataForAllImagesRecursive(r)}}}clearDecodedDataForAllImages(e){e.forEachSinglePaint(t=>{if(t.image()==null)return;let n=this._imageUseTracker.nodesUsedByImage(t.image());t.image().freeMemoryForDecodedDataAndTexture()&&n.forEach(r=>{let o;(o=this._scene.findNode1(r))!=null&&o.invalidateRenderTreeForSelfAndParents()})}),e.forEachSinglePaint(t=>{if(t.imageThumbnail()==null)return;let n=this._imageUseTracker.nodesUsedByImage(t.imageThumbnail());t.imageThumbnail().freeMemoryForDecodedDataAndTexture()&&n.forEach(r=>{let o;(o=this._scene.findNode1(r))!=null&&o.invalidateRenderTreeForSelfAndParents()})}),e.forEachEmojiInTextData(t=>{let n=this._imageUseTracker.nodesUsedByImage(t);t.freeMemoryForDecodedDataAndTexture()&&n.forEach(r=>{let o;(o=this._scene.findNode1(r))!=null&&o.invalidateRenderTreeForSelfAndParents()})})}clearQueuesAndDecodedDataForFullResolutionImages(e){this._imageQueue.clear();let t=this._appState.currentFileKey();e!=null&&this._previousFileKey!=null&&this._previousFileKey.length>1&&t!=this._previousFileKey&&this._clearDecodedDataForFullResolutionImagesRecursive(e),this._previousFileKey=t}_clearDecodedDataForFullResolutionImagesRecursive(e){if(e!=null){this.clearDecodedDataForFullResolutionImages(e);for(let t=0,n=e.childCount();t<n;t=t+1){let r=e.childAt1(t);this._clearDecodedDataForFullResolutionImagesRecursive(r)}}}clearDecodedDataForFullResolutionImages(e){e.forEachSinglePaint(t=>{var o;let n;if(t.image()==null)return;let r=this._imageUseTracker.nodesUsedByImage(t.image());if(!(t.imageThumbnail()!=null&&t.image().objectHash()==t.imageThumbnail().objectHash())){for(let i of r){let a=(o=this._scene.findNode1(i))==null?void 0:o.topLevelAncestor();if(a!=null&&this._topLevelGuidsNeeded._in(R.toString(a.id())))return}t.image().freeMemoryForDecodedDataAndTexture()&&r.forEach(i=>{let a;(a=this._scene.findNode1(i))!=null&&a.invalidateRenderTreeForSelfAndParents()})}}),e.forEachEmojiInTextData(t=>{var o;let n,r=this._imageUseTracker.nodesUsedByImage(t);for(let i of r){let a=(o=this._scene.findNode1(i))==null?void 0:o.topLevelAncestor();if(a!=null&&this._topLevelGuidsNeeded._in(R.toString(a.id())))return}t.freeMemoryForDecodedDataAndTexture()&&r.forEach(i=>{let a;(a=this._scene.findNode1(i))!=null&&a.invalidateRenderTreeForSelfAndParents()})})}_restartGIFsOnEnteringScreens(e){var o;let t;if(e.newStateId()!=null&&e.newStateId()!=e.oldStateId()){let i=(o=this._scene)==null?void 0:o.findNode1(e.newStateId());i!=null&&this._restartGIFsInSubtree(i)}let n=e.newOverlayData(),r=e.oldOverlayData();for(let i=0,a=n.length;i<a;i=i+1)if(i>=r.length||r[i].id!=n[i].id){let s=this._scene.findNode1(n[i].id);s!=null&&this._restartGIFsInSubtree(s)}}_restartGIFsInSubtree(e){e.restartGifs(),e.forEachChild(t=>{this._restartGIFsInSubtree(t)})}clearUnneededTextures(e){if(this._scene!=null&&this._appState.baseScreenId()!=null){this._topLevelGuidsNeeded=new rr,this._prototypeStructure.getPrerenderingJobs(null).forEach(t=>{let n=t.asScreen();n!=null&&this._topLevelGuidsNeeded.add(R.toString(n.nodeId))}),e.oldStateId()!=null&&this._topLevelGuidsNeeded.add(R.toString(e.oldStateId())),e.newStateId()!=null&&this._topLevelGuidsNeeded.add(R.toString(e.newStateId()));for(let t of this._imageUseTracker.nodesThatUseAnImage()){let n=this._scene.findNode1(R.fromString(t));if(n==null)continue;let r=n.topLevelAncestor();r!=null&&this._topLevelGuidsNeeded._in(R.toString(r.id()))||this.clearDecodedDataForFullResolutionImages(n)}}}handleSceneChange(e,t){e!=null&&this.clearQueuesAndDecodedDataForFullResolutionImages(e.root()),this._scene=t,this._needAllThumbnails=!0,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._onTransitionGraphChange()}preloadAllThumbnails(e){this._scene==null||e==null||(Me.StringMap_each(ya.getThumbnailsInSubtree(e),(t,n)=>{this._imageQueue.insertOrUpdate(n,cr.OTHER)}),this._needAllThumbnails=!1)}handleActiveCanvasChange(e,t){this.clearQueuesAndDecodedDataForFullResolutionImages(e),this.preloadAllThumbnails(t)}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){(e.property==70||e.property==68||e.property==24)&&this._onTransitionGraphChange()}resetForRenderingTests(){this._imageQueue.clear(),this._newlyLoadedImages.clear(),this.lastImageLoadedCallbackTime=0}onFrame(){this._needsUpdate&&this._traverseSceneForImages(),!this._newlyLoadedImages.isEmpty()&&We.seconds()-this.lastImageLoadedCallbackTime>=this.delayBetweenInvalidations()&&(this.lastImageLoadedCallbackTime=We.seconds(),this._onImagesLoaded()),this._thumbLoadTracker.onFrame(),this._fullsizeImageLoadTracker.onFrame(),this._needsUpdate=!1}_computeTopImagePriority(){let e=cr.OTHER;this._imageQueue.count()>0&&(e=cr.max(e,this._imageQueue.maxPriority().value));for(let t of Array.from(this._outboundRequestPriorities.values()))e=cr.max(e,t);return e}findImageByHexHash(e,t){return t==0?Me.StringMap_get(this._emojiResources,e,null):Me.StringMap_get(this._imageResources,e,null)}onNewImage(e,t,n){let r=t==0?this._emojiResources:this._imageResources;r.has(e)||(r.set(e,n),this._appState.baseScreenId()==null)||(this._imageQueue.insertOrUpdate(n,cr.OTHER),this._processNextItemFromRenderQueues())}requestImageForRendering(e,t){this._imageQueue.insertOrUpdate(e,t),this._processNextItemFromRenderQueues()}_onImagesLoaded(){if(this.onImageLoaded!=null){if(this._scene!=null)for(let e=0,t=this._newlyLoadedImages.allImages().length;e<t;e=e+1){let n=this._newlyLoadedImages.allImages()[e];for(let r of this._imageUseTracker.nodesUsedByImage(n)){let o=this._scene.findNode1(r);o!=null&&this.onImageLoaded(o)}}this._newlyLoadedImages.clear()}}_onTransitionGraphChange(){this._needsUpdate=!0}_traverseSceneForImages(){let e=this._appState.baseScreenId();this._scene!=null&&e!=null&&this._processNextItemFromRenderQueues()}postMessageToPerfTests(e){kr().figmaPerfTesting&&kr().postMessage({name:e,value:0},"*")}incrementRequestsInFlight(e){this._requestsInFlight=this._requestsInFlight+e,Rn.trackInReleaseBuilds("Image requests in flight",this._requestsInFlight),this._requestsInFlight==0&&this.postMessageToPerfTests("IMAGES_FINISHED_LOADING")}_requestImage(e,t,n,r){this._pendingRequestSuccessForImage.has(e.objectHash())||this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestSuccessForImage.get(e.objectHash()).push(n),this._pendingRequestFailureForImage.has(e.objectHash())||this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.get(e.objectHash()).push(r),e!=null&&e.state()==1&&this._processNextItemFromRenderQueues(),this._outboundRequestPriorities.set(e.objectHash(),cr.max(t,Me.StringMap_get(this._outboundRequestPriorities,e.objectHash(),cr.OTHER))),this.incrementRequestsInFlight(1),e.fetchAndDecode(1,o=>{this._thumbLoadTracker.trackSuccess(e.imageType()),this._fullsizeImageLoadTracker.trackSuccess(e.imageType()),this.incrementRequestsInFlight(-1),this._newlyLoadedImages.appendIfMissing(e);for(let i of this._pendingRequestSuccessForImage.get(e.objectHash()))i(o);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash()),this._processNextItemFromRenderQueues()},o=>{if((Xi.ImagePriorityType_isOnScreen(t.type)||Xi.ImagePriorityType_isPrerender(t.type))&&o==0&&this._shouldInvestigateNextImageFailure){this._shouldInvestigateNextImageFailure=!1;let a=s=>{s==0?(this._showImageFetchFailureUI(),Je.trackEvent1("show_image_failure_ui",new Map([["imagePriority",Ja[t.type]]]))):this._shouldInvestigateNextImageFailure=!0};new Kr(e.url()).get().then(s=>{a(s.status)},s=>{a(s.status)})}this._thumbLoadTracker.trackFailure(e.imageType()),this._fullsizeImageLoadTracker.trackFailure(e.imageType()),this.incrementRequestsInFlight(-1),this._processNextItemFromRenderQueues();for(let a of this._pendingRequestFailureForImage.get(e.objectHash()))a(t);this._pendingRequestSuccessForImage.set(e.objectHash(),[]),this._pendingRequestFailureForImage.set(e.objectHash(),[]),this._outboundRequestPriorities.delete(e.objectHash())})}_processNextItemFromRenderQueues(){if(this._requestsInFlight>=this.MAX_SIMULTANEOUS_PRELOADING||this._imageQueue.count()==0)return;let e=this._imageQueue.peek(),t=this._imageQueue.getPriority(e);this._imageQueue.remove(e),this._requestImage(e,t.value,n=>{},n=>{if(n.type==2||n.type==4)for(let o of this._imageUseTracker.nodesUsedByImage(e)){let i=this._scene.findNode1(o);i!=null&&i.forEachSinglePaint(a=>{let s=a.imageThumbnail()!=null&&a.imageThumbnail().objectHash()==e.objectHash(),c=a.imageThumbnail()!=null&&a.image()!=null&&a.image().objectHash()==a.imageThumbnail().objectHash();if(s&&!c&&a.image()!=null){let l=e!=null?e.objectHash():null,u=a.image()!=null?a.image().objectHash():null;console.warn(`Failed to fetch thumbnail ${l}; fetching full size image ${u}`);let d=n.type==2?cr.forType(1):n.type==4?cr.forType(3):cr.OTHER;this.requestImageForRendering(a.image(),d)}})}})}hasPendingImages(){return this._needsUpdate||this._requestsInFlight>0||Xi.ImagePriorityType_isOnScreen(this._computeTopImagePriority().type)||!this._newlyLoadedImages.isEmpty()}static getThumbnailsInSubtree(e){let t=new Map,n=new Map;return ya._getImagesInSubtree(e,t,n),n}static _getImagesInSubtree(e,t,n){e.forEachSinglePaint(r=>{r.image()!=null&&t.set(r.image().objectHash(),r.image()),r.imageThumbnail()!=null&&n.set(r.imageThumbnail().objectHash(),r.imageThumbnail())}),e.forEachEmojiInTextData(r=>{n.set(r.objectHash(),r)});for(let r=0,o=e.childCount();r<o;r=r+1){let i=e.childAt1(r);ya._getImagesInSubtree(i,t,n)}}},fm;(e=>{function g(t){return bm[t]}e.RenderPurpose_toString=g})(fm||(fm={}));var Sm;(e=>{function g(t){return Hd[t]}e.IsEmoji_toString=g})(Sm||(Sm={}));var Za=class{static instance(){return Za._instance==null&&(Za._instance=new Za),Za._instance}requestLibrary(){this.startLibLoad()}onLoadComplete(e){this._videoJsLib=e,this.onSuccess!=null&&this.onSuccess()}hasRequestedLibrary(){return this._requestStarted}isLibAvailable(){return this._videoJsLib!==null}getPlayer(e){return this._videoJsLib===null?(console.warn("VideoJS used before initialized"),null):this._videoJsLib.videoJs(e).player()}constructor(){this._videoJsLib=null,this._requestStarted=!1,this.startLibLoad=null,this.onSuccess=null}},ro=Za;ro._instance=null;var Jl;(e=>{function g(t){let n=document.getElementById(t.id());return(n==null?void 0:n.getElementsByTagName("video"))[0]}e.VideoJsPlayer_getBackingVideo=g})(Jl||(Jl={}));var Hs=class{clone(){let e=new Hs(this._hash,this._sourceURL,this._metaMP4Url,this._videoManager);return this._videoManager.enqueueVideoOrStartLoad(e),e}isReadyToPlay(){if(this._player==null||!this._loadComplete||this._isInErrorState)return!1;if(Q.ios()||this._seeking)return this._player.readyState()>Qa.HAVE_NOTHING;{let e=this._player.currentTime()==this._player.duration()&&this._player.readyState()>=Qa.HAVE_CURRENT_DATA;return this._player.readyState()>=Qa.HAVE_FUTURE_DATA||e}}isInErrorState(){return this._isInErrorState}uninitialize(){this._player!=null&&(this.pause(),this.setMuted(!1),this.resetToStartTime(),this._player.dispose())}toString(){if(this._player==null)return`Runtime(id=${this.id},  <NO VIDEO INFORMATION> )`;let e=this._player.currentTime()|0,t=dt.int_remainder(e,60)<10?`0${dt.int_remainder(e,60)}`:`${dt.int_remainder(e,60)}`,r=`${(e/60|0)<10?`0${e/60|0}`:`${e/60|0}`}:${t}`;return this._isInErrorState?`Runtime(id=${this.id}, <LOADING ERROR>)`:`Runtime(id=${this.id}, time=${r}, ready=${this.isReadyToPlay()}, P=${!this._player.paused()}, M=${this._player.muted()}, L=${this._loop})`}_setMuted(e,t){if(this._player!=null){Q.ios()&&!e&&this._videoManager.muteAllOtherVideos(this);try{this._player.muted(e),t&&(this.overriddenMutedState=new fe(e))}catch{Je.trackEvent1("video_mute_failure",new Map([["errorState",this._isInErrorState],["loadComplete",this._loadComplete],["fileType",this._fileTypeLoading]]))}}}setMutedByVideoAction(e){this._setMuted(e,!0)}setMuted(e){this._setMuted(e,!1)}muted(){return this._player!=null?this._player.muted():!0}setLoop(e){this._loop=e}size(){return this._player==null?null:new I(this._player.videoWidth(),this._player.videoHeight())}_pause(e){ui.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Pausing"),this._player!=null&&(this._player.pause(),e&&(this.overriddenPlayingState=new fe(!1)))}pauseByVideoAction(){this._pause(!0)}pause(){this._pause(!1)}_play(e,t){ui.VERBOSE_LOGS&&(e?console.log("VideoResource #",this.id,": Loop playback"):console.log("VideoResource #",this.id,": Start playback")),this._player!=null&&this.isReadyToPlay()&&(Q.getFeatureFlags().videoOnIOSStaging||(this.shouldDisplayThumbnail=!1),this._player.play().then(n=>{t&&(this.overriddenPlayingState=new fe(!0)),this.reportPlaySuccessAnalytics()},n=>{let r=Vr(n.message);r.indexOf("The play() request was interrupted")!=-1?this.reportPlayFailureAnalytics(e?`Loop error: ${r}`:r):(console.warn("User has yet to interact with page, starting video muted",n),this.setMuted(!0),this._player.play().then(o=>{},o=>{let i=Vr(o.message);e&&(i=`Loop error: ${i}`),this.reportPlayFailureAnalytics(i)}))}))}_playLoop(){this._play(!0,!1)}playByVideoAction(){this._play(!1,!0)}play(){this._play(!1,!1)}duration(){return this._player!=null?this._player.liveTracker!=null?this._player.liveTracker.seekableEnd():this._player.duration():0}currentTime1(){return this._player!=null?this._player.currentTime():0}currentTime2(e){this._player!=null&&(this._player.paused()&&this._player.one("timeupdate",t=>{this.invalidateTexture()}),this._player.currentTime(e))}resetToStartTime(){this.currentTime2(0)}isPlaying(){return this._player==null?!1:!this._player.paused()}invalidateTexture(){if(this._texture==null)return;this._texture.invalidateVideoFrame()}_handleOnLoadedMetadata(){let e;ui.VERBOSE_LOGS&&console.log("VideoResource #",this.id,": Loading completed"),this.reportLoadSuccessAnalytics(),this._loadComplete=!0,window.vid=this,(e=this._videoManager)!=null&&e.onVideoLoaded(this)}_beginLoadingHLS(e){this._loadTimeTracker.start(),this._fileTypeLoading="hls",this._player.src({type:"application/x-mpegURL",src:this._sourceURL}),this._player.one("error",t=>{this._loadTimeTracker.end(),console.warn("Reverting to fallback media source"),this.reportLoadFailureAnalytics("Failed to access HLS manifest"),this._beginLoadingMP4()})}_getMP4Url(){let e=new lo;return this._MP4VideoUrl!=null?(e.resolve(this._MP4VideoUrl),e):(new Kr(this._metaMP4Url).get().then(t=>{let n=null;try{n=JSON.parse(t.text)}catch{e.reject("Failed to parse response");return}let r=new fe(n.status);if(r.value===void 0){e.reject("Failed to parse status from response");return}if(r.value!=200){e.reject(`Status is ${r.value}: ${n.message}`);return}let o=n.meta;if(o===void 0){e.reject("Status is 200, but failed to parse signed_url");return}let i=o.signed_url;if(i===void 0){e.reject("Status is 200, but failed to parse signed_url");return}this._MP4VideoUrl=i,e.resolve(i)},t=>{e.reject(`Request failed with status: ${t.status}`)}),e)}_isWebMVideo(){let e=new lo;return this._getMP4Url().then2(t=>{new Kr(t).head().then(n=>{e.resolve(n.contentType=="video/webm")},n=>{e.resolve(!1)})},t=>{e.resolve(!1)}),e}_beginLoadingMP4(){this._loadTimeTracker.start(),this._fileTypeLoading="mp4",this._getMP4Url().then2(e=>{this._player.src({type:"video/mp4",src:e}),this._player.one("error",t=>{this._loadTimeTracker.end(),this._isInErrorState=!0;try{this.reportLoadFailureAnalytics(`Failed to access mp4. Status: ${t.status} Message: ${t.message}`)}catch{this.reportLoadFailureAnalytics("Failed to access mp4.")}})},e=>{this._loadTimeTracker.end(),this.reportLoadFailureAnalytics(`Failed to acquire mp4 url. ${e}`),this._isInErrorState=!0})}startLoadIfNeeded(){if(this._player!=null)return;let e=document.createElement("video");if(e.crossOrigin="anonymous",e.style.display="none",document.body.appendChild(e),this._player=ro.instance().getPlayer(e),this._player==null){this._isInErrorState=!0,this.reportLoadFailureAnalytics("Failed to create VideoJS player");return}this._player.muted(!0),this._player.playsinline(!0),this._player.autoplay(!1),this._player.loop(!1),this._player.ready(()=>{this._player.on("ended",t=>{this._loop?this._playLoop():this.resetToDefaultState()}),this._player.on("seeking",t=>{this._seeking=!0}),this._player.on("seeked",t=>{this._seeking=!1}),this._player.on("loadedmetadata",t=>{this._handleOnLoadedMetadata()}),Q.getFeatureFlags().videoOnIOSStaging&&this._player.on("loadeddata",t=>{this.shouldDisplayThumbnail=!1})}),Q.getFeatureFlags().prototypeTransparentWebMVideo?this._isWebMVideo().then2(t=>{t?this._beginLoadingMP4():this._beginLoadingHLS(this._sourceURL)},t=>{this._beginLoadingHLS(this._sourceURL)}):this._beginLoadingHLS(this._sourceURL)}on(e,t){let n=r=>{t(this._player)};return this._player!=null&&this._player.on(e,n),n}off(e,t){this._player!=null&&this._player.off(e,t)}getOrCreateTexture(e,t){if(this._texture==null&&this._loadComplete){let n=Jl.VideoJsPlayer_getBackingVideo(this._player);this._texture=e.createTexture3(t,n,"Video")}return!this.isReadyToPlay()||this.isInErrorState()?null:this._texture}resetToDefaultState(){this.overriddenPlayingState=null,this.overriddenMutedState=null}_getCurrentLocation(){return window.location.href.indexOf("/community/")!=-1?"community_viewer":"viewer"}reportLoadFailureAnalytics(e){this._loadTimeTracker.end();let t=this._loadTimeTracker.getLoadTime();t<0||(console.warn("Video failed to load:",e),Je.trackDefinedEvent("prototype.video_load",new Map([["status","failure"],["hash",this._hash],["load_time",t],["file_type",this._fileTypeLoading],["reason",e],["location",this._getCurrentLocation()]])))}reportLoadSuccessAnalytics(){this._loadTimeTracker.end();let e=this._loadTimeTracker.getLoadTime();e<0||Je.trackDefinedEvent("prototype.video_load",new Map([["status","success"],["hash",this._hash],["load_time",e],["file_type",this._fileTypeLoading],["width",this._player.videoWidth()],["height",this._player.videoHeight()],["location",this._getCurrentLocation()]]))}reportPlaySuccessAnalytics(){Q.getFeatureFlags().prototypeLogVideoPlay&&Je.trackEvent1("video_play",new Map([["status","success"],["hash",this._hash],["location",this._getCurrentLocation()]]))}reportPlayFailureAnalytics(e){Q.getFeatureFlags().prototypeLogVideoPlay&&Je.trackEvent1("video_play",new Map([["status","failure"],["hash",this._hash],["reason",e],["location",this._getCurrentLocation()]]))}constructor(e,t,n,r){this.id=(Hs.nextID=Hs.nextID+1)+-1,this._hash=e,this._sourceURL=t,this._metaMP4Url=n,this._videoManager=r,this._loadTimeTracker=new ym,this._loadComplete=!1,this._texture=null,this._player=null,this._isInErrorState=!1,this._fileTypeLoading="hls",this._loop=!1,this._seeking=!1,this._prevReadyState=Qa.HAVE_NOTHING,this.overriddenPlayingState=null,this.overriddenMutedState=null,this.shouldDisplayThumbnail=!0,this._MP4VideoUrl=null}},zs=Hs;zs.nextID=0;var Qa;(o=>(o.HAVE_NOTHING=0,o.HAVE_METADATA=1,o.HAVE_CURRENT_DATA=2,o.HAVE_FUTURE_DATA=3,o.HAVE_ENOUGH_DATA=4))(Qa||(Qa={}));var ym=class{start(){this._endConditionSeconds=-1,this._startConditionSeconds=We.seconds()}end(){this._endConditionSeconds=We.seconds()}getLoadTime(){return this._endConditionSeconds<0||this._startConditionSeconds<0?-1:this._endConditionSeconds-this._startConditionSeconds}constructor(){this._startConditionSeconds=-1,this._endConditionSeconds=-1}},Zl=class extends ra{uninitialize1(){this.uninitialize2(e=>{e.uninitialize()})}toString1(){return this.toString2(e=>e.toString())}constructor(){super()}};var zd=class{constructor(e){this._visiblePaints=new Set([]),this._appState=null,this._lastStateChange=null,this._appState=e}isPaintVisible(e){return this._visiblePaints.has(e)}forEachVisiblePaint(e){for(let t=0,n=Array.from(this._visiblePaints.values()).length;t<n;t=t+1)e(Array.from(this._visiblePaints.values())[t])}refreshVisibleVideosIfNeeded(){this.handlePrototypeStateChange(this._lastStateChange)}handlePrototypeStateChange(e){var a;let t;if(e==null)return;this._visiblePaints=new Set;let n=e.newStateId(),r=(a=this._appState.scene())==null?void 0:a.findNode1(n);if(r==null)return;this._lastStateChange=e,this._gatherVisibleVideoResources(r);let o=e.newOverlayData();for(let s=0,c=o.length;s<c;s=s+1){let l=this._appState.scene().findNode1(o[s].id);this._gatherVisibleVideoResources(l)}let i="";this.forEachVisiblePaint(s=>{i+=" "+s.id().toString()+","}),ui.VERBOSE_LOGS&&console.log("Found these visible paints:",i)}_gatherVisibleVideoResources(e){if(!e.visible())return;for(let n=0,r=e.childCount();n<r;n=n+1)this._gatherVisibleVideoResources(e.childAt1(n));let t=null;if(e.getCachedRenderTree()!=null)t=e.getCachedRenderTree();else if(e.getCachedRenderTreeForBaseScreen()!=null)t=e.getCachedRenderTreeForBaseScreen();else return;this._gatherVideosFromRenderNode(t.value)}_gatherVideosFromRenderNode(e){if(e!=null)switch(e.op()){case 3:{this._gatherVideosFromFillNode(e);break}case 4:{this._gatherVideosFromFillStrokeNode(e);break}case 5:{this._gatherVideosFromMaskNode(e);break}case 1:{this._gatherVideosFromGroupNode(e);break}case 6:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 2:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 9:{let t=e;this._gatherVideosFromRenderNode(t.alpha);break}case 7:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 8:{let t=e;this._gatherVideosFromRenderNode(t.tree);break}case 10:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 11:{let t=e;this._gatherVideosFromRenderNode(t.child);break}case 12:{let t=e;this._gatherVideosFromRenderNode(t.startChild),this._gatherVideosFromRenderNode(t.endChild);break}case 0:{let t=e;this._gatherVideosFromRenderNode(t.child);break}}}_gatherVideosFromFillNode(e){let t=e.geometry.paints;Re.forEachPaintWithVideo(t,n=>{this._visiblePaints.add(n)})}_gatherVideosFromFillStrokeNode(e){let t=e.fillGeometries;for(let n=0,r=t.length;n<r;n=n+1){let o=t[n].paints;Re.forEachPaintWithVideo(o,i=>{this._visiblePaints.add(i)})}for(let n=0,r=e.strokeGeometries.length;n<r;n=n+1){let o=e.strokeGeometries[n].paints;Re.forEachPaintWithVideo(o,i=>{this._visiblePaints.add(i)})}}_gatherVideosFromMaskNode(e){this._gatherVideosFromRenderNode(e.color)}_gatherVideosFromGroupNode(e){for(let t=0,n=e.children.length;t<n;t=t+1)this._gatherVideosFromRenderNode(e.children[t])}getLastTopLevelStateChange(){return this._lastStateChange}};var Wd=class{hash(){return Un.bytesToHex(this._hash)}getVideoManager(){return this._videoManager}size(e){return this._videoManager.getVideoRuntimeForPaint(e).size()}didLoad(e){let t=this._videoManager.getVideoRuntimeForPaint(e);return t==null?!1:t.isReadyToPlay()}getOrCreateTexture(e,t,n){let r=this._videoManager.getVideoRuntimeForPaint(e);return r==null||r.shouldDisplayThumbnail?null:r.getOrCreateTexture(t,n)}pause(e){let t=this._videoManager.getVideoRuntimeForPaint(e);t!=null&&t.pause()}constructor(e,t){this.id=(Tm=Tm+1)+-1,this._hash=e,this._videoManager=t,this._loadComplete=!1}},Tm=0;var Ta=class{constructor(e,t,n,r){this.status=Ta.Status.PENDING,this.interactionType=e,this.interactionID=t,this.hotspotNodeID=n,this.listener=r,this.internalEventListeners=[]}};(t=>{let g;(i=>(i[i.PENDING=0]="PENDING",i[i.ACTIVE=1]="ACTIVE",i[i.SUPERCEDED=2]="SUPERCEDED"))(g=t.Status||(t.Status={}));let e;(r=>{function n(o){return t.Status[o]}r.Status_toString=n})(e=t.in_Status||(t.in_Status={}))})(Ta||(Ta={}));var Ql=class{constructor(e,t){this.nodePath=e,this.videoPlayback=t}},$l=class{constructor(e,t){this.eventName=e,this.listener=t}},Ei=class{runtimeStorage(){return this._runtimeStorage}associatePaintWithNode(e,t){this._needToRecalculateVisibleVideos=!0;let n=t.uniqueIdentifier();this._paintToNodeGUIDMap.set(e,n),this._guidToVideoMetadata.set(n,new Ql(An.getSemanticNodePath(t),t.videoPlayback())),this._paintsForPlaybackSettingsRefresh.add(e)}constructor(e){this._appState=null,this._guidToVideoMetadata=new Map,this._hashToRuntimeMap=new Map,this._paintToNodeGUIDMap=new Map,this._runtimeStorage=new Zl,this._deferredRuntimes=new Set,this._deferredInteractionEvents=new Set,this._visibilityTracker=null,this._needToRecalculateVisibleVideos=!1,this._framePotentiallyReadyToPlay=!0,this._paintsForPlaybackSettingsRefresh=new Set,this._lastTransitionShouldForceStateRefresh=!1,this._userHasInteractedWithPage=!1,this._appState=e,this._visibilityTracker=new zd(e),this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._appState.addActionObserver(this),this._appState.addAppObserver(this)}getNodeMetadata(e){return this._guidToVideoMetadata.has(e)?this._guidToVideoMetadata.get(e):new Ql([],null)}getVideoRuntimeForPaint(e){if(!this._paintToNodeGUIDMap.has(e))return null;let t=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(t).nodePath,r=e.video().hash();return this._runtimeStorage.getData(n,r)}getPlaybackSettingsForPaint(e){if(!this._paintToNodeGUIDMap.has(e))return null;let t=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(t).videoPlayback;return n==null&&(n={autoplay:!0,mediaLoop:!0,muted:!1}),n}_populateRuntimesForVisibleVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{if(!this._paintToNodeGUIDMap.has(e))return;let t=this._paintToNodeGUIDMap.get(e),n=this.getNodeMetadata(t).nodePath;if(this.getVideoRuntimeForPaint(e)!=null)return;let r=e.video().hash(),o=this._hashToRuntimeMap.get(r).clone();this._runtimeStorage.insert(n,r,o)})}getVideoRuntimesForNode(e){let t=this.getNodeMetadata(R.toString(e)).nodePath;return this._runtimeStorage.getAllDataForNode(t)}updateVideoRuntime(e,t){let n=R.isValid(e.transitionNodeID())?e.transitionNodeID():t;if(!this._guidToVideoMetadata.has(R.toString(n)))return;this.getVideoRuntimesForNode(n).forEach((o,i)=>{if(o!=null)switch(e.mediaAction()){case"PLAY":{o.playByVideoAction();return}case"PAUSE":{o.pauseByVideoAction();return}case"TOGGLE_PLAY_PAUSE":{o.isPlaying()?o.pauseByVideoAction():o.playByVideoAction();return}case"MUTE":{o.setMutedByVideoAction(!0);return}case"UNMUTE":{o.setMutedByVideoAction(!1);return}case"TOGGLE_MUTE_UNMUTE":{o.setMutedByVideoAction(!o.muted());return}case"SKIP_FORWARD":{let a=e.mediaSkipByAmount(),s=Math.min(o.currentTime1()+a,o.duration()-.01);o.currentTime2(s);return}case"SKIP_BACKWARD":{let a=e.mediaSkipByAmount(),s=Math.max(0,o.currentTime1()-a);o.currentTime2(s);return}case"SKIP_TO":{let a=e.mediaSkipToTime(),s=Math.max(0,a);s=Math.min(s,o.duration()-.01),o.currentTime2(s);return}}})}_registerDeferredInteractionEvent(e){if(e.status==1)return;let t=this.getVideoRuntimesForNode(e.hotspotNodeID);if(t!=null){for(let n of Array.from(t.keys())){let r=t.get(n);if(e.interactionType=="ON_MEDIA_END"){let o=r.on("ended",i=>{e.listener(i)});e.internalEventListeners.push(new $l("ended",o))}else if(e.interactionType=="ON_MEDIA_HIT"){let o=r.on("timeupdate",i=>{e.listener(i)});e.internalEventListeners.push(new $l("timeupdate",o)),o=r.on("play",i=>{e.listener(i)}),e.internalEventListeners.push(new $l("play",o))}}e.status=1}}_deregisterDeferredInteractionEvent(e){if(e.status!=2)return;let t=this.getVideoRuntimesForNode(e.hotspotNodeID);if(t!=null)for(let n of Array.from(t.keys())){let r=t.get(n);for(let o of e.internalEventListeners)r.off(o.eventName,o.listener)}}_getListenerForInteractionEvent(e,t,n){let r=null;if(e=="ON_MEDIA_END")r=o=>{n()};else if(e=="ON_MEDIA_HIT"){let o=!1;r=i=>{let a=i.currentTime(),s=i.liveTracker?i.liveTracker.seekableEnd():i.duration();t>s&&(t=s);let c=.3;if(a>=t-c&&a<t){let l=Math.ceil((t-a)*1e3)|0;setTimeout(()=>{let u=i.currentTime(),d=i.paused()&&u<t,h=u>=t&&u<t+c;!o&&!d&&h&&(o=!0,n())},l)}else o=!1}}else console.error("videoManager.addInteractionEvent() should only be called with video trigger events");return r}addInteractionEvent(e,t,n,r){let o=e.event().interactionType(),i=this._getListenerForInteractionEvent(o,n,r),a=new Ta(o,e.id(),t,i);for(let s of Array.from(this._deferredInteractionEvents.values()))s.interactionID==a.interactionID&&(s.status=2,ro.instance().isLibAvailable()&&(this._deregisterDeferredInteractionEvent(s),this._deferredInteractionEvents.delete(s)));ro.instance().isLibAvailable()&&this._registerDeferredInteractionEvent(a),this._deferredInteractionEvents.add(a)}onFrame(){if(Ei.VERBOSE_LOGS&&console.log(this.debugString()),this._visibilityTracker!=null){if(this._needToRecalculateVisibleVideos&&(this._visibilityTracker.refreshVisibleVideosIfNeeded(),this._populateRuntimesForVisibleVideos(),this._framePotentiallyReadyToPlay=!0,this._needToRecalculateVisibleVideos=!1,Ei.VERBOSE_LOGS&&console.log(this.debugString())),this._framePotentiallyReadyToPlay&&this._allVisibleVideosAreLoaded()){if(this._framePotentiallyReadyToPlay=!1,this._applyPlaybackSettingsToVisibleVideos(),Q.getFeatureFlags().prototypeVideosV2)for(let e of Array.from(this._deferredInteractionEvents.values()))e.status==0?this._registerDeferredInteractionEvent(e):e.status==2&&(this._deregisterDeferredInteractionEvent(e),this._deferredInteractionEvents.delete(e));Ei.VERBOSE_LOGS&&console.log(this.debugString())}this._invalidateTexturesOfPlayingVideos()}}resetAllRuntimesWithinNode(e){let t=new Jt(this._appState.scene().findNode1(e)),n=An.getSemanticNodePath(t),r=this._runtimeStorage.getSubTrie(n);r!=null&&r.forEach(o=>{o.resetToStartTime()})}resetAllRuntimesWithinTLFNode(e){let t=this._appState.scene().findNode1(e);for(let r=0,o=t.childCount();r<o;r=r+1){let i=t.childAt1(r);this.resetAllRuntimesWithinNode(i.id())}let n=this._runtimeStorage.getSubTrie([new Ba(t.name(),0)]);n!=null&&n.forEach(r=>{r.resetToStartTime()})}handleHsmAborted(e,t){}handleHsmCommitted(e,t,n){this._lastTransitionShouldForceStateRefresh=t.transitionParameters.transitionResetVideoPosition,t.transitionParameters.transitionResetVideoPosition&&this.resetAllRuntimesWithinNode(ie.List_last(e.guids)),this.reactToStateChange(this._visibilityTracker.getLastTopLevelStateChange(),t.getInsertedFrameIds())}handleHsmInitiated(e,t){}handleHsmRequested(e,t){}handleStateChangeCommitted(e,t){if(this._lastTransitionShouldForceStateRefresh=e.transitionParameters.transitionResetVideoPosition,e.transitionParameters.transitionResetVideoPosition){this.resetAllRuntimesWithinTLFNode(e.newStateId());let n=e.newOverlayData();for(let r=0,o=n.length;r<o;r=r+1)this.resetAllRuntimesWithinNode(n[r].id)}this.reactToStateChange(e,e.getInsertedFrameIds())}handleStateChangeAborted(e){}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._deleteVisibleRuntimes(),this._framePotentiallyReadyToPlay=!0}reactToStateChange(e,t){this._recalculateVisibleVideoPaints(e);let n=new Set;this._visibilityTracker.forEachVisiblePaint(r=>{if(!this._paintToNodeGUIDMap.has(r))return;let o=r.video().hash(),i=this._paintToNodeGUIDMap.get(r),a=this.getNodeMetadata(i).nodePath,s=this.getVideoRuntimeForPaint(r);s!=null&&n.add(s.id);let c=this._appState.scene().findNode2(i);for(let l of t){let u=this._appState.scene().findNode1(l);u!=null&&u.isAncestorOf(c)&&this._paintsForPlaybackSettingsRefresh.add(r)}if(s==null){let l=this._hashToRuntimeMap.get(o).clone();this._runtimeStorage.insert(a,o,l)}}),this._runtimeStorage.forEach(r=>{!n.has(r.id)&&r.isPlaying()&&r.pause()}),this._framePotentiallyReadyToPlay=!0}handleAction(e,t){this._userHasInteractedWithPage||(e==5||e==6||e==8||e==9||e==10)&&(this._userHasInteractedWithPage=!0,this._visibilityTracker.forEachVisiblePaint(n=>{let r=this.getVideoRuntimeForPaint(n),o=this.getPlaybackSettingsForPaint(n);r!=null&&o!=null&&!o.muted&&r.setMuted(o.muted)}),this._appState.removeActionObserver(this))}_applyPlaybackSettingsToVisibleVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{if(!this._paintsForPlaybackSettingsRefresh.has(e))return;this._paintsForPlaybackSettingsRefresh.delete(e);let t=this.getVideoRuntimeForPaint(e),n=this.getPlaybackSettingsForPaint(e);if(t!=null&&n!=null){t.setLoop(n.mediaLoop),this._lastTransitionShouldForceStateRefresh&&t.resetToDefaultState();let o=!Q.getFeatureFlags().prototypeVideosV2||t.overriddenMutedState==null?n.muted:t.overriddenMutedState.value;t.setMuted(o),(!Q.getFeatureFlags().prototypeVideosV2||t.overriddenPlayingState==null?n.autoplay:t.overriddenPlayingState.value)?t.play():t.pause()}})}_invalidateTexturesOfPlayingVideos(){this._visibilityTracker.forEachVisiblePaint(e=>{let t=this.getVideoRuntimeForPaint(e);t!=null&&t.isPlaying()&&t.invalidateTexture()})}_recalculateVisibleVideoPaints(e){Ei.VERBOSE_LOGS&&console.log("Recalculating visible paints"),this._visibilityTracker.handlePrototypeStateChange(e),this._visibilityTracker.forEachVisiblePaint(t=>{let n=this.getVideoRuntimeForPaint(t);n!=null&&n.startLoadIfNeeded()}),this._framePotentiallyReadyToPlay=!0}_deleteVisibleRuntimes(){Ei.VERBOSE_LOGS&&console.log("Deleting existing runtimes"),this._runtimeStorage.uninitialize1()}buildVideoResource(e){ro.instance().hasRequestedLibrary()||(ro.instance().onSuccess=()=>{for(let n of Array.from(this._deferredRuntimes.values()))n.startLoadIfNeeded()},ro.instance().requestLibrary());let t=new Wd(e,this);if(!this._hashToRuntimeMap.has(t.hash())){let n=At.getVideoPrefixUrl(),r=n!=null&&n.endsWith("/")?n:n+"/",o=`${r}${t.hash()}/manifest`,i=`${r}${t.hash()}`,a=new zs(t.hash(),o,i,this);this._hashToRuntimeMap.set(t.hash(),a)}return t}_allVisibleVideosAreLoaded(){let e=!0;return this._visibilityTracker.forEachVisiblePaint(t=>{let n=this.getVideoRuntimeForPaint(t);n!=null&&!n.isReadyToPlay()&&!n.isInErrorState()&&(e=!1)}),e}onVideoLoaded(e){this._appState.imageManager()==null||this._appState.imageManager().onImageLoaded==null||(this._allVisibleVideosAreLoaded()?(Ei.VERBOSE_LOGS&&console.log("VideoManager - - : All videos in frame are loaded!"),this._appState.baseScreenNode()!=null&&this._appState.imageManager().onImageLoaded(this._appState.baseScreenNode())):Ei.VERBOSE_LOGS&&console.log("VideoManager - - : Not all videos in frame are loaded"))}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this)}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){e.property==71&&(this._guidToVideoMetadata.set(R.toString(e.node.id()),new Ql(An.getSemanticNodePath(new Jt(e.node)),e.newVal)),this._paintToNodeGUIDMap.forEach((t,n)=>{t==R.toString(e.node.id())&&this._paintsForPlaybackSettingsRefresh.add(n)}),this._framePotentiallyReadyToPlay=!0)}debugString(){let e=`VideoManager 
`;return e+="Need to recalculate visible videos: "+this._needToRecalculateVisibleVideos.toString()+`
`,e+="Frame may be ready to start playing videos: "+this._framePotentiallyReadyToPlay.toString()+`
`,e+=`	Loading Runtimes:
`,this._hashToRuntimeMap.forEach((t,n)=>{e+="		hash: "+n+" -> "+t.toString()+`
`}),e+=`	VisiblePaints:
`,this._visibilityTracker.forEachVisiblePaint(t=>{let n=this.getPlaybackSettingsForPaint(t);n!=null?e+="		"+t.debugString()+" muted="+n.muted.toString()+" loop="+n.mediaLoop.toString()+" autoplay="+n.autoplay.toString()+" hash: "+t.video().hash()+`
`:e+="		"+t.debugString()+` (no playback settings found) 
`}),e+=`	Paint -> GUID:
`,this._paintToNodeGUIDMap.forEach((t,n)=>{e+="		P="+n.id().toString()+" => "+t+`
`}),e}enqueueVideoOrStartLoad(e){ro.instance().isLibAvailable()?e.startLoadIfNeeded():this._deferredRuntimes.add(e)}muteAllOtherVideos(e){this._runtimeStorage.forEach(t=>{t.id!=e.id&&t.setMuted(!0)})}},ui=Ei;ui.VERBOSE_LOGS=!1;var Nn=class{emitter(){return this._emitter}scene(){return this._scene}prototypeState(){return this._prototypeState}prototypeStructure(){return this._prototypeStructure}imageManager(){return this._imageManager}videoManager(){return this._videoManager}serialization(){return this._serialization}currentFileKey(){return this._currentFileKey}setCurrentFileKey(e){this._currentFileKey=e}fontListPromise(){return this._fontListPromise}setFontListPromise(e){this._fontListPromise=e}renderDots(){return this._renderDots}setRenderDots(e){this._renderDots=e}baseScreenId(){return this._prototypeState.getCurrentBaseScreenId()}currentFitMode(){return this._prototypeState.getCurrentFitMode()}baseScreenNode(){return this._scene==null?null:this._prototypeState.getCurrentBaseScreenNode()}constructor(e){this._appObservers=new lr,this._actionObservers=new lr,this._frameObservers=new lr,this._scene=null,this._canvas=null,this._prototypeState=null,this._prototypeStructure=null,this._imageManager=null,this._videoManager=null,this._serialization=null,this._currentFileKey="",this._activePrototypeStartingPointNodeId=null,this._renderDots=!1,this._fontListPromise=Promise.resolve(ir.VOID),this._emitter=null,this._pendingSetActiveCanvas=null,this._emitter=e,this._prototypeState=new En(this,this._emitter),this._prototypeStructure=new Ft(this,e),this._imageManager=new ya(this,()=>{this._emitter.trigger("showImageFetchFailureUI",{})}),this._videoManager=new ui(this),this._serialization=new pt(this._imageManager,this._videoManager),Rr&&x._prototypeLib==null&&x.initialize(pi,this)}addAppObserver(e){this._appObservers.add(e)}removeAppObserver(e){this._appObservers.remove(e)}addActionObserver(e){this._actionObservers.add(e)}removeActionObserver(e){this._actionObservers.remove(e)}addFrameObserver(e){this._frameObservers.add(e)}removeFrameObserver(e){this._frameObservers.remove(e)}nodeTransitionTracker(){return this._prototypeStructure.nodeTransitionTracker()}triggerAction1(e){this.triggerAction2(e,null)}triggerAction2(e,t){this._actionObservers.forEach(n=>{n.handleAction(e,t)})}onFrame(){this._frameObservers.forEach(e=>{e.onFrame()})}resetStateForTests(){this._prototypeState.resetState()}setScene(e){let t;if(e!=this._scene){let n=this._scene;this._scene=e,(t=this._scene)!=null&&t.markLoaded(),this._appObservers.forEach(r=>{r.handleSceneChange(n,e)}),n!=null&&n.destroy(),this._scene==null?this.setActiveCanvas(null):this.setActiveCanvas(this._scene.firstUserCanvasOrNull())}}requestSetActiveCanvas(e){e.hasBeenLoaded()?this.setActiveCanvas(e):(this._pendingSetActiveCanvas=e,this.triggerAction2(11,Z.new5(e)))}trySettingRequestedActiveCanvas(){this._pendingSetActiveCanvas!=null&&this._pendingSetActiveCanvas.hasBeenLoaded()&&(this.setActiveCanvas(this._pendingSetActiveCanvas),this._pendingSetActiveCanvas=null)}setActiveCanvas(e){if(this._canvas!=e){let t=this._canvas;this._canvas=e,this._appObservers.forEach(n=>{n.handleActiveCanvasChange(t,this._canvas)})}}getActiveCanvas(){return this._canvas!=null&&this._scene==null?(console.warn("getActiveCanvas called with null scene but non-null canvas"),null):this._canvas}activePrototypeDevice(){var t;let e;return(t=this.getActiveCanvas())==null?void 0:t.prototypeDevice()}storedPrototypeDevice(){var t;let e;return(t=this.getActiveCanvas())==null?void 0:t.storedPrototypeDevice()}activePrototypeStartingPointNodeId(){return this._activePrototypeStartingPointNodeId}setActivePrototypeStartingPointNodeId(e){let t=this._activePrototypeStartingPointNodeId;this._activePrototypeStartingPointNodeId=e,this._appObservers.forEach(n=>{n.handleActivePrototypeStartingPointChange(t,e)})}};var rn=class{constructor(){this._callbacks=new Map,this.on=null,this.off=null,this.trigger=null,this.on=(e,t)=>{ie.List_appendOne(this._list(e),t)},this.off=(e,t)=>{ie.List_removeOne(this._list(e),t)},this.trigger=(e,t)=>{let n=this._list(e).slice();for(let r of n)r(t)}}_list(e){return this._callbacks.has(e)?this._callbacks.get(e):(this._callbacks.set(e,[]),this._callbacks.get(e))}};(t=>{class g{handleAction(r,o){switch(r){case 5:{this._emitter.trigger("mirror-tap",null);break}case 6:{this._emitter.trigger("canvasMouseDown",Z.asVector(o).toJSON());break}case 7:{this._emitter.trigger("canvasMouseMove",Z.asVector(o).toJSON());break}case 8:{this._emitter.trigger("canvasMouseDrag",Z.asVector(o).toJSON());break}case 9:{this._emitter.trigger("canvasMouseUp",Z.asVector(o).toJSON());break}case 10:{this._emitter.trigger("canvasTouchDown",Z.asVector(o).toJSON());break}}}constructor(r){this._emitter=r}}t.ActionHandler=g;class e{onFrame(){let r=this._state.baseScreenNode()!=null;this._visible!=r&&(this._visible=r,this._emitter.trigger("baseScreenVisibilityChange",this._visible))}constructor(r,o){this._emitter=r,this._state=o,this._visible=!1}}t.AppHandler=e})(rn||(rn={}));var Kd;(t=>{function g(){return R._new(-1,t._nextLocalID=t._nextLocalID+1)}t.generateId=g,t._nextLocalID=0})(Kd||(Kd={}));var ec;(t=>{function g(n){return R._new(n,t._nextLocalID=t._nextLocalID+1)}t.make=g,t._nextLocalID=0})(ec||(ec={}));var Ci=class{constructor(){this.assertEquals=AssertLib.strictEqual,this.trackingCalls=[],this._uninstall=null,this._uninstall=Je.mockTrackEvent((e,t,n)=>{this.trackingCalls.push(new Ci.TrackingPayload(e,t,n))})}uninstall(){this._uninstall()}expectTrackToHaveBeenCalledWith1(e,t){this.expectTrackToHaveBeenCalledWith2(e,t,{})}expectTrackToHaveBeenCalledWith2(e,t,n){this.trackingCalls.some(r=>r.equalsWithSubsetOfArgs(new Ci.TrackingPayload(e,t,n)))}};(e=>{class g{equalsWithSubsetOfArgs(n){if(this.name!=n.name)return!1;for(let r of Object.keys(n.args))if(n.args[r]!==this.args[r])return!1;for(let r of Object.keys(n.options))if(n.options[r]!==this.options[r])return!1;return!0}constructor(n,r,o){this.name=n,this.args=r,this.options=o}}e.TrackingPayload=g})(Ci||(Ci={}));function dr(g){if(!x.isTestingEnv())throw new Error(g)}function Wg(g){$a=$a+1;let e=R._new(1,$a);for(let t=0,n=g.totalNodeCount();t<n&&g.findNode1(e)!=null;t=t+1)$a=$a+1,e=R._new(1,$a);return e}function Er(g,e){let t=g.scene().createNode1(Wg(g.scene()));return t.setVisible(!0),t.setOpacity(1),t.setType(e),e!="CANVAS"&&e!="DOCUMENT"&&(t.setRelativeTransform(ee.new2()),t.setSize(new I(100,100))),g.appendChild(t),t}function ct(g,e){return Mn(g,e,E.BLACK)}function oo(g,e,t){let n=Er(g,"FRAME");return n.setName(e),n.setBackgroundOpacity(1),n.setIsBackgroundEnabled(!0),n.setIsFrameMaskDisabled(!1),n.setIsResizeToFit(!1),n.setContainerSupportsFillStrokeAndCorners(!0),n.setTestOnlyFillPaints2([t]),n}function va(g,e,t,n,r){let o=Er(g,"FRAME");return o.setName(e),o.setBackgroundOpacity(1),o.setIsBackgroundEnabled(!0),o.setIsFrameMaskDisabled(!1),o.setIsResizeToFit(!1),o.setContainerSupportsFillStrokeAndCorners(!0),o.setTestOnlyFillPaints(t),o.setTestOnlyStrokeGeometry(new Dn([new Hn("NONZERO",0,vt.forCenterStrokeAroundRect(r,10),r)],null,r,null)),o.setTestOnlyStrokePaints(n),o}function Mn(g,e,t){let n=new ne("SOLID");return n.setColor(t),n.setOpacity(1),n.setIsEnabled(!0),oo(g,e,n)}function vm(g,e){let t=ne.createLinearGradient([new lt(E.new3(1,.5,0,1),.25),new lt(E.new3(0,.5,1,1),.75)]);return oo(g,e,t)}function Zo(g){let e=Er(g,"FRAME");return e.setName("Group"),e.setBackgroundOpacity(1),Ji(e,!1),e.setIsResizeToFit(!0),e}function es(g){let e=Er(g,"BOOLEAN_OPERATION");return e.setName("Boolean Operation"),e.setBackgroundOpacity(1),e.setIsBackgroundEnabled(!1),e.setIsResizeToFit(!0),e}function Ni(g,e){let t=Zo(g);return t.setName(e),t}function mt(g){return ct(g,"Frame")}function Im(g){return Er(g,"VECTOR")}function Cr(g){return Er(g,"RECTANGLE")}function rt(g,e){let t=Cr(g);return t.setName(e),t}function Am(g,e){let t=Er(g,"ROUNDED_RECTANGLE");return t.setCornerRadius(e),t}function qd(g){return Er(g,"TEXT")}function Kg(g,e){let t=qd(g);return t.setName(e),t}function Qo(g){return Er(g,"SYMBOL")}function ji(g,e){let t=Er(g,"INSTANCE");return t.setTestOnlySymbolData(new ti(e.id(),go.new1([],[]))),t}function Do(g){let e=new B(0,0,g.width(),g.height()),t=new Hn("NONZERO",0,Dt.fromRect(e),e);return new Dn([t],null,t.bounds(),new ao(new Yn))}function Em(g,e){let t=new Hn("NONZERO",0,vt.fromRoundedRect1(new Li(2,B.new3(g),e,null,0)),g);return new Dn([t],null,t.bounds(),new ao(new Yn))}function Cm(g){let e=vt.new2();e.moveTo1(g.topLeft().x(),g.topLeft().y()).lineTo(g.topRight().x(),g.topRight().y()).lineTo(g.bottomLeft().x(),g.bottomLeft().y()).close();let t=new Hn("NONZERO",0,e,g);return new Dn([t],null,t.bounds(),new ao(new Yn))}function Nm(g){let e=[];bt.INSTANCE.reset();for(let t of g)e.push(new Hn("NONZERO",0,vt.fromRect(t),t)),bt.INSTANCE.include3(t);return new Dn(e,null,bt.INSTANCE.build(),new ao(new Yn))}function ts(g,e){Yd(g,e.id())}function Yd(g,e){let t=g.prototypeInteractions().length==0?jt.createDefault():g.prototypeInteractions()[0],n=t.action()!=null?t.action().value:qn.createDefault();g.setTestOnlyPrototypeInteractions([t.withActions([n.withTransitionNodeID(e).withConnectionType("INTERNAL_NODE")])].slice())}function Ln(g,e,t,n,r){return tc(g,e,t,n,r,!1)}function tc(g,e,t,n,r,o){switch(r){case"NAVIGATE":{ts(g,e);break}case"OVERLAY":{Ws(g,e);break}case"SWAP":{jd(g,e);break}case"SWAP_STATE":{qg(g,e);break}}let i=g.prototypeInteractions()[0];return g.setTestOnlyPrototypeInteractions([i.withEvent(i.event().withInteractionType(t)).withActions([i.action().value.withTransitionType(n).withTransitionShouldSmartAnimate(o)]).withStateManagementVersion(Q.getFeatureFlags().prototypeStateManagement?1:0)].slice()),g.prototypeInteractions()[0]}function nc(g){let e=g.prototypeInteractions().length==0?jt.createDefault():g.prototypeInteractions()[0],t=e.action()!=null?e.action().value:qn.createDefault();g.setTestOnlyPrototypeInteractions([e.withActions([t.withConnectionType("BACK")])].slice())}function Ws(g,e){Xd(g,e,I.new2())}function Xd(g,e,t){let n=g.prototypeInteractions().length==0?jt.createDefault():g.prototypeInteractions()[0],r=n.action()!=null?n.action().value:qn.createDefault();g.setTestOnlyPrototypeInteractions([n.withActions([r.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withOverlayRelativePosition(t).withNavigationType("OVERLAY")])].slice())}function jd(g,e){let t=g.prototypeInteractions().length==0?jt.createDefault():g.prototypeInteractions()[0],n=t.action()!=null?t.action().value:qn.createDefault();g.setTestOnlyPrototypeInteractions([t.withActions([n.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP")])].slice())}function qg(g,e){let t=g.prototypeInteractions().length==0?jt.createDefault():g.prototypeInteractions()[0],n=t.action()!=null?t.action().value:qn.createDefault();g.setTestOnlyPrototypeInteractions([t.withActions([n.withTransitionNodeID(e.id()).withConnectionType("INTERNAL_NODE").withNavigationType("SWAP_STATE")])].slice())}function Jd(g){let e=g.prototypeInteractions().length==0?jt.createDefault():g.prototypeInteractions()[0],t=e.action()!=null?e.action().value:qn.createDefault();g.setTestOnlyPrototypeInteractions([e.withActions([t.withConnectionType("CLOSE")])].slice())}function rc(g,e){let t=g.prototypeInteractions().length==0?jt.createDefault():g.prototypeInteractions()[0];g.setTestOnlyPrototypeInteractions([t.withEvent(t.event().withInteractionType(e))].slice())}function Ze(g,e,t){let n=ee.new2();n.translate1(e),g.setRelativeTransform(n),g.setSize(t)}function de(g,e){let t=rt(g,e);return t.setTestOnlyFillPaints([ne.createSolid(E.RED,1)]),t.setTestOnlyFillGeometry(Do(B.new4(new I(0,0),t.size()))),t}function kt(g,e,t,n){let r=rt(g,e);return r.setTestOnlyFillPaints([ne.createSolid(t,n)]),r.setTestOnlyFillGeometry(Do(B.new4(new I(0,0),r.size()))),r}function oc(g,e,t){let n=rt(g,e);return n.setTestOnlyFillPaints3(t),n.setTestOnlyFillGeometry(Do(B.new4(new I(0,0),n.size()))),n}function Ks(g,e,t){let n=rt(g,e);return n.setSize(t),n.setTestOnlyFillPaints(Re.fromPaint(new ne("IMAGE"))),n.setTestOnlyFillGeometry(Do(B.new4(new I(0,0),n.size()))),n}function Zd(g,e,t){let n=Er(g,"VECTOR");return n.setName(e),n.setSize(t),n.setTestOnlyFillPaints(Re.fromPaint(new ne("IMAGE"))),n.setTestOnlyFillGeometry(Cm(B.new4(new I(0,0),n.size()))),n}function Nr(g,e,t,n,r){let o=rt(g,e);return o.setSize(r),o.setTestOnlyFillPaints([ne.createSolid(t,n)]),o.setTestOnlyFillGeometry(Do(B.new4(new I(0,0),o.size()))),o}function Qd(g,e,t,n,r){let o=Er(g,"VECTOR");return o.setName(e),o.setSize(r),o.setTestOnlyFillPaints([ne.createSolid(t,n)]),o.setTestOnlyFillGeometry(Cm(B.new4(new I(0,0),o.size()))),o}function Om(g,e){let t=Kg(g,e);return t.setTestOnlyFillPaints([ne.createSolid(E.RED,1)]),t.setTestOnlyTextData(Hr.forTests1()),t}function $d(g){ic(g,[])}function ic(g,e){if(dr("Should only be used in tests"),x._prototypeLib==null)throw new Error("Expected PrototypeLib to be initialized");let t=[g],n=[];for(let i=0,a=e.length;i<a;i=i+1){let s={};s.bytes=e[i],n.push(s)}let r={type:"NODE_CHANGES",sessionID:0,ackID:0,blobs:n,nodeChanges:t},o=Se.schema.encodeMessage(r);x._prototypeLib.applyLocalNodeChangesForTests(o)}function Ji(g,e){if(dr("Writing to paints is only supported in tests because it's not fully implemented"),ln.isFrameLike(g.type())){let t=[],n=g.fillPaints();if(n!=null)for(let r=0,o=n.length;r<o;r=r+1){let i=n[r].clone();i.setIsEnabled(e),t.push(i)}g.setTestOnlyFillPaints(t)}else g.setIsBackgroundEnabled(!1)}var $a=0;var Ia=class{findNodeFromDeveloperFriendlyId(e){if(e.charCodeAt(0)==84){let t=e.slice(1).split(";");if(t.length!=3)return console.error("Table cell developer friendly id does not have 3 guids"),null;let n=R.fromString(t[0]),r=this.findNode1(n);if(r==null)return console.error("Cannot find table from table cell developer friendly id"),null;let o=R.fromString(t[1]),i=R.fromString(t[2]);return r.getTableCellAt(o,i)}else if(e.charCodeAt(0)==73){let t=e.slice(1).split(";"),n=R.fromString(t[0]),r=this.findNode1(n),o=null;o=(a,s)=>{if(a==null)return null;if(s(a))return a;for(let c=0,l=a.childCount();c<l;c=c+1){let u=o(a.childAt1(c),s);if(u!=null)return u}return null};let i=new wt(t.map(a=>R.fromString(a)));return o(r,a=>wt.equals(a.stablePath(),i))}else return this.findNode2(e)}constructor(e,t){this._handle=0,this._observers=new lr,this._nodes=new Map,this._cachedRoot=null,this._interactiveComponentsEnabled=!1,this._isBetweenJoinStartAndJoinEnd=!1,this._loadedTlfs=[],this._deferUnregisteringNodes=!1,this._deferredUnregisters=null,this._interactiveComponentsEnabled=t==0,this._handle=e}handle(){return this._handle}interactiveComponentsEnabled(){return this._interactiveComponentsEnabled}setInteractiveComponentsEnabledForTesting(e){this._interactiveComponentsEnabled=e}firstUserCanvasOrNull(){for(let e=0,t=this.root().childCount();e<t;e=e+1){let n=this.root().childAt1(e);if(n.type()=="CANVAS"&&!n.isInternalOnly())return n}return null}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}broadcastPropertyChange(e){Ia.VERBOSE&&console.log(`broadcasting change for property '${Rt[e.property]}' on node '${R.toString(e.node.id())}'`),this._observers.forEach(t=>{t.handleSceneGraphEvent(e)})}isLoadedTlfsEmpty(){return this._loadedTlfs.length==0}setAllTlfsLoaded(){this.setTlfsLoaded(e=>!0)}setTlfsLoaded(e){this._loadedTlfs=[],Se.forEachNode1(this.root(),t=>t.type()=="DOCUMENT"||t.type()=="CANVAS"||t.type()=="SECTION"?Se.Loop.CONTINUE:t.isTopLevel()?(t.setHasBeenLoaded(e(t)),t.hasBeenLoaded()&&this._loadedTlfs.push(t),Se.Loop.CONTINUE):Se.Loop.SKIP)}hierarchyDebugString(){let e="",t=(n,r)=>{let o,i=(o=n.symbolID())!=null?R.toString(o):null,a=i!=null?` -> ${i}`:"";e+=`${r}${R.toString(n.id())} ${n.name()}${a}
`,r+="  ";for(let s=0,c=n.childCount();s<c;s=s+1)t(n.childAt1(s),r)};return t(this.root(),""),e}dangerouslyRegisterNode(e){if(e.scene()!=this)throw new Error("Scene mismatch when registering node");let t=this.findNode2(R.toString(e.id()));if(t!=null&&t!=e)throw new Error("Unexpected existing node when registering node");this._nodes.set(R.toString(e.id()),e)}dangerouslyUnregisterNode(e){if(this._deferUnregisteringNodes){this._deferredUnregisters.push(e);return}this._nodes.delete(R.toString(e)),R.isRoot(e)&&(this._cachedRoot=null)}dangerouslyDeferNodeRemovalScope(e){this._deferredUnregisters=[],this._deferUnregisteringNodes=!0,e(),this._deferUnregisteringNodes=!1;for(let t of this._deferredUnregisters)this.dangerouslyUnregisterNode(t);this._deferredUnregisters=null}markLoaded(){let e;(e=x._prototypeLib)!=null&&e.markSceneLoaded(this)}destroy(){let e;(e=x._prototypeLib)!=null&&e.destroyScene(this)}setFileKey(e){let t;(t=x._prototypeLib)!=null&&t.modules().prototype.setSceneMetadata(e)}applyMessageToScene(e){let t,n=We.milliseconds();(t=x._prototypeLib)!=null&&t.applyNodeChanges(e);let r=We.milliseconds()-n;r>100&&console.warn(`applyMessageToScene took ${r/1e3} seconds`)}totalNodeCount(){return this._nodes.size}each(e){Me.StringMap_each(this._nodes,(t,n)=>{e(n)})}findNode1(e){return this.findNode2(e!=null?R.toString(e):null)}findNode2(e){return e==null?null:Me.StringMap_get(this._nodes,e,null)}findNode3(e){if(e==null||e.guids==null)return null;let t=x._prototypeLib.findNode(this,e);return this.findNode1(t)}findStyle(e){let t=x._prototypeLib.sceneGraphTsApi().styleByIdOrNull(e);return this.findNode1(t)}createNode1(e){return this.createNode2(e,new wt([e]))}createNode2(e,t){if(!x.isTestingEnv())throw new Error("Should not be creating nodes in Skew while running fullview");let n={};return n.guid=pt.encodeGUID(e),n.phase="CREATED",$d(n),this.findNode1(e)}removeNode(e){if(!x.isTestingEnv())throw new Error("Should not be removing nodes in Skew while running fullview");let t={};t.guid=pt.encodeGUID(e),t.phase="REMOVED",$d(t);let n=this.findNode1(e)}root(){return this._cachedRoot==null&&(this._cachedRoot=this.findNode1(R._new(0,0)),this._cachedRoot.updateIsRooted()),this._cachedRoot}regenerateDirtySymbolInstances(e){x._prototypeLib.updateSymbolInstancesForTests()}updateDirtyStyleConsumers(){x._prototypeLib.updateStylesForTests()}static createCanvasInScene(e,t){let n=e.createNode1(t);return n.setType("CANVAS"),n.setVisible(!0),n.setOpacity(1),n.setName("canvas"),n.setCurrentViewportSize(new I(1e6,1e6)),e.root().appendChild(n),n}static createLoadedFrameWithCanvasContent(e,t){let n=new bt,r=[];Se.forEachNode1(t,s=>s.isTopLevel()?(n.include3(s.fullSizeCanvasSpaceBoundingBox()),r.push(s),Se.Loop.SKIP):Se.Loop.CONTINUE);let o=n.build();o.expand1(150);let i=t.fillPaintsToRender()[0].asSinglePaint();i.opacity()==0&&(i=ne.createSolid(E.WHITE,1));let a=oo(t,"frame",i);Ze(a,o.topLeft(),o.size()),a.setTestOnlyFillGeometry(Do(a.fullSizeCanvasSpaceBoundingBox()));for(let s of r){let c=s.relativeTransform().clone();c.translate1(a.relativeTransform().translation().negative()),s.setParentIndex(new kn(R.invalid(),sn.fromString(""))),a.appendChild(s),s.setRelativeTransform(c)}return e.setTlfsLoaded(s=>s==a?!0:s.hasBeenLoaded()),a}static createScene(e,t){return x._prototypeLib.createSceneAndSetActive(e,t)}static createSceneWithCanvasForTests1(){return Ia.createSceneWithCanvasForTests2(Q.ViewerMode.PROTOTYPE,1)}static createSceneWithCanvasForTests2(e,t){let n;new Nn(new rn),Q.setViewerMode(e);let r=Ia.createScene(Ia.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,t);return(n=x._prototypeLib)!=null&&n.modules().prototype.setSceneMetadata("1"),Ia.createCanvasInScene(r,R._new(0,1)),r.markLoaded(),r}},yt=Ia;yt.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER=dt.int_MAX()-1,yt.VERBOSE=!1;var eu=class{constructor(e,t,n,r){this.node=e,this.property=t,this.oldVal=n,this.newVal=r}};var tu=class{name(){return this._file.name}mimeType(){return this._file.type}bytes(){return this._promise==null&&(this._promise=new Promise((e,t)=>{let n=new FileReader;n.onload=()=>{e(new Uint8Array(sl.FileReader_resultAsArrayBuffer(n)))},n.onloadend=()=>{t(ir.VOID)},n.readAsArrayBuffer(this._file)})),this._promise}constructor(e){this._file=e,this._promise=null}};function Yg(g){let e=new Map;return Ht.IntMap_each(g,(t,n)=>{let r=n;if(e.has(r)){e.get(r).push(t);return}e.set(r,[t])}),e}var nu=new Map([[8,1],[9,2],[10,3],[13,3],[16,107],[17,108],[18,105],[19,5],[20,6],[27,7],[32,8],[33,9],[34,10],[35,11],[36,12],[37,13],[38,14],[39,15],[40,16],[44,17],[45,18],[46,19],[48,20],[49,21],[50,22],[51,23],[52,24],[53,25],[54,26],[55,27],[56,28],[57,29],[59,90],[61,93],[63,30],[65,31],[66,32],[67,33],[68,34],[69,35],[70,36],[71,37],[72,38],[73,39],[74,40],[75,41],[76,42],[77,43],[78,44],[79,45],[80,46],[81,47],[82,48],[83,49],[84,50],[85,51],[86,52],[87,53],[88,54],[89,55],[90,56],[91,106],[92,106],[93,57],[96,58],[97,59],[98,60],[99,61],[100,62],[101,63],[102,64],[103,65],[104,66],[105,67],[106,68],[107,69],[109,70],[110,71],[111,72],[112,76],[113,77],[114,78],[115,79],[116,80],[117,81],[118,82],[119,83],[120,84],[121,85],[122,86],[123,87],[144,88],[145,89],[173,91],[186,90],[187,93],[188,94],[189,91],[190,95],[191,96],[192,104],[219,99],[220,100],[221,101],[222,98],[224,106]]),Rm=Yg(nu);var Oi=(b=>(b[b.NONE=0]="NONE",b[b.WINDOW_VISIBILITY=1]="WINDOW_VISIBILITY",b[b.WINDOW_RESIZE=2]="WINDOW_RESIZE",b[b.WINDOW_FRAME=3]="WINDOW_FRAME",b[b.MOUSE_MOVE=4]="MOUSE_MOVE",b[b.MOUSE_PRESS=5]="MOUSE_PRESS",b[b.MOUSE_DRAG=6]="MOUSE_DRAG",b[b.MOUSE_RELEASE=7]="MOUSE_RELEASE",b[b.MOUSE_SCROLL=8]="MOUSE_SCROLL",b[b.MOUSE_DROP=9]="MOUSE_DROP",b[b.MOUSE_LEAVE=10]="MOUSE_LEAVE",b[b.TOUCH_PRESS=11]="TOUCH_PRESS",b[b.TOUCH_DRAG=12]="TOUCH_DRAG",b[b.TOUCH_RELEASE=13]="TOUCH_RELEASE",b[b.KEY_PRESS=14]="KEY_PRESS",b[b.KEY_RELEASE=15]="KEY_RELEASE",b[b.GAMEPAD_DOWN=16]="GAMEPAD_DOWN",b[b.ON_MEDIA_HIT=17]="ON_MEDIA_HIT",b))(Oi||{}),Mo=class{type(){return this._type}target(){return this._target}modifiers(){return this._modifiers}asMouseEvent(){return null}asTouchEvent(){return null}asKeyEvent(){return null}asGamepadEvent(){return null}isAccepted(){return this._isAccepted}accept(){this._isAccepted=!0}constructor(e,t,n){this._type=e,this._target=t,this._modifiers=n,this._isAccepted=!1}},ru=(t=>(t[t.MOUSE=0]="MOUSE",t[t.TOUCH=1]="TOUCH",t))(ru||{}),Qi=class extends Mo{interactionType(){return 0}asMouseEvent(){return this}interactionCount(){return 1}locationInView(e){let t=e.absoluteBounds();return new I(this.locationInWindow.x()-t.x(),this.locationInWindow.y()-t.y())}previousLocationInView(e){let t=e.absoluteBounds();return new I(this.previousLocationInWindow.x()-t.x(),this.previousLocationInWindow.y()-t.y())}delta(){return this.locationInWindow.subtract1(this.previousLocationInWindow)}clone(){return new Qi(this.type(),this.target(),this.modifiers(),this.locationInWindow,this.previousLocationInWindow,this.scrollDelta,this.clickCount,this.droppedFiles)}constructor(e,t,n,r,o,i,a,s){super(e,t,n);this.locationInWindow=r,this.previousLocationInWindow=o,this.scrollDelta=i,this.clickCount=a,this.droppedFiles=s}},Ys=class{locationInView(e){let t=e.absoluteBounds();return new I(this.locationInWindow.x()-t.x(),this.locationInWindow.y()-t.y())}previousLocationInView(e){let t=e.absoluteBounds();return new I(this.previousLocationInWindow.x()-t.x(),this.previousLocationInWindow.y()-t.y())}constructor(e,t,n,r){this.id=e,this.originalTarget=t,this.locationInWindow=n,this.previousLocationInWindow=r}},Fm=class{constructor(e,t,n){this.centroid=e,this.distance=t,this.count=n}},$o=class extends Mo{interactionType(){return 1}asTouchEvent(){return this}interactionCount(){return this.touches.length}locationInView(e){return this.touches[0].locationInView(e)}previousLocationInView(e){return this.touches[0].previousLocationInView(e)}summaryInView(e){return e==null?$o._summarizeTouches(this.touches,t=>t.locationInWindow):$o._summarizeTouches(this.touches,t=>t.locationInView(e))}previousSummaryInView(e){return e==null?$o._summarizeTouches(this.touches,t=>t.previousLocationInWindow):$o._summarizeTouches(this.touches,t=>t.previousLocationInView(e))}delta(){return this.summaryInView(null).centroid.subtract1(this.previousSummaryInView(null).centroid)}static _summarizeTouches(e,t){let n=I.new2(),r=0;if(e.length!=0){for(let o of e)n.addUpdate1(t(o));n.divideUpdate(e.length);for(let o of e)r+=t(o).distanceTo(n);r/=e.length}return new Fm(n,r,e.length)}constructor(e,t,n,r,o){super(e,t,n);this.touches=r,this.allTouches=o,this.scrollDelta=null}},rs=class extends Mo{asKeyEvent(){return this}constructor(e,t,n,r,o){super(e,t,n);this.key=r,this.isRepeat=o}},ou=class extends Mo{asGamepadEvent(){return this}constructor(e,t,n,r,o){super(e,t,n);this.button=r,this.controllerType=o}},$n;(n=>{function g(r){return r.length}n.handlerCount=g;function e(r,o){ie.List_appendOne(r,o)}n.addUpdate=e;function t(r,o){ie.List_removeOne(r,o)}n.subtractUpdate=t})($n||($n={}));var zt;(T=>{function g(N){return p(N,1)}T.windowVisibility=g;function e(N){return p(N,2)}T.windowResize=e;function t(N){return p(N,3)}T.windowFrame=t;function n(N){return p(N,4)}T.mouseMove=n;function r(N){return p(N,5)}T.mousePress=r;function o(N){return p(N,6)}T.mouseDrag=o;function i(N){return p(N,7)}T.mouseRelease=i;function a(N){return p(N,8)}T.mouseScroll=a;function s(N){return p(N,9)}T.mouseDrop=s;function c(N){return p(N,10)}T.mouseLeave=c;function l(N){return p(N,11)}T.touchPress=l;function u(N){return p(N,12)}T.touchDrag=u;function d(N){return p(N,13)}T.touchRelease=d;function h(N){return p(N,14)}T.keyPress=h;function S(N){return p(N,15)}T.keyRelease=S;function f(N){return p(N,16)}T.gamepadDown=f;function y(N,k,j){ie.List_appendOne(p(N,k),j)}T.on=y;function v(N,k,j){let te=m(N,k);te!=null&&ie.List_removeOne(te,j)}T.off=v;function b(N,k){let j=m(N,k.type());if(j!=null){for(let te of j)if(te(k),k.isAccepted())break}}T.trigger=b;function m(N,k){return Ht.IntMap_get(N,k,null)}T._handlers=m;function p(N,k){let j=Ht.IntMap_get(N,k,null);return j==null&&(j=[],N.set(k,j)),j}T._createHandlers=p;function _(){return new Map}T._new=_})(zt||(zt={}));var wm;(e=>{function g(){return new Map}e._new=g})(wm||(wm={}));var sc;(t=>{function g(n){return Me.StringMap_get(t._triggerDeviceMap,n,"UNKNOWN_CONTROLLER")}t.stringToTriggerDevice=g,t._triggerDeviceMap=new Map([["KEYBOARD","KEYBOARD"],["UNKNOWN_CONTROLLER","UNKNOWN_CONTROLLER"],["XBOX_ONE","XBOX_ONE"],["PS4","PS4"],["SWITCH_PRO","SWITCH_PRO"]])})(sc||(sc={}));var ns;(t=>{function g(n,r,o,i){return Ht.IntMap_get(n,r<<8|o,i)}t.KeyShortcutMap_get=g;function e(n,r,o,i){n.set(r<<8|o,i)}t.KeyShortcutMap_set=e})(ns||(ns={}));var Zi;(s=>{function g(c){return c==1||c==2||c==3}s.ViewerEventType_isWindowEventType=g;function e(c){return c==4||c==5||c==6||c==7||c==8||c==9||c==10}s.ViewerEventType_isMouseEventType=e;function t(c){return c==11||c==12||c==13}s.ViewerEventType_isTouchEventType=t;function n(c){return c==14||c==15}s.ViewerEventType_isKeyEventType=n;function r(c){return c==11||c==13||c==5||c==7||c==8||c==9}s.ViewerEventType_isTypeToBeBlockedByDeviceFrame=r;function o(c){return Me.StringMap_get(s.ViewerEventType__eventTypeFromString,c,0)}s.ViewerEventType_fromString=o;function i(c){return Oi[c]}s.ViewerEventType_toString=i,s.ViewerEventType__eventTypeFromString=new Map([["NONE",0],["WINDOW_VISIBILITY",1],["WINDOW_RESIZE",2],["WINDOW_FRAME",3],["MOUSE_MOVE",4],["MOUSE_PRESS",5],["MOUSE_DRAG",6],["MOUSE_RELEASE",7],["MOUSE_SCROLL",8],["MOUSE_DROP",9],["MOUSE_LEAVE",10],["TOUCH_PRESS",11],["TOUCH_DRAG",12],["TOUCH_RELEASE",13],["KEY_PRESS",14],["KEY_RELEASE",15],["GAMEPAD_DOWN",16]])})(Zi||(Zi={}));var Pm;(e=>{function g(t){return ru[t]}e.InteractionType_toString=g})(Pm||(Pm={}));var qs;(t=>{function g(n){return n>=105&&n<=108}t.Key_isModifier=g;function e(n){return Ht.IntMap_get(Rm,n,[0])}t.Key_keyToKeyCode=e})(qs||(qs={}));var Aa;(e=>{function g(){return tt.OS_current()==4?2:8}e.Modifiers_currentPlatformModifier=g})(Aa||(Aa={}));var Mm=(t=>(t[t.RENDER=0]="RENDER",t[t.PERFORMANCE=1]="PERFORMANCE",t))(Mm||{}),Ri=class{static instance(){return Ri._instance==null&&(Ri._instance=new Ri),Ri._instance}requestWithSecret(e){let t=`secret=${encodeURIComponent(this.secret)}`;return new Kr(e+(e.indexOf("?")!=-1?"&":"?")+t)}getArgv(){return new Promise((e,t)=>{this.requestWithSecret("/rpc/argv").get().then(n=>{e(JSON.parse(n.text))})})}readFile(e,t){return this.requestWithSecret(`/rpc/file?path=${e}`).format(t).get()}writeFile(e,t){return this.requestWithSecret(`/rpc/file?path=${e}`).send2("POST",t)}exit(){this.requestWithSecret("/rpc/process?returnCode=0").send3("DELETE")}queryArgs(){let e=new Map,t=window.location.search;if(t.length==0)return e;t=t.slice(1);for(let n of t.split("&")){let r=n.split("=");r.length==2&&e.set(r[0],r[1])}return e}resolveFromBasePath(e){return e.startsWith("/")?e:this.basePath+"/"+e}afterRenderingCompletes(e){let t=()=>{this._triggerOnFrameCallbacksForTesting(),this.testMode==0&&this.app.canvasView().renderingIsComplete()&&!this.app.state().imageManager().hasPendingImages()||this.testMode==1&&!this.app.canvasView().isTopLevelTransitionOngoing()&&!this.app.state().imageManager().hasPendingImages()?e():requestAnimationFrame(t)};requestAnimationFrame(t)}afterInitialLoad(e){let t=()=>{e(),this.viewer.off("sceneDidCompleteInitialLoad",t)};this.viewer.on("sceneDidCompleteInitialLoad",t)}convertTitleToFilename(e,t,n,r,o){let i=t.trim();return o>0?`${i}${n}-${o}${r}`:`${i}${n}${r}`}figFileToName(e){let t=e.split("/");return t[t.length-1].replace(new RegExp(".fig$","g"),"")}computeBoundsForExport(e){let t=B.new3(e.canvasSpaceRenderedBounds());(ln.isFrameLike(e.type())||e.type()=="SLICE")&&(t.isInvalid()?t=e.canvasSpaceBoundingBox():t.expandToInclude(e.canvasSpaceBoundingBox()));for(let n=e.parent();n!=null;n=n.parent())n.clipsToBoundingRectangle()&&t.intersectWith(n.canvasSpaceRenderedBounds());return t}saveCanvasContentToPathAsync(e,t){this.app.canvasView().getContext().gl().canvas.toBlob(r=>{this.writeFile(e,r).then(o=>{t()})})}_assertCurrentModeIsOneOf(e,t){if(e.indexOf(Q.getViewerMode())==-1){let n=e.map(r=>Q.ViewerMode[r]);throw new Error(`Command ${JSON.stringify(t)} is supported only in modes ${n}`)}}runNextCommand(){if(this.commandQueue.length==0){this.exit();return}let e=this.commandQueue.shift();switch(e.type){case"load-canvas-as-prototype":{this._assertCurrentModeIsOneOf([Q.ViewerMode.PROTOTYPE],e),console.log(e.type,e.figFile),this.figFileName=this.figFileToName(e.figFile),this.readFile(this.resolveFromBasePath(e.figFile),1).then(t=>{this.app.state().imageManager().resetForRenderingTests(),this.viewer.loadFile({bytes:t.bytes},this.initializePrototypeLib),this.afterInitialLoad(()=>{let n=yt.createLoadedFrameWithCanvasContent(this.app.state().scene(),this.app.state().getActiveCanvas()),r=n.canvasSpaceRenderedBounds();this.resize(r.width(),r.height()),this.app.state().prototypeState().setFitModeFromParameter("contain"),this.app.state().prototypeState().navigateToFrameAndCloseOverlays1(n.id()),this.commandQueue.unshift({type:"save-canvas-as-image",outFile:e.outFile}),this.afterRenderingCompletes(()=>{this.runNextCommand()})})});break}case"load-prototype":{this._assertCurrentModeIsOneOf([Q.ViewerMode.PROTOTYPE],e),console.log(e.type,e.figFile,e.nodeId),this.figFileName=this.figFileToName(e.figFile),this.testMode==0&&this._mockTime.reset(),this.readFile(this.resolveFromBasePath(e.figFile),1).then(t=>{this.app.canvasView().dangerouslyAccessProtoRenderManager().clearTileCaches(),this.app.state().imageManager().resetForRenderingTests(),this.viewer.loadFile({bytes:t.bytes,interactiveComponentsEnabled:!0},this.initializePrototypeLib),this.afterInitialLoad(()=>{let n=this.app.state().scene();if(n!=null){let r=n.findNode2(Vr(e.nodeId));if(r.type()!="CANVAS")this.app.state().prototypeState().navigateToFrameAndCloseOverlays1(r.id());else{this.app.state().setActiveCanvas(r);let o=Ft.visuallySortedTopLevelFrames(this.app.state().getActiveCanvas());if(o.length>0)this.app.state().prototypeState().navigateToFrameAndCloseOverlays1(o[0].id());else throw new Error("no top level frames in prototype")}}this.app.state().prototypeState().setFitModeFromParameter(e.scalingMode),this.afterRenderingCompletes(()=>{this.runNextCommand()})})});break}case"set-top-level-frame":{this._assertCurrentModeIsOneOf([Q.ViewerMode.PROTOTYPE],e),console.log(e.type,e.nodeId);let t=this.app.state().scene();if(t==null)throw new Error("Missing scene in set-top-level-frame");let n=t.findNode2(Vr(e.nodeId));if(n==null)throw new Error("Missing node to navigate to");this.app.state().prototypeState().navigateToFrameAndCloseOverlays1(n.id()),this.runNextCommand();break}case"scroll-node":{this._assertCurrentModeIsOneOf([Q.ViewerMode.PROTOTYPE],e);let t=this.app.state().scene();if(t==null)throw new Error("Missing scene in scroll-node");let n=t.findNode2(Vr(e.nodeId));if(n==null)throw new Error("Missing node in scroll-node");this.app.canvasView().updateScrollOffsetForNode(n,new I(+e.offset.x,+e.offset.y)),this.runNextCommand();break}case"trigger-hotspot":{this._assertCurrentModeIsOneOf([Q.ViewerMode.PROTOTYPE],e);let t=e.nodeId,n=qt.TransitionAction_fromString(e.action);if(n==0)throw new Error(`Unrecognized action ${e.action}`);let r=this.app.state().scene();if(r==null)throw new Error(`Missing scene in ${e.type}`);let o=r.findNode2(t);if(o==null)throw new Error(`Missing node in ${e.type}`);let i=this.app.state().prototypeStructure().findPrototypeInteractionsWithInteractionType(o,qt.TransitionAction_mapToInteractionType(n));if(i.length==0)throw new Error(`Could not find hotspot for action ${Pn[n]} on node ${t}`);this.app.canvasView().triggerHotspot(new Eo(o),i[0],n,null),this.afterRenderingCompletes(()=>{this.runNextCommand()});break}case"advance-time":{this._assertCurrentModeIsOneOf([Q.ViewerMode.PROTOTYPE],e);let t=parseFloat(e.seconds),n=1/60;for(;t>n;)this._mockTime.advanceSeconds(n),this._triggerOnFrameCallbacksForTesting(),t-=n;t>0&&(this._mockTime.advanceSeconds(t),this._triggerOnFrameCallbacksForTesting()),this.runNextCommand();break}case"save-canvas-as-image":{this._assertCurrentModeIsOneOf([Q.ViewerMode.PROTOTYPE],e);let t=Vr(e.outFile);console.log("save-canvas-as-image",t),this.afterRenderingCompletes(()=>{this.saveCanvasContentToPathAsync(this.resolveFromBasePath(e.outFile),()=>{this.runNextCommand()})});break}case"write-performance-stats":{let t=this.app.canvasView().dangerouslyAccessProtoRenderManager().getAggregateTransitionStats(),n=Object.create(null);n.stats=Object.create(null),n.meta=Object.create(null),t.forEach((o,i,a)=>{n.stats[i]=o});for(let o of["runCount","deviceMode","flags"])n.meta[o]=e[o];let r=JSON.stringify(n);this.writeFile(e.outFile,new Blob([r],{type:"application/json"})).then(o=>{this.runNextCommand()});break}case"trigger-optional-oob-access-for-testing":{x._prototypeLib.modules().interactionTestHelpers.triggerOptionalOOBAccess(),x._prototypeLib.modules().interactionTestHelpers.triggerReleaseReport(),x._prototypeLib.modules().interactionTestHelpers.triggerSloge(),setTimeout(()=>{this.runNextCommand()},1e3);break}default:throw new Error(`Skipping unrecognized command ${e.type}`)}}writePerformanceResultsWhenFinished(e,t){this.commandQueue.push({type:"write-performance-stats",outFile:e,runCount:t.get("runCount"),deviceMode:t.get("deviceMode"),flags:t.get("flags")})}_triggerOnFrameCallbacksForTesting(){this.app.window().internalOnFrame()}resizeToFit(){this.resize(window.innerWidth*or(),window.innerHeight*or())}resize(e,t){this.container.style.width=`${Math.ceil(e/or())}px`,this.container.style.height=`${Math.ceil(t/or())}px`,this.app.window().notifyAll(new Mo(2,this.app.window().root(),0)),this._triggerOnFrameCallbacksForTesting()}start(e,t,n){Ri.instance().initializePrototypeLib=t,Ri.instance().bowser=n,At.setImagePrefixURL(""),di=!0;let r=decodeURIComponent(this.queryArgs().get("viewerMode"));if(r!="PROTOTYPE")throw new Error(`Invalid viewer mode '${r}'`);let o=this.queryArgs().get("testMode");switch(o){case"RENDER":{this.testMode=0;break}case"PERFORMANCE":{this.testMode=1;break}default:throw new Error(`Invalid viewer test mode '${o}'`)}this.secret=decodeURIComponent(this.queryArgs().get("secret")),this.container=document.createElement("div"),document.body.appendChild(this.container),this.getArgv().then(i=>{let a=i[0],s=a.split("/");ie.List_removeLast(s),this.basePath=s.join("/");let c=new Map;for(let l=1,u=i.length;l<u;l=l+1){let d=i[l];d.length>=2&&d.charCodeAt(0)==45&&d.charCodeAt(1)==70&&c.set(d.slice(2),!0)}if(this.viewer=e({workerURL:"imagedecoder.js",containerElement:this.container,viewerMode:r,featureFlags:Me.StringMap_toJSObject(c),trackingSessionId:"unimportant dummy value",startNodeId:null,bowser:Ri.instance().bowser,kiwiSchema:kiwi.compileSchema(kiwi.parseSchema(`// This is the schema for the file format. We use the Kiwi serialization format,
// which is a custom format that is similar to Google Protocol Buffers but
// customized for our needs: https://github.com/evanw/kiwi
//
// The files src/multiplayer/sync.h and resources/other/sync.bkiwi in fullscreen
// are automatically generated from this schema file every time you build
// fullscreen using Xcode. To manually generate the files, run the
// "fullscreen/scripts/generate_kiwi.sh" script.
//
// The "kiwic" compiler emits errors in a format that Xcode understands, so you
// should be able to edit the "sync.kiwi" file directly in Xcode and get inline
// errors if the build fails.
//
// Please ensure every property that is an index into the top-level "blobs"
// array ends in "Blob", like "fooBlob". This is used by the multiplayer
// server to automatically substitute blob values in the right places.

package Fig;

enum MessageType {
  JOIN_START = 0;
  NODE_CHANGES = 1;
  USER_CHANGES = 2;
  JOIN_END = 3;
  SIGNAL = 4;
  STYLE = 5;
  STYLE_SET = 6;

  // This message type is only sent if:
  //
  // - The client passes the "snapshot-hash" query parameter on connect
  // - The value for that parameter is the same as the current document
  // - There aren't any pending unsaved changes or active autosaves
  //
  // In this case, the client should skip reloading the document and just assume
  // that it's local document is the exact same as the server. This is just an
  // optimization to avoid needing to download and parse the document all over
  // again when the browser tab has timed out because it was in the background
  // and the network connection was idle. It's completely optional; if a client
  // doesn't want to handle JOIN_START_SKIP_RELOAD, it can just not pass the
  // "snapshot-hash" query parameter and the server will never send this type.
  JOIN_START_SKIP_RELOAD = 7;

  // Client upgrades work like this:
  //
  // 1) Client -> server:
  // - Make a WebSocket request with an old "version" URL parameter
  //
  // 2) Server -> client:
  // - Send the schema
  // - Send a NOTIFY_SHOULD_UPGRADE message
  //   - The "access" property is either READ_ONLY | READ_WRITE. The client
  //     should use this to update the "isReadOnly" state of the scene.
  //
  // 3) Client -> server:
  // - Send the schema
  //   - This is optional, and is currently unused by the server. We were
  //     thinking this could be nice to have if we ever change the wire
  //     protocol itself since the client definitely knows what format its
  //     messages are in.
  // - At this point the upgrade flow pauses until user action. We let the user
  //   continue to edit the document while we show a persistent banner at the
  //   top of the screen that prompts them to upgrade. When they click the
  //   upgrade button in this banner, we kick off the rest of the flow below.
  // - Send a NODE_CHANGES message for all local changes
  //   - This will happen if the document was already open and the user made
  //     some unsaved changes while disconnected.
  //   - Note that this currently happens even if the document is read-only.
  //     In that case the server will just reject all of that user's changes
  //     and they will be dropped on the floor when the client reloads.
  // - Send an UPGRADE_DONE message
  //
  // 4) Server -> client:
  // - Send an UPGRADE_REFRESH message
  //   - This lets the client know that its changes have been fully committed
  //     to the server and it's ok to reload.
  //
  // 5) Client -> server:
  // - Close the connection and reload
  //   - The client waits to reload until it gets the UPGRADE_REFRESH message
  //     to avoid losing data. If the client reloaded earlier, it might lose
  //     data because the message may not have ever reached the server. For
  //     example, the user's car might have just entered a tunnel and has no
  //     more internet connection.
  //
  // This whole sequence can be easily tested from the editor. Just choose
  // "Debug > Test Multiplayer Upgrade Protocol". That reconnects to the
  // multiplayer server with a special flag that forces the upgrade sequence.
  NOTIFY_SHOULD_UPGRADE = 8;
  UPGRADE_DONE = 9;
  UPGRADE_REFRESH = 10;
  SCENE_GRAPH_QUERY = 11;
  SCENE_GRAPH_REPLY = 12;

  DIFF = 13;

  // Sometimes clients want to send information to each other that, unlike
  // USER_CHANGES, is ephemeral. An example is when someone in the editor uses
  // the E shortcut to react to things in the editor. This shows temporary
  // emoji around the user's cursor on other clients. We DON'T want these to
  // show up when others join the file in future.
  CLIENT_BROADCAST = 14;

  // Sent to indicate that a journaled reconnect will be performed.
  JOIN_START_JOURNALED = 15;

  // To stream chunked NODE_CHANGES, the client needs to know whether to
  // decompress using a Zstd stream context or to individually decompress
  // messages. The server sends STREAM_START and STREAM_END messages
  // to indicate to the client when it should decompress using the Zstd
  // stream context and when to individually decompress messages.
  STREAM_START = 16;
  STREAM_END = 17;
}

enum Axis {
  X = 0;
  Y = 1;
}

enum Access {
  READ_ONLY = 0;
  READ_WRITE = 1;
}

enum NodePhase {
  CREATED = 0;
  REMOVED = 1;
}

enum WindingRule {
  NONZERO = 0;
  ODD = 1;
}

// Keep the names here up to date with serialization logic in FGNode.h
enum NodeType {
  NONE = 0;
  DOCUMENT = 1;
  CANVAS = 2;
  GROUP = 3;
  FRAME = 4;
  BOOLEAN_OPERATION = 5;
  VECTOR = 6;
  STAR = 7;
  LINE = 8;
  ELLIPSE = 9;
  RECTANGLE = 10;
  REGULAR_POLYGON = 11;
  ROUNDED_RECTANGLE = 12;
  TEXT = 13;
  SLICE = 14;
  SYMBOL = 15;
  INSTANCE = 16;
  STICKY = 17;
  SHAPE_WITH_TEXT = 18;
  CONNECTOR = 19;
  CODE_BLOCK = 20;
  WIDGET = 21;
  STAMP = 22;
  MEDIA = 23;
  HIGHLIGHT = 24;
  SECTION = 25;
  SECTION_OVERLAY = 26;
  WASHI_TAPE = 27;
  VARIABLE = 28;
  TABLE = 29;
  TABLE_CELL = 30;
  VARIABLE_SET = 31;
  SLIDE = 32;
  ASSISTED_LAYOUT = 33;
}

enum ShapeWithTextType {
  SQUARE = 0;
  ELLIPSE = 1;
  DIAMOND = 2;
  TRIANGLE_UP = 3;
  TRIANGLE_DOWN = 4;
  ROUNDED_RECTANGLE = 5;
  PARALLELOGRAM_RIGHT = 6;
  PARALLELOGRAM_LEFT = 7;
  ENG_DATABASE = 8;
  ENG_QUEUE = 9;
  ENG_FILE = 10;
  ENG_FOLDER = 11;
  TRAPEZOID = 12;
  PREDEFINED_PROCESS = 13;
  SHIELD = 14;
  DOCUMENT_SINGLE = 15;
  DOCUMENT_MULTIPLE = 16;
  MANUAL_INPUT = 17;
  HEXAGON = 18;
  CHEVRON = 19;
  PENTAGON = 20;
  OCTAGON = 21;
  STAR = 22;
  PLUS = 23;
  ARROW_LEFT = 24;
  ARROW_RIGHT = 25;
  SUMMING_JUNCTION = 26;
  OR = 27;
  SPEECH_BUBBLE = 28;
  INTERNAL_STORAGE = 29;
}

// Keep the names here up to date with serialization logic in FGPaintHelpers.cpp
enum BlendMode {
  PASS_THROUGH = 0;
  NORMAL = 1;
  DARKEN = 2;
  MULTIPLY = 3;
  LINEAR_BURN = 4;
  COLOR_BURN = 5;
  LIGHTEN = 6;
  SCREEN = 7;
  LINEAR_DODGE = 8;
  COLOR_DODGE = 9;
  OVERLAY = 10;
  SOFT_LIGHT = 11;
  HARD_LIGHT = 12;
  DIFFERENCE = 13;
  EXCLUSION = 14;
  HUE = 15;
  SATURATION = 16;
  COLOR = 17;
  LUMINOSITY = 18;
}

enum PaintType {
  SOLID = 0;
  GRADIENT_LINEAR = 1;
  GRADIENT_RADIAL = 2;
  GRADIENT_ANGULAR = 3;
  GRADIENT_DIAMOND = 4;
  IMAGE = 5;
  EMOJI = 6;
  VIDEO = 7;
}

enum ImageScaleMode {
  STRETCH = 0;
  FIT = 1;
  FILL = 2;
  TILE = 3;
}

enum EffectType {
  INNER_SHADOW = 0;
  DROP_SHADOW = 1;
  FOREGROUND_BLUR = 2;
  BACKGROUND_BLUR = 3;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum TextCase {
  ORIGINAL = 0;
  UPPER = 1;
  LOWER = 2;
  TITLE = 3;
  SMALL_CAPS = 4;
  SMALL_CAPS_FORCED = 5;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum TextDecoration {
  NONE = 0;
  UNDERLINE = 1;
  STRIKETHROUGH = 2;
}

enum LeadingTrim {
  NONE = 0;
  CAP_HEIGHT = 1;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum NumberUnits {
  RAW = 0;
  PIXELS = 1;
  PERCENT = 2;
}

enum ConstraintType {
  MIN = 0;
  CENTER = 1;
  MAX = 2;
  STRETCH = 3;
  SCALE = 4;

  // FIXED_MIN and FIXED_MAX are deprecated and should be parsed as MIN
  // and MAX. They were released internally, so there are documents on
  // staging with these values stored in them. We already released them
  // to users behind a feature flag. No external users should have been
  // able to create documents with these constraint values.
  FIXED_MIN = 5;
  FIXED_MAX = 6;
}

enum StrokeAlign {
  CENTER = 0;
  INSIDE = 1;
  OUTSIDE = 2;
}

enum StrokeCap {
  NONE = 0;
  ROUND = 1;
  SQUARE = 2;
  ARROW_LINES = 3;
  ARROW_EQUILATERAL = 4;
  DIAMOND_FILLED = 5;
  TRIANGLE_FILLED = 6;
  HIGHLIGHT = 7;
  WASHI_TAPE_1 = 8;
  WASHI_TAPE_2 = 9;
  WASHI_TAPE_3 = 10;
  WASHI_TAPE_4 = 11;
  WASHI_TAPE_5 = 12;
  WASHI_TAPE_6 = 13;
  CIRCLE_FILLED = 14;
}

enum StrokeJoin {
  MITER = 0;
  BEVEL = 1;
  ROUND = 2;
}

enum BooleanOperation {
  UNION = 0;
  INTERSECT = 1;
  SUBTRACT = 2;
  XOR = 3;
}

enum TextAlignHorizontal {
  LEFT = 0;
  CENTER = 1;
  RIGHT = 2;
  JUSTIFIED = 3;
}

enum TextAlignVertical {
  TOP = 0;
  CENTER = 1;
  BOTTOM = 2;
}

enum MouseCursor {
  DEFAULT = 0;
  CROSSHAIR = 1;
  EYEDROPPER = 2;
  HAND = 3;
  PAINT_BUCKET = 4;
  PEN = 5;
  PENCIL = 6;
  MARKER = 7;
  ERASER = 8;
  HIGHLIGHTER = 9;
}

// The order here matters. Moving geometry around may downgrade (decrement)
// the mirror mode but will never upgrade (increment) the mirror mode.
enum VectorMirror {
  NONE = 0;
  ANGLE = 1;
  ANGLE_AND_LENGTH = 2;
}

enum DashMode {
  CLIP = 0;
  STRETCH = 1;
}

// Keep the names here up to date with imageTypeFromEnumName() in FWImageIO.cpp
enum ImageType {
  PNG = 0;
  JPEG = 1;
  SVG = 2;
  PDF = 3;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum ExportConstraintType {
  CONTENT_SCALE = 0;
  CONTENT_WIDTH = 1;
  CONTENT_HEIGHT = 2;
}

enum LayoutGridType {
  MIN = 0;
  CENTER = 1;
  STRETCH = 2;
  MAX = 3;
}

enum LayoutGridPattern {
  STRIPES = 0;
  GRID = 1;
}

enum TextAutoResize {
  NONE = 0;
  WIDTH_AND_HEIGHT = 1; // Don't wrap lines and adjust width and height automatically.
  HEIGHT = 2; // Wrap lines to fit existing width and adjust height automatically.
}

enum TextTruncation {
  DISABLED = 0;
  ENDING = 1;
}

enum StyleSetType {
  PERSONAL = 0;
  TEAM = 1;
  CUSTOM = 2;
  FREQUENCY = 3;
  TEMPORARY = 4;
}

enum StyleSetContentType {
  SOLID = 0;
  GRADIENT = 1;
  IMAGE = 2;
}

enum StackMode {
  NONE = 0;
  HORIZONTAL = 1;
  VERTICAL = 2;
}

enum StackAlign {
  MIN = 0;
  CENTER = 1;
  MAX = 2;
  BASELINE = 3;
}

enum StackCounterAlign {
  MIN = 0; // DEPRECATED - no longer used as of ALv3
  CENTER = 1; // DEPRECATED - no longer used as of ALv3
  MAX = 2; // DEPRECATED - no longer used as of ALv3
  STRETCH = 3;
  AUTO = 4;
  BASELINE = 5;
}

enum StackJustify {
  MIN = 0;
  CENTER = 1;
  MAX = 2;
  SPACE_EVENLY = 3; // DEPRECATED - new stacks will use SPACE_BETWEEN
  SPACE_BETWEEN = 4;
}

enum StackSize {
  FIXED = 0;
  RESIZE_TO_FIT = 1; // DEPRECATED - no longer used as of ALv3
  RESIZE_TO_FIT_WITH_IMPLICIT_SIZE = 2;
}

enum StackPositioning {
  AUTO = 0;
  ABSOLUTE = 1;
}

enum StackWrap {
  NO_WRAP = 0;
  WRAP = 1;
}

enum StackCounterAlignContent {
  AUTO = 0; // If all stack children are FILL in the counter axis, auto=stretch, otherwise auto=flex-start
  SPACE_BETWEEN = 1;
}

enum ConnectionType {
  NONE = 0;

  // Prototype link/hotspot points to a node in the same file
  // to perform a Navigation action (excludes MediaActions)
  INTERNAL_NODE = 1;

  // Prototype link/hotspot opens a URL
  URL = 2;

  // Goes to the previous frame
  BACK = 3;

  // Closes the overlay
  CLOSE = 4;

  // Changes the value of a variable
  SET_VARIABLE = 5;

  // Changes the runtime properties of media
  // Can point to a node in the same frame
  UPDATE_MEDIA_RUNTIME = 6;

  // Evaluates a conditional expression and executes a list of actions
  CONDITIONAL = 7;
}

enum InteractionType {
  ON_CLICK = 0;
  AFTER_TIMEOUT = 1;
  MOUSE_IN = 2;
  MOUSE_OUT = 3;
  ON_HOVER = 4;
  MOUSE_DOWN = 5;
  MOUSE_UP = 6;
  ON_PRESS = 7;
  NONE = 8;
  DRAG = 9;
  ON_KEY_DOWN = 10;
  ON_VOICE = 11;
  ON_MEDIA_HIT = 12;
  ON_MEDIA_END = 13;
  MOUSE_ENTER = 14;
  MOUSE_LEAVE = 15;
}

enum TransitionType {
  INSTANT_TRANSITION = 0;

  DISSOLVE = 1;

  FADE = 2;

  // Frame A moves over frame B while frame B
  // fades out and moves slightly in the direction
  // of the animation.
  SLIDE_FROM_LEFT = 3;
  SLIDE_FROM_RIGHT = 4;
  SLIDE_FROM_TOP = 5;
  SLIDE_FROM_BOTTOM = 6;

  // Frame A moves onto screen by pushing frame B
  // out of the way in the direction of the animation.
  // The frames never overlap.
  PUSH_FROM_LEFT = 7;
  PUSH_FROM_RIGHT = 8;
  PUSH_FROM_TOP = 9;
  PUSH_FROM_BOTTOM = 10;

  // Frame A moves over frame B in the direction of the
  // animation. Frame B remains in place and doesn't
  // change visually.
  MOVE_FROM_LEFT = 11;
  MOVE_FROM_RIGHT = 12;
  MOVE_FROM_TOP = 13;
  MOVE_FROM_BOTTOM = 14;

  // The current frame on screen slides in the direction OPPOSITE
  // to the one specified revealing the new frame under it which
  // fades in and moves slightly in the direction of
  // the animation.
  //
  // Why does ..._TO_LEFT actually move to the right? This was a
  // mistake when we picked these names, and changing names in our
  // file format is a huge pain so we've chosen to live with this
  // for now.
  SLIDE_OUT_TO_LEFT = 15;
  SLIDE_OUT_TO_RIGHT = 16;
  SLIDE_OUT_TO_TOP = 17;
  SLIDE_OUT_TO_BOTTOM = 18;

  // The current frame on screen moves in the direction OPPOSITE
  // to the one specified, revealing the new frame under it.
  //
  // Why does ..._TO_LEFT actually move to the right? This was a
  // mistake when we picked these names, and changing names in our
  // file format is a huge pain so we've chosen to live with this
  // for now.
  MOVE_OUT_TO_LEFT = 19;
  MOVE_OUT_TO_RIGHT = 20;
  MOVE_OUT_TO_TOP = 21;
  MOVE_OUT_TO_BOTTOM = 22;

  // DEPRECATED: This was deprecated in favor of SMART_ANIMATE below.
  MAGIC_MOVE = 23;

  // The current frame on screen transitions "magically" to match the
  // destination frame.
  SMART_ANIMATE = 24;

  SCROLL_ANIMATE = 25;
}

enum EasingType {
  IN_CUBIC = 0;
  OUT_CUBIC = 1;
  INOUT_CUBIC = 2;
  LINEAR = 3;
  IN_BACK_CUBIC = 4;
  OUT_BACK_CUBIC = 5;
  INOUT_BACK_CUBIC = 6;
  CUSTOM_CUBIC = 7;
  SPRING = 8;
  GENTLE_SPRING = 9;
  CUSTOM_SPRING = 10;
  SPRING_PRESET_ONE = 11;
  SPRING_PRESET_TWO = 12;
  SPRING_PRESET_THREE = 13;
}

enum ScrollDirection {
  NONE = 0;
  HORIZONTAL = 1;
  VERTICAL = 2;
  BOTH = 3;
}

enum ScrollContractedState {
  EXPANDED = 0;
  CONTRACTED = 1;
}

struct GUID {
  uint sessionID;
  uint localID;
}

struct Color {
  float r;
  float g;
  float b;
  float a;
}

struct Vector {
  float x;
  float y;
}

struct Rect {
  float x;
  float y;
  float w;
  float h;
}

struct ColorStop {
  Color color;
  float position;
}

struct Matrix {
  float m00;
  float m01;
  float m02;
  float m10;
  float m11;
  float m12;
}

struct ParentIndex {
  GUID guid;
  string position;
}

struct Number {
  float value;
  NumberUnits units;
}

struct FontName {
  string family;
  string style;
  string postscript;
}

enum FontVariantNumericFigure {
  NORMAL = 0;
  LINING = 1;
  OLDSTYLE = 2;
}

enum FontVariantNumericSpacing {
  NORMAL = 0;
  PROPORTIONAL = 1;
  TABULAR = 2;
}

enum FontVariantNumericFraction {
  NORMAL = 0;
  DIAGONAL = 1;
  STACKED = 2;
}

// Keep the names here up to date with serialization logic in FGSerialization.cpp
enum FontVariantCaps {
  NORMAL = 0;
  SMALL = 1;
  ALL_SMALL = 2;
  PETITE = 3;
  ALL_PETITE = 4;
  UNICASE = 5;
  TITLING = 6;
}

enum FontVariantPosition {
  NORMAL = 0;
  SUB = 1;
  SUPER = 2;
}

enum FontStyle {
  // Keep this up-to-date with \`FontStyle\` in \`FGFontFace.h\`
  NORMAL = 0;
  ITALIC = 1;
}

// All registered OpenType features:
// https://docs.microsoft.com/en-us/typography/opentype/spec/featurelist
// Omitted tags:
//  \`pnum\`, \`tnum\`, \`lnum\`, \`lnum\` (covered by \`FontVariantNumericFigure\` and \`FontVariantNumericSpacing\`)
//  \`frac\` (covered by \`FontVariantNumericFraction\`)
//  \`smcp\`, \`c2sc\` (covered by \`FontVariantCaps\`)
//  \`subs\`, \`sups\` (covered by \`FontVariantPosition\`)

enum OpenTypeFeature {

    // Letter case
    PCAP = 0; // Petite Capitals
    C2PC = 1; // Petite Capitals from Capitals
    CASE = 2; // Case-Sensitive Forms
    CPSP = 3; // Capital Spacing
    TITL = 4; // Titling
    UNIC = 5; // Unicase

    // Numbers
    ZERO = 6; // Slashed Zero
    SINF = 7; // Scientific Inferiors
    ORDN = 8; // Ordinals
    AFRC = 9; // Alternative Fractions
    DNOM = 10; // Denominators
    NUMR = 11; // Numerators

    // Variants
    LIGA = 12; // Standard Ligatures
    CLIG = 13; // Contextual Ligatures
    DLIG = 14; // Discretionary Ligatures
    HLIG = 15; // Historical Ligatures
    RLIG = 16; // Required Ligatures
    AALT = 17; // Access All Alternates
    CALT = 18; // Contextual Alternates
    RCLT = 19; // Required Contextual Alternates
    SALT = 20; // Stylistic Alternates
    RVRN = 21; // Required Variation Alternates
    VERT = 22; // Vertical Alternates
    SWSH = 23; // Swash
    CSWH = 24; // Contextual Swash
    NALT = 25; // Alternate Annotation Forms
    CCMP = 26; // Glyph Composition/Decomposition
    STCH = 27; // Stretching Glyph Decomposition
    HIST = 28; // Historical Forms
    SIZE = 29; // Optical Size
    ORNM = 30; // Ornaments
    ITAL = 31; // Italics
    RAND = 32; // Randomize

    // Math
    DTLS = 33; // Dotless Forms
    FLAC = 34; // Flattened Ascent Forms
    MGRK = 35; // Mathematical Greek
    SSTY = 36; // Math script style alternates

    // Horizontal spacing
    KERN = 37; // Kerning
    FWID = 38; // Full Widths
    HWID = 39; // Half Widths
    HALT = 40; // Alternate Half Widths
    TWID = 41; // Third Widths
    QWID = 42; // Quarter Widths
    PWID = 43; // Proportional Widths
    JUST = 44; // Justification Alternates
    LFBD = 45; // Left Bounds
    OPBD = 46; // Optical Bounds
    RTBD = 47; // Right Bounds
    PALT = 48; // Proportional Alternate Widths
    PKNA = 49; // Proportional Kana

    // Writing direction
    LTRA = 50; // Left-to-right Alternates
    LTRM = 51; // Left-to-right Mirrored Forms
    RTLA = 52; // Right-to-left Alternates
    RTLM = 53; // Right-to-left Mirrored Forms

    // More features
    ABRV = 54; // Above-base Forms
    ABVM = 55; // Above-base Mark Positioning
    ABVS = 56; // Above-base Substitutions
    VALT = 57; // Alternate Vertical Metrics
    VHAL = 58; // Alternate Vertical Half Metrics
    BLWF = 59; // Below-base Forms
    BLWM = 60; // Below-base Mark Positioning
    BLWS = 61; // Below-base Substitutions
    AKHN = 62; // Akhand (Ligature Devanagari)
    CJCT = 63; // Conjuct Forms
    CFAR = 64; // Conjunct Form After Ro
    CPCT = 65; // Centered CJK Punctuation
    CURS = 66; // Cursive Positioning
    DIST = 67; // Distances
    EXPT = 68; // Expert Forms
    FALT = 69; // Final Glyph on Line Alternates
    FINA = 70; // Terminal Forms
    FIN2 = 71; // Terminal Form #2
    FIN3 = 72; // Terminal Form #3
    HALF = 73; // Half Forms
    HALN = 74; // Halant Forms
    HKNA = 75; // Horizontal Kana Alternates
    HNGL = 76; // Hangul
    HOJO = 77; // Hojo Kanji Forms
    INIT = 78; // Initial Forms
    ISOL = 79; // Isolated Forms
    JP78 = 80; // JIS78 Forms
    JP83 = 81; // JIS83 Forms
    JP90 = 82; // JIS90 Forms
    JP04 = 83; // JIS2004 Forms
    LJMO = 84; // Leading Jamo Forms (Hangul)
    LOCL = 85; // Localized Forms
    MARK = 86; // Mark Positioning (Arabic)
    MEDI = 87; // Medial Forms
    MED2 = 88; // Medial Forms #2
    MKMK = 89; // Mark-to-Mark Positioning
    NLCK = 90; // NLC Kanji Forms
    NUKT = 91; // Nukta Forms
    PREF = 92; // Pre-base Forms
    PRES = 93; // Pre-base Substitutions
    VPAL = 94; // Proportional Alternate Vertical Metrics
    PSTF = 95; // Post-base Forms
    PSTS = 96; // Post-base Substitutions
    RKRF = 97; // Rakar Forms
    RPHF = 98; // Reph Form
    RUBY = 99; // Ruby Notation Forms
    SMPL = 100; // Simplified Forms
    TJMO = 101; // Trailing Jamo Forms
    TNAM = 102; // Traditional Name Forms
    TRAD = 103; // Traditional Forms
    VATU = 104; // Vattu Variants
    VJMO = 105; // Vovel Jamo Forms
    VKNA = 106; // Vertical Kana Alternates
    VKRN = 107; // Vertical Kerning
    VRTR = 108; // Vertical Alternates for Rotation
    VRT2 = 109; // Vertical Alternates and Rotation

    // Variants: Stylistic Sets
    SS01 = 110; // Stylistic Set 1
    SS02 = 111; // Stylistic Set 2
    SS03 = 112; // Stylistic Set 3
    SS04 = 113; // Stylistic Set 4
    SS05 = 114; // Stylistic Set 5
    SS06 = 115; // Stylistic Set 6
    SS07 = 116; // Stylistic Set 7
    SS08 = 117; // Stylistic Set 8
    SS09 = 118; // Stylistic Set 9
    SS10 = 119; // Stylistic Set 10
    SS11 = 120; // Stylistic Set 11
    SS12 = 121; // Stylistic Set 12
    SS13 = 122; // Stylistic Set 13
    SS14 = 123; // Stylistic Set 14
    SS15 = 124; // Stylistic Set 15
    SS16 = 125; // Stylistic Set 16
    SS17 = 126; // Stylistic Set 17
    SS18 = 127; // Stylistic Set 18
    SS19 = 128; // Stylistic Set 19
    SS20 = 129; // Stylistic Set 20

    // Variants: Character Variants
    CV01 = 130; // Character Variants 1
    CV02 = 131; // Character Variants 2
    CV03 = 132; // Character Variants 3
    CV04 = 133; // Character Variants 4
    CV05 = 134; // Character Variants 5
    CV06 = 135; // Character Variants 6
    CV07 = 136; // Character Variants 7
    CV08 = 137; // Character Variants 8
    CV09 = 138; // Character Variants 9
    CV10 = 139; // Character Variants 10
    CV11 = 140; // Character Variants 11
    CV12 = 141; // Character Variants 12
    CV13 = 142; // Character Variants 13
    CV14 = 143; // Character Variants 14
    CV15 = 144; // Character Variants 15
    CV16 = 145; // Character Variants 16
    CV17 = 146; // Character Variants 17
    CV18 = 147; // Character Variants 18
    CV19 = 148; // Character Variants 19
    CV20 = 149; // Character Variants 20
    CV21 = 150; // Character Variants 21
    CV22 = 151; // Character Variants 22
    CV23 = 152; // Character Variants 23
    CV24 = 153; // Character Variants 24
    CV25 = 154; // Character Variants 25
    CV26 = 155; // Character Variants 26
    CV27 = 156; // Character Variants 27
    CV28 = 157; // Character Variants 28
    CV29 = 158; // Character Variants 29
    CV30 = 159; // Character Variants 30
    CV31 = 160; // Character Variants 31
    CV32 = 161; // Character Variants 32
    CV33 = 162; // Character Variants 33
    CV34 = 163; // Character Variants 34
    CV35 = 164; // Character Variants 35
    CV36 = 165; // Character Variants 36
    CV37 = 166; // Character Variants 37
    CV38 = 167; // Character Variants 38
    CV39 = 168; // Character Variants 39
    CV40 = 169; // Character Variants 40
    CV41 = 170; // Character Variants 41
    CV42 = 171; // Character Variants 42
    CV43 = 172; // Character Variants 43
    CV44 = 173; // Character Variants 44
    CV45 = 174; // Character Variants 45
    CV46 = 175; // Character Variants 46
    CV47 = 176; // Character Variants 47
    CV48 = 177; // Character Variants 48
    CV49 = 178; // Character Variants 49
    CV50 = 179; // Character Variants 50
    CV51 = 180; // Character Variants 51
    CV52 = 181; // Character Variants 52
    CV53 = 182; // Character Variants 53
    CV54 = 183; // Character Variants 54
    CV55 = 184; // Character Variants 55
    CV56 = 185; // Character Variants 56
    CV57 = 186; // Character Variants 57
    CV58 = 187; // Character Variants 58
    CV59 = 188; // Character Variants 59
    CV60 = 189; // Character Variants 60
    CV61 = 190; // Character Variants 61
    CV62 = 191; // Character Variants 62
    CV63 = 192; // Character Variants 63
    CV64 = 193; // Character Variants 64
    CV65 = 194; // Character Variants 65
    CV66 = 195; // Character Variants 66
    CV67 = 196; // Character Variants 67
    CV68 = 197; // Character Variants 68
    CV69 = 198; // Character Variants 69
    CV70 = 199; // Character Variants 70
    CV71 = 200; // Character Variants 71
    CV72 = 201; // Character Variants 72
    CV73 = 202; // Character Variants 73
    CV74 = 203; // Character Variants 74
    CV75 = 204; // Character Variants 75
    CV76 = 205; // Character Variants 76
    CV77 = 206; // Character Variants 77
    CV78 = 207; // Character Variants 78
    CV79 = 208; // Character Variants 79
    CV80 = 209; // Character Variants 80
    CV81 = 210; // Character Variants 81
    CV82 = 211; // Character Variants 82
    CV83 = 212; // Character Variants 83
    CV84 = 213; // Character Variants 84
    CV85 = 214; // Character Variants 85
    CV86 = 215; // Character Variants 86
    CV87 = 216; // Character Variants 87
    CV88 = 217; // Character Variants 88
    CV89 = 218; // Character Variants 89
    CV90 = 219; // Character Variants 90
    CV91 = 220; // Character Variants 91
    CV92 = 221; // Character Variants 92
    CV93 = 222; // Character Variants 93
    CV94 = 223; // Character Variants 94
    CV95 = 224; // Character Variants 95
    CV96 = 225; // Character Variants 96
    CV97 = 226; // Character Variants 97
    CV98 = 227; // Character Variants 98
    CV99 = 228; // Character Variants 99
}

struct ExportConstraint {
  ExportConstraintType type;
  float value;
}

struct GUIDMapping {
  GUID from;
  GUID to;
}

struct Blob {
  byte[] bytes;
}

message Image {
  byte[] hash = 1; // SHA1 of compressed data
  string name = 2; // Just for display, not referenced by anything
  uint dataBlob = 3; // An index into "blobs", stores a compressed PNG or JPG (optional, will be missing for messages sent over the wire)
}

message Video {
  byte[] hash = 1; // SHA1 of compressed data
  string s3Url = 2; // HACK(ldamasco): ideally we should be resolving the hash against sinatra to get the s3 url, not storing it directly in fig file

  // string name = 3; // Just for display, not referenced by anything
  // uint dataBlob = 4; // An index into "blobs", stores a compressed MP4 (optional, will be missing for messages sent over the wire)
}

// DEPRECATED
struct FilterColorAdjust {
  float tint;
  float shadows;
  float highlights;
  float detail;
  float exposure;
  float vignette;
  float temperature;
  float vibrance;
}

message PaintFilterMessage {
  float tint = 1;
  float shadows = 2;
  float highlights = 3;
  float detail = 4 [deprecated];
  float exposure = 5;
  float vignette = 6 [deprecated];
  float temperature = 7;
  float vibrance = 8;
  float contrast = 9;
  float brightness = 10 [deprecated];
}

message Paint {
  PaintType type = 1;
  Color color = 2;
  float opacity = 3;
  bool visible = 4;
  BlendMode blendMode = 5;
  ColorStop[] stops = 6;
  Matrix transform = 7;
  Image image = 8;
  Image imageThumbnail = 9;
  Image animatedImage = 16;
  uint animationFrame = 17;
  ImageScaleMode imageScaleMode = 10;
  // Will not exist / be false for images uploaded before color management
  // Will always be true for images uploaded after color management
  bool imageShouldColorManage = 22;


  // NOTE: Either the transform above is used (e.g. for ImageScaleMode::STRETCH),
  // or these decomposed parameters are used (e.g. for ImageScaleMode::TILE).
  float rotation = 11;
  float scale = 12;

  // DEPRECATED, this is not used anywhere.
  FilterColorAdjust filterColorAdjust = 13 [deprecated];

  PaintFilterMessage paintFilter = 14;

  uint[] emojiCodePoints = 15;

  // NOTE: videos still use \`image\` and \`imageThumbnail\` for cover images in the editor
  // Video Playback data is stored in the VideoPlayback node field.
  Video video = 18;

  // For a fill of type IMAGE, these fields store the dimensions of the
  // original (full-size) image.  This is needed to correctly render an
  // image with imageScaleMode == TILE before the original image is loaded.
  // Beware that this isn't always present (specifically it is missing from
  // fills created before this handling was added), so fullscreen needs to
  // be prepared to render image fills without this information.
  uint originalImageWidth = 19;
  uint originalImageHeight = 20;

  VariableData colorVar = 21;
}

message FontMetaData {
  FontName key = 1;
  float fontLineHeight = 2;
  byte[] fontDigest = 3;
  FontStyle fontStyle = 4;
  int fontWeight = 5;
}

message FontVariation {
  uint axisTag = 1;
  string axisName = 2;
  float value = 3;
}

message TextData {
  string characters = 1;
  uint[] characterStyleIDs = 2; // All style IDs after the end are assumed to be 0, meaning no override
  NodeChange[] styleOverrideTable = 3;

  Vector layoutSize = 4;
  Baseline[] baselines = 5;
  Glyph[] glyphs = 6;
  Decoration[] decorations = 7;
  Blockquote[] blockquotes = 16;

  uint layoutVersion = 8 [deprecated];

  FontMetaData[] fontMetaData = 9; // Used for CSS export when font is not locally available

  FontName[] fallbackFonts = 10 [deprecated];
  HyperlinkBox[] hyperlinkBoxes = 11;
  TextLineData[] lines = 12;

  int truncationStartIndex = 13;
  float truncatedHeight = 14;

  float[] logicalIndexToCharacterOffsetMap = 15;

  float minContentHeight = 17 [deprecated]; // Moved to layout data

  MentionBox[] mentionBoxes = 18;
  DerivedTextLineData[] derivedLines = 19;
}

message DerivedTextData {
  Vector layoutSize = 1;
  Baseline[] baselines = 2;
  Glyph[] glyphs = 3;
  Decoration[] decorations = 4;
  Blockquote[] blockquotes = 5;
  FontMetaData[] fontMetaData = 6; // Used for CSS export when font is not locally available
  HyperlinkBox[] hyperlinkBoxes = 7;
  int truncationStartIndex = 8;
  float truncatedHeight = 9;
  float[] logicalIndexToCharacterOffsetMap = 10;
  MentionBox[] mentionBoxes = 11;
  DerivedTextLineData[] derivedLines = 12;
}

message HyperlinkBox {
  Rect bounds = 1;

  // url/guid are copied directly from the Hyperlink object.
  string url = 2;
  GUID guid = 3;
  int hyperlinkID = 4;
}

message MentionBox {
  Rect bounds = 1; // bounds for mention background pill
  uint startIndex = 2; // first mention character index
  uint endIndex = 3; // last mention character index
  bool isValid = 4; // whether the mention is valid (i.e., file keys match)
  uint mentionKey = 5; // boxes with the same key refer to the same mention
}

message Baseline {
  Vector position = 1;
  float width = 2;
  float lineY = 3;
  float lineHeight = 4;
  float lineAscent = 7;
  float ignoreLeadingTrim = 8;

  uint firstCharacter = 5; // An index into "characters" in TextData
  uint endCharacter = 6; // An index past the last character into "characters" in TextData
}

message Glyph {
  uint commandsBlob = 1; // An index into "blobs"
  Vector position = 2;
  uint styleID = 3;
  float fontSize = 4;
  uint firstCharacter = 5; // An index into "characters" in TextData
  float advance = 6;
  uint[] emojiCodePoints = 7;
}

message Decoration {
  Rect[] rects = 1;
  uint styleID = 2;
}

message Blockquote {
  Rect verticalBar = 1;
  Rect quoteMarkBounds = 2;
  uint styleID = 3;
}

message VectorData {
  uint vectorNetworkBlob = 1; // An index into "blobs"
  Vector normalizedSize = 2;
  NodeChange[] styleOverrideTable = 3;
}

message GUIDPath {
  GUID[] guids = 1;
}

message SymbolData {
  GUID symbolID = 1;
  NodeChange[] symbolOverrides = 2; // Uses GUIDPath as map key
  float uniformScaleFactor = 3;
}

message GUIDPathMapping {
  GUID id = 1;
  GUIDPath path = 2;
}

message NodeGenerationData {
  // Uses GUIDPath as map key. These are details of the nodes that we should be generating.
  NodeChange[] overrides = 1;
  // Indicates whether overrides should be fine-grained synced over multiplayer,
  // keyed on the guid path and field. When true, if multiple clients are adding
  // overrides for different guid paths or changing values for different fields
  // on the same override path,  the multiplayer server merges the incoming diffs
  // so all changes are retained.
  bool useFineGrainedSyncing = 2;

  // Uses GUIDPath as map key. These indicate to multiplayer which fields should be removed
  // for an override path when using fine grained syncing. The reason why we use NodeChanges
  // here is to make the server-side diffing easier, since it's not safe to convert from a
  // uint32 indicating the field to a NodeChangeField. The actual value stored does not
  // matter; the only thing that matters is that there is a value stored.
  // See this Slack conversation for more context:
  // https://figma.slack.com/archives/CUWG9FWKH/p1668718183550959
  //
  // When using fine grained syncing, the messages sent to multiplayer for node generation
  // data are the diffs the client wants to apply, not the entire new value. This works well
  // for adding and changing values, but if a client wants to remove a field for an override
  // path, there is no way to represent that the diff using the just overrides field.
  //
  // This should *only* be used in the message from the client to multiplayer server, and
  // should always be empty when node generation data is saved to the file format.
  //
  // If a node generation data diff includes a path/field in both overrides and
  // diffOnlyRemovals, we will remove the path/field.
  NodeChange[] diffOnlyRemovals = 3;
}

message DerivedImmutableFrameData {
  NodeChange[] overrides = 1; // Uses GUIDPath as map key. These are details of the nodes that we should be generating.

  // A version number that we increment to invalidate derived
  // immutable frame data in the wild. See comment in FGNodeTypes
  // around DERIVED_IMMUTABLE_FRAME_DATA_VERSION for how to use this.
  uint version = 2;
}

message AssetRef {
  string key = 1;
  string version = 2;
}

message StateGroupId {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message StyleId {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message SymbolId {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message VariableID {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message VariableSetID {
  // Populated on local
  GUID guid = 1;
  // Populated on subscribed
  AssetRef assetRef = 2;
}

message SharedSymbolReference {
  string fileKey = 1; // The fileKey of the document that publishes the Symbol. Will soon be deprecated by componentKey
  GUID symbolID = 2; // The symbolID as it exists in publishing document. Will soon be deprecated by componentKey
  string versionHash = 3; // The hash of the version of the published Symbol
  GUIDPathMapping[] guidPathMappings = 4; // Maps volatile local GUIDs to stable GUID paths.
  byte[] bytes = 5; // The actual serialized Symbol fig file
  GUIDMapping[] libraryGUIDToSubscribingGUID = 6 [deprecated]; // The goal of this was to map stable GUIDs in the team library to stable GUIDs in a subscribing document. This work was never finished
  string componentKey = 7; // Uniquely identifies the component within all of Figma. Will be hex digest of a SHA1 hash.
  GUIDPathMapping[] unflatteningMappings = 8;  // Maps from the old, unflattened GUIDs on this root symbol to new GUIDPaths in this root symbol.
  bool isUnflattened = 9; // Stores whether this shared symbol was last published unflattened.
}

message SharedComponentMasterData {
  string componentKey = 1; // The globally unique component key that references this component.
  GUIDPathMapping[] publishingGUIDPathToTeamLibraryGUID = 2; // Maps volatile local GUIDPaths to stable GUIDs in the team library.
  bool isUnflattened = 3; // Stores whether this shared component was published unflattened.
}

// This is deprecated! It turns out keying based on componentKey is a bad idea.
// https://paper.dropbox.com/doc/Problems-with-OverrideStash--BElX~69l3h5Ny8AWHe~aWEGsAg-jXmtLTn2kZEF9tqvlNOo5
message InstanceOverrideStash {
  // The override path to the instance swap we're caching overrides for. This
  // uses exactly the same path convention as SymbolData. This means the GUIDs
  // may not refer to local IDs. They may refer to remote IDs if the symbol is a
  // subscribed symbol.
  GUIDPath overridePathOfSwappedInstance = 1;

  // Identifies which symbol we're swapping to. We use this rather than the
  // local ID of the symbol in order to avoid needing to remap the override
  // stash when updating from the team library.
  string componentKey = 2;

  // Use overrides.guidPath as the override path key. Note that regardless of the
  // overridePathOfSwappedInstance, the guidPath key is always relative to the
  // primary instance.
  //
  // The remainder of the fields are used as overrides.
  NodeChange[] overrides = 3;
}

// This is deprecated!
message InstanceOverrideStashV2 {
  // The override path to the instance swap we're caching overrides for. This
  // uses exactly the same path convention as SymbolData. This means the GUIDs
  // may not refer to local IDs. They may refer to remote IDs if the symbol is a
  // subscribed symbol.
  GUIDPath overridePathOfSwappedInstance = 1;

  // Identifies which symbol we're swapping to. We use this rather than a
  // componentKey because componentKeys change when a file is duplicated!
  GUID localSymbolID = 2;

  // Use overrides.guidPath as the override path key. Note that regardless of the
  // overridePathOfSwappedInstance, the guidPath key is always relative to the
  // primary instance.
  //
  // The remainder of the fields are used as overrides.
  NodeChange[] overrides = 3;
}

message Effect {
  EffectType type = 1;
  Color color = 2;
  Vector offset = 3;
  float radius = 4;
  bool visible = 5;
  BlendMode blendMode = 6;
  float spread = 7;
  bool showShadowBehindNode = 8;
}

message TransitionInfo {
  TransitionType type = 1;
  float duration = 2;
}

enum PrototypeDeviceType {
  NONE = 0;
  PRESET = 1;
  CUSTOM = 2;
  PRESENTATION = 3;
}

enum DeviceRotation {
  NONE = 0;

  // "Counter clock-wise 90 degrees"
  CCW_90 = 1;
}

message PrototypeDevice {
  // If type is ::PRESET, then the size is inferred from \`presetIdentifier\`.
  // If type is ::CUSTOM, the device size is encoded in \`size\`.
  PrototypeDeviceType type = 1;
  Vector size = 2;

  // A string that uniquely identifies a device and style, e.g. "APPLE_IPHONE_X_SILVER"
  // These are uppercase versions of the file names in the Facebook Design devices repo.
  string presetIdentifier = 3;

  // Right now we expose a portrait/landscape option on device frames that toggles
  // devices between DeviceRotation.NONE and DeviceRotation.CCW_90.
  //
  // We think it's possible users will want to be able to rotate their devices 270
  // degrees as well in future (iPhone X, for example, looks different when rotated
  // on one side vs. the other).
  DeviceRotation rotation = 4;
}

enum OverlayPositionType {
  CENTER = 0;
  TOP_LEFT = 1;
  TOP_CENTER = 2;
  TOP_RIGHT = 3;
  BOTTOM_LEFT = 4;
  BOTTOM_CENTER = 5;
  BOTTOM_RIGHT = 6;
  MANUAL = 7;
}

enum OverlayBackgroundInteraction {
  NONE = 0;
  CLOSE_ON_CLICK_OUTSIDE = 1;
}

enum OverlayBackgroundType {
  NONE = 0;
  SOLID_COLOR = 1;
}

message OverlayBackgroundAppearance {
  OverlayBackgroundType backgroundType = 1;
  Color backgroundColor = 2;
}

enum NavigationType {
  NAVIGATE = 0;
  OVERLAY = 1;
  SWAP = 2;
  SWAP_STATE = 3;
  SCROLL_TO = 4;
}

// Represents ICC color profiles.
// This is different from ColorProfile (node field index 341) since:
// 1. There can be different ICC color profiles that represent
// the color profile (ex. ICC V4 vs ICC V2).
// 2. ColorProfile is used to represent Figma's color space
// while ExportColorProfile is used to represent profiles found in
// images.
enum ExportColorProfile {
  // Export in the same color profile as the document
  DOCUMENT = 0;
  // No profile will be embedded (previous behavior of exports); web specs mandate that
  // images without profiles are assumed to be sRGB
  SRGB = 1;
  // Embed Display P3 V4 profile
  DISPLAY_P3_V4 = 2;
}

message ExportSettings {
  string suffix = 1;
  ImageType imageType = 2;
  ExportConstraint constraint = 3;
  bool svgDataName = 4;
  ExportSVGIDMode svgIDMode = 5;
  bool svgOutlineText = 6;
  bool contentsOnly = 7;
  bool svgForceStrokeMasks = 8;
  bool useAbsoluteBounds = 9;
  ExportColorProfile colorProfile = 10;
}

enum ExportSVGIDMode {
  IF_NEEDED = 0;
  ALWAYS = 1;
}

message LayoutGrid {
  LayoutGridType type = 1;
  Axis axis = 2;
  bool visible = 3;
  int numSections = 4;
  float offset = 5;
  float sectionSize = 6;
  float gutterSize = 7;
  Color color = 8;
  LayoutGridPattern pattern = 9;
}

message Guide {
  Axis axis = 1;
  float offset = 2;
  GUID guid = 3;
}

message Path {
  WindingRule windingRule = 1;
  uint commandsBlob = 2; // An index into "blobs"
  uint styleID = 3; // Used to support per-region paints
}

// IMPORTANT:
// If you add a value, you must add it to \`VALID_STYLE_TYPES\` in lib/models/style.rb.
// Please never remove any of the StyleType values!
// They are stored in Postgres as strings (eg: "FILL", "TEXT", "EFFECT")
enum StyleType {
  NONE = 0;
  FILL = 1;
  STROKE = 2;
  TEXT = 3;
  EFFECT = 4;
  EXPORT = 5;
  GRID = 6;
}

message SharedStyleReference {
  string styleKey = 1; // The globally unique style key that references this style
  string versionHash = 2; // The hash of the version of the published Style
}

message SharedStyleMasterData {
  string styleKey = 1; // The globally unique style key that references this style
  string sortPosition = 2; // The sort position of the style, within its defining file
  string fileKey = 3; // The file where this style belongs to
}

enum ScrollBehavior {
  SCROLLS = 0;
  FIXED_WHEN_CHILD_OF_SCROLLING_FRAME = 1;
  STICKY_SCROLLS = 2;
}

message ArcData {
  // These are stored in radians
  float startingAngle = 1;
  float endingAngle = 2;
  // This is store as a ratio from 0 to 1
  float innerRadius = 3;
}

message SymbolLink {
  string uri = 1;
  string displayName = 2;
  string displayText = 3;
}

message PluginData {
  string pluginID = 1;
  string value = 2;
  string key = 3;
}

message PluginRelaunchData {
  string pluginID = 1;
  // This is used as description
  string message = 2;
  string command = 3;
  bool isDeleted = 4;
}

message MultiplayerFieldVersion {
  // Incremented by multiplayer with each accepted write. Clients must send up the latest
  // value in order to have their writes accepted, or match the previous \`sessionID\`.
  uint counter = 1;
  // The last session to bump the counter. This ensures consecutive writes from the same
  // client are accepted, instead of conflicting with themselves!
  uint sessionID = 2;
}

// Keep the connector fields in sync with FGConnectorFields.h
enum ConnectorMagnet {
  NONE = 0;
  AUTO = 1;
  TOP = 2;
  LEFT = 3;
  BOTTOM = 4;
  RIGHT = 5;
  CENTER = 6;
}

message ConnectorEndpoint {
  GUID endpointNodeID = 1;
  Vector position = 2;
  ConnectorMagnet magnet = 3;
}

message ConnectorControlPoint {
  Vector position = 1;
  Vector axis = 2;
}

enum ConnectorTextSection {
  MIDDLE_TO_START = 0;
  MIDDLE_TO_END = 1;
}

message ConnectorTextMidpoint {
  ConnectorTextSection section = 1;
  float offset = 2;
}

enum ConnectorLineStyle {
  ELBOWED = 0;
  STRAIGHT = 1;
}

message LibraryMoveInfo {
  string oldKey = 1;
  string pasteFileKey = 2;
}

message LibraryMoveHistoryItem {
  GUID sourceNodeId = 1;
  string sourceComponentKey = 2;
}

message DeveloperRelatedLink {
  string nodeId = 1;
  string fileKey = 2;
  string linkName = 3;
  string linkUrl = 4;
}

// This is a pointer to a widget node in the scene. It's
// a message in case we want to store an override path
// in future (e.g. if widgets end up living in symbols).
message WidgetPointer {
  GUID nodeId = 1;
}

// This message contains information related to the last
// edit made on a node. Currently only contains timestamp in ISO8601
// format but is part of a message to allow it to be extended in the future
// with author attribution.
message EditInfo {
  string timestampIso8601 = 1;
  string userId = 2;
  uint lastEditedAt = 3;
  uint createdAt = 4;
}

enum EditorType {
  DESIGN = 0;
  WHITEBOARD = 1;
  SLIDES = 2;
}

enum MaskType {
  ALPHA = 0;
  OUTLINE = 1;
  LUMINANCE = 2;
}

enum SectionStatus {
  NONE = 0;
  BUILD = 1;
  // In the future, we can add a CUSTOM field here
}

message SectionStatusInfo {
  SectionStatus status = 1;
  // In the future, we can add a string field here to hold a custom tag
}

// NodeChange is grouped into pseudo-classes. We'd eventually like these
// groupings to be reflected as actual structs on the C++ side. Each class has a
// header and uses "Class extend SuperClass" syntax. To start with, we will
// probably manually implement the C++ side classes
//
// TODO: Figure out whether to use inheritance or composition. See
// https://github.com/figma/figma/pull/71145/files#r918328436 for discussion.
//
// TODO: Consider adding a first class "NodeFieldGroup" concept to kiwi and auto
// generate the class structure. NodeFieldGroup would also allow us to add new
// invariants that are currently impossible in kiwi. In particular, all fields
// of a message are optional. We could make it so that all or some of the fields
// in a group are required, but the group itself is optional. Although we'd
// probably not change multiplayer atomicity to account for groups. It would
// still be strictly NodeField-based probably, i.e. it would pretend the fields
// within a group were just inline in the group's parent message. Compared to
// adding a struct inside a message, this doesn't actually change the wire
// format or multiplayer atomicity. It just gives some extra type-safety style
// guarantees (similar to how TypeScript relates to JS).
//
// Here's the inheritance hierarcy (everything also inherits from NodeBase):
// - Asset
//   - Style
//   - Componentish
//     - Symbol
//     - StateGroup
// - Text
// - RenderableNode
// - AutoLayout
// - Plugin
// - Connector
// - FigJamShape
// - Widget
// - ForTest

message NodeChange {
  ///////////////////////////////////////
  // Last used node field index. We group nodefields by pseudo-class, but that
  // means it's annoying to figure out the next available index, so we document
  // that here. Please update this and the comment with the node field you added
  // if you add a new field so we can trigger merge conflicts pre-merge.
  //
  // next free node field index: 369, last node field name => diagramLayoutPaused (368)
  ///////////////////////////////////////

  // We used to ensure every property "foo" has a corresponding "fooTag" property of type "uint", but the tags are now deprecated.

  ///////////////////////////////////////
  // NodeBase
  ///////////////////////////////////////
  GUID guid = 1;                                uint guidTag = 53 [deprecated];
  NodePhase phase = 2;                          uint phaseTag = 54 [deprecated];
  ParentIndex parentIndex = 3;                  uint parentIndexTag = 55 [deprecated];
  NodeType type = 4;                            uint typeTag = 56 [deprecated];
  string name = 5;                              uint nameTag = 57 [deprecated];


  ///////////////////////////////////////
  // Asset : NodeBase
  ///////////////////////////////////////
  // A generic boolean indicating if the node (e.g. a Style node)
  // can be published
  bool isPublishable = 174;
  string description = 318;
  LibraryMoveInfo libraryMoveInfo = 256;
  LibraryMoveHistoryItem[] libraryMoveHistory = 281;
  // The asset key; currently used by variable assets only.
  // componentKey and styleKey can eventually be merged into this field.
  string key = 319;

  ///////////////////////////////////////
  // Style extends Asset
  ///////////////////////////////////////
  uint styleID = 49;
  uint styleIDTag = 101 [deprecated];
  bool isSoftDeletedStyle = 176; // will be replaced by isSoftDeleted
  bool isNonUpdateable = 177;
  bool isFillStyle = 157 [deprecated]; // replaced by styleType
  bool isStrokeStyle = 161 [deprecated];
  StyleType styleType = 163;
  string styleDescription = 191;
  // A generic hash of the version of the node
  // E.g. a Main style node uses version as the
  // main style version
  string version = 171;
  SharedStyleMasterData sharedStyleMasterData = 172;
  SharedStyleReference sharedStyleReference = 173;
  // The sort position of the style, within its defining file. This is currently
  // unused. It will be used as part of S2 removing
  // sharedStyleMasterData/sharedStyleReference.
  string sortPosition = 320;

  // Ignore this field. It was the predecessor to sevMoonlitLilyData and we were
  // feeling mischevious when we named it, but we've since renamed it for
  // clarity. It's not used for anything.
  SharedStyleMasterData ojansSuperSecretNodeField = 345 [deprecated];
  // This is a field populated for #sev-1-2023-03-20-moonlit-lily. Unless you're
  // specifically writing code to address this sev, ignore this field.
  SharedStyleMasterData sevMoonlitLilyData = 348;

  ///////////////////////////////////////
  // Componentish (Symbol | State Group) extends Asset
  ///////////////////////////////////////
  GUID inheritFillStyleID = 158;
  GUID inheritStrokeStyleID = 162;
  GUID inheritTextStyleID = 167;
  GUID inheritExportStyleID = 168;
  GUID inheritEffectStyleID = 169;
  GUID inheritGridStyleID = 170;
  GUID inheritFillStyleIDForStroke = 185;

  StyleId styleIdForFill = 332;
  StyleId styleIdForStrokeFill = 333;
  StyleId styleIdForText = 334;
  StyleId styleIdForEffect = 335;
  StyleId styleIdForGrid = 336;

  // TODO: Background paints no longer exist. Delete these two.
  Paint[] backgroundPaints = 193;
  GUID inheritFillStyleIDForBackground = 194 [deprecated];


  ///////////////////////////////////////
  // StateGroup extends Componentish
  ///////////////////////////////////////
  bool isStateGroup = 225;
  StateGroupPropertyValueOrder[] stateGroupPropertyValueOrders = 238;


  ///////////////////////////////////////
  // Symbol extends Componentish
  ///////////////////////////////////////
  SharedSymbolReference sharedSymbolReference = 122;

  // TODO: isSymbolPublishable could be merged with isPublishable at some point in the future
  // because they serve a similar purpose.
  bool isSymbolPublishable = 123;
  GUIDPathMapping[] sharedSymbolMappings = 124;

  // TODO: sharedSymbolVersion could be merged with version at some point in the future
  // because they serve a similar purpose.
  string sharedSymbolVersion = 126;

  SharedComponentMasterData sharedComponentMasterData = 152;
  string symbolDescription = 144;

  // Stores the mappings this symbol needs to correctly remap
  // its overrides in remote instances.
  GUIDPathMapping[] unflatteningMappings = 164;
  GUIDPathMapping[] forceUnflatteningMappings = 228;

  // c2: the following replace SharedComponentMasterData and SharedSymbolReference,
  // which aren't used in c2.
  string publishFile = 214;
  GUID publishID = 215;
  string componentKey = 216;
  bool isC2 = 217;  // Indicates whether file is under component 2.0 format
  string publishedVersion = 218;  // C2 field representing current published symbol version.

  // Deprecated
  string originComponentKey = 252 [deprecated];

  // eng-spec: http://go/ds-props
  ComponentPropDef[] componentPropDefs = 266;
  ComponentPropRef[] componentPropRefs = 267;

  ///////////////////////////////////////
  // Instance extends NodeBase
  ///////////////////////////////////////
  SymbolData symbolData = 113;                  uint symbolDataTag = 114 [deprecated]; // used by instance to reference overrides
  NodeChange[] derivedSymbolData = 125; // Uses GUIDPath as map key
  GUID overriddenSymbolID = 143;
  ComponentPropAssignment[] componentPropAssignments = 268;
  // https://paper.dropbox.com/doc/Bubbled-Props-Eng-Spec--BjWiuLkMXiUypzdlIpN8XJ7zAg-hoNxNifj2y8pdQ88w4rmd
  bool propsAreBubbled = 305;
  InstanceOverrideStash[] overrideStash = 248;
  InstanceOverrideStashV2[] overrideStashV2 = 250 [deprecated];

  ///////////////////////////////////////
  // Only used for NodeChanges within SymbolData.symbolOverrides (on instances).
  // These fields are not used independently.
  ///////////////////////////////////////
  GUIDPath guidPath = 111;                      uint guidPathTag = 112 [deprecated]; // used by instance override map
  int overrideLevel = 321;

  ///////////////////////////////////////
  // Text extends NodeBase
  ///////////////////////////////////////
  float fontSize = 21;                          uint fontSizeTag = 73 [deprecated];
  float paragraphIndent = 22;                   uint paragraphIndentTag = 74 [deprecated];
  float paragraphSpacing = 23;                  uint paragraphSpacingTag = 75 [deprecated];
  TextAlignHorizontal textAlignHorizontal = 32; uint textAlignHorizontalTag = 84 [deprecated];
  TextAlignVertical textAlignVertical = 33;     uint textAlignVerticalTag = 85 [deprecated];
  TextCase textCase = 34;                       uint textCaseTag = 86 [deprecated];
  TextDecoration textDecoration = 35;           uint textDecorationTag = 87 [deprecated];
  Number lineHeight = 40;                       uint lineHeightTag = 92 [deprecated];
  FontName fontName = 41;                       uint fontNameTag = 93 [deprecated];
  TextData textData = 42;                       uint textDataTag = 94 [deprecated];
  DerivedTextData derivedTextData = 359;
  bool fontVariantCommonLigatures = 127;
  bool fontVariantContextualLigatures = 128;
  bool fontVariantDiscretionaryLigatures = 129;
  bool fontVariantHistoricalLigatures = 130;
  bool fontVariantOrdinal = 131;
  bool fontVariantSlashedZero = 132;
  FontVariantNumericFigure fontVariantNumericFigure = 133;
  FontVariantNumericSpacing fontVariantNumericSpacing = 134;
  FontVariantNumericFraction fontVariantNumericFraction = 135;
  FontVariantCaps fontVariantCaps = 136;
  FontVariantPosition fontVariantPosition = 137;
  Number letterSpacing = 165;
  // The version of the font referenced in fontName
  string fontVersion = 202;
  LeadingTrim leadingTrim = 322;
  bool hangingPunctuation = 337;
  bool hangingList = 339;
  int maxLines = 351;

  // deprecated, use sectionStatusInfo instead
  SectionStatus sectionStatus = 352;
  SectionStatusInfo sectionStatusInfo = 355;

  uint textUserLayoutVersion = 203;

  OpenTypeFeature[] toggledOnOTFeatures = 205;
  OpenTypeFeature[] toggledOffOTFeatures = 206;
  // This is currently only ever set as a style override within a text object
  Hyperlink hyperlink = 223;

    // Used for tracking at-mentions
  Mention mention = 340;

  FontVariation[] fontVariations = 260;
  uint textBidiVersion = 279;
  TextTruncation textTruncation = 280;
  bool hasHadRTLText = 292;


  ///////////////////////////////////////
  // RenderableNode extends NodeBase
  ///////////////////////////////////////
  bool visible = 6;                             uint visibleTag = 58 [deprecated];
  bool locked = 7;                              uint lockedTag = 59 [deprecated];
  float opacity = 8;                            uint opacityTag = 60 [deprecated];
  BlendMode blendMode = 9;                      uint blendModeTag = 61 [deprecated];
  Vector size = 11;                             uint sizeTag = 63 [deprecated];
  Matrix transform = 12;                        uint transformTag = 64 [deprecated];
  float[] dashPattern = 13;                     uint dashPatternTag = 65 [deprecated];
  bool mask = 16;                               uint maskTag = 68 [deprecated];

  // Deprecated in favor of maskType
  bool maskIsOutline = 18;                      uint maskIsOutlineTag = 70 [deprecated];

  MaskType maskType = 317;
  float backgroundOpacity = 19;                 uint backgroundOpacityTag = 71 [deprecated];
  float cornerRadius = 20;                      uint cornerRadiusTag = 72 [deprecated];
  float strokeWeight = 26;                      uint strokeWeightTag = 78 [deprecated];
  StrokeAlign strokeAlign = 29;                 uint strokeAlignTag = 81 [deprecated];
  StrokeCap strokeCap = 30;                     uint strokeCapTag = 82 [deprecated];
  StrokeJoin strokeJoin = 31;                   uint strokeJoinTag = 83 [deprecated];
  Paint[] fillPaints = 38;                      uint fillPaintsTag = 90 [deprecated];
  Paint[] strokePaints = 39;                    uint strokePaintsTag = 91 [deprecated];
  Effect[] effects = 43;                        uint effectsTag = 95 [deprecated];
  Color backgroundColor = 50;                   uint backgroundColorTag = 102 [deprecated];
  Path[] fillGeometry = 51;                     uint fillGeometryTag = 103 [deprecated];
  Path[] strokeGeometry = 52;                   uint strokeGeometryTag = 104 [deprecated];

  // The following values address rectangle corner rounding:
  // Values 145-148 represent the radius of curvature of
  // each rectangle corner.  Value 149 controls whether the
  // rectangle is drawn using the global value (20) or the
  // four independent values (145-148).  We also need to keep
  // the state of the corner rounding tool (which is split
  // between web and fullscreen) because this behavior varies
  // independently of whether the rectangle's corners are
  // actually independent.  When the tool commits a change, we
  // update 145-148 and 149 appropriately.

  float rectangleTopLeftCornerRadius = 145;
  float rectangleTopRightCornerRadius = 146;
  float rectangleBottomLeftCornerRadius = 147;
  float rectangleBottomRightCornerRadius = 148;
  bool rectangleCornerRadiiIndependent = 149;
  bool rectangleCornerToolIndependent = 150;

  bool proportionsConstrained = 151;
  bool useAbsoluteBounds = 258 [deprecated];

  // These are no longer used! We realized it was simpler to represent a hidden border side by a
  // zero value on the border<side>Weight properties below
  bool borderTopHidden = 287 [deprecated];
  bool borderBottomHidden = 288 [deprecated];
  bool borderLeftHidden = 289 [deprecated];
  bool borderRightHidden = 290 [deprecated];

  bool bordersTakeSpace = 294;

  float borderTopWeight = 295;
  float borderBottomWeight = 296;
  float borderLeftWeight = 297;
  float borderRightWeight = 298;
  bool borderStrokeWeightsIndependent = 299;

  ///////////////////////////////////////
  // AutoLayout extends NodeBase
  ///////////////////////////////////////

  // TODO: Split this into two classes: 1. values on an AL frame, 2. values on children of AL frames

  ConstraintType horizontalConstraint = 28;     uint horizontalConstraintTag = 80 [deprecated];
  StackMode stackMode = 105;                    uint stackModeTag = 106 [deprecated];
  float stackSpacing = 107;                     uint stackSpacingTag = 108 [deprecated];
  float stackPadding = 109;                     uint stackPaddingTag = 110 [deprecated];
  // \`stackCounterAlign\` is being deprecated in favor of \`stackChildAlignSelf\`.
  // It's not marked [deprecated] because existing documents on prod which haven't been migrated may still depend on this field.
  // See https://paper.dropbox.com/doc/8272020-Auto-Layout-v3-server-side-migration-engineering-plan--A66p1t5jgmSnBoTeBJMAm~CkAg-cNFlCeZDA3JaJxB0DMe21
  StackCounterAlign stackCounterAlign = 120;

  // \`stackJustify\` is deprecated in favor of \`stackPrimaryAlignItems\`.
  // NOTE: This isn't marked deprecated yet because there are still some tests in file-importer that check this field.
  StackJustify stackJustify = 121;

  StackAlign stackAlign = 208 [deprecated];
  float stackHorizontalPadding = 209;
  float stackVerticalPadding = 210;

  // \`stackWidth\` and \`stackHeight\` are deprecated in favor of \`stackPrimarySizing\` and \`stackCounterSizing\`.
  StackSize stackWidth = 211 [deprecated];
  StackSize stackHeight = 212 [deprecated];

  StackSize stackPrimarySizing = 229;
  StackJustify stackPrimaryAlignItems = 230;
  StackAlign stackCounterAlignItems = 231;
  float stackChildPrimaryGrow = 232;
  float stackPaddingRight = 233;
  float stackPaddingBottom = 234;
  StackCounterAlign stackChildAlignSelf = 236;
  StackPositioning stackPositioning = 269;
  bool stackReverseZIndex = 271;
  StackWrap stackWrap = 323;
  float stackCounterSpacing = 324;
  OptionalVector minSize = 325;
  OptionalVector maxSize = 326;
  StackCounterAlignContent stackCounterAlignContent = 343;

  bool isSnakeGameBoard = 344 [deprecated];

  ///////////////////////////////////////
  // Prototyping extends NodeBase
  ///////////////////////////////////////
  GUID transitionNodeID = 139;
  GUID prototypeStartNodeID = 140;
  Color prototypeBackgroundColor = 141;
  // DEPRECATED - this was split into the individual fields below
  TransitionInfo transitionInfo = 153 [deprecated];
  TransitionType transitionType = 154;
  float transitionDuration = 155;
  EasingType easingType = 156;
  bool transitionPreserveScroll = 181;
  ConnectionType connectionType = 182;
  string connectionURL = 183;
  PrototypeDevice prototypeDevice = 184;
  // Describes the kind of interaction that triggers a navigation from
  // this node (e.g. click, mouse enter, mouse exit, etc.)
  InteractionType interactionType = 187;

  // DEPRECATED
  float transitionTimeout = 188;
  bool interactionMaintained = 189;
  float interactionDuration = 190;

  bool destinationIsOverlay = 192 [deprecated];
  bool transitionShouldSmartAnimate = 207;

  PrototypeInteraction[] prototypeInteractions = 226;
  PrototypeStartingPoint prototypeStartingPoint = 249;


  ///////////////////////////////////////
  // Plugin extends NodeBase
  ///////////////////////////////////////
  PluginData[] pluginData = 204;
  PluginRelaunchData[] pluginRelaunchData = 219;


  ///////////////////////////////////////
  // Connector extends NodeBase
  ///////////////////////////////////////
  ConnectorEndpoint connectorStart = 242;
  ConnectorEndpoint connectorEnd = 243;
  ConnectorLineStyle connectorLineStyle = 244;
  StrokeCap connectorStartCap = 245;
  StrokeCap connectorEndCap = 246;
  ConnectorControlPoint[] connectorControlPoints = 253;
  ConnectorTextMidpoint connectorTextMidpoint = 255;


  ///////////////////////////////////////
  // FigJamShape extends NodeBase
  ///////////////////////////////////////
  ShapeWithTextType shapeWithTextType = 241;
  float shapeUserHeight = 247;

  // These are fields that are calculated as part of layout for immutable frames.
  // You can think of nodeGenerationData as the inputs or source of truth and derivedImmutableFrameData
  // as the outputs. This field is used as a cache so we don't have to recalculate these fields in the viewer.
  DerivedImmutableFrameData derivedImmutableFrameData = 254;

  // Sent over the wire only, not persisted. Used to prevent flickering between active clients.
  MultiplayerFieldVersion derivedImmutableFrameDataVersion = 338;

  // This is data that is used to build out child nodes in immutable frames (stickies, connectors, etc.)
  // these are the inputs that are used to generate the actualized nodes in the canvas.
  // A much better name for this field would be immutableFrameData, but we can't rename fields in kiwi.
  NodeGenerationData nodeGenerationData = 240;

  CodeBlockLanguage codeBlockLanguage = 259;
  LinkPreviewData linkPreviewData = 278;
  bool shapeTruncates = 282;
  bool sectionContentsHidden = 283;
  VideoPlayback videoPlayback = 300;
  StampData stampData = 301;


  ///////////////////////////////////////
  // Widget extends NodeBase
  ///////////////////////////////////////
  MultiplayerMap widgetSyncedState = 273;
  uint widgetSyncCursor = 274 [deprecated];
  WidgetDerivedSubtreeCursor widgetDerivedSubtreeCursor = 275 [deprecated];
  WidgetPointer widgetCachedAncestor = 276;
  WidgetInputBehavior widgetInputBehavior = 285;
  string widgetTooltip = 286;
  WidgetHoverStyle widgetHoverStyle = 291;
  bool isWidgetStickable = 293;
  bool shouldHideCursorsOnWidgetHover = 360;
  WidgetMetadata widgetMetadata = 262;
  WidgetEvent[] widgetEvents = 263;
  WidgetPropertyMenuItem[] widgetPropertyMenuItems = 265;

  ///////////////////////////////////////
  // Table extends NodeBase
  ///////////////////////////////////////
  TableRowColumnPositionMap tableRowPositions = 308;
  TableRowColumnPositionMap tableColumnPositions = 309;
  TableRowColumnSizeMap tableRowHeights = 310;
  TableRowColumnSizeMap tableColumnWidths = 311;

  ///////////////////////////////////////
  // Assisted layout                   //
  ///////////////////////////////////////

  GUID diagramParentId = 363;
  GUID layoutRoot = 362;
  string layoutPosition = 364;
  DiagramLayoutRuleType diagramLayoutRuleType = 366;
  DiagramParentIndex diagramParentIndex = 367;
  DiagramLayoutPaused diagramLayoutPaused = 368;

  ///////////////////////////////////////
  // ForTest
  ///////////////////////////////////////
  // We use this for unit testing schema compatibility
  InternalEnumForTest internalEnumForTest = 251;

  // We use this for kiwi schema compatibility testing
  InternalDataForTest internalDataForTest = 257;


  ///////////////////////////////////////
  // TODO: triage all these into appropriate groups
  ///////////////////////////////////////
  uint count = 10;                              uint countTag = 62 [deprecated];
  bool autoRename = 14;                         uint autoRenameTag = 66 [deprecated];
  bool backgroundEnabled = 15;                  uint backgroundEnabledTag = 67 [deprecated];
  bool exportContentsOnly = 17;                 uint exportContentsOnlyTag = 69 [deprecated];
  float starInnerScale = 24;                    uint starInnerScaleTag = 76 [deprecated];
  float miterLimit = 25;                        uint miterLimitTag = 77 [deprecated];
  float textTracking = 27;                      uint textTrackingTag = 79 [deprecated];
  BooleanOperation booleanOperation = 36;       uint booleanOperationTag = 88 [deprecated];
  ConstraintType verticalConstraint = 37;       uint verticalConstraintTag = 89 [deprecated];
  VectorMirror handleMirroring = 44;            uint handleMirroringTag = 96 [deprecated];
  ExportSettings[] exportSettings = 45;         uint exportSettingsTag = 97 [deprecated];
  TextAutoResize textAutoResize = 46;           uint textAutoResizeTag = 98 [deprecated];
  LayoutGrid[] layoutGrids = 47;                uint layoutGridsTag = 99 [deprecated];
  VectorData vectorData = 48;                   uint vectorDataTag = 100 [deprecated];
  bool frameMaskDisabled = 115;                 uint frameMaskDisabledTag = 116 [deprecated];
  bool resizeToFit = 117;                       uint resizeToFitTag = 118 [deprecated];

  // don't add tags anymore... they will be removed in a future update
  bool exportBackgroundDisabled = 119;

  Guide[] guides = 138;
  bool internalOnly = 142;

  // This field would be better named OverflowDirection, which is
  // what the user sees in the UI. For that reason, most places in
  // the C++ & viewer code (but not web) also access it as OverflowDirection.
  ScrollDirection scrollDirection = 159;
  float cornerSmoothing = 160;
  Vector scrollOffset = 166 [deprecated];
  bool exportTextAsSVGText = 175;
  ScrollContractedState scrollContractedState = 178 [deprecated];
  // Due to a bug, some nodes in production have contractedSize set to some
  // non-zero value even thought it was never used for a feature used in production.
  Vector contractedSize = 179 [deprecated];
  string fixedChildrenDivider = 180 [deprecated];
  ScrollBehavior scrollBehavior = 186;

  ArcData arcData = 195;
  int derivedSymbolDataLayoutVersion = 196;

  NavigationType navigationType = 197;
  OverlayPositionType overlayPositionType = 198;
  Vector overlayRelativePosition = 199; // Deprecated into PrototypeAction
  OverlayBackgroundInteraction overlayBackgroundInteraction = 200;
  OverlayBackgroundAppearance overlayBackgroundAppearance = 201;

  // c2: durable stable ID for override mapping
  GUID overrideKey = 213;

  // This is present on a frames/instances/symbols which have been migrated to support
  // fill/stroke/corners during the \`frame_properties_migration\`.
  // Spec: https://paper.dropbox.com/doc/Tech-spec-frame-properties-8n6mTCIBtcMS7PEn50nOS
  bool containerSupportsFillStrokeAndCorners = 220;
  StackSize stackCounterSizing = 221;

  bool containersSupportFillStrokeAndCorners = 222 [deprecated];
  KeyTrigger keyTrigger = 224;
  string voiceEventPhrase = 227;
  GUID[] ancestorPathBeforeDeletion = 235;
  SymbolLink[] symbolLinks = 237;
  TextListData textListData = 239 [deprecated];

  bool detachOpticalSizeFromFontSize = 261;
  float listSpacing = 264;
  EmbedData embedData = 270;

  RichMediaData richMediaData = 272;
  // This is the value for synced state that represents what is
  // actually on the sceneGraph at a given time. This is not actually
  // used as a multiplayer map and should be synced atomically it just
  // shares the exact same shape.
  MultiplayerMap renderedSyncedState = 277;

  // Set on a component and controls whether a simpler layer and property panel is
  // shown for instances.
  bool simplifyInstancePanels = 284;

  // Used for accessibility annotations
  HTMLTag accessibleHTMLTag = 302;
  ARIARole ariaRole = 303;
  string accessibleLabel = 304;

  VariableData variableData = 306 [deprecated];

  // The following fields encode variable bindings on variable consumers:
  // 1. The consumption map contains bindings of simple fields.
  VariableDataMap variableConsumptionMap = 307;
  // 2. The modeBySet map contains the specific mode of variable sets used by
  // the consumer.
  VariableModeBySetMap variableModeBySetMap = 316;

  // Present on variable set nodes only.
  VariableSetMode[] variableSetModes = 312;

  // The following fields are present variable nodes only.
  // Identifies the set that the variable belongs to.
  VariableSetID variableSetID = 313;
  VariableResolvedDataType variableResolvedType = 314;
  // Specifies the variable data for the variable under each mode.
  VariableDataValues variableDataValues = 315;
  string variableTokenName = 350 [deprecated];

  // What scopes this variable is shown in (i.e. what fields can
  // this variable be used in). null = all fields
  VariableScope[] variableScopes = 353;

  // User defined token names for a variable, used in Lego and import/export
  CodeSyntaxMap codeSyntax = 358;

  HandoffStatusMap handoffStatusMap = 361;

  AgendaPositionMap agendaPositionMap = 327;
  AgendaMetadataMap agendaMetadataMap = 328;

  // only set on the root DOCUMENT element
  MigrationStatus migrationStatus = 329;

  // generic replacement for isSoftDeletedStyle that can be applied to other asset types
  bool isSoftDeleted = 330;

  // only set on top level frames
  EditInfo editInfo = 331;

  // This is currently not being used but could be used in the future to allow for per node color profiles.
  // For the document color profile, see documentColorProfile.
  ColorProfile colorProfile = 341 [deprecated];

  // Set whenever an instance is detached, making it possible to find the original component later on.
  SymbolId detachedSymbolId = 342;

  // Controls the primary reading order for children of this node.
  ChildReadingDirection childReadingDirection = 346;
  // The explicit reading order for this node within its parent.
  string readingIndex = 347;

  // only set on the root DOCUMENT element
  DocumentColorProfile documentColorProfile = 349;

  // temporarily stores related links for copy and paste
  DeveloperRelatedLink[] developerRelatedLinks = 354;

  string slideActiveThemeLibKey = 356;

	// a map of ARIA attributes to their values (e.g. aria-checked="true")
  ARIAAttributesMap ariaAttributes = 357;

  // A list of the edit scope stacks that this node was changed under. May be multiple stacks if
  // this NodeChange sets multiple fields.
  // go/edit-scopes-backend
  EditScopeInfo editScopeInfo = 365;
  ///////////////////////////////////////
  // See top-level NodeChanges comment to find the next available field index.
  ///////////////////////////////////////
}

message VideoPlayback {
  bool autoplay = 1;
  bool mediaLoop = 2;
  bool muted = 3;
}

enum MediaAction {
  PLAY = 0;
  PAUSE = 1;
  TOGGLE_PLAY_PAUSE = 2;
  MUTE = 3;
  UNMUTE = 4;
  TOGGLE_MUTE_UNMUTE = 5;
  SKIP_FORWARD = 6;
  SKIP_BACKWARD = 7;
  SKIP_TO = 8;
}

message WidgetHoverStyle {
  Paint[] fillPaints = 1;
  Paint[] strokePaints = 2;
  float opacity = 3;
  bool areFillPaintsSet = 4;
  bool areStrokePaintsSet = 5;
  bool isOpacitySet = 6;
}

// Deprecated
message WidgetDerivedSubtreeCursor {
  uint sessionID = 1;
  uint counter = 2;
}

// A special type that knows how to diff and merge itself, allowing
// separate sessions to write to the map concurrently without
// clobbering each other's changes.
message MultiplayerMap {
  MultiplayerMapEntry[] entries = 1;
}

message MultiplayerMapEntry {
  string key = 1;
  string value = 2;
}

message VariableDataMap {
  VariableDataMapEntry[] entries = 1;
}

message VariableDataMapEntry {
  uint nodeField = 1; // deprecated, should write to variableField instead
  VariableData variableData = 2;
  VariableField variableField = 3;
}

enum VariableField {
  MISSING = 0;
  CORNER_RADIUS = 1; // deprecated, should write to RECTANGLE_X_X_CORNER_RADIUS instead
  PARAGRAPH_SPACING = 2;
  PARAGRAPH_INDENT = 3;
  STROKE_WEIGHT = 4; // deprecated, should write to BORDER_X_WEIGHT instead
  STACK_SPACING = 5;
  STACK_PADDING_LEFT = 6;
  STACK_PADDING_TOP = 7;
  STACK_PADDING_RIGHT = 8;
  STACK_PADDING_BOTTOM = 9;
  VISIBLE = 10;
  TEXT_DATA = 11;
  WIDTH = 12;
  HEIGHT = 13;
  RECTANGLE_TOP_LEFT_CORNER_RADIUS = 14;
  RECTANGLE_TOP_RIGHT_CORNER_RADIUS = 15;
  RECTANGLE_BOTTOM_LEFT_CORNER_RADIUS = 16;
  RECTANGLE_BOTTOM_RIGHT_CORNER_RADIUS = 17;
  BORDER_TOP_WEIGHT = 18;
  BORDER_BOTTOM_WEIGHT = 19;
  BORDER_LEFT_WEIGHT = 20;
  BORDER_RIGHT_WEIGHT = 21;
  VARIANT_PROPERTIES = 22;
  STACK_COUNTER_SPACING = 23;
  MIN_WIDTH = 24;
  MAX_WIDTH = 25;
  MIN_HEIGHT = 26;
  MAX_HEIGHT = 27;
}

message VariableModeBySetMap {
  VariableModeBySetMapEntry[] entries = 1;
}

message VariableModeBySetMapEntry {
  VariableSetID variableSetID = 1;
  GUID variableModeID = 2;
}

message CodeSyntaxMap {
  CodeSyntaxMapEntry[] entries = 1;
}

message CodeSyntaxMapEntry {
  CodeSyntaxPlatform platform = 1;
  string value = 2;
}

message TableRowColumnPositionMap {
  TableRowColumnPositionMapEntry[] entries = 1;
}
message TableRowColumnPositionMapEntry {
  GUID id = 1;
  string position = 2;
}

message TableRowColumnSizeMap {
  TableRowColumnSizeMapEntry[] entries = 1;
}

message TableRowColumnSizeMapEntry {
  GUID id = 1;
  float size = 2;
}

message AgendaPositionMap {
  AgendaPositionMapEntry[] entries = 1;
}

message AgendaPositionMapEntry {
  GUID id = 1;
  string position = 2;
}

enum AgendaItemType {
  NODE = 0; // node (such as a section) associated with this particular agenda item
  BLOCK = 1; // free floating item not tied to any node, such as "break"
}

message AgendaMetadataMap {
  AgendaMetadataMapEntry[] entries = 1;
}

message AgendaMetadataMapEntry {
  GUID id = 1;
  AgendaMetadata data = 2;
}

message AgendaMetadata {
  string name = 1;
  AgendaItemType type = 2;
  GUID targetNodeID = 3; // optional node ID that points to a node on canvas, such as a section
  AgendaTimerInfo timerInfo = 4;
  AgendaVoteInfo voteInfo = 5;
  AgendaMusicInfo musicInfo = 6;
}

message AgendaTimerInfo {
  uint timerLength = 1;
}

message AgendaVoteInfo {
  uint voteCount = 1;
}

message AgendaMusicInfo {
  string songID = 1;
  uint startTimeMs = 2;
}

enum DiagramLayoutRuleType {
  NONE = 0;
  TREE = 1;
}

struct DiagramParentIndex {
  GUID guid;
  string position;
}

enum DiagramLayoutPaused {
  NO = 0;
  YES = 1;
}

message ComponentPropRef {
  uint nodeField = 1; // should not be written to and componentPropNodeField used instead
  GUID defID = 2;
  string zombieFallbackName = 3;
  ComponentPropNodeField componentPropNodeField = 4;
  bool isDeleted = 5; // deprecated
}

// Should be kept in sync with decodeComponentPropNodeField in serialization.sk
enum ComponentPropNodeField {
  VISIBLE = 0;
  TEXT_DATA = 1;
  OVERRIDDEN_SYMBOL_ID = 2;
  INHERIT_FILL_STYLE_ID = 3; // deprecated
}

message ComponentPropAssignment {
  GUID defID = 1;
  ComponentPropValue value = 2;
}

message ComponentPropDef {
  GUID id = 1;
  string name = 2;
  // NOTE: In most places in the code, we refer to the component prop value
  // as the default value. This field is called initial value for historical
  // reasons; since we can't easily rename this here, we continue to refer to
  // default value as initial value when encoding/decoding kiwi messages.
  ComponentPropValue initialValue = 3;
  string sortPosition = 4;
  GUID parentPropDefId = 5;
  ComponentPropType type = 6;
  bool isDeleted = 7; // deprecated
  ComponentPropPreferredValues preferredValues = 8;
}

// every ComponentPropDef and ComponentPropAssignment value
// will have exactly one field in ComponentPropValue set.
message ComponentPropValue {
  bool boolValue = 1;
  TextData textValue = 2;
  GUID guidValue = 3;
}

// Should be kept in sync with mapPublicComponentPropTypeToKiwi in jsvm_node_properties.ts
enum ComponentPropType {
  BOOL = 0;
  TEXT = 1;
  COLOR = 2; // deprecated
  INSTANCE_SWAP = 3;
}

message ComponentPropPreferredValues {
  string[] stringValues = 1 [deprecated];
  InstanceSwapPreferredValue[] instanceSwapValues = 2;
}

message InstanceSwapPreferredValue {
  InstanceSwapPreferredValueType type = 1;
  string key = 2;
}

enum InstanceSwapPreferredValueType {
  COMPONENT = 0;
  STATE_GROUP = 1;
}

enum WidgetEvent {
  MOUSE_DOWN = 0;
  CLICK = 1;
  TEXT_EDIT_END = 2;
  ATTACHED_STICKABLES_CHANGED = 3;
  STUCK_STATUS_CHANGED = 4;
}

enum WidgetInputBehavior {
  WRAP = 0;
  TRUNCATE = 1;
  MULTILINE = 2;
}

message WidgetMetadata {
  string pluginID = 1;
  string pluginVersionID = 2;
  string widgetName = 3;
}

enum WidgetPropertyMenuItemType {
  ACTION = 0;
  SEPARATOR = 1;
  COLOR = 2; // deprecated
  DROPDOWN = 3;
  COLOR_SELECTOR = 4;
  TOGGLE = 5;
  LINK = 6;
}

message WidgetPropertyMenuSelectorOption {
  string option = 1;
  string tooltip = 2;
}

message WidgetPropertyMenuItem {
  string propertyName = 1;
  string tooltip = 2;
  WidgetPropertyMenuItemType itemType = 3;
  string icon = 4; // svg string for the icon to display eg. "<svg ..."
  WidgetPropertyMenuSelectorOption[] options = 5; // array of strings used for selector menus
  string selectedOption = 6; // the selected value for selector menus
  bool isToggled = 7; // defaults to false, is true when button is selected
  string href = 8; // url to open for link menu items
  bool allowCustomColor = 9; // defaults to false, can be set to true to allow users to choose custom colors with the color selector
}

enum CodeBlockLanguage {
  TYPESCRIPT = 0;
  CPP = 1;
  RUBY = 2;
  CSS = 3;
  JAVASCRIPT = 4;
  HTML = 5;
  JSON = 6;
  GRAPHQL = 7;
  PYTHON = 8;
  GO = 9;
  SQL = 10;
  SWIFT = 11;
  KOTLIN = 12;
  RUST = 13;
  BASH = 14;
  PLAINTEXT = 15;
}

enum InternalEnumForTest {
  OLD = 1;
}

message InternalDataForTest {
  int testFieldA = 1;
}

message StateGroupPropertyValueOrder {
  string property = 1;
  string[] values = 2;
}

// Deprecated in favor of TextLineData
message TextListData {
  int listID = 1 [deprecated];
  BulletType bulletType = 2 [deprecated];
  int indentationLevel = 3 [deprecated];
  int lineNumber = 4 [deprecated];
}

// Deprecated in favor of LineType
enum BulletType {
  ORDERED = 0;
  UNORDERED = 1;
  INDENT = 2;
  NO_LIST = 3;
}

message TextLineData {
  LineType lineType = 1;
  int indentationLevel = 2;
  SourceDirectionality sourceDirectionality = 9;
  Directionality directionality = 3;
  DirectionalityIntent directionalityIntent = 4;
  int downgradeStyleId = 5;
  int consistencyStyleId = 6;
  int listStartOffset = 7;
  bool isFirstLineOfList = 8;
}

message DerivedTextLineData {
  Directionality directionality = 1;
}

enum LineType {
  PLAIN = 0;
  ORDERED_LIST = 1;
  UNORDERED_LIST = 2;
  BLOCKQUOTE = 3;
  HEADER = 4;
}

enum SourceDirectionality {
  AUTO = 0;
  LTR = 1;
  RTL = 2;
}

enum Directionality {
  LTR = 0;
  RTL = 1;
}

enum DirectionalityIntent {
  IMPLICIT = 0;
  EXPLICIT = 1;
}

message PrototypeInteraction {
  GUID id = 1;
  PrototypeEvent event = 2;
  PrototypeAction[] actions = 3;
  bool isDeleted = 4;
  int stateManagementVersion = 5;
}

message PrototypeEvent {
  InteractionType interactionType = 1;
  // When interactionType is MOUSE_IN/MOUSE_ENTER, MOUSE_OUT/MOUSE_LEAVE, MOUSE_DOWN or MOUSE_UP
  // and interactionMaintained is true, we wait for the interaction to "keep
  // going" for some specified duration before triggering its action.
  //
  // For example if interactionType is MOUSE_DOWN and interactionDuration
  // is 300, then we will wait for the user to continually mouse down for
  // 300ms before performing the requested action.
  bool interactionMaintained = 2;
  // Stored in milliseconds
  float interactionDuration = 3;
  // Used for keydown events transition triggers and in the future keyup
  KeyTrigger keyTrigger = 4;
  string voiceEventPhrase = 5;
  // If we transition to a node in the prototype view with
  // interactionType == AFTER_TIMEOUT, then after the duration specified
  // in transitionTimeout we should navigate again with whatever
  // transition properties are stored on this node.
  //
  // This duration is stored in ms.
  float transitionTimeout = 6;
  // Point in video to trigger ON_MEDIA_HIT events
  float mediaHitTime = 7;
}

// The information about a variable we're targetting for a
// Set Variable PrototypeAction. This may grow to include info about
// modes.
message PrototypeVariableTarget {
  VariableID id = 1;
}

// The list of actions to execute for Conditional actions in prototype interactions
message ConditionalActions {
  PrototypeAction[] actions = 1;
  VariableData condition = 2;
}

message PrototypeAction {
  GUID transitionNodeID = 1;
  TransitionType transitionType = 2;
  float transitionDuration = 3;
  EasingType easingType = 4;
  // This was moved into PrototypeEvent
  float transitionTimeout = 5 [deprecated];
  bool transitionShouldSmartAnimate = 6;
  ConnectionType connectionType = 7;
  string connectionURL = 8;
  Vector overlayRelativePosition = 9;
  NavigationType navigationType = 10;
  bool transitionPreserveScroll = 11;
  float[] easingFunction = 12;
  Vector extraScrollOffset = 13;

  // For Set Variable action
  // Deprecated for the VariableID version below
  GUID targetVariableID = 14 [deprecated];

  // For Set Variable action
  // Deprecated for targetVariableData
  VariableAnyValue targetVariableValue = 15 [deprecated];


  MediaAction mediaAction = 16;
  bool transitionResetVideoPosition = 17;
  bool openUrlInNewTab = 18;

  PrototypeVariableTarget targetVariable = 19;
  VariableData targetVariableData = 20;

  // Point in video for SET_TO media actions (in seconds)
  float mediaSkipToTime = 21;
  // Time delta to change the video by for SKIP_FORWARD/BACKWARD media actions (in seconds)
  float mediaSkipByAmount = 22;

  // This is deprecated in favor of the conditionalActions field
  VariableData[] conditions = 23;

  // This array holds the list of conditions and the actions to be run if said
  // condition is true.  We will iterate through each conditionalAction object
  // and find the first one with a true condition, then run its actions.
  ConditionalActions[] conditionalActions = 24;

  bool transitionResetScrollPosition = 25;
  bool transitionResetInteractiveComponents = 26;
}

message PrototypeStartingPoint {
  string name = 1;
  string description = 2;
  string position = 3;  // this is a string and not a number in order to use Fractional Indexing
}

enum TriggerDevice {
  KEYBOARD = 0;
  UNKNOWN_CONTROLLER = 1;
  XBOX_ONE = 2;
  PS4 = 3;
  SWITCH_PRO = 4;
}

message KeyTrigger {
  int[] keyCodes = 1;
  TriggerDevice triggerDevice = 2;
}

message Hyperlink {
  // This object either contains a url or a node ID -- never both!
  string url = 1;
  GUID guid = 2;
}

enum MentionSource {
  DEFAULT = 0;
  COPY_DUPLICATE = 1;
}

message Mention {
  GUID id = 1;
  string mentionedUserId = 2; // deprecated - use mentionedUserIdInt
  string mentionedByUserId = 3; // deprecated - use mentionedByUserIdInt
  // Allows us to ignore mentions that came from file duplication
  string fileKey = 4;
  // Where did the mention came from. Used to filter which ones should be processed
  MentionSource source = 5;

  uint64 mentionedUserIdInt = 6;
  uint64 mentionedByUserIdInt = 7;
}


message EmbedData {
  string url = 1;
  string srcUrl = 2;
  string title = 3;
  string thumbnailUrl = 4;
  float width = 5;
  float height = 6;

  string embedType = 7;
  string thumbnailImageHash = 8;
  string faviconImageHash = 9;
  string provider = 10;
  string originalText = 11;
  string description = 12;
  // embedVersionId is a string in the form of "v0", "v1", etc - each integer is a 1:1 mapping to which embed React component will be rendered
  string embedVersionId = 13;
}

message StampData {
  string userId = 1;
  string votingSessionId = 2;
  string stampedByUserId = 3;
}

message LinkPreviewData {
  string url = 1;
  string title = 2;
  string provider = 3;
  string description = 4;
  string thumbnailImageHash = 5;
  string faviconImageHash = 6;
  float thumbnailImageWidth = 7;
  float thumbnailImageHeight = 8;
}

message Viewport {
  Rect canvasSpaceBounds = 1;
  bool pixelPreview = 2;
  float pixelDensity = 3;
  GUID canvasGuid = 4;
}

message Mouse {
  MouseCursor cursor = 1;
  Vector canvasSpaceLocation = 2;
  Rect canvasSpaceSelectionBox = 3;
  GUID canvasGuid = 4;
  uint cursorHiddenReason = 5;
}

struct Click {
  uint id;
  Vector point; // In canvas space
}

struct ScrollPosition {
  GUID node;
  Vector scrollOffset;
}

// DEPRECATED
struct TriggeredOverlay {
  GUID overlayGuid;
  GUID hotspotGuid;
  GUID swapGuid;
}

message TriggeredOverlayData {
  GUID overlayGuid = 1;
  GUID hotspotGuid = 2; // TODO(achan): Deprecate
  GUID swapGuid = 3;
  GUID prototypeInteractionGuid = 4;

  GUIDPath hotspotBlueprintId = 5;
}

message PresentedState {
  GUID baseScreenID = 1;
  TriggeredOverlayData[] overlays = 2;
}

enum TransitionDirection {
  FORWARD = 0;
  REVERSE = 1;
}

message TopLevelPlaybackChange {
  PresentedState oldState = 1;
  PresentedState newState = 2;

  GUIDPath hotspotBlueprintID = 3;
  GUID interactionID = 4;
  bool isHotspotInNewPresentedState = 5;
  TransitionDirection direction = 6;
  GUIDPath instanceStablePath = 7;
}

message InstanceStateChange {
  GUID stateID = 1;
  GUID interactionID = 2;
  GUIDPath hotspotStablePath = 3;
  GUIDPath instanceStablePath = 4;
  PlaybackChangePhase phase = 5;
}

message TextCursor {
  Rect selectionBox = 1;
  GUID canvasGuid = 2 [deprecated];
  GUID textNodeGuid = 3;
}

message TextSelection {
  Rect[] selectionBoxes = 1;
  GUID canvasGuid = 2 [deprecated];
  GUID textNodeGuid = 3;
  Vector textSelectionRange = 4;
  GUID textNodeOrContainingIfGuid = 5;
  GUID tableCellRowId = 6;
  GUID tableCellColId = 7;
}

enum PlaybackChangePhase {
  INITIATED = 0;
  ABORTED = 1;
  COMMITTED = 2;
}

message PlaybackChangeKeyframe {
  PlaybackChangePhase phase = 1;
  float progress = 2; // Should be between 0 and 1
  float timestamp = 3; // Time in seconds
}

message StateMapping {
  GUIDPath stablePath = 1;
  TopLevelPlaybackChange lastTopLevelChange = 2;
  PlaybackChangeKeyframe lastTopLevelChangeStatus = 3; // Time at which lastChange entered lastChangeStatus on the driver client
  float timestamp = 4;
}

message ScrollMapping {
  GUIDPath blueprintID = 1;
  uint overlayIndex = 2;
  Vector scrollOffset = 3;
}

message PlaybackUpdate {
  TopLevelPlaybackChange lastTopLevelChange = 1;
  PlaybackChangeKeyframe lastTopLevelChangeStatus = 2;

  ScrollMapping[] scrollMappings = 3;
  float timestamp = 4; // Time in seconds
  Vector pointerLocation = 5; // Canvas-space mouse coordinates
  bool isTopLevelFrameChange = 6;
  StateMapping[] stateMappings = 7; // Deprecated
}

// This is a \`message\` (instead of just a \`string message\` on UserChange)
// so that we can add more properties to it in future if we want to.
message ChatMessage {
  string text = 1; // current message, not renamed to maintain backwards compatibility
  string previousText = 2;
}

// Message for all voice chat related metadata.
message VoiceMetadata {
  string connectedCallId = 1;
}

enum Heartbeat {
  FOREGROUND = 0;
  BACKGROUND = 1;
}

message UserChange {
  uint sessionID = 1;
  bool connected = 2;
  string name = 3;
  Color color = 4;
  string imageURL = 5;
  Viewport viewport = 6;
  Mouse mouse = 7;
  GUID[] selection = 8;
  uint[] observing = 9;
  string deviceName = 10; // Valid values: "viewer" | "editor" | "prototype"

  // Only keeps the last N around to avoid being a memory leak
  Click[] recentClicks = 11;
  ScrollPosition[] scrollPositions = 12; // TODO(achan): Deprecate
  TriggeredOverlay[] triggeredOverlays = 13 [deprecated];

  string userID = 14;

  GUID lastTriggeredHotspot = 15; // TODO(achan): Deprecate
  GUID lastTriggeredPrototypeInteractionID = 16; // TODO(achan): Deprecate
  TriggeredOverlayData[] triggeredOverlaysData = 17; // TODO(achan): Deprecate

  PlaybackUpdate[] playbackUpdates = 18 [deprecated];
  ChatMessage chatMessage = 19;
  VoiceMetadata voiceMetadata = 20;
  bool canWrite = 21;
  bool highFiveStatus = 22;
  InstanceStateChange[] instanceStateChanges = 23;
  TextCursor textCursor = 24;
  TextSelection textSelection = 25;
  uint connectedAtTimeS = 26; // Time in seconds connected since the start of multiplayer server
  bool focusOnTextCursor = 27;
  Heartbeat heartbeat = 28;
}

message SceneGraphQuery {
  GUID startingNode = 1;
  uint depth = 2;
}

// Deprecated.
message NodeChangesMetadata {
  uint blobsFieldOffset = 1;
}

message CursorReaction {
  string imageUrl = 1;
}

message TimerInfo {
  bool isPaused = 1;
  uint timeRemainingMs = 2;
  uint totalTimeMs = 3;
  uint timerID = 4;
  string setBy = 5;
  uint songID = 6 [deprecated];
  uint lastReceivedSongTimestampMs = 7;
  string songUUID = 8;
}

message MusicInfo {
  bool isPaused = 1;
  uint messageID = 2;
  string songID = 3;
  uint lastReceivedSongTimestampMs = 4;
  bool isStopped = 5;
}

message PresenterNomination {
  uint sessionID = 1;
  bool isCancelled = 2;
}

message PresenterInfo {
  uint sessionID = 1;
  PresenterNomination nomination = 2;
}

// ClientBroadcasts are a way to broadcast information verbatim from one
// client in a file to all others. If you're wondering whether to use a
// signal, a client broadcast, or UserChanges, here are some guidelines...
//
//  - Signals are for the behind-the-scenes functioning of our protocol
//    and have very simple payloads (always a short string). Examples: a
//    client telling the server why it's disconnecting, or the server telling
//    the client why it can't connect.
//  - ClientBroadcasts are a way to publish user actions to other clients. They
//    have arbitrarily complex payloads and are ephemeral (i.e. multiplayer
//    server can forget about them once they've been broadcast). Examples:
//    cursor reactions.
//  - UserChanges are a way to publish user actions to other clients. They have
//    arbitrarily complex payloads and are stateful. Multiplayer remembers their
//    last-sent values (per client) and sends them to new clients on connect.
//    Examples: mouse cursor position, selection.
message ClientBroadcast {
  // Describes which session this is from. The sessionID in Message is not sufficient
  // for this because, as an optimization, the multiplayer server collates broadcasts
  // from various sessions and sends them to clients as a single message.
  uint sessionID = 1;

  // Exactly one member of ClientBroadcast should be non-null at a given time.
  // If you're adding a new kind of broadcast, implement a message that
  // describes your broadcast and then add it as a member to ClientBroadcast.
  CursorReaction cursorReaction = 2;
  TimerInfo timer = 3;
  PresenterInfo presenter = 4;
  PresenterInfo prototypePresenter = 5;
  MusicInfo music = 6;
}

message Message {
  // NEXT ID: 33

  MessageType type = 1;
  uint sessionID = 2;
  uint ackID = 3;
  NodeChange[] nodeChanges = 4;
  UserChange[] userChanges = 5;

  // All large arrays of bytes are pulled up to the top level and deduplicated to save space.
  // These blobs are referenced by index. blobBaseIndex determines how blob indices are resolved.
  // See the comment below for more details.
  Blob[] blobs = 6;

  // The value of this field controls how blob references inside this message should be resolved.
  // Specifically, blobs in this message are given indices starting with the number stored in this
  // field. Thus, if the value of this field is 0, all blob references this message refer to blobs
  // contained within the same message. But if the value of this field is non-zero, blob references
  // in this message may refer to blobs transmitted in an earlier message which the client is expected
  // to retain. For more information see:
  // https://paper.dropbox.com/doc/Chunked-File-Loads-Blobs-Handling--Bt509lHm1xl_rJZ9TFjQqZ7vAQ-7P7VnuIZ410PhfxEsJpXu
  uint blobBaseIndex = 30;

  string signalName = 7;
  Access access = 8;
  string styleSetName = 9;
  StyleSetType styleSetType = 10;
  StyleSetContentType styleSetContentType = 11;

  // This is used to support pasting with an offset from the original copied location if both the copy and paste are within the same document
  int pasteID = 12;
  Vector pasteOffset = 13;
  string pasteFileKey = 14; // designate whether paste came from same file or not, shallow vs. deep copy (eventually shared asset ref)

  // This was added so that signals can contain debugging information. In
  // practice it is used to send arbitrary data along with signals.
  string signalPayload = 15;
  SceneGraphQuery[] sceneGraphQueries = 16;

  // Deprecated.
  NodeChangesMetadata nodeChangesMetadata = 17 [deprecated];

  // Sent in JOIN_START messages. See https://www.notion.so/figma/The-fig-file-format-95aea405c2334eb0b753ca5524a12616
  uint fileVersion = 18;

  // This is used to further support pasting for copy/paste V4.
  bool pasteIsPartiallyOutsideEnclosingFrame = 19;
  GUID pastePageId = 20;

  // This is used to support pasting cut components as main components when
  // pasting into a different file.
  bool isCut = 21;

  // This is used to migrate the user's local undo/redo buffer at the same time
  // as the user's local pending changes. Each \`Message\` contains a single batch
  // of \`NodeChange\`s.
  Message[] localUndoStack = 22;
  Message[] localRedoStack = 23;

  // Used when this is a CLIENT_BROADCAST message
  ClientBroadcast[] broadcasts = 24;

  // The sequence number of the file is stored by clients and is sent up to the
  // server to determine if their local file is up-to-date and can use the fast
  // reconnect path.
  uint reconnectSequenceNumber = 25;

  // If a client copies (or cuts) from a branch, we populate this so that the
  // pasting client knows the source file for that branch. This is mainly needed
  // to compute component keys correctly when symbols are cloned from branch files.
  string pasteBranchSourceFileKey = 26;

  // The editor type of the file the client copies from
  EditorType pasteEditorType = 27;

  // Included in NODE_CHANGES messages sent from the client to multiplayer to
  // indicate actions to be taken after applying the changes in the message.
  // Currently used when merging a branch.
  string postSyncActions = 28;

  // Populated on the clipboard PasteData with the guids of cut assets that have been
  // published. Used to determine when to populate LibraryMoveInfo for an asset on paste.
  GUID[] publishedAssetGuids = 29;

  // Indicates that all \`nodeChanges\` contained in the message were generated
  // automatically on file load (fullscreen does this in various cases, like generating
  // derived data or geometry) and not in response to a user's explicit action.
  bool dirtyFromInitialLoad = 31;
}


// Uses the word "DiffChunk" instead of "MergeChunk" to indicate that it's
// appropriate to use for features beyond merging (e.g. version history).
// A good high-level explanation:
// https://paper.dropbox.com/doc/Sub-Spec-M2.5-Visualization--Bh3xREZiEPBaTpCWYMk4Pqv7Ag-PZ7rFvdL0QLRvSVECLuFK
message DiffChunk {

  // References DiffPayload.nodeChanges with indices (as opposed to GUIDs)
  // so that we have the future option of multiple changes per node GUID.
  // (e.g. if we wanted to separate each property change).
  uint[] nodeChanges = 1;

  NodePhase phase = 2 [deprecated];

  // Includes a complete copy of NodeChange for the display node to
  // separate the concern of identifying the display node vs selecting
  // which properties are necessary for display. This avoids updating
  // the schema for display-specific changes. (e.g. if a new property
  // type becomes necessary to select the correct icon) This means storing
  // more properties than may ultimately get used, but we\u2019re okay with
  // that trade-off to avoid error-prone maintenance.
  NodeChange displayNode = 3;

  // Containing canvas
  // Inlined because these properties are very unlikely to change and
  // small enough that duplication is not concerning.
  // The fields canvasId, canvasName, canvasIsInternal should be deprecated
  // but are still being used in web.
  GUID canvasId = 4;
  string canvasName = 5;
  bool canvasIsInternal = 6;

  // If present, this chunk is "affected by/downstream of" the referenced chunks
  // Using back-references here avoids duplicating "downstream" chunks,
  // and matches the direction of the underlying node dependencies.
  // Using array indexes instead of GUIDS allows for the unlikely future
  // possibilities of more than one chunk with the same display node but
  // different changes, or a chunk with multiple display nodes.
  // NOTE: Variants are a special case of dependency, eg:
  // isVariant(c) => c.isState && c.chunksAffectingThisChunk().filter(dc => dc.isStateGroup)
  uint[] chunksAffectingThisChunk = 7;

  // basisParentHierarchy is the hierarchy from the 'from' of the diff, and
  // parentHierarchy is the hierarchy from the 'to' of the diff.

  // Parent hierarchy is a bottom-ups array of parents that qualify as a chunk.
  // For example, if we have a variant in a state group in the internal canvas,
  // then that variant's parent hierarchy would be:
  // [<StateGroup NodeChanges>, <InternalCanvas NodeChanges>].
  // This information is used for a variety of purposes like doing special
  // grouping for removed nodes, grouping variants into their state groups,
  // and for determining information about that chunk's containing canvas.
  // NOTE: these fields should be deprecated once basisParentHierarchyGuids
  // and parentHierarchyGuids are rolled out.
  NodeChange[] basisParentHierarchy = 8;
  NodeChange[] parentHierarchy = 9;

  // basisParentHierarchyGuids is the hierarchy from the 'from' of the diff, and
  // parentHierarchyGuids is the hierarchy from the 'to' of the diff.

  // Parent hierarchy is a bottom-ups array of GUIDs corresponding to parent node changes that qualify as a chunk.
  // For example, if we have a variant in a state group in the internal canvas,
  // then that variant's parent hierarchy would be:
  // [<StateGroup NodeChange GUID>, <InternalCanvas NodeChange GUID>].
  // This information is used for a variety of purposes like doing special
  // grouping for removed nodes, grouping variants into their state groups,
  // and for determining information about that chunk's containing canvas.
  // The GUIDs reference to NodeChanges in the DiffPayload's basisParentNodeChanges and parentNodeChanges fields
  GUID[] basisParentHierarchyGuids = 10;
  GUID[] parentHierarchyGuids = 11;
}

message DiffPayload {
  // A list of changes for each node. Each NodeChange is guaranteed to have GUID
  // and at least one property.
  NodeChange[] nodeChanges = 1;

  // For fields that have potentially large and repetitive binary data,
  // we store references to external blob data. This allows de-duplication.
  // Blob data is serialized as a separate top-level array.
  Blob[] blobs = 2;

  // Metadata that groups every nodeChange from above into related changes based
  // on a heuristic. See rust/fig-diff/src/chunks.rs for the implementation.
  DiffChunk[] diffChunks = 3;

  // One for every item in nodeChanges above.
  NodeChange[] diffBasis = 4;

  // Distinct node changes corresponding to the superset of GUIDs from every DiffChunk's basisParentHierarchyGuids.
  NodeChange[] basisParentNodeChanges = 5;

  // Distinct node changes corresponding to the superset of GUIDs from every DiffChunk's parentHierarchyGuids.
  NodeChange[] parentNodeChanges = 6;
}

enum RichMediaType {
  // GIF1
  ANIMATED_IMAGE = 0;
  // Video
  VIDEO = 1;
}

message RichMediaData {
  string mediaHash = 1;
  RichMediaType richMediaType = 2;
}

// Each variable can be only one specific type.
// This informs what type this variable holds.
enum VariableDataType {
  BOOLEAN = 0;
  FLOAT = 1;
  STRING = 2;
  ALIAS = 3;
  COLOR = 4;
  EXPRESSION = 5;
  MAP = 6;
  SYMBOL_ID = 7;
}

// The resolved type of the variable.
// This is used to determine which variables can
// be bound to what field.
// KEEP_IN_SYNC(sinatra/lib/models/variable.rb)
enum VariableResolvedDataType {
  BOOLEAN = 0;
  FLOAT = 1;
  STRING = 2;
  COLOR = 4;
  MAP = 5;
  SYMBOL_ID = 6;
}

// This holds the value of a variable. Since we don't support Any we can use
// VariableAnyValue with one and only one of the fields populated.
message VariableAnyValue {
  bool boolValue = 1;
  string textValue = 2;
  float floatValue = 3;
  VariableID alias = 4;
  Color colorValue = 5;
  Expression expressionValue = 6;
  VariableMap mapValue = 7;
  SymbolId symbolIdValue = 8;
}

enum ExpressionFunction {
  ADDITION = 0;
  SUBTRACTION = 1;
  RESOLVE_VARIANT = 2;
  MULTIPLY = 3;
  DIVIDE = 4;
  EQUALS = 5;
  NOT_EQUAL = 6;
  LESS_THAN = 7;
  LESS_THAN_OR_EQUAL = 8;
  GREATER_THAN = 9;
  GREATER_THAN_OR_EQUAL = 10;
  AND = 11;
  OR = 12;
  NOT = 13;
  STRINGIFY = 14;
  TERNARY = 15;
  VAR_MODE_LOOKUP = 16;
}

message Expression {
  ExpressionFunction expressionFunction = 1;
  VariableData[] expressionArguments = 2;
}

// Most expressions will use a simple VariableData[] of args,
// but some functions like RESOLVE_VARIANT need it stored as a map
message VariableMapValue {
  string key = 1;
  VariableData value = 2;
}

message VariableMap {
  VariableMapValue[] values = 1;
}

message VariableData {
  VariableAnyValue value = 1;
  VariableDataType dataType = 2;
  VariableResolvedDataType resolvedDataType = 3;
}

message VariableSetMode {
  GUID id = 1;
  string name = 2;
  string sortPosition = 3;
}

message VariableDataValues {
  VariableDataValuesEntry[] entries = 1;
}

message VariableDataValuesEntry {
  GUID modeID = 1;
  VariableData variableData = 2;
}

// KEEP_IN_SYNC(sinatra/lib/models/variable.rb)
// KEEP_IN_SYNC(plugin-docs/docs/api/api.ts:VariableScope)
enum VariableScope {
  // A special value that means that this variable will be shown
  // in all available scopes (including future ones)
  ALL_SCOPES = 0;

  // Currently only used by number variables, but will eventually
  // be shared by multiple variable types
  TEXT_CONTENT = 1;

  // Used by number variables
  CORNER_RADIUS = 2;
  WIDTH_HEIGHT = 3;
  GAP = 4;

  // Used by color variables
  // A special value that means that this variable will be shown
  // in all available fill scopes (including future ones)
  ALL_FILLS = 5;
  FRAME_FILL = 6;
  SHAPE_FILL = 7;
  TEXT_FILL = 8;
  STROKE = 9; // May by used by number variables in the future
}

enum CodeSyntaxPlatform {
  WEB = 0;
  ANDROID = 1;
  iOS = 2;
  // more options for code syntax platforms may be added in the future
}

message OptionalVector {
  Vector value = 1;
}

enum HTMLTag {
  // Use heuristics to determine the HTML tag.
  AUTO = 0;
  // Sectioning content https://html.spec.whatwg.org/dev/sections.html#sections
  ARTICLE = 1;
  SECTION = 2;
  NAV = 3;
  ASIDE = 4;
  H1 = 5;
  H2 = 6;
  H3 = 7;
  H4 = 8;
  H5 = 9;
  H6 = 10;
  HGROUP = 11;
  HEADER = 12;
  FOOTER = 13;
  ADDRESS = 14;
  // Grouping content https://html.spec.whatwg.org/dev/grouping-content.html
  P = 15;
  HR = 16;
  PRE = 17;
  BLOCKQUOTE = 18;
  OL = 19;
  UL = 20;
  MENU = 21;
  LI = 22;
  DL = 23;
  DT = 24;
  DD = 25;
  FIGURE = 26;
  FIGCAPTION = 27;
  MAIN = 28;
  DIV = 29;
  // Text-level semantics https://html.spec.whatwg.org/dev/text-level-semantics.html
  A = 30;
  EM = 31;
  STRONG = 32;
  SMALL = 33;
  S = 34;
  CITE = 35;
  Q = 36;
  DFN = 37;
  ABBR = 38;
  RUBY = 39;
  RT = 40;
  RP = 41;
  DATA = 42;
  TIME = 43;
  CODE = 44;
  VAR = 45;
  SAMP = 46;
  KBD = 47;
  SUB = 48;
  SUP = 49;
  I = 50;
  B = 51;
  U = 52;
  MARK = 53;
  BDI = 54;
  BDO = 55;
  SPAN = 56;
  BR = 57;
  WBR = 58;
  // Images https://html.spec.whatwg.org/dev/embedded-content.html
  PICTURE = 59;
  SOURCE = 60;
  IMG = 61;
  // Forms and inputs https://html.spec.whatwg.org/dev/forms.html
  FORM = 62;
  LABEL = 63;
  INPUT = 64;
  BUTTON = 65;
  SELECT = 66;
  DATALIST = 67;
  OPTGROUP = 68;
  OPTION = 69;
  TEXTAREA = 70;
  OUTPUT = 71;
  PROGRESS = 72;
  METER = 73;
  FIELDSET = 74;
  LEGEND = 75;
}

enum ARIARole {
  // This enum is quite messy. It has gone through a few iterations and
  // some values got deprecated and then brought back and some other abstracted
  // roles got added and then deprecated

  AUTO = 0; // Use heuristics to determine the role.
  NONE = 52;

  // Landmark roles
  APPLICATION = 30;
  BANNER = 67;
  COMPLEMENTARY = 68;
  CONTENTINFO = 69;
  FORM = 70;
  MAIN = 71;
  NAVIGATION = 72;
  REGION = 73;
  SEARCH = 74;

	// Document roles
  SEPARATOR = 13;
  ARTICLE = 31;
  COLUMNHEADER = 35;
  DEFINITION = 36;
  DIRECTORY = 38;
  DOCUMENT = 39;
  GROUP = 44;
  HEADING = 45;
  IMG = 46;
  LIST = 48;
  LISTITEM = 49;
  MATH = 50;
  NOTE = 53;
  PRESENTATION = 55;
  ROW = 56;
  ROWGROUP = 57;
  ROWHEADER = 58;
  TABLE = 62;
  TOOLBAR = 65;


	// Widget roles
  BUTTON = 1;
  CHECKBOX = 2;
  GRIDCELL = 3;
  LINK = 4;
  MENUITEM = 5;
  MENUITEMCHECKBOX = 6;
  MENUITEMRADIO = 7;
  OPTION = 8;
  PROGRESSBAR = 9;
  RADIO = 10;
  SCROLLBAR = 11;
  SLIDER = 14;
  SPINBUTTON = 15;
  TAB = 17;
  TABPANEL = 18;
  TEXTBOX = 19;
  TREEITEM = 20;
  COMBOBOX = 21;
  GRID = 22;
  LISTBOX = 23;
  MENU = 24;
  MENUBAR = 25;
  RADIOGROUP = 26;
  TABLIST = 27;
  TREE = 28;
  TREEGRID = 29;
  TOOLTIP = 66;
  ALERT = 75;
  LOG = 76;
  MARQUEE = 77;
  STATUS = 78;
  TIMER = 79;
  ALERTDIALOG = 80;
  DIALOG = 81;


  //========================================
	// These values are deprecated. DO NOT USE.
  // They only remain here for backwards compatibility
  SEARCHBOX = 12; // Deprecated
  SWITCH = 16; // Deprecated
  BLOCKQUOTE = 32; // Deprecated
  CAPTION = 33; // Deprecated
  CELL = 34; // Deprecated
  DELETION = 37; // Deprecated
  EMPHASIS = 40; // Deprecated
  FEED = 41; // Deprecated
  FIGURE = 42; // Deprecated
  GENERIC = 43; // Deprecated
  INSERTION = 47; // Deprecated
  METER = 51; // Deprecated
  PARAGRAPH = 54; // Deprecated
  STRONG = 59; // Deprecated
  SUBSCRIPT = 60; // Deprecated
  SUPERSCRIPT = 61; // Deprecated
  TERM = 63; // Deprecated
  TIME = 64; // Deprecated
  IMAGE = 82; // Deprecated
  HEADING_1 = 83; // Deprecated
  HEADING_2 = 84; // Deprecated
  HEADING_3 = 85; // Deprecated
  HEADING_4 = 86; // Deprecated
  HEADING_5 = 87; // Deprecated
  HEADING_6 = 88; // Deprecated
  HEADER = 89; // Deprecated
  FOOTER = 90; // Deprecated
  SIDEBAR = 91; // Deprecated
  SECTION = 92; // Deprecated
  MAINCONTENT = 93; // Deprecated
  TABLE_CELL = 94; // Deprecated
  WIDGET = 95; // Deprecated
}


message MigrationStatus {
  bool dsdCleanup = 1;
}

message NodeFieldMap {
  NodeFieldMapEntry[] entries = 1;
}

message NodeFieldMapEntry {
  GUID guid = 1;
  uint field = 2;
  uint lastModifiedSequenceNumber = 3;
}

enum ColorProfile {
  SRGB = 0;
  DISPLAY_P3 = 1;
}

// This is only meant to be used on the root DOCUMENT node
enum DocumentColorProfile {
  // In Figma Design, all files that were created before color management was released are considered "legacy"
  // In FigmJam, all files are considered "legacy"
  LEGACY = 0;
  SRGB = 1;
  DISPLAY_P3 = 2;
}

enum ChildReadingDirection {
  NONE = 0;
  LEFT_TO_RIGHT = 1;
  RIGHT_TO_LEFT = 2;
}

// This holds the value of an aria attribute. Since we don't support Any we can use
// ARIAAttributeAnyValue with one and only one of the fields populated.
message ARIAAttributeAnyValue {
  bool boolValue = 1;
  string stringValue = 2;
  float floatValue = 3;
  int intValue = 4;
  string[] stringArrayValue = 5;
}
// Each variable can be only one specific type.
// This informs what type this variable holds.
enum ARIAAttributeDataType {
  BOOLEAN = 0;
  STRING = 1;
  FLOAT = 2;
  INT = 3;
  STRING_LIST = 4;
}
message ARIAAttributeData {
  ARIAAttributeDataType type = 1;
  ARIAAttributeAnyValue value = 2;
}

message ARIAAttributesMap {
  ARIAAttributesMapEntry[] entries = 1;
}

message ARIAAttributesMapEntry {
  string attribute = 1; // There are too many aria attributes to enumerate them all here
  ARIAAttributeData value = 2;
}

message HandoffStatusMapEntry {
  GUID guid = 1;
  SectionStatusInfo handoffStatus = 2;
}

message HandoffStatusMap {
  HandoffStatusMapEntry[] entries = 1;
}

// All the edit scope stacks that apply to the fields in a NodeChange.
message EditScopeInfo {
  EditScopeStack[] editScopeStacks = 1;
}

// The stack of edit scopes for a single field change.
message EditScopeStack {
  EditScope[] stack = 1;
}

// The tuple of a given edit scope. A change can exist under one or more of these scopes.
message EditScope {
  EditScopeType type = 1;
  string label = 2;
}

// KEEP_IN_SYNC(fullscreen/lib/scenegraph/FGEditScope.h)
enum EditScopeType {
  INVALID = 0;
  TEST_SETUP = 1;
  USER = 2;
  PLUGIN = 3;
  SYSTEM = 4;
}

///////////////////////////////////////////////////////////////
// Deprecated
// !!! EVERYTHING BELOW THIS SECTION IS DEPRECATED !!!
//
// Because we cannot remove certain type for backwards
// compatibility and checkpointing, we need to keep the definitions
// around. To avoid cluster and to prevent accidental reuse
// we'll move the deprecated types below this section
////////////////////////////////////////////////////////////////
`))}),this.app=this.viewer.app,this.app.window().dangerouslyDisableOnFrameCallbackForTesting(),this.testMode==0)this.resize(600,600),this.readFile(a,0).then(l=>{this.commandQueue=JSON.parse(l.text).commands,this._mockTime=new oa,We.dangerouslyPushMockTime(this._mockTime),this.runNextCommand()});else{this.app.canvasView().dangerouslyAccessProtoRenderManager().internalInitPerfTracking(),this.resizeToFit();let l=30;this.readFile(a,0).then(u=>{let d=JSON.parse(u.text).commands,h=d.tests,S=d.outFile;for(let y=0,v=h.length;y<v;y=y+1){let b=h[y];for(let m=0;m<l;m=m+1)for(let p=0,_=b.length;p<_;p=p+1){let T=b[p];this.commandQueue.push(T)}}let f=new Map([["runCount",l],["deviceMode",i[2]],["flags",Array.from(c.keys()).join(" ")]]);this.writePerformanceResultsWhenFinished(S,f),this.runNextCommand()})}})}constructor(){this.secret=null,this.app=null,this.viewer=null,this.basePath="",this.commandQueue=[],this.container=null,this._mockTime=null,this.testMode=0,this.figFileName="",this.initializePrototypeLib=null,this.bowser=null}},xm=Ri;xm._instance=null;var Dm;(e=>{function g(t){return Mm[t]}e.TestMode_toString=g})(Dm||(Dm={}));var di=!1;var C;(Ce=>{function g(){return Ce._supportsWebGLExtensionOESStandardDerivatives}Ce.supportsWebGLExtensionOESStandardDerivatives=g;function e(ft){Ce._supportsWebGLExtensionOESStandardDerivatives=ft}Ce.setSupportsWebGLExtensionOESStandardDerivatives=e;function t(ft){return ft==v.FLOAT?4:1}Ce.byteCount=t;function n(ft){window.testFakeLostContext=()=>{let A=ft.getExtension("WEBGL_lose_context");A.loseContext();let D=3;setTimeout(()=>{console.log(`waiting ${D} seconds to restore the context...`)},500),setTimeout(()=>{A.restoreContext()},D*1e3)},window.testRealLostContext=()=>{let A=[];for(let D=0;D<32;D=D+1)A.push(Qr.HTMLCanvasElement_getContextWebGL1(Br.HTMLDocument_createElementCanvas(document)))}}Ce.addContextLossTestFunctionsToGlobalScope=n;function r(ft){let A=ft==null?void 0:ft.graphicsCardName();return A!=null&&A.indexOf("SwiftShader")!=-1}Ce.isUsingSoftwareRenderer=r;class o{totalVRAM(){return this._chunks.length*i.BYTE_COUNT}allocate(A,D){if(D.length==0)return null;D.length<=i.BYTE_COUNT;let re=A.stride();for(let ue of this._chunks){let Fe=ue.tryToAllocate(re,D);if(Fe!=null)return Fe}let le=new i(this,this._context.createVertexBuffer(i.BYTE_COUNT));return this._chunks.push(le),le.tryToAllocate(re,D)}constructor(A){this._context=A,this._chunks=[]}}Ce.BufferPool=o;let cn=class{tryToAllocate(A,D){let re=D.length,le=this.areas,ue=null;if(this.bytesUsed+re<=cn.BYTE_COUNT){for(;le.length!=0&&ie.List_last(le).wasFreed();)ie.List_removeLast(le);ue=this.allocateAtEnd(A,D),ue==null&&(this.runCompactingGC(),ue=this.allocateAtEnd(A,D)),ue!=null&&(this.buffer.upload2(D,ue.byteOffset()),this.bytesUsed=this.bytesUsed+re,le.push(ue))}return ue}allocateAtEnd(A,D){let re=this.areas.length==0?0:cn._alignToNextMultiple(ie.List_last(this.areas).byteOffset()+ie.List_last(this.areas).byteCount(),A);return re+D.length<=cn.BYTE_COUNT?new a(this,D.length,A,re,D):null}runCompactingGC(){let A=0;ie.List_removeIf(this.areas,D=>D.wasFreed()?!0:(A=cn._alignToNextMultiple(A,D.stride()),D.byteOffset()!=A&&(this.buffer.move(D.byteOffset(),A,D.byteCount()),D.wasMovedTo(A)),A=A+D.byteCount(),!1)),Ce.DISABLE_BUFFER_ASSERT||this.areas.forEach(D=>{D.assertBytesAreAsExpected()})}static _alignToNextMultiple(A,D){return A+dt.int_remainder(D-dt.int_remainder(A,D),D)}constructor(A,D){this.pool=A,this.buffer=D,this.areas=[],this.bytesUsed=0}},i=cn;i.BYTE_COUNT=4*1024*1024,Ce.BufferChunk=i;class a{constructor(A,D,re,le,ue){this._chunk=null,this._byteCount=0,this._stride=0,this._byteOffset=0,this._wasFreed=!1,this._expectedArray=null,this._chunk=A,this._byteCount=D,this._stride=re,this._byteOffset=le,this._saveBytes(ue)}_saveBytes(A){this._expectedArray=new Uint8Array(A)}assertBytesAreAsExpected(){for(let A=0,D=this._byteCount;A<D;A=A+1)this._expectedArray[A]!=this._chunk.buffer.bytes()[A+this._byteOffset]}byteCount(){return this._byteCount}stride(){return this._stride}byteOffset(){return this._byteOffset}wasFreed(){return this._wasFreed}buffer(){return this._chunk.buffer}free(){let A;this._wasFreed||(this._wasFreed=!0,(A=this._chunk).bytesUsed=A.bytesUsed-this.byteCount())}wasMovedTo(A){this._byteOffset=A}}Ce.BufferArea=a;let s;(w=>(w[w.ZERO=0]="ZERO",w[w.ONE=1]="ONE",w[w.SOURCE_COLOR=2]="SOURCE_COLOR",w[w.TARGET_COLOR=3]="TARGET_COLOR",w[w.INVERSE_SOURCE_COLOR=4]="INVERSE_SOURCE_COLOR",w[w.INVERSE_TARGET_COLOR=5]="INVERSE_TARGET_COLOR",w[w.SOURCE_ALPHA=6]="SOURCE_ALPHA",w[w.TARGET_ALPHA=7]="TARGET_ALPHA",w[w.INVERSE_SOURCE_ALPHA=8]="INVERSE_SOURCE_ALPHA",w[w.INVERSE_TARGET_ALPHA=9]="INVERSE_TARGET_ALPHA",w[w.CONSTANT=10]="CONSTANT",w[w.INVERSE_CONSTANT=11]="INVERSE_CONSTANT"))(s=Ce.BlendOperation||(Ce.BlendOperation={}));let Ie=class{static createInterpolateBlendState(A){return new Ie(10,11,10,11,A)}constructor(A,D,re,le,ue){this.sourceColor=A,this.targetColor=D,this.sourceAlpha=re,this.targetAlpha=le,this.constant=ue}},c=Ie;c.ZERO=new Ie(0,0,0,0,0),c.COPY=new Ie(1,0,1,0,0),c.KEEP=new Ie(0,1,0,1,0),c.PREMULTIPLIED=new Ie(1,8,1,8,0),c.PREMULTIPLIED_SOURCE_UNDER_TARGET=new Ie(9,1,9,1,0),c.UNPREMULTIPLIED=new Ie(6,8,6,8,0),c.SCREEN=new Ie(1,4,1,8,0),Ce.BlendState=c;let l;(re=>(re[re.ALL=0]="ALL",re[re.COLOR=1]="COLOR",re[re.DEPTH_STENCIL=2]="DEPTH_STENCIL"))(l=Ce.Clear||(Ce.Clear={}));let u;(D=>(D[D.TRIANGLES=0]="TRIANGLES",D[D.TRIANGLE_STRIP=1]="TRIANGLE_STRIP"))(u=Ce.Primitive||(Ce.Primitive={}));let d;(Xe=>(Xe[Xe.ALWAYS=0]="ALWAYS",Xe[Xe.EQUAL=1]="EQUAL",Xe[Xe.GREATER_THAN=2]="GREATER_THAN",Xe[Xe.GREATER_THAN_OR_EQUAL=3]="GREATER_THAN_OR_EQUAL",Xe[Xe.LESS_THAN=4]="LESS_THAN",Xe[Xe.LESS_THAN_OR_EQUAL=5]="LESS_THAN_OR_EQUAL",Xe[Xe.NEVER=6]="NEVER",Xe[Xe.NOT_EQUAL=7]="NOT_EQUAL"))(d=Ce.Comparison||(Ce.Comparison={}));let h;(Xe=>(Xe[Xe.DECREMENT_CLAMP=0]="DECREMENT_CLAMP",Xe[Xe.DECREMENT_WRAP=1]="DECREMENT_WRAP",Xe[Xe.INCREMENT_CLAMP=2]="INCREMENT_CLAMP",Xe[Xe.INCREMENT_WRAP=3]="INCREMENT_WRAP",Xe[Xe.INVERT=4]="INVERT",Xe[Xe.KEEP=5]="KEEP",Xe[Xe.REPLACE=6]="REPLACE",Xe[Xe.ZERO=7]="ZERO"))(h=Ce.StencilOperation||(Ce.StencilOperation={}));let gt=class{equals(A){return this==A||this.reference==A.reference&&this.comparison==A.comparison&&this.readMask==A.readMask&&this.writeMask==A.writeMask&&this.stencilFail==A.stencilFail&&this.stencilPassDepthFail==A.stencilPassDepthFail&&this.stencilPassDepthPass==A.stencilPassDepthPass}constructor(A,D,re,le,ue,Fe,Ge){this.reference=A,this.comparison=D,this.readMask=re,this.writeMask=le,this.stencilFail=ue,this.stencilPassDepthFail=Fe,this.stencilPassDepthPass=Ge}},S=gt;S.NONE=new gt(0,6,0,-1,5,5,5),Ce.StencilFaceState=S;let Lt=class{constructor(){if(arguments.length==0)this.isEnabled=!1,this.frontFace=null,this.backFace=null,this.isEnabled=!1,this.frontFace=S.NONE,this.backFace=S.NONE;else if(arguments.length==1){let A=arguments[0];this.isEnabled=!1,this.frontFace=null,this.backFace=null,this.isEnabled=!0,this.frontFace=A,this.backFace=A}else if(arguments.length==2){let A=arguments[0],D=arguments[1];this.isEnabled=!1,this.frontFace=null,this.backFace=null,this.isEnabled=!0,this.frontFace=A,this.backFace=D}}equals(A){return this==A||this.isEnabled==A.isEnabled&&this.frontFace.equals(A.frontFace)&&this.backFace.equals(A.backFace)}},f=Lt;f.NONE=new Lt,Ce.StencilState=f;class y{constructor(A,D){this.canvasSize=A,this.webGLDidAdjustCanvasSize=D}}Ce.ComputedCanvasSize=y;let v;(D=>(D[D.FLOAT=0]="FLOAT",D[D.BYTE=1]="BYTE"))(v=Ce.AttributeType||(Ce.AttributeType={}));class b{constructor(A,D,re,le){this.name=A,this.type=D,this.count=re,this.byteOffset=le}}Ce.Attribute=b;let Ve=class{attributes(){return this._attributes}stride(){return this._stride}add(A,D,re){return this._attributes.push(new b(A,D,re,this._stride)),this._stride=this._stride+re*t(D),this}constructor(){this._attributes=[],this._stride=0}},m=Ve;m.POSITION_F2=new Ve().add(sd,0,2),m.POSITION_F2_COORD_F3=new Ve().add(sd,0,2).add(Hh,0,3),m.POSITION_F4_COORD_F4=new Ve().add(El,0,4).add(Sd,0,4),m.POSITION_F4_COORD_B4=new Ve().add(El,0,4).add(Sd,1,4),m.POSITION_F4=new Ve().add(El,0,4),Ce.VertexFormat=m;let p;(D=>(D[D.RGBA_32=0]="RGBA_32",D[D.DEPTH_24_STENCIL_8=1]="DEPTH_24_STENCIL_8"))(p=Ce.PixelFormat||(Ce.PixelFormat={}));let _;(D=>(D[D.NEAREST=0]="NEAREST",D[D.LINEAR=1]="LINEAR"))(_=Ce.PixelFilter||(Ce.PixelFilter={}));let T;(D=>(D[D.REPEAT=0]="REPEAT",D[D.CLAMP=1]="CLAMP"))(T=Ce.PixelWrap||(Ce.PixelWrap={}));let qe=class{constructor(A,D,re,le){this.pixelFormat=A,this.minFilter=D,this.magFilter=re,this.wrap=le}},N=qe;N.RGBA_LINEAR_CLAMP=new qe(0,1,1,1),N.RGBA_LINEAR_MIN_NEAREST_MAG_CLAMP=new qe(0,1,0,1),N.RGBA_NEAREST_CLAMP=new qe(0,0,0,1),N.RGBA_NEAREST_REPEAT=new qe(0,0,0,0),N.STENCIL=new qe(1,0,0,1),Ce.TextureFormat=N;class k{constructor(A,D){this.texture=null,this.uvSpaceRect=null,this.texture=A,this.uvSpaceRect=D}}Ce.TextureRegion=k;let j;(le=>{function ft(ue){return ue.length==0}le.isEmpty=ft;function A(ue,Fe){return ue[Fe]}le.get=A;function D(ue){return ie.List_last(ue)}le.last=D;function re(ue){return ue.length}le.count=re})(j=Ce.FrozenScissors||(Ce.FrozenScissors={}));class te{constructor(A,D){this._rectPoints=[I.new2(),I.new2(),I.new2(),I.new2()],this._inside=[],this._material=null,this._outside=[],this._vertices=new ar,this._context=null,this._pixelScale=1,this._pool=null,this._previousColor=E.TRANSPARENT,this._previousU=0,this._previousV=0,this._previousX=0,this._previousY=0,this._context=A,this._pool=D,this._material=A.createMaterial("smooth",m.POSITION_F4_COORD_B4,Ip,Ap)}pixelScale(){return this._pixelScale}setTransformAndPixelScale(A,D){3!=0,bn.Material_setUniformMat32(this._material,yn,A),this._pixelScale=D}flush(){let A=this._pool.allocate(m.POSITION_F4_COORD_B4,this._vertices.bytes());A!=null&&(tn.Context_setPremultipliedBlendState(this._context),this._context.draw(1,this._material,A),A.free()),this._vertices.clear()}_loadPoints(A){this._rectPoints[0].setTo(A.left(),A.top()),this._rectPoints[1].setTo(A.right(),A.top()),this._rectPoints[2].setTo(A.right(),A.bottom()),this._rectPoints[3].setTo(A.left(),A.bottom())}fillRect(A,D){this._loadPoints(A),this.fillConvexPolygon(this._rectPoints,D)}strokeRect(A,D,re){this._loadPoints(A),this.strokeNonOverlappingPolyline(this._rectPoints,D,re,te.Loop.CLOSED)}fillConvexPolygon(A,D){let re=this._inside,le=this._outside,ue=A.length;if(!(ue<3)){for(D=E.premultiplied(D);re.length<ue;)re.push(I.new2()),le.push(I.new2());for(let Fe=0,Ge=ue;Fe<Ge;Fe=Fe+1){let Xe=A[dt.int_remainder(Fe+ue-1,ue)],Bt=A[Fe],at=A[dt.int_remainder(Fe+1,ue)],Ye=Xe.y()-Bt.y(),w=Bt.x()-Xe.x(),F=this._length(Ye,w),X=Bt.y()-at.y(),oe=at.x()-Bt.x(),ae=this._length(X,oe),he=Ye/F+X/ae,me=w/F+oe/ae,Oe=.5*this._pixelScale*F/(Ye*he+w*me),pe=he*Oe,ge=me*Oe;le[Fe].setTo(Bt.x()-pe,Bt.y()-ge),re[Fe].setTo(Bt.x()+pe,Bt.y()+ge)}for(let Fe=0,Ge=ue-1;Fe<=Ge;Fe=Fe+1,Ge=Ge-1){let Xe=re[Fe],Bt=re[Ge];this._appendVertex(Xe.x(),Xe.y(),1,1,D),Fe==0&&this._appendPreviousVertex(),Fe<Ge&&this._appendVertex(Bt.x(),Bt.y(),1,1,D)}this._appendPreviousVertex();for(let Fe=0;Fe<=ue;Fe=Fe+1){let Ge=dt.int_remainder(Fe,ue),Xe=re[Ge],Bt=le[Ge];this._appendVertex(Bt.x(),Bt.y(),0,0,D),Fe==0&&this._appendPreviousVertex(),this._appendVertex(Xe.x(),Xe.y(),1,1,D)}this._appendPreviousVertex()}}strokeNonOverlappingPolyline(A,D,re,le){let ue=(re+this._pixelScale)/this._pixelScale,Fe=(re+this._pixelScale)/2,Ge=A.length;if(Ge<2)return;if(D=E.premultiplied(D),le==te.Loop.OPEN){let at=A[0],Ye=A[1],w=Ye.x()-at.x(),F=Ye.y()-at.y(),X=this._length(w,F),oe=.5*this._pixelScale/X,ae=w*oe,he=F*oe,me=Fe/X,Oe=-F*me,pe=w*me;this._appendVertex(at.x()-ae-Oe,at.y()-he-pe,0,-ue,D),this._appendPreviousVertex(),this._appendVertex(at.x()-ae+Oe,at.y()-he+pe,-ue,0,D),this._appendVertex(at.x()+ae-Oe,at.y()+he-pe,0,ue,D),this._appendVertex(at.x()+ae+Oe,at.y()+he+pe,ue,0,D)}let Xe=le==te.Loop.CLOSED?0:1,Bt=le==te.Loop.CLOSED?Ge+1:Ge-1;for(let at=Xe,Ye=Bt;at<Ye;at=at+1){let w=A[dt.int_remainder(at+Ge-1,Ge)],F=A[dt.int_remainder(at,Ge)],X=A[dt.int_remainder(at+1,Ge)],oe=w.y()-F.y(),ae=F.x()-w.x(),he=this._length(oe,ae),me=F.y()-X.y(),Oe=X.x()-F.x(),pe=this._length(me,Oe),ge=oe/he+me/pe,je=ae/he+Oe/pe,De=Fe*he/(oe*ge+ae*je),Be=ge*De,st=je*De;this._appendVertex(F.x()-Be,F.y()-st,0,ue,D),at==0&&this._appendPreviousVertex(),this._appendVertex(F.x()+Be,F.y()+st,ue,0,D)}if(le==te.Loop.OPEN){let at=A[Ge-2],Ye=A[Ge-1],w=Ye.x()-at.x(),F=Ye.y()-at.y(),X=this._length(w,F),oe=.5*this._pixelScale/X,ae=w*oe,he=F*oe,me=Fe/X,Oe=-F*me,pe=w*me;this._appendVertex(Ye.x()-ae-Oe,Ye.y()-he-pe,0,ue,D),this._appendVertex(Ye.x()-ae+Oe,Ye.y()-he+pe,ue,0,D),this._appendVertex(Ye.x()+ae-Oe,Ye.y()+he-pe,0,-ue,D),this._appendVertex(Ye.x()+ae+Oe,Ye.y()+he+pe,-ue,0,D)}this._appendPreviousVertex()}_appendVertex(A,D,re,le,ue){this._previousX=A,this._previousY=D,this._previousU=re,this._previousV=le,this._previousColor=ue,this._vertices.appendFloat(A).appendFloat(D).appendFloat(re).appendFloat(le),this._vertices.appendByte(E.red(ue)).appendByte(E.green(ue)).appendByte(E.blue(ue)).appendByte(E.alpha(ue))}_appendPreviousVertex(){this._appendVertex(this._previousX,this._previousY,this._previousU,this._previousV,this._previousColor)}_length(A,D){return Math.sqrt(A*A+D*D)}}Ce.SmoothPath=te,(D=>{let ft;(ue=>(ue[ue.CLOSED=0]="CLOSED",ue[ue.OPEN=1]="OPEN"))(ft=D.Loop||(D.Loop={}));let A;(le=>{function re(ue){return D.Loop[ue]}le.Loop_toString=re})(A=D.in_Loop||(D.in_Loop={}))})(te=Ce.SmoothPath||(Ce.SmoothPath={}));let Y;(D=>(D[D.WEBGL_TEXTURE=0]="WEBGL_TEXTURE",D[D.WEBGL_BUFFER=1]="WEBGL_BUFFER"))(Y=Ce.MemoryType||(Ce.MemoryType={}));class _e{increment(A,D,re){let le=null;this._vramUsedByTypeAndPurpose.has(A)?le=this._vramUsedByTypeAndPurpose.get(A):(le=new Map,this._vramUsedByTypeAndPurpose.set(A,le)),le.has(D)||le.set(D,0);let ue=le.get(D)+re;le.set(D,ue),Rn.trackInReleaseBuilds(Y[A]+` (${D})`,ue/(1024*1024)|0)}decrement(A,D,re){this.increment(A,D,-re)}resetOnContextRestored(){this._vramUsedByTypeAndPurpose=new Map}constructor(){this._vramUsedByTypeAndPurpose=new Map}}Ce.MemoryStats=_e;let on=class{stats(){return this._stats}width(){return this._cachedSize.x()|0}height(){return this._cachedSize.y()|0}maxTextureSize(){return this._cachedMaxTextureSize}_loadOESStandardDerivativesExtension(A){let D=this._gl.getExtension("OES_standard_derivatives");e(D!==null),A&&!Ce._supportsWebGLExtensionOESStandardDerivatives&&Je.trackEvent1("missing_webgl_extensions",new Map([["extensions",["OES_standard_derivatives"]]]))}constructor(){this._stats=new _e,this._attributeCount=0,this._currentBlendState=c.ZERO,this._currentBlendOperations=0,this._blendOperationMap=null,this._comparisonMap=null,this._contextResetHandlers=[],this._currentClearColor=E.TRANSPARENT,this._currentScissors=null,this._currentStencilState=f.NONE,this._currentTextureSet=null,this._currentProgramInUse=null,this._currentVertexBuffer=null,this._currentVertexFormat=null,this._defaultViewport=B.new2(),this._forceStateUpdate=!0,this._generation=1,this._gl=null,this._oldBlendState=null,this._oldBlendOperations=0,this._oldScissors=null,this._oldStencilState=f.NONE,this._oldTextureSet=null,this._oldViewport=B.new2(),this._operationMap=null,this._cachedGraphicsCardName=null,this._cachedMaxTextureSize=0,this._cachedSize=new I(0,0),this._mockMaximumDrawingBufferSize=null,this._materialsToCheckProgramCreationStatus=[],this._hasLoggedHighpPrecisionUnsupported=!1,this._shouldFlushAfterDraws=!1,this.hackToAvoidMissingTextureWarningInChrome=null;let A={antialias:!1,depth:!1,stencil:!1,alpha:!1,preserveDrawingBuffer:di,powerPreference:"high-performance"};if(this._gl=Qr.HTMLCanvasElement_getContextWebGL2(Br.HTMLDocument_createElementCanvas(document),A),this._gl==null)throw console.error("WebGL initialization failed"),new Error("Could not initialize WebGL");this._loadOESStandardDerivativesExtension(!0);let D=this._gl.canvas,re=D.style;D.width=0,D.height=0,re.display="block",re.left="0",re.top="0",$t.EventTarget_addEventListener2(D,"webglcontextlost",le=>{console.warn("WebGL context was lost"),To.Event_preventDefault(le)}),$t.EventTarget_addEventListener1(D,"webglcontextrestored",()=>{console.warn("WebGL context was restored"),this._attributeCount=0,this._currentClearColor=E.TRANSPARENT,this._currentScissors=null,this._forceStateUpdate=!0,this._loadOESStandardDerivativesExtension(!1),this._generation=this._generation+1,this._stats.resetOnContextRestored();for(let le of this._contextResetHandlers)le()}),n(this._gl),this._blendOperationMap=new Map([[0,this._gl.ZERO],[1,this._gl.ONE],[2,this._gl.SRC_COLOR],[3,this._gl.DST_COLOR],[4,this._gl.ONE_MINUS_SRC_COLOR],[5,this._gl.ONE_MINUS_DST_COLOR],[6,this._gl.SRC_ALPHA],[7,this._gl.DST_ALPHA],[8,this._gl.ONE_MINUS_SRC_ALPHA],[9,this._gl.ONE_MINUS_DST_ALPHA],[10,this._gl.CONSTANT_COLOR],[11,this._gl.ONE_MINUS_CONSTANT_COLOR]]),this._comparisonMap=new Map([[0,this._gl.ALWAYS],[1,this._gl.EQUAL],[2,this._gl.GREATER],[3,this._gl.GEQUAL],[4,this._gl.LESS],[5,this._gl.LEQUAL],[6,this._gl.NEVER],[7,this._gl.NOTEQUAL]]),this._operationMap=new Map([[0,this._gl.DECR],[1,this._gl.DECR_WRAP],[2,this._gl.INCR],[3,this._gl.INCR_WRAP],[4,this._gl.INVERT],[5,this._gl.KEEP],[6,this._gl.REPLACE],[7,this._gl.ZERO]]),this._cachedMaxTextureSize=Math.min(4096,this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE))|0,Zt.setMaxRes(this._cachedMaxTextureSize),this.hackToAvoidMissingTextureWarningInChrome=new L(this,N.RGBA_NEAREST_CLAMP,1,1,new Zt(0,1,1,new Uint8Array(4)),null,"ChromeHack"),this._shouldFlushAfterDraws=this._detectShouldFlushAfterDraws()}gl(){return this._gl}generation(){return this._generation}addContextResetHandler(A){ie.List_appendOne(this._contextResetHandlers,A)}removeContextResetHandler(A){ie.List_removeOne(this._contextResetHandlers,A)}currentTextureSet(){return this._currentTextureSet}currentStencilState(){return this._currentStencilState}currentBlendState(){return this._currentBlendState}beginFrame(){this._checkMaterialProgramCreationStatuses(),this.setTextureSet(null)}endFrame(){}flush(){this._gl.flush()}readPixels(A,D,re,le,ue){var Xe;let Fe,Ge=new Uint8Array(le*ue*4);return this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,(Xe=$.from(A))==null?void 0:Xe.framebuffer()),this._gl.readPixels(D,re,le,ue,this.gl().RGBA,this.gl().UNSIGNED_BYTE,Ge),Ge}setBlendState(A){this._currentBlendState=A,this._currentBlendOperations=on._packBlendModes(A.sourceColor,A.targetColor,A.sourceAlpha,A.targetAlpha)}setViewport(A,D,re,le){this._currentTextureSet!=null?this._currentTextureSet.setViewport(A,D,re,le):this._defaultViewport.setTo1(A,D,re,le)}draw(A,D,re){re!=null&&ls.WebGLRenderingContext_annotateBlock(this._gl,`material:${D.name()}`,()=>{this._updateTextureSetAndViewport(),O.from(D).prepare(),G.from(re.buffer()).prepare(D.format()),this._updateDeferredStates(),this._gl.drawArrays(A==0?this._gl.TRIANGLES:this._gl.TRIANGLE_STRIP,re.byteOffset()/re.stride()|0,re.byteCount()/re.stride()|0),this._forceStateUpdate=!1,this._shouldFlushAfterDraws&&this.flush()})}_setCanvasSize(A,D){this._mockMaximumDrawingBufferSize!=null&&(A=Math.min(this._mockMaximumDrawingBufferSize.value,A)|0,D=Math.min(this._mockMaximumDrawingBufferSize.value,D)|0);let re=A/or(),le=D/or(),ue=this._gl.canvas;ue.width=A,ue.height=D,ue.style.width=`${re}px`,ue.style.height=`${le}px`;let Fe=this._gl.drawingBufferWidth,Ge=this._gl.drawingBufferHeight,Xe=Fe!=A||Ge!=D;return Xe&&(re=Fe/or(),le=Ge/or(),ue.width=Fe,ue.height=Ge,ue.style.width=`${re}px`,ue.style.height=`${le}px`),new y(new I(Fe,Ge),Xe)}resize(A,D){let re=!1;if((this._cachedSize.x()|0)!=A||(this._cachedSize.y()|0)!=D){let le=this._setCanvasSize(A,D);this._cachedSize=le.canvasSize,re=le.webGLDidAdjustCanvasSize,this.setViewport(0,0,this._cachedSize.x()|0,this._cachedSize.y()|0)}return new y(this._cachedSize,re)}_detectShouldFlushAfterDraws(){return!!(["Adreno (TM) 725","Adreno (TM) 730","Adreno (TM) 740"].indexOf(this.graphicsCardName())!=-1||Q.shouldFlushAfterDraws())}_shouldFlushAfterClear(){return!!(bi.hasDrawClearReorderingBug()||["Mesa Intel(R) Graphics (ADL GT2)","Mesa Intel(R) Xe Graphics (TGL GT2)"].indexOf(this.graphicsCardName())!=-1||Q.shouldFlushAfterClear())}clear2(A,D){let re,le;this._updateTextureSetAndViewport(),this._updateDeferredStates(),D!=this._currentClearColor&&(this._gl.clearColor(E.redF(D),E.greenF(D),E.blueF(D),E.alphaF(D)),this._currentClearColor=D),this._gl.clear((A!=2?this._gl.COLOR_BUFFER_BIT:0)|(A!=1?this._gl.DEPTH_BUFFER_BIT|this._gl.STENCIL_BUFFER_BIT:0)),this._shouldFlushAfterClear()&&this._gl.flush(),this._currentTextureSet!=null&&((A==0||A==1)&&(le=this._currentTextureSet.colorTexture())!=null&&le.markContentHasBeenInitialized(),(A==0||A==2)&&(re=this._currentTextureSet.depthStencilTexture())!=null&&re.markContentHasBeenInitialized())}setStencilState(A){this._currentStencilState=A}setTextureSet(A){let D;this._currentTextureSet=$.from(A),(D=this._currentTextureSet)!=null&&D.updateScissor()}setScissor(A){A==null?this._currentScissors=null:(this._currentScissors==null&&(this._currentScissors=B.new2()),this._currentScissors.copyFrom(A))}useProgram(A){(this._forceStateUpdate||this._currentProgramInUse!=A)&&(this._gl.useProgram(A),this._currentProgramInUse=A)}bindVertexBufferWithFormat(A,D){if((this._forceStateUpdate||this._currentVertexBuffer!=A)&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,A),this._currentVertexBuffer=A,this._currentVertexFormat=null),this._currentVertexFormat!=D){let re=this._gl,le=D.attributes(),ue=le.length;for(let Fe=0,Ge=ue;Fe<Ge;Fe=Fe+1){let Xe=le[Fe],Bt=Xe.type==1;re.vertexAttribPointer(Fe,Xe.count,Bt?re.UNSIGNED_BYTE:re.FLOAT,Bt,D.stride(),Xe.byteOffset)}for(;this._attributeCount<ue;)re.enableVertexAttribArray(this._attributeCount),this._attributeCount=this._attributeCount+1;for(;this._attributeCount>ue;)this._attributeCount=this._attributeCount-1,re.disableVertexAttribArray(this._attributeCount);this._attributeCount=ue,this._currentVertexFormat=D}}isContextLost(){return this._gl.isContextLost()}graphicsCardName(){if(this._cachedGraphicsCardName!=null)return this._cachedGraphicsCardName;let A=this._gl.getExtension("WEBGL_debug_renderer_info");return A===null?this._cachedGraphicsCardName="Unknown":this._cachedGraphicsCardName=this._gl.getParameter(A.UNMASKED_RENDERER_WEBGL),this._cachedGraphicsCardName}setMaximumDrawingBufferSizeForTesting(A){this._mockMaximumDrawingBufferSize=new fe(A)}clearMaximumDrawingBufferSizeForTesting(){this._mockMaximumDrawingBufferSize=null}createMaterial(A,D,re,le){return new O(this,A,D,re,le)}createVertexBuffer(A){return new G(this,A)}createTexture2(A,D,re,le,ue){return new L(this,A,D,re,new Zt(0,D,re,le),null,ue)}createTexture3(A,D,re){return new L(this,A,D.videoWidth,D.videoHeight,null,D,re)}createTextureSet(A,D,re){return new $(this,L.from(A),L.from(D),re)}annotate(A,D){D()}annotateAndReturn(A,D){return D()}addMaterialToCheckProgramCreationStatusAsync(A){this._materialsToCheckProgramCreationStatus.push(A)}_checkMaterialProgramCreationStatuses(){if(this._materialsToCheckProgramCreationStatus.length!=0){for(let A of this._materialsToCheckProgramCreationStatus)A.haveCheckedProgramCreationStatus()||A.checkProgramCreationStatus();this._materialsToCheckProgramCreationStatus.length=0}}annotateProfile(A,D){D()}takeSpectorSnapshot(){se.takeSnapshot(this.gl().canvas)}_updateTextureSetAndViewport(){let A=this._currentTextureSet,D=A!=null?A.viewport():this._defaultViewport,re=this._gl;(this._forceStateUpdate||this._oldTextureSet!=A)&&(re.bindFramebuffer(re.FRAMEBUFFER,A==null?void 0:A.framebuffer()),this._oldTextureSet=A,bi.hasViewportBug()&&this._oldViewport.equals(D)&&(this._oldViewport.setX(D.x()+1),re.viewport(this._oldViewport.x()|0,this._oldViewport.y()|0,this._oldViewport.width()|0,this._oldViewport.height()|0),re.clear(0))),(this._forceStateUpdate||!this._oldViewport.equals(D))&&(re.viewport(D.x()|0,D.y()|0,D.width()|0,D.height()|0),this._oldViewport.copyFrom(D))}_updateDeferredStates(){this._updateBlendState(),this._updateStencilState(),this._updateScissorState()}_updateBlendState(){if(this._forceStateUpdate||this._oldBlendOperations!=this._currentBlendOperations||this._oldBlendState.constant!=this._currentBlendState.constant){let A=this._gl,D=this._currentBlendOperations,re=this._oldBlendOperations,le=D&255,ue=D>>8&255,Fe=D>>16&255,Ge=D>>24,Xe=this._currentBlendState.constant;D==on.KEEP_BLEND_OPERATIONS?A.colorMask(!1,!1,!1,!1):((this._forceStateUpdate||re==on.KEEP_BLEND_OPERATIONS)&&A.colorMask(!0,!0,!0,!0),D==on.COPY_BLEND_OPERATIONS?A.disable(A.BLEND):((this._forceStateUpdate||re==on.COPY_BLEND_OPERATIONS||re==on.KEEP_BLEND_OPERATIONS)&&A.enable(A.BLEND),A.blendFuncSeparate(this._blendOperationMap.get(le),this._blendOperationMap.get(ue),this._blendOperationMap.get(Fe),this._blendOperationMap.get(Ge)),A.blendColor(Xe,Xe,Xe,Xe))),this._oldBlendState=this._currentBlendState,this._oldBlendOperations=D}}_updateStencilState(){let A=this._gl,D=this._oldStencilState,re=this._currentStencilState,le=re.frontFace,ue=re.backFace,Fe=le==ue?A.FRONT_AND_BACK:A.FRONT;(this._forceStateUpdate||!D.equals(re))&&((this._forceStateUpdate||D.isEnabled!=re.isEnabled)&&(re.isEnabled?A.enable(A.STENCIL_TEST):A.disable(A.STENCIL_TEST)),A.stencilFuncSeparate(Fe,this._comparisonMap.get(le.comparison),le.reference,le.readMask),A.stencilOpSeparate(Fe,this._operationMap.get(le.stencilFail),this._operationMap.get(le.stencilPassDepthFail),this._operationMap.get(le.stencilPassDepthPass)),A.stencilMaskSeparate(Fe,le.writeMask),le!=ue&&(A.stencilFuncSeparate(A.BACK,this._comparisonMap.get(ue.comparison),ue.reference,ue.readMask),A.stencilOpSeparate(A.BACK,this._operationMap.get(ue.stencilFail),this._operationMap.get(ue.stencilPassDepthFail),this._operationMap.get(ue.stencilPassDepthPass)),A.stencilMaskSeparate(A.BACK,ue.writeMask)),this._oldStencilState=re)}_updateScissorState(){this._currentScissors==null?(this._oldScissors!=null&&this._gl.disable(this._gl.SCISSOR_TEST),this._oldScissors=null):(this._oldScissors==null&&this._gl.enable(this._gl.SCISSOR_TEST),(this._oldScissors==null||!this._currentScissors.equals(this._oldScissors))&&(this._gl.scissor(this._currentScissors.x()|0,this._currentScissors.y()|0,Math.max(this._currentScissors.width(),0)|0,Math.max(this._currentScissors.height(),0)|0),this._oldScissors==null&&(this._oldScissors=B.new2()),this._oldScissors.copyFrom(this._currentScissors)))}hasLoggedHighpPrecisionUnsupported(){return this._hasLoggedHighpPrecisionUnsupported}setHasLoggedHighpPrecisionUnsupported(){this._hasLoggedHighpPrecisionUnsupported=!0}static from(A){return A}static _packBlendModes(A,D,re,le){return A|D<<8|re<<16|le<<24}},ce=on;ce.COPY_BLEND_OPERATIONS=on._packBlendModes(1,0,1,0),ce.KEEP_BLEND_OPERATIONS=on._packBlendModes(0,1,0,1),Ce.HTMLContext=ce;class V{location(){let A=ce.from(this._material.context());if(this._generation!=A.generation()&&(this._location=A.gl().getUniformLocation(this._material.program(),this._name),this._generation=A.generation(),!1)){for(let le=0,ue=re.getProgramParameter(D,re.ACTIVE_UNIFORMS);le<ue;le=le+1)if(Fe.name==this._name)switch(Fe.type){case re.FLOAT:case re.FLOAT_MAT3:case re.FLOAT_VEC2:case re.FLOAT_VEC3:case re.FLOAT_VEC4:case re.INT:case re.BOOL:case re.SAMPLER_2D:default:}}return this._location}constructor(A,D){this._material=A,this._name=D,this._generation=0,this._location=null,this._isDirty=!0}}Ce.HTMLUniform=V;class H extends V{set(A){A!=this._x&&(this._x=A,this._isDirty=!0)}prepare(){let A=ce.from(this._material.context());(this._generation!=A.generation()||this._isDirty)&&(A.gl().uniform1f(this.location(),this._x),this._isDirty=!1)}constructor(A,D){super(A,D);this._x=0}}Ce.HTMLUniformFloat=H;class M extends V{set(A){A!=this._x&&(this._x=A,this._isDirty=!0)}prepare(){let A=ce.from(this._material.context());(this._generation!=A.generation()||this._isDirty)&&(A.gl().uniform1i(this.location(),this._x),this._isDirty=!1)}constructor(A,D){super(A,D);this._x=0}}Ce.HTMLUniformInt=M;class K extends V{set(A,D){(A!=this._x||D!=this._y)&&(this._x=A,this._y=D,this._isDirty=!0)}prepare(){let A=ce.from(this._material.context());(this._generation!=A.generation()||this._isDirty)&&(A.gl().uniform2f(this.location(),this._x,this._y),this._isDirty=!1)}constructor(A,D){super(A,D);this._x=0,this._y=0}}Ce.HTMLUniformVec2=K;class U extends V{set(A,D,re){(A!=this._x||D!=this._y||re!=this._z)&&(this._x=A,this._y=D,this._z=re,this._isDirty=!0)}prepare(){let A=ce.from(this._material.context());(this._generation!=A.generation()||this._isDirty)&&(A.gl().uniform3f(this.location(),this._x,this._y,this._z),this._isDirty=!1)}constructor(A,D){super(A,D);this._x=0,this._y=0,this._z=0}}Ce.HTMLUniformVec3=U;class P extends V{set(A,D,re,le){(A!=this._x||D!=this._y||re!=this._z||le!=this._w)&&(this._x=A,this._y=D,this._z=re,this._w=le,this._isDirty=!0)}prepare(){let A=ce.from(this._material.context());(this._generation!=A.generation()||this._isDirty)&&(A.gl().uniform4f(this.location(),this._x,this._y,this._z,this._w),this._isDirty=!1)}constructor(A,D){super(A,D);this._x=0,this._y=0,this._z=0,this._w=0}}Ce.HTMLUniformVec4=P;let Xt=class extends V{set(A,D,re,le,ue,Fe,Ge,Xe,Bt){Xt._cachedValues[0]=A,Xt._cachedValues[1]=le,Xt._cachedValues[2]=Ge,Xt._cachedValues[3]=D,Xt._cachedValues[4]=ue,Xt._cachedValues[5]=Xe,Xt._cachedValues[6]=re,Xt._cachedValues[7]=Fe,Xt._cachedValues[8]=Bt;for(let at=0;at<9;at=at+1)if(Xt._cachedValues[at]!=this._values[at]){let Ye=this._values;this._values=Xt._cachedValues,Xt._cachedValues=Ye,this._isDirty=!0;break}}prepare(){let A=ce.from(this._material.context());(this._generation!=A.generation()||this._isDirty)&&(A.gl().uniformMatrix3fv(this.location(),!1,this._values),this._isDirty=!1)}constructor(A,D){super(A,D);this._values=[1,0,0,0,1,0,0,0,1]}},J=Xt;J._cachedValues=[1,0,0,0,1,0,0,0,1],Ce.HTMLUniformMat3=J;class z extends V{set(A,D){(this._texture!=A||this._index!=D)&&(this._texture=L.from(A),this._index=D,this._isDirty=!0)}prepare(){let A=ce.from(this._material.context()),D=this._texture,re=A.gl();D==null&&(D=A.hackToAvoidMissingTextureWarningInChrome),(this._generation!=A.generation()||this._isDirty)&&(re.uniform1i(this.location(),this._index),this._isDirty=!1),re.activeTexture(ls.WebGLRenderingContext_TEXTURE_N(re,this._index)),re.bindTexture(re.TEXTURE_2D,D.texture())}constructor(A,D){super(A,D);this._texture=null,this._index=-1}}Ce.HTMLUniformSampler=z;class O{constructor(A,D,re,le,ue){this._context=null,this._name=null,this._format=null,this._vertexSource=null,this._fragmentSource=null,this._uniformsMap=new Map,this._uniformsList=[],this._generation=0,this._program=null,this._haveCheckedProgramCreationStatus=!1,this._context=A,this._name=D,this._format=re,this._vertexSource=le,this._fragmentSource=ue,this._createProgram(),this._context.addMaterialToCheckProgramCreationStatusAsync(this)}context(){return this._context}name(){return this._name}format(){return this._format}setUniformFloat(A,D){let re=Me.StringMap_get(this._uniformsMap,A,null);re==null&&(re=new H(this,A),this._uniformsMap.set(A,re),this._uniformsList.push(re)),re.set(D)}setUniformInt(A,D){let re=Me.StringMap_get(this._uniformsMap,A,null);re==null&&(re=new M(this,A),this._uniformsMap.set(A,re),this._uniformsList.push(re)),re.set(D)}setUniformVec21(A,D,re){let le=Me.StringMap_get(this._uniformsMap,A,null);le==null&&(le=new K(this,A),this._uniformsMap.set(A,le),this._uniformsList.push(le)),le.set(D,re)}setUniformVec3(A,D,re,le){let ue=Me.StringMap_get(this._uniformsMap,A,null);ue==null&&(ue=new U(this,A),this._uniformsMap.set(A,ue),this._uniformsList.push(ue)),ue.set(D,re,le)}setUniformVec41(A,D,re,le,ue){let Fe=Me.StringMap_get(this._uniformsMap,A,null);Fe==null&&(Fe=new P(this,A),this._uniformsMap.set(A,Fe),this._uniformsList.push(Fe)),Fe.set(D,re,le,ue)}setUniformMat31(A,D,re,le,ue,Fe,Ge,Xe,Bt,at){let Ye=Me.StringMap_get(this._uniformsMap,A,null);Ye==null&&(Ye=new J(this,A),this._uniformsMap.set(A,Ye),this._uniformsList.push(Ye)),Ye.set(D,re,le,ue,Fe,Ge,Xe,Bt,at)}setUniformSampler(A,D,re){let le=Me.StringMap_get(this._uniformsMap,A,null);le==null&&(le=new z(this,A),this._uniformsMap.set(A,le),this._uniformsList.push(le)),le.set(D,re)}program(){return this._generation!=this._context.generation()&&(this._createProgram(),this.checkProgramCreationStatus()),this._program}prepare(){this._context.useProgram(this.program());for(let A of this._uniformsList)A.prepare()}haveCheckedProgramCreationStatus(){return this._haveCheckedProgramCreationStatus}checkProgramCreationStatus(){if(this._generation!=this._context.generation())return;let A=this._context.gl();if((()=>{if(A.getProgramParameter(this._program,A.LINK_STATUS))return;let re=Fe=>Fe.replace(new RegExp("\\bhighp\\b","g"),"mediump"),le=A.getAttachedShaders(this._program),ue=!1;for(let Fe of le){if(A.getShaderParameter(Fe,A.COMPILE_STATUS))continue;ue=!0;let Ge=A.getShaderParameter(Fe,A.SHADER_TYPE);if(Ge===A.VERTEX_SHADER)this._vertexSource=re(this._vertexSource);else if(Ge===A.FRAGMENT_SHADER)this._fragmentSource=re(this._fragmentSource);else{if(A.isContextLost())return;throw new Error(`Unexpected shader type: ${Ge}`)}}if(!ue){if(A.isContextLost())return;throw new Error(`Failed to link shader ${this.name()}: ${A.getProgramInfoLog(this._program)}`)}if(this._createProgram(),A.getProgramParameter(this._program,A.LINK_STATUS)){this.context().hasLoggedHighpPrecisionUnsupported()||(Je.trackEvent1("highp_unsupported_device",new Map),this.context().setHasLoggedHighpPrecisionUnsupported());return}le=A.getAttachedShaders(this._program);for(let Fe of le)if(!A.getShaderParameter(Fe,A.COMPILE_STATUS)){if(A.isContextLost())return;{let Ge=A.getShaderInfoLog(Fe);throw new Error(Ge)}}if(!A.isContextLost())throw new Error(`Failed to link shader ${this.name()}: ${A.getProgramInfoLog(this._program)}`)})(),!1){for(let re of this.format().attributes())for(let le=0,ue=A.getProgramParameter(this._program,A.ACTIVE_ATTRIBUTES);le<ue;le=le+1)if(Fe.name==re.name)switch(re.count){case 1:case 2:case 3:case 4:default:}}this._haveCheckedProgramCreationStatus=!0}_createProgram(){let A=this._context.gl();this._program=A.createProgram(),se.addDebugMetadataToWebGLObject(this._program,{name:this._name}),this._compileShader(A,A.VERTEX_SHADER,this._vertexSource),this._compileShader(A,A.FRAGMENT_SHADER,this._fragmentSource);let D=this.format().attributes();for(let re=0,le=D.length;re<le;re=re+1)A.bindAttribLocation(this._program,re,D[re].name);A.linkProgram(this._program),this._generation=this._context.generation(),this._haveCheckedProgramCreationStatus=!1}_compileShader(A,D,re){let le=A.createShader(D);A.shaderSource(le,re),A.compileShader(le),A.attachShader(this._program,le)}static from(A){return A}}Ce.HTMLMaterial=O;let Jr=class{constructor(A,D){this._context=null,this._generation=0,this._buffer=null,this._bytes=null,this._isDirty=!0,this._dirtyMin=Jr.INT_MAX,this._dirtyMax=0,this._totalMin=Jr.INT_MAX,this._totalMax=0,this._byteCount=0,this._glByteCount=0,this._context=A,this._byteCount=D,this._bytes=new Uint8Array(D)}context(){return this._context}bytes(){return this._bytes}byteCount(){return this._byteCount}move(A,D,re){A!=D&&re!=0&&(this._bytes.set(this._bytes.subarray(A,A+re),D),this._growDirtyRegion(Math.min(A,D),Math.max(A,D)+re))}upload2(A,D){this._bytes.set(A,D),this._growDirtyRegion(D,D+A.length)}prepare(A){let D=this._context.gl();if(this._generation!=this._context.generation()&&(this._buffer=D.createBuffer(),se.addDebugMetadataToWebGLObject(this._buffer,{purpose:"Vertex Buffer"}),this._generation=this._context.generation(),this._isDirty=!0),this._context.bindVertexBufferWithFormat(this._buffer,A),this._isDirty){let re=this._glByteCount;D.bufferData(D.ARRAY_BUFFER,this._byteCount,D.DYNAMIC_DRAW),this._glByteCount=this.byteCount(),this._context.stats().increment(1,"all",this._glByteCount-re),this._dirtyMin=this._totalMin,this._dirtyMax=this._totalMax,this._isDirty=!1}this._dirtyMin<this._dirtyMax&&(D.bufferSubData(D.ARRAY_BUFFER,this._dirtyMin,this._bytes.subarray(this._dirtyMin,this._dirtyMax)),this._dirtyMin=Jr.INT_MAX,this._dirtyMax=0)}_growDirtyRegion(A,D){this._dirtyMin=Math.min(this._dirtyMin,A),this._dirtyMax=Math.max(this._dirtyMax,D),this._totalMin=Math.min(this._totalMin,A),this._totalMax=Math.max(this._totalMax,D)}static from(A){return A}},G=Jr;G.INT_MAX=2147483647,Ce.HTMLVertexBuffer=G;class L{context(){return this._context}format(){return this._format}width(){return this._width}height(){return this._height}hasContentBeenInitialized(){return this.isRenderbuffer()?this.renderbuffer():this.texture(),this._hasContentBeenInitialized}markContentHasBeenInitialized(){this._hasContentBeenInitialized=!0}setShouldUnloadImageBuffer(A){this._shouldUnloadImageBuffer=A}_currentGlTextureSizeInBytes(){let A=this._glTextureWidth*this._glTextureHeight*ur.PixelFormat_byteCount(this._format.pixelFormat);return this._useMipmap&&(A+=A*.33),A|0}_delete(){this._texture!=null&&(this._context.gl().deleteTexture(this._texture),this._context.stats().decrement(0,this._purpose,this._currentGlTextureSizeInBytes()))}resize1(A,D,re,le){this._width=A,this._height=D,this._pixels=re,this._useMipmap=le,this._isContentDirty=!0}_needsUploadToGPUTexture(){return this._isContentDirty||this._video!=null}setFormat(A){this._format!=A&&(this._format=A,this._isFormatDirty=!0)}isRenderbuffer(){return this._format.pixelFormat==1}invalidateVideoFrame(){this._isVideoFrameDirty=!0}texture(){let A=this._context.gl();if(this._generation!=this._context.generation()&&(this._texture=A.createTexture(),se.addDebugMetadataToWebGLObject(this._texture,{purpose:this._purpose}),this._generation=this._context.generation(),this._isFormatDirty=!0,this._isContentDirty=!0,this._hasContentBeenInitialized=!1),this._isFormatDirty&&(A.bindTexture(A.TEXTURE_2D,this._texture),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,this.format().magFilter==0?A.NEAREST:A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,this.format().minFilter==0?A.NEAREST:A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,this.format().wrap==0?A.REPEAT:A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,this.format().wrap==0?A.REPEAT:A.CLAMP_TO_EDGE),this._isFormatDirty=!1),this._needsUploadToGPUTexture()){let D=this._currentGlTextureSizeInBytes();if(A.bindTexture(A.TEXTURE_2D,this._texture),this._video!=null)this._isVideoFrameDirty&&(A.texImage2D(A.TEXTURE_2D,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,this._video),this._isVideoFrameDirty=!1,this._hasContentBeenInitialized=!0);else{let le=this._pixels.pixels;le.img!=null?(A.texImage2D(A.TEXTURE_2D,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,le.img),this._hasContentBeenInitialized=!0):le.canvas!=null?(A.texImage2D(A.TEXTURE_2D,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,le.canvas),this._hasContentBeenInitialized=!0):(A.texImage2D(A.TEXTURE_2D,0,A.RGBA,this._width,this._height,0,A.RGBA,A.UNSIGNED_BYTE,le.array),this._hasContentBeenInitialized=le.array!=null),this._shouldUnloadImageBuffer&&(this._pixels=null)}this._glTextureWidth=this._width,this._glTextureHeight=this._height,this._useMipmap&&(A.generateMipmap(A.TEXTURE_2D),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR_MIPMAP_LINEAR));let re=this._currentGlTextureSizeInBytes();this._context.stats().increment(0,this._purpose,re-D),this._isContentDirty=!1}return this._texture}renderbuffer(){let A=this._context.gl();return this._generation!=this._context.generation()&&(this._renderbuffer=A.createRenderbuffer(),se.addDebugMetadataToWebGLObject(this._renderbuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isContentDirty=!0,this._hasContentBeenInitialized=!1),this._isContentDirty&&(A.bindRenderbuffer(A.RENDERBUFFER,this._renderbuffer),A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_STENCIL,this._width,this._height),this._isContentDirty=!1,this._hasContentBeenInitialized=!1),this._renderbuffer}static from(A){return A}constructor(A,D,re,le,ue,Fe,Ge){this._context=A,this._format=D,this._width=re,this._height=le,this._pixels=ue,this._video=Fe,this._purpose=Ge,this._shouldUnloadImageBuffer=!1,this._useMipmap=!1,this._renderbuffer=null,this._texture=null,this._generation=0,this._isFormatDirty=!0,this._isContentDirty=!0,this._isVideoFrameDirty=!0,this._hasContentBeenInitialized=!1,this._glTextureWidth=0,this._glTextureHeight=0}}Ce.HTMLTexture=L;class ${context(){return this._context}colorTexture(){return this._colorTexture}depthStencilTexture(){return this._depthStencilTexture}setColorTexture(A){this._colorTexture!=A&&(this._colorTexture=L.from(A),this._isDirty=!0)}resize(A,D){this._colorTexture!=null&&(A!=this._colorTexture.width()||D!=this._colorTexture.height())&&(this._colorTexture.resize1(A,D,null,!1),this._isDirty=!0),this._depthStencilTexture!=null&&(A!=this._depthStencilTexture.width()||D!=this._depthStencilTexture.height())&&(this._depthStencilTexture.resize1(A,D,null,!1),this._isDirty=!0)}viewport(){return this._viewport}setViewport(A,D,re,le){this._viewport.setTo1(A,D,re,le)}pushScissor1(A,D,re,le){let ue=new B(A,D,re,le);this.pushScissor2(ue)}pushScissor2(A){this._scissorStack.length!=0&&A.intersectWith(ie.List_last(this._scissorStack)),this._scissorStack.push(A),this.updateScissor()}popScissor(){ie.List_removeLast(this._scissorStack),this.updateScissor()}takeScissor(){let A=this._scissorStack.pop();return this.updateScissor(),A}takeAllScissors(){let A=this._scissorStack;return this._scissorStack=[],this.updateScissor(),A}replaceAllScissors(A){this._scissorStack=A,this.updateScissor()}scissors(){return this._scissorStack}clearScissors(){this._scissorStack.length=0}updateScissor(){this._context.setScissor(this._scissorStack.length==0?null:ie.List_last(this._scissorStack))}setDepthStencil(A){this._depthStencilTexture!=A&&(this._depthStencilTexture=L.from(A),this._isDirty=!0)}framebuffer(){let A=this._context.gl();return this._generation!=this._context.generation()&&(this._framebuffer=A.createFramebuffer(),se.addDebugMetadataToWebGLObject(this._framebuffer,{purpose:this._purpose}),this._generation=this._context.generation(),this._isDirty=!0),this._isDirty&&(A.bindFramebuffer(A.FRAMEBUFFER,this._framebuffer),A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,this._colorTexture.texture(),0),this._depthStencilTexture!=null&&A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_STENCIL_ATTACHMENT,A.RENDERBUFFER,this._depthStencilTexture.renderbuffer()),this._isDirty=!1),this._framebuffer}_delete(){let A,D;(D=this._colorTexture)!=null&&D._delete(),(A=this._depthStencilTexture)!=null&&A._delete(),this._context.gl().deleteFramebuffer(this._framebuffer)}static from(A){return A}constructor(A,D,re,le){this._context=A,this._colorTexture=D,this._depthStencilTexture=re,this._purpose=le,this._scissorStack=[],this._framebuffer=null,this._generation=0,this._isDirty=!0,this._viewport=B.new2()}}Ce.HTMLTextureSet=$;let se;(Xe=>{function ft(Bt){if(!window.spector){console.error("Can't take a Spector.js snapshot because Spector isn't loaded. Go here to install the Chrome extension: https://chrome.google.com/webstore/detail/spectorjs/denbgaamihkadbghdceggmchnflmhpmk?hl=en");return}window.spector.captureNextFrame(Bt)}Xe.takeSnapshot=ft;function A(Bt,at){}Xe.addDebugMetadataToWebGLObject=A;function D(Bt,at){at()}Xe.annotate=D;function re(Bt,at){return at()}Xe.annotateAndReturn=re;function le(Bt){Xe._scopeStack.push(Bt),Fe()}Xe._beginScope=le;function ue(Bt){Xe._scopeStack.pop(),Fe()}Xe._endScope=ue;function Fe(){if(Xe._scopeStack.length==0)window.spector.clearMarker();else{let Bt=Xe._scopeStack.join(" > ");window.spector.setMarker(Bt)}}Xe._updateMarker=Fe,Xe._scopeStack=[]})(se=Ce.Spector||(Ce.Spector={}));let nt;(A=>{function ft(D){return s[D]}A.BlendOperation_toString=ft})(nt=Ce.in_BlendOperation||(Ce.in_BlendOperation={}));let ot;(A=>{function ft(D){return l[D]}A.Clear_toString=ft})(ot=Ce.in_Clear||(Ce.in_Clear={}));let It;(A=>{function ft(D){return u[D]}A.Primitive_toString=ft})(It=Ce.in_Primitive||(Ce.in_Primitive={}));let Qe;(A=>{function ft(D){return d[D]}A.Comparison_toString=ft})(Qe=Ce.in_Comparison||(Ce.in_Comparison={}));let Gt;(A=>{function ft(D){return h[D]}A.StencilOperation_toString=ft})(Gt=Ce.in_StencilOperation||(Ce.in_StencilOperation={}));let tn;(Bt=>{function ft(at,Ye){at.clear2(Ye,E.TRANSPARENT)}Bt.Context_clear1=ft;function A(at,Ye,w,F,X){return at.createTexture2(Ye,w,F,null,X)}Bt.Context_createTexture1=A;function D(at){at.setBlendState(c.COPY)}Bt.Context_setCopyBlendState=D;function re(at){at.setBlendState(c.KEEP)}Bt.Context_setKeepBlendState=re;function le(at,Ye){at.setBlendState(c.createInterpolateBlendState(Ye))}Bt.Context_setInterpolateBlendState=le;function ue(at){at.setBlendState(c.PREMULTIPLIED)}Bt.Context_setPremultipliedBlendState=ue;function Fe(at){at.setBlendState(c.PREMULTIPLIED_SOURCE_UNDER_TARGET)}Bt.Context_setPremultipliedSourceUnderTargetState=Fe;function Ge(at){at.setBlendState(c.UNPREMULTIPLIED)}Bt.Context_setUnpremultipliedBlendState=Ge;function Xe(at){at.setBlendState(c.SCREEN)}Bt.Context_setScreenBlendState=Xe})(tn=Ce.in_Context||(Ce.in_Context={}));let bn;(le=>{function ft(ue,Fe,Ge){ue.setUniformVec21(Fe,Ge.x(),Ge.y())}le.Material_setUniformVec22=ft;function A(ue,Fe,Ge){ue.setUniformVec41(Fe,E.redF(Ge),E.greenF(Ge),E.blueF(Ge),E.alphaF(Ge))}le.Material_setUniformVec42=A;function D(ue,Fe,Ge){ue.setUniformVec41(Fe,Ge.x(),Ge.y(),Ge.x()+Ge.width(),Ge.y()+Ge.height())}le.Material_setUniformVec43=D;function re(ue,Fe,Ge){ue.setUniformMat31(Fe,Ge.m00(),Ge.m01(),Ge.m02(),Ge.m10(),Ge.m11(),Ge.m12(),0,0,1)}le.Material_setUniformMat32=re})(bn=Ce.in_Material||(Ce.in_Material={}));let tr;(A=>{function ft(D){return v[D]}A.AttributeType_toString=ft})(tr=Ce.in_AttributeType||(Ce.in_AttributeType={}));let Fn;(A=>{function ft(D,re){D.upload2(re,0)}A.VertexBuffer_upload1=ft})(Fn=Ce.in_VertexBuffer||(Ce.in_VertexBuffer={}));let ur;(D=>{function ft(re){return 4}D.PixelFormat_byteCount=ft;function A(re){return p[re]}D.PixelFormat_toString=A})(ur=Ce.in_PixelFormat||(Ce.in_PixelFormat={}));let Wt;(A=>{function ft(D){return _[D]}A.PixelFilter_toString=ft})(Wt=Ce.in_PixelFilter||(Ce.in_PixelFilter={}));let ut;(A=>{function ft(D){return T[D]}A.PixelWrap_toString=ft})(ut=Ce.in_PixelWrap||(Ce.in_PixelWrap={}));let Tt;(re=>{function ft(le,ue,Fe){le.resize1(ue,Fe,null,!1)}re.Texture_resize2=ft;function A(le,ue,Fe,Ge){le.resize1(ue,Fe,Ge,!1)}re.Texture_resize3=A;function D(le){return le.width()*le.height()*ur.PixelFormat_byteCount(le.format().pixelFormat)}re.Texture_totalVRAM=D})(Tt=Ce.in_Texture||(Ce.in_Texture={}));let Le;(A=>{function ft(D){return Y[D]}A.MemoryType_toString=ft})(Le=Ce.in_MemoryType||(Ce.in_MemoryType={})),Ce.DISABLE_BUFFER_ASSERT=!0,Ce._supportsWebGLExtensionOESStandardDerivatives=!0})(C||(C={}));var lc=class{texture(e){return this._texture==null&&(this._texture=e.createTexture2(C.TextureFormat.RGBA_LINEAR_CLAMP,lc.WIDTH,lc.HEIGHT,this.pixels,"GradientData")),this._texture}totalVRAM(){return this._texture!=null?C.in_Texture.Texture_totalVRAM(this._texture):0}constructor(e){this.pixels=e,this._texture=null}},wi=lc;wi.WIDTH=1024,wi.HEIGHT=2;var Ea=class{constructor(){this._table=null;let e=new Pr;this._table=new _i(t=>Ea._hashGradient(e,t),(t,n)=>t.equals2(n),t=>Ea._evaluateGradient(t))}allocate(e){return this._table.getOrInsertFallback(e)}totalVRAM(){let e=0;return this._table.each((t,n)=>{e=e+n.totalVRAM()}),e}static _hashGradient(e,t){let n=t.colorStops(),r=n.length;e.hash2(la.shouldWrap(t.type())?1:0),e.hash2(r);for(let o=0,i=r;o<i;o=o+1){let a=n[o];e.hash2(a.color),e.hash1(a.position)}return e.value()}static _evaluateGradient(e){let t=new Uint8Array(wi.WIDTH*wi.HEIGHT*4),n=e.flattenedStops(),r=n.length;if(r!=0){let o=1,i=n[0],a=i,s=0;for(let c=0;c<wi.WIDTH;c=c+1){let l=c/(wi.WIDTH-1);for(;i.position<l&&o<r;)a=i,i=n[o],o=o+1;let u=a.position,d=i.position,h=l<u?0:l>d?1:u<d?(l-u)/(d-u):0,S=a.color,f=i.color,y=((S>>>24)+((f>>>24)-(S>>>24))*h)/255;for(let v=0;v<4;v=v+1){let b=S&255,m=f&255,p=b+(m-b)*h,_=.5+257*(v<3?p*y:p)|0;t[s]=_>>8,t[s+wi.WIDTH*4]=_,S>>=8,f>>=8,s=s+1}}}return new wi(t)}};var Ot=class{static SUPERSAMPLE_COUNT(){return Q.useSSAA()?(tt.OS_isMobile(tt.OS_current())||tt.OS_current()==4&&navigator.maxTouchPoints>0||At.forceMobileOptimizations())&&Q.getFeatureFlags().ssaa3x3MobileProto?3:4:2}static SSAA_SIZE(){return pn.TILE_SIZE*Ot.SUPERSAMPLE_COUNT()}constructor(e,t,n){this._delegate=null,this._context=null,this._bufferPool=null,this._quadArea=null,this._solidColorMaterial=null,this._gradientPaintMaterial=null,this._lerpGradientPaintMaterial=null,this._stencilMaterial=null,this._imageMaterial=null,this._lerpImageMaterial=null,this._imageColorAdjustMaterial=null,this._lerpImageColorAdjustMaterial=null,this._aaaShapeSolidColorMaterial=null,this._aaaShapeGradientPaintMaterial=null,this._aaaShapeLerpGradientPaintMaterial=null,this._aaaShapeImageMaterial=null,this._aaaShapeLerpImageMaterial=null,this._aaaShapeImageColorAdjustMaterial=null,this._aaaShapeLerpImageColorAdjustMaterial=null,this._gradientDataCache=new Map,this._gradientPool=new Ea,this._batchAntialiasing=null,this._currentBatchScissorBuilder=new bt,this._shouldFlushAfterStencilCover=!1,this._shouldFlushAfterRenderGeometryDirectly=!1,this._delegate=e,this._context=t,this._bufferPool=n,this._solidColorMaterial=this._context.createMaterial("solidColor",C.VertexFormat.POSITION_F2_COORD_F3,nh,Al),this._gradientPaintMaterial=this._context.createMaterial("gradientPaint",C.VertexFormat.POSITION_F2_COORD_F3,ws,rh),this._lerpGradientPaintMaterial=this._context.createMaterial("lerpGradientPaint",C.VertexFormat.POSITION_F2_COORD_F3,ws,oh),this._stencilMaterial=this._context.createMaterial("stencil",C.VertexFormat.POSITION_F2_COORD_F3,Vp,Bp),this._imageMaterial=this._context.createMaterial("image",C.VertexFormat.POSITION_F2_COORD_F3,ws,ih),this._lerpImageMaterial=this._context.createMaterial("lerpImage",C.VertexFormat.POSITION_F2_COORD_F3,id,ah),this._imageColorAdjustMaterial=this._context.createMaterial("imageColorAdjust",C.VertexFormat.POSITION_F2_COORD_F3,ws,sh),this._lerpImageColorAdjustMaterial=this._context.createMaterial("lerpImageColorAdjust",C.VertexFormat.POSITION_F2_COORD_F3,id,lh),C.supportsWebGLExtensionOESStandardDerivatives()&&(this._aaaShapeSolidColorMaterial=this._context.createMaterial("aaaShapeSolidColor",C.VertexFormat.POSITION_F2_COORD_F3,dh,uh),this._aaaShapeGradientPaintMaterial=this._context.createMaterial("aaaShapeGradientPaint",C.VertexFormat.POSITION_F2_COORD_F3,Ps,ph),this._aaaShapeLerpGradientPaintMaterial=this._context.createMaterial("aaaShapeLerpGradientPaint",C.VertexFormat.POSITION_F2_COORD_F3,Ps,hh),this._aaaShapeImageMaterial=this._context.createMaterial("aaaShapeImage",C.VertexFormat.POSITION_F2_COORD_F3,Ps,mh),this._aaaShapeLerpImageMaterial=this._context.createMaterial("aaaShapeLerpImage",C.VertexFormat.POSITION_F2_COORD_F3,ad,gh),this._aaaShapeImageColorAdjustMaterial=this._context.createMaterial("aaaShapeImageColorAdjust",C.VertexFormat.POSITION_F2_COORD_F3,Ps,_h),this._aaaShapeLerpImageColorAdjustMaterial=this._context.createMaterial("aaaShapeLerpImageColorAdjust",C.VertexFormat.POSITION_F2_COORD_F3,ad,fh)),this._quadArea=this._bufferPool.allocate(C.VertexFormat.POSITION_F2_COORD_F3,new Uint8Array(new Float32Array([0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0]).buffer)),this._shouldFlushAfterStencilCover=this._checkShouldFlushAfterStencilCover(),this._shouldFlushAfterRenderGeometryDirectly=this._checkShouldFlushAfterRenderGeometryDirectly()}totalVRAM(){return this._gradientPool.totalVRAM()}clearGradientCache(){this._gradientDataCache=new Map,this._gradientPool=new Ea}canSkipStencil(e,t,n){return t.hasNoCurves?!!(t.hasNoOverlaps||e=="NONZERO"&&t.hasNoCurvesAndSameOrientation&&!Re.containsAtLeastOneNonOpaquePaint(n)):!1}currentBatchAA(){return this._batchAntialiasing}currentBatchScissor(){return this._currentBatchScissorBuilder.build()}includeBoundsInBatchScissor(e){this._currentBatchScissorBuilder.include3(e)}beginBatch(e){this._batchAntialiasing=new fe(e),this._batchAntialiasing.value==ba.SSAA&&this._delegate.pushSSAARenderState(null)}finishBatch(){if(this._delegate.supersampleState().level==1&&this._delegate.supersampleState().mode==0&&this._batchAntialiasing.value==ba.SSAA){let e=this.currentBatchScissor();this._delegate.currentTile().pushScissor2(e)}this._currentBatchScissorBuilder.reset(),this._batchAntialiasing.value==ba.SSAA&&this._delegate.popSSAARenderState(),this._batchAntialiasing=null}renderStencilQuad(e,t,n){let r=this._solidColorMaterial,o=ee.new3(e).translatedBy1(t.topLeft()).scaledBy1(t.size());C.in_Material.Material_setUniformMat32(r,yn,o),this._context.setStencilState(n),C.in_Context.Context_setKeepBlendState(this._context),this._delegate.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,r,this._quadArea),this._delegate.markDidDraw()}renderFill(e,t){if(t.geometry.paints.length==0)return;let n=t.geometry.type==li.PaintedGeometryType.DYNAMIC?t.geometry.path().bounds().size():t.paintSize,r=ee.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(t.transform),o=this._delegate.currentTile(),i=o.tileSize(),a=ee.new2().scaledBy2(i).multipliedBy1(e).multipliedBy1(t.transform),s=C.FrozenScissors.isEmpty(o.scissors())?new B(0,0,i,i):C.FrozenScissors.last(o.scissors()),c=B.new3(t.geometry.path().bounds());if(a.transformRect(c),c.intersectWith(s),this.includeBoundsInBatchScissor(c),t.geometry.canBeAnalyticallyAntialiased()){C.in_Context.Context_setPremultipliedBlendState(this._context),this.renderAAAShape(r,t.geometry,n);return}let l=t.geometry.path().windingRule(),u=t.geometry.path().triangles(this._bufferPool,C.VertexFormat.POSITION_F2_COORD_F3),d=!0;for(let h=0,S=u.length;h<S;h=h+1)if(!this.canSkipStencil(l,u[h],t.geometry.paints)){d=!1;break}d?(C.in_Context.Context_setPremultipliedBlendState(this._context),this.renderGeometryDirectly(r,t.geometry,n)):(this.renderStencilGeometry(r,t.geometry,Ot.computeStates.get(l)),C.in_Context.Context_setPremultipliedBlendState(this._context),this.renderCoverQuad(r,t.geometry,n,Ot.useStates.get(l),Ot.clearStates.get(l)),this._context.setStencilState(C.StencilState.NONE))}renderFillStroke(e,t){let n=this._delegate.currentTile(),r=n.tileSize(),o=ee.new2().scaledBy2(r).multipliedBy1(e).multipliedBy1(t.transform),i=C.FrozenScissors.isEmpty(n.scissors())?new B(0,0,r,r):C.FrozenScissors.last(n.scissors()),a=ee.new2().translatedBy2(-1,-1).scaledBy2(2).multipliedBy1(e).multipliedBy1(t.transform);for(let s=0,c=t.fillGeometries.length;s<c;s=s+1){let l=t.fillGeometries[s],u=B.new3(l.path().bounds());o.transformRect(u),this.includeBoundsInBatchScissor(u.intersectedWith(i));let d=l.path().windingRule();this.renderStencilGeometry(a,l,Ot.computeStates.get(d)),C.in_Context.Context_setPremultipliedBlendState(this._context),this.renderCoverQuad(a,l,t.paintSize,Ot.useStates.get(d),Ot.setFillStates.get(d))}for(let s=0,c=t.strokeGeometries.length;s<c;s=s+1){let l=t.strokeGeometries[s],u=B.new3(l.path().bounds());o.transformRect(u),this.includeBoundsInBatchScissor(u.intersectedWith(i));let d=l.path().windingRule();this.renderStencilGeometry(a,l,Ot.computeStates.get(d)),this.renderStencilQuad(a,l.path().bounds(),Ot.setStrokeStates.get(d)),C.in_Context.Context_setPremultipliedBlendState(this._context),this.renderCoverQuad(a,l,t.paintSize,Ot.compoundUseStates.get(t.mode),Ot.compoundClearStates.get(t.mode))}if(t.strokeGeometries.length!=0){let s=ie.List_last(t.strokeGeometries).path().bounds(),c=ie.List_last(t.fillGeometries).path().bounds();s.contains1(c)||this.renderStencilQuad(a,c,Ot.compoundClearStates.get(t.mode))}this._context.setStencilState(C.StencilState.NONE)}uvTransformFromBounds(e,t){let n=ee.new2();return n.scale4(1/t.x(),1/t.y()),n.translate1(e.topLeft()),n.scale3(e.size()),n}canSkipPaint(e,t,n,r){let o=n.asSinglePaint();if(o==null)return!1;if((o.type()=="GRADIENT_RADIAL"||o.type()=="GRADIENT_DIAMOND")&&o.lastStopIsTransparent()){let i=ee.new3(o.transform());if(i.multiply(t),i.invert()){let a=ie.List_last(o.colorStops()).position*.5,s=new I(.5,.5),c=B.new4(s.subtract(a),s.add(a));return ee.new3(e).translatedBy1(r.topLeft()).scaledBy1(r.size()).multipliedBy1(i).transformRect(c),!B.CLIP.overlaps(c)}}return!1}_findOrCreateGradientData(e){let t=Ht.IntMap_get(this._gradientDataCache,e.id(),null);return t==null&&(t=this._gradientPool.allocate(e),this._gradientDataCache.set(e.id(),t)),t}_setAaaShapeUniforms(e,t,n){if(e.setUniformVec21(wh,n.x(),n.y()),C.in_Material.Material_setUniformVec22(e,Nh,t.bounds().size()),t instanceof Ko){let r=t;e.setUniformInt(ld,cc.ELLIPSE),C.in_Material.Material_setUniformVec22(e,Ih,r.center.subtract1(r.bounds().topLeft())),e.setUniformVec21(Ah,r.xRadius,r.yRadius)}else if(t instanceof Dt){let r=t;e.setUniformInt(ld,cc.ROUNDED_RECT),C.in_Material.Material_setUniformVec43(e,Eh,t.bounds().translatedBy(t.bounds().topLeft())),e.setUniformVec41(Ch,Math.max(r.radii().topLeft,0),Math.max(r.radii().topRight,0),Math.max(r.radii().bottomRight,0),Math.max(r.radii().bottomLeft,0))}else throw new Error("Unxpected path type")}renderAAAShape(e,t,n){let r=t.paints,o=t.path().bounds(),i=e.clone(),a=i.invert(),s=2/pn.TILE_SIZE,c=i.scale1().x()*s,l=o.clone().expandedBy1(c),u=ee.new3(e).translatedBy1(l.topLeft()).scaledBy1(l.size()),d=this.uvTransformFromBounds(o,n),h=new I(l.width()/o.width(),l.height()/o.height()),S=t.path().path();for(let f=0,y=r.length;f<y;f=f+1){let v=r[f];if(!this.canSkipPaint(e,d,v,o))if(v.type()=="SOLID"){let b=this._aaaShapeSolidColorMaterial;this._setAaaShapeUniforms(b,S,h),C.in_Material.Material_setUniformMat32(b,yn,u),C.in_Material.Material_setUniformVec42(b,No,E.premultiplied(v.color())),b.setUniformFloat(wn,v.opacity()),this._delegate.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,b,this._quadArea),this._delegate.markDidDraw()}else if(la.isGradient(v.type())){let b=ee.new3(v.transform()).multipliedBy1(d),m=null,p=v.asVolatilePaint();if(p!=null){m=this._aaaShapeLerpGradientPaintMaterial;let _=this._findOrCreateGradientData(p.from()).texture(this._context),T=this._findOrCreateGradientData(p.to()).texture(this._context);_.setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),T.setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),m.setUniformSampler(Yt,_,0),m.setUniformSampler(mr,T,1),m.setUniformFloat(sa,p.t())}else{let _=v.asSinglePaint();m=this._aaaShapeGradientPaintMaterial;let T=this._findOrCreateGradientData(_).texture(this._context);T.setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),m.setUniformSampler(Yt,T,0)}this._setAaaShapeUniforms(m,S,h),C.in_Material.Material_setUniformMat32(m,yn,u),C.in_Material.Material_setUniformMat32(m,zo,b),m.setUniformInt(qa,Xl.get(v.type())),m.setUniformFloat(wn,v.opacity()),this._delegate.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,m,this._quadArea),this._delegate.markDidDraw()}else if(v.type()=="IMAGE"||v.type()=="VIDEO"){let b=ee.new3(d).scaledBy3(1/o.size().x(),1/o.size().y()),m=!0,p=v.asVolatilePaint();if(p!=null){let _=this.getImageToDraw(p.from(),n,e,b,p.from().imageScaleMode());if(_!=null){let T=ee.new2(),N=null;if(p.from().image()==p.to().image()&&!(p.from().imageScaleMode()=="TILE"||p.to().imageScaleMode()=="TILE"))N=this._aaaShapeImageMaterial,p.colorAdjustIsActive()&&(N=this._aaaShapeImageColorAdjustMaterial,p.colorAdjustSetData(N)),T=this.allocateObjectSpaceToNormalizedImageSpaceTransform(p,n,d);else{N=this._aaaShapeLerpImageMaterial,p.colorAdjustIsActive()&&(N=this._aaaShapeLerpImageColorAdjustMaterial,p.colorAdjustSetData(N)),T=this.allocateObjectSpaceToNormalizedImageSpaceTransform(p.from(),n,d);let j=this.getImageToDraw(p.to(),n,e,b,p.to().imageScaleMode());if(j==null)m=!1;else{let te=this.getOrCreateVideoTexture(p.to());te==null&&(te=this._delegate.getOrCreateImageTexture(j));let Y=this.allocateObjectSpaceToNormalizedImageSpaceTransform(p.to(),n,d);C.in_Material.Material_setUniformMat32(N,Ol,Y),te!=null&&te.setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),N.setUniformSampler(mr,te,1),N.setUniformFloat(sa,en.double_clamp(p.t(),0,1))}}N.setUniformFloat(fd,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale());let k=this.getOrCreateVideoTexture(p.from());k==null&&(k=this._delegate.getOrCreateImageTexture(_)),m&&k!=null&&(k!=null&&k.setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(v,N),C.in_Material.Material_setUniformMat32(N,yn,u),C.in_Material.Material_setUniformMat32(N,zo,T),N.setUniformFloat(wn,p.opacity()),N.setUniformSampler(Yt,k,0),this._setAaaShapeUniforms(N,S,h),this._delegate.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,N,this._quadArea),this._delegate.markDidDraw())}}else{let _=v.asSinglePaint(),T=null;if(T=this.getOrCreateVideoTexture(_),T==null){let N=this.getImageToDraw(_,n,e,b,_.imageScaleMode());N!=null&&(T=this._delegate.getOrCreateImageTexture(N))}if(T!=null){let N=this._aaaShapeImageMaterial;_.colorAdjustIsActive()&&(N=this._aaaShapeImageColorAdjustMaterial,_.colorAdjustSetData(N));let k=this.allocateObjectSpaceToNormalizedImageSpaceTransform(_,n,d);T.setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(v,N),C.in_Material.Material_setUniformMat32(N,yn,u),C.in_Material.Material_setUniformMat32(N,zo,k),N.setUniformFloat(wn,_.opacity()),N.setUniformSampler(Yt,T,0),N.setUniformFloat(fd,window.devicePixelRatio*this._delegate.canvasSpaceToViewSpaceScale()),this._setAaaShapeUniforms(N,S,h),this._delegate.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,N,this._quadArea),this._delegate.markDidDraw()}}}else v.type()=="EMOJI"&&ze("Emoji should always be rendered by renderGeometryDirectly")}}renderGeometryDirectly(e,t,n){let r=t.path().triangles(this._bufferPool,C.VertexFormat.POSITION_F2_COORD_F3),o=t.paints,i=t.path().bounds(),a=this.uvTransformFromBounds(i,n),s=null;for(let c=0,l=o.length;c<l;c=c+1){let u=o[c];if(!this.canSkipPaint(e,a,u,i))switch(u.type()){case"SOLID":{s=this._solidColorMaterial,C.in_Material.Material_setUniformMat32(s,yn,e),C.in_Material.Material_setUniformVec42(s,No,E.premultiplied(u.color())),s.setUniformFloat(wn,u.opacity());for(let d=0,h=r.length;d<h;d=d+1)r[d].bufferArea!=null&&(this._delegate.drawToCurrentTile(C.Primitive.TRIANGLES,s,r[d].bufferArea),this._delegate.markDidDraw());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let d=ee.new3(u.transform()).scaledBy3(1/n.x(),1/n.y()),h=u.asVolatilePaint();if(h!=null){s=this._lerpGradientPaintMaterial;let S=this._findOrCreateGradientData(h.from()).texture(this._context),f=this._findOrCreateGradientData(h.to()).texture(this._context);S.setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),f.setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),s.setUniformSampler(Yt,S,0),s.setUniformSampler(mr,f,1),s.setUniformFloat(sa,h.t())}else{let S=u.asSinglePaint();s=this._gradientPaintMaterial;let f=this._findOrCreateGradientData(S).texture(this._context);f.setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),s.setUniformSampler(Yt,f,0)}C.in_Material.Material_setUniformMat32(s,yn,e),C.in_Material.Material_setUniformMat32(s,zo,d),s.setUniformInt(qa,Xl.get(u.type())),s.setUniformFloat(wn,u.opacity());for(let S=0,f=r.length;S<f;S=S+1)r[S].bufferArea!=null&&(this._delegate.drawToCurrentTile(C.Primitive.TRIANGLES,s,r[S].bufferArea),this._delegate.markDidDraw());break}case"IMAGE":case"VIDEO":{let d=ee.new2().scaledBy3(1/n.x(),1/n.y()),h=u.asVolatilePaint();if(h!=null){let S=this.getImageToDraw(h.from(),n,e,d,h.from().imageScaleMode());if(S!=null){let f=ee.new2(),y=!0;if(h.from().image()==h.to().image()&&!(h.from().imageScaleMode()=="TILE"||h.to().imageScaleMode()=="TILE"))s=this._imageMaterial,h.colorAdjustIsActive()&&(s=this._imageColorAdjustMaterial,h.colorAdjustSetData(s)),f=this.allocateObjectSpaceToNormalizedImageSpaceTransform(h,n,d);else{let b=this.getImageToDraw(h.to(),n,e,d,h.to().imageScaleMode());if(b==null)y=!1;else{s=this._lerpImageMaterial,h.colorAdjustIsActive()&&(s=this._lerpImageColorAdjustMaterial,h.colorAdjustSetData(s)),f=this.allocateObjectSpaceToNormalizedImageSpaceTransform(h.from(),n,d);let m=this._delegate.getOrCreateImageTexture(b),p=this.allocateObjectSpaceToNormalizedImageSpaceTransform(h.to(),n,d);C.in_Material.Material_setUniformMat32(s,Ol,p),this._setupClampingForImageOrGIF(b.image,m),s.setUniformSampler(mr,m,1),s.setUniformFloat(sa,en.double_clamp(h.t(),0,1))}}let v=this._delegate.getOrCreateImageTexture(S);if(y&&v!=null){C.in_Material.Material_setUniformMat32(s,yn,e),C.in_Material.Material_setUniformMat32(s,zo,f),s.setUniformFloat(wn,h.opacity()),this._setupRepeatingForImage(u,s),this._setupClampingForImageOrGIF(S.image,v),s.setUniformSampler(Yt,v,0);for(let b=0,m=r.length;b<m;b=b+1)r[b].bufferArea!=null&&(this._delegate.drawToCurrentTile(C.Primitive.TRIANGLES,s,r[b].bufferArea),this._delegate.markDidDraw())}}}else{let S=u.asSinglePaint(),f=null;if(f=this.getOrCreateVideoTexture(S),f==null){let y=this.getImageToDraw(S,n,e,d,S.imageScaleMode());y!=null&&(f=this._delegate.getOrCreateImageTexture(y),f!=null&&this._setupClampingForImageOrGIF(y.image,f))}if(f!=null){let y=this.allocateObjectSpaceToNormalizedImageSpaceTransform(S,n,d);s=this._imageMaterial,S.colorAdjustIsActive()&&(s=this._imageColorAdjustMaterial,S.colorAdjustSetData(s)),C.in_Material.Material_setUniformMat32(s,yn,e),C.in_Material.Material_setUniformMat32(s,zo,y),s.setUniformFloat(wn,S.opacity()),this._setupRepeatingForImage(u,s),s.setUniformSampler(Yt,f,0);for(let v=0,b=r.length;v<b;v=v+1)r[v].bufferArea!=null&&(this._delegate.drawToCurrentTile(C.Primitive.TRIANGLES,s,r[v].bufferArea),this._delegate.markDidDraw())}}break}case"EMOJI":{let d=u.asSinglePaint();if(d==null)continue;let h=this._delegate.getOrCreateImageTexture(new vi(d.image(),2));if(d.decodedImageIsReady()||(h=null),h!=null){let S=h;s=this._imageMaterial;let f=ee.new2().scaledBy3(1/i.width(),1/i.height()).translatedBy2(-i.left(),-i.top());C.in_Material.Material_setUniformMat32(s,yn,e),C.in_Material.Material_setUniformMat32(s,zo,f),s.setUniformFloat(wn,d.opacity()),s.setUniformSampler(Yt,S,0),S!=null&&S.setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP);for(let y=0,v=r.length;y<v;y=y+1)r[y].bufferArea!=null&&(this._delegate.drawToCurrentTile(C.Primitive.TRIANGLES,s,r[y].bufferArea),this._delegate.markDidDraw())}break}}}this._shouldFlushAfterRenderGeometryDirectly&&this._context.flush()}_setupRepeatingForImage(e,t){let n=!1,r=e.asVolatilePaint();r!=null?r.eitherPaint(o=>o.imageScaleMode()=="TILE")&&(n=!0):e.asSinglePaint()!=null&&(n=e.asSinglePaint().imageScaleMode()=="TILE"),t.setUniformInt(Th,n?1:0),t.setUniformInt(vh,n?0:1)}_setupClampingForImageOrGIF(e,t){e.isGIF()?t.setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP):t.setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP)}renderStencilGeometry(e,t,n){let r=t.path().triangles(this._bufferPool,C.VertexFormat.POSITION_F2_COORD_F3),o=this._stencilMaterial;C.in_Material.Material_setUniformMat32(o,yn,e),this._context.setStencilState(n),C.in_Context.Context_setKeepBlendState(this._context);for(let i=0,a=r.length;i<a;i=i+1)r[i].bufferArea!=null&&(this._delegate.drawToCurrentTile(C.Primitive.TRIANGLES,o,r[i].bufferArea),this._delegate.markDidDraw())}_checkShouldFlushAfterStencilCover(){return!!Q.shouldFlushAfterStencilCover()}_checkShouldFlushAfterRenderGeometryDirectly(){return!!Q.shouldFlushAfterRenderGeometryDirectly()}renderCoverQuad(e,t,n,r,o){let i=t.paints;if(i.length==0){this.renderStencilQuad(e,t.path().bounds(),o),this._shouldFlushAfterStencilCover&&this._context.flush();return}let a=t.path().bounds(),s=ee.new3(e).translatedBy1(a.topLeft()).scaledBy1(a.size()),c=this.uvTransformFromBounds(a,n),l=null;for(let u=0,d=i.length;u<d;u=u+1){let h=i[u],S=u+1==d;if(!(!S&&this.canSkipPaint(e,c,h,a)))switch(this._context.setStencilState(S?o:r),h.type()){case"SOLID":{l=this._solidColorMaterial,C.in_Material.Material_setUniformMat32(l,yn,s),C.in_Material.Material_setUniformVec42(l,No,E.premultiplied(h.color())),l.setUniformFloat(wn,h.opacity()),this._delegate.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,l,this._quadArea),this._delegate.markDidDraw();break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{let f=ee.new3(h.transform()).multipliedBy1(c),y=h.asVolatilePaint();if(y!=null){l=this._lerpGradientPaintMaterial;let v=this._findOrCreateGradientData(y.from()).texture(this._context),b=this._findOrCreateGradientData(y.to()).texture(this._context);v.setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),b.setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),l.setUniformSampler(Yt,v,0),l.setUniformSampler(mr,b,1),l.setUniformFloat(sa,y.t())}else{let v=h.asSinglePaint();l=this._gradientPaintMaterial;let b=this._findOrCreateGradientData(v).texture(this._context);b.setFormat(C.TextureFormat.RGBA_LINEAR_CLAMP),l.setUniformSampler(Yt,b,0)}C.in_Material.Material_setUniformMat32(l,yn,s),C.in_Material.Material_setUniformMat32(l,zo,f),l.setUniformInt(qa,Xl.get(h.type())),l.setUniformFloat(wn,h.opacity()),this._delegate.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,l,this._quadArea),this._delegate.markDidDraw();break}case"IMAGE":case"VIDEO":{let f=ee.new3(c).scaledBy3(1/a.size().x(),1/a.size().y()),y=!0,v=!1,b=h.asVolatilePaint();if(b!=null){let m=this.getImageToDraw(b.from(),n,e,f,b.from().imageScaleMode());if(m!=null){let p=ee.new2();if(b.from().image()==b.to().image()&&!(b.from().imageScaleMode()=="TILE"||b.to().imageScaleMode()=="TILE"))l=this._imageMaterial,b.colorAdjustIsActive()&&(l=this._imageColorAdjustMaterial,b.colorAdjustSetData(l)),p=this.allocateObjectSpaceToNormalizedImageSpaceTransform(b,n,c);else{l=this._lerpImageMaterial,b.colorAdjustIsActive()&&(l=this._lerpImageColorAdjustMaterial,b.colorAdjustSetData(l)),p=this.allocateObjectSpaceToNormalizedImageSpaceTransform(b.from(),n,c);let T=this.getImageToDraw(b.to(),n,e,f,b.to().imageScaleMode());if(T==null)y=!1;else{let N=this._delegate.getOrCreateImageTexture(T),k=this.allocateObjectSpaceToNormalizedImageSpaceTransform(b.to(),n,c);C.in_Material.Material_setUniformMat32(l,Ol,k),N!=null&&N.setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),l.setUniformSampler(mr,N,1),l.setUniformFloat(sa,en.double_clamp(b.t(),0,1))}}let _=this._delegate.getOrCreateImageTexture(m);y&&_!=null&&(_!=null&&_.setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(h,l),C.in_Material.Material_setUniformMat32(l,yn,s),C.in_Material.Material_setUniformMat32(l,zo,p),l.setUniformFloat(wn,b.opacity()),l.setUniformSampler(Yt,_,0),this._delegate.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,l,this._quadArea),this._delegate.markDidDraw(),v=!0)}}else{let m=h.asSinglePaint(),p=null;if(p=this.getOrCreateVideoTexture(m),p==null){let _=this.getImageToDraw(m,n,e,f,m.imageScaleMode());_!=null&&(p=this._delegate.getOrCreateImageTexture(_))}if(p!=null){l=this._imageMaterial,m.colorAdjustIsActive()&&(l=this._imageColorAdjustMaterial,m.colorAdjustSetData(l));let _=this.allocateObjectSpaceToNormalizedImageSpaceTransform(m,n,c);p.setFormat(C.TextureFormat.RGBA_NEAREST_CLAMP),this._setupRepeatingForImage(h,l),C.in_Material.Material_setUniformMat32(l,yn,s),C.in_Material.Material_setUniformMat32(l,zo,_),l.setUniformFloat(wn,m.opacity()),l.setUniformSampler(Yt,p,0),this._delegate.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,l,this._quadArea),this._delegate.markDidDraw(),v=!0}}S&&!v&&(C.in_Material.Material_setUniformMat32(this._solidColorMaterial,yn,s),C.in_Material.Material_setUniformVec42(this._solidColorMaterial,No,E.TRANSPARENT),this._solidColorMaterial.setUniformFloat(wn,0),this._delegate.drawToCurrentTile(C.Primitive.TRIANGLE_STRIP,this._solidColorMaterial,this._quadArea),this._delegate.markDidDraw());break}case"EMOJI":{ze("Emoji should always be rendered by renderGeometryDirectly");break}}}this._shouldFlushAfterStencilCover&&this._context.flush()}allocateObjectSpaceToNormalizedImageSpaceTransform(e,t,n){let r=e.allocateImageTransformForGeometrySize(t);return ee.new2().multipliedBy1(r).multipliedBy1(n)}getImageToDraw(e,t,n,r,o){if(e.image()==null&&e.imageThumbnail()==null)return null;e.imageThumbnail()!=null&&this._delegate.getOrCreateImageTexture(new vi(e.imageThumbnail(),1)),e.image()!=null&&e.image().isGIF()&&this._delegate.getOrCreateImageTexture(new vi(e.image(),0));let i=e.decodedImageThumbnailIsReady()?e.decodedImageThumbnail():null,a=!1;if(e.imageThumbnail()==null)a=!0;else if(i!=null){let s=this.allocateObjectSpaceToNormalizedImageSpaceTransform(e,t,r),c=ee.new3(s);c.invert();let l=ee.new2().scaledBy2(pn.TILE_SIZE).multipliedBy1(n).multipliedBy1(c).scaledBy3(1/i.width(),1/i.height()),u=l.axisX().length(),d=l.axisY().length();a=Math.max(d,u)>1||e.image()!=null&&e.image().isGIF(),o=="TILE"&&(a=!0)}if(a&&(this._delegate.getOrCreateImageTexture(new vi(e.image(),0)),e.decodedImageIsReady())){let s=e.decodedImage();if(s!=null)return new vi(s,0)}if(i!=null)return new vi(i,1);if(e.decodedImageIsReady()){let s=e.decodedImage();if(s!=null)return new vi(s,0)}return null}getOrCreateVideoTexture(e){var n;let t;return(n=e==null?void 0:e.video())==null?void 0:n.getOrCreateTexture(e,this._context,C.TextureFormat.RGBA_NEAREST_CLAMP)}},gn=Ot;gn.FILL=128,gn.STROKE=64,gn.NOT_FILL=255^Ot.FILL,gn.NOT_STROKE=255^Ot.STROKE,gn.FILL_AND_STROKE=Ot.FILL|Ot.STROKE,gn.WINDING_MASK=255^Ot.FILL_AND_STROKE,gn.computeStates=new Map([["ODD",new C.StencilState(new C.StencilFaceState(0,C.Comparison.ALWAYS,1,1,C.StencilOperation.KEEP,C.StencilOperation.INVERT,C.StencilOperation.INVERT))],["NONZERO",new C.StencilState(new C.StencilFaceState(0,C.Comparison.ALWAYS,Ot.WINDING_MASK,Ot.WINDING_MASK,C.StencilOperation.KEEP,C.StencilOperation.INCREMENT_WRAP,C.StencilOperation.INCREMENT_WRAP),new C.StencilFaceState(0,C.Comparison.ALWAYS,Ot.WINDING_MASK,Ot.WINDING_MASK,C.StencilOperation.KEEP,C.StencilOperation.DECREMENT_WRAP,C.StencilOperation.DECREMENT_WRAP))]]),gn.useStates=new Map([["ODD",new C.StencilState(new C.StencilFaceState(0,C.Comparison.NOT_EQUAL,1,0,C.StencilOperation.KEEP,C.StencilOperation.KEEP,C.StencilOperation.KEEP))],["NONZERO",new C.StencilState(new C.StencilFaceState(0,C.Comparison.NOT_EQUAL,Ot.WINDING_MASK,0,C.StencilOperation.KEEP,C.StencilOperation.KEEP,C.StencilOperation.KEEP))]]),gn.clearStates=new Map([["ODD",new C.StencilState(new C.StencilFaceState(0,C.Comparison.NOT_EQUAL,1,Ot.WINDING_MASK,C.StencilOperation.ZERO,C.StencilOperation.ZERO,C.StencilOperation.ZERO))],["NONZERO",new C.StencilState(new C.StencilFaceState(0,C.Comparison.NOT_EQUAL,Ot.WINDING_MASK,Ot.WINDING_MASK,C.StencilOperation.ZERO,C.StencilOperation.ZERO,C.StencilOperation.ZERO))]]),gn.setFillStates=new Map([["ODD",new C.StencilState(new C.StencilFaceState(Ot.FILL,C.Comparison.NOT_EQUAL,1,Ot.NOT_STROKE,C.StencilOperation.KEEP,C.StencilOperation.REPLACE,C.StencilOperation.REPLACE))],["NONZERO",new C.StencilState(new C.StencilFaceState(Ot.FILL,C.Comparison.NOT_EQUAL,Ot.WINDING_MASK,Ot.NOT_STROKE,C.StencilOperation.KEEP,C.StencilOperation.REPLACE,C.StencilOperation.REPLACE))]]),gn.setStrokeStates=new Map([["ODD",new C.StencilState(new C.StencilFaceState(Ot.STROKE,C.Comparison.NOT_EQUAL,1,Ot.NOT_FILL,C.StencilOperation.KEEP,C.StencilOperation.REPLACE,C.StencilOperation.REPLACE))],["NONZERO",new C.StencilState(new C.StencilFaceState(Ot.STROKE,C.Comparison.NOT_EQUAL,Ot.WINDING_MASK,Ot.NOT_FILL,C.StencilOperation.KEEP,C.StencilOperation.REPLACE,C.StencilOperation.REPLACE))]]),gn.compoundUseStates=new Map([[0,new C.StencilState(new C.StencilFaceState(Ot.FILL_AND_STROKE,C.Comparison.EQUAL,Ot.FILL_AND_STROKE,0,C.StencilOperation.KEEP,C.StencilOperation.KEEP,C.StencilOperation.KEEP))],[1,new C.StencilState(new C.StencilFaceState(Ot.STROKE,C.Comparison.EQUAL,Ot.FILL_AND_STROKE,0,C.StencilOperation.KEEP,C.StencilOperation.KEEP,C.StencilOperation.KEEP))]]),gn.compoundClearStates=new Map([[0,new C.StencilState(new C.StencilFaceState(Ot.FILL_AND_STROKE,C.Comparison.EQUAL,Ot.FILL_AND_STROKE,-1,C.StencilOperation.ZERO,C.StencilOperation.ZERO,C.StencilOperation.ZERO))],[1,new C.StencilState(new C.StencilFaceState(Ot.STROKE,C.Comparison.EQUAL,Ot.FILL_AND_STROKE,-1,C.StencilOperation.ZERO,C.StencilOperation.ZERO,C.StencilOperation.ZERO))]]);var ba=(n=>(n[n.NONE=0]="NONE",n[n.ANALYTICAL=1]="ANALYTICAL",n[n.SSAA=2]="SSAA",n))(ba||{}),cc;(t=>(t.ELLIPSE=0,t.ROUNDED_RECT=1))(cc||(cc={}));var Lm;(e=>{function g(t){return ba[t]}e.PathAntialiasing_toString=g})(Lm||(Lm={}));var su=class{constructor(e,t,n,r){this.bufferArea=e,this.hasNoCurves=t,this.hasNoOverlaps=n,this.hasNoCurvesAndSameOrientation=r}},li=class{path(){throw new Error("Not implemented")}optimized(){throw new Error("Not implemented")}equals(e){throw new Error("Not implemented")}withNewPaints(e){throw new Error("Not implemented")}canBeAnalyticallyAntialiased(){return this.path().path().canBeAnalyticallyAntialiased()}constructor(e,t,n){this.type=e,this.paints=t,this.maxBounds=n}};(t=>{let g;(o=>(o[o.STATIC=0]="STATIC",o[o.DYNAMIC=1]="DYNAMIC"))(g=t.PaintedGeometryType||(t.PaintedGeometryType={}));let e;(r=>{function n(o){return t.PaintedGeometryType[o]}r.PaintedGeometryType_toString=n})(e=t.in_PaintedGeometryType||(t.in_PaintedGeometryType={}))})(li||(li={}));var Qt=class extends li{constructor(e,t){super(0,t,e.bounds());this._isOptimized=!1,this._path=null,this._path=e}path(){return this._path}withNewPaints(e){return new Qt(this._path,e)}equals(e){if(this.type!=e.type)return!1;if(this.path()==null||e.path()==null){if(this.path()==null!=(e.path()==null))return!1}else if(!this.path().equals(e.path()))return!1;if(this.paints==null||e.paints==null){if(this.paints==null!=(e.paints==null))return!1}else if(!Re.equals(this.paints,e.paints))return!1;return!0}optimized(){if(this._isOptimized)return this;let e=Re.optimize(this.paints);return this.paints!=e?new Qt(this.path(),e):(this._isOptimized=!0,this)}},zi=class extends li{constructor(e,t,n,r){super(1,t,n);this._isOptimized=!1,this._computePath=null,this.id=null,this._computePath=e,this.id=r}path(){return this._computePath()}withNewPaints(e){return new zi(this._computePath,e,this.maxBounds,this.id)}equals(e){return this.type==e.type&&this.id==e.id}optimized(){if(this._isOptimized)return this;let e=Re.optimize(this.paints);return this.paints!=e?new zi(this._computePath,e,this.maxBounds,this.id):(this._isOptimized=!0,this)}},sr=(h=>(h[h.METADATA=0]="METADATA",h[h.GROUP=1]="GROUP",h[h.SUPERSAMPLE_GROUP=2]="SUPERSAMPLE_GROUP",h[h.FILL=3]="FILL",h[h.FILL_STROKE=4]="FILL_STROKE",h[h.MASK=5]="MASK",h[h.BLUR=6]="BLUR",h[h.BLEND=7]="BLEND",h[h.COMPOSITE_TILE_GRID=8]="COMPOSITE_TILE_GRID",h[h.HARD_MASK_WITH_COLOR=9]="HARD_MASK_WITH_COLOR",h[h.VOLATILE_PROPERTY_BINDING=10]="VOLATILE_PROPERTY_BINDING",h[h.STATIC_TRANSFORM_BINDING=11]="STATIC_TRANSFORM_BINDING",h[h.DISSOLVE=12]="DISSOLVE",h))(sr||{});var Ki;(o=>{function g(i,a){return i.has(a)}o.has=g;function e(i,a){return i.get(a)}o.get=e;function t(i,a,s){i.set(a,s)}o.set=t;function n(i){i.clear()}o.clear=n;function r(){return new Map}o._new=r})(Ki||(Ki={}));var Mt=class{currentBounds(e){if(e==null)return this.maxBounds;if(Ki.has(e,this))return Ki.get(e,this);let t=this._computeBounds(e);return Ki.set(e,this,t),t}constructor(e,t){this.maxBounds=null,this._isOptimized=!1,this.flags=0,this.maxBounds=e,this.flags=t}hasNonIsolatedBlends(){return(1&this.flags)!=0}hasBackgroundBlurs(){return(2&this.flags)!=0}canBeUsedInBackgroundBlurs(){return(4&this.flags)==0}hasVolatileContent(){return(8&this.flags)!=0}hasAnimatingMedia(){return(16&this.flags)!=0}maskNeedsSSAA(){return(32&this.flags)!=0}canCacheRasterized(){return!(this.hasNonIsolatedBlends()||this.hasBackgroundBlurs()||this.hasAnimatingMedia()||this.hasVolatileContent())}isRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.hasPerpendicularAxes(Ne.EPSILON))return!0}return!1}isAxisAlignedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().isRect()&&e.transform.isAxisAligned(Ne.EPSILON))return!0}return!1}isRoundedRectFill(){if(this.op()==3){let e=this;if(e.geometry.path().path()instanceof Dt&&e.transform.hasPerpendicularAxes(Ne.EPSILON))return!0}return!1}desiredAntialiasing(){return this.op()!=3&&this.op()!=4?0:this.hasAnimatingMedia()||this.hasVolatileContent()?0:this.op()==3&&this.geometry.canBeAnalyticallyAntialiased()?1:2}static visitEachNodeInTree(e,t,n){if(e!=null){switch(t!=null&&t(e),e.op()){case 0:{let r=e;Mt.visitEachNodeInTree(r.child,t,n);break}case 2:{let r=e;Mt.visitEachNodeInTree(r.child,t,n);break}case 1:{let r=e;for(let o of r.children)Mt.visitEachNodeInTree(o,t,n);break}case 3:case 4:case 8:break;case 5:{let r=e;Mt.visitEachNodeInTree(r.alpha,t,n),Mt.visitEachNodeInTree(r.color,t,n);break}case 6:{let r=e;Mt.visitEachNodeInTree(r.child,t,n);break}case 7:{let r=e;Mt.visitEachNodeInTree(r.child,t,n);break}case 9:{let r=e;Mt.visitEachNodeInTree(r.alpha,t,n);break}case 10:{let r=e;Mt.visitEachNodeInTree(r.child,t,n);break}case 11:{let r=e;Mt.visitEachNodeInTree(r.child,t,n);break}case 12:{let r=e;Mt.visitEachNodeInTree(r.startChild,t,n),Mt.visitEachNodeInTree(r.endChild,t,n);break}default:throw new Error(`Unhandled node op ${sr[e.op()]}`)}n!=null&&n(e)}}static geometryNodePaintSize(e){return e==null?null:e.op()==3||e.op()==4?e.paintSize:null}opProfileString(){let e="RenderNodeOp: ";switch(this.op()){case 0:{e+="METADATA";break}case 2:{e+="SUPERSAMPLE_GROUP";break}case 1:{e+="GROUP";break}case 3:{e+="FILL";break}case 4:{let t=this;switch(e+="FILL_STROKE",t.mode){case da.INSIDE:{e+=" mode=INSIDE";break}case da.OUTSIDE:{e+=" mode=OUTSIDE";break}}break}case 5:{let t=this;switch(e+="MASK",t.type){case mo.NORMAL:{e+=" type=NORMAL";break}case mo.BACKGROUND_BLUR:{e+=" type=BACKGROUND_BLUR";break}case mo.INNER_SHADOW:{e+=" type=INNER_SHADOW";break}case mo.KNOCKOUT_SHADOW:{e+=" type=KNOCKOUT_SHADOW";break}case mo.LUMINANCE:{e+=" type=LUMINANCE";break}}break}case 6:{e+="BLUR";break}case 7:{e+="BLEND mode="+this.blendMode;break}case 9:{e+="HARD_MASK_WITH_COLOR";break}case 8:{e+="COMPOSITE_TILE_GRID";break}case 10:{let t=this;e+=`VOLATILE_PROPERTY_BINDING property=${Yi.VolatileProperty_toString(t.property)}`;break}case 11:{e+=`STATIC_TRANSFORM_BINDING transform=${this.transform}`;break}case 12:{e+="DISSOLVE";break}default:throw new Error(`Unhandled node op ${sr[this.op()]}`)}return e}debugString1(){return this.debugString2(Mt.DebugStringType.BASIC)}debugString2(e){let t=new Mt.GenerateStringState;return this._debugStringRecursive(this,t,!0,!1,e),t.result}_debugStringRecursive(e,t,n,r,o){let i=o!=Mt.DebugStringType.BASIC;t.result+=t.indent,n||(t.result+=r?"\u2514\u2500":"\u251C\u2500");let a=t.indent.length;switch(n||(t.indent+=r?"  ":"\u2502 "),e.op()){case 0:{let s=e;t.result+="METADATA",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(s.child,t,!1,!0,o);break}case 2:{let s=e;t.result+="SUPERSAMPLE_GROUP",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(s.child,t,!1,!0,o);break}case 1:{let s=e;t.result+="GROUP",this._appendFlagsToString(t,e),t.result+=`
`;for(let c=0,l=s.children.length;c<l;c=c+1){let u=s.children[c];this._debugStringRecursive(u,t,!1,c+1==s.children.length,o)}break}case 3:{let s=e,c=s.geometry.path().path(),l=c instanceof Ko?"CirclePath":c instanceof Dt?"RoundedRectPath":c instanceof vt?"BezierPath":c instanceof ve?"FrozenBezierPath":c instanceof to?"UniquePath":"UnknownPath";t.result+=`FILL path=${l} paints=`,this._appendPaintDataToString(t,s.geometry.paints,o),i&&(t.result+=` transform=${s.transform}`,t.result+=` paintSize=${s.paintSize}`),e.isRectFill()?t.result+=" isRect":e.isRoundedRectFill()&&(t.result+=" isRoundedRect"),this._appendFlagsToString(t,e),t.result+=`
`;break}case 4:{let s=e;switch(t.result+="FILL_STROKE",s.mode){case da.INSIDE:{t.result+=" mode=INSIDE";break}case da.OUTSIDE:{t.result+=" mode=OUTSIDE";break}}t.result+=" fills=",this._appendGeometriesToString(t,s.fillGeometries,o),t.result+=" strokes=",this._appendGeometriesToString(t,s.strokeGeometries,o),i&&(t.result+=` transform=${s.transform}`),this._appendFlagsToString(t,s),t.result+=`
`;break}case 5:{let s=e;switch(t.result+="MASK",s.type){case mo.NORMAL:{t.result+=" type=NORMAL";break}case mo.BACKGROUND_BLUR:{t.result+=" type=BACKGROUND_BLUR";break}case mo.INNER_SHADOW:{t.result+=" type=INNER_SHADOW color=",this._appendColorToString(t,s.innerShadowFill);break}case mo.KNOCKOUT_SHADOW:{t.result+=" type=KNOCKOUT_SHADOW";break}}this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(s.alpha,t,!1,!1,o),this._debugStringRecursive(s.color,t,!1,!0,o);break}case 6:{let s=e;t.result+=`BLUR radius=${s.radius}`,i&&(t.result+=` clamp=${s.clamp}`),this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(s.child,t,!1,!0,o);break}case 7:{let s=e;t.result+="BLEND mode=",t.result+=s.blendMode,t.result+=` opacity=${s.opacity}`,this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(s.child,t,!1,!0,o);break}case 9:{let s=e;t.result+="HARD_MASK_WITH_COLOR color=",this._appendColorToString(t,s.color),this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(s.alpha,t,!1,!0,o);break}case 8:{let s=e;t.result+="COMPOSITE_TILE_GRID",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(s.tree,t,!1,!0,o);break}case 10:{let s=e;switch(t.result+=`VOLATILE_PROPERTY_BINDING property=${Yi.VolatileProperty_toString(s.property)}`,i&&(t.result+=` id=${s.id}`),s.property){case ua.MAX_TRANSFORM_SCALE:{t.result+=` value=${s.maxTransformScale()}`;break}case ua.TRANSFORM:{t.result+=` value=${s.transform()}`,s.id.startsWith("SHADOW_TRANSFORMATION")&&(t.result+=" SHADOW_TRANSFORMATION");break}case ua.OPACITY:{t.result+=` value=${s.opacity()}`;break}}this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(s.child,t,!1,!0,o);break}case 11:{let s=e;t.result+=`STATIC_TRANSFORM_BINDING transform=${s.transform}`,this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(s.child,t,!1,!0,o);break}case 12:{let s=e;t.result+="DISSOLVE",this._appendFlagsToString(t,e),t.result+=`
`,this._debugStringRecursive(s.startChild,t,!1,!1,o),this._debugStringRecursive(s.endChild,t,!1,!0,o);break}default:throw new Error(`Unhandled node op ${sr[e.op()]}`)}t.indent=t.indent.slice(0,a)}_appendGeometriesToString(e,t,n){e.result+="[";for(let r=0,o=t.length;r<o;r=r+1){let i=t[r];r!=0&&(e.result+=", ");let a=i.path().path();a instanceof vt?e.result+=`(${a.countCommands()} commands, `:a instanceof Ko?e.result+="EllipsePath, ":a instanceof Dt&&(e.result+="RoundedRectPath, "),this._appendPaintDataToString(e,i.paints,n),e.result+=")"}e.result+="]"}_appendFlagsToString(e,t){t.hasNonIsolatedBlends()&&(e.result+=" hasBlends"),t.hasBackgroundBlurs()&&(e.result+=" hasBgBlurs"),t.canBeUsedInBackgroundBlurs()&&(e.result+=" bgBlurSafe"),t.maskNeedsSSAA()&&(e.result+=" maskNeedsSSAA"),t.hasVolatileContent()&&(e.result+=" volatile"),t.canCacheRasterized()||(e.result+=" nocache")}_appendSinglePaintToString(e,t,n){let r=n!=Mt.DebugStringType.BASIC,o=t.asVolatilePaint();if(o!=null){e.result+="VOLATILE [",this._appendSinglePaintToString(e,o.from(),n),e.result+=" -> ",this._appendSinglePaintToString(e,o.to(),n),e.result+="]";return}let i=t.asSinglePaint();switch(i.type()){case"SOLID":{e.result+="color=",this._appendColorToString(e,i.color());break}case"GRADIENT_LINEAR":case"GRADIENT_RADIAL":case"GRADIENT_ANGULAR":case"GRADIENT_DIAMOND":{e.result+="stops=[";let a=i.colorStops();for(let s=0,c=a.length;s<c;s=s+1){s>0&&(e.result+=", ");let l=a[s];e.result+=`${l.position}`,e.result+=" ",this._appendColorToString(e,l.color)}e.result+="]";break}case"IMAGE":case"VIDEO":{r&&(e.result+=` hash=${i.image()!=null?i.image().hash():"NULL"}`,e.result+=` thumbnail=${i.imageThumbnail()!=null?i.imageThumbnail().hash():"NULL"}`,e.result+=` imageScaleMode=${i.imageScaleMode()}`,e.result+=` imageRotationDeg=${i.rotationDeg()}`,e.result+=` imageScalingFactor=${i.scalingFactor()}`);break}default:break}r&&i.transform()!=null&&(e.result+=` transform=${i.transform()}`),e.result+=` opacity=${i.opacity()}`}_appendPaintDataToString(e,t,n){e.result+="[";for(let r=0,o=t.length;r<o;r=r+1){r>0&&(e.result+=",");let i=t[r];e.result+=i.type()+" ",this._appendSinglePaintToString(e,i,n)}e.result+="]"}_appendColorToString(e,t){E.isOpaque(t)?e.result+=E.toCSS(t):e.result+=`rgba(${E.red(t)}, ${E.green(t)}, ${E.blue(t)}, ${E.alpha(t)})`}};(n=>{let g;(i=>(i[i.BASIC=0]="BASIC",i[i.EXTENDED=1]="EXTENDED"))(g=n.DebugStringType||(n.DebugStringType={}));class e{constructor(){this.result="",this.indent=""}}n.GenerateStringState=e;let t;(o=>{function r(i){return n.DebugStringType[i]}o.DebugStringType_toString=r})(t=n.in_DebugStringType||(n.in_DebugStringType={}))})(Mt||(Mt={}));var Ue=class extends Mt{constructor(){if(arguments.length==1){let e=arguments[0];super(iu(e,null),Wm(e));this.children=null,this._isFirstChildSolidBackground=!1,this.children=e}else if(arguments.length==2){let e=arguments[0],t=arguments[1];super(iu(e,null),Wm(e));this.children=null,this._isFirstChildSolidBackground=!1,this.children=e,this._isFirstChildSolidBackground=t,this._isFirstChildSolidBackground}}op(){return 1}isFirstChildSolidBackground(){return this._isFirstChildSolidBackground}canCacheRasterized(){return this.hasAnimatingMedia()||this.hasVolatileContent()||this.hasBackgroundBlurs()?!1:this._isFirstChildSolidBackground?!0:!this.hasNonIsolatedBlends()}_computeBounds(e){return iu(this.children,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.children.length;for(let t=0;t<e;t=t+1){if(t==0&&this._isFirstChildSolidBackground)continue;let n=this.children[t],r=n.optimized();if(r==n&&n.op()!=1)continue;let o=this.children.slice(0,t),i=(a,s)=>{if(s.op()==1){let c=s;for(let l of c.children)a.push(l)}else a.push(s)};for(r!=null&&i(o,r);(t=t+1)<e;){let a=this.children[t].optimized();a!=null&&i(o,a)}return o.length==0?null:this._isFirstChildSolidBackground?o.length==1?null:new Ue(o,this._isFirstChildSolidBackground):Ue.wrap(o)}return this.children.length==1?this.children[0]:(this._isOptimized=!0,this)}equals(e){if(e==this)return!0;if(e.op()!=this.op())return!1;let n=e.children;if(this.children.length!=n.length)return!1;for(let r=0,o=this.children.length;r<o;r=r+1)if(!this.children[r].equals(n[r]))return!1;return!0}static wrap(e){return e.length==1?e[0]:new Ue(e)}static wrapWithSolidBackground(e,t){let n=Sn.solidColorRect(e.maxBounds,t,1);return new Ue([n,e],!0)}},co=class extends Mt{constructor(){if(arguments.length==1){let e=arguments[0];super(e.maxBounds,e.flags);this.child=null,this.child=e}else if(arguments.length==2){let e=arguments[0],t=arguments[1];super(e.maxBounds,e.flags|t);this.child=null,this.child=e}}op(){return 2}_computeBounds(e){return this.child._computeBounds(e)}optimized(){if(this._isOptimized)return this;let e=n=>n.op()==5&&n.type==mo.KNOCKOUT_SHADOW,t=e(Ml(this.child));return this.child=this.child.optimized(),this.child==null?null:t&&!e(Ml(this.child))?this.child:!this.child.maskNeedsSSAA()&&!this.maskNeedsSSAA()?this.child:(this._isOptimized=!0,this)}equals(e){if(e==this)return!0;if(e.op()!=this.op())return!1;let t=e;return this.child.equals(t.child)}static thatShouldNotBeUnwrappedInOptimization(e){return new co(e,32)}},ci=class extends Mt{op(){return 0}constructor(e,t){super(e.maxBounds,t|e.flags);this.child=null,this.child=e}_computeBounds(e){return this.child._computeBounds(e)}optimized(){if(this._isOptimized)return this;let e=this.child.optimized();return e==null?null:e==this.child?(this._isOptimized=!0,this):new ci(e,this.flags)}equals(e){if(e==this)return!0;if(e.op()!=this.op())return!1;let t=e;return this.flags==e.flags&&this.child.equals(t.child)}static createForBackgroundBlur(e){return new ci(e,2|4)}},Sn=class extends Mt{op(){return 3}constructor(e,t,n){super(Jg(e,t),n_(t));this.transform=null,this.geometry=null,this.paintSize=null,this.transform=e,this.geometry=t,this.paintSize=n}geometryBounds(){return this.geometry.canBeAnalyticallyAntialiased()?this.transform.clone().transformRect(this.geometry.path().bounds().clone()):this.maxBounds}_computeBounds(e){return this.maxBounds}withPaints(e){return new Sn(this.transform,this.geometry.withNewPaints(e),this.paintSize)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty()||!Re.containsAtLeastOneVisiblePaint(this.geometry.paints))return null;let e=this.geometry.optimized(),t=e.type==0,n=e.canBeAnalyticallyAntialiased();if(t&&!n&&!e.path().isRect()&&(Re.hasAnimatingMediaPaints(e.paints)||Re.hasVolatilePaints(e.paints))){let r=new Sn(this.transform,new Qt(e.path(),[ne.createSolid(E.BLACK,1)]),this.paintSize),o=new Sn(this.transform,new Qt(xt.getOrCreate(Dt.fromRect(e.path().bounds()),"ODD"),e.paints),this.paintSize);return new fn(r,o).optimized()}return e==this.geometry?(this._isOptimized=!0,this):new Sn(this.transform,e,this.paintSize)}equals(e){if(e==this)return!0;if(e.op()!=this.op())return!1;let t=e;return this.transform.equals1(t.transform)&&this.geometry.equals(t.geometry)&&this.paintSize.equals(t.paintSize)}static solidColorRect(e,t,n){let r=[ne.createSolid(t,n)],o=ee.new2().translatedBy1(e.topLeft()).scaledBy1(e.size()),i=new Qt(xt.UNIT_RECT(),r),a=ye.FrozenVector_ZERO;return new Sn(o,i,a)}},da=(t=>(t[t.INSIDE=0]="INSIDE",t[t.OUTSIDE=1]="OUTSIDE",t))(da||{}),Ya=class extends Mt{op(){return 4}constructor(e,t,n,r,o){super(jg(e,t,n,o),Xg([t,n]));this.transform=null,this.fillGeometries=null,this.strokeGeometries=null,this.paintSize=null,this.mode=0,this.transform=e,this.fillGeometries=t,this.strokeGeometries=n,this.paintSize=r,this.mode=o}_computeBounds(e){return this.maxBounds}optimized(){if(this._isOptimized)return this;let e=[];for(let r=0,o=this.strokeGeometries.length;r<o;r=r+1){let i=this.strokeGeometries[r];Re.containsAtLeastOneVisiblePaint(i.paints)&&e.push(i)}if(this.maxBounds.isEmpty()||this.fillGeometries.length==0&&e.length==0)return null;let t=r=>{let o=[];for(let i=0,a=r.length;i<a;i=i+1){let s=r[i];o.push(new Sn(this.transform,s,this.paintSize))}return Ue.wrap(o).optimized()};return e.length==0?t(this.fillGeometries):this.fillGeometries.length==0?this.mode==0?null:t(e):nn.FrozenList_equals(e,this.strokeGeometries,(r,o)=>r.equals(o))?(this._isOptimized=!0,this):new Ya(this.transform,this.fillGeometries,e,this.paintSize,this.mode).optimized()}equals(e){if(e==this)return!0;if(e.op()!=this.op())return!1;let t=e;return this.transform.equals1(t.transform)&&nn.FrozenList_equals(this.fillGeometries,t.fillGeometries,(n,r)=>n.equals(r))&&nn.FrozenList_equals(this.strokeGeometries,t.strokeGeometries,(n,r)=>n.equals(r))&&this.paintSize.equals(t.paintSize)&&this.mode==t.mode}},mo=(o=>(o[o.NORMAL=0]="NORMAL",o[o.LUMINANCE=1]="LUMINANCE",o[o.INNER_SHADOW=2]="INNER_SHADOW",o[o.BACKGROUND_BLUR=3]="BACKGROUND_BLUR",o[o.KNOCKOUT_SHADOW=4]="KNOCKOUT_SHADOW",o))(mo||{}),fn=class extends Mt{constructor(){if(arguments.length==5){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3],o=arguments[4];super(au(e,t,n,null),Km(e,t,n));this.alpha=null,this.color=null,this.type=0,this.innerShadowFill=0,this.innerShadowAlphaRequiresHardMask=!1,this.alpha=e,this.color=t,this.type=n,this.innerShadowFill=r,this.innerShadowAlphaRequiresHardMask=o}else if(arguments.length==2){let e=arguments[0],t=arguments[1];super(au(e,t,0,null),Km(e,t,0));this.alpha=null,this.color=null,this.type=0,this.innerShadowFill=0,this.innerShadowAlphaRequiresHardMask=!1,this.alpha=e,this.color=t,this.type=0,this.innerShadowFill=E.TRANSPARENT,this.innerShadowAlphaRequiresHardMask=!1}}op(){return 5}_computeBounds(e){return au(this.alpha,this.color,this.type,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.alpha.optimized();if(e==null)return null;let t=this.color.optimized(),n=this.type!=4,r=this.type!=4&&this.type!=2;if(t!=null&&n&&(t=fn.cullGroupChildren(t,e.maxBounds)),t!=null&&r&&(e=fn.cullGroupChildren(e,t.maxBounds),e==null))return null;switch(this.type){case 0:case 1:{if(t==null)return null;if(e.isAxisAlignedRectFill()){let o=e,i=B.new2();if(i.copyFrom(o.geometryBounds()),i.expand1(Ne.EPSILON),i.contains1(t.maxBounds)){let s=o.geometry.paints;if(Re.containsAtLeastOneVisibleOpaquePaint(s))return t;let c=Re.onlySolidPaintOrNull(s);if(c!=null)return new xr("PASS_THROUGH",E.alphaF(c.color())*c.opacity(),t).optimized()}}break}case 4:{if(t==null)return null;let o=e.maxBounds,i=t.maxBounds;if(!o.overlaps(i))return t;if(!e.hasVolatileContent()&&o.contains1(i))return null;break}case 2:{if(E.alpha(this.innerShadowFill)==0)return null;if(t==null&&e.op()==3&&!this.innerShadowAlphaRequiresHardMask){let o=e,i=o.geometry.paints,a=Re.onlySolidPaintOrNull(i);if(a!=null)return o.withPaints([ne.createSolid(E.multiplyOpacity(this.innerShadowFill,E.alphaF(a.color())),1)])}if(e.op()==9&&t!=null){let o=e;return new fn(o.alpha,t,this.type,this.innerShadowFill,!0)}break}case 3:break}return e==this.alpha&&t==this.color?(this._isOptimized=!0,this):(t==null&&(t=new Ue([])),new fn(e,t,this.type,this.innerShadowFill,this.innerShadowAlphaRequiresHardMask))}equals(e){if(e==this)return!0;if(e.op()!=this.op())return!1;let t=e;return this.alpha.equals(t.alpha)&&this.color.equals(t.color)&&this.type==t.type&&this.innerShadowFill==t.innerShadowFill}static createForInnerShadow(e,t,n){return new fn(e,t,2,n,!1)}static createForBackgroundBlur(e,t){return new fn(e,t,3,E.TRANSPARENT,!1)}static createForKnockoutShadow(e,t){return new fn(e,t,4,E.TRANSPARENT,!1)}static createForLuminanceMask(e,t){return new fn(e,t,1,E.TRANSPARENT,!1)}static cullGroupChildren(e,t){if(e!=null&&!e.maxBounds.overlaps(t))return null;if(e!=null&&e.op()==1){let n=e,r=n.children.length;for(let o=0;o<r;o=o+1)if(!n.children[o].maxBounds.overlaps(t)){let a=n.children.slice(0,o);for(;(o=o+1)<r;)n.children[o].maxBounds.overlaps(t)&&a.push(n.children[o]);return Ue.wrap(a).optimized()}}return e}},Dr=class extends Mt{op(){return 9}constructor(e,t){super(E.alpha(t)>0?e.maxBounds:B.INVALID,$g(e));this.alpha=null,this.color=0,this.alpha=e,this.color=t}_computeBounds(e){return E.alpha(this.color)>0?this.alpha.currentBounds(e):B.INVALID}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.alpha.optimized();if(e==null)return null;if(e.op()==10){let n=e;return new et(new Dr(n.child,this.color),n.id,n.property,n.getter).optimized()}e=Um(e,n=>(n.op()==7&&(n=n.child),n));let t=Um(e,n=>{if(n.op()==3){let r=n;if(!Re.hasVolatilePaints(r.geometry.paints)&&!Re.hasAnyFullyTransparentAreas(r.geometry.paints))return r.withPaints([ne.createSolid(this.color,1)])}return n});return t!=e?t:e==this.alpha?(this._isOptimized=!0,this):new Dr(e,this.color)}equals(e){if(e==this)return!0;if(e.op()!=this.op())return!1;let t=e;return this.alpha.equals(t.alpha)&&this.color==t.color}},Ar=class extends Mt{op(){return 6}constructor(e,t,n){super(Gm(e,t,null),e_(t));this.radius=0,this.child=null,this.clamp=null,this.radius=e,this.child=t,this.clamp=n}_computeBounds(e){return Gm(this.radius,this.child,e)}optimized(){if(this._isOptimized)return this;if(this.maxBounds.isEmpty())return null;let e=this.child.optimized();if(e==null)return null;if(this.radius==0)return e;if(e.op()==10&&this.clamp.isInvalid()){let t=e;return new et(new Ar(this.radius,t.child,this.clamp),t.id,t.property,t.getter).optimized()}return e==this.child?(this._isOptimized=!0,this):new Ar(this.radius,e,this.clamp)}equals(e){if(e==this)return!0;if(e.op()!=this.op())return!1;let t=e;return this.radius==t.radius&&this.child.equals(t.child)&&this.clamp.equals(t.clamp)}},xr=class extends Mt{op(){return 7}constructor(e,t,n){super(t>0?n.maxBounds:B.INVALID,t_(e,n));this.blendMode=null,this.opacity=0,this.child=null,this.blendMode=e,this.opacity=t,this.child=n}_computeBounds(e){return this.opacity>0?this.child.currentBounds(e):B.INVALID}optimized(){var r;let e;if(this._isOptimized)return this;if(this.opacity==0||this.maxBounds.isEmpty())return null;let t=this.child.optimized();if(t==null)return null;if(this.opacity==1&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL"&&!t.hasNonIsolatedBlends()))return t;if((this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&t.op()==3){let o=t,i=(r=Re.onlyPaintOrNull(o.geometry.paints))==null?void 0:r.asSinglePaint();if(i!=null){let a=i.cloneAsSinglePaint();a.setOpacity(a.opacity()*this.opacity);let s=[a].slice();return o.withPaints(s)}}let n=this.opacity;if(t.op()==7){let o=t;this.blendMode==o.blendMode&&(this.blendMode=="PASS_THROUGH"||this.blendMode=="NORMAL")&&(n=o.opacity*n,t=o.child)}return n==this.opacity&&t==this.child?(this._isOptimized=!0,this):new xr(this.blendMode,n,t)}equals(e){if(e==this)return!0;if(e.op()!=this.op())return!1;let t=e;return this.blendMode==t.blendMode&&this.opacity==t.opacity&&this.child.equals(t.child)}},Cd=class{constructor(e,t){this.key=null,this._cache=null,this.tileHandleOrNull=null,this.neededImagesOrNull=null,this.key=e,this._cache=t}canvasSpaceBounds(){return this.key.bounds}textureRegionOrNull(){return this._cache.textureRegionOrNull(this)}bounds(){return this.key.bounds}},Vl=(t=>(t[t.ALL=0]="ALL",t[t.ONLY_IN_CACHE=1]="ONLY_IN_CACHE",t))(Vl||{}),Rd=class extends Mt{op(){return 8}constructor(e,t){super(zm(e,null),e.flags);this.tree=null,this._tileCache=null,this._tiles=new Map,this._devicePixelsPerCanvasPixel=-1,this.tree=e,this._tileCache=t}optimized(){return this._isOptimized=!0,this}_computeBounds(e){return zm(this.tree,e)}equals(e){if(e==this)return!0;if(e.op()!=this.op())return!1;let t=e;return this._tileCache==t._tileCache&&this.maxBounds.equals(t.maxBounds)&&this.tree.equals(t.tree)}setDevicePixelPerCanvasPixel(e){this._devicePixelsPerCanvasPixel!=e&&(this._tiles=new Map,this._devicePixelsPerCanvasPixel=e)}numTilesNeededForBounds(e){let t=B.new3(e);t.intersectWith(this.maxBounds);let n=new I(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),r=pn.TILE_SIZE/this._devicePixelsPerCanvasPixel,o=Math.floor((t.left()-n.x())/r)|0,i=Math.ceil((t.right()-n.x())/r)|0,a=Math.floor((t.top()-n.y())/r)|0,s=Math.ceil((t.bottom()-n.y())/r)|0;return(i-o)*(s-a)}forEachTileWithinBounds(e,t,n){if(!t.overlaps(this.maxBounds))return;let r=B.new3(t);r.intersectWith(this.maxBounds);let o=new I(Math.floor(this.maxBounds.left()),Math.floor(this.maxBounds.top())),i=pn.TILE_SIZE/this._devicePixelsPerCanvasPixel,a=Math.floor((r.left()-o.x())/i)|0,s=Math.ceil((r.right()-o.x())/i)|0,c=Math.floor((r.top()-o.y())/i)|0,l=Math.ceil((r.bottom()-o.y())/i)|0,u=o.y()+c*i;for(let d=c;d<l;d=d+1,u+=i){let h=Ht.IntMap_get(this._tiles,d,null);h==null&&(h=new Map,this._tiles.set(d,h));let S=o.x()+a*i;for(let f=a;f<s;f=f+1,S+=i){let y=Ht.IntMap_get(h,f,null);if(y!=null){let m=y.value;m!=null&&n(m);continue}if(e==1)continue;let v=new B(S,u,i,i),b=this._tileCache.getOrInsertOrNull(this.tree,v);h.set(f,new fe(b)),b!=null&&n(b)}}}},ua=(i=>(i[i.INVERSE_TRANSFORM=0]="INVERSE_TRANSFORM",i[i.TRANSFORM_ISOLATION=1]="TRANSFORM_ISOLATION",i[i.TRANSFORM=2]="TRANSFORM",i[i.MAX_TRANSFORM_SCALE=3]="MAX_TRANSFORM_SCALE",i[i.OPACITY=4]="OPACITY",i[i.STATE_SWAP=5]="STATE_SWAP",i))(ua||{}),et=class extends Mt{op(){return 10}constructor(e,t,n,r){super(Zg(e,n),e.flags|8);this.child=null,this.id=null,this.property=0,this.getter=null,this.child=e,this.id=t,this.property=n,this.getter=r}_computeBounds(e){switch(this.property){case 2:{let t=this.child.currentBounds(e).clone();return this.transform().transformRect(t),t}case 1:case 3:case 4:case 5:return this.child.currentBounds(e);case 0:return this.maxBounds;default:throw new Error(`Unhandled VolatileProperty value: ${Yi.VolatileProperty_toString(this.property)}`)}}transform(){return this.getter()}opacity(){return+this.getter()}maxTransformScale(){return+this.getter()}optimized(){if(this._isOptimized)return this;let e=this.child.optimized();return e==null||e.maxBounds.isEmpty()?null:e!=this.child?new et(e,this.id,this.property,this.getter):(this._isOptimized=!0,this)}equals(e){if(e==this)return!0;if(e.op()!=this.op())return!1;let t=e;return this.id==t.id&&this.property==t.property&&this.child.equals(t.child)}static forTranslation(e,t,n){let r=ee.new2();return et.forTransform(e,t,()=>(r.copyFrom(Nt.FrozenAffineTransform_IDENTITY),r.translatedBy1(n())))}static forTransform(e,t,n){return new et(e,t,2,n)}static forOpacity(e,t,n){return new et(e,t,4,n)}static forTransformIsolation(e){let t="ID_FOR_TRANSFORM_ISOLATION";return new et(e,t,1,null)}static forMaxTransformScale(e,t){let n=`ID_FOR_MAX_TRANSFORM_SCALE_${e}`;return new et(t,n,3,()=>e)}static forInverseTransform(e){let t="ID_FOR_INVERSE_TRANSFORM";return new et(e,t,0,null)}static forStateSwap(e){let t="ID_FOR_STATE_SWAP";return new et(e,t,5,null)}},qo=class extends Mt{op(){return 11}constructor(e,t){super(Qg(e,t),e.flags);this.child=null,this.transform=null,this.child=e,this.transform=t}_computeBounds(e){return this.maxBounds}optimized(){if(this._isOptimized)return this;let e=this.child.optimized();return e==null||e.maxBounds.isEmpty()?null:this.transform.equals1(Nt.FrozenAffineTransform_IDENTITY)?e:e!=this.child?new qo(e,this.transform):(this._isOptimized=!0,this)}equals(e){if(e==this)return!0;if(e.op()!=this.op())return!1;let t=e;return this.transform.equals1(t.transform)&&this.child.equals(t.child)}},Jn=class extends Mt{op(){return 12}constructor(e,t,n,r){super(Hm(e,t,null),(e!=null?e.flags:0)|(t!=null?t.flags:0)|8);this.startChild=null,this.endChild=null,this.id=null,this.progressFn=null,this.startChild=e,this.endChild=t,this.id=n,this.progressFn=r}_computeBounds(e){return Hm(this.startChild,this.endChild,e)}progress(){return this.progressFn()}optimized(){if(this._isOptimized)return this;let e=this.startChild!=null?this.startChild.optimized():null,t=this.endChild!=null?this.endChild.optimized():null,n=e!=null&&!e.maxBounds.isEmpty(),r=t!=null&&!t.maxBounds.isEmpty();if(!n&&!r)return null;if(n)if(r){if(this.startChild.equals(this.endChild))return this.startChild}else return new et(e,this.id,4,()=>1-this.progressFn());else return new et(t,this.id,4,()=>this.progressFn());return this.startChild!=e||this.endChild!=t?new Jn(e,t,this.id,this.progressFn):(this._isOptimized=!0,this)}equals(e){if(e==this)return!0;if(e.op()!=this.op())return!1;let t=e;return this.id==t.id&&this.startChild.equals(t.startChild)&&this.endChild.equals(t.endChild)}},Vm;(e=>{function g(t){return sr[t]}e.RenderNodeOp_toString=g})(Vm||(Vm={}));var Bm;(e=>{function g(t){return mo[t]}e.MaskType_toString=g})(Bm||(Bm={}));var km;(e=>{function g(t){return Vl[t]}e.TileFilter_toString=g})(km||(km={}));var Yi;(e=>{function g(t){switch(t){case 0:return"INVERSE_TRANSFORM";case 1:return"TRANSFORM_ISOLATION";case 2:return"TRANSFORM";case 3:return"MAX_TRANSFORM_SCALE";case 4:return"OPACITY";case 5:return"STATE_SWAP";default:throw new Error("Unhandled VolatileProperty value")}}e.VolatileProperty_toString=g})(Yi||(Yi={}));function Xg(g){let e=0;for(let t of g)for(let n=0,r=t.length;n<r;n=n+1)Re.hasAnimatingMediaPaints(t[n].paints)&&(e|=16),Re.hasVolatilePaints(t[n].paints)&&(e|=8);return e}function Um(g,e){if(g.op()==11){let t=g,n=e(t.child);return n==t.child?t:n!=null?new qo(n,t.transform):null}else return e(g)}function Ml(g){return g.op()==11?g.child:g}function _m(g){if(g.op()==11){let e=g;return new Ir(e.child,e.transform)}else if(g.op()==10){let e=g;if(e.property==2)return new Ir(e.child,e.transform())}return new Ir(g,null)}function iu(g,e){let t=new bt;for(let n of g)t.include3(n.currentBounds(e));return t.isValid()?t.build():B.INVALID}function au(g,e,t,n){if(t==2)return g.currentBounds(n);if(t==4)return e.currentBounds(n);if(Ne.emulateFullscreenRenderingBugs&&t==3)return g.currentBounds(n);let r=g.currentBounds(n).clone();return r.intersectWith(e.currentBounds(n)),r}function Gm(g,e,t){if(e.currentBounds(t).isEmpty())return e.currentBounds(t);let n=e.currentBounds(t).clone();return n.expand1(g),n}function dc(g,e){let t=new bt,n=!1;for(let o=0,i=e.length;o<i;o=o+1){let a=e[o];t.include3(a.maxBounds),a.canBeAnalyticallyAntialiased()&&(n=!0)}if(!t.isValid())return B.INVALID;let r=t.build();return g.transformRect(r),n&&r.expand1(4),r}function jg(g,e,t,n){if(n==0)return dc(g,e);let r=new bt;return r.include3(dc(g,e)),r.include3(dc(g,t)),r.isValid()?r.build():B.INVALID}function Jg(g,e){return dc(g,[e].slice())}function Zg(g,e){switch(e){case 2:case 0:{let t=B.new2();return t.copyFrom(g.maxBounds),t.expandedBy1(1e6),t}case 4:case 3:case 1:case 5:return g.maxBounds;default:throw new Error(`Unhandled property ${Yi.VolatileProperty_toString(e)}`)}}function Qg(g,e){return e.transformRect(B.new3(g.maxBounds))}function Hm(g,e,t){let n=new bt;return g!=null&&n.include3(g.currentBounds(t)),e!=null&&n.include3(e.currentBounds(t)),n.build()}function zm(g,e){let t=g.currentBounds(e).clone();return t.expand1(1),t}function Wm(g){let e=0;for(let t of g)e|=t.flags;return e}function Km(g,e,t){let n=g.flags&~1|e.flags;return t!=0&&t!=4&&t!=1&&(n&=~1),t==2&&(n|=32),n}function $g(g){return g.flags&~1|32}function e_(g){return g.flags&~1}function t_(g,e){let t=e.flags;return g!="PASS_THROUGH"&&(t&=~1,t|=g!="NORMAL"?1:0),t}function n_(g){let e=0;return Re.hasAnimatingMediaPaints(g.paints)&&(e|=16),(Re.hasVolatilePaints(g.paints)||g.type==1)&&(e|=8),e}var _o;(l=>{function g(u){if(dt.int_remainder(u.byteCount(),l.NUM_BYTES_PER_FLOAT)!=0)return!1;let d=u.byteCount()/l.NUM_BYTES_PER_FLOAT|0;if(dt.int_remainder(d,l.NUM_FLOATS_PER_VERTEX)!=0)return!1;let h=d/l.NUM_FLOATS_PER_VERTEX|0;if(dt.int_remainder(h,3)!=0)return!1;if(u.byteCount()>C.BufferChunk.BYTE_COUNT)throw new Error("This triangles chunk exceeds the maximum buffer size and will crash if we try to render it");return!0}l.isValid=g;function e(u){return u.byteCount()/(l.NUM_BYTES_PER_FLOAT*l.NUM_FLOATS_PER_VERTEX)|0}l.numVertices=e;function t(u,d){let h=d*l.NUM_FLOATS_PER_VERTEX*l.NUM_BYTES_PER_FLOAT;return u.floatAt(h)}l.xValueAt=t;function n(u,d){let h=d*l.NUM_FLOATS_PER_VERTEX*l.NUM_BYTES_PER_FLOAT;return u.floatAt(h+1*l.NUM_BYTES_PER_FLOAT)}l.yValueAt=n;function r(u,d){let h=t(u,d),S=n(u,d);return new I(h,S)}l.xyValueAt=r;function o(u,d){let h=d*l.NUM_FLOATS_PER_VERTEX*l.NUM_BYTES_PER_FLOAT;return u.floatAt(h+2*l.NUM_BYTES_PER_FLOAT)}l.kValueAt=o;function i(u,d){let h=d*l.NUM_FLOATS_PER_VERTEX*l.NUM_BYTES_PER_FLOAT;return u.floatAt(h+3*l.NUM_BYTES_PER_FLOAT)}l.lValueAt=i;function a(u,d){let h=d*l.NUM_FLOATS_PER_VERTEX*l.NUM_BYTES_PER_FLOAT;return u.floatAt(h+4*l.NUM_BYTES_PER_FLOAT)}l.mValueAt=a,l.NUM_BYTES_PER_FLOAT=4,l.NUM_FLOATS_PER_VERTEX=5})(_o||(_o={}));var uc;(P=>{function g(J,z){P._p.setTo(0,0);for(let O=J.start();ve.Command.isValid(O,J);O=ve.Command.next(O,J)){switch(ve.Command.kind(O,J)){case ve.Command.Kind.CLOSE:break;case ve.Command.Kind.MOVE_TO:{P._p3.setTo(ve.Command.moveToX(O,J),ve.Command.moveToY(O,J)),P._p.copyFrom(P._p3);break}case ve.Command.Kind.LINE_TO:{P._p3.setTo(ve.Command.lineToX(O,J),ve.Command.lineToY(O,J)),d(z,P._p,P._p0,P._p3);break}case ve.Command.Kind.QUADRATIC_TO:{let G=P._p0.x(),L=P._p0.y(),$=ve.Command.quadraticToFirstX(O,J),se=ve.Command.quadraticToFirstY(O,J),nt=ve.Command.quadraticToX(O,J),ot=ve.Command.quadraticToY(O,J);P._p1.setTo($+(G-$)/3,se+(L-se)/3),P._p2.setTo($+(nt-$)/3,se+(ot-se)/3),P._p3.setTo(nt,ot),d(z,P._p,P._p0,P._p3),a(z,P._p0,P._p1,P._p2,P._p3,y.INITIAL,0);break}case ve.Command.Kind.CUBIC_TO:{P._p1.setTo(ve.Command.cubicToFirstX(O,J),ve.Command.cubicToFirstY(O,J)),P._p2.setTo(ve.Command.cubicToSecondX(O,J),ve.Command.cubicToSecondY(O,J)),P._p3.setTo(ve.Command.cubicToX(O,J),ve.Command.cubicToY(O,J)),d(z,P._p,P._p0,P._p3),a(z,P._p0,P._p1,P._p2,P._p3,y.INITIAL,0);break}default:break}P._p0.copyFrom(P._p3)}}P.compile=g;function e(J){return Math.abs(J)<P._EPSILON?0:J}P._roundToZero=e;function t(J,z){return J.squaredDistanceTo(z)<P._EPSILON*P._EPSILON}P._approxEqual=t;function n(J,z,O){let G=(O.x()-z.x())*(z.y()-J.y())-(O.y()-z.y())*(z.x()-J.x());return G<0?-1:G>0?1:0}P._orientation=n;function r(J,z,O,G){return n(J,z,O)!=n(J,z,G)&&n(O,G,J)!=n(O,G,z)}P._linesIntersect=r;function o(J,z,O,G){let L=G.x()-z.x(),$=G.y()-z.y(),se=O.x()-z.x(),nt=O.y()-z.y(),ot=J.x()-z.x(),It=J.y()-z.y(),Qe=L*L+$*$,Gt=L*se+$*nt,tn=L*ot+$*It,bn=se*se+nt*nt,tr=se*ot+nt*It,Fn=Qe*bn-Gt*Gt;if(Fn==0)return!1;let ur=1/Fn,Wt=(bn*tn-Gt*tr)*ur,ut=(Qe*tr-Gt*tn)*ur,Tt=1e-4;return Wt>=-Tt&&ut>=-Tt&&Wt+ut<=1+Tt}P._pointInTriangle=o;function i(J,z,O){return J.x*(z.y*O.z-z.z*O.y)+J.y*(z.z*O.x-z.x*O.z)+J.z*(z.x*O.y-z.y*O.x)}P._dotCross=i;function a(J,z,O,G,L,$,se){if($==y.INITIAL||se<4){let Wt=L.x()-z.x(),ut=L.y()-z.y(),Tt=(O.x()-z.x())*ut-(O.y()-z.y())*Wt,Le=(G.x()-z.x())*ut-(G.y()-z.y())*Wt,Pt=3*Tt-3*Le,Kt=-4*Tt+2*Le,Ce=Tt,cn=Kt*Kt-4*Ce*Pt;if(cn>0){let Ie=-Kt/(2*Pt),gt=Math.sqrt(cn)/(2*Pt),Lt=Ie+gt,Ve=Ie-gt;if(0<Lt&&Lt<1&&0<Ve&&Ve<1){let qe=(Lt+Ve)/2;for(let re=0;re<10;re=re+1){let le=Tt-Le,ue=Le-2*Tt,Fe=qe*(qe*(qe*le+ue)+Tt),Ge=qe*(3*qe*le+2*ue)+Tt;qe-=Fe/Ge}let on=z.mixedWith(O,qe),Xt=O.mixedWith(G,qe),Jr=G.mixedWith(L,qe),ft=on.mixedWith(Xt,qe),A=Xt.mixedWith(Jr,qe),D=ft.mixedWith(A,qe);a(J,z,on,ft,D,y.SUBDIVIDED_BECAUSE_OF_CROSSING,se+1),a(J,D,A,Jr,L,y.SUBDIVIDED_BECAUSE_OF_CROSSING,se+1),d(J,z,D,L);return}}}P._b0.setTo(z.x(),z.y(),1),P._b1.setTo(O.x(),O.y(),1),P._b2.setTo(G.x(),G.y(),1),P._b3.setTo(L.x(),L.y(),1);let nt=i(P._b0,P._b3,P._b2),ot=i(P._b1,P._b0,P._b3),It=i(P._b2,P._b1,P._b0),Qe=nt-2*ot+3*It,Gt=-ot+3*It,tn=3*It,bn=1/Math.sqrt(Qe*Qe+Gt*Gt+tn*tn);Qe*=bn,Gt*=bn,tn*=bn;let tr=3*Gt*Gt-4*Qe*tn,Fn=Qe*Qe*tr;switch(Qe=e(Qe),Gt=e(Gt),tn=e(tn),Fn=e(Fn),t(P._b0,P._b1)&&t(P._b0,P._b2)&&t(P._b0,P._b3)?v.POINT:Fn<0?v.LOOP:Fn>0?v.SERPENTINE:Qe==0&&Gt==0?tn==0?v.LINE:v.QUADRATIC:Qe==0?v.CUSP:tr<0?v.LOOP:v.SERPENTINE){case v.SERPENTINE:{let Wt=Math.sqrt(Math.max(0,9*Gt*Gt-12*Qe*tn)),ut=3*Gt-Wt,Tt=6*Qe,Le=3*Gt+Wt,Pt=Tt,Kt=Tt-ut,Ce=Pt-Le;c(J,z,ut*Le,ut*ut*ut,Le*Le*Le,O,(3*ut*Le-ut*Pt-Tt*Le)/3,ut*ut*(ut-Tt),Le*Le*(Le-Pt),G,(Tt*(Pt-2*Le)+ut*(3*Le-2*Pt))/3,Kt*Kt*ut,Ce*Ce*Le,L,Kt*Ce,-Kt*Kt*Kt,-Ce*Ce*Ce);break}case v.LOOP:{let Wt=Math.sqrt(Math.max(0,4*Qe*tn-3*Gt*Gt)),ut=Gt-Wt,Tt=2*Qe,Le=Gt+Wt,Pt=Tt;if($!=y.SUBDIVIDED_BECAUSE_OF_LOOP||se<4){let cn=ut/Tt,Ie=Le/Pt,gt=P._EPSILON<cn&&cn<1-P._EPSILON,Lt=P._EPSILON<Ie&&Ie<1-P._EPSILON;if(gt&&Lt){s(J,z,O,G,L,Math.min(cn,Ie),Math.max(cn,Ie),se+1);return}if(gt){s(J,z,O,G,L,cn,-1,se+1);return}if(Lt){s(J,z,O,G,L,Ie,-1,se+1);return}}let Kt=Tt-ut,Ce=Pt-Le;c(J,z,ut*Le,ut*ut*Le,ut*Le*Le,O,(-ut*Pt-Tt*Le+3*ut*Le)/3,-ut*(ut*(Pt-3*Le)+2*Tt*Le)/3,-Le*(ut*(2*Pt-3*Le)+Tt*Le)/3,G,(Tt*(Pt-2*Le)+ut*(3*Le-2*Pt))/3,(Tt-ut)*(ut*(2*Pt-3*Le)+Tt*Le)/3,(Pt-Le)*(ut*(Pt-3*Le)+2*Tt*Le)/3,L,Kt*Ce,-Kt*Kt*Ce,-Kt*Ce*Ce);break}case v.CUSP:{let Wt=tn,ut=3*Gt,Tt=Wt-ut;c(J,z,Wt,Wt*Wt*Wt,1,O,Wt-ut/3,Wt*Wt*Tt,1,G,Wt-ut*(2/3),Tt*Tt*Wt,1,L,Tt,Tt*Tt*Tt,1);break}case v.QUADRATIC:{c(J,z,0,0,0,O,1/3,0,1/3,G,2/3,1/3,2/3,L,1,1,1);break}}}P._compileCubic=a;function s(J,z,O,G,L,$,se,nt){let ot=z.mixedWith(O,$),It=O.mixedWith(G,$),Qe=G.mixedWith(L,$),Gt=ot.mixedWith(It,$),tn=It.mixedWith(Qe,$),bn=Gt.mixedWith(tn,$);if(d(J,z,bn,L),a(J,z,ot,Gt,bn,y.SUBDIVIDED_BECAUSE_OF_LOOP,nt+1),se==-1){a(J,bn,tn,Qe,L,y.SUBDIVIDED_BECAUSE_OF_LOOP,nt+1);return}let tr=bn,Fn=tn,ur=Qe,Wt=L,ut=(se-$)/(1-$),Tt=tr.mixedWith(Fn,ut),Le=Fn.mixedWith(ur,ut),Pt=ur.mixedWith(Wt,ut),Kt=Tt.mixedWith(Le,ut),Ce=Le.mixedWith(Pt,ut),cn=Kt.mixedWith(Ce,ut);a(J,tr,Tt,Kt,cn,y.SUBDIVIDED_BECAUSE_OF_LOOP,nt+1),a(J,cn,Ce,Pt,Wt,y.SUBDIVIDED_BECAUSE_OF_LOOP,nt+1)}P._compileSubdividedCubic=s;function c(J,z,O,G,L,$,se,nt,ot,It,Qe,Gt,tn,bn,tr,Fn,ur){P._v0.set(z,O,G,L),P._v1.set($,se,nt,ot),P._v2.set(It,Qe,Gt,tn),P._v3.set(bn,tr,Fn,ur);let Wt=(O+tr)*(.9/2)+(se+Qe)*(.1/2),ut=(G+Fn)*(.9/2)+(nt+Gt)*(.1/2),Tt=(L+ur)*(.9/2)+(ot+tn)*(.1/2),Le=Wt*Wt*Wt-ut*Tt>0,Pt=0,Kt=0;for(let gt=0;gt<4;gt=gt+1){let Lt=dt.int_remainder(gt+1,4),Ve=dt.int_remainder(gt+2,4),qe=dt.int_remainder(gt+3,4),on=P._v[Lt].xy,Xt=P._v[Ve].xy,Jr=P._v[qe].xy,ft=on.distanceTo(Xt),A=Xt.distanceTo(Jr),D=Jr.distanceTo(on),re=(ft+A+D)/2,le=re*(re-ft)*(re-A)*(re-D);le>Pt&&(Pt=le,Kt=gt)}let Ce=dt.int_remainder(Kt+1,4),cn=dt.int_remainder(Kt+2,4),Ie=dt.int_remainder(Kt+3,4);if(o(P._v[Kt].xy,P._v[Ce].xy,P._v[cn].xy,P._v[Ie].xy)){h(J,P._v[Ce],P._v[cn],P._v[Ie],Le);return}r(z,It,$,bn)?z.squaredDistanceTo(It)<$.squaredDistanceTo(bn)?(h(J,P._v0,P._v1,P._v2,Le),h(J,P._v0,P._v2,P._v3,Le)):(h(J,P._v0,P._v1,P._v3,Le),h(J,P._v1,P._v2,P._v3,Le)):r(z,bn,$,It)?z.squaredDistanceTo(bn)<$.squaredDistanceTo(It)?(h(J,P._v0,P._v1,P._v3,!Le),h(J,P._v0,P._v3,P._v2,Le)):(h(J,P._v0,P._v1,P._v2,Le),h(J,P._v2,P._v1,P._v3,Le)):z.squaredDistanceTo($)<It.squaredDistanceTo(bn)?(h(J,P._v0,P._v2,P._v1,Le),h(J,P._v0,P._v1,P._v3,Le)):(h(J,P._v0,P._v2,P._v3,Le),h(J,P._v3,P._v2,P._v1,Le))}P._appendQuad=c;function l(J,z,O){return J.equals(z)||J.equals(O)||z.equals(O)}P._isEmptyTriangle=l;function u(J,z,O,G,L,$){J.appendFloat(z).appendFloat(O),J.appendFloat(G).appendFloat(L).appendFloat($)}P._appendVertex=u;function d(J,z,O,G){l(z,O,G)||(u(J,z.x(),z.y(),.5,.5,.5),u(J,O.x(),O.y(),.5,.5,.5),u(J,G.x(),G.y(),.5,.5,.5))}P._appendTriangle1=d;function h(J,z,O,G,L){if(!l(z.xy,O.xy,G.xy)){let $=L?-1:1;u(J,z.xy.x(),z.xy.y(),z.k*$,z.l*$,z.m),u(J,O.xy.x(),O.xy.y(),O.k*$,O.l*$,O.m),u(J,G.xy.x(),G.xy.y(),G.k*$,G.l*$,G.m)}}P._appendTriangle2=h;class S{setTo(z,O,G){this.x=z,this.y=O,this.z=G}squaredDistanceTo(z){let O=this.x-z.x,G=this.y-z.y,L=this.z-z.z;return O*O+G*G+L*L}constructor(){this.x=0,this.y=0,this.z=0}}P.Vector3=S;class f{set(z,O,G,L){this.xy=z,this.k=O,this.l=G,this.m=L}constructor(){this.xy=null,this.k=0,this.l=0,this.m=0}}P.Vector5=f;let y;(G=>(G[G.INITIAL=0]="INITIAL",G[G.SUBDIVIDED_BECAUSE_OF_CROSSING=1]="SUBDIVIDED_BECAUSE_OF_CROSSING",G[G.SUBDIVIDED_BECAUSE_OF_LOOP=2]="SUBDIVIDED_BECAUSE_OF_LOOP"))(y=P.CompileState||(P.CompileState={}));let v;(se=>(se[se.POINT=0]="POINT",se[se.LINE=1]="LINE",se[se.QUADRATIC=2]="QUADRATIC",se[se.CUSP=3]="CUSP",se[se.LOOP=4]="LOOP",se[se.SERPENTINE=5]="SERPENTINE"))(v=P.SegmentClass||(P.SegmentClass={}));let b;(z=>{function J(O){return y[O]}z.CompileState_toString=J})(b=P.in_CompileState||(P.in_CompileState={}));let m;(z=>{function J(O){return v[O]}z.SegmentClass_toString=J})(m=P.in_SegmentClass||(P.in_SegmentClass={})),P._EPSILON=5e-4,P._p=I.new2(),P._p0=I.new2(),P._p1=I.new2(),P._p2=I.new2(),P._p3=I.new2(),P._b0=new S,P._b1=new S,P._b2=new S,P._b3=new S,P._v0=new f,P._v1=new f,P._v2=new f,P._v3=new f,P._v=[P._v0,P._v1,P._v2,P._v3]})(uc||(uc={}));var fo=class{static UNIT_RECT(){return fo._UNIT_RECT!=null||(fo._UNIT_RECT=new fo(Dt.fromRect(new B(0,0,1,1)),"NONZERO")),fo._UNIT_RECT}static getOrCreate(e,t){return fo._uniqueValues.getOrInsertFallback(new fo.PathAndWindingRuleArgs(e,t))}constructor(e,t){this._path=null,this._windingRule=null,this._cachedTriangles=null,this._path=e,this._windingRule=t}equals(e){return e==null?!1:this._windingRule==e._windingRule&&this._path.equals2(e._path)}bounds(){return this._path.bounds()}isRect(){return this._path.isRect()}path(){return this._path}windingRule(){return this._windingRule}triangles(e,t){return this._cachedTriangles==null&&(this._cachedTriangles=this._convertToTriangles(e,t)),this._cachedTriangles}_allTrianglesHaveSameOrientation(e){let t=0;for(let n=0;n<_o.numVertices(e);n=n+3){let r=_o.xyValueAt(e,n),o=_o.xyValueAt(e,n+1),i=_o.xyValueAt(e,n+2),a=I.cross(o.subtract1(r),i.subtract1(r)),s=a<0?-1:a>0?1:0;if(s!=0){if(t==-s)return!1;t=s}}return!0}_convertToTriangles(e,t){let n=[],r=null;if(this._path instanceof to)r=this._path.compileLoopBlinnAndReturnVolatileTriangles();else{fo.TEMP_ARRAY.clear();let c=this._path.toBezierPath();uc.compile(c,fo.TEMP_ARRAY),r=fo.TEMP_ARRAY.bytes()}let o=t.stride()*3,i=C.BufferChunk.BYTE_COUNT,a=i-dt.int_remainder(i,o),s=(r.length+a-1)/a|0;for(let c=0,l=s;c<l;c=c+1){let u=r.subarray(c*a,c*a+a),d=new ar(u),h=e.allocate(t,u);if(h==null)continue;let S=!0;for(let v=0,b=_o.numVertices(d);v<b;v=v+1){let m=_o.kValueAt(d,v),p=_o.lValueAt(d,v),_=_o.mValueAt(d,v);if(m!=.5||p!=.5||_!=.5){S=!1;break}}let f=_o.numVertices(d)==3||this.isRect(),y=S&&this._allTrianglesHaveSameOrientation(d);n.push(new su(h,S,f,y))}return s>1&&console.warn(`splitting ${r.length} byte geometry buffer into ${s} chunks`),n}},xt=fo;xt.TEMP_ARRAY=new ar,xt._UNIT_RECT=null,xt._uniqueValues=new _i(e=>e.hash,(e,t)=>e.equals(t),e=>new fo(e.path,e.windingRule));(e=>{class g{constructor(n,r){this.path=null,this.windingRule=null,this.hash=0,this.path=n,this.windingRule=r,this.hash=Pr.combine(n.hash(),r=="ODD"?1:0)}equals(n){return this.windingRule==n.windingRule&&this.path.equals2(n.path)}}e.PathAndWindingRuleArgs=g})(xt||(xt={}));function Kh(g,e,t){let n=0,r=1,o=2,i=3;if(e==5&&g[4].equals(g[0])&&(e=e-1),e!=4)return!1;let a=.001,s=0,c=0;for(let l=0;l<e;l=l+1){let u=g[l],d=0;if(u.x()<t.left()+a)if(u.y()<t.top()+a)d=n;else if(u.y()>t.bottom()-a)d=o;else return!1;else if(u.x()>t.right()-a)if(u.y()<t.top()+a)d=r;else if(u.y()>t.bottom()-a)d=i;else return!1;else return!1;if(l>0){let h=s^d;if(h!=1&&h!=2)return!1}c|=1<<d,s=d}return c==(1<<n|1<<r|1<<o|1<<i)}var Ui;(e=>{function g(t){return t!="NONE"&&t!="PRESENTATION"}e.hasDevice=g})(Ui||(Ui={}));var ln;(r=>{function g(o){return o=="BOOLEAN_OPERATION"||o=="VECTOR"||o=="STAR"||o=="LINE"||o=="ELLIPSE"||o=="RECTANGLE"||o=="REGULAR_POLYGON"||o=="ROUNDED_RECTANGLE"||o=="TEXT"||o=="STAMP"||o=="WASHI_TAPE"}r.isGeometryLeaf=g;function e(o){return o=="FRAME"||o=="SYMBOL"||o=="INSTANCE"||o=="SECTION"||n(o)||o=="TABLE_CELL"||o=="SLIDE"}r.isFrameLike=e;function t(o){return o=="RECTANGLE"||o=="ROUNDED_RECTANGLE"||o=="ELLIPSE"||o=="STAMP"||e(o)}r.isRectOrEllipseLike=t;function n(o){return o=="STICKY"||o=="SHAPE_WITH_TEXT"||o=="CONNECTOR"||o=="CODE_BLOCK"||o=="MEDIA"||o=="SECTION_OVERLAY"||o=="TABLE"}r.isImmutableFrame=n})(ln||(ln={}));var Id=(t=>(t[t.STATIC_REGION=0]="STATIC_REGION",t[t.DYNAMIC_REGION=1]="DYNAMIC_REGION",t))(Id||{}),lu=class{path(){throw new Error("Not implemented")}bounds(){throw new Error("Not implemented")}geometryEquals(e){throw new Error("Not implemented")}constructor(e,t,n){this.type=e,this.windingRule=t,this.styleID=n}},Hn=class extends lu{constructor(e,t,n,r){super(0,e,t);this._path=null,this._bounds=null,this._path=n,this._bounds=r}path(){return this._path}bounds(){return this._bounds}geometryEquals(e){return e instanceof Hn?e.windingRule==this.windingRule&&e.bounds().equals(this._bounds)&&e.path().equals2(this._path):!1}},Kl=class extends lu{constructor(e,t,n,r){super(1,e,t);this._computePath=null,this._maxBounds=null,this._computePath=n,this._maxBounds=r}path(){return this._computePath()}bounds(){return this._maxBounds}geometryEquals(e){return e==this}},ao=class{constructor(e){this._overrideTable=null,this._overrideTable=e}get(e,t){let n;if(this._overrideTable!=null&&this._overrideTable._in(e)){let r=this._overrideTable.styleByID1(e),o=r!=null?Io.get(r,89,null):null,i=null;if(o!=null&&(i=t.findStyle(Z.asStyleId(o))),i==null){let s=(n=r!=null?Io.get(r,51,null):null)!=null?Z.asGUID(n):null;i=t.findNode1(s)}if(i!=null)return i.fillPaints();let a=r!=null?Io.get(r,58,null):null;if(a!=null)return Z.asPaintList(a)}return null}forEachPaint(e,t){let n;(n=this._overrideTable)!=null&&n.forEachFillPaint(e,t)}table(){return this._overrideTable}},Dn=class{geometryEquals(e){return ie.List_equalsWithComparison(this.regions,e.regions,(t,n)=>t.geometryEquals(n))}isRect(){return this.regions.length==1?xt.getOrCreate(this.regions[0].path(),this.regions[0].windingRule).isRect():!1}toString(){return`Geometry(bounds: ${this.bounds} with ${this.regions.length} regions)`}constructor(e,t,n,r){this.regions=e,this.styleIDs=t,this.bounds=n,this.paintOverrides=r}},cu=class extends Dn{constructor(e,t,n,r,o){super(e,t,n,r);this.emojiCodepoints=o}},wt=class{static equals(e,t){if(e!=null&&t!=null&&e.guids.length==t.guids.length){for(let n=0,r=e.guids.length;n<r;n=n+1)if(!R.equals(e.guids[n],t.guids[n]))return!1;return!0}return e==t}static equalsGUID(e,t){return e!=null&&t!=null&&e.guids.length==1?R.equals(e.guids[0],t):e==null&&t==null}toString(){return`[${this.guids.map(e=>R.toString(e)).join(", ")}]`}startsWith(e){if(this.guids==null)return e.guids==null;if(this.guids.length<e.guids.length)return!1;for(let t=0,n=e.guids.length;t<n;t=t+1)if(!R.equals(e.guids[t],this.guids[t]))return!1;return!0}slice1(e){return this.slice2(e,this.guids.length)}slice2(e,t){return new wt(this.guids.slice(e,t))}cloneAndAppend(e){let t=this.guids.slice();return ie.List_append2(t,e.guids),new wt(t)}static fromString(e){if(e!=null&&e.length>=2&&e.startsWith("[")&&e.endsWith("]")){let t=e.slice(1,e.length-1).split(","),n=[];for(let r of t){let o=R.fromString(r.trim());if(o==null)return null;n.push(o)}return new wt(n)}return null}constructor(e){this.guids=e}},go;(r=>{function g(o){return o}r.map=g;function e(o){let i=[];return o.each((a,s)=>{i.push(`
  `+a.toString()+": "+_n.toString(s))}),i.join(", ")}r.toString=e;function t(){return new Ao(o=>o.toString())}r._new=t;function n(o,i){let a=new Ao(s=>s.toString());for(let s=0,c=o.length;s<c;s=s+1)a.set(o[s],i[s]);return a}r.new1=n})(go||(go={}));var ti=class{toString(){return`SymbolData(id=${R.toString(this.masterID)}, overrides=[${go.toString(this.instanceOverrides)}])`}constructor(e,t){this.masterID=e,this.instanceOverrides=t}},ps=class{constructor(e,t){this.value=e,this.units=t}},hs=class{constructor(e,t,n){this.family=e,this.style=t,this.postscript=n}},Xs=class{constructor(e,t){this.type=e,this.value=t}},du=class{constructor(e,t,n,r){this.suffix=e,this.imageType=t,this.constraint=n,this.contentsOnly=r}},so=class{static DEFAULT_FOR_TESTS(){return new so("DEFAULT_FLOW_FOR_TESTS","default flow for tests",sn.FIRST_POSITION)}constructor(e,t,n){this.name=e,this.description=t,this.position=n}},uu=class{size(){switch(this.rotation){case"NONE":return this.nonRotatedSize;case"CCW_90":return this.nonRotatedSize.flipped()}return this.nonRotatedSize}canvasSpaceImageSize(e){let t=e.nonRotatedImageSize.divide(e.scaleFactor);switch(this.rotation){case"NONE":return t;case"CCW_90":return t.flipped()}return t}canvasSpaceTopLeftOffset(e){let t=e.nonRotatedOffset,n=e.nonRotatedImageSize.divide(e.scaleFactor),r=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return t;case"CCW_90":return new I(t.y(),n.x()-r.x()-t.x())}return t}canvasSpaceFramePresetSize(e){let t=e.nonRotatedFramePresetSize;switch(this.rotation){case"NONE":return t;case"CCW_90":return t.flipped()}return t}os(){return this.presetIdentifier==null||this.presetIdentifier==""?0:this.presetIdentifier.indexOf("APPLE")!=-1?this.presetIdentifier.indexOf("MACBOOK")!=-1?4:2:this.presetIdentifier.indexOf("GOOGLE")!=-1?1:this.presetIdentifier.indexOf("MICROSOFT")!=-1?5:(console.error(`${this.presetIdentifier} OS could not be inferred`),0)}toString(){return`PrototypeDevice(${this.type}, ${this.size()}, ${this.presetIdentifier}, ${this.rotation})`}toJSON(){return{type:this.type,size:{x:this.size().x(),y:this.size().y()},presetIdentifier:this.presetIdentifier,rotation:this.rotation}}constructor(e,t,n,r){this.type=e,this.nonRotatedSize=t,this.presetIdentifier=n,this.rotation=r}},Xn=uu;Xn.DEFAULT=new uu("NONE",new I(0,0),null,"NONE");var vo=class{constructor(){if(arguments.length==0)this.backgroundType="NONE",this.backgroundColor=E.new3(0,0,0,.25);else if(arguments.length==2){let e=arguments[0],t=arguments[1];this.backgroundType="NONE",this.backgroundColor=E.new3(0,0,0,.25),this.backgroundType=e,this.backgroundColor=t}}},Yn=class{constructor(){if(arguments.length==0)this._styleByID=null,this._styleByID=new Map;else if(arguments.length==1){let e=arguments[0];this._styleByID=null,this._styleByID=e}}_in(e){return this._styleByID.has(e)}styleByID1(e){return this._styleByID.get(e)}forEachStyle(e){for(let t of Array.from(this._styleByID.keys()))e(t,this._styleByID.get(t))}styleByID2(){return this._styleByID}forEachFillPaint(e,t){this.forEachStyle((n,r)=>{let o,i,a=Io.get(r,89,null),s=null;if(a!=null&&(s=e.findStyle(Z.asStyleId(a))),s==null){let c=(i=Io.get(r,51,null))!=null?Z.asGUID(i):null;s=e.findNode1(c)}if(s!=null){let c=s.fillPaints();c!=null&&t(c)}else if(Io._in(r,58)){let c=(o=Io.get(r,58,null))!=null?Z.asPaintList(o):null;c!=null&&t(c)}})}};var us=(t=>(t[t.ONE_FONT_SIZE=0]="ONE_FONT_SIZE",t[t.MULTIPLE_FONT_SIZES=1]="MULTIPLE_FONT_SIZES",t))(us||{}),Yl=class{constructor(e,t,n){this.exitingTransitionRoot=e,this.swappedStablePath=t,this.hotspotInExitingTree=n}},qm;(e=>{function g(t){return Id[t]}e.RegionType_toString=g})(qm||(qm={}));var Ym;(e=>{function g(t){return us[t]}e.NumFontSizes_toString=g})(Ym||(Ym={}));function Ua(g){return!g.has(83)||g.prototypeStartingPoint()==null?!1:g.prototypeStartingPoint().name!=""||g.prototypeStartingPoint().description!=""||g.prototypeStartingPoint().position!=null&&sn.isValid(g.prototypeStartingPoint().position)}var Jt=class{constructor(){if(arguments.length==1){let e=arguments[0];this.node=null,this._overlayRenderData=null,this.node=e}else if(arguments.length==2){let e=arguments[0],t=arguments[1];this.node=null,this._overlayRenderData=null,this.node=e,this._overlayRenderData=t}}clone(){return new Jt(this.node,this.overlayRenderData())}setNode(e){this.node=e}moveToChildAt(e){this.node=this.node.childAt2(e,!0)}moveToParent(){this.node=this.node.parent()}isRoot(){return this.node.parent()==null}indexInParent(){return this.node.indexInParent()}renderableContentType(){switch(this.node.type()){case"NONE":case"DOCUMENT":case"SLICE":return Tn.RenderableContentType.NON_RENDERABLE;case"CANVAS":case"GROUP":case"FRAME":case"SYMBOL":case"INSTANCE":case"STICKY":case"CODE_BLOCK":case"MEDIA":case"SECTION_OVERLAY":case"WIDGET":case"SHAPE_WITH_TEXT":case"CONNECTOR":case"SECTION":case"TABLE":case"TABLE_CELL":case"SLIDE":return Tn.RenderableContentType.RENDERABLE_GROUP;case"BOOLEAN_OPERATION":case"ELLIPSE":case"LINE":case"RECTANGLE":case"REGULAR_POLYGON":case"ROUNDED_RECTANGLE":case"STAR":case"VECTOR":case"HIGHLIGHT":case"STAMP":case"WASHI_TAPE":return Tn.RenderableContentType.RENDERABLE_GEOMETRY;case"TEXT":return Tn.RenderableContentType.RENDERABLE_TEXT}return ze("Unhandled scene node type while getting cursor renderable content type"),Tn.RenderableContentType.NON_RENDERABLE}isFrameLike(){return ln.isFrameLike(this.type())}isTopLevel(){return this.node.isTopLevel()}willChange(){return 0}shouldOptimizeShadowForAnimation(e){return!1}paintsDebugString(){return`SceneCursor ${this.node.paintsDebugString()}`}customRenderTree(e){return null}name(){return this.node.name()}scene(){return this.node.scene()}parent(){return this.node.parent()!=null?new Jt(this.node.parent()):null}blendMode(){return this.node.blendMode()}opacity(){return this.node.opacity()}visible(){return this.node.visible()}isVisibleMask(){return this.node.visible()&&this.node.isMask()}maskType(){return this.node.maskType()}isSpreadEligibleNode(){return this.node.isSpreadEligibleNode()}type(){return this.node.type()}childCount(){return this.node.childCount()}absoluteTransform(){return this.node!=null?this.node.absoluteTransform():Nt.FrozenAffineTransform_IDENTITY}maxTransformScale(){return 1}clipsChildren(){return this.node.clipsToBoundingRectangle()}stopsMaskPropagation(){return this.node.isMask()||this.node.clipsToBoundingRectangle()}arcData(){return this.node.arcData()}roundedRectInfo(){return this.node.roundedRectInfo()}fillGeometry(){return this.node.fillGeometry()}strokeGeometry(){return this.node.strokeGeometry()}fillGeometryForSpread(e,t,n){return this.node.fillGeometryForSpread(e,t,n)}strokeGeometryForSpread(e,t,n,r){return this.node.strokeGeometryForSpread(e,t,n,r)}size(){return this.node.size()}strokeAlign(){return this.node.strokeAlign()}strokeWeight(){return this.node.strokeWeight()}id(){return this.node.id()}uniqueIdentifier(){return R.toString(this.node.id())}isInsideOutlineMask(){return this.node.isInsideOutlineMask()}textData(){return this.node.textData()}textGeometry(){return this.node.textGeometry()}getCachedRenderTree(){return this.node.getCachedRenderTree()}renderTree(){return this.node.renderTree1()}renderTreeWithoutBackgroundBlurs(){return this.node.renderTreeWithoutBackgroundBlurs()}renderTreeForShadowRoot(){return this.node.renderTreeForShadowRoot1()}renderTreeForShadowDescendant(){return this.node.renderTreeForShadowDescendant1()}renderTreeForKnockoutShadowRoot(){return this.node.renderTreeForKnockoutShadowRoot1()}renderTreeForKnockoutShadowDescendant(){return this.node.renderTreeForKnockoutShadowDescendant1()}isFixed(){return this.node.isFixed()}isStandardScrolling(){return this.node.isStandardScrolling()}isStickyScrolling(){return this.node.isStickyScrolling()}scrollOffset(){return this.node.scrollOffset()}scrollDirection(){return this.node.scrollDirection()}hasOverflowingContentInScrollDirection(){return this.node.hasOverflowingContentInScrollDirection()}effects(){return this.node.effects()}fillPaints(){return this.node.fillPaints()}strokePaints(){return this.node.strokePaints()}fillPaintsToRender(){return this.node.fillPaintsToRender()}videoPlayback(){return this.node.videoPlayback()}containerSupportsFillStrokeAndCorners(){return this.node.containerSupportsFillStrokeAndCorners()}isGroup(){return this.node.isGroup()}hasNonZeroStrokeWeight(){return this.node.hasNonZeroStrokeWeight()}hasPerRegionFillPaints(){return this.node.hasPerRegionFillPaints()}forEachRegionWithFillPaintBatch(e){this.node.forEachRegionWithFillPaintBatch(e)}overrideKey(){return this.node.overrideKey()}getSemanticNodePath(){return An.getSemanticNodePathHelper(this)}hasBackgroundBlurs(){return this.node.hasBackgroundBlurs()}overlayRenderData(){return this._overlayRenderData}};var pc=class{uninit(){this._semanticScrollStorage.uninitialize1()}getValueFromStorage(e){let t=new Jt(e),n=An.getSemanticNodePath(t);return this._semanticScrollStorage.getData(n,An.DEFAULT_STORAGE_KEY)}setValueInStorage(e,t){let n=new Jt(e),r=An.getSemanticNodePath(n);this._semanticScrollStorage.insert(r,An.DEFAULT_STORAGE_KEY,t)}_getOldNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode1(e.oldStateId()):this._appState.scene().findNode3(e.stablePath)}_getNewNode(e){return e.stablePath.guids.length==0?this._appState.scene().findNode1(e.newStateId()):this._appState.scene().findNode3(e.stablePath)}commitCurrentScrollStateToStorage(e){let t=this._getOldNode(e);this._recursivelyRecordOffsets(t);for(let n=0,r=e.oldStateAndOverlays.overlays.length;n<r;n=n+1){let o=e.oldStateAndOverlays.overlays[n].id,i=this._appState.scene().findNode1(o);this._recursivelyRecordOffsets(i)}}applyStoredScrollStateToScene(e){let t=this._getNewNode(e);this._recursivelySetOffsets(t);for(let n=0,r=e.newStateAndOverlays.overlays.length;n<r;n=n+1){let o=e.newStateAndOverlays.overlays[n].id,i=this._appState.scene().findNode1(o);this._recursivelySetOffsets(i)}}resetScrollStateToScene(e){let t=this._getNewNode(e);this._recursivelyResetOffsets(t);for(let n=0,r=e.newStateAndOverlays.overlays.length;n<r;n=n+1){let o=e.newStateAndOverlays.overlays[n].id,i=this._appState.scene().findNode1(o);this._recursivelyResetOffsets(i)}}_recursivelyRecordOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&this.setValueInStorage(e,e.scrollOffset()),e.forEachChild(t=>{this._recursivelyRecordOffsets(t)}))}_recursivelySetOffsets(e){if(e!=null){if(e.scrollDirection()!="NONE"){let t=this.getValueFromStorage(e);t!=null?t.equals(e.scrollOffset())||(Je.trackDefinedEvent("prototype.viewer_scroll_state_transferred",new Map),e.setScrollOffset(this._canvasView.restrictScrollDeltaAxes(e,t))):e.setScrollOffset(ye.FrozenVector_ZERO)}e.forEachChild(t=>{this._recursivelySetOffsets(t)})}}_recursivelyResetOffsets(e){e!=null&&(e.scrollDirection()!="NONE"&&(Je.trackDefinedEvent("prototype.viewer_scroll_state_reset",new Map),e.setScrollOffset(ye.FrozenVector_ZERO),this.setValueInStorage(e,ye.FrozenVector_ZERO)),e.forEachChild(t=>{this._recursivelyResetOffsets(t)}))}toString(){return this._semanticScrollStorage.toString2(e=>e.toString())}constructor(e,t){this._canvasView=e,this._appState=t,this._semanticScrollStorage=new ra}};var js=class{constructor(){if(arguments.length==2){let e=arguments[0],t=arguments[1];this._pos=0,this._velocity=0,this._vSign=0,this._duration=0,this._distance=0,this._friction=.015,this._initialVelocityPenetration=3.065,this._decelerationRate=Math.log(.78)/Math.log(.9),this._pos=e,this._velocity=t,this._vSign=Math.abs(this._velocity)/this._velocity|0,this._duration=this._flingDuration(t),this._distance=Math.abs(t*this._duration/this._initialVelocityPenetration)}else if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this._pos=0,this._velocity=0,this._vSign=0,this._duration=0,this._distance=0,this._friction=.015,this._initialVelocityPenetration=3.065,this._decelerationRate=Math.log(.78)/Math.log(.9),this._pos=e,this._velocity=t,this._vSign=Math.abs(this._velocity)/this._velocity|0,this._duration=n,this._distance=Math.abs(t*this._duration/this._initialVelocityPenetration)}}duration(){return this._duration}pos(e){if(this._duration==0)return this._pos;let t=Pe.Math_clamp1(e/this._duration,0,1);return this._pos+this._distance*this._flingDistancePenetration(t)*this._vSign}dPos(e){if(this._duration==0)return this._velocity;let t=Pe.Math_clamp1(e/this._duration,0,1);return this._distance*this._flingVelocityPenetration(t)*this._vSign/this._duration}isDone(e){return e>=this._duration}endPos(){return this._pos+this._distance}_decelerationForFriction(e){return e*61774.04968}_flingDuration(e){let t=this._friction*this._decelerationForFriction(.84),n=Math.log(.35*Math.abs(e)/t);return Math.exp(n/(this._decelerationRate-1))}_flingDistancePenetration(e){return 1.2*e*e*e-3.27*e*e+this._initialVelocityPenetration*e}_flingVelocityPenetration(e){return 3.6*e*e-6.54*e+this._initialVelocityPenetration}},hc=class{constructor(){if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._drag=0,this._dragLog=0,this._p=0,this._v=0,this._tolerance=null,this._drag=e,this._dragLog=Math.log(e),this._p=t,this._v=n,this._tolerance=r}else if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this._drag=0,this._dragLog=0,this._p=0,this._v=0,this._tolerance=null,this._drag=e,this._dragLog=Math.log(e),this._p=t,this._v=n,this._tolerance=jc()}}pos(e){return this._p+this._v*Math.pow(this._drag,e)/this._dragLog-this._v/this._dragLog}dPos(e){return this._v*Math.pow(this._drag,e)}endPos(){return this._p-this._v/this._dragLog}timeAtPos(e){if(e==this._p)return 0;let t=this.endPos();return this._v==0||(this._v>0?e<this._p||e>t:e>this._p||e<t)?Pe.Math_INFINITY():Math.log(this._dragLog*(e-this._p)/this._v+1)/this._dragLog}isDone(e){return Math.abs(this.dPos(e))<this._tolerance.velocity}},Ca=class{constructor(){if(arguments.length==5){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3],o=arguments[4];this._r1=0,this._r2=0,this._c1=0,this._c2=0,this._end=0,this._tolerance=null;let i=t-n,a=e.damping*e.damping-4*e.mass*e.stiffness;this._r1=(-e.damping-Math.sqrt(a))/(2*e.mass),this._r2=(-e.damping+Math.sqrt(a))/(2*e.mass),this._c2=(-(i*this._r1)+r)/(this._r2-this._r1),this._c1=i-this._c2,this._end=n,this._tolerance=o}else if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._r1=0,this._r2=0,this._c1=0,this._c2=0,this._end=0,this._tolerance=null;let o=t-n,i=e.damping*e.damping-4*e.mass*e.stiffness;this._r1=(-e.damping-Math.sqrt(i))/(2*e.mass),this._r2=(-e.damping+Math.sqrt(i))/(2*e.mass),this._c2=(-(o*this._r1)+r)/(this._r2-this._r1),this._c1=o-this._c2,this._end=n,this._tolerance=jc()}}endPos(){return this._end}pos(e){return this._end+this._c1*Math.pow(Pe.Math_E(),this._r1*e)+this._c2*Math.pow(Pe.Math_E(),this._r2*e)}dPos(e){return this._c1*this._r1*Math.pow(Pe.Math_E(),this._r1*e)+this._c2*this._r2*Math.pow(Pe.Math_E(),this._r2*e)}isDone(e){return Math.abs(this.pos(e)-this._end)<=this._tolerance.distance&&Math.abs(this.dPos(e))<=this._tolerance.velocity}},os=class{pos(e){return this._c}dPos(e){return 0}isDone(e){return!0}endPos(){return this._c}constructor(e){this._c=e}};var mc=class{applyOverscrollBehavior(e,t,n,r){let o=e.subtract1(n),a=e.subtract1(t).divide1(r).makeAbs(),s=this._frictionFactor2(a);return n.add1(s.multiply1(o))}_frictionFactor1(e){return e==0?1:.52*Math.pow(1-e,2)}_frictionFactor2(e){return new I(this._frictionFactor1(e.x()),this._frictionFactor1(e.y()))}createBallisticScrollSimulation(e,t,n,r,o,i){return new Js(e,t,n,r,o,i)}constructor(){}},Js=class extends ia{constructor(e,t,n,r,o,i){super();this._xSim=null,this._ySim=null;let a=Ga.DEFAULT_SPRING;this._xSim=new pu(e.x(),t.x(),n,r,a),this._ySim=new pu(e.y(),t.y(),o,i,a)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}isOverscrolled(){return this._xSimulation().typeAt(this.elapsed())==1||this._ySimulation().typeAt(this.elapsed())==1}},pu=class{constructor(e,t,n,r,o){if(this._frictionSimulationIOS=null,this._springSimulation=null,this._fixedSolution=null,this._startTime=0,this._springTime=0,this._timeOffset=0,e<n)this._springSimulation=new Ca(o,e,n,t),this._springTime=-Pe.Math_INFINITY();else if(e>r)this._springSimulation=new Ca(o,e,r,t),this._springTime=-Pe.Math_INFINITY();else if(t==0)this._fixedSolution=new os(e);else{this._frictionSimulationIOS=new hc(r_,e,t);let i=this._frictionSimulationIOS.endPos();t>0&&i>r?(this._springTime=this._frictionSimulationIOS.timeAtPos(r),this._springSimulation=new Ca(o,r,r,Math.min(this._frictionSimulationIOS.dPos(this._springTime),Xm))):t<0&&i<n?(this._springTime=this._frictionSimulationIOS.timeAtPos(n),this._springSimulation=new Ca(o,n,n,Math.min(this._frictionSimulationIOS.dPos(this._springTime),Xm))):this._springTime=Pe.Math_INFINITY()}}_simulation(e){return this._fixedSolution!=null?this._fixedSolution:e>this._springTime?(this._timeOffset=isFinite(this._springTime)?this._springTime:0,this._springSimulation):(this._timeOffset=0,this._frictionSimulationIOS)}typeAt(e){return this._fixedSolution!=null?2:e<=this._springTime?0:1}endPos(){return this._fixedSolution!=null?this._fixedSolution.pos(0):isFinite(this._springTime)||this._springTime<0?this._springSimulation.endPos():this._frictionSimulationIOS.endPos()}pos(e){return this._simulation(e).pos(e-this._timeOffset)}dPos(e){return this._simulation(e).dPos(e-this._timeOffset)}isDone(e){return this._simulation(e).isDone(e-this._timeOffset)}},Xm=5e3,r_=.135;var gc=class{constructor(e,t,n){this.startLocation=null,this.startTime=0,this.endLocation=null,this.endTime=0,this.type=0,this.startLocation=e,this.startTime=t,this.endLocation=e,this.endTime=t,this.type=n}isTap(){return(this.endLocation==null||this.startLocation.distanceTo(this.endLocation)<i_)&&this.endTime-this.startTime<o_}},jm=5,Jm=.2,o_=.4,i_=50,Zm=.1;var _c=(t=>(t[t.CURSOR=0]="CURSOR",t[t.USER_ACTION=1]="USER_ACTION",t))(_c||{}),Qm;(e=>{function g(t){return _c[t]}e.HitTestPurpose_toString=g})(Qm||(Qm={}));var fc=class{createBallisticScrollSimulation(e,t,n,r,o,i){return new eg(e,t,n,r,o,i)}applyOverscrollBehavior(e,t,n,r){return t}constructor(){}},eg=class extends ia{constructor(e,t,n,r,o,i){super();if(this._xSim=null,this._ySim=null,Math.abs(t.x())>Math.abs(t.y())){this._xSim=new Zs(e.x(),t.x(),n,r);let a=Math.abs(t.y())>=$m?t.y():0;this._ySim=new Zs(e.y(),a,o,i,this._xSimulation().duration())}else{this._ySim=new Zs(e.y(),t.y(),o,i);let a=Math.abs(t.x())>=$m?t.x():0;this._xSim=new Zs(e.x(),a,n,r,this._ySimulation().duration())}}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},Zs=class{constructor(){if(arguments.length==4){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._startTime=0,this._simulation=null,this._min=0,this._max=0,this._duration=-Pe.Math_INFINITY(),this._min=n,this._max=r,t==0?this._simulation=new os(e):(this._simulation=new js(e,t),this._duration=this._simulation.duration()),this._startTime=We.seconds()}else if(arguments.length==5){let e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3],o=arguments[4];this._startTime=0,this._simulation=null,this._min=0,this._max=0,this._duration=-Pe.Math_INFINITY(),this._min=n,this._max=r,t==0?this._simulation=new os(e):this._simulation=new js(e,t,o),this._startTime=We.seconds()}}duration(){return this._duration}pos(e){let t=this._simulation.pos(e);return t<=this._min?this._min:t>=this._max?this._max:t}dPos(e){return this._simulation.dPos(e)}endPos(){return this._simulation.endPos()}isDone(e){if(this._simulation.isDone(e))return!0;let t=this.pos(e);return t>=this._max||t<=this._min}elapsed(){return We.seconds()-this._startTime}typeAt(e){return 0}},$m=50;var Sc=class extends ia{constructor(e,t,n,r){super();this._xSim=null,this._ySim=null,this._xSim=new hu(e.x(),t.x(),n,r),this._ySim=new hu(e.y(),t.y(),n,r)}_xSimulation(){return this._xSim}_ySimulation(){return this._ySim}},hu=class{constructor(e,t,n,r){this._begin=0,this._end=0,this._duration=0,this._curve=null,this._begin=e,this._end=t,this._duration=n,this._curve=r}pos(e){let t=Pe.Math_clamp1(e/this._duration,0,1);return t==0?this._begin:t==1?this._end:this._begin+(this._end-this._begin)*this._curve.get(t)}dPos(e){let t=.001;return(this.pos(e+t)-this.pos(e-t))/(2*t)}endPos(){return this._end}isDone(e){return e>this._duration}typeAt(e){return 3}};var Pi;(y=>{function g(v){y._mockEmbedListener=v}y.setMockListener=g;function e(v,b,m){m.addObserver(new u(b,m)),y._prototypeObserver=new d(b),b.prototypeState().addObserver(y._prototypeObserver),b.prototypeState().addHsmObserver(y._prototypeObserver),v.on("sceneDidCompleteInitialLoad",_=>{b.scene().addObserver(y._prototypeObserver),n(l.INITIAL_LOAD,{})}),v.on("requestClose",_=>{n(l.REQUEST_CLOSE,{})});let p=window;p!==null&&p.addEventListener("message",_=>{let T=_.data;if(T){let N=T.type,k=T.data;t(b,m,N,k)}})}y.init=e;function t(v,b,m,p){var k,j,te;let _,T,N;switch(m){case"NAVIGATE_TO_FRAME_AND_CLOSE_OVERLAYS":{let Y=R.fromString(p.nodeId),_e=R.fromString(p.startingPointNodeId);Q.isInlinePreview()&&(v.prototypeState().resetPrototype(),b.handleRestartPrototype(),v.videoManager().handleRestartPrototype()),Q.isInlinePreview()&&Y==null?v.prototypeState().navigateToFrameAndCloseOverlays2(Y,_e):R.isValid(Y)?((k=v.scene())==null?void 0:k.findNode1(Y))!=null?v.prototypeState().navigateToFrameAndCloseOverlays2(Y,_e):y._prototypeObserver.setPendingNodeId(Y):console.error(`Expected node id; got '${p.nodeId}' instead`);break}case"NAVIGATE_BACKWARD":{b.navigateBackward(18);break}case"NAVIGATE_FORWARD":{b.navigateForward(19);break}case"CHANGE_COMPONENT_STATE":{let Y=(j=v.scene())==null?void 0:j.findNodeFromDeveloperFriendlyId(p.nodeId),_e=(te=v.scene())==null?void 0:te.findNodeFromDeveloperFriendlyId(p.newVariantId);if(Y==null){console.error(`Could not find node from specified node id '${p.nodeId}'`);return}_e==null&&console.error(`Could not find variant for CHANGE_COMPONENT_STATE from id '${p.newVariantId}'`),v.prototypeState().swapInstanceToState2(Y.stablePath(),_e.id(),null,0,null,1,null);break}case"RESTART":{v.prototypeState().restartPrototype(1);break}default:break}}y._receiveFromHost=t;function n(v,b){let m=Me.StringMap_toJSObject(new Map([["type",l[v]],["data",b]]));if(y._mockEmbedListener!=null){y._mockEmbedListener(m);return}let p=window;p===null||p.parent===null||p.parent.postMessage===void 0||p.parent.postMessage(m,"*")}y._sendToHost=n;function r(v,b){for(let m=v.childCount()-1;m>=0;m=m-1)r(v.childAt2(m,!0),b);b(v)}y._forEachNodeInHitTestOrder=r;function o(v,b){let m=null,p=null;return r(v,_=>{if(m!=null)return;let T=_.canvasSpaceScrolledInteractiveBounds(0);if(_.isVisibleInCanvas()&&T.contains2(b)){m=_;let N=_.canvasSpaceScrolledInteractiveBounds(1);p=b.subtract1(N.topLeft())}}),m==null?null:new c(m,p)}y.findClickInfoForUnhandledMouseRelease=o;function i(v,b,m){if(b.node==null){ze("Hotspot node is null");return}let p=v.baseScreenNode();if(p==null)return;let _=v.prototypeState().getTopmostOverlayNode(),T=_!=null?_:p,N=m;_!=null&&(N=v.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(p,m));let k=N.subtract1(b.node.canvasSpaceScrolledInteractiveBounds(1).topLeft()),j={};j.handled=!0,j.presentedNodeId=T.developerFriendlyId(),j.targetNodeId=b.node.developerFriendlyId(),j.targetNodeMousePosition=k.toJSON();let te=b.node.findContainingScrollingFrameOrSelf();if(te!=null){let Y=te.canvasSpaceScrolledInteractiveBounds(1),_e=N.subtract1(Y.topLeft());j.nearestScrollingFrameId=te.developerFriendlyId(),j.nearestScrollingFrameMousePosition=_e.toJSON(),j.nearestScrollingFrameOffset=te.scrollOffset().toJSON()}else j.nearestScrollingFrameId=null,j.nearestScrollingFrameMousePosition=null,j.nearestScrollingFrameOffset=null;n(l.MOUSE_PRESS_OR_RELEASE,j)}y.willTriggerClickLikeHotspot=i;function a(v,b){let m=v.baseScreenNode();if(m==null)return;let p=v.prototypeState().getTopmostOverlayNode(),_=b;p!=null&&(_=v.prototypeState().getTopmostOverlay().baseTlfSpaceToOverlaySpace1(m,b));let T=p!=null?p:m,N=o(T,_),k={};k.handled=!1,k.presentedNodeId=T.developerFriendlyId(),k.targetNodeId=N!=null?N.node.developerFriendlyId():null,k.targetNodeMousePosition=N!=null?N.nodeSpacePoint.toJSON():null;let j=N!=null?N.node.findContainingScrollingFrameOrSelf():null;if(j!=null){let te=j.canvasSpaceScrolledInteractiveBounds(1),Y=_.subtract1(te.topLeft());k.nearestScrollingFrameId=j.developerFriendlyId(),k.nearestScrollingFrameMousePosition=Y.toJSON(),k.nearestScrollingFrameOffset=j.scrollOffset().toJSON()}else k.nearestScrollingFrameId=null,k.nearestScrollingFrameMousePosition=null,k.nearestScrollingFrameOffset=null;n(l.MOUSE_PRESS_OR_RELEASE,k)}y.notifyUnhandledMouseRelease=a;function s(){n(l.VARIABLE_UPDATED,{})}y.notifyVariableUpdated=s;class c{constructor(b,m){this.node=b,this.nodeSpacePoint=m}}y.ClickedLayer=c;let l;(N=>(N[N.INITIAL_LOAD=0]="INITIAL_LOAD",N[N.MOUSE_PRESS_OR_RELEASE=1]="MOUSE_PRESS_OR_RELEASE",N[N.PRESENTED_NODE_CHANGED=2]="PRESENTED_NODE_CHANGED",N[N.NEW_STATE=3]="NEW_STATE",N[N.VARIABLE_UPDATED=4]="VARIABLE_UPDATED",N[N.REQUEST_CLOSE=5]="REQUEST_CLOSE"))(l=y.MessageType||(y.MessageType={}));class u{willTriggerHotspot(b,m,p,_){let T=p==4||p==8||p==9||p==3;if(_!=null&&T){let N=this._canvasView.viewport().viewSpaceToCanvasSpace1().transformPoint(_.clone());i(this._appState,b,N)}}didScrollNode(b){}constructor(b,m){this._appState=b,this._canvasView=m}}y.EmbedCanvasViewObserver=u;class d{constructor(b){this.appState=null,this._pendingNodeId=null,this.appState=b}setPendingNodeId(b){this._pendingNodeId=b}handleSceneGraphEvent(b){var p;let m;this._pendingNodeId!=null&&((p=this.appState.scene())==null?void 0:p.findNode1(this._pendingNodeId))!=null&&(this.appState.prototypeState().navigateToFrameAndCloseOverlays1(this._pendingNodeId),this._pendingNodeId=null)}handlePresentedNodeChanged(b){if(b==null)return;let m=this.appState.baseScreenNode();if(!Q.isInlinePreview()&&m==null)return;let p=this.appState.prototypeState().getTopmostOverlayNode(),_=p!=null?p:m,T={};T.presentedNodeId=_==null?void 0:_.developerFriendlyId(),T.isStoredInHistory=!qt.TransitionAction_isTransientAction(b.cause);let N={};this.appState.prototypeState().getOnscreenStates().forEach(k=>{let j=k.a,te=k.b,Y=this.appState.scene().findNode3(j);Y!=null&&(N[Y.developerFriendlyId()]=R.toString(te))}),T.stateMappings=N,n(2,T)}handleInteractiveComponentStateChange(b,m){if(m==null)return;let p=this.appState.scene().findNode3(b);if(p==null)return;let _={};_.nodeId=p.developerFriendlyId(),_.currentVariantId=R.toString(m.oldStateId()),_.newVariantId=R.toString(m.newStateId()),_.isStoredInHistory=!qt.TransitionAction_isTransientAction(m.cause),_.isTimedChange=m.cause==1,n(3,_)}handleStateChangeAborted(b){this.handlePresentedNodeChanged(b)}handleStateChangeCommitted(b,m){}handleStateChangeInitiated(b){this.handlePresentedNodeChanged(b)}handleStateChangeRequested(b){}handleFitModeChange(b,m){}handleRestartPrototype(){}handleHsmAborted(b,m){this.handleInteractiveComponentStateChange(b,m)}handleHsmCommitted(b,m,p){}handleHsmInitiated(b,m){this.handleInteractiveComponentStateChange(b,m)}handleHsmRequested(b,m){}}y.EmbedPrototypeObserver=d;let h;(b=>{function v(m){return l[m]}b.MessageType_toString=v})(h=y.in_MessageType||(y.in_MessageType={})),y._mockEmbedListener=null,y._prototypeObserver=null})(Pi||(Pi={}));var mu=class{constructor(e,t){this._didFinishZooming=null,this._drawIdleCount=0,this._userIdleCount=0,this._isFirstFrame=!1,this._justInteracted=!1,this._zoomInProgress=!1,this._previousZoomScale=1,this._previousRenderStatus=1,this._emitter=null,this._didFinishZooming=e,this._emitter=t}handleSceneChange(){this._isFirstFrame=!0}updateZoomScaleNow(e){this._previousZoomScale=e,this._didFinishZooming(this._previousZoomScale)}handleInteraction(){this._justInteracted=!0}justInteracted(){return this._justInteracted}advanceFrame(e){e.isInvalid()||this._justInteracted?(this._userIdleCount=0,this._drawIdleCount=0):this._userIdleCount=this._userIdleCount+1,this._previousRenderStatus==0?this._drawIdleCount=0:this._drawIdleCount=this._drawIdleCount+1,this._isFirstFrame&&(this._userIdleCount=0,this._isFirstFrame=!1,this.updateZoomScaleNow(e.zoomScale()));let t=this._zoomInProgress;this._zoomInProgress=this._previousZoomScale!=e.zoomScale(),this._zoomInProgress&&!t&&this._emitter.trigger("zoomStart",null);let n=this._userIdleCount>=2;this._zoomInProgress&&n&&this.updateZoomScaleNow(e.zoomScale()),!this._zoomInProgress&&t&&this._emitter.trigger("zoomStop",null),this._justInteracted=!1}renderingIsComplete(){return this._drawIdleCount>0&&this._userIdleCount>0&&!this._justInteracted}shouldRenderOptionalTiles(){let e=6;if(tt.OS_isMobile(tt.OS_current())||tt.OS_current()==4&&navigator.maxTouchPoints>0||At.forceMobileOptimizations()){let t=60*2;return this._userIdleCount>e&&this._drawIdleCount<t}else return this._userIdleCount>e}zoomInProgress(){return this._zoomInProgress}previousZoomScale(){return this._previousZoomScale}setPreviousRenderStatus(e){this._previousRenderStatus=e}};var bc=class{delayedHotspotId(){return this._delayedHotspotId}interaction(){return this._interaction}action(){return this._action}counter(){return this._counter}reset(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=this._counter+1}set(e,t,n){this._delayedHotspotId=e,this._interaction=t,this._action=n,this._counter=this._counter+1}constructor(){this._delayedHotspotId=null,this._interaction="ON_CLICK",this._action=0,this._counter=0}},gu=class{resetEntry(e,t){this.resetAllEntriesMatchingPredicate((n,r)=>R.equals(n,e)&&r==t)}resetAllEntries(){this._maintainedDataEntries.length=0}resetAllEntriesWithInteractionType(e){this.resetAllEntriesMatchingPredicate((t,n)=>n==e)}resetAllEntriesMatchingPredicate(e){this._maintainedDataEntries=this._maintainedDataEntries.filter(t=>!e(t.delayedHotspotId(),t.interaction()))}set(e,t,n){let r=this.getByHotspotAndInteractionType(e,t);if(r==null){let o=new bc;o.set(e,t,n),this._maintainedDataEntries.push(o),r=o}else r.set(e,t,n);return r.counter()}getByHotspotAndInteractionType(e,t){for(let n of this._maintainedDataEntries)if(R.equals(n.delayedHotspotId(),e)&&n.interaction()==t)return n;return null}constructor(){this._maintainedDataEntries=[]}};var _u=class{constructor(e){this._appState=null,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=[],this.currentlyEnteredGUIDsSet=new Set,this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=[],this.previouslyEnteredGUIDsSet=new Set,this._appState=e}reset(){this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.currentlyEnteredGUIDsSet.clear(),this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.length=0,this.previouslyEnteredGUIDsSet.clear()}updateEnteredNodes(e){this._previouslyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter,this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=this._getNodesEnteredByCanvasSpacePoint(e),this.currentlyEnteredGUIDsSet=new Set(this._currentlyEnteredNodesGUIDsOrderedInnerToOuter),this.previouslyEnteredGUIDsSet=new Set(this._previouslyEnteredNodesGUIDsOrderedInnerToOuter)}getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(e){let t=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(o=>!this.previouslyEnteredGUIDsSet.has(o));t.reverse();let n=new Map;for(let o=0,i=t.length;o<i;o=o+1)n.set(t[o],o);let r=e.filter(o=>n.has(o.node.id()));return r.sort((o,i)=>dt.int_compare(n.get(o.node.id()),n.get(i.node.id()))),r}getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(e){let t=this._previouslyEnteredNodesGUIDsOrderedInnerToOuter.filter(o=>!this.currentlyEnteredGUIDsSet.has(o)),n=new Map;for(let o=0,i=t.length;o<i;o=o+1)n.set(t[o],o);let r=e.filter(o=>n.has(o.node.id()));return r.sort((o,i)=>dt.int_compare(n.get(o.node.id()),n.get(i.node.id()))),r}markNodesAsNotEnteredWithoutTriggeringMouseLeave(e){let t=new Set(e);this._currentlyEnteredNodesGUIDsOrderedInnerToOuter=this._currentlyEnteredNodesGUIDsOrderedInnerToOuter.filter(n=>!t.has(n))}resetNoLongerMaintainedMouseEnterOrLeaveInteractions(e){e.resetAllEntriesMatchingPredicate((t,n)=>{let r=n=="MOUSE_ENTER"&&!this.currentlyEnteredGUIDsSet.has(t),o=n=="MOUSE_LEAVE"&&this.currentlyEnteredGUIDsSet.has(t);return r||o})}_getNodesEnteredByCanvasSpacePoint(e){let t=this._appState.baseScreenNode();if(t==null)return[];let n=this._appState.prototypeState(),r=n.getTopmostOverlayNode(),o=r!=null?r:t,i=r!=null?n.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(t,e):e,a=[],c=o.canvasSpaceScrolledInteractiveBounds(0).contains2(i)?o:null;if(o.forEachDescendantPreorder(l=>{l.canvasSpaceScrolledInteractiveBounds(0).contains2(i)&&(c=l)}),c!=null){a.push(o.id());let l=c;for(;l!=o;)a.push(l.id()),l=l.parent()}return a}};var Qs=class{constructor(e,t){this._ballisticSimulation=null,this._scrollingNodeID=null,this._isValid=!1,this._ballisticSimulation=e,this._scrollingNodeID=t,this._isValid=e!=null}nodeID(){return this._scrollingNodeID}simulation(){return this._ballisticSimulation}isOverscrolled(){return this._ballisticSimulation.isOverscrolled()}isValid(e){return e!=null&&e.findNode1(this._scrollingNodeID)!=null}isDone(){return this._ballisticSimulation.isDone1()}performScroll(e,t){if(!this.isValid(t))return;let n=this._ballisticSimulation.pos1(),r=t.findNode1(this._scrollingNodeID);e.setScrollOffsetUnconditionally(r,n)}};var fu=class{constructor(e,t,n,r,o,i,a,s){this.hotspot=e,this.prototypeInteraction=t,this.action=n,this.viewSpacePointOrNull=r,this.prototypeAction=o,this.connectionType=i,this.actionIndexPath=a,this.resolvedVariableModes=s}},Su=class{constructor(e,t){this._queue=null,this._canvasView=null,this._prototypeState=null,this._queue=[],this._canvasView=e,this._prototypeState=t,this._prototypeState.addObserver(this),this._prototypeState.addHsmObserver(this),this._canvasView.addObserver(this)}appendToQueue(e,t,n,r,o,i,a,s){this._queue.push(new fu(e,t,n,r,o,i,a,s))}insertInQueue(e,t,n,r,o,i,a,s,c){this._queue.splice(s,0,new fu(e,t,n,r,o,i,a,c))}runNextAction(){if(this._queue.length>0){let e=this._queue.shift();e!=null&&this._runAction(e)}}_runAction(e){this._canvasView.runAction(e.hotspot,e.prototypeInteraction,e.action,e.viewSpacePointOrNull,e.prototypeAction,e.connectionType,e.actionIndexPath,e.resolvedVariableModes)}handleStateChangeAborted(e){this._queue.length=0}handleStateChangeCommitted(e,t){if(this._queue.length>0){let n=this._queue.shift();n!=null&&t(()=>{this._runAction(n)})}}handleStateChangeInitiated(e){}handleStateChangeRequested(e){}handleFitModeChange(e,t){}handleRestartPrototype(){this._queue.length=0}handleHsmAborted(e,t){this._queue.length=0}handleHsmCommitted(e,t,n){if(this._queue.length>0){let r=this._queue.shift();r!=null&&n(()=>{this._runAction(r)})}}handleHsmInitiated(e,t){}handleHsmRequested(e,t){}willTriggerHotspot(e,t,n,r){(n==4||n==8||n==9||n==3)&&(this._queue.length=0)}didScrollNode(e){}};var Na;(r=>{function g(o){return Q.getFeatureFlags().prototypeStateManagement&&o.stateManagementVersion()==1}r.newStateManagementRulesEnabledForChange=g;function e(){return r._seenOldStateManagementInteraction}r.seenOldStateManagementInteraction=e;function t(){r._seenOldStateManagementInteraction=!0}r.markOldStateManagementInteractionSeen=t,r._seenOldStateManagementInteraction=!1})(Na||(Na={}));var bu=class{check(e){(!this._lastOffset.equals(e.offset())||this._lastZoomScale!=e.zoomScale())&&(this._lastOffset=e.offset(),this._lastZoomScale=e.zoomScale(),this.onChange!=null&&this.onChange(this._lastOffset,this._lastZoomScale))}resetStateForTests(){this._lastOffset=ye.FrozenVector_ZERO,this._lastZoomScale=0}constructor(){this._lastOffset=ye.FrozenVector_ZERO,this._lastZoomScale=0,this.onChange=null}};var rg=(n=>(n[n.MIN_MIN=0]="MIN_MIN",n[n.MIN_MAX=1]="MIN_MAX",n[n.MAX_MAX=2]="MAX_MAX",n))(rg||{}),el=(n=>(n[n.NONE=0]="NONE",n[n.POINTER=1]="POINTER",n[n.TOUCH=2]="TOUCH",n))(el||{}),Fi=class{parent(){return this._parent}window(){return this._window}children(){return this._children}events(){return this._events}focus(){this._window.setFocusedView(this)}absoluteBounds(){if(this._cachedAbsoluteBounds!=null)return this._cachedAbsoluteBounds;let e=null;if(this.parent()!=null)e=this.parent().absoluteBounds();else if(this==this.window().root())e=new B(0,0,this.window().width(),this.window().height());else return null;let t=e.width()|0,n=e.height()|0,r=this._minX+(this._alignX==2?t:0),o=this._maxX+(this._alignX!=0?t:0),i=this._minY+(this._alignY==2?n:0),a=this._maxY+(this._alignY!=0?n:0);return this._cachedAbsoluteBounds=new B(e.x()+r,e.y()+i,Math.max(0,o-r),Math.max(0,a-i)),e}viewFromPoint(e){let t=this.children().length;for(let n=0,r=t;n<r;n=n+1){let o=this.children()[t-n-1];if(o.absoluteBounds().contains2(e))return o.viewFromPoint(e)}return this}invalidateBounds(){this.forSelfAndDescendents(e=>{e._cachedAbsoluteBounds=null})}isEqualToOrParentOf(e){for(;e!=null;){if(e==this)return!0;e=e.parent()}return!1}selfAndParents(){let e=[];for(let t=this;t!=null;t=t.parent())e.push(t);return e}selfAndChildren(){let e=[],t=[this];for(;t.length!=0;){let n=t.pop(),r=n.children().length;e.push(n);for(let o=0,i=r;o<i;o=o+1)t.push(n.children()[r-o-1])}return e}setLayout(e,t,n,r,o,i){(this._alignX!=e||this._minX!=t||this._maxX!=n||this._alignY!=r||this._minY!=o||this._maxY!=i)&&(this._alignX=e,this._minX=t,this._maxX=n,this._alignY=r,this._minY=o,this._maxY=i,this._handleLayoutChange(),this.invalidateBounds())}setParent(e){if(e==this._parent)return;this._parent!=null&&ie.List_removeOne(this._parent.children(),this),e!=null&&e.children().push(this),this._handleParentChange(this._parent,e),this._parent=e,this.invalidateBounds();let t=e==null?void 0:e._window;this._window!=t&&this.forSelfAndDescendents(n=>{n._window=t})}forSelfAndDescendents(e){e(this);for(let t of this.children())t.forSelfAndDescendents(e)}setCursor(e){Fi._appendCursorStyleIfNecessary(),e!=this._cursor&&(this._element.classList.remove(Fi._cssCursorClassName(this._cursor)),this._cursor=e,this._element.classList.add(Fi._cssCursorClassName(this._cursor)))}cursor(){return this._cursor}element(){return this._element==null&&(this._element=document.createElement("div"),this._element.style.position="absolute",this._element.view=this,this._handleLayoutChange()),this._element}becomeRoot(e){this._window=e}_handleParentChange(e,t){t!=null&&t._element!=null?t._element.appendChild(this.element()):e._element!=null&&e._element.removeChild(this.element())}_handleLayoutChange(){if(this._element!=null){let e=this._element.style;e.left=this._alignX==2?"auto":this._minX.toString()+"px",e.top=this._alignY==2?"auto":this._minY.toString()+"px",e.right=this._alignX==0?"auto":this._maxX.toString()+"px",e.bottom=this._alignY==0?"auto":this._maxY.toString()+"px",e.width=this._alignX==1?"auto":(this._maxX-this._minX).toString()+"px",e.height=this._alignY==1?"auto":(this._maxY-this._minY).toString()+"px"}}static from(e){let t=e.view;return t||null}static _appendCursorStyleIfNecessary(){if(Fi._cursorStyle!=null)return;let e=(l,u,d,h)=>`
        cursor: url("${d}"), auto; /* Edge, IE */
        cursor: url("${l}") 30 30, pointer; /* Legacy */
        cursor: url("${h}") 30 30, pointer; /* FF */
        cursor: -webkit-image-set(url("${l}") 1x, url("${u}") 2x) 30 30, pointer; /* Webkit */
        `,t="/images/viewer/cursor-touch.png",n="/images/viewer/cursor-touch.cur",r="/images/viewer/cursor-touch@2x.png",o="/images/viewer/cursor-touch.svg",i="/images/viewer/cursor-touch-down.png",a="/images/viewer/cursor-touch-down.cur",s="/images/viewer/cursor-touch-down@2x.png",c="/images/viewer/cursor-touch-down.svg";Fi._cursorStyle=document.createElement("style"),Fi._cursorStyle.textContent=`
      .cursor-default {
        cursor: default;
      }

      .cursor-pointer {
        cursor: pointer;
      }

      .cursor-touch {
        ${e(t,r,n,o)}
      }

      .cursor-touch:active {
        ${e(i,s,a,c)}
      }

      /*
        We provide a mechanism for the app outside of the viewer to disable all
        viewer cursors. This is useful e.g. in comments mode where the containing
        react application is responsible for setting the cursor instead of code
        inside the viewer library. To use this, the containing application would
        add the viewer-cursors-disabled class to the HTMLElement that hosts the
        viewer canvas.
      */

      .viewer-cursors-disabled .cursor-default {
        cursor: inherit;
      }

      .viewer-cursors-disabled .cursor-pointer {
        cursor: inherit;
      }

      .viewer-cursors-disabled .cursor-touch {
        cursor: inherit;
      }

      .viewer-cursors-disabled .cursor-touch:active {
        cursor: inherit;
      }
`,document.head.appendChild(Fi._cursorStyle)}static _cssCursorClassName(e){switch(e){case 0:return"cursor-default";case 1:return"cursor-pointer";case 2:return"cursor-touch"}return null}constructor(){this._parent=null,this._window=null,this._children=[],this._events=zt._new(),this._alignX=1,this._minX=0,this._maxX=0,this._alignY=1,this._minY=0,this._maxY=0,this._cachedAbsoluteBounds=null,this._element=null,this._cursor=0}},$s=Fi;$s._cursorStyle=null;var tl=class{constructor(){if(arguments.length==1){let e=arguments[0];this._root=null,this._width=0,this._height=0,this._devicePixelRatio=0,this._eventHandlersBefore=zt._new(),this._eventHandlersAfter=zt._new(),this._events=zt._new(),this._afterNotifyCallback=null,this._isActive=!0,this._focusedView=null,this._containerElement=null,this._disableOwnOnFrameCallback=!1,this._internalOnFrameID=0,this.forceFrame=null,this.internalOnFrame=null,new tl(e,null,!1)}else if(arguments.length==3){let e=arguments[0],t=arguments[1],n=arguments[2];this._root=null,this._width=0,this._height=0,this._devicePixelRatio=0,this._eventHandlersBefore=zt._new(),this._eventHandlersAfter=zt._new(),this._events=zt._new(),this._afterNotifyCallback=null,this._isActive=!0,this._focusedView=null,this._containerElement=null,this._disableOwnOnFrameCallback=!1,this._internalOnFrameID=0,this.forceFrame=null,this.internalOnFrame=null,this._containerElement=e,this._disableOwnOnFrameCallback=n,this._root=new $s,this._root.becomeRoot(this);let r=null,o=null,i=null,a=null,s=null,c=null,l=document,u=window,d=this.root().element(),h=V=>{To.Event_preventDefault(V)},S=(V,H)=>{$t.EventTarget_removeEventListener3(V,"mousemove",o),$t.EventTarget_removeEventListener3(V,"mouseup",i),$t.EventTarget_removeEventListener5(V,"touchmove",s),$t.EventTarget_removeEventListener5(V,"touchend",c),$t.EventTarget_addEventListener4(H,"mousemove",o),$t.EventTarget_addEventListener4(H,"mouseup",i),$t.EventTarget_addEventListener6(H,"touchmove",s),$t.EventTarget_addEventListener6(H,"touchend",c)};this.forceFrame=()=>{this._resize(),zt.trigger(this.events(),new Mo(3,this.root(),0))},this.internalOnFrame=()=>{this._resize();try{zt.trigger(this.events(),new Mo(3,this.root(),0))}catch(V){La(V)}this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))};let f=()=>{this._isActive=!l.hidden,zt.trigger(this.events(),new Mo(1,this.root(),0)),S(l,d)},y=V=>{let H=(V.altKey?1:0)|(V.metaKey?2:0)|(V.shiftKey?4:0)|(V.ctrlKey?8:0);return(Aa.Modifiers_currentPlatformModifier()&H)!=0?H|16:H},v=(V,H)=>{for(let M=this.root().element();M!=null;M=M.offsetParent)V=V-M.offsetLeft,H=H-M.offsetTop;return new I(V,H)},b=0,m=0,p=0,_=0,T=V=>{let H=0,M=ta.Performance_now(u.performance);return H=1,_!=0&&M-_<500&&Math.abs(V.pageX-b)<4&&Math.abs(V.pageY-m)<4&&(H=p+1),b=V.pageX,m=V.pageY,p=H,_=M,H},N=null,k=null,j=!1,te=(V,H,M,K)=>{let U=v(V.pageX,V.pageY),P=k!=null?k:this.root().viewFromPoint(U),J=new Qi(H==4&&j?6:H,P,y(V),U,N!=null?N:U,M,H==5?T(V):0,K);N=U,this.notify(J),J.isAccepted()&&(J.type()==5&&V.button==0||To.Event_preventDefault(V),H==5&&(k=P)),H==5?j=!0:H==7&&(k=null,j=!1)},Y=new Map,_e=(V,H)=>{let M=new Map,K=[];Array.from(Y.values()).forEach(P=>{ie.List_appendOne(K,P.originalTarget)});let U=cl.TouchEvent_touches(V).map(P=>{let J=P.identifier,z=v(P.pageX,P.pageY),O=Ht.IntMap_get(Y,J,null),G=O!=null?O.originalTarget:this.root().viewFromPoint(z),L=new Ys(J,G,z,O!=null?O.locationInWindow:z);return M.set(J,L),ie.List_appendOne(K,G),L});Y=M;for(let P of K){let J=new $o(H,P,y(V),U.filter(z=>z.originalTarget==P),U);this.notify(J),J.isAccepted()&&To.Event_preventDefault(V)}},ce=(V,H)=>{let M=Ht.IntMap_get(nu,V.which,0),K=y(V),U=(Aa.Modifiers_currentPlatformModifier()&K)!=0&&(M==91||M==93||M==20),P=this.focusedView();U&&To.Event_preventDefault(V);let J=z=>{for(;z!==l;){if(z.className.split(" ").indexOf("viewer-forward-keyevents")!=-1)return!0;z=z.parentNode}return!1};if((U||l.activeElement==null||l.activeElement==l.body||J(l.activeElement))&&M!=0&&P!=null){let z=new rs(H,P,K,M,!1);this.notify(z),(z.isAccepted()||M==1)&&(To.Event_preventDefault(V),V.stopPropagation())}};if(r=V=>{S(d,l),te(V,5,null,null),window.focus(),document.activeElement!=null&&document.activeElement.blur()},o=V=>{te(V,4,null,null)},i=V=>{S(l,d),te(V,7,null,null)},a=V=>{_e(V,11)},s=V=>{_e(V,12)},c=V=>{_e(V,13)},$t.EventTarget_addEventListener3(l,"keydown",V=>{ce(V,14)}),$t.EventTarget_addEventListener3(l,"keyup",V=>{ce(V,15)}),$t.EventTarget_addEventListener7(d,"wheel",V=>{let H=V.deltaMode,M=H==V.DOM_DELTA_LINE?10:H==V.DOM_DELTA_PAGE?100:1;te(V,8,new I(V.deltaX*M,V.deltaY*M),null)}),$t.EventTarget_addEventListener14(l,"wheel",V=>{V.ctrlKey&&To.Event_preventDefault(V)},{passive:!1}),$t.EventTarget_addEventListener5(l,"drop",V=>{To.Event_preventDefault(V),te(V,9,null,ll.DataTransfer_files(V.dataTransfer).map(H=>new tu(H)))}),$t.EventTarget_addEventListener4(l,"mouseenter",V=>{N=null}),$t.EventTarget_addEventListener4(d,"mouseleave",V=>{te(V,10,null,null)}),t!=null){let V=t;V.onPress(H=>{let M=new ou(16,this.root(),0,H.buttons[0],sc.stringToTriggerDevice(H.controllerType));this.notifyAll(M)}),V.start()}$t.EventTarget_addEventListener1(u,"resize",()=>{this._resize()}),$t.EventTarget_addEventListener1(u,"visibilitychange",f),$t.EventTarget_addEventListener2(d,"contextmenu",h),$t.EventTarget_addEventListener4(d,"mousedown",r),$t.EventTarget_addEventListener6(d,"touchstart",a),$t.EventTarget_addEventListener2(l,"dragenter",h),$t.EventTarget_addEventListener2(l,"dragover",h),this._containerElement!=null&&this._containerElement.appendChild(d),this._focusedView=this.root(),f(),this._resize(),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}}root(){return this._root}width(){return this._width}height(){return this._height}size(){return new I(this._width,this._height)}isActive(){return this._isActive}focusedView(){return this._focusedView}devicePixelRatio(){return this._devicePixelRatio}eventsBefore(){return this._eventHandlersBefore}eventsAfter(){return this._eventHandlersAfter}events(){return this._events}setAfterNotify(e){this._afterNotifyCallback=e}clearAfterNotify(){this._afterNotifyCallback=null}_afterNotify(e){this._afterNotifyCallback!=null&&this._afterNotifyCallback(e)}notify(e){let t=e.target().selfAndParents();if(zt.trigger(this._eventHandlersBefore,e),e.isAccepted()){this._afterNotify(e);return}for(let n of t)if(zt.trigger(n.events(),e),e.isAccepted()){this._afterNotify(e);return}zt.trigger(this._eventHandlersAfter,e),this._afterNotify(e)}notifyAll(e){let t=e.target().selfAndChildren();if(zt.trigger(this._eventHandlersBefore,e),!e.isAccepted()){for(let n of t)if(zt.trigger(n.events(),e),e.isAccepted())return;zt.trigger(this._eventHandlersAfter,e)}}dangerouslyDisableOnFrameCallbackForTesting(){this._disableOwnOnFrameCallback=!0}_resize(){if(this._containerElement==null)return;let e=document.body,t=Q.isInlinePreview()?this._containerElement.getBoundingClientRect().width:this._containerElement==e?window.innerWidth:this._containerElement.clientWidth,n=Q.isInlinePreview()?this._containerElement.getBoundingClientRect().height:this._containerElement==e?window.innerHeight:this._containerElement.clientHeight,r=or();(this._width!=t||this._height!=n||this._devicePixelRatio!=r)&&(this._width=t,this._height=n,this._devicePixelRatio=r,this.root().invalidateBounds(),this.notifyAll(new Mo(2,this.root(),0)))}setFocusedView(e){this._focusedView=e}createDiv(){return document.createElement("div")}setNewContainerElement(e){if(e==null)throw new Error("Can't mount the viewer in a null DOM node");this._containerElement=e,e.appendChild(this.root().element()),this._resize(),this._internalOnFrameID!=0&&cancelAnimationFrame(this._internalOnFrameID),this._disableOwnOnFrameCallback||(this._internalOnFrameID=requestAnimationFrame(this.internalOnFrame))}},tg;(e=>{function g(t){return rg[t]}e.ViewAlign_toString=g})(tg||(tg={}));var ng;(e=>{function g(t){return el[t]}e.Cursor_toString=g})(ng||(ng={}));var Ds=(t=>(t[t.DID_WORK=0]="DID_WORK",t[t.IDLE=1]="IDLE",t))(Ds||{}),Tc=(t=>(t[t.SHORTCUT=0]="SHORTCUT",t[t.SCROLL=1]="SCROLL",t))(Tc||{}),Bl=(t=>(t[t.AUTOMATIC=0]="AUTOMATIC",t[t.USER_INITIATED=1]="USER_INITIATED",t))(Bl||{}),Pn=(T=>(T[T.UNKNOWN=0]="UNKNOWN",T[T.TIMER=1]="TIMER",T[T.ON_HOVER=2]="ON_HOVER",T[T.ON_PRESS=3]="ON_PRESS",T[T.ON_CLICK=4]="ON_CLICK",T[T.DRAG=5]="DRAG",T[T.REVERSE_HOVER=6]="REVERSE_HOVER",T[T.REVERSE_PRESS=7]="REVERSE_PRESS",T[T.MOUSE_DOWN=8]="MOUSE_DOWN",T[T.MOUSE_UP=9]="MOUSE_UP",T[T.MOUSE_IN=10]="MOUSE_IN",T[T.MOUSE_OUT=11]="MOUSE_OUT",T[T.MOUSE_ENTER=12]="MOUSE_ENTER",T[T.MOUSE_LEAVE=13]="MOUSE_LEAVE",T[T.ON_KEY_DOWN=14]="ON_KEY_DOWN",T[T.ON_GAMEPAD_DOWN=15]="ON_GAMEPAD_DOWN",T[T.ON_VOICE=16]="ON_VOICE",T[T.MOBILE_NAV=17]="MOBILE_NAV",T[T.LEFT_ARROW=18]="LEFT_ARROW",T[T.RIGHT_ARROW=19]="RIGHT_ARROW",T[T.ON_MEDIA_HIT=20]="ON_MEDIA_HIT",T[T.ON_MEDIA_END=21]="ON_MEDIA_END",T))(Pn||{}),lg=(r=>(r[r.MISS=0]="MISS",r[r.LEFT_THIRD=1]="LEFT_THIRD",r[r.CENTER_THIRD=2]="CENTER_THIRD",r[r.RIGHT_THIRD=3]="RIGHT_THIRD",r))(lg||{}),yu=class{constructor(e,t){this.swappedStablePath=e,this.hotspotStablePath=t}},Tu=class{willTriggerHotspot(e,t,n,r){this.willTriggerHotspotCallback!=null&&this.willTriggerHotspotCallback(e,t,n,r)}didScrollNode(e){this.didScrollNodeCallback!=null&&this.didScrollNodeCallback(e)}constructor(e,t){this.willTriggerHotspotCallback=e,this.didScrollNodeCallback=t}},io=class{constructor(e,t){this.FRAMES_TO_FINISH_RENDERING=3,this._state=io.State.INACTIVE,this._framesToFinishRendering=0,this._observers=new lr,this._emitter=null,e.addObserver(this),this._emitter=t}onFrame(){this._state==io.State.WAITING_TO_FINISH&&(this._framesToFinishRendering==0?(this._emitter.trigger("renderingStop",null),this._observers.forEach(e=>{e.handleRenderingStop()}),this._state=io.State.INACTIVE):this._framesToFinishRendering=this._framesToFinishRendering-1)}handleSetNeedsBlit(e){this._state==io.State.INACTIVE?e&&(this._emitter.trigger("renderingStart",null),this._observers.forEach(t=>{t.handleRenderingStart()}),this._state=io.State.ACTIVE):this._state==io.State.ACTIVE?e||(this._state=io.State.WAITING_TO_FINISH,this._framesToFinishRendering=this.FRAMES_TO_FINISH_RENDERING):e&&(this._state=io.State.ACTIVE)}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}};(t=>{let g;(i=>(i[i.ACTIVE=0]="ACTIVE",i[i.INACTIVE=1]="INACTIVE",i[i.WAITING_TO_FINISH=2]="WAITING_TO_FINISH"))(g=t.State||(t.State={}));let e;(r=>{function n(o){return t.State[o]}r.State_toString=n})(e=t.in_State||(t.in_State={}))})(io||(io={}));var be=class extends $s{constructor(e,t){super();this._appState=null,this._observers=new lr,this._renderer=null,this._renderingStateTracker=null,this._idlenessTracker=null,this._transitionBehaviorManager=null,this._scrollSyncer=null,this._sequentialActionManager=null,this._viewportTracker=new bu,this._viewport=new $r,this._hotspotAnimation=new yd,this._uiRenderData=new vd,this._showHotspots=!0,this._multiplayer=null,this._mostRecentTransitionViaArrows=!1,this._mostRecentFrameNum=0,this._microtasksSinceLastFrame=0,this.MAX_MICROTASKS_PER_FRAME=2,this.onResize=null,this.onBaseScreenIdChanged=null,this.userDidAttemptZoom=null,this.disengageObservationMode=null,this.onURLClicked=null,this.onNavigateToPrototype=null,this.afterFrame=null,this.afterFirstRenderOfScreenStack=null,this._emitter=null,this._pointerEventDelegate=null,this.INTERACTION_REPORTING_RATE=10/100,this._currentMouseLocation=null,this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedDataLegacy=new bc,this._maintainedData=new gu,this._mouseEnteredNodesManager=null,this._initialFlingVelocity=new I(0,0),this._interactionObservers=new lr,this.ALT_CODE=18,this.SHIFT_CODE=16,this.META_CODE=91,this.CONTROL_CODE=17,this._appState=e,this._appState.prototypeState().addObserver(this),this._appState.prototypeState().addHsmObserver(this),this._emitter=t,this.makeRenderer(),this.setPhysicsForOS(this.getRelevantOS()),this._idlenessTracker=new mu(n=>{this._renderer.setZoomScale(n)},this._emitter),this._pointerEventDelegate=new be.CanvasPointerEventDelegate(this),this._scrollSyncer=new pc(this,this._appState),this._sequentialActionManager=new Su(this,this._appState.prototypeState()),this._mouseEnteredNodesManager=new _u(this._appState)}addObserver(e){this._observers.add(e)}removeObserver(e){this._observers.remove(e)}setBackgroundEnabled(e){this._renderer.setBackgroundEnabled(e)}renderingStateTracker(){return this._renderingStateTracker}makeRenderer(){let e=this._renderer;e!=null&&e.removeFrom(this),this._renderer=new yi(this._viewport,this._appState,this._appState.imageManager()),this._transitionBehaviorManager!=null&&this._transitionBehaviorManager.removeFrom(this),this._transitionBehaviorManager=new wd(this),this._renderingStateTracker!=null&&this._appState.removeFrameObserver(this._renderingStateTracker),this._renderingStateTracker=new io(this._renderer,this._emitter),this._appState.addFrameObserver(this._renderingStateTracker),e!=null&&this._renderer!=null&&this._renderer.attachTo(this)}graphicsCardName(){return this._renderer.graphicsCardName()}deviceRenderer(){return this._renderer.deviceRenderer()}getContext(){return this._renderer.getContext()}viewport(){return this._viewport}viewportTracker(){return this._viewportTracker}mostRecentFrameNum(){return this._mostRecentFrameNum}setScrollPadding(e,t,n,r){this._viewport.setScrollPadding([e,t,n,r])}setMultiplayer(e){this._multiplayer=e}setShowHotspots(e){this._showHotspots=e}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._viewport.invalidate(),this._invalidateZoomScaleForRender(),this._idlenessTracker.handleSceneChange(),this._setCurrentViewportSizeOnCanvas()}resetStateForTests(){this._viewport.resetStateForTests(),this._viewportTracker.resetStateForTests(),this._appState.resetStateForTests(),this.makeRenderer(),this._lastPressData=null,this._hoveredStateInstances=new Map,this._maintainedDataLegacy.reset(),Q.getFeatureFlags().prototypeNewMouseEvents&&this._maintainedData.resetAllEntries(),this._pointerEventDelegate.resetStateForTests(),this._mouseEnteredNodesManager.reset(),this._appState.prototypeState().addHsmObserver(this)}handleActiveCanvasChange(e,t){t!=null?this._viewport.invalidate():this._currentMouseLocation=null}handleActivePrototypeStartingPointChange(e,t){}afterEnteredViewer(){this._appState.nodeTransitionTracker().triggerPotentialTimedTransition=()=>{let e=this._appState.prototypeState(),t=[];e.getCurrentBaseScreenNode()!=null&&t.push(e.getCurrentBaseScreenNode());for(let n=0,r=e.getCurrentOverlayData().length;n<r;n=n+1)t.push(e.nodeForOverlayAt(n));this._triggerPotentialTimedTransition(t,0)},this._appState.nodeTransitionTracker().createVideoTriggerEventsForNodesInFrame=e=>{!e||this._createVideoTriggerEvents([e])},this._appState.nodeTransitionTracker().createVideoTriggerEventsForAllNodesOnscreen=()=>{let e=[],t=this._appState.prototypeState();t.getCurrentBaseScreenNode()!=null&&e.push(t.getCurrentBaseScreenNode());for(let n=0,r=t.getCurrentOverlayData().length;n<r;n=n+1)e.push(t.nodeForOverlayAt(n));this._createVideoTriggerEvents(e)}}navigateForward(e){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let n=this._appState.prototypeState().getCurrentBaseScreenNode();if(n==null)return;let r=null;this._appState.prototypeStructure().currentType()==1?r=this._appState.prototypeState().getNextBaseScreenNodeForFrameList():r=this._appState.prototypeState().getNextBaseScreenNodeForPrototype(),r!=null&&this.navigateViaArrows(n.id(),r.id(),0,e)}navigateBackward(e){if(this._appState.prototypeState().getCurrentBaseScreenId()==null)return;let n=this._appState.prototypeState().getCurrentBaseScreenNode();if(n==null)return;let r=this._appState.prototypeState().getPreviousBaseScreenNode();r!=null&&this.navigateViaArrows(n.id(),r.id(),1,e)}navigateViaArrows(e,t,n,r){this._mostRecentTransitionViaArrows=!0,Math.random()<this.INTERACTION_REPORTING_RATE&&Je.trackEvent1("prototype_view_interaction",new Map([["type","navigateViaArrows"],["direction",Mr[n]],["nonInteraction",0],["prototypeType",oi[this._appState.prototypeStructure().currentType()]]]));let o=this._appState.prototypeState().getCurrentBaseScreenNode();if(o!=null&&o.prototypeInteractions().length!=0){let i=null;for(let a=0,s=o.prototypeInteractions().length;a<s;a=a+1){let c=o.prototypeInteractions()[a],l=(c==null?void 0:c.action())!=null?c.action().value:null;if(c!=null&&c.allActions().length>0)for(let d of c.allActions())d.transitionNodeID()!=null&&d.transitionNodeID()==t&&(l=d);let u=l!=null?this._appState.scene().findNode1(l.transitionNodeID()):null;if(u!=null){let d=Ft.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),o==null?void 0:o.id(),u==null?void 0:u.id(),l.navigationType(),l.connectionType());i=d==null?null:d}if(R.equals(i,t)){this._appState.prototypeState().navigateToFrameAndCloseOverlays3(t,o,1,n,r,c,l);return}}}this._appState.prototypeState().navigateToFrameAndCloseOverlays3(t,null,1,n,r,null,null)}_navigateToHyperlink(e,t){var r;let n;if(e.hyperlink.url!==void 0){this.onURLClicked(e.hyperlink.url,!0);return}else if(e.hyperlink.guid!==void 0){let o=pt.decodeGUID(e.hyperlink.guid);if(R.equals(o,this._appState.getActiveCanvas().id())){this._appState.prototypeState().restartPrototype(1);return}let i=this._appState.scene().findNode1(o),a=Ft.cleanedUpTransitionDestinationId(this._appState.getActiveCanvas(),(r=e.node)==null?void 0:r.id(),i==null?void 0:i.id(),t,"URL");if(a!=null){this._appState.prototypeState().navigateToFrameAndCloseOverlays1(a);return}let s=this._appState.currentFileKey();this.onNavigateToPrototype(s,R.toString(o))}}triggerHotspot(e,t,n,r){let o;if(this._multiplayer.isObserving()||(this._observers.forEach(a=>{a.willTriggerHotspot(e,t,n,r)}),t==null||t.actions().length==0))return;Q.getFeatureFlags().prototypeStateManagement&&!Na.seenOldStateManagementInteraction()&&t.stateManagementVersion()==0&&(Je.trackDefinedEvent("prototype.viewer_old_noodle_used",new Map),Na.markOldStateManagementInteractionSeen());let i=e.node.getResolvedVariableModes();for(let a=0,s=t.actions().length;a<s;a=a+1){let c=t.actions()[a],l=c.connectionType();Math.random()<this.INTERACTION_REPORTING_RATE&&Je.trackEvent1("prototype_view_interaction",new Map([["type","triggerHotspot"],["transitionAction",Pn[n]],["transitionType",(o=c==null?void 0:c.transitionType())!=null?o:null],["action",l=="INTERNAL_NODE"?c==null?void 0:c.navigationType():l=="UPDATE_MEDIA_RUNTIME"?c==null?void 0:c.mediaAction():l],["nonInteraction",0]])),this._sequentialActionManager.appendToQueue(e,t,n,r,c,l,[a],i)}this._sequentialActionManager.runNextAction()}runAction(e,t,n,r,o,i,a,s){let c=!0;switch(i){case"INTERNAL_NODE":{let l=o.transitionNodeID();this._performNavigationOrOverlayChangeForHotspot(e.node,l,n,t,r,a),o.navigationType()=="SCROLL_TO"&&o.transitionType()!="SCROLL_ANIMATE"||(c=!1);break}case"URL":{e.hyperlink==null?this.onURLClicked(o.connectionURL(),o.openUrlInNewTab()):this._navigateToHyperlink(e,o.navigationType());break}case"BACK":{this.requestBack(e.node,t,1,qt.TransitionAction_fromInteractionType(t.event().interactionType()),In.fromPrototypeAction(o,t.stateManagementVersion()),o),c=!1;break}case"CLOSE":{this._appState.prototypeState().closeOverlayForHotspot(e.node,t,1,o),c=!1;break}case"SET_VARIABLE":{if(x._prototypeLib.fonts().isWaitingForFontList())return;let l=e.node.id();e.node.isOrInInstance()&&(l=e.node.findContainingPrimaryInstance().id());let u=x._prototypeLib.getICActionsForSetVariableAction(l,o.targetVariableID(),o.targetVariableData(),this._appState.prototypeState().getTopmostScreenId(),s);if(u.length>0){let d=er.instance.setReverseVariantBindingsForICsDisabled(!0);for(let h of u){let f=e.node.scene().findNode1(h.nodeToSwap),y=f.prototypeInteractions()[h.interactionIndex];this.runAction(new Eo(f),y,0,null,y.actions()[h.actionIndex],"INTERNAL_NODE",[h.actionIndex],s)}er.instance.setReverseVariantBindingsForICsDisabled(d),c=!1}x._prototypeLib.runSetVariable(l,o.targetVariableID(),o.targetVariableData(),s),Pi.notifyVariableUpdated();break}case"UPDATE_MEDIA_RUNTIME":{this._appState.videoManager().updateVideoRuntime(o,e.node.id());break}case"CONDITIONAL":{if(x._prototypeLib.fonts().isWaitingForFontList()||o.conditionalActions().length==0)return;let l=x._prototypeLib.getFirstTruthyConditionalIndex(e.node.id(),o.conditionalActions()[0].condition());if(l>=0&&l<o.conditionalActions().length){let d=o.conditionalActions()[l].actions();for(let h=0,S=d.length;h<S;h=h+1){let f=d[h],y=[a[0],l,h];this._sequentialActionManager.insertInQueue(e,t,n,r,f,f.connectionType(),y,h,s)}}break}}c&&this._sequentialActionManager.runNextAction()}triggerDelayedHotspot(e,t,n){var i;let r,o=(i=this._appState.scene())==null?void 0:i.findNode1(e);o!=null&&this.triggerHotspot(new Eo(o),t,n,null)}_findPrototypeActionGivenActionIndexPath(e,t){let n=e.actions(),r=t[0];if(r<n.length){let o=n[r];if(t.length>2){let i=t[1],a=t[2];if(o.conditionalActions()!=null&&o.conditionalActions().length>i){let s=o.conditionalActions()[i];if(s.actions()!=null&&s.actions().length>a)return s.actions()[a]}}return o}return null}_performNavigationOrOverlayChangeForHotspot(e,t,n,r,o,i){var c;let a;this._mostRecentTransitionViaArrows=Q.getFeatureFlags().prototypeNewMouseEvents?!1:o==null;let s=this._findPrototypeActionGivenActionIndexPath(r,i);if(e==null&&ze("Hotspot node unexepectedly null when performing navigation or overlay change for hotspot"),e==null||s.navigationType()=="NAVIGATE"||s.navigationType()=="SWAP"&&this._appState.prototypeState().getTopmostOverlayId()==null)this._appState.prototypeState().navigateToFrameAndCloseOverlays3(t,e,1,0,n,r,s);else if(s.navigationType()=="SCROLL_TO")this.scrollToDestinationInFrame(t,r);else if(s.navigationType()=="OVERLAY")this._appState.prototypeState().overlayFrame(t,e,!0,0,n,r,s);else if(s.navigationType()=="SWAP")this._appState.prototypeState().swapTopOverlay(t,e,n,r,s);else if(s.navigationType()=="SWAP_STATE"){if(x._prototypeLib.fonts().isWaitingForFontList())return;let l=(c=jt.whichInstanceToSwap(e,s.transitionNodeID()))==null?void 0:c.stablePath();l!=null&&this._appState.prototypeState().swapInstanceToState2(l,t,e,n,r,1,s)}}requestBack(e,t,n,r,o,i){this._appState.prototypeState().returnToState2(e,t,n,r,o,i)}handleHsmAborted(e,t){this._renderer.abortHsmTransition(e,t),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(t.stablePath);let n=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(e,r=>(n.push(this._appState.scene().findNode3(r)),Se.Loop.CONTINUE)),this._onCommitOrAbortForInteractions(n,t.cause,t.oldStateId())}handleHsmCommitted(e,t,n){this._renderer.commitHsmTransition(e,t),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(t.stablePath);let r=[];this._appState.prototypeState().forMaterializedStateInstanceAndDescendants(e,o=>(r.push(this._appState.scene().findNode3(o)),Se.Loop.CONTINUE)),n(()=>{this._onCommitOrAbortForInteractions(r,t.cause,t.oldStateId())})}handleHsmRequested(e,t){Na.newStateManagementRulesEnabledForChange(t)&&this._scrollSyncer.commitCurrentScrollStateToStorage(t)}handleHsmInitiated(e,t){Na.newStateManagementRulesEnabledForChange(t)&&(t.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(t):this._scrollSyncer.resetScrollStateToScene(t));let n=this._transitionBehaviorManager.getTransitionMixinForStateSwap(this._appState.scene(),t,this._multiplayer.isObserving());this._renderer.triggerHsmTransition(e,t,n),this._viewport.invalidate(),this._updateHoveredStateInstanceIfNeeded(t.stablePath)}handleStateChangeAborted(e){this._updateCanvasForCurrentBaseScreen();let t=null,n=[];R.equals(e.oldStateId(),e.newStateId())||n.push(e.oldStateId());let r=e.oldOverlayData(),o=e.newOverlayData();for(let i=0,a=r.length;i<a;i=i+1)(i>=o.length||!R.equals(r[i].id,o[i].id))&&n.push(r[i].id);t=n.map(i=>{var s;let a;return(s=this._appState.scene())==null?void 0:s.findNode1(i)}).filter(i=>i!=null),!R.equals(e.oldStateId(),e.newStateId())&&this.onBaseScreenIdChanged!=null&&this.onBaseScreenIdChanged(e.oldStateId(),qt.TransitionAction_getControlSource(e.cause),!e.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState()),this._renderer.handleAbortedTransition(e),this._updateViewportForCurrentPreview(),this._appState.currentFitMode()==4&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate(),this._onCommitOrAbortForInteractions(t,e.cause,e.oldStateId())}handleStateChangeCommitted(e,t){this._updateCanvasForCurrentBaseScreen(),this._renderer.handleCommittedTransition(e);let n=e.getNewOrChangedFrameIds().map(r=>{var i;let o;return(i=this._appState.scene())==null?void 0:i.findNode1(r)}).filter(r=>r!=null);if(this._appState.scene().interactiveComponentsEnabled()){let r=this._appState.scene().findNode1(this._appState.prototypeState().getTopmostScreenId());r!=null&&Se.forEachNode1(r,o=>(o!=r&&o.isInstance()&&n.push(o),Se.Loop.CONTINUE))}t(()=>{this._onCommitOrAbortForInteractions(n,e.cause,e.oldStateId())})}handleStateChangeInitiated(e){if(this._updateCanvasForCurrentBaseScreen(),this._appState.baseScreenNode()==null&&!Q.isInlinePreview()){console.warn("no current TLF after receiving update");return}this.setPhysicsForOS(this.getRelevantOS());let t=this._transitionBehaviorManager.getTransitionMixin(this._appState.scene(),e,this._multiplayer.isObserving());this._renderer.triggerTransition(e,this._viewport,t),this.setPhysicsForOS(this.getRelevantOS()),!R.equals(e==null?void 0:e.oldStateId(),e==null?void 0:e.newStateId())&&this.onBaseScreenIdChanged!=null&&this.onBaseScreenIdChanged(e.newStateId(),qt.TransitionAction_getControlSource(e.cause),!e.isTransientChange(),this._appState.prototypeState().getOngoingNavigateRepairsInvalidState());let n=this._appState.prototypeState();if(Q.getFeatureFlags().prototypeStateManagement&&e.stateManagementVersion()==1)this._scrollSyncer.commitCurrentScrollStateToStorage(e),e.resetScroll()==1?this._scrollSyncer.applyStoredScrollStateToScene(e):this._scrollSyncer.resetScrollStateToScene(e);else if(e.preserveScroll()==1)be.matchNodesAndPreserveScroll(this,n,e);else{let r=e.getNewOrChangedFrameIds().map(o=>{var a;let i;return(a=this._appState.scene())==null?void 0:a.findNode1(o)});for(let o of r)this._resetScrollForTlf(o)}this._pointerEventDelegate.unlockScroll(),this._updateViewportForCurrentPreview(),this._appState.currentFitMode()==4&&this._appState.baseScreenNode()!=null&&this._viewport.zoomToFit2(0,this._appState.baseScreenNode().canvasSpaceBoundingBox()),this._invalidateZoomScaleForRender(),this._sendMouseCursorUpdate(),this._viewport.invalidate()}handleStateChangeRequested(e){}handleFitModeChange(e,t){this._appState.baseScreenNode()!=null&&!aa.FitMode_topLevelFramesCanScroll(this._appState.prototypeState().getCurrentFitMode())&&(this._appState.activePrototypeDevice()!=null&&Ui.hasDevice(this._appState.activePrototypeDevice().type)||this.updateScrollOffsetForNode(this._appState.baseScreenNode(),new I(0,0))),this._renderer.changeFitMode(t),this._setCurrentViewportSizeOnCanvas()}handleRestartPrototype(){this._scrollSyncer.uninit(),this._cancelAnimationManager(),this._mouseEnteredNodesManager.reset()}_updateCanvasForCurrentBaseScreen(){let e=this._appState.baseScreenNode();(e==null?void 0:e.canvas())!=null&&(this._appState.setActiveCanvas(e.canvas()),this._setCurrentViewportSizeOnCanvas())}_updateViewportForCurrentPreview(){let e=this._renderer.currentCanvasSpaceFrameBounds(),t=this._renderer.currentCanvasSpacePreviewBounds();e!=null&&t!=null?this._viewport.updateForCurrentPreview(e,t,this._appState.currentFitMode(),this._appState.activePrototypeDevice()):this._viewport.updateForBaseScreen(this._appState.baseScreenNode(),this._appState.currentFitMode(),this._appState.activePrototypeDevice())}_invalidateZoomScaleForRender(){this._idlenessTracker.updateZoomScaleNow(this._viewport.zoomScale())}handleSceneGraphEvent(e){R.equals(e.node.id(),this._appState.baseScreenId())?e.property==24?this._updateCanvasForCurrentBaseScreen():e.property==48&&this._updateViewportForCurrentPreview():e.property==65&&(this._updateViewportForCurrentPreview(),this._invalidateZoomScaleForRender(),this._maybeChangePhysicsForDevice(Z.asPrototypeDevice(e.oldVal))),this._handleScrollingPropertyChange(e.node,e.property,e.oldVal,e.newVal),e.property!=61&&this._viewport.invalidate()}handleAction(e,t){switch(e){case 1:{this._viewport.adjustCameraZoomRounded(1,2),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 2:{this._viewport.adjustCameraZoomRounded(1,.5),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 3:{this._viewport.setCameraZoom(1,1),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}case 4:{this.canvasContentBounds()!=null&&this._viewport.zoomToFit2(1,this.canvasContentBounds()),this.userDidAttemptZoom!=null&&this.userDidAttemptZoom(0);break}}}setup(){this._setupInteractionHandlers(this._emitter),$n.addUpdate(zt.windowResize(this.events()),e=>{this._resize()}),$n.addUpdate(zt.windowFrame(this.window().events()),e=>{this._onFrame()}),this._renderer.attachTo(this),this._resize(),this._appState.addActionObserver(this),this._appState.addAppObserver(this)}canvasSpaceToWindowSpace(){let e=Tr.new2();return e.translate2(this._viewport.viewSpaceBounds().topLeft()),e.multiply(this._viewport.canvasSpaceToViewSpace1()),e}_tryResizingTo(e){this._viewport.setBounds(new B(0,0,e.x(),e.y())),this._updateViewportForCurrentPreview();let t=this._renderer.resize(e.x(),e.y(),this._viewport.zoomScale(),or());return this.onResize!=null&&(this._setCurrentViewportSizeOnCanvas(),this.onResize()),this._idlenessTracker.handleInteraction(),t}_resize(){let e=this.absoluteBounds(),t=ye.FrozenVector_new4(e.width(),e.height()),n=this._tryResizingTo(t),r=n.canvasSize;if(n.webGLDidAdjustCanvasSize){let o=this._tryResizingTo(r).canvasSize}}_setCurrentViewportSizeOnCanvas(){let e=this._appState.baseScreenNode();if(e==null)return;let t=e.findContainingCanvasOrSelf();if(t==null)return;let n=null,r=this._appState.prototypeState().getCurrentFitMode();if(r==1||r==2)n=ye.FrozenVector_INFINITY;else if(r==5||r==6){let o=this._viewport.getScaleFactorForCurrentTlf(e.fullSize(),r,t.prototypeDevice()),i=this._viewport.viewSpaceBounds().size().y()/o;n=new I(Pe.Math_INFINITY(),i)}else n=this._viewport.viewSpaceBounds().size();t.currentViewportSize().equals(n)||t.setCurrentViewportSize(n)}renderingIsComplete(){return this._renderer.isRenderingDone()}isTopLevelTransitionOngoing(){return this._renderer.isTopLevelTransitionOngoing()}dangerouslyAccessProtoRenderManager(){return this._renderer}clearTileCaches(){this._renderer.clearTileCaches()}_onFrame(){this._mostRecentFrameNum=this._mostRecentFrameNum+1,this._microtasksSinceLastFrame=0,this._appState.onFrame();let e=this._appState.getActiveCanvas();if(e==null)return;this._clampDirtyScrollContainers(),be._scrollAnimationManager!=null&&this._updateForAnimation(),(this._idlenessTracker.justInteracted()||this._renderer.checkNeedsBlit())&&this._renderer.setNeedsBlit(!0),this._idlenessTracker.advanceFrame(this._viewport),this._viewportTracker.check(this._viewport),this._viewport.prepareForRendering(),this._updateViewportForCurrentPreview(),this._appState.baseScreenNode()!=null&&this._sendMouseCursorUpdate(),this._updateScrollOffsetsFromMultiplayer();let t=this._appState.baseScreenNode()!=null&&this._appState.baseScreenNode().visible();if(!t)this._renderer.drawBlank();else{this._appState.renderDots()?this._uiRenderData.backgroundColor=E.WHITE:this._uiRenderData.backgroundColor=Wl(this._appState.baseScreenId(),this._appState.currentFitMode(),e),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspots=this._findHotspotsToAnimate(),this._uiRenderData.hotspots!=null&&this._uiRenderData.hotspots.length!=0&&this._renderer.setNeedsBlit(!0),this._uiRenderData.hotspotOpacity=this._hotspotAnimation.getOpacity(),this._uiRenderData.particles=this._multiplayer.getParticles(),this._uiRenderData.mouse=this._multiplayer.getMouse(),this._uiRenderData.renderDots=this._appState.renderDots(),Je.appTimerStart("rendererDraw");let r=this._renderer.draw(this._idlenessTracker.zoomInProgress(),this._idlenessTracker.shouldRenderOptionalTiles(),this._viewport,this._uiRenderData);Je.appTimerStop("rendererDraw"),this._idlenessTracker.setPreviousRenderStatus(r),this._uiRenderData.particles!=null&&this._uiRenderData.particles.length!=0&&this._viewport.invalidate(),this.isTopLevelTransitionOngoing()&&this._multiplayer.onTransitionFrame(this._renderer.transitionProgressTracker().progress())}this.afterFrame!=null&&this.afterFrame(),this.afterFirstRenderOfScreenStack!=null&&t&&this.afterFirstRenderOfScreenStack(),this._pointerEventDelegate.maybeProcessStoredPointerRelease()}_findHotspotsToAnimate(){let e=o=>{let i=o.canvasSpaceScrolledInteractiveBounds(1),a=o.canvasSpaceScrolledInteractiveBounds(0);return new wl(i,a)},t=this._appState.prototypeState(),n=this._appState.baseScreenNode();if(!(!this._showHotspots||!t.getTransitionOnClick()||this._hotspotAnimation.getOpacity()<=0)&&n!=null){let o=(a,s)=>{var d;let c,l=s.event().interactionType(),u=(d=s.action())==null?void 0:d.value;if(l=="ON_MEDIA_HIT"||l=="ON_MEDIA_END")return!1;if(s.actions().length==1&&u.navigationType()=="SWAP_STATE"){if(["ON_HOVER","ON_PRESS","AFTER_TIMEOUT"].indexOf(l)!=-1)return!1;if(a!=null)return jt.whichInstanceToSwap(a,u==null?void 0:u.transitionNodeID())!=null}return!0},i=t.getTopmostOverlayNode();if(i!=null){let a=t.getTopmostOverlay();return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(i,0,o).map(s=>{let c=e(s),l=a.overlaySpaceToBaseTlfSpace2(n,c.canvasSpaceBounds),u=a.overlaySpaceToBaseTlfSpace2(n,c.canvasSpaceClipBounds);return new wl(l,u)})}else return this._appState.prototypeStructure().findHotspotsWithNoodleFilter(n,1,o).map(e)}return null}hitTestDeviceFrame(e){let t=this._appState.getActiveCanvas();if(t==null)return!1;let n=this._appState.baseScreenNode();if(n==null)return!1;let r=this._renderer.deviceRenderer();if(r==null||!r.canRenderDeviceFrame(t.prototypeDevice()))return!1;let o=r.pixelAtPosition(e,n.canvasSpaceBoundingBox(),t.prototypeDevice());return E.alpha(o)>0}hitTestBaseScreen(e){let t=this._appState.baseScreenNode();if(t==null)return 0;let n=this._canvasSpacePoint(e),r=t.canvasSpaceBoundingBox();return r.contains2(n)?r.leftThird().contains2(n)?1:r.rightThird().contains2(n)?3:2:0}_canvasSpacePoint(e){return this._viewport.canvasSpaceToViewSpace1().clone().inverseTransformPoint(e.clone())}canvasContentBounds(){var t;let e;return(t=this._appState.getActiveCanvas())==null?void 0:t.canvasSpaceRenderedBounds()}setMaximumDrawingBufferSizeForTesting(e){this._renderer.getContext().setMaximumDrawingBufferSizeForTesting(e)}clearMaximumDrawingBufferSizeForTesting(){this._renderer.getContext().clearMaximumDrawingBufferSizeForTesting()}triggerResizeForTesting(){let e=this._cachedAbsoluteBounds,t=e.clone();t.setWidth(t.width()-1),this._cachedAbsoluteBounds=t,this._resize(),this._cachedAbsoluteBounds=e,this._resize()}toggleRenderTreePrinting(){this._renderer.toggleRenderTreePrinting()}invalidateIdlenessTracker(){this._idlenessTracker.handleInteraction()}_nonNull(e){return e}_setupInteractionHandlers(e){let t=o=>i=>{Je.appTimerStart("discreteUserAction"),o(i),Je.appTimerStop("discreteUserAction")},n=o=>i=>{Je.appTimerStart("mouseMove"),o(i),Je.appTimerStop("mouseMove")},r=o=>i=>{Je.appTimerStart("dragUserAction"),o(i),Je.appTimerStop("dragUserAction")};$n.addUpdate(zt.mousePress(this.events()),t(o=>{this._pointerEventDelegate.onMousePress(this._nonNull(o.asMouseEvent()))})),$n.addUpdate(zt.mouseDrag(this.events()),r(o=>{this._pointerEventDelegate.onDrag(this._nonNull(o.asMouseEvent()))})),$n.addUpdate(zt.mouseRelease(this.events()),t(o=>{this._pointerEventDelegate.onMouseRelease(this._nonNull(o.asMouseEvent()))})),$n.addUpdate(zt.mouseMove(this.events()),n(o=>{this._pointerEventDelegate.onMouseMove(this._nonNull(o.asMouseEvent()))})),$n.addUpdate(zt.mouseScroll(this.events()),r(o=>{this._pointerEventDelegate.onMouseScroll(this._nonNull(o.asMouseEvent()))})),$n.addUpdate(zt.mouseLeave(this.window().root().events()),t(o=>{this._pointerEventDelegate.onMouseLeave(this._nonNull(o.asMouseEvent()))})),$n.addUpdate(zt.touchPress(this.events()),t(o=>{this._pointerEventDelegate.onTouchPress(this._nonNull(o.asTouchEvent()))})),$n.addUpdate(zt.touchDrag(this.events()),r(o=>{this._pointerEventDelegate.onDrag(this._nonNull(o.asTouchEvent()))})),$n.addUpdate(zt.touchRelease(this.events()),t(o=>{this._pointerEventDelegate.onTouchRelease(this._nonNull(o.asTouchEvent()))})),$n.addUpdate(zt.keyPress(this.events()),t(o=>{this._pointerEventDelegate.onKeyPress(o.asKeyEvent(),e)})),$n.addUpdate(zt.gamepadDown(this.events()),t(o=>{this._pointerEventDelegate.onGamepadDown(o.asGamepadEvent())}))}_updateHoveredStateInstanceIfNeeded(e){var o;let t,n=this._appState.prototypeState(),r=(o=n.getStateMachineInitiatedChange(e))!=null?o:n.getStateMachineLastChangeInHistory(e);r!=null&&r.cause==2?this._hoveredStateInstances.set(e.toString(),r):this._hoveredStateInstances.delete(e.toString())}_onCommitOrAbortForInteractions(e,t,n){if(this._triggerPotentialTimedTransition(e,t),Q.getFeatureFlags().prototypeVideosV2&&this._createVideoTriggerEvents(e),Q.getFeatureFlags().prototypeNewMouseEvents&&this._mouseEnteredNodesManager.markNodesAsNotEnteredWithoutTriggeringMouseLeave(e.map(r=>r.id())),n!=null&&this._currentMouseLocation!=null&&!this._mostRecentTransitionViaArrows){let r=this._currentMouseLocation;this._microtasksSinceLastFrame=this._microtasksSinceLastFrame+1,this._microtasksSinceLastFrame<=this.MAX_MICROTASKS_PER_FRAME&&Sl(()=>{this._handleInteractionsForMove(r)})}}_createCallbackForMediaEvent(e,t,n){return()=>{this.triggerHotspot(e,t,n,null)}}_createVideoTriggerEvents(e){if(!this._appState.prototypeState().interactionsEnabled())return;let t=new Set([qt.TransitionAction_mapToInteractionType(20),qt.TransitionAction_mapToInteractionType(21)]),n=o=>t.has(o.event().interactionType()),r=this._appState.prototypeStructure().findHotspotsWithInteractionFilterWithinMultipleNodes(new Set(e),0,n);for(let o of r)this._registerMediaEventsForHotspot(o)}_registerMediaEventsForHotspot(e){let t=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(e.node,qt.TransitionAction_mapToInteractionType(20));for(let r of t){let o=r.event().mediaHitTime();this._appState.videoManager().addInteractionEvent(r,e.node.id(),o,this._createCallbackForMediaEvent(e,r,20))}let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(e.node,qt.TransitionAction_mapToInteractionType(21));for(let r=0,o=n.length;r<o;r=r+1){let i=n[r],a=this._createCallbackForMediaEvent(e,i,21);if(this._appState.videoManager().addInteractionEvent(i,e.node.id(),0,a),r+1<n.length){let s=n[r+1];if(this._shouldTriggerVariantInteractionWithMediaAction(i,s)){let c=this._createCallbackForMediaEvent(e,s,21);this._appState.videoManager().addInteractionEvent(s,e.node.id(),0,c)}}}}_triggerPotentialTimedTransition(e,t){if(!this._appState.prototypeState().interactionsEnabled())return;let n=[],r=[],o=null,i=null;for(let s of e){let c=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(s,qt.TransitionAction_mapToInteractionType(1));for(let l of c)l.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE")!=null?(n.push(l),r.push(s)):(o==null||l.event().transitionTimeout()<o.event().transitionTimeout())&&(o=l,i=s)}o!=null&&(n.push(o),r.push(i));let a=0;n.forEach(s=>{var m;let c,l=r[a];a=a+1;let u=s.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),d=u!=null?(m=jt.whichInstanceToSwap(l,u.transitionNodeID()))==null?void 0:m.stablePath():null,h=this._appState.prototypeState(),S=d!=null?h.actionCountersForStateAndAncestors(d):[h.actionCounter()],f=this._appState.nodeTransitionTracker().topmostScreenChangeCounter(),y=l.stablePath(),v=()=>{var j;let p,_=(j=this._appState.scene())==null?void 0:j.findNode3(y);if(_==null)return;let T=d!=null?h.actionCountersForStateAndAncestors(d):[h.actionCounter()];this._appState.nodeTransitionTracker().topmostScreenChangeCounter()==f&&ie.List_equalsWithComparison(S,T,(te,Y)=>te==Y)&&this.triggerDelayedHotspot(_.id(),s,1)},b=s.event().transitionTimeout()*1e3|0;(t==18||t==19)&&(b=Math.max(500,b)),setTimeout(v,b)})}_updateCursorType(e){if(!this._appState.prototypeState().interactionsEnabled()){this.setCursor(0);return}if(tt.OS_isMobile(this.getRelevantOS())){this.setCursor(2);return}let t=this._appState.baseScreenNode();if(t==null){this.setCursor(0);return}let n=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_CLICK",0);n==null&&(n=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_PRESS",0)),n==null&&(n=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_DOWN",0)),n==null&&(n=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_UP",0)),n!=null&&!R.equals(n.node.id(),t.id())?this.setCursor(1):this.setCursor(0)}_handleMaintainedInteraction(e,t,n){var f;let r;if(!this._appState.prototypeState().interactionsEnabled()||t==null)return;let o=e.node.id(),i=t.event().interactionType(),a=0;if(Q.getFeatureFlags().prototypeNewMouseEvents){if(this._maintainedData.getByHotspotAndInteractionType(o,i)!=null)return;a=this._maintainedData.set(o,i,n)}else{if(R.equals(this._maintainedDataLegacy.delayedHotspotId(),o))return;this._maintainedDataLegacy.set(o,i,n),a=this._maintainedDataLegacy.counter()}let s=t.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),c=s!=null?(f=jt.whichInstanceToSwap(e.node,s.transitionNodeID()))==null?void 0:f.stablePath():null,l=c!=null?this._appState.prototypeState().actionCounterForState(c):-1,u=this._appState.prototypeState().actionCounter(),d=()=>{var k;let y,v=this._maintainedData.getByHotspotAndInteractionType(o,i);if(v==null)return;let b=v.counter(),m=c!=null?this._appState.prototypeState().actionCounterForState(c):-1,p=this._appState.prototypeState().actionCounter(),_=(k=this._appState.scene())==null?void 0:k.findNode1(o),T=a==b,N=T&&u==p&&l==m;T&&this._maintainedData.resetEntry(o,i),N&&_!=null&&this.triggerDelayedHotspot(_.id(),t,v.action())},h=()=>{var T;let y;if(this._maintainedDataLegacy.delayedHotspotId()==null)return;let v=this._maintainedDataLegacy.counter(),b=c!=null?this._appState.prototypeState().actionCounterForState(c):-1,m=this._appState.prototypeState().actionCounter(),p=(T=this._appState.scene())==null?void 0:T.findNode1(this._maintainedDataLegacy.delayedHotspotId());a==v&&u==m&&l==b&&p!=null&&(this.triggerDelayedHotspot(p.id(),t,this._maintainedDataLegacy.action()),this._maintainedDataLegacy.reset())},S=Q.getFeatureFlags().prototypeNewMouseEvents?d:h;setTimeout(S,t.event().interactionDuration()*1e3|0)}_handleMouseEnterMouseLeave(e){let t=this._canvasSpacePoint(e);this._mouseEnteredNodesManager.updateEnteredNodes(t),this._mouseEnteredNodesManager.resetNoLongerMaintainedMouseEnterOrLeaveInteractions(this._maintainedData);let n=be.WasHandled.NOT_HANDLED,r=this._appState.prototypeState().actionCounter(),o=this._appState.prototypeState(),i=o.getTopmostOverlayNode(),a=this._appState.baseScreenNode(),s=i!=null?i:a,c=o.getSecondTopmostOverlayNodeOrBaseScreen(),l=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(s,0,S=>S.event().interactionType()=="MOUSE_LEAVE");if(c!=null){let S=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(c,0,f=>f.event().interactionType()=="MOUSE_LEAVE");ie.List_append2(l,S)}let u=this._appState.prototypeStructure().findHotspotsWithInteractionFilter(s,0,S=>S.event().interactionType()=="MOUSE_ENTER"),d=this._mouseEnteredNodesManager.getNewlyLeftMouseLeaveHotspotsInOrderOfLeaving(l);for(let S of d){let f=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(S.node,"MOUSE_LEAVE"),y=this._appState.prototypeState().actionCounter();if(r!=y)return n;n=this._triggerOrHandleMaintainedInteractions(f,S,13,e)}let h=this._mouseEnteredNodesManager.getNewlyEnteredMouseEnterHotspotsInOrderOfEntering(u);for(let S of h){let f=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(S.node,"MOUSE_ENTER"),y=this._appState.prototypeState().actionCounter();if(r!=y)return n;n=this._triggerOrHandleMaintainedInteractions(f,S,12,e)}return n}_handleInteractionsForMove(e){if(this._appState.scene()==null||!this._appState.prototypeState().interactionsEnabled())return;this._updateCursorType(e);let t=be.WasHandled.NOT_HANDLED;Q.getFeatureFlags().prototypeNewMouseEvents&&(t=this._handleMouseEnterMouseLeave(e)),t=this._handleGranularMoveForDeprecatedMouseInMouseOut(e),t==be.WasHandled.NOT_HANDLED&&(this._handleHover1(e),this._handleReverseHover(e))}_handleGranularMoveForDeprecatedMouseInMouseOut(e){let t=10,n=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_IN",1);if(!Q.getFeatureFlags().prototypeNewMouseEvents&&n==null&&(n=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_ENTER",1),t=12),n==null&&(n=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_OUT",1),t=11),!Q.getFeatureFlags().prototypeNewMouseEvents&&n==null&&(n=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_LEAVE",1),t=13),Q.getFeatureFlags().prototypeNewMouseEvents?this._maintainedData.resetAllEntriesMatchingPredicate((o,i)=>["MOUSE_IN","MOUSE_OUT"].indexOf(i)!=-1&&!R.equals(n!=null?n.node.id():null,o)):["MOUSE_IN","MOUSE_OUT","MOUSE_ENTER","MOUSE_LEAVE"].indexOf(this._maintainedDataLegacy.interaction())!=-1&&!R.equals(n!=null?n.node.id():null,this._maintainedDataLegacy.delayedHotspotId())&&this._maintainedDataLegacy.reset(),n==null)return be.WasHandled.NOT_HANDLED;let r=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(n.node,qt.TransitionAction_mapToInteractionType(t));return this._triggerOrHandleMaintainedInteractions(r,n,t,e)}_handleHover1(e){let t=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_HOVER",1);return this._handleHover2(t,e)}handleHoverAtHotspot(e){return this._mostRecentTransitionViaArrows=!0,this._handleHover2(e,null)}_handleHover2(e,t){if(e!=null){let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(e.node,qt.TransitionAction_mapToInteractionType(2));for(let r of n)return this.triggerHotspot(e,r,2,t),r.setHoverLastHandledFrameNum(this.mostRecentFrameNum()),be.WasHandled.HANDLED}return be.WasHandled.NOT_HANDLED}handleReverseHoverAtHotspot(e){var o;let t,n=e.node,r=Me.StringMap_get(this._hoveredStateInstances,e.node.stablePath().toString(),null);return r==null||!R.equals((o=n.topLevelAncestor())==null?void 0:o.id(),this._appState.prototypeState().getTopmostScreenId())?be.WasHandled.NOT_HANDLED:(this._appState.prototypeState().returnInstanceToState(r.stablePath,2,6),be.WasHandled.HANDLED)}_handleReverseHover(e){var b,m,p,_;let t,n,r,o;if(this._multiplayer.isObserving())return be.WasHandled.HANDLED;let i=this._appState.prototypeState();if(this._appState.scene().interactiveComponentsEnabled()){let T=be.WasHandled.NOT_HANDLED;for(let N of Array.from(this._hoveredStateInstances.keys())){let k=Me.StringMap_get(this._hoveredStateInstances,N,null);if(k==null)continue;let j=this._appState.scene().findNode3(k.stablePath);if(j==null||!R.equals((b=j.topLevelAncestor())==null?void 0:b.id(),i.getTopmostScreenId()))continue;let te=(m=k==null?void 0:k.canvasSpaceTriggerBoundsOrNull)==null?void 0:m.clone(),Y=i.getCurrentBaseScreenNode();if(te!=null&&Y!=null){let _e=null,ce=this._canvasSpacePoint(e),V=this._appState.prototypeState().getTopmostOverlay();if(_e=(p=V==null?void 0:V.baseTlfSpaceToOverlaySpace1(Y,ce))!=null?p:ce,j.scrollAndClipBoundsBySelfAndAncestors(te,0).contains2(_e))continue;i.returnInstanceToState(k.stablePath,2,6),T=be.WasHandled.HANDLED;break}}if(T==be.WasHandled.HANDLED)return T}let a=(_=this._appState.prototypeState().getInitiatedChange())!=null?_:this._appState.prototypeState().getLastChangeInHistory(),s=a==null?void 0:a.canvasSpaceTriggerBoundsOrNull;if(!(s!=null&&a.cause==2))return be.WasHandled.NOT_HANDLED;let l=null;if(l=this._appState.scene().findNode1(a==null?void 0:a.oldStateId()),l==null)return be.WasHandled.NOT_HANDLED;let u=null,d=this._canvasSpacePoint(e);R.equals(a==null?void 0:a.oldStateId(),a==null?void 0:a.newStateId())||(d=this._canvasSpacePointInPreviousFrame(l,this._appState.baseScreenNode(),d));let h=a==null?void 0:a.oldOverlays(this._appState.prototypeState());h.length>0?u=ie.List_last(h).baseTlfSpaceToOverlaySpace1(l,d):u=d;let S=a!=null?a.interactionAddress.hotspotStablePath:null,f=this._retrieveReverseInteractionHotspotFromStoredData(S);if(f==null||f.scrollAndClipBoundsBySelfAndAncestors(s,0).contains2(u))return be.WasHandled.NOT_HANDLED;let v=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(this._retrieveReverseInteractionHotspotFromStoredData(S),qt.TransitionAction_mapToInteractionType(2));for(let T of v){if(T.getHoverLastHandledFrameNum()==this.mostRecentFrameNum())break;return this.requestBack(f,T,2,6,null,null),be.WasHandled.HANDLED}return be.WasHandled.NOT_HANDLED}_retrieveReverseInteractionHotspotFromStoredData(e){return this._appState.scene().findNode3(e)}_handleInteractionsForPress(e){if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return be.WasHandled.HANDLED;Q.getFeatureFlags().prototypeNewMouseEvents?this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_UP"):this._maintainedDataLegacy.interaction()=="MOUSE_UP"&&this._maintainedDataLegacy.reset();let t=this._handleMouseDown(e);return t==be.WasHandled.NOT_HANDLED&&(t=this._handlePress(e)),t}_handleMouseDown(e){if(!this._appState.prototypeState().interactionsEnabled())return be.WasHandled.HANDLED;let t=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_DOWN",1);if(t==null)return be.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,qt.TransitionAction_mapToInteractionType(8));return this._triggerOrHandleMaintainedInteractions(n,t,8,e)}_handlePress(e){if(!this._appState.prototypeState().interactionsEnabled())return be.WasHandled.HANDLED;let t=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_PRESS",1);if(t==null)return be.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,qt.TransitionAction_mapToInteractionType(3));for(let r of n){let o=t.node.stablePath(),i=r.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE");if(i!=null){let a=jt.whichInstanceToSwap(t.node,i.transitionNodeID());this._lastPressData=new yu(a==null?void 0:a.stablePath(),o)}else this._lastPressData=new yu(null,o);return this.triggerHotspot(t,r,3,e),be.WasHandled.HANDLED}return be.WasHandled.NOT_HANDLED}maybeHandleSingleTapAsNavigation(e){if(this._appState.scene()==null||this._appState.getActiveCanvas()==null)return!1;if(this._appState.prototypeStructure().currentType()==1){let r=this.hitTestBaseScreen(e);if(r!=0&&r!=2){let o=r==1?-1:1;return o==1?this.navigateForward(17):this.navigateBackward(17),Math.random()<this.INTERACTION_REPORTING_RATE&&Je.trackEvent1("prototype_view_interaction",new Map([["type","navigateViaArrows"],["direction",o==1?"FORWARD":"REVERSE"],["inputType","tap"],["nonInteraction",0],["prototypeType",oi[this._appState.prototypeStructure().currentType()]]])),!0}}return!1}maybeAdvanceViaSwipeGesture(e,t){if(!this._appState.prototypeState().interactionsEnabled())return!1;let n=this._appState.getActiveCanvas();if(!(this._appState.prototypeStructure().currentType()==0)||this._appState.storedPrototypeDevice().type=="PRESENTATION"||this._appState.storedPrototypeDevice().type=="NONE"){let o=e==null?!1:e.overflowDirection()=="BOTH"||e.overflowDirection()=="HORIZONTAL",i=e==null||e==n||!o;if(Q.getViewerMode()==Q.ViewerMode.PROTOTYPE&&Math.abs(t.x())>Math.abs(t.y())&&i)return t.x()>0?this.navigateBackward(18):this.navigateForward(19),!0}return!1}_handleInteractionsForRelease(e,t,n){let r=this._lastPressData;if(this._lastPressData=null,!this._appState.prototypeState().interactionsEnabled())return be.WasHandled.HANDLED;Q.getFeatureFlags().prototypeNewMouseEvents?this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"):this._maintainedDataLegacy.interaction()=="MOUSE_DOWN"&&this._maintainedDataLegacy.reset();let o=this._appState.prototypeState().isDragging(),i=this._viewport.viewSpaceToCanvasSpace1().transformPoint(e.clone());if(this._interactionObservers.forEach(l=>{l.handleRelease(i)}),o)return this._appState.prototypeState().setIsDragging(!1),be.WasHandled.HANDLED;let a=this._handleMouseUp(e);a==be.WasHandled.NOT_HANDLED&&t&&(a=this._handleClick(e)),a==be.WasHandled.NOT_HANDLED&&(a=this._handleReversePress(r));let s=a==be.WasHandled.NOT_HANDLED,c=n==be.WasHandled.NOT_HANDLED;return s&&c&&Pi.notifyUnhandledMouseRelease(this._appState,i),a}_handleMouseUp(e){if(!this._appState.prototypeState().interactionsEnabled())return be.WasHandled.HANDLED;let t=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_UP",1);if(t==null)return be.WasHandled.NOT_HANDLED;let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,qt.TransitionAction_mapToInteractionType(9));return this._triggerOrHandleMaintainedInteractions(n,t,9,e)}_handleReversePress(e){if(!this._appState.prototypeState().interactionsEnabled()||this._multiplayer.isObserving())return be.WasHandled.HANDLED;if(e==null)return be.WasHandled.NOT_HANDLED;if(e.swappedStablePath!=null)return this._appState.prototypeState().returnInstanceToState(e.swappedStablePath,2,7),be.WasHandled.HANDLED;{let t=e.hotspotStablePath!=null?this._retrieveReverseInteractionHotspotFromStoredData(e.hotspotStablePath):null,n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t,qt.TransitionAction_mapToInteractionType(3));for(let r of n)return this.requestBack(t,r,2,7,null,null),be.WasHandled.HANDLED}return be.WasHandled.NOT_HANDLED}_handleClick(e){if(this.disengageObservationMode(),!this._appState.prototypeState().interactionsEnabled())return be.WasHandled.HANDLED;let t=this._hotspotAtViewportSpacePointWithInteractionType(e,"ON_CLICK",1);if(t!=null){let n=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(t.node,qt.TransitionAction_mapToInteractionType(4));for(let r=0,o=n.length;r<o;r=r+1){let i=n[r];if(this.triggerHotspot(t,i,4,e),r+1<n.length){let a=n[r+1];this._shouldTriggerVariantInteractionWithMediaAction(i,a)&&this.triggerHotspot(t,a,4,e)}return be.WasHandled.HANDLED}}if(this._shouldCloseTopmostOverlayOnClickOutside(e)){let n=this._appState.prototypeState().getCurrentOverlayData().length-1;return this._appState.prototypeState().closeOverlayAtAndAbove(n,1),be.WasHandled.HANDLED}return be.WasHandled.NOT_HANDLED}performHotspotAnimationOnClick(){this._hotspotAnimation.onClick()}_handleInteractionsForDrag(e){if(Q.getFeatureFlags().prototypeNewMouseEvents){let n=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_DOWN",1);this._maintainedData.resetAllEntriesMatchingPredicate((r,o)=>o=="MOUSE_DOWN"&&!R.equals(n!=null?n.node.id():null,r))}else if(this._maintainedDataLegacy.interaction()=="MOUSE_DOWN"){let n=this._hotspotAtViewportSpacePointWithInteractionType(e,"MOUSE_DOWN",1);R.equals(n!=null?n.node.id():null,this._maintainedDataLegacy.delayedHotspotId())||this._maintainedDataLegacy.reset()}let t=this._viewport.viewSpaceToCanvasSpace1().transformPoint(e.clone());this._interactionObservers.forEach(n=>{n.handleDrag(t)})}_handleDragStart(e,t,n){if(!this._appState.prototypeState().interactionsEnabled()||this._appState.prototypeState().isDragging())return be.WasHandled.HANDLED;if(t==null)return be.WasHandled.NOT_HANDLED;let r=this._appState.prototypeStructure().findPrototypeInteractionWithId(t!=null?R.toString(t.id()):null,R.toString(n));if(r==null)return be.WasHandled.NOT_HANDLED;this.triggerHotspot(new Eo(t),r,5,e),this._appState.prototypeState().setIsDragging(!0);let o=this._viewport.viewSpaceToCanvasSpace1().transformPoint(e.clone());return this._interactionObservers.forEach(i=>{i.handleDragStart(o)}),be.WasHandled.HANDLED}_handleInteractionsForScroll(){this._handleScrollAndFindNewNodeToScroll(null)}_handleScrollAndFindNewNodeToScroll(e){if(Q.getFeatureFlags().prototypeNewMouseEvents?this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"):this._maintainedDataLegacy.interaction()=="MOUSE_DOWN"&&this._maintainedDataLegacy.reset(),this._lastPressData!=null){if(e==null)return null;let t=e==this._appState.baseScreenNode();this._handleReversePress(this._lastPressData),this._lastPressData=null;let n=this._appState.baseScreenNode();if(n==null)return null;if(t)return this._appState.baseScreenNode();{let r=n.scrollableFrameDescendants();return be.findMatchingTransitionNode(e,r)}}return e}_handleFling(e,t){var c;let n,r=t.length,o=We.seconds(),i=this._appState.getActiveCanvas();if(i==null)return be.WasHandled.NOT_HANDLED;if(!this._appState.prototypeState().interactionsEnabled())return be.WasHandled.HANDLED;let a=(c=i.scene())==null?void 0:c.findNode1(e),s=50*or();this._initialFlingVelocity=new I(0,0);for(let l=r-1;l>=0;l=l-1)if(l==0||o-t[l-1].startTime>.1){let u=t[l],d=t[r-1],h=d.startLocation.subtract1(u.startLocation).divide(d.startTime-u.startTime),S=h.length(),f=Math.log(1+S)/5,y=S*f/5,v=h.multiply(y/S);if(u!=d&&S>s){if(Q.getFeatureFlags().swipePresentation&&this.maybeAdvanceViaSwipeGesture(a,h))break;if(a==null||a==i)this._viewport.flingCameraOffset(v,f);else{this._initialFlingVelocity=this.restrictScrollDeltaAxes(a,h).negative();let b=be._scrollPhysics.createBallisticScrollSimulation(a.scrollOffset(),this._initialFlingVelocity,a.minScrollOffsetX(),a.maxScrollOffsetX(),a.minScrollOffsetY(),a.maxScrollOffsetY());return b!=null&&(be._scrollAnimationManager=new Qs(b,a.id())),be.WasHandled.HANDLED}}break}return be.WasHandled.NOT_HANDLED}_handleInteractionsForLeave(){Q.getFeatureFlags().prototypeNewMouseEvents?(this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_DOWN"),this._maintainedData.resetAllEntriesWithInteractionType("MOUSE_IN")):(this._maintainedDataLegacy.interaction()=="MOUSE_DOWN"||this._maintainedDataLegacy.interaction()=="MOUSE_IN")&&this._maintainedDataLegacy.reset(),this._handleInteractionsForMove(ye.FrozenVector_new4(-1,-1))}_handleInteractionsForKeyPress(e){let t=this._appState.prototypeState().getTopmostScreen(),n=this._appState.prototypeStructure().findHotspotsWithInteractionType(t,0,"ON_KEY_DOWN"),r=this._createListFromKeyEvent(e),o=a=>(a=tt.OS_current()!=4&&a==this.META_CODE?this.CONTROL_CODE:a,r.some(s=>s.indexOf(a)!=-1)),i=a=>{let s=a.event().keyTrigger().triggerDevice=="KEYBOARD",c=a.event().keyTrigger().keyCodes;if(c==null)return!1;let l=c.length==r.length;return s&&l&&c.every(o)};for(let a of n){let c=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(a.node,qt.TransitionAction_mapToInteractionType(14)).filter(i);for(let l=0,u=c.length;l<u;l=l+1){let d=c[l];if(this.triggerHotspot(a,d,14,null),l+1<c.length){let h=c[l+1];this._shouldTriggerVariantInteractionWithMediaAction(d,h)&&this.triggerHotspot(a,h,14,null)}return e.accept(),be.WasHandled.HANDLED}}return be.WasHandled.NOT_HANDLED}_createListFromKeyEvent(e){let t=[];return(1&e.modifiers())!=0&&t.push([this.ALT_CODE]),(4&e.modifiers())!=0&&t.push([this.SHIFT_CODE]),(2&e.modifiers())!=0&&t.push([this.META_CODE]),(8&e.modifiers())!=0&&t.push([this.CONTROL_CODE]),qs.Key_isModifier(e.key)||t.push(qs.Key_keyToKeyCode(e.key)),t}_handleInteractionsForGamepadDown(e){let t=this._appState.prototypeState().getTopmostScreen(),n=o=>{let i=o.event().keyTrigger().triggerDevice!="KEYBOARD";return o.event().keyTrigger().keyCodes==null?!1:i&&o.event().keyTrigger().keyCodes.indexOf(e.button)!=-1},r=this._appState.prototypeStructure().findHotspotsWithInteractionType(t,0,"ON_KEY_DOWN");for(let o of r){let a=this._appState.prototypeStructure().findPrototypeInteractionsWithInteractionType(o.node,qt.TransitionAction_mapToInteractionType(14)).filter(n);for(let s=0,c=a.length;s<c;s=s+1){let l=a[s];if(this.triggerHotspot(o,l,14,null),s+1<a.length){let u=a[s+1];this._shouldTriggerVariantInteractionWithMediaAction(l,u)&&this.triggerHotspot(o,u,14,null)}return e.accept(),be.WasHandled.HANDLED}}return be.WasHandled.NOT_HANDLED}addInteractionObserver(e){this._interactionObservers.add(e)}removeInteractionObserver(e){this._interactionObservers.remove(e)}_hotspotAtViewportSpacePointWithInteractionType(e,t,n){if(!this._appState.prototypeState().getTransitionOnClick())return null;let r=this._canvasSpacePoint(e);return this._hotspotAtCanvasSpacePointWithInteractionType(r,t,n)}_hotspotAtCanvasSpacePointWithInteractionType(e,t,n){let r=this._appState.baseScreenNode();if(r==null||!r.canvasSpaceBoundingBox().contains2(e)&&t!="MOUSE_OUT")return null;let o=this._appState.prototypeState(),i=o.getTopmostOverlayNode();if(i!=null){let a=o.getTopmostOverlay().baseTlfSpaceToOverlaySpace1(r,e);return this._appState.prototypeStructure().hotspotOnPresentedNode(i,a,t,n)}else return this._appState.prototypeStructure().hotspotOnPresentedNode(r,e,t,n)}_canvasSpacePointInPreviousFrame(e,t,n){if(e==t)return n;let r=t.absoluteTransform().clone();if(!r.invert())return n;let o=e.absoluteTransform(),i=n.clone();return r.transformPoint(i),o.transformPoint(i),i}_updateUserCursor(e){this._currentMouseLocation=e==null?void 0:e.locationInView(this),this._sendMouseCursorUpdate()}_shouldCloseTopmostOverlayOnClickOutside(e){let t=this._appState.prototypeState().getTopmostOverlay(),n=this._appState.prototypeState().getTopmostOverlayNode(),r=this._appState.baseScreenNode();if(r==null||n==null||t.backgroundInteraction()!="CLOSE_ON_CLICK_OUTSIDE")return!1;let o=this._canvasSpacePoint(e),i=t.baseTlfSpaceToOverlaySpace1(r,o);return!n.canvasSpaceBoundingBox().contains2(i)}_recordViewportSpaceClick(e){let t=this._canvasSpacePoint(e);t!=null&&this._multiplayer.recordCanvasSpaceClick(t)}_sendMouseCursorUpdate(){if(this._currentMouseLocation==null)this._multiplayer.setCanvasSpaceMouse(null);else{let e=this._canvasSpacePoint(this._currentMouseLocation);e!=null&&this._multiplayer.setCanvasSpaceMouse(e)}}_triggerMouseAction(e,t){this._appState.triggerAction2(e,Z.new9(t))}_triggerOrHandleMaintainedInteractions(e,t,n,r){for(let o=0,i=e.length;o<i;o=o+1){let a=be.WasHandled.NOT_HANDLED,s=e[o];if(s.event().interactionMaintained()?(this._handleMaintainedInteraction(t,s,n),a=be.WasHandled.MAINTAINED):(this.triggerHotspot(t,s,n,r),a=be.WasHandled.HANDLED),o+1<e.length){let c=e[o+1];this._shouldTriggerVariantInteractionWithMediaAction(s,c)&&(s.event().interactionMaintained()?(this._handleMaintainedInteraction(t,c,n),a=be.WasHandled.MAINTAINED):(this.triggerHotspot(t,c,n,r),a=be.WasHandled.HANDLED))}return a}return be.WasHandled.NOT_HANDLED}_shouldTriggerVariantInteractionWithMediaAction(e,t){let n=e.allActions().length>=1&&e.allActions().every(s=>s.connectionType()=="UPDATE_MEDIA_RUNTIME"),r=e.allActions().length>=1&&e.allActions().every(s=>R.isValid(s.transitionNodeID())),o=t.getFirstActionInInteractionWithSpecificNavigation("SWAP_STATE"),i=o!=null&&o.connectionType()=="INTERNAL_NODE",a=n&&r&&i;return a&&Q.getFeatureFlags().prototypeLogVideoAndICSwap&&Je.trackEvent1("prototype_interaction_conflict_override_triggered",new Map([["interaction_type",e.event().interactionType()],["action_type",e.actions().map(s=>s.mediaAction())]])),a}static findBestScrollOrDragProposalInTree(e,t,n,r,o){let i=r==0,a=null;return a=(s,c)=>{var T,N,k;let l,u,d,h=s.canvasSpaceGeometryBounds().contains2(c),S=s.canvasSpaceBoundingBox().contains2(c);if(s.clipsToBoundingRectangle()&&!h&&!S)return null;let f=null;for(let j=0,te=s.childCount();j<te;j=j+1){let Y=s.childAt2(s.childCount()-j-1,!0),_e=c,ce=Q.getFeatureFlags().prototypeTemporaryStickyScroll?ni.getScrollTranslationOfNodeRelativeToParent1(Y):ni.getScrollOffsetOfNodeFromParent_DEPRECATED(Y);_e=c.add1(ce);let V=a(Y,_e);f=(T=f==null?void 0:f.updateToBestProposal1(V))!=null?T:V}let y=s.scrollDirectionWithScrollableContent(),v=S||h,b=y!="NONE"&&v&&!s.isInvisibleOrTransparent(),m=v&&s.visible()&&s.prototypeInteractions().some(j=>j.event().interactionType()=="DRAG"&&j.allActions().some(te=>_s.isValidForConnection(j.event().interactionType(),te.connectionType()))),p=t.length()>0?t.divide(t.length()):t,_=null;if(v){if(b){let j=Ku(y),te=be.ScrollOrDragProposal.InteractionType.OVERSCROLL;Math.abs(p.y())>0&&Math.abs(j.y())>0&&(p.y()>0?s.scrollOffset().y()<s.maxScrollOffsetY():s.scrollOffset().y()>s.minScrollOffsetY())&&(te=be.ScrollOrDragProposal.InteractionType.SCROLL),Math.abs(p.x())>0&&Math.abs(j.x())>0&&(p.x()>0?s.scrollOffset().x()<s.maxScrollOffsetX():s.scrollOffset().x()>s.minScrollOffsetX())&&(te=be.ScrollOrDragProposal.InteractionType.SCROLL);let Y=nr.getDirectionSimilarity(y,p);(te==be.ScrollOrDragProposal.InteractionType.SCROLL||i)&&(_=new be.ScrollOrDragProposal(te,Y,s.id(),null))}if(o!=null&&m){let j=p.multiply(-1);for(let te of s.prototypeInteractions().filter(Y=>Y.event().interactionType()=="DRAG")){let Y=o(s,te),_e=Y!=null?j.dot(Y.divide(Y.length())):0;_=(N=_==null?void 0:_.updateToBestProposal2(be.ScrollOrDragProposal.InteractionType.DRAG,_e,s.id(),te.id()))!=null?N:new be.ScrollOrDragProposal(be.ScrollOrDragProposal.InteractionType.DRAG,_e,s.id(),te.id())}}}return _=(k=f==null?void 0:f.updateToBestProposal1(_))!=null?k:_,_},a(n,e)}static _canvasSpaceBoundsOfDeviceBackground(e,t){let n=wr.infoForDevice(t);if(n==null)return Kn.FrozenRect_EMPTY;let r=e.canvasSpaceBoundingBox().topLeft(),o=t.canvasSpaceFramePresetSize(n);return new B(r.x(),r.y(),o.x(),o.y())}static findBestScrollOrDragProposalInFrame(e,t,n,r,o,i){if(r==null)return null;let a=o!=null&&Ui.hasDevice(o.type),s=tt.OS_scrollPhysicsType(be._getRelevantOSForDevice(o)),c=Math.abs(n.y())>Math.abs(n.x())?"VERTICAL":"HORIZONTAL",l=r.scrollsInPreferredDirection(c)&&r.hasOverflowingContentInScrollDirection();if(r.canvasSpaceBoundingBox().contains2(t)){let u=be.findBestScrollOrDragProposalInTree(t,n,r,s,i);if(u!=null)return u;if(a)return null}else if(a){if(be._canvasSpaceBoundsOfDeviceBackground(r,o).contains2(t))return null}else if(l)return new be.ScrollOrDragProposal(be.ScrollOrDragProposal.InteractionType.SCROLL,1,r.id(),null);return new be.ScrollOrDragProposal(be.ScrollOrDragProposal.InteractionType.SCROLL,1,e==null?void 0:e.id(),null)}static copyScrollOffset(e,t,n){t!=null&&n!=null&&(e==null?n.setScrollOffset(t.scrollOffset()):e.updateScrollOffsetForNode(n,t.scrollOffset()))}static findMatchingTransitionNode(e,t){let n=t.filter(s=>s.name()==e.name());if(n.length==1)return n[0];let r=e.canvasSpaceBoundingBox(),o=t.filter(s=>s.canvasSpaceBoundingBox().size().approximatelyEquals(r.size(),1));if(o.length==0)return null;if(o.length==1)return o[0];let i=e.topLevelAncestor(),a=r.topLeft();i!=null&&a.subtractUpdate1(i.canvasSpaceBoundingBox().topLeft());for(let s of o){let c=s.canvasSpaceBoundingBox().topLeft(),l=s.topLevelAncestor();if(l!=null&&c.subtractUpdate1(l.canvasSpaceBoundingBox().topLeft()),a.approximatelyEquals(c,1))return s}return null}static matchNodesAndPreserveScroll(e,t,n){if(!R.equals(n.oldStateId(),n.newStateId())){let i=t.lastNodeForBaseScreen(),a=t.nextNodeForBaseScreen();be.findMatchingNodesAndPreserveScroll(e,i,a)}let r=n.oldStateAndOverlays.overlays,o=n.newStateAndOverlays.overlays;for(let i=0,a=Math.min(r.length,o.length);i<a;i=i+1)if(!R.equals(r[i].id,o[i].id)){let s=t.lastNodeForOverlayAt(i),c=t.nextNodeForOverlayAt(i);be.findMatchingNodesAndPreserveScroll(e,s,c)}}static findMatchingNodesAndPreserveScroll(e,t,n){if(t!=null&&n!=null){be.copyScrollOffset(e,t,n);let r=t.scrollableFrameDescendants(),o=n.scrollableFrameDescendants();for(let i of r){if(o.length==0)break;let a=be.findMatchingTransitionNode(i,o);a!=null&&(be.copyScrollOffset(e,i,a),ie.List_removeOne(o,a))}}}static clampScrollOffsetForNode(e,t){if(e.scrollDirection()=="NONE")return ye.FrozenVector_ZERO.clone();let n=I.new2();return e.scrollDirection()=="HORIZONTAL"?n.setX(Pe.Math_clamp1(t.x(),e.minScrollOffsetX(),e.maxScrollOffsetX())):e.scrollDirection()=="VERTICAL"?n.setY(Pe.Math_clamp1(t.y(),e.minScrollOffsetY(),e.maxScrollOffsetY())):e.scrollDirection()=="BOTH"&&(n.setX(Pe.Math_clamp1(t.x(),e.minScrollOffsetX(),e.maxScrollOffsetX())),n.setY(Pe.Math_clamp1(t.y(),e.minScrollOffsetY(),e.maxScrollOffsetY()))),n}static _getRelevantOSForDevice(e){return tt.OS_current()==2||tt.OS_current()==1||e==null?tt.OS_current():e.os()==2||e.os()==1?e.os():tt.OS_current()}getRelevantOS(){return this._appState.getActiveCanvas()==null?0:be._getRelevantOSForDevice(this._appState.getActiveCanvas().prototypeDevice())}_resetScrollForTlf(e){if(e!=null){this.updateScrollOffsetForNode(e,ye.FrozenVector_ZERO);let t=e.scrollableFrameDescendants();for(let n of t)this.updateScrollOffsetForNode(n,ye.FrozenVector_ZERO)}}getBestScrollOrDragProposal(e,t,n){let r=this._appState.getActiveCanvas();if(r==null)return null;if(this._appState.currentFitMode()==3&&this._viewport.zoomScale()!=1)return new be.ScrollOrDragProposal(be.ScrollOrDragProposal.InteractionType.SCROLL,1,r==null?void 0:r.id(),null);let o=this._canvasSpacePoint(t);if(o==null||this._appState.baseScreenNode()==null)return null;let i=null;e==be.ScrollOrDragQuerySet.SCROLL_OR_DRAG&&(i=(s,c)=>mn.computeDragVector1(s,c,this._appState.baseScreenNode(),this._appState.prototypeStructure(),this._appState.prototypeState()));let a=this._appState.prototypeState().getCurrentOverlays();for(let s=0,c=a.length;s<c;s=s+1){let l=a[a.length-s-1],u=l.node();if(u==null)continue;let d=l.baseTlfSpaceToOverlaySpace1(this._appState.baseScreenNode(),o);if(!u.canvasSpaceBoundingBox().contains2(d)){if(l.backgroundAppearance().backgroundType=="SOLID_COLOR")return null;continue}let h=be.findBestScrollOrDragProposalInFrame(r,d,n,u,this._appState.activePrototypeDevice(),i);return R.equals(h==null?void 0:h.targetNodeId,r==null?void 0:r.id())?null:h}return be.findBestScrollOrDragProposalInFrame(r,o,n,this._appState.baseScreenNode(),this._appState.activePrototypeDevice(),i)}_updateForAnimation(){if(be._scrollAnimationManager==null)return;let e=!be._scrollAnimationManager.isValid(this._appState.scene());e||(be._scrollAnimationManager.performScroll(this,this._appState.scene()),e=be._scrollAnimationManager.isDone()),e&&(this._cancelAnimationManager(),this._sequentialActionManager.runNextAction())}_cancelAnimationManager(){be._scrollAnimationManager=null}_maybeHandleOverdragRelease(){var r;let e;if(be._overscrolledNodeID==null)return;let t=(r=this._appState.scene())==null?void 0:r.findNode1(be._overscrolledNodeID);be._overscrolledNodeID=null,!(t==null||be.clampScrollOffsetForNode(t,t.scrollOffset()).equals(t.scrollOffset()))&&(be._scrollAnimationManager=new Qs(new Js(t.scrollOffset(),new I(0,0),t.minScrollOffsetX(),t.maxScrollOffsetX(),t.minScrollOffsetY(),t.maxScrollOffsetY()),t.id()))}setPhysicsForOS(e){switch(tt.OS_scrollPhysicsType(e)){case 0:{be._scrollPhysics=new mc;break}case 1:{be._scrollPhysics=new fc;break}case 2:{be._scrollPhysics=new vs;break}}}_maybeChangePhysicsForDevice(e){let t=this.getRelevantOS(),n=be._getRelevantOSForDevice(e);t!=n&&this.setPhysicsForOS(t)}updateScrollOffsetForNode(e,t){let n=be.clampScrollOffsetForNode(e,t),r=this.restrictScrollDeltaAxes(e,t),o=this._pointerEventDelegate.isDragging();if(e.scrollOffset().equals(n)&&(!o||e.scrollOffset().equals(t)))return!1;if(o&&!n.equals(t)){let a=be._scrollPhysics.applyOverscrollBehavior(r,n,e.scrollOffset(),e.size());a.equals(n)||(be._overscrolledNodeID=e.id(),n=a)}e.setScrollOffset(n),this._observers.forEach(a=>{a.didScrollNode(e)}),this._emitter.trigger("scrollNode",R.toString(e.id()));let i=e.id();return this._multiplayer.setScrollPosition(R.toString(i),e.scrollOffset()),!0}setScrollOffsetUnconditionally(e,t){e.setScrollOffset(t);let n=e.id();this._multiplayer.setScrollPosition(R.toString(n),t)}restrictScrollDeltaAxes(e,t){let n=t.clone();switch(e.scrollDirection()){case"HORIZONTAL":{n.setY(0);break}case"VERTICAL":{n.setX(0);break}case"NONE":{n.setX(0),n.setY(0);break}case"BOTH":{let r=null;switch(e.overflowDirection()){case"NONE":{r="NONE";break}case"HORIZONTAL":{r="HORIZONTAL";break}case"VERTICAL":{r="VERTICAL";break}case"BOTH":{r="BOTH";break}}!nr.scrollsHorizontally(r)&&!e.hasOverflowingContentInXDirection()&&n.setX(0),!nr.scrollsVertically(r)&&!e.hasOverflowingContentInYDirection()&&n.setY(0);break}}return n}scrollToDestinationInFrame(e,t){let n=this._appState.scene().findNode1(e),r=n.parent();for(;r!=null&&!((r.scrollDirection()!="NONE"||r.isTopLevel())&&!r.isTooRotatedToScroll());)r=r.parent();if(r!=null){let o=t.action().value;for(let s of t.getAllActionsWithSpecificTransitionType("SCROLL_ANIMATE"))o=s;let i=In.fromPrototypeAction(o,Q.getFeatureFlags().prototypeStateManagement?t.stateManagementVersion():0),a=n.absoluteTransform().translation().add1(i.extraScrollOffset).subtract1(r.absoluteTransform().translation());if(o.transitionType()=="SCROLL_ANIMATE"){let s=be.clampScrollOffsetForNode(r,a);be._scrollAnimationManager=new Qs(new Sc(r.scrollOffset(),s,i.transitionDuration,i.easingFunction),r.id())}else this.updateScrollOffsetForNode(r,a)}}scrollNode(e,t,n){var c,l;let r,o,i=(c=this._appState.scene())==null?void 0:c.findNode1(e);if(i==null)return!1;if(be._scrollAnimationManager!=null&&be._scrollAnimationManager.isOverscrolled()){let u=be._scrollAnimationManager;if(i.id()!=u.nodeID()){let d=(l=this._appState.scene())==null?void 0:l.findNode1(u.nodeID());d!=null&&d.setScrollOffset(u.simulation().endPos())}this._cancelAnimationManager()}else be._scrollAnimationManager!=null&&t!=be.ScrollSource.FLING&&this._cancelAnimationManager();if(i.isTooRotatedToScroll()||i.scrollDirection()=="NONE")return!1;let a=i.scrollOffset().clone();i.scrollDirection()=="HORIZONTAL"?a.setX(a.x()+(n.x()==0&&t==be.ScrollSource.SCROLL_EVENT?n.y():n.x())):a.addUpdate1(n);let s=this.updateScrollOffsetForNode(i,a);return this.disengageObservationMode(),s}_updateScrollOffsetsFromMultiplayer(){var n;let e,t=this._multiplayer.getScrollPositions();if(t!=null)for(let r of Array.from(t.keys())){let o=R.fromString(r),i=(n=this._appState.scene())==null?void 0:n.findNode1(o);i!=null&&i.setScrollOffset(t.get(r))}}_clampDirtyScrollContainers(){let e=this._appState.scene();if(e==null)return;let t=new Set;for(let n of Array.from(be._dirtyNodesForScrollClamping.values())){let r=e.findNode2(n);for(let o=r;o!=null&&!(t.has(R.toString(o.id()))||o!=r&&ln.isFrameLike(o.type())&&o.clipsToBoundingRectangle());o=o.parent())o.scrollDirection()!="NONE"&&this.updateScrollOffsetForNode(o,o.scrollOffset()),t.add(R.toString(o.id()))}be._dirtyNodesForScrollClamping=new Set}_handleScrollingPropertyChange(e,t,n,r){if(t==33)e.setScrollOffset(ye.FrozenVector_ZERO);else if(t==48||t==23)be._dirtyNodesForScrollClamping.add(R.toString(e.id()));else if(t==65){let o=this._appState.baseScreenNode();o!=null&&this.updateScrollOffsetForNode(o,o.scrollOffset())}else t==85&&(this._renderer.updateScroll(e),this._emitter.trigger("scrollEvent",null))}renderLayerByLayerActivate(){this._renderer.renderLayerByLayerActivate(()=>{this.viewport().invalidate()})}renderLayerByLayerDeactivate(){this._renderer.renderLayerByLayerDeactivate()}renderLayerByLayerPlay(){this._renderer.renderLayerByLayerPlay()}renderLayerByLayerPause(){this._renderer.renderLayerByLayerPause()}renderLayerByLayerForward(){this._renderer.renderLayerByLayerForward()}renderLayerByLayerBackward(){this._renderer.renderLayerByLayerBackward()}renderLayerByLayerRewind(){this._renderer.renderLayerByLayerRewind()}renderLayerByLayerIncreaseSpeed(){this._renderer.renderLayerByLayerIncreaseSpeed()}renderLayerByLayerDecreaseSpeed(){this._renderer.renderLayerByLayerDecreaseSpeed()}},ei=be;ei._scrollPhysics=new vs,ei._scrollAnimationManager=null,ei._overscrolledNodeID=null,ei._dirtyNodesForScrollClamping=new Set;(s=>{class g{constructor(l){this._canvasView=null,this._dragStart=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1,this._activeScrollOrDrag=null,this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._lastPointerPressHandled=s.WasHandled.NOT_HANDLED,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0,this._canvasView=l}unlockScroll(){this._lastScrollEvent=0,this._scrollingNodeId=null}resetStateForTests(){this._resetDragInfo(),this._flingPoints=null,this._currentGesture=null,this._previousGesture=null,this._scrollingNodeId=null,this._lastScrollEvent=0,this._lastPointerPressHandled=s.WasHandled.NOT_HANDLED,this._storedPointerReleasePoint=null,this._lastPointerPressHandledAt=0}isDragging(){return this._isDragging}_handleSinglePointerPress(l,u){let d=l.locationInView(this._canvasView);this._canvasView._triggerMouseAction(u,d),this._dragStart=d,this._isDragGestureConfirmed=!1,this._canvasView._recordViewportSpaceClick(this._dragStart),l.accept(),this._flingPoints=[],this._currentGesture=new gc(d,We.seconds(),l.interactionType()),this._lastPointerPressHandled=this._canvasView._handleInteractionsForPress(d),this._lastPointerPressHandled!=s.WasHandled.NOT_HANDLED&&(this._lastPointerPressHandledAt=We.seconds())}onMousePress(l){this._handleSinglePointerPress(l,6),this._canvasView._cancelAnimationManager()}onTouchPress(l){this._canvasView._cancelAnimationManager(),l.touches.length==1?this._handleSinglePointerPress(l,10):l.accept()}_processPointerRelease(l){var p;let u;if(!this._canvasView._appState.prototypeState().interactionsEnabled())return!1;let d=this._isDragGestureConfirmed,h=!d&&this._lastPointerPressHandled!=s.WasHandled.MAINTAINED,S=d&&this._lastPointerPressHandled==s.WasHandled.HANDLED&&(this._activeScrollOrDrag==null||this._activeScrollOrDrag.interactionType==s.ScrollOrDragProposal.InteractionType.DRAG),f=h||S,y=this._canvasView._handleInteractionsForRelease(l,f,this._lastPointerPressHandled);return(this._isDragging?this._canvasView._handleFling((p=this._activeScrollOrDrag)==null?void 0:p.targetNodeId,this._flingPoints):s.WasHandled.NOT_HANDLED)==s.WasHandled.NOT_HANDLED&&this._canvasView._maybeHandleOverdragRelease(),!d&&y==s.WasHandled.NOT_HANDLED&&this._lastPointerPressHandled==s.WasHandled.NOT_HANDLED&&this._canvasView.performHotspotAnimationOnClick(),!d&&this._canvasView._appState.scene()!=null&&Q.getViewerMode()==Q.ViewerMode.MIRROR&&this._canvasView._appState.triggerAction1(5),this._canvasView._updateCursorType(l),this._resetDragInfo(),d||y==s.WasHandled.HANDLED||this._lastPointerPressHandled==s.WasHandled.HANDLED}_storeOrProcessPointerReleaseAtPoint(l){if(We.seconds()-this._lastPointerPressHandledAt<Zm)this._storedPointerReleasePoint=l;else if(this._processPointerRelease(l))return s.WasHandled.HANDLED;return this._lastPointerPressHandledAt=0,s.WasHandled.NOT_HANDLED}onMouseRelease(l){let u=l.locationInView(this._canvasView);this._canvasView._triggerMouseAction(9,u),this._storeOrProcessPointerReleaseAtPoint(u)}onTouchRelease(l){l.touches.length==0&&this._currentGesture!=null?(this._currentGesture!=null&&(this._currentGesture.endTime=We.seconds(),this.isSingleTap()?this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation)==s.WasHandled.NOT_HANDLED&&this._canvasView._appState.prototypeState().getTransitionOnClick()&&this._canvasView.maybeHandleSingleTapAsNavigation(this._currentGesture.endLocation):this._storeOrProcessPointerReleaseAtPoint(this._currentGesture.endLocation)),this._resetDragInfo()):l.touches.length==0&&this._canvasView._maybeHandleOverdragRelease(),this._previousGesture=this._currentGesture,this._currentGesture=null}_resetDragInfo(){this._dragStart=null,this._activeScrollOrDrag=null,this._isDragging=!1,this._isDragGestureConfirmed=!1,this._isDragInteractionLocked=!1}onDrag(l){var h;let u,d=l.locationInView(this._canvasView);if(this._isDragging=!0,this._dragStart!=null&&!this._isDragGestureConfirmed&&(this._isDragGestureConfirmed=l.interactionCount()>1||d.distanceTo(this._dragStart)>jm),this._dragStart!=null&&this._isDragGestureConfirmed&&!this._isDragInteractionLocked){let S=d.subtract1(this._dragStart).multiply(-1);this._activeScrollOrDrag=this._canvasView.getBestScrollOrDragProposal(s.ScrollOrDragQuerySet.SCROLL_OR_DRAG,this._dragStart,S)}if(!this._canvasView._appState.prototypeState().isDragging()){if(this._isDragGestureConfirmed&&Q.getDragToPan()&&this._activeScrollOrDrag!=null){let S=l.delta(),f=(h=this._canvasView._appState.scene())==null?void 0:h.findNode1(this._activeScrollOrDrag.targetNodeId);switch(this._activeScrollOrDrag.interactionType){case s.ScrollOrDragProposal.InteractionType.SCROLL:case s.ScrollOrDragProposal.InteractionType.OVERSCROLL:{if(f!=null&&f!=this._canvasView._appState.getActiveCanvas()){if(this._canvasView.scrollNode(f.id(),s.ScrollSource.DRAGGING,S.negative().divide(this._canvasView._viewport.zoomScale()))){this._lastPointerPressHandled=s.WasHandled.HANDLED,this._isDragInteractionLocked=!0;let v=this._canvasView._handleScrollAndFindNewNodeToScroll(f);v==null&&ze("new scroll node is null"),this._activeScrollOrDrag.targetNodeId=v==null?void 0:v.id()}}else this._canvasView.viewport().panCamera(S);break}case s.ScrollOrDragProposal.InteractionType.DRAG:{this._lastPointerPressHandled=this._canvasView._handleDragStart(d,f,this._activeScrollOrDrag.targetInteractionId),this._isDragInteractionLocked=!0;break}}l.interactionCount()!=1?this._currentGesture=null:this._currentGesture!=null&&(this._flingPoints.push(new gc(d,We.seconds(),l.interactionType())),this._currentGesture.endLocation=d,this._currentGesture.endTime=We.seconds())}}this._canvasView._idlenessTracker.handleInteraction(),this._canvasView._handleInteractionsForDrag(d),l.interactionType()==0&&(this._canvasView._updateUserCursor(l),this._canvasView._triggerMouseAction(8,d))}onMouseScroll(l){var y;let u,d=this._canvasView._appState.getActiveCanvas();if(d==null)return;let h=We.seconds();h-this._lastScrollEvent>Jm&&(this._scrollingNodeId=null);let S=l.locationInView(this._canvasView),f=this._canvasView._appState.activePrototypeDevice()!=null&&Ui.hasDevice(this._canvasView._appState.activePrototypeDevice().type);if(((8&l.modifiers())!=0||(2&l.modifiers())!=0)&&aa.FitMode_userCanManuallyZoom(this._canvasView._appState.prototypeState().getCurrentFitMode(),f))this._canvasView._viewport.adjustCameraZoomWithPin(Math.pow(.99,l.scrollDelta.y()),S.subtract1(this._canvasView._viewport.viewSpaceBounds().topLeft())),l.accept(),this._canvasView.userDidAttemptZoom!=null&&this._canvasView.userDidAttemptZoom(1);else{let v=(y=d.scene())==null?void 0:y.findNode1(this._scrollingNodeId);if(v==null){let b=this._canvasView.getBestScrollOrDragProposal(s.ScrollOrDragQuerySet.SCROLL_ONLY,S,l.scrollDelta);v=this._canvasView._appState.scene().findNode1(b==null?void 0:b.targetNodeId),this._scrollingNodeId=v==null?void 0:v.id()}v==null||(v!=d?(this._canvasView.scrollNode(this._scrollingNodeId,s.ScrollSource.SCROLL_EVENT,l.scrollDelta.divide(this._canvasView._viewport.zoomScale()))&&(this._canvasView._handleInteractionsForScroll(),this._canvasView._handleInteractionsForMove(S)),l.accept()):Q.getScrollToPan()&&(this._canvasView._viewport.panCamera(l.scrollDelta.negative()),this._scrollingNodeId=d.id(),l.accept(),this._canvasView._handleInteractionsForMove(S)))}this._lastScrollEvent=h,this._canvasView._idlenessTracker.handleInteraction()}onMouseMove(l){let u=l.locationInView(this._canvasView);this._canvasView._updateUserCursor(l),this._canvasView._triggerMouseAction(7,u),this._canvasView._handleInteractionsForMove(u),this._scrollingNodeId=null}onMouseLeave(l){this._canvasView._updateUserCursor(null),this._canvasView._handleInteractionsForLeave()}onKeyPress(l,u){let d=this._canvasView._handleInteractionsForKeyPress(l);Q.isInlinePreview()&&d==s.WasHandled.NOT_HANDLED&&l.key==8&&(4&l.modifiers())!=0&&u.trigger("requestClose",{})}onGamepadDown(l){this._canvasView._handleInteractionsForGamepadDown(l)}maybeProcessStoredPointerRelease(){this._storedPointerReleasePoint!=null&&(this._processPointerRelease(this._storedPointerReleasePoint),this._storedPointerReleasePoint=null)}isSingleTap(){return this._canvasView._appState.baseScreenNode()!=null&&this._currentGesture!=null&&this._currentGesture.isTap()}}s.CanvasPointerEventDelegate=g;let e;(d=>(d[d.NOT_HANDLED=0]="NOT_HANDLED",d[d.HANDLED=1]="HANDLED",d[d.MAINTAINED=2]="MAINTAINED"))(e=s.WasHandled||(s.WasHandled={}));class t{updateToBestProposal1(l){return l!=null&&this.updateToBestProposal2(l.interactionType,l.directionSimilarity,l.targetNodeId,l.targetInteractionId),this}updateToBestProposal2(l,u,d,h){return(this.interactionType==s.ScrollOrDragProposal.InteractionType.OVERSCROLL&&l==s.ScrollOrDragProposal.InteractionType.DRAG||u>this.directionSimilarity)&&(this.interactionType=l,this.directionSimilarity=u,this.targetNodeId=d,this.targetInteractionId=h),this}constructor(l,u,d,h){this.interactionType=l,this.directionSimilarity=u,this.targetNodeId=d,this.targetInteractionId=h}}s.ScrollOrDragProposal=t,(u=>{let c;(f=>(f[f.OVERSCROLL=0]="OVERSCROLL",f[f.SCROLL=1]="SCROLL",f[f.DRAG=2]="DRAG"))(c=u.InteractionType||(u.InteractionType={}));let l;(h=>{function d(S){return s.ScrollOrDragProposal.InteractionType[S]}h.InteractionType_toString=d})(l=u.in_InteractionType||(u.in_InteractionType={}))})(t=s.ScrollOrDragProposal||(s.ScrollOrDragProposal={}));let n;(d=>(d[d.SCROLL_EVENT=0]="SCROLL_EVENT",d[d.DRAGGING=1]="DRAGGING",d[d.FLING=2]="FLING"))(n=s.ScrollSource||(s.ScrollSource={}));let r;(u=>(u[u.SCROLL_ONLY=0]="SCROLL_ONLY",u[u.SCROLL_OR_DRAG=1]="SCROLL_OR_DRAG"))(r=s.ScrollOrDragQuerySet||(s.ScrollOrDragQuerySet={}));let o;(l=>{function c(u){return s.WasHandled[u]}l.WasHandled_toString=c})(o=s.in_WasHandled||(s.in_WasHandled={}));let i;(l=>{function c(u){return s.ScrollSource[u]}l.ScrollSource_toString=c})(i=s.in_ScrollSource||(s.in_ScrollSource={}));let a;(l=>{function c(u){return s.ScrollOrDragQuerySet[u]}l.ScrollOrDragQuerySet_toString=c})(a=s.in_ScrollOrDragQuerySet||(s.in_ScrollOrDragQuerySet={}))})(ei||(ei={}));var og;(e=>{function g(t){return Ds[t]}e.RenderCallStatus_toString=g})(og||(og={}));var ig;(e=>{function g(t){return Tc[t]}e.ZoomMethod_toString=g})(ig||(ig={}));var ag;(e=>{function g(t){return Bl[t]}e.TransitionSource_toString=g})(ag||(ag={}));var qt;(i=>{function g(a){switch(a){case 1:case 20:case 21:case 4:case 5:case 9:case 17:case 18:case 19:return!1;case 2:case 3:case 6:case 7:case 8:case 10:case 11:case 12:case 13:return!0;default:return!1}}i.TransitionAction_isTransientAction=g;function e(a){switch(a){case"TIMER":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"REVERSE_HOVER":return 6;case"REVERSE_PRESS":return 7;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_GAMEPAD_DOWN":return 15;case"ON_VOICE":return 16;case"MOBILE_NAV":return 17;case"LEFT_ARROW":return 18;case"RIGHT_ARROW":return 19;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21}return 0}i.TransitionAction_fromString=e;function t(a){return[1,18,19,20,21].indexOf(a)!=-1?0:1}i.TransitionAction_getControlSource=t;function n(a){switch(a){case"AFTER_TIMEOUT":return 1;case"ON_HOVER":return 2;case"ON_PRESS":return 3;case"ON_CLICK":return 4;case"DRAG":return 5;case"MOUSE_DOWN":return 8;case"MOUSE_UP":return 9;case"MOUSE_IN":return 10;case"MOUSE_OUT":return 11;case"MOUSE_ENTER":return 12;case"MOUSE_LEAVE":return 13;case"ON_KEY_DOWN":return 14;case"ON_VOICE":return 16;case"ON_MEDIA_HIT":return 20;case"ON_MEDIA_END":return 21}return ze("fromInteractionType InteractionType not handled"),0}i.TransitionAction_fromInteractionType=n;function r(a){switch(a){case 1:return"AFTER_TIMEOUT";case 2:return"ON_HOVER";case 3:return"ON_PRESS";case 4:return"ON_CLICK";case 5:return"DRAG";case 8:return"MOUSE_DOWN";case 9:return"MOUSE_UP";case 10:return"MOUSE_IN";case 11:return"MOUSE_OUT";case 12:return"MOUSE_ENTER";case 13:return"MOUSE_LEAVE";case 14:return"ON_KEY_DOWN";case 15:return"ON_KEY_DOWN";case 16:return"ON_VOICE";case 20:return"ON_MEDIA_HIT";case 21:return"ON_MEDIA_END"}return ze("mapToInteractionType TransitionAction not handled"),null}i.TransitionAction_mapToInteractionType=r;function o(a){return Pn[a]}i.TransitionAction_toString=o})(qt||(qt={}));var sg;(e=>{function g(t){return lg[t]}e.BaseScreenHitTestResult_toString=g})(sg||(sg={}));function vu(g){return g.x()==375&&g.y()==812?"APPLE_IPHONE_X_SILVER":g.x()==414&&g.y()==736?"APPLE_IPHONE_8_PLUS_SILVER":g.x()==375&&g.y()==667?"APPLE_IPHONE_8_SILVER":g.x()==320&&g.y()==568?"APPLE_IPHONE_SE_SILVER":g.x()==411&&g.y()==731?"GOOGLE_PIXEL_2_CLEARLY_WHITE":g.x()==768&&g.y()==1024?"APPLE_IPAD_MINI_4_SILVER":g.x()==1024&&g.y()==1366?"APPLE_IPAD_PRO_SILVER":g.x()==1440&&g.y()==990?"MICROSOFT_SURFACE_PRO_3":g.x()==1368&&g.y()==912?"MICROSOFT_SURFACE_PRO_4":g.x()==312&&g.y()==390?"APPLE_WATCH_42MM_STEEL_PLUS_WHITE_CLOSED":g.x()==272&&g.y()==340?"APPLE_WATCH_38MM_STEEL_PLUS_WHITE_CLOSED":null}var we=class{blendMode(){return this._blendMode}blurColor(){return this._blurColor}blurOffset(){return this._blurOffset}blurRadius(){return this._blurRadius}spread(){return this._spread}isEnabled(){return this._isEnabled}opacity(){return this._opacity}showShadowBehindNode(){return this._showShadowBehindNode}type(){return this._type}setBlendMode(e){this._blendMode=e}setBlurColor(e){this._blurColor=e}setBlurOffset(e){this._blurOffset=e}setBlurOffset1(e){this._blurOffset=e.clone()}setBlurRadius(e){this._blurRadius=e}setSpread(e){this._spread=e}setIsEnabled(e){this._isEnabled=e}setOpacity(e){this._opacity=e}setShowShadowBehindNode(e){this._showShadowBehindNode=e}setType(e){this._type=e}clone(){let e=new we;return e.setBlendMode(this.blendMode()),e.setBlurColor(this.blurColor()),e.setBlurOffset1(this.blurOffset().clone()),e.setBlurRadius(this.blurRadius()),e.setSpread(this.spread()),e.setIsEnabled(this.isEnabled()),e.setOpacity(this.opacity()),e.setShowShadowBehindNode(this.showShadowBehindNode()),e.setType(this.type()),e}isVisibleForRendering(){switch(this.type()){case"DROP_SHADOW":return this.isEnabled()&&E.alpha(this.blurColor())>0&&this.opacity()>0;case"INNER_SHADOW":return this.isEnabled()&&E.alpha(this.blurColor())>0&&this.opacity()>0&&(this.blurRadius()>0||this.blurOffset().x()!=0||this.blurOffset().y()!=0||this.spread()>0);case"BACKGROUND_BLUR":return this.isEnabled()&&this.blurRadius()>0;case"FOREGROUND_BLUR":return this.isEnabled()&&this.blurRadius()>0}return!1}isEnabledAndVisible(){return this.isEnabled()&&this.opacity()>0}equals(e){return this.blendMode()==e.blendMode()&&this.blurColor()==e.blurColor()&&this.blurOffset().equals(e.blurOffset())&&this.blurRadius()==e.blurRadius()&&this.spread()==e.spread()&&this.showShadowBehindNode()==e.showShadowBehindNode()&&this.isEnabled()==e.isEnabled()&&this.opacity()==e.opacity()&&this.type()==e.type()}static createForegroundBlur(e){let t=new we;return t.setType("FOREGROUND_BLUR"),t.setBlurRadius(e),t}static createBackgroundBlur(e){let t=new we;return t.setType("BACKGROUND_BLUR"),t.setBlurRadius(e),t}static createInnerShadow(e,t,n,r){let o=new we;return o.setType("INNER_SHADOW"),o.setBlurRadius(e),o.setBlurOffset(t),o.setBlurColor(n),o.setOpacity(r),o}static createDropShadow1(e,t,n,r){return we.createDropShadow3(e,t,n,r,0,!0)}static createDropShadow2(e,t,n,r,o){return we.createDropShadow3(e,t,n,r,o,!0)}static createDropShadow3(e,t,n,r,o,i){let a=new we;return a.setType("DROP_SHADOW"),a.setBlurRadius(e),a.setBlurOffset(t),a.setBlurColor(n),a.setOpacity(r),a.setSpread(o),a.setShowShadowBehindNode(i),a}constructor(){this._blendMode="NORMAL",this._blurColor=E.TRANSPARENT,this._blurOffset=ye.FrozenVector_ZERO,this._blurRadius=0,this._spread=0,this._isEnabled=!0,this._opacity=1,this._showShadowBehindNode=!1,this._type="DROP_SHADOW"}};var yr=class{constructor(e){this._valueBySnapshotId=null,this._isDirty=!1,this._valueBySnapshotId=e}getValueOrNull(e){return Me.StringMap_get(this._valueBySnapshotId,e,null)}updateValue(e,t){this._valueBySnapshotId.set(e,t),this._isDirty=!0}toString(){let e=Array.from(this._valueBySnapshotId.keys());e.sort((n,r)=>Bn.string_compare(n,r));let t="";for(let n of e)t+=`
${yr._PREFIX}snapshotId: ${n}
`,t+=this._valueBySnapshotId.get(n);return t}isDirty(){return this._isDirty}static _createEmptyDefaultDirtyAtPath(e){if(yr._snapshotFileCache.has(e))throw new Error("Snapshot file at path already exists in cache");return yr._snapshotFileCache.set(e,new yr(new Map)),yr._snapshotFileCache.get(e)._isDirty=!0,yr._snapshotFileCache.get(e)}static loadOrCreateFromPath(e){let t=Me.StringMap_get(yr._snapshotFileCache,e,null);return t!=null?Promise.resolve(t):ProtoTestHost_readFile(e).then(n=>{let r=Me.StringMap_get(yr._snapshotFileCache,e,null);return r!=null?r:n==null?(console.log(`[Snapshot] Create empty default dirty snapshot at path ${e}`),yr._createEmptyDefaultDirtyAtPath(e)):(yr._snapshotFileCache.set(e,new yr(yr._snapshotStringToMap(n))),yr._snapshotFileCache.get(e))})}static _snapshotStringToMap(e){let t=new Map,n=e.split(`
`),r=null,o=null;for(let i of n){let a=`${yr._PREFIX}snapshotId: `;i.startsWith(a)?(r!=null&&t.set(r,o.join(`
`)),r=i.slice(a.length),o=[]):o!=null&&o.push(i)}return r!=null&&t.set(r,o.join(`
`)),t}static flushSnapshotUpdates(){let e=[];return Me.StringMap_each(yr._snapshotFileCache,(t,n)=>{n.isDirty()&&e.push(yr._saveToPath(t,n))}),Promise.all(e)}static _saveToPath(e,t){return console.log(`[Snapshot] Saving to file ${e}`),ProtoTestHost_writeFile(e,t.toString())}},Oa=yr;Oa._PREFIX="#*#* ",Oa._snapshotFileCache=new Map;var wa=class{constructor(e){this._testFilepath=null,this._testFilepath=e}asyncAssertMatchesSnapshot(e,t){if(vc==null)throw new Error("asyncAssertMatchesSnapshot called outside of a test");let r=this._testFilepath.split(".sk").join(".snapshot.txt"),o=vc+" -- "+e,i=ProtoTestHost_env.UPDATE_SNAPSHOTS!==void 0;return l_(r,o).then(a=>{let s=new RegExp("\\d+\\.\\d*","g"),c=t.replaceAll(s,l=>`${Math.round(parseFloat(l)*1e3)/1e3}`);if(a==null||i)return s_(r,o,c),ir.VOID;if(a!==c)throw new Error(`${rl}Snapshot ${o} in file ${r} did not match previous value. Here's a diff that changes the ${dg}stored snapshot${rl} into the ${cg}received value${rl}:

${a_(a,c)}`);return ir.VOID})}},Ra;(o=>{function g(){return o.hasSetExpectedErrorsBeenCalled=!1,pi.interactionTestHelpers.resetExpectedErrorsAndGetErrorString(1)}o.resetExpectedErrorsAndGetErrorString=g;function e(i){if(o.hasSetExpectedErrorsBeenCalled)throw new Error("Can only call setExpectedErrors once per test");o.hasSetExpectedErrorsBeenCalled=!0,pi.interactionTestHelpers.setExpectedErrors(i)}o.setExpectedErrors=e;function t(){o.isUnhandledErrorsExpected=!0}o.setUnhandledErrorsExpected=t,o.hasSetExpectedErrorsBeenCalled=!1,o.isUnhandledErrorsExpected=!1})(Ra||(Ra={}));function Ee(g,e){Iu(g,()=>new Promise((t,n)=>{e(),setTimeout(()=>{t(ir.VOID)},0)}))}function Te(g,e){Iu(g,e)}function Pa(g,e){Iu(g,()=>e().then(t=>ir.VOID))}function Iu(g,e){nl.push(g);let t=nl.join(" -- ");ie.List_removeLast(nl),it(g,()=>{vc=t,So=[],Ra.isUnhandledErrorsExpected=!1;let n=Ra.resetExpectedErrorsAndGetErrorString();return n.length>0&&So.push(new Error("Errors detected from before test started. Maybe from test harness initialization, or from a previous test: "+n)),e().catch(r=>(So.push(r),ir.VOID)).then(r=>{let o=Ra.resetExpectedErrorsAndGetErrorString();if(o.length>0&&So.push(new Error(o)),x.destroy(),vc=null,Ra.isUnhandledErrorsExpected){if(So.length==0)throw new Error("Expected errors, but none were triggered")}else{So=So.filter(a=>a.message.indexOf("/api/web_logger/metrics/unhandled_error")==-1);let i=So.length>1?So.length.toString()+`unhandled errors: 
`:`Unhandled error: 
`;if(So.length==1)throw So[0];if(So.length>1){for(let a of So)i+=a.message,i+=`
`,i+=a.stack;throw new Error(i)}}return ir.VOID})})}function Ut(g,e){nl.push(g),describe(g,()=>{e()}),ie.List_removeLast(nl)}function a_(g,e){let t=JsDiff.diffLines(g,e),n="";return t.forEach(r=>{let o="",i="";r.added?(o="+ ",i=cg):r.removed?(o="- ",i=dg):(o="  ",i=rl),n+=`${i}${o}${r.value}${rl}
`}),n}function s_(g,e,t){Oa.loadOrCreateFromPath(g).then(n=>{n.updateValue(e,t)})}function l_(g,e){return Oa.loadOrCreateFromPath(g).then(t=>t.getValueOrNull(e))}var So=[],nl=[],vc=null,cg="\x1B[32m",dg="\x1B[31m",rl="\x1B[0m";var Ic=class{imageType(){return this._imageType}setImageType(e){this._imageType=e}constructor(e,t){this._ctx=null,this._decodeCallback=null,this._failureCallback=null,this._texture=null,this._imageHash=null,this._isImageMockLoading=!1,this._mockDecodedData=null,this._imageType=1,this._ctx=e,this._imageHash=t}width(){return 0}height(){return 0}url(){return"https://dummy-url"}hash(){return this._imageHash}state(){return this._mockDecodedData!=null?2:this._isImageMockLoading?1:0}gif(){return null}decodedData(){return this._mockDecodedData}texture(){return this._texture}setTexture(e){this._texture=e}loadDidFail(){return!1}objectHash(){return`Image(${this._imageHash})`}fetchAndDecode(e,t,n){this._isImageMockLoading||(this._decodeCallback=t,this._failureCallback=n,this._isImageMockLoading=!0,this._ctx.markImageFetched(this))}imageLoads(){this._isImageMockLoading&&(this._mockDecodedData=new Zt(0,1,1,new Uint8Array(1)),this._decodeCallback(this._mockDecodedData),this._isImageMockLoading=!1)}imageFailsToLoad(){this._isImageMockLoading=!1,this._failureCallback(0)}freeMemoryForDecodedDataAndTexture(){return this.freeMemoryForDecodedData(),this._texture=null,!0}freeMemoryForDecodedData(){return this._mockDecodedData=null,this._isImageMockLoading=!1,!0}isDecoded(){return this._mockDecodedData!=null}isGIF(){return!1}};var Ae=class{constructor(){if(arguments.length==2){let e=arguments[0],t=arguments[1];this._paths=new Map,this._imageManager=null,this._videoManager=null,this._imageManager=e,this._videoManager=t}else if(arguments.length==1){let e=arguments[0];this._paths=new Map,this._imageManager=null,this._videoManager=null,this._imageManager=e}}static hash(e,t){return t instanceof Array&&t.length===0?e:t}static hasFileHeader(e){for(let t=0,n=Ae.FILE_HEADER.length;t<n;t=t+1)if(t>=e.length||e[t]!=Ae.FILE_HEADER[t])return!1;return!0}static parseChunkType(e){return e.length!=Ae.CHUNK_TAG_LEN?Ae.ChunkType.UNKNOWN:(n=>{for(let r=0,o=e.length;r<o;r=r+1)if(e[r]!=n[r])return!1;return!0})(Ae.THUMBNAIL_CHUNK_TAG)?Ae.ChunkType.THUMBNAIL:Ae.ChunkType.UNKNOWN}static readInt32(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}static _logVerbose(e){console.log(e)}static _logVerbosePropertyChange(e,t){console.log(`decoded property change '${t}' for node '${R.toString(e)}'`)}static encodeGUID(e){return R.toFigGUID(e)}static encodeGUIDPath(e){let t={};return e.guids!=null&&(t.guids=e.guids.map(n=>Ae.encodeGUID(n))),t}static encodeInstanceStateChange(e,t){let n={};return n.stateID=Ae.encodeGUID(e.newStateId()),n.interactionID=Ae.encodeGUID(e.interactionAddress.interactionId),e.interactionAddress.hotspotStablePath!=null&&(n.hotspotStablePath=Ae.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),e.stablePath!=null&&(n.instanceStablePath=Ae.encodeGUIDPath(e.stablePath)),n.phase=t,n}static encodePrototypeStateChange(e){let t={};if(e.oldStateAndOverlays!=null){let n={};e.oldStateAndOverlays.stateId!=null&&(n.baseScreenID=Ae.encodeGUID(e.oldStateAndOverlays.stateId),n.overlays=e.oldStateAndOverlays.overlays.map(r=>Ae.encodeOverlayData(r,null))),t.oldState=n}if(e.newStateAndOverlays!=null){let n={};e.newStateAndOverlays.stateId!=null&&(n.baseScreenID=Ae.encodeGUID(e.newStateAndOverlays.stateId),n.overlays=e.newStateAndOverlays.overlays.map(r=>Ae.encodeOverlayData(r,null))),t.newState=n}return e.interactionAddress.hotspotStablePath!=null&&(t.hotspotBlueprintID=Ae.encodeGUIDPath(e.interactionAddress.hotspotStablePath)),t.isHotspotInNewPresentedState=[6,7].indexOf(e.cause)==-1,t.interactionID=Ae.encodeGUID(e.interactionAddress.interactionId),t.direction=e.direction==0?"FORWARD":"REVERSE",t}static encodeOverlayData(e,t){let n={};return n.hotspotBlueprintId=Ae.encodeGUIDPath(e.openingHotspotStablePath),t!=null&&(n.hotspotGuid=Ae.encodeGUID(t)),n.overlayGuid=Ae.encodeGUID(e.id),n.prototypeInteractionGuid=Ae.encodeGUID(e.openingInteractionId),n.swapGuid=Ae.encodeGUID(e.overlayDataModelId),n}static encodeMatrix(e){let t={};return t.m00=e.m00(),t.m01=e.m01(),t.m02=e.m02(),t.m10=e.m10(),t.m11=e.m11(),t.m12=e.m12(),t}static encodeVector1(e){let t={};return t.x=e.x(),t.y=e.y(),t}static encodeVector2(e){let t={};return t.x=e.x(),t.y=e.y(),t}static decodeGUID(e){let t=null,n=dt.int_fromUint(e.sessionID);if(n<0){let r=dt.int_fromUint(e.localID);n==-1&&(r==-1||r==-2)?t=Z.new32(R._new(n,r)):(ze("Negative session ID encountered in GUID deserialization"),t=Z.new32(R._new(e.sessionID,e.localID)))}else t=Z.new32(R._new(e.sessionID,e.localID));return Z.asGUID(t)}static decodeGUID_instanceHACK(e){return R._new(dt.int_fromUint(e.sessionID),e.localID)}static decodeGUIDPath(e){if(e.guids===void 0)return null;let t=[];for(let r of e.guids){let o=Ae.decodeGUID(r);if(o==null)return null;t.push(o)}let n=Z.new6(new wt(t));return Z.asGUIDPath(n)}static decodeStyleId(e){let t=e.guid!=null?Ae.decodeGUID(e.guid):null,n=e.assetRef!=null?{key:e.assetRef.key,version:e.assetRef.version}:null,r=Z.new31({guid:t,ref:n});return Z.asStyleId(r)}static decodeParentIndex(e){return new kn(Ae.decodeGUID(e.guid),sn.fromString(e.position))}static decodeVector(e){return new I(e.x,e.y)}static decodeMatrix(e){return new ee(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}static decodeColor(e){return E.new3(e.r,e.g,e.b,e.a)}static decodeFontName(e){let t=e.postscript!==void 0?e.postscript:"";return new hs(e.family,e.style,t)}static decodeNumber(e){return new ps(e.value,e.units)}static decodeStops(e){let t=[];for(let n of e)t.push(new lt(Ae.decodeColor(n.color),n.position));return t}static decodePrototypeDevice(e){let t=Ae.decodeVector(e.size),n=e.presetIdentifier!==void 0?e.presetIdentifier:null;e.type=="PRESET"&&(n==null||n.length==0)&&(n=vu(t));let r=e.rotation!==void 0?e.rotation:"NONE";return new Xn(e.type,t,n,r)}static decodePrototypeStartingPoint(e){return new so(e.name,e.description,sn.fromString(e.position))}static encodePrototypeStartingPoint(e){let t={};return t.name=e.name,t.description=e.description,t.position=sn.toString(e.position),t}static decodeOverlayBackgroundAppearance(e){return new vo(e.backgroundType!==void 0?e.backgroundType:"NONE",e.backgroundColor!==void 0?Ae.decodeColor(e.backgroundColor):E.TRANSPARENT)}static decodeVideoPlayback(e){return{autoplay:e.autoplay!==void 0?e.autoplay:!1,mediaLoop:e.mediaLoop!==void 0?e.mediaLoop:!1,muted:e.muted!==void 0?e.muted:!1}}static decodeEffects(e){let t=[];for(let r of e){let o=new we;o.setType(r.type),r.color!==void 0&&(o.setBlurColor(E.withAlpha(Ae.decodeColor(r.color),255)),o.setOpacity(r.color.a)),r.blendMode!==void 0&&o.setBlendMode(r.blendMode),r.offset!==void 0&&o.setBlurOffset1(Ae.decodeVector(r.offset)),r.radius!==void 0&&o.setBlurRadius(r.radius),r.visible!==void 0&&o.setIsEnabled(r.visible),r.spread!==void 0&&o.setSpread(r.spread),r.showShadowBehindNode!==void 0?o.setShowShadowBehindNode(r.showShadowBehindNode):o.setShowShadowBehindNode(!0),t.push(o)}let n=Z.new17(t);return Z.asEffectList(n)}static decodeExportConstraint(e){return e.type!==void 0&&e.value!==void 0?new Xs(e.type,e.value):new Xs("CONTENT_SCALE",1)}static decodeExportSettings(e,t){let n=[];for(let r of e){let o=null;r.suffix!==void 0?o=r.suffix:o="";let i=null;r.imageType!==void 0?i=r.imageType:i="PNG";let a=null;r.constraint!==void 0?a=Ae.decodeExportConstraint(r.constraint):a=new Xs("CONTENT_SCALE",1);let s=t;r.contentsOnly!==void 0&&(s=r.contentsOnly),n.push(new du(o,i,a,s))}return n}static decodePrototypeInteractions(e){return e.map(t=>Ae.decodePrototypeInteraction(t))}static decodePrototypeInteraction(e){let t=e.id!==void 0?Ae.decodeGUID(e.id):null,n=e.event!==void 0?Ae.decodePrototypeEvent(e.event):null,r=e.actions!==void 0?e.actions.map(a=>Ae.decodePrototypeAction(a)):null,o=e.isDeleted!==void 0?e.isDeleted:!1,i=e.stateManagementVersion!==void 0?e.stateManagementVersion:0;return new jt(t,n,r,o,i)}static encodePrototypeInteractionForTests(e){let t={};t.id=Ae.encodeGUID(e.id()),t.isDeleted=e.isDeleted(),t.stateManagementVersion=e.stateManagementVersion(),t.event=Ae.encodePrototypeEventForTests(e.event());let n=[],r=e.actions();for(let o=0,i=r.length;o<i;o=o+1){let a=r[o];n.push(Ae.encodePrototypeActionForTests(a))}return t.actions=n,t}static decodePrototypeEvent(e){let t=e.interactionType!==void 0?e.interactionType:null,n=e.interactionMaintained!==void 0?new fe(e.interactionMaintained):null,r=e.interactionDuration!==void 0?new fe(e.interactionDuration):null,o=e.keyTrigger!==void 0?e.keyTrigger:null,i=e.transitionTimeout!==void 0?new fe(e.transitionTimeout):null,a=e.mediaHitTime!==void 0?new fe(e.mediaHitTime):null;return new Gr(t,n,r,o,i,a)}static encodePrototypeEventForTests(e){let t={};return t.interactionType=e.interactionType(),t.interactionMaintained=e.interactionMaintained(),t.interactionDuration=e.interactionDuration(),t.keyTrigger=e.keyTrigger(),t.keyTrigger.keyCodes=e.keyTrigger().keyCodes,t.keyTrigger.triggerDevice=e.keyTrigger().triggerDevice,t.transitionTimeout=e.transitionTimeout(),t.mediaHitTime=e.mediaHitTime(),t}static decodeConditionalActions(e){let t=[],n=e.actions!==void 0?e.actions.map(o=>Ae.decodePrototypeAction(o)):t,r=e.condition!==void 0?Ae.variableDataToJson(e.condition):"";return new cs(n,r)}static encodeConditionalActionsForTests(e){let t={},n=[],r=e.actions();for(let o=0,i=r.length;o<i;o=o+1){let a=r[o];n.push(Ae.encodePrototypeActionForTests(a))}return t.actions=n,t}static decodePrototypeAction(e){let t=e.transitionNodeID!==void 0?Ae.decodeGUID(e.transitionNodeID):null,n=e.transitionType!==void 0?e.transitionType:null,r=e.transitionDuration!==void 0?new fe(e.transitionDuration):null,o=e.easingType!==void 0?e.easingType:null,i=e.easingFunction!==void 0?e.easingFunction:null,a=e.transitionShouldSmartAnimate!==void 0?new fe(e.transitionShouldSmartAnimate):null,s=e.connectionType!==void 0?e.connectionType:null,c=e.connectionURL!==void 0?e.connectionURL:null,l=e.overlayRelativePosition!==void 0?Ae.decodeVector(e.overlayRelativePosition):null,u=e.navigationType!==void 0?e.navigationType:null,d=e.transitionPreserveScroll!==void 0?new fe(e.transitionPreserveScroll):null,h=e.extraScrollOffset!==void 0?Ae.decodeVector(e.extraScrollOffset):null,S=e.mediaAction!==void 0?e.mediaAction:null,f=e.transitionResetVideoPosition!==void 0?new fe(e.transitionResetVideoPosition):null,y=e.openUrlInNewTab!==void 0?new fe(e.openUrlInNewTab):null,v=e.mediaSkipToTime!==void 0?new fe(e.mediaSkipToTime):null,b=e.mediaSkipByAmount!==void 0?new fe(e.mediaSkipByAmount):null,m=e.transitionResetScrollPosition!==void 0?new fe(e.transitionResetScrollPosition):null,p=e.conditionalActions!==void 0?e.conditionalActions.map(k=>Ae.decodeConditionalActions(k)):null,_=e.transitionResetInteractiveComponents!==void 0?new fe(e.transitionResetInteractiveComponents):null,T=e.targetVariable!==void 0?Ms.toString(e.targetVariable.id):null,N=e.targetVariableData!==void 0?Ae.variableDataToJson(e.targetVariableData):null;return new qn(t,n,r,o,i,a,s,c,l,u,d,h,S,f,y,v,b,m,p,_,T,N)}static variableDataToJson(e){let t={},n=e.dataType;switch(t.type=Ae.variableDataTypeToEnumValue(n),t.resolvedType=Ae.variableResolvedDataTypeToEnumValue(e.resolvedDataType),n){case"BOOLEAN":{t.value=e.value.boolValue;break}case"STRING":{t.value=e.value.textValue;break}case"FLOAT":{t.value=e.value.floatValue;break}case"COLOR":{let r={};r.r=e.value.colorValue.r,r.g=e.value.colorValue.g,r.b=e.value.colorValue.b,r.a=e.value.colorValue.a,t.value=r;break}case"ALIAS":{t.value=Ms.toString(e.value.alias);break}case"EXPRESSION":{t.value=Ae.expressionToJson(e.value.expressionValue);break}case"MAP":throw new Error("Did not implement variableDataToJson for MAP data type")}return t}static variableDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"ALIAS":return 3;case"COLOR":return 4;case"EXPRESSION":return 5;case"MAP":return 6;case"SYMBOL_ID":return 7}throw new Error(`Invalid variable data type: ${e}`)}static variableResolvedDataTypeToEnumValue(e){switch(e){case"BOOLEAN":return 0;case"FLOAT":return 1;case"STRING":return 2;case"COLOR":return 3;case"MAP":return 4;case"SYMBOL_ID":return 5}throw new Error(`Invalid resolved variable data type: ${e}`)}static expressionToJson(e){let t={};t.expressionFunction=Ae.expressionFunctionToEnumValue(e.expressionFunction);let n=[];for(let r=0;r<e.expressionArguments.length;r=r+1)n.push(Ae.variableDataToJson(e.expressionArguments[r]));return t.expressionArguments=n,t}static expressionFunctionToEnumValue(e){switch(e){case"ADDITION":return 0;case"SUBTRACTION":return 1;case"RESOLVE_VARIANT":return 2;case"MULTIPLY":return 3;case"DIVIDE":return 4;case"EQUALS":return 5;case"NOT_EQUAL":return 6;case"LESS_THAN":return 7;case"LESS_THAN_OR_EQUAL":return 8;case"GREATER_THAN":return 9;case"GREATER_THAN_OR_EQUAL":return 10;case"AND":return 11;case"OR":return 12;case"NOT":return 13;case"STRINGIFY":return 14;case"TERNARY":return 15;case"VAR_MODE_LOOKUP":return 16}throw new Error(`Invalid expression function: ${e}`)}static encodePrototypeActionForTests(e){let t={};t.transitionNodeID=Ae.encodeGUID(e.transitionNodeID()),t.transitionType=e.transitionType(),t.transitionDuration=e.transitionDuration(),t.easingType=e.easingType(),t.easingFunction=e.easingFunctionValues(),t.transitionShouldSmartAnimate=e.transitionShouldSmartAnimate(),t.connectionType=e.connectionType(),t.connectionURL=e.connectionURL(),t.overlayRelativePosition=Ae.encodeVector1(e.overlayRelativePosition()),t.navigationType=e.navigationType(),t.transitionPreserveScroll=e.transitionPreserveScroll(),t.extraScrollOffset=Ae.encodeVector1(e.extraScrollOffset()),t.mediaAction=e.mediaAction(),t.transitionResetVideoPosition=e.transitionResetVideoPosition(),t.openUrlInNewTab=e.openUrlInNewTab(),t.mediaSkipToTime=e.mediaSkipToTime(),t.mediaSkipByAmount=e.mediaSkipByAmount(),t.transitionResetScrollPosition=e.transitionResetScrollPosition();let n=[],r=e.conditionalActions();for(let o=0,i=r.length;o<i;o=o+1){let a=r[o];n.push(Ae.encodeConditionalActionsForTests(a))}return t.conditionalActions=n,t.transitionResetInteractiveComponents=e.transitionResetInteractiveComponents(),t}static serializeValueToKiwiForTests1(e,t){let n={},r=[];return Ae.serializeValueToKiwiForTests2(e,t,n,r),new Ir(n,r)}static serializeValueToKiwiForTests2(e,t,n,r){if(!x.isTestingEnv())throw new Error("Should only serialize values to kiwi when running tests");if(e==58||e==59){let o=Z.asPaintList(t);if(o==null)throw new Error("attempt to set null paint list");let i=[];for(let a=0,s=o.length;a<s;a=a+1){let c=o[a].asSinglePaint(),l={};if(l.type=c.type(),l.opacity=c.opacity(),l.visible=c.isEnabled(),l.blendMode=c.blendMode(),c.colorStops()!=null){let d=[];for(let h=0,S=c.colorStops().length;h<S;h=h+1){let f=c.colorStops()[h],y={},v={};v.r=E.redF(f.color),v.g=E.greenF(f.color),v.b=E.blueF(f.color),v.a=E.alphaF(f.color),y.color=v,y.position=f.position,d.push(y)}l.stops=d}let u={};if(u.r=E.redF(c.color()),u.g=E.greenF(c.color()),u.b=E.blueF(c.color()),u.a=E.alphaF(c.color()),l.color=u,c.image()!=null){let d={};d.hash=Un.hexToBytes(c.image().hash()),l.image=d,l.imageScaleMode=c.imageScaleMode()}i.push(l)}e==58?n.fillPaints=i:e==59&&(n.strokePaints=i)}else if(e==74){let o=Z.asSymbolData(t);if(o==null)throw new Error("attempt to set null symbol data");let i={};i.symbolID=Ae.encodeGUID(o.masterID);let a=[];go.map(o.instanceOverrides).each((s,c)=>{let l={};l.guidPath=Ae.encodeGUIDPath(s),_n.each(c,(u,d)=>{Ae.serializeValueToKiwiForTests2(u,d,l,[])}),a.push(l)}),i.symbolOverrides=a,n.symbolData=i}else if(e==72||e==73){let o=Z.asGeometry(t);if(o==null)throw new Error("attempt to set null geometry");let i=[];for(let a=0,s=o.regions.length;a<s;a=a+1){let c=o.regions[a],l={};l.windingRule=c.windingRule,l.styleID=c.styleID,l.commandsBlob=r.length,r.push(c.path().toBezierPath().getMutableClone()._data.bytes()),i.push(l)}e==72?n.fillGeometry=i:n.strokeGeometry=i}else if(e==4){let o=Z.asTextData(t);if(o==null)throw new Error("attempt to set null textData");let i={};i.characters=o.characters();let a=[];o.styleOverrideTable().forEachStyle((c,l)=>{Io.each(l,(u,d)=>{let S=Ae.serializeValueToKiwiForTests1(u,d).a;S.styleID=c,a.push(S)})}),i.styleOverrideTable=a;let s=[];o.usedEmojiCodepoints().forEach(c=>{let l={};l.emojiCodePoints=c,s.push(l)}),i.glyphs=s,n.textData=i}else if(e==60){let o=Z.asEffectList(t);if(o==null)throw new Error("attempt to set null effects");let i=[];for(let a=0,s=o.length;a<s;a=a+1){let c=o[a],l={};l.blendMode=c.blendMode(),l.radius=c.blurRadius(),l.spread=c.spread(),l.visible=c.isEnabled(),l.showShadowBehindNode=c.showShadowBehindNode(),l.type=c.type();let u={};u.r=E.redF(c.blurColor()),u.g=E.greenF(c.blurColor()),u.b=E.blueF(c.blurColor()),u.a=c.opacity(),l.color=u;let d=Ae.encodeVector2(c.blurOffset());l.offset=d,i.push(l)}n.effects=i}else if(e==50){let o=Z.asGUID(t);if(o==null)throw new Error("attempt to set null overridenSymbolID");n.overriddenSymbolID=Ae.encodeGUID(o)}else if(e==81){let o=Z.asPrototypeInteractionList(t);if(o==null)throw new Error("attempt to set null prototypeInteractions");let i=[];for(let a=0,s=o.length;a<s;a=a+1){let c=o[a];i.push(Ae.encodePrototypeInteractionForTests(c))}n.prototypeInteractions=i}else if(e==94){let o=Z.asStringEnum(t,null);if(o==null)throw new Error("Bad node phase");n.phase=o}else{let o=il(e);throw new Error(`unsupported setter for node field ${Rt[e]} and type ${ol[o]}`)}}_imageDecoded(e,t,n){this._imageManager!=null&&this._imageManager.onNewImage(e,t,n)}_imageByHexHashOrNull(e,t){var r;let n;return(r=this._imageManager)==null?void 0:r.findImageByHexHash(e,t)}decodeImage(e,t,n){let r=Un.bytesToHex(e.hash),o=this._imageByHexHashOrNull(r,1);if(o==null){let i=null;if(e.dataBlob!==void 0){let a=e.dataBlob;a<0||a>=t.length?console.warn(`ignoring invalid compressed data index ${a} for blob count ${t.length}`):i=t[a].bytes}Rr?o=new Ic(null,r):o=Un.createImage(e.hash,i,n),this._imageDecoded(r,1,o)}return o}decodeVideo(e){let t=new Uint8Array(e.hash);return this._videoManager.buildVideoResource(t)}decodeEmojiImage(e){let t=e.map(r=>r.toString(16)).join("-"),n=this._imageByHexHashOrNull(t,0);return n==null&&(n=Un.createEmojiImage2(t),this._imageDecoded(t,0,n)),n}decodePaints(e,t){let n=[];for(let o of e){let i=new ne(o.type);if(o.blendMode!==void 0&&i.setBlendMode(o.blendMode),o.color!==void 0){let a=Ae.decodeColor(o.color);i.setOpacity(E.alphaF(a)),i.setColor(E.withAlpha(a,255))}if(o.opacity!==void 0&&i.setOpacity(i.opacity()*o.opacity),o.stops!==void 0&&i.setColorStops1(Ae.decodeStops(o.stops)),o.transform!==void 0&&i.setTransform1(Ae.decodeMatrix(o.transform)),o.visible!==void 0&&i.setIsEnabled(o.visible),o.imageScaleMode!==void 0&&i.setImageScaleMode(o.imageScaleMode),o.rotation!==void 0&&i.setRotationDeg(o.rotation),o.scale!==void 0&&i.setScalingFactor(o.scale),o.paintFilter!==void 0&&i.setFilterColorAdjust(o.paintFilter),o.originalImageWidth!==void 0&&i.setOriginalImageWidth(o.originalImageWidth),o.originalImageHeight!==void 0&&i.setOriginalImageHeight(o.originalImageHeight),o.emojiCodePoints!==void 0)i.setImage(this.decodeEmojiImage(o.emojiCodePoints));else{let a=!1;o.animatedImage!==void 0&&o.animatedImage.hash!==void 0?(i.setImage(this.decodeImage(o.animatedImage,t,0)),o.animationFrame!==void 0&&o.animationFrame!=0&&(a=!0)):o.video!==void 0&&o.video.hash!==void 0?(i.setVideo(this.decodeVideo(o.video)),o.image!==void 0&&o.image.hash!==void 0&&i.setImage(this.decodeImage(o.image,t,1))):o.image!==void 0&&o.image.hash!==void 0&&i.setImage(this.decodeImage(o.image,t,1)),!a&&o.imageThumbnail!==void 0&&o.imageThumbnail.hash!==void 0&&i.setImageThumbnail(this.decodeImage(o.imageThumbnail,t,1))}i.opacity()!=0&&i.opacity()<1/250&&i.setOpacity(1/250),n.push(i)}let r=Z.new11(n);return Z.asPaintList(r)}decodePath(e,t){let n=Ht.IntMap_get(this._paths,e,null);return n==null&&(e<0||e>=t.length?(console.warn(`ignoring invalid path index ${e} for blob count ${t.length}`),n=new vt(new ar)):n=new vt(new ar(new Uint8Array(t[e].bytes))),this._paths.set(e,n)),n}decodeGeometry(e,t){let n=[],r=null;for(let i of e){let a="ODD";if(i.commandsBlob===void 0){console.warn("ignoring path with missing required field: 'commandsBlob'");continue}i.windingRule!==void 0&&(a=i.windingRule);let s=this.decodePath(i.commandsBlob,t);n.push(new Hn(a,0,s,s.bounds())),i.styleID!==void 0&&(r==null&&(r=[]),r.push(i.styleID))}bt.INSTANCE.reset();for(let i of n)bt.INSTANCE.include3(i.bounds());let o=Z.new26(new Dn(n,r,bt.INSTANCE.build(),null));return Z.asGeometry(o)}decodeTextData(e,t){let n=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,t):new Yn,r=e.hyperlinkBoxes!==void 0?e.hyperlinkBoxes:[],o=Z.new21(new Hr(n,0,r,e.characters!==void 0?e.characters:"",e.lines!==void 0?e.lines:[],e.characterStyleIDs!==void 0?e.characterStyleIDs:[],[],[]));return Z.asTextData(o)}decodeVectorData(e,t){let n=e.styleOverrideTable!==void 0?this.decodeStyleOverrideTable(e.styleOverrideTable,t):new Yn,r=Z.new22(new ds(n));return Z.asVectorData(r)}decodeSymbolData(e,t){return e.symbolID===void 0?(console.warn("ignoring symbol data with missing required field: 'symbolID'"),null):new ti(Ae.decodeGUID(e.symbolID),e.symbolOverrides!==void 0?this.decodeOverrides(e.symbolOverrides,t):go._new())}decodeOverrides(e,t){let n=go._new();for(let r of e)if(r.guidPath!==void 0){let o=Ae.decodeGUIDPath(r.guidPath),i=_n._new();this.decodeNodeChange(r,t,(a,s)=>{_n.set(i,a,s)}),go.map(n).set(o,i)}return n}decodeStyleOverrideTable(e,t){let n=new Map;for(let r of e)r.styleID!==void 0&&this.decodeNodeChange(r,t,(o,i)=>{n.has(r.styleID)||n.set(r.styleID,_n._new()),_n.set(n.get(r.styleID),o,i)});return new Yn(n)}decodeNodeChange(e,t,n){e.type!==void 0&&n(18,Z.new8(e.type)),e.backgroundColor!==void 0&&n(63,Z.new7(Ae.decodeColor(e.backgroundColor))),e.backgroundEnabled!==void 0&&n(8,Z.new3(e.backgroundEnabled)),e.backgroundOpacity!==void 0&&n(37,Z.new4(e.backgroundOpacity)),e.blendMode!==void 0&&n(21,Z.new8(e.blendMode)),e.connectionType!==void 0&&n(25,Z.new8(e.connectionType)),e.connectionURL!==void 0&&n(69,Z.new8(e.connectionURL)),e.containerSupportsFillStrokeAndCorners!==void 0&&n(78,Z.new3(e.containerSupportsFillStrokeAndCorners)),e.cornerRadius!==void 0&&n(43,Z.new4(e.cornerRadius)),e.rectangleTopLeftCornerRadius!==void 0&&n(38,Z.new4(e.rectangleTopLeftCornerRadius)),e.rectangleTopRightCornerRadius!==void 0&&n(39,Z.new4(e.rectangleTopRightCornerRadius)),e.rectangleBottomLeftCornerRadius!==void 0&&n(40,Z.new4(e.rectangleBottomLeftCornerRadius)),e.rectangleBottomRightCornerRadius!==void 0&&n(41,Z.new4(e.rectangleBottomRightCornerRadius)),e.rectangleCornerRadiiIndependent!==void 0&&n(14,Z.new3(e.rectangleCornerRadiiIndependent)),e.cornerSmoothing!==void 0&&n(44,Z.new4(e.cornerSmoothing)),e.easingType!==void 0&&n(27,Z.new8(e.easingType)),e.effects!==void 0&&n(60,Z.new17(Ae.decodeEffects(e.effects))),e.arcData!==void 0&&n(62,Z.new30(e.arcData)),e.shapeWithTextType!==void 0&&n(84,Z.new43(e.shapeWithTextType)),e.fillGeometry!==void 0&&n(72,Z.new26(this.decodeGeometry(e.fillGeometry,t))),e.fillPaints!==void 0&&n(58,Z.new11(this.decodePaints(e.fillPaints,t))),e.frameMaskDisabled!==void 0&&n(12,Z.new3(e.frameMaskDisabled)),e.interactionType!==void 0&&n(28,Z.new8(e.interactionType)),e.internalOnly!==void 0&&n(11,Z.new3(e.internalOnly)),e.isStateGroup!==void 0&&n(80,Z.new3(e.isStateGroup)),e.mask!==void 0&&n(9,Z.new3(e.mask)),e.maskIsOutline!==void 0&&n(10,Z.new3(e.maskIsOutline)),e.name!==void 0&&n(61,Z.new8(e.name)),e.navigationType!==void 0&&n(29,Z.new38(e.navigationType)),e.opacity!==void 0&&n(36,Z.new4(Pe.Math_clamp1(e.opacity,0,1))),e.overlayBackgroundInteraction!==void 0&&n(31,Z.new8(e.overlayBackgroundInteraction)),e.overlayBackgroundAppearance!==void 0&&n(66,Z.new29(Ae.decodeOverlayBackgroundAppearance(e.overlayBackgroundAppearance))),e.overlayPositionType!==void 0&&n(30,Z.new8(e.overlayPositionType)),e.overlayRelativePosition!==void 0&&n(56,Z.new10(Ae.decodeVector(e.overlayRelativePosition))),e.overriddenSymbolID!==void 0&&n(50,Z.new32(Ae.decodeGUID(e.overriddenSymbolID))),e.overrideKey!==void 0&&n(49,Z.new32(Ae.decodeGUID(e.overrideKey))),e.parentIndex!==void 0&&n(24,Z.new25(Ae.decodeParentIndex(e.parentIndex))),e.prototypeBackgroundColor!==void 0&&n(64,Z.new7(Ae.decodeColor(e.prototypeBackgroundColor))),e.prototypeDevice!==void 0&&n(65,Z.new27(Ae.decodePrototypeDevice(e.prototypeDevice))),e.prototypeStartNodeID!==void 0&&n(68,Z.new32(Ae.decodeGUID(e.prototypeStartNodeID))),e.prototypeStartingPoint!==void 0&&n(83,Z.new28(Ae.decodePrototypeStartingPoint(e.prototypeStartingPoint))),e.resizeToFit!==void 0&&n(13,Z.new3(e.resizeToFit)),e.scrollDirection!==void 0&&n(33,Z.new42(e.scrollDirection)),e.size!==void 0&&n(48,Z.new10(Ae.decodeVector(e.size))),e.strokeAlign!==void 0&&n(22,Z.new8(e.strokeAlign)),e.strokeGeometry!==void 0&&n(73,Z.new26(this.decodeGeometry(e.strokeGeometry,t))),e.strokePaints!==void 0&&n(59,Z.new11(this.decodePaints(e.strokePaints,t))),e.symbolData!==void 0&&n(74,Z.new33(this.decodeSymbolData(e.symbolData,t))),e.videoPlayback!==void 0&&n(71,Z.new46(Ae.decodeVideoPlayback(e.videoPlayback))),e.stackReverseZIndex!==void 0&&n(77,Z.new3(e.stackReverseZIndex)),e.textData!==void 0&&n(4,Z.new21(this.decodeTextData(e.textData,t))),e.vectorData!==void 0&&n(75,Z.new22(this.decodeVectorData(e.vectorData,t))),e.transform!==void 0&&n(23,Z.new2(Ae.decodeMatrix(e.transform))),e.transitionNodeID!==void 0&&n(70,Z.new32(Ae.decodeGUID(e.transitionNodeID))),e.transitionType!==void 0&&n(26,Z.new8(e.transitionType)),e.transitionShouldSmartAnimate!==void 0&&n(17,Z.new3(e.transitionShouldSmartAnimate)),e.transitionDuration!==void 0&&n(45,Z.new4(e.transitionDuration)),e.transitionTimeout!==void 0&&n(46,Z.new4(e.transitionTimeout)),e.interactionMaintained!==void 0&&n(15,Z.new3(e.interactionMaintained)),e.interactionDuration!==void 0&&n(47,Z.new4(e.interactionDuration)),e.transitionPreserveScroll!==void 0&&n(16,Z.new3(e.transitionPreserveScroll)),e.visible!==void 0&&n(7,Z.new3(e.visible)),e.styleType!==void 0&&n(32,Z.new8(e.styleType)),e.inheritFillStyleID!==void 0&&n(51,Z.new32(Ae.decodeGUID(e.inheritFillStyleID))),e.inheritFillStyleIDForStroke!==void 0&&n(52,Z.new32(Ae.decodeGUID(e.inheritFillStyleIDForStroke))),e.inheritEffectStyleID!==void 0&&n(55,Z.new32(Ae.decodeGUID(e.inheritEffectStyleID))),e.inheritTextStyleID!==void 0&&n(54,Z.new32(Ae.decodeGUID(e.inheritTextStyleID))),e.styleIdForFill!==void 0&&n(89,Z.new31(Ae.decodeStyleId(e.styleIdForFill))),e.styleIdForStrokeFill!==void 0&&n(90,Z.new31(Ae.decodeStyleId(e.styleIdForStrokeFill))),e.styleIdForEffect!==void 0&&n(92,Z.new31(Ae.decodeStyleId(e.styleIdForEffect))),e.styleIdForText!==void 0&&n(91,Z.new31(Ae.decodeStyleId(e.styleIdForText))),e.horizontalConstraint!==void 0&&n(19,Z.new8(e.horizontalConstraint)),e.verticalConstraint!==void 0&&n(20,Z.new8(e.verticalConstraint)),e.scrollBehavior!==void 0&&n(34,Z.new37(e.scrollBehavior)),e.keyTrigger!==void 0&&n(79,Z.new44(e.keyTrigger)),e.prototypeInteractions!==void 0&&n(81,Z.new45(Ae.decodePrototypeInteractions(e.prototypeInteractions))),e.fontSize!==void 0&&n(3,Z.new4(e.fontSize)),e.textAlignHorizontal!==void 0&&n(1,Z.new8(e.textAlignHorizontal)),e.textAlignVertical!==void 0&&n(2,Z.new8(e.textAlignVertical)),e.strokeWeight!==void 0&&n(42,Z.new4(e.strokeWeight)),e.hyperlink!==void 0&&n(5,Z.new47(e.hyperlink)),e.mention!==void 0&&n(6,Z.new48(e.mention)),e.transitionType!==void 0&&e.transitionType=="MAGIC_MOVE"&&n(26,Z.new8("SMART_ANIMATE"))}decompressZlibOrZstd(e){let t=new lo;try{let n=ii.inflateRaw(e);t.resolve(n)}catch{let n=new ZSTDDecoder;n.init().then(o=>{t.resolve(n.decode(e))},o=>{t.resolve(null)})}return t}decodeSceneForViewerAndPrototypeLib1(e,t){return this.decodeSceneForViewerAndPrototypeLib2(e,t,null)}decodeSceneForViewerAndPrototypeLib2(e,t,n){let r=new lo,o=e.length,i=Ae.FILE_HEADER.length;if(Ae.hasFileHeader(e)&&i+4<=o){let a=Ae.readInt32(e,i);if(i=i+4,a>=1&&i+4<=o){let s=Ae.readInt32(e,i);i=i+4,i+s+4<=o?this.decompressZlibOrZstd(e.subarray(i,i+s)).then1(c=>{let l=kiwi.compileSchema(kiwi.decodeBinarySchema(c));i=i+s;let u=Ae.readInt32(e,i);if(i=i+4,i+u<=o){let d=e.subarray(i,i+u);i=i+u;let h=!1;for(;i<o;){i+4>e.length&&r.resolve(null);let S=Ae.readInt32(e,i);if(i=i+4,S==0)continue;i+Ae.CHUNK_TAG_LEN>o&&r.resolve(null);let f=e.subarray(i,i+Ae.CHUNK_TAG_LEN);i=i+Ae.CHUNK_TAG_LEN;let y=S-Ae.CHUNK_TAG_LEN;switch(i+y>o&&r.resolve(null),i=i+y,Ae.parseChunkType(f)){case Ae.ChunkType.THUMBNAIL:{h&&r.resolve(null),h=!0;break}case Ae.ChunkType.UNKNOWN:break}}this.decompressZlibOrZstd(new Uint8Array(d)).then1(S=>{let f=l.decodeMessage(S);if(f.type!==void 0&&f.type=="NODE_CHANGES"){let y=yt.createScene(yt.MAGIC_SESSION_ID_FOR_NON_MULTIPLAYER,t);n!=null&&y.setFileKey(n),y.applyMessageToScene(S),r.resolve(y)}else r.resolve(null)})}else r.resolve(null)}):r.resolve(null)}else r.resolve(null)}else r.resolve(null);return r}},pt=Ae;pt.VERBOSE=!1,pt.FILE_HEADER=[102,105,103,45,107,105,119,105],pt.CHUNK_TAG_LEN=8,pt.THUMBNAIL_CHUNK_TAG=[137,80,78,71,13,10,26,10];(n=>{let g;(i=>(i[i.THUMBNAIL=0]="THUMBNAIL",i[i.UNKNOWN=1]="UNKNOWN"))(g=n.ChunkType||(n.ChunkType={}));class e{constructor(o){this.timeSpentApplyingMessageToSceneMs=o}}n.TimingInfo=e;let t;(o=>{function r(i){return n.ChunkType[i]}o.ChunkType_toString=r})(t=n.in_ChunkType||(n.in_ChunkType={}))})(pt||(pt={}));var zr;(r=>{function g(o,i){return o==i?!0:o==25?i==70||i==69:!1}r.affects=g;function e(o){return o==58||o==59||o==51||o==52||o==89||o==90||o==4}r.affectsImagesUsedByNode=e;function t(o){switch(o){case 94:case 24:case 7:case 25:case 69:case 47:case 15:case 28:case 33:case 64:case 65:case 81:case 68:case 83:case 34:case 45:case 70:case 16:case 46:case 26:case 29:case 30:case 56:case 31:case 66:return!0}return!1}r.isPrototypeStructuralChange=t;function n(o){switch(o){case 28:case 15:case 47:case 79:case 82:case 70:case 26:case 45:case 27:case 46:case 17:case 25:case 69:case 56:case 29:case 16:case 4:return!0}return!1}r.isInteractionProperty=n})(zr||(zr={}));var ol=(Y=>(Y[Y.BOOL=0]="BOOL",Y[Y.DOUBLE=1]="DOUBLE",Y[Y.INT=2]="INT",Y[Y.STRING=3]="STRING",Y[Y.STRING_ENUM=4]="STRING_ENUM",Y[Y.AFFINE_TRANSFORM=5]="AFFINE_TRANSFORM",Y[Y.ARC_DATA=6]="ARC_DATA",Y[Y.GUID=7]="GUID",Y[Y.STYLE_ID=8]="STYLE_ID",Y[Y.OVERLAY_BACKGROUND_APPEARANCE=9]="OVERLAY_BACKGROUND_APPEARANCE",Y[Y.VECTOR=10]="VECTOR",Y[Y.EFFECT_LIST=11]="EFFECT_LIST",Y[Y.PAINT_LIST=12]="PAINT_LIST",Y[Y.PROTOTYPE_INTERACTION_LIST=13]="PROTOTYPE_INTERACTION_LIST",Y[Y.GEOMETRY=14]="GEOMETRY",Y[Y.PARENT_INDEX=15]="PARENT_INDEX",Y[Y.PROTOTYPE_DEVICE=16]="PROTOTYPE_DEVICE",Y[Y.PROTOTYPE_STARTING_POINT=17]="PROTOTYPE_STARTING_POINT",Y[Y.VIDEO_PLAYBACK=18]="VIDEO_PLAYBACK",Y[Y.KEY_TRIGGER=19]="KEY_TRIGGER",Y[Y.SYMBOL_DATA=20]="SYMBOL_DATA",Y[Y.TEXT_DATA=21]="TEXT_DATA",Y[Y.VECTOR_DATA=22]="VECTOR_DATA",Y[Y.HYPERLINK=23]="HYPERLINK",Y[Y.MENTION=24]="MENTION",Y[Y.OTHER__=25]="OTHER__",Y[Y.END__=26]="END__",Y))(ol||{}),ug;(e=>{function g(t){return ol[t]}e.BindingType_toString=g})(ug||(ug={}));function il(g){switch(g){case 78:case 88:case 11:case 8:case 12:case 9:case 10:case 13:case 80:case 7:case 15:case 14:case 16:case 17:case 86:case 77:return 0;case 37:case 43:case 44:case 3:case 47:case 36:case 38:case 39:case 40:case 41:case 42:case 45:case 46:return 1;case 63:case 64:return 2;case 69:case 61:case 82:return 3;case 21:case 25:case 19:case 20:case 27:case 28:case 29:case 31:case 33:case 30:case 94:case 34:case 84:case 76:case 22:case 32:case 1:case 2:case 26:case 18:return 4;case 23:return 5;case 62:return 6;case 49:case 50:case 68:case 51:case 52:case 53:case 55:case 54:case 70:return 7;case 89:case 90:case 91:case 92:case 93:return 8;case 66:return 9;case 87:case 56:case 85:case 48:return 10;case 60:return 11;case 57:case 58:case 59:return 12;case 81:return 13;case 72:case 73:return 14;case 24:return 15;case 65:return 16;case 83:return 17;case 79:return 19;case 74:return 20;case 4:return 21;case 75:return 22;case 71:return 18;case 5:return 23;case 6:return 24;case 67:case 35:return 25;default:return 26}}function pg(g,e){switch(e){case 21:return Se.schema.BlendMode[g];case 25:return Se.schema.ConnectionType[g];case 19:return Se.schema.ConstraintType[g];case 20:return Se.schema.ConstraintType[g];case 27:return Se.schema.EasingType[g];case 28:return Se.schema.InteractionType[g];case 29:return Se.schema.NavigationType[g];case 31:return Se.schema.OverlayBackgroundInteraction[g];case 33:return Se.schema.ScrollDirection[g];case 30:return Se.schema.OverlayPositionType[g];case 94:return Se.schema.NodePhase[g];case 34:return Se.schema.ScrollBehavior[g];case 84:return Se.schema.ShapeWithTextType[g];case 76:return Se.schema.StackMode[g];case 22:return Se.schema.StrokeAlign[g];case 32:return Se.schema.StyleType[g];case 1:return Se.schema.TextAlignHorizontal[g];case 2:return Se.schema.TextAlignVertical[g];case 26:return Se.schema.TransitionType[g];case 18:return Se.schema.NodeType[g];default:throw new Error(`Given field ${Rt[e]} is not a string enum field`)}}function Ac(g,e,t){switch(il(t)){case 0:return Z.new3(g.getBool(e,t));case 1:return Z.new4(g.getDouble(e,t));case 2:return Z.new7(g.getInt(e,t));case 3:return Z.new8(g.getString(e,t));case 4:return Z.new8(pg(g.getInt(e,t),t));case 5:return Z.new2(g.getAffineTransform(e,t));case 6:return Z.new30(g.getArcData(e,t));case 7:return Z.new32(g.getGUID(e,t));case 8:return Z.new31(g.getStyleId(e,t));case 10:return Z.new10(g.getVector(e,t));case 11:return Z.new17(g.getEffectList(e));case 12:return Z.new11(g.getPaintList(e,t));case 15:return Z.new25(g.getParentIndex(e));case 13:case 9:case 19:case 17:case 16:case 18:case 23:case 24:return g.getField(e,t);case 20:case 22:return null;case 14:case 21:case 25:return null;default:return ze(`Unhandled node field ${Rt[t]} in getCppNodeValue`),null}}function hg(g,e,t,n,r){switch(il(n)){case 0:return Z.new3(g.getBool_SGEO(r));case 1:return Z.new4(g.getDouble_SGEO(r));case 2:return Z.new7(g.getInt_SGEO(r,n));case 3:return Z.new8(g.getString_SGEO(r));case 4:return Z.new8(pg(g.getInt_SGEO(r,n),n));case 5:return Z.new2(g.getAffineTransform_SGEO(r));case 6:return Z.new30(g.getArcData_SGEO(r));case 7:return Z.new32(g.getGUID_SGEO(r));case 8:return Z.new31(g.getStyleId_SGEO(r));case 10:return Z.new10(g.getVector_SGEO(r));case 11:return Z.new17(g.getEffectList_SGEO(r));case 12:return Z.new11(g.getPaintList_SGEO(r));case 15:return Z.new25(g.getParentIndex_SGEO(r));case 13:return Z.new45(g.getPrototypeInteractions_SGEO(r));case 9:case 19:case 17:case 16:case 18:case 23:case 24:return g.getField_SGEO(r);case 20:case 22:return null;case 14:case 21:case 25:return null;default:return ze(`Unhandled node field ${Rt[n]} in getCppSGEOValue`),null}}function Or(g,e,t,n){let r=pt.serializeValueToKiwiForTests1(t,n),o=r.a,i=r.b;o.guid=pt.encodeGUID(e.id()),ic(o,i)}var jr;(t=>{function g(n){return n!=-1}t.WeakHandle_isValid=g;function e(n){return n}t.WeakHandle_toInt=e})(jr||(jr={}));var Ke=class extends Vc{constructor(e,t,n){super();this._scene=null,this._id=null,this._scrollingLogic=null,this._handle=0,this._cachedType=null,this._absoluteTransform=Nt.FrozenAffineTransform_IDENTITY,this._flags=(4|1)&~2,this._cachedChildren=[],this._cachedParent=null,this._isPartOfLoop=!1,this.transitioningFrom=null,this._lastParent=null,this._lazyInteractionsMigrationValue=null,this._cachedCanvasSpaceGeometryBounds=Kn.FrozenRect_EMPTY,this._cachedCanvasSpaceRenderedBounds=Kn.FrozenRect_EMPTY,this._cachedCanvasSpaceScrollingBounds=Kn.FrozenRect_EMPTY,this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlurs=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null,this._overlayCacheKey=null,this._scene=t,this._id=n,this._scrollingLogic=new qc(this),this._handle=e}handle(){return this._handle}updateAfterPropertyChange(e){e==24?(this.updateDirtyFlagsForPropertyChange(e,this._lastParent),this._lastParent=this.parent()):this.updateDirtyFlagsForPropertyChange(e,null),e==18&&(this._cachedType=null)}linkToParent(e,t){e!=null&&(this._cachedParent=e,this._addFlagsToSelfAndChildren(1),e._cachedChildren.splice(t,0,this),this.updateIsRooted())}unlinkFromParent(){this._cachedParent!=null&&(ie.List_removeOne(this._cachedParent._cachedChildren,this),this._cachedParent=null,this.updateIsRooted())}hasOverflowingContentInScrollDirection(){return this._scrollingLogic.hasOverflowingContentInScrollDirection()}scrollsInPreferredDirection(e){return this._scrollingLogic.scrollsInPreferredDirection(e)}scrollAndClipBoundsBySelfAndAncestors(e,t){return this._scrollingLogic.scrollAndClipBoundsBySelfAndAncestors(e,t)}canvasSpaceScrolledBounds(e){return this._scrollingLogic.canvasSpaceScrolledBounds(e)}canvasSpaceScrolledInteractiveBounds(e){return this._scrollingLogic.canvasSpaceScrolledInteractiveBounds(e)}scrollDirection(){return this._scrollingLogic.scrollDirection()}scrollDirectionWithScrollableContent(){return this._scrollingLogic.scrollDirectionWithScrollableContent()}isFixed(){return this._scrollingLogic.isFixed()}isStandardScrolling(){return this._scrollingLogic.isStandardScrolling()}isStickyScrolling(){return this._scrollingLogic.isStickyScrolling()}defaultScrollOffset(){return this._scrollingLogic.defaultScrollOffset()}canvasSpaceContentBounds(){return this._scrollingLogic.canvasSpaceContentBounds()}nodeSpaceScrollableContentBounds(){return this._scrollingLogic.nodeSpaceScrollableContentBounds()}minScrollOffsetX(){return this._scrollingLogic.minScrollOffsetX()}minScrollOffsetY(){return this._scrollingLogic.minScrollOffsetY()}maxScrollOffsetX(){return this._scrollingLogic.maxScrollOffsetX()}maxScrollOffsetY(){return this._scrollingLogic.maxScrollOffsetY()}hasOverflowingContentInXDirection(){return this._scrollingLogic.hasOverflowingContentInXDirection()}hasOverflowingContentInYDirection(){return this._scrollingLogic.hasOverflowingContentInYDirection()}isSpreadEligibleNode(){return ln.isFrameLike(this.type())?this.isFrameBackgroundVisible()&&this.clipsToBoundingRectangle():ln.isRectOrEllipseLike(this.type())}id(){return this._id}isRooted(){return(2&this._flags)!=0}parent(){return this._cachedParent}scene(){return this._scene}isInvisibleOrTransparent(){return!this.visible()||this.opacity()<=0}fillPaintsToRender(){return this.containerSupportsFillStrokeAndCorners()?this.fillPaints():this.has(37)&&this.has(63)?[ne.createSolid(this.computedBackgroundColor(),1)]:Re.EMPTY}computedBackgroundColor(){return this.isBackgroundEnabled()?E.multiplyOpacity(this.backgroundColor(),this.backgroundOpacity()):E.TRANSPARENT}isInsideOutlineMask(){return this.isMask()&&(this.isMaskOutline_DEPRECATED()||this.maskType()=="OUTLINE")||(this.parent()!=null?this.parent().isInsideOutlineMask():!1)}isOrInSymbol(){return this.type()=="SYMBOL"?!0:this.parent()!=null?this.parent().isOrInSymbol():!1}isStack(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().getIsStack(2)}isInstanceSublayer(){return this.stablePath().guids.length>1}isPrimaryInstance(){return this.stablePath().guids.length==1&&this.isInstance()}isState(){return this.type()=="SYMBOL"&&this.parent()!=null&&this.parent().isStateGroup()}isInstance(){return this.type()=="INSTANCE"}isOrInInstance(){return this.isInstanceSublayer()||this.isPrimaryInstance()}isSymbol(){return this.type()=="SYMBOL"}findContainingPrimaryInstance(){return this.isOrInInstance()?this.scene().findNode1(this.stablePath().guids[0]):null}findNearestAncestorSectionOrNull(){let e=this;for(;e!=null&&e.type()!="CANVAS"&&e.type()!="DOCUMENT";){if(e.type()=="SECTION")return e;e=e.parent()}return null}findContainingCanvasOrSelf(){let e=this;for(;e!=null;){if(e.type()=="CANVAS")return e;if(e.parent()==null)break;e=e.parent()}return null}constrainsAnchoredChildren(){return ln.isFrameLike(this.type())&&!this.isResizeToFit()}size(){return this._scrollingLogic.nodeSize()}prototypeDevice(){return Q.deviceFramesSupported()?this.storedPrototypeDevice():Xn.DEFAULT}findContainingCanvasOrParent(){let e=this.parent();for(;e!=null&&e.type()!="CANVAS"&&e.parent()!=null;)e=e.parent();return e}guidPath(){return x._prototypeLib.getOverridePath(this)}stablePath(){return x._prototypeLib.getStablePath(this)}removeSelfAndSubtree(){x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().removeSelfAndChildren(2)}type(){if(this._cachedType==null||this._cachedType=="NONE"){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApiGenerated().getType(2);this._cachedType=Ke.schema.NodeType[e]}return this._cachedType}setType(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Ke.schema.NodeType[e];x._prototypeLib.nodeTsApiGenerated().setType(t,2)}name(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().getName(2)}setName(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=x._prototypeLib.nodeTsApi().setName(e,2);t!=""&&ze(t)}scrollOffset(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getScrollOffset(2);return new I(e.x,e.y)}setScrollOffset(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=x._prototypeLib.nodeTsApi().setScrollOffset({x:e.x(),y:e.y()},2);t!=""&&ze(t)}currentViewportSize(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getCurrentViewportSize(2);return new I(e.x,e.y)}setCurrentViewportSize(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=x._prototypeLib.nodeTsApi().setCurrentViewportSize({x:e.x(),y:e.y()},2);t!=""&&ze(t)}fullSize(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getSize(2);return new I(e.x,e.y)}setSize(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=x._prototypeLib.nodeTsApi().setSize(e.x(),e.y(),2);t!=""&&ze(t)}relativeTransform(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getRelativeTransform(2);return new ee(e.m00,e.m01,e.m02,e.m10,e.m11,e.m12)}setRelativeTransform(e){this.setRelativeTransform1(e)}setRelativeTransform1(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=x._prototypeLib.nodeTsApi().setRelativeTransform(e.m00(),e.m01(),e.m02(),e.m10(),e.m11(),e.m12(),2);t!=""&&ze(t)}stackMode(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getStackMode(2);return Ke.schema.StackMode[e]}setStackMode(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=Ke.schema.StackMode[e];x._prototypeLib.nodeTsApi().setStackMode(t,2)}arcData(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().getArcData(2)}setArcData(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=x._prototypeLib.nodeTsApi().setArcData(e.startingAngle,e.endingAngle,e.innerRadius,2);t!=""&&ze(t)}backgroundColor(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getBackgroundColor(2);return E.new3(e.red,e.green,e.blue,e.alpha)}setBackgroundColor(e){x._prototypeLib.prepareCppNodeForAccess(this);let t=x._prototypeLib.nodeTsApi().setBackgroundColor(E.toColorF(e),2);t!=""&&ze(t)}prototypeBackgroundColor(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getPrototypeBackgroundColor(2);return E.fromColorF(e)}setPrototypeBackgroundColor(e){x._prototypeLib.prepareCppNodeForAccess(this);let t={red:E.redF(e),green:E.greenF(e),blue:E.blueF(e),alpha:E.alphaF(e)},n=x._prototypeLib.nodeTsApi().setPrototypeBackgroundColor(t,2);n!=""&&ze(n)}parentIndex(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getParentIndex(2),t=e.parent;return new kn(t,e.position)}setParentIndex(e){x._prototypeLib.prepareCppNodeForAccess(this);let t={parent:e.id,position:e.position},n=x._prototypeLib.nodeTsApi().setParentIndex(t,2);n!=""&&ze(n)}fillPaints(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getFillPaints(2);return jr.WeakHandle_isValid(e)?x._prototypeLib.modules().paintData_Internal.getOrCreateSkewCopy(e):[]}getBoundVariables(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().getBoundVariables(2)}getResolvedVariableModes(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().getResolvedVariableModes(2)}setTestOnlyFillPaints(e){dr("Paint serialization only partially implemented in Skew"),Or(x._prototypeLib,this,58,Z.new11(e))}setTestOnlyFillPaints1(e){dr("Paint serialization only partially implemented in Skew"),Or(x._prototypeLib,this,58,Z.new12(e))}setTestOnlyFillPaints2(e){dr("Paint serialization only partially implemented in Skew"),Or(x._prototypeLib,this,58,Z.new14(e))}setTestOnlyFillPaints3(e){dr("Paint serialization only partially implemented in Skew"),Or(x._prototypeLib,this,58,Z.new16(e))}strokePaints(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getStrokePaints(2);return jr.WeakHandle_isValid(e)?x._prototypeLib.modules().paintData_Internal.getOrCreateSkewCopy(e):[]}setTestOnlyStrokePaints(e){dr("Paint serialization only partially implemented in Skew"),Or(x._prototypeLib,this,59,Z.new11(e))}setTestOnlyStrokePaints1(e){dr("Paint serialization only partially implemented in Skew"),Or(x._prototypeLib,this,59,Z.new12(e))}setTestOnlyStrokePaints2(e){dr("Paint serialization only partially implemented in Skew"),Or(x._prototypeLib,this,59,Z.new16(e))}setTestOnlyStrokePaints3(e){dr("Paint serialization only partially implemented in Skew"),Or(x._prototypeLib,this,59,Z.new14(e))}effects(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getEffects(2);return jr.WeakHandle_isValid(e)?x._prototypeLib.modules().effectData_Internal.getOrCreateSkewCopy(e):null}setTestOnlyEffects(e){dr("Effect serialization only partially implemented in Skew"),Or(x._prototypeLib,this,60,Z.new17(e))}setTestOnlyEffects1(e){dr("Effect serialization only partially implemented in Skew"),Or(x._prototypeLib,this,60,Z.new19(e))}setTestOnlyEffects2(e){dr("Effect serialization only partially implemented in Skew"),Or(x._prototypeLib,this,60,Z.new18(e))}symbolID(){return this.isInstance()?(x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().getSymbolId(2)):R.invalid()}setTestOnlySymbolData(e){dr("SymbolData serialization only partially implemented in Skew"),Or(x._prototypeLib,this,74,Z.new33(e))}fillGeometry(){if(2==0&&ln.isFrameLike(this.type())&&this.containerSupportsFillStrokeAndCorners())return Do(this.canvasSpaceBoundingBox());x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getFillGeometryRegions(2);return x._prototypeLib.idlRegionsToGeometry(e,null)}setTestOnlyFillGeometry(e){dr("Geometry serialization only partially implemented in Skew"),Or(x._prototypeLib,this,72,Z.new26(e))}strokeGeometry(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getStrokeGeometryRegions(2);return x._prototypeLib.idlRegionsToGeometry(e,null)}setTestOnlyStrokeGeometry(e){dr("Geometry serialization only partially implemented in Skew"),Or(x._prototypeLib,this,73,Z.new26(e))}textGeometry(){let e=this.textData();if(e==null)return null;x._prototypeLib.prepareCppNodeForAccess(this);let t=x._prototypeLib.nodeTsApi().getTextGeometryRegions(2),n=new ao(e.styleOverrideTable());return x._prototypeLib.idlRegionsToTextGeometry(t,n)}prototypeInteractions(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getPrototypeInteractions(2);return jr.WeakHandle_isValid(e)?x._prototypeLib.modules().prototypeInteractions_Internal.getOrCreateSkewCopy(e):[]}setTestOnlyPrototypeInteractions(e){dr("PrototypeInteraction[] serialization only partially implemented in Skew"),Or(x._prototypeLib,this,81,Z.new45(e))}prototypeStartingPoint(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getPrototypeStartingPoint(2);if(e==null)return null;let t=e;return new so(t.name,t.description,sn.fromString(t.position))}setPrototypeStartingPoint(e){x._prototypeLib.prepareCppNodeForAccess(this);let t={name:e.name,description:e.description,position:sn.toString(e.position)},n=x._prototypeLib.nodeTsApi().setPrototypeStartingPoint(t,2);n!=""&&ze(n)}storedPrototypeDevice(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getPrototypeDevice(2);if(e==null)return null;let t=e;return new Xn(Ke.schema.PrototypeDeviceType[t.type],new I(t.size.x,t.size.y),t.presetIdentifier,Ke.schema.DeviceRotation[t.rotation])}setPrototypeDevice(e){x._prototypeLib.prepareCppNodeForAccess(this);let t={type:Ke.schema.PrototypeDeviceType[e.type],size:{x:e.size().x(),y:e.size().y()},presetIdentifier:e.presetIdentifier,rotation:Ke.schema.DeviceRotation[e.rotation]};x._prototypeLib.nodeTsApi().setPrototypeDevice(t,2)}overlayBackgroundAppearance(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getOverlayBackgroundAppearance(2);if(e==null)return null;let t=e;return new vo(Ke.schema.OverlayBackgroundType[t.backgroundType],E.fromColorF(t.backgroundColor))}setOverlayBackgroundAppearance(e){x._prototypeLib.prepareCppNodeForAccess(this);let t={backgroundType:Ke.schema.OverlayBackgroundType[e.backgroundType],backgroundColor:E.toColorF(e.backgroundColor)},n=x._prototypeLib.nodeTsApi().setOverlayBackgroundAppearance(t,2);n!=""&&ze(n)}textData(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getTextData(2);return jr.WeakHandle_isValid(e)?x._prototypeLib.modules().textData_Internal.getOrCreateSkewCopy(e):null}setTestOnlyTextData(e){dr("TextData serialization only partially implemented in Skew"),Or(x._prototypeLib,this,4,Z.new21(e))}vectorData(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getVectorData(2);return jr.WeakHandle_isValid(e)?x._prototypeLib.modules().compiledVectorData_Internal.getOrCreateSkewCopy(e):null}videoPlayback(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().getVideoPlayback(2)}setVideoPlayback(e){x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().setVideoPlayback(e,2)}accessibleLabel(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().getAccessibleLabel(2)}ariaRole(){x._prototypeLib.prepareCppNodeForAccess(this);let e=x._prototypeLib.nodeTsApi().getAriaRole(2);return Ke.schema.ARIARole[e]}has(e){return x._prototypeLib.getHas(this,e)}get1(e,t){let n=Ac(x._prototypeLib,this,e);return n!=null?n:t}each(e){x._prototypeLib.forEachField(this,t=>{e(t,this.get2(t))})}isVisibleInCanvas(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().isVisibleInCanvas(2)}supportsBackgroundPaints(){return ln.isFrameLike(this.type())&&!this.containerSupportsFillStrokeAndCorners()}supportsGeometry(){return ln.isGeometryLeaf(this.type())||ln.isFrameLike(this.type())&&this.containerSupportsFillStrokeAndCorners()}findPrototypeInteraction(e){if(e==null)return null;let t=this.prototypeInteractions().filter(n=>R.equals(n.id(),e));return t.length==0?null:(t.length>1&&ze("Found multiple prototype interactions with the same GUID"),t[0])}get2(e){return this.get1(e,null)}updateDirtyFlagsForPropertyChange(e,t){this._handlePropertyChangeForTransform(e),this._handlePropertyChangeForBounds(e,t),this._handlePropertyChangeForRenderTree(e,t),this._handlePropertyChangeForInteractions(e)}_handlePropertyChangeForTransform(e){if((e==86||e==23||e==65||e==34||e==87)&&this._addFlagsToSelfAndChildren(1),e==19||e==20){let t=this;for(;t!=null&&!(t.isFixed()||t.hasOwnConstraintValues());)t=t.parent();t!=null&&t.isFixed()&&t.dirtyTransform()}}_handlePropertyChangeForInteractions(e){zr.isInteractionProperty(e)&&(this._lazyInteractionsMigrationValue=null)}map(e){return this._cachedChildren.map(e)}forEachChild(e){this._cachedChildren.forEach(e)}forEachDescendantPreorder(e){this._cachedChildren.forEach(t=>{e(t),t.forEachDescendantPreorder(e)})}childCount(){return this._cachedChildren.length}childAt1(e){return this.childAt2(e,!1)}childAt2(e,t){return t&&this.stackReverseZIndex()&&this.isStack()?this._cachedChildren[this.childCount()-e-1]:this._cachedChildren[e]}indexInParent(){if(this._cachedParent==null)return-1;let e=this._cachedParent._cachedChildren.indexOf(this);return this._cachedParent.stackReverseZIndex()&&this._cachedParent.isStack()&&(e=this._cachedParent.childCount()-e-1),e}updateIsRooted(){let e=this._cachedParent!=null?this._cachedParent.isRooted():this==this._scene.root();if(e!=this.isRooted()){this._flags=e?this._flags|2:this._flags&~2,e&&this._addFlagsToSelfAndChildren(1);for(let t of this._cachedChildren)t.updateIsRooted()}}appendChild(e){let t=this._cachedChildren.length==0?sn.FIRST_POSITION:sn.after(ie.List_last(this._cachedChildren).parentIndex().position);e.setParentIndex(new kn(this.id(),t))}collectUniqueUsedImages(){let e=new Map;return this.forEachSinglePaint(t=>{(t.type()=="IMAGE"||t.type()=="EMOJI"||t.type()=="VIDEO")&&(t.image()!=null&&e.set(t.image().objectHash(),t.image()),t.imageThumbnail()!=null&&e.set(t.imageThumbnail().objectHash(),t.imageThumbnail()))}),this.forEachEmojiInTextData(t=>{e.set(t.objectHash(),t)}),e}forEachSinglePaint(e){var o;let t,n,r=i=>{let a=i.asVolatilePaint();a!=null&&(e(a.from()),e(a.to()));let s=i.asSinglePaint();s!=null&&e(s)};this.fillPaints().forEach(r),this.strokePaints().forEach(r),(t=(o=this.textData())==null?void 0:o.styleOverrideTable())!=null&&t.forEachFillPaint(this.scene(),i=>{i.forEach(r)}),this.hasPerRegionFillPaints()&&this.forEachRegionWithFillPaintBatch((i,a)=>{a.forEach(r)})}forEachEmojiInTextData(e){var r;let t,n;this._cachedType=="TEXT"&&(t=(r=this.textData())==null?void 0:r.usedEmojiImages())!=null&&t.forEach(o=>{e(o)})}restartGifs(){this.forEachSinglePaint(e=>{let t=e.image();if(t==null||!t.isGIF())return;let n=t.gif();n!=null&&n.restart()})}clipsToBoundingRectangle(){return ln.isFrameLike(this.type())&&!this.isFrameMaskDisabled()&&!this.isResizeToFit()}isAxisAligned(){let e=1e-4,t=this.absoluteTransform();return Math.abs(t.m00())<e&&Math.abs(t.m11())<e||Math.abs(t.m01())<e&&Math.abs(t.m10())<e}isAxisAlignedRectFill(){return this.fillGeometry()!=null&&this.fillPaints().length!=0&&this.strokePaints().length==0&&this.fillGeometry().isRect()&&this.isAxisAligned()}isInSymbol(){let e=!1;for(let t=this;t!=null;t=t.parent())if(t.type()=="SYMBOL"){e=!0;break}return e}_addScrollableChildFramesToListRecursive(e){for(let t of this._cachedChildren)t.scrollDirection()!="NONE"&&e.push(t),t._addScrollableChildFramesToListRecursive(e)}scrollableFrameDescendants(){let e=[];return this._addScrollableChildFramesToListRecursive(e),e}isGroup(){return ln.isFrameLike(this.type())&&this.isResizeToFit()}hasOwnConstraintValues(){return this.type()!="BOOLEAN_OPERATION"&&this.type()!="CANVAS"&&this.type()!="DOCUMENT"&&!this.isGroup()}_collectConstraintValuesInSubtree(e){let t=null;return Ke.forEachNode1(this,n=>{if(!n.hasOwnConstraintValues())return Ke.Loop.CONTINUE;let r=e(n);if(t==null)t=new fe(r);else if(t.value!=r)return t=null,Ke.Loop.BREAK;return Ke.Loop.SKIP}),t}horizontalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(e=>e.horizontalConstraint())}verticalConstraintOfSubtree(){return this._collectConstraintValuesInSubtree(e=>e.verticalConstraint())}_withOverriddenFrameRole(e,t){this._scrollingLogic.overrideRole(e),this._addFlagsToSelfAndChildren(1),this._invalidateRenderTreeForSelf();for(let n=0,r=this.childCount();n<r;n=n+1){let o=this.childAt1(n);o.isFixed()&&Ke.forEachNode2(o,i=>{i._invalidateRenderTreeForSelf()})}t(),this._scrollingLogic.clearRoleOverride()}actingAsOverlayOrSublayerForRendertreeGeneration(e){this._withOverriddenFrameRole(1,e)}actingAsBaseScreenForRendertreeGeneration(e){this._withOverriddenFrameRole(0,e)}_translateFixedElementIfNecessary(e){if(!this.isFixed()||this.parent()==null||this.parent().scrollDirection()=="NONE")return;let t=this.parent();if(nr.scrollsHorizontally(t.scrollDirection())){let n=this.horizontalConstraintOfSubtree();n!=null&&(n.value=="MAX"?e.translate2(t.size().x()-t.fullSize().x(),0):n.value=="CENTER"&&e.translate2((t.size().x()-t.fullSize().x())/2,0))}if(nr.scrollsVertically(t.scrollDirection())){let n=this.verticalConstraintOfSubtree();n!=null&&(n.value=="MAX"?e.translate2(0,t.size().y()-t.fullSize().y()):n.value=="CENTER"&&e.translate2(0,(t.size().y()-t.fullSize().y())/2))}}hasPerRegionFillPaints(){if(this.type()!="VECTOR"||this.fillGeometry()==null)return!1;let e=this.fillGeometry().styleIDs;return e==null?!1:e.some(t=>t!=0)}forEachRegionWithFillPaintBatch(e){var i;let t,n=this.fillGeometry(),r=(i=this.vectorData())==null?void 0:i.paintOverrides,o=this.fillPaints();if(!(r==null||n==null))for(let a=0;a<n.regions.length;a=a+1){let s=o;if(a<n.styleIDs.length){let l=n.styleIDs[a],u=r.get(l,this.scene());u!=null&&(s=u)}let c=n.regions[a];e(c,s)}}relativeTransformAccountingForFixedOffset(){let e=this.relativeTransform().clone();return this._translateFixedElementIfNecessary(e),e}absoluteTransform(){if(this.isRooted()&&(1&this._flags)!=0){let e=this.relativeTransformAccountingForFixedOffset();if(this._cachedParent!=null){let t=this._cachedParent.absoluteTransform().clone();t.multiply(e),e=t}this._absoluteTransform=e,this._flags&=~1}return this._absoluteTransform}dirtyTransform(){this._addFlagsToSelfAndChildren(1),this._addFlagsToSelfAndChildren(4)}copyNodeCachedTransformAndBounds(e){this._absoluteTransform=e._absoluteTransform,this._cachedCanvasSpaceGeometryBounds=e._cachedCanvasSpaceGeometryBounds,this._cachedCanvasSpaceRenderedBounds=e._cachedCanvasSpaceRenderedBounds,this._cachedCanvasSpaceScrollingBounds=e._cachedCanvasSpaceScrollingBounds}_addFlagsToParents(e){this.parent()!=null&&this.parent()._addFlagsToSelfAndParents(e)}_addFlagsToSelfAndParents(e){for(let t=this;t!=null;t=t.parent())t._flags|=e}_addFlagsToSelfAndChildren(e){this._flags|=e;for(let t of this._cachedChildren)t._addFlagsToSelfAndChildren(e)}isFrameBackgroundVisible(){if(!ln.isFrameLike(this.type()))return!1;let e=this.containerSupportsFillStrokeAndCorners()?this.fillPaints():null;if(e==null)return E.alpha(this.computedBackgroundColor())>0;for(let t=0,n=e.length;t<n;t=t+1)if(e[t].isEnabledAndVisible())return!0;return!1}hasBackgroundBlurs(){if(this.effects().filter(t=>t.type()=="BACKGROUND_BLUR").length>0)return!0;let e=!1;return this.forEachChild(t=>{t.hasBackgroundBlurs()&&(e=!0)}),e}hasNonZeroStrokeWeight(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().getHasNonZeroStrokeWeight(2)}styleId(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().styleId(2)}inheritedStyleId(e){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().inheritedStyleId(e,2)}setInheritStyleId(e,t){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().setInheritStyleId(e,t,2)}setStyleSortPosition(e){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().setStyleSortPosition(e,2)}tableCellRowId(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().tableCellColumnId(2)}tableCellColumnId(){return x._prototypeLib.prepareCppNodeForAccess(this),x._prototypeLib.nodeTsApi().tableCellColumnId(2)}getTableCellAt(e,t){x._prototypeLib.prepareCppNodeForAccess(this);let n=x._prototypeLib.nodeTsApi().getTableCellGuid(2,e,t);return this._scene.findNode1(n)}static _areNodesOrderedCorrectly(e,t){let n=e.parentIndex(),r=t.parentIndex();return sn.compare(n.position,r.position)<0||n.position==r.position&&R.compare(e.id(),t.id())<0}canvasSpaceGeometryBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceGeometryBounds}canvasSpaceRenderedBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceRenderedBounds}canvasSpaceScrollingBounds(){return this._updateBoundsIfNeeded(),this._cachedCanvasSpaceScrollingBounds}canvasSpaceInteractiveBounds(){let e=this.fillOrTextGeometry(),t=this.strokeGeometry(),n=B.new2(),r=this.size();n.setTo1(0,0,r.x(),r.y());let o=new bt;o.include3(n),e!=null&&o.include3(e.bounds),t!=null&&this.strokeAlign()!="INSIDE"&&o.include3(t.bounds);let i=o.build();return i.transformInto1(i,this.absoluteTransform()),i}canvasSpacePreviewBounds(){let e=this.strokeGeometry(),t=B.new2();t.setTo1(0,0,this.fullSize().x(),this.fullSize().y());let n=new bt;n.include3(t),e!=null&&this.strokeAlign()!="INSIDE"&&n.include3(e.bounds);let r=n.build();if(r.transformInto1(r,this.absoluteTransform()),this._scrollingLogic.shouldResizeToFitViewport()){let o=this.parent().prototypeDevice(),i=o.type=="NONE"||o.type=="PRESENTATION"?this.parent().currentViewportSize():o.size(),a=this.findContainingCanvasOrParent();if(o=a.prototypeDevice(),i=o.type=="NONE"||o.type=="PRESENTATION"?a.currentViewportSize():o.size(),!r.size().min2(i).equals(r.size())){let s=B.new4(this.canvasSpaceBoundingBox().topLeft(),i);r.intersectWith(s)}}return r}canvasSpaceBoundingBox(){let e=B.new2(),t=this.size();return e.setTo1(0,0,t.x(),t.y()),e.transformInto1(e,this.absoluteTransform()),e}fullSizeCanvasSpaceBoundingBox(){let e=B.new2();return e.setTo1(0,0,this.fullSize().x(),this.fullSize().y()),e.transformInto1(e,this.absoluteTransform()),e}_updateBoundsIfNeeded(){if(!this.isRooted()||(4&this._flags)==0)return;for(let n of this._cachedChildren)n._updateBoundsIfNeeded();Ke._geometryBuilder.reset(),Ke._renderedBuilder.reset(),Ke._scrollingBuilder.reset(),Ke._effectBuilder.reset();let e=0,t=this.effects();for(let n=0,r=t.length;n<r;n=n+1){let o=t[n];o.isEnabledAndVisible()&&o.type()=="FOREGROUND_BLUR"&&(e+=o.blurRadius())}e>0&&(Ke._effectBuilder.include1(-e,-e),Ke._effectBuilder.include1(e,e));for(let n=0,r=t.length;n<r;n=n+1){let o=t[n];if(o.isEnabledAndVisible()&&o.type()=="DROP_SHADOW"){let i=e+o.blurRadius()+o.spread();Ke._effectBuilder.include1(o.blurOffset().x()-i,o.blurOffset().y()-i),Ke._effectBuilder.include1(o.blurOffset().x()+i,o.blurOffset().y()+i)}}if(ln.isGeometryLeaf(this.type())){let n=this.fillOrTextGeometry(),r=this.strokeGeometry(),o=this.absoluteTransform();n!=null&&Ke._geometryBuilder.include4(n.bounds,o),r!=null&&(this.strokeAlign()!="INSIDE"||n==null||n.regions.length==0||n.bounds.isInvalid())&&Ke._geometryBuilder.include4(r.bounds,o)}else for(let n of this._cachedChildren)n.isInvisibleOrTransparent()||(Ke._geometryBuilder.include3(n._cachedCanvasSpaceGeometryBounds),Ke._renderedBuilder.include3(n._cachedCanvasSpaceRenderedBounds)),n.visible()&&Ke._scrollingBuilder.include3(n._cachedCanvasSpaceScrollingBounds);if(ln.isFrameLike(this.type())){let n=this.canvasSpaceBoundingBox();if(this.clipsToBoundingRectangle()){let r=Ke._geometryBuilder.build(),o=Ke._renderedBuilder.build(),i=Ke._scrollingBuilder.build();r.intersectWith(n),o.intersectWith(n),i.intersectWith(n),Ke._geometryBuilder.reset(),Ke._renderedBuilder.reset(),Ke._scrollingBuilder.reset(),Ke._geometryBuilder.include3(r),Ke._renderedBuilder.include3(o),Ke._scrollingBuilder.include3(i)}if(this.containerSupportsFillStrokeAndCorners()){let r=this.fillOrTextGeometry(),o=this.strokeGeometry(),i=this.absoluteTransform();r!=null&&Ke._geometryBuilder.include4(r.bounds,i),o!=null&&(this.strokeAlign()!="INSIDE"||r==null||r.regions.length==0||r.bounds.isInvalid())&&Ke._geometryBuilder.include4(o.bounds,i)}(this.isFrameBackgroundVisible()||this.parent()!=null&&this.parent().type()=="CANVAS"&&this.clipsToBoundingRectangle())&&(Ke._geometryBuilder.include3(n),Ke._renderedBuilder.include3(n)),Ke._scrollingBuilder.include3(n)}this._cachedCanvasSpaceGeometryBounds=Ke._geometryBuilder.build(),Ke._renderedBuilder.include3(this._cachedCanvasSpaceGeometryBounds),Ke._scrollingBuilder.include3(this._cachedCanvasSpaceGeometryBounds),Ke._effectBuilder.isValidOrZeroArea()&&(Ke._effectBuilder.buildTo(Ke._effectBounds),Ke._renderedBuilder.include3(Ke._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,Ke._effectBounds)),Ke._scrollingBuilder.include3(Ke._applyEffectSpread(this._cachedCanvasSpaceGeometryBounds,Ke._effectBounds))),this._cachedCanvasSpaceRenderedBounds=Ke._renderedBuilder.build(),this._cachedCanvasSpaceScrollingBounds=Ke._scrollingBuilder.build(),this._flags&=~4}_handlePropertyChangeForBounds(e,t){switch(e){case 21:case 19:case 20:case 11:case 50:case 74:case 61:case 25:case 69:case 27:case 47:case 15:case 28:case 64:case 65:case 68:case 45:case 70:case 16:case 46:case 26:case 29:case 85:break;case 63:case 7:{this._addFlagsToParents(4);break}default:{this._addFlagsToParents(4),this._addFlagsToSelfAndChildren(4),e==24&&t!=null&&t._addFlagsToSelfAndParents(4);break}}}static _applyEffectSpread(e,t){if(t!=null){let n=e.clone();return n.translate1(t.centerX(),t.centerY()),n.expand2(t.width()/2,t.height()/2),n}return e}developerFriendlyId(){if(this.type()=="TABLE_CELL"){let n=this.parent();if(n==null)return console.error("Orphaned table cell"),null;let r=[n.id(),this.tableCellRowId(),this.tableCellColumnId()];return"T"+r.map(o=>R.toString(o)).join(";")}if(!this.isInstanceSublayer())return R.toString(this.id());let e=this;for(;e!=null&&!e.isPrimaryInstance();)e=e.parent();return e==null?(console.error("Unable to find primary instance backing node"),null):"I"+this.stablePath().guids.map(n=>R.toString(n)).join(";")}fillOrTextGeometry(){return this.type()=="TEXT"?this.textGeometry():this.fillGeometry()}fillRegionPaints(){return Ke._computeRegionPaintsFromStyles(this.fillOrTextGeometry(),this.fillPaints(),this.scene())}strokeRegionPaints(){return Ke._computeRegionPaintsFromStyles(this.strokeGeometry(),this.strokePaints(),this.scene())}hasMoreThanOneCornerRadius(){let e=this.rectangleTopLeftCornerRadius();return this.rectangleTopRightCornerRadius()!=e||this.rectangleBottomLeftCornerRadius()!=e||this.rectangleBottomRightCornerRadius()!=e}roundedRectInfo(){return this._instantiateRoundedRect()}_instantiateRoundedRect(){if(this.rectangleCornerRadiiIndependent()){let e=[this.rectangleTopLeftCornerRadius(),this.rectangleTopRightCornerRadius(),this.rectangleBottomRightCornerRadius(),this.rectangleBottomLeftCornerRadius()];return new Li(1,ye.FrozenVector_ZERO,this.size(),e,this.cornerSmoothing())}else return new Li(0,ye.FrozenVector_ZERO,this.size(),this.cornerRadius(),this.cornerSmoothing())}fillGeometryForSpread(e,t,n){let r=null;if(this.type()=="ELLIPSE"){let o=new B(0,0,this.size().x(),this.size().y());e.transformRect(o),r=Ko.fromBounds(o)}else{let o=this._instantiateRoundedRect();o.transform(e),o.adjustCornerRadiiForSpread(t),r=Dt.fromRoundedRect(o)}return new Qt(new xt(r,"NONZERO"),n)}strokeGeometryForSpread(e,t,n,r){let o=null,i=this.strokeAlign()=="INSIDE"?2:this.strokeAlign()=="CENTER"?1:0,a=!n.subtract(2*t+i*this.strokeWeight()).isPositive(),s=2-i;if(Re.containsAtLeastOneVisiblePaint(this.fillPaints())||a){let c=ee.new2(),u=n.add(this.strokeWeight()*s).add(2*t).divide1(n),d=-t-this.strokeWeight()*s/2;if(c.translate2(d,d),c.scale3(u),this.type()=="ELLIPSE"){let h=new B(0,0,this.size().x(),this.size().y());c.transformRect(h),o=vt.forEllipse(h)}else{let h=this._instantiateRoundedRect();h.transform(c),o=vt.fromRoundedRectWithSpread(h,t+s*this.strokeWeight()/2)}}else{if(this.strokeWeight()+2*t<=0)return null;if(this.type()=="ELLIPSE"){let c=B.new4(ye.FrozenVector_ZERO,this.size());e.transformRect(c),c.expand1(s*this.strokeWeight()/2),o=vt.forEllipse(c),c.contract(2*t+this.strokeWeight()),o.append(vt.forEllipse(c))}else{let c=this._instantiateRoundedRect();c.transform(e),c.expand(s*this.strokeWeight()/2),o=vt.fromRoundedRectWithSpread(c,t+s*this.strokeWeight()/2),c.contract(2*t+this.strokeWeight()),o.append(vt.fromRoundedRectWithSpread(c,-(2*t+this.strokeWeight())))}}return new Qt(new xt(o,"ODD"),r)}static _computeRegionPaintsFromStyles(e,t,n){if(e!=null){let r=t!=null?t.filter(a=>a.isEnabledAndVisible()):[],o=new Map,i=e.paintOverrides;return r.length==0&&r.push(ne.TRANSPARENT),e.regions.map(a=>{let s=r,c=a.styleID;if(c!=0&&i!=null){let l=Ht.IntMap_get(o,c,null);if(l==null){let u=i.get(c,n);u!=null&&(l=u.filter(d=>d.isEnabledAndVisible()),o.set(c,l))}l!=null&&(s=l)}return s})}return Ke.EMPTY_REGION_PAINTS}isTopLevel(){return this.parent()!=null&&(this.parent().type()=="CANVAS"||this.parent().type()=="SECTION")}isTopLevelFrame(){let e=this.type()=="FRAME";return this.isTopLevel()&&e}topLevelAncestor(){let e=this;for(;e!=null;){if(e.isTopLevel())return e;e=e.parent()}return null}canvas(){var o;let e,t,n=this.type()=="CANVAS"?this:(o=this.topLevelAncestor())==null?void 0:o.parent();return n=((e=this.topLevelAncestor())!=null?e.parent().type():null)=="SECTION"?this.findContainingCanvasOrParent():n,n}isAncestorOf(e){for(let t=e;t!=null;t=t.parent())if(t==this)return!0;return!1}forSelfAndAncestors(e){for(let t=this;t!=null;t=t.parent())e(t)}findContainingStateGroupOrSelf(){for(let e=this;e!=null;e=e.parent())if(e.isStateGroup())return e;return null}findContainingStateOrSelf(){for(let e=this;e!=null;e=e.parent())if(e.parent()!=null&&e.parent().isStateGroup())return e;return null}findContainingScrollingFrameOrSelf(){for(let e=this;e!=null;e=e.parent())if(e.scrollDirection()!="NONE"&&!e.isTooRotatedToScroll())return e;return null}findContainingInstanceOrSelf(){for(let e=this;e!=null;e=e.parent())if(e.type()=="INSTANCE")return e;return null}findAllSectionsInNode(){let e=this,t=[];t.push(e);let n=[];for(;t.length>0;){let r=t.shift();for(let o=0,i=r.childCount();o<i;o=o+1){let a=r.childAt1(o);a!=null&&a.type()=="SECTION"&&(t.push(a),n.push(a))}}return n}findFirstTopLevelFrameInSection(){let e=this,t=[];for(t.push(e);t.length>0;){let n=t.shift();for(let r=0,o=n.childCount();r<o;r=r+1){let i=n.childAt1(r);if(i.isTopLevelFrame())return i;i.type()=="SECTION"&&t.push(i)}}return e}findAllTopLevelNodesInNode(e){let t=[];if(e.type()!="CANVAS"&&e.type()!="SECTION")return t;let n=[];for(n.push(e);n.length>0;){let r=n.shift();for(let o=0,i=r.childCount();o<i;o=o+1){let a=r.childAt1(o);a.type()=="SECTION"&&n.push(a),t.push(a)}}return t}buildAncestors(){let e=[];return this.forSelfAndAncestors(t=>{e.push(t)}),e.reverse(),e}isAboveInLayerOrder(e){let t=this.buildAncestors(),n=e.buildAncestors();for(let r=0,o=Math.min(t.length,n.length);r<o;r=r+1)if(t[r]!=n[r]){let i=t[r],a=n[r];return i.indexInParent()>a.indexInParent()}return t.length==n.length?!1:t.length>n.length}isTooRotatedToScroll(){return Math.abs(this.absoluteTransform().toAngle())>=Pe.Math_PI()/180}debugString(){let e="";return e+=this.hierarchyString()+`

`,this.type()=="INSTANCE"&&(e+=`stablePath: ${this.stablePath()}`+`

`),e+=`{
`,this.each((t,n)=>{e+=`  ${Rt[t]}: ${Z.toString(n)}
`}),e+="}",e+=`

`,e}paintsDebugString(){let e=this.strokePaints().some(t=>t.isEnabledAndVisible())?` strokeAlign=${this.strokeAlign()} weight=${this.strokeWeight()}`:"";return`Node type=${this.type()} size=${this.size()}
 -- fills=[${this.fillPaints().map(t=>t.debugString()).join(", ")}]
 -- strokes=[${this.strokePaints().map(t=>t.debugString()).join(", ")}]`+e}_makeIndent(e,t){let n=2,r="";if(t){for(let o=0,i=n*(e-1);o<i;o=o+1)r+="-";return r+="> ",r}else{for(let o=0,i=n*e;o<i;o=o+1)r+=" ";return r}}hierarchyString(){let e=[],t=this._hierarchyStringForAncestors(e);return t==0&&(e.push("(null parent)"),t=t+1),this._hierarchyStringWithChildren(t,!0,e),e.join(`
`)}_hierarchyStringLocal(e,t){var a,s;let n,r,o,i=this._makeIndent(e,t);return i+=`${this.type()}: '${(a=this.name())!=null?a:"null"}' (${R.toString(this.id())})`,(this.isInstanceSublayer()||this.isPrimaryInstance())&&(i+=` stablePath: ${this.stablePath()}`),this.isInSymbol()&&(i+=` (overrideKey: ${R.toString(this.overrideKey())})`),this.type()=="INSTANCE"&&(i+=` (symbol: ${(s=(r=this.symbolID())!=null?R.toString(r):null)!=null?s:"null"})`),i+=` hasBeenLoaded: ${this.hasBeenLoaded()?"\u2714":"\u25FB\uFE0F"}`,i}_hierarchyStringForAncestors(e){let t=0,n=[];for(this.forSelfAndAncestors(r=>{r!=this&&n.push(r)});n.length>0;)e.push(n.pop()._hierarchyStringLocal(t,!1)),t=t+1;return t}_hierarchyStringWithChildren(e,t,n){n.push(this._hierarchyStringLocal(e,t));for(let r=0,o=this.childCount();r<o;r=r+1)this.childAt1(r)._hierarchyStringWithChildren(e+1,!1,n)}static _forEachNodeHelper(e,t){let n=t(e);switch(n){case Ke.Loop.BREAK:return Ke.Loop.BREAK;case Ke.Loop.CONTINUE:break;case Ke.Loop.SKIP:return Ke.Loop.CONTINUE}for(let r=0,o=e.childCount();r<o;r=r+1)if(e.childAt1(r)!==void 0)switch(n=Ke._forEachNodeHelper(e.childAt1(r),t),n){case Ke.Loop.BREAK:return Ke.Loop.BREAK;case Ke.Loop.CONTINUE:break;case Ke.Loop.SKIP:return Ke.Loop.CONTINUE}return Ke.Loop.CONTINUE}static forEachNode1(e,t){Ke._forEachNodeHelper(e,t)}static forEachNode2(e,t){Ke.forEachNode1(e,n=>(t(n),Ke.Loop.CONTINUE))}static lowestCommonAncestor(e){if(e.length==0)return null;let t=e[0];for(;t!=null;){let n=!0;for(let r of e)if(!t.isAncestorOf(r)){t=t.parent(),n=!1;break}if(n)break}return t}_invalidateRenderTreeForSelf(){this._renderTree=null,this._renderTreeAsBaseScreen=null,this._renderTreeWithoutBackgroundBlurs=null,this._renderTreeForShadowRoot=null,this._renderTreeForShadowDescendant=null,this._renderTreeForKnockoutShadowRoot=null,this._renderTreeForKnockoutShadowDescendant=null}invalidateRenderTreeForSelfAndParents(){for(let e=this;e!=null;e=e.parent())e._invalidateRenderTreeForSelf()}invalidateRenderTreeForChildren(){for(let e=0,t=this.childCount();e<t;e=e+1){let n=this.childAt1(e);n._invalidateRenderTreeForSelf(),n.invalidateRenderTreeForChildren()}}invalidateNestedBackgroundBlurRenderTrees(e,t){var i;let n,r=(i=this._renderTree)==null?void 0:i.value;if(r!=null&&!r.hasBackgroundBlurs())return!1;if(this.transitioningFrom!=null){if(r==null||r.hasBackgroundBlurs()){let a=this.topLevelAncestor();if(a!=null&&e.has(R.toString(a.id())))return this._invalidateRenderTreeForSelf(),!0}return!1}let o=!1;for(let a=0,s=this.childCount();a<s;a=a+1)o=this.childAt2(a,!0).invalidateNestedBackgroundBlurRenderTrees(e,t)||o;if(o)return this._invalidateRenderTreeForSelf(),!0;if(!ln.isGeometryLeaf(this.type())&&!ln.isFrameLike(this.type()))return!1;if(this.effects().length!=0){let a=this.supportsGeometry()?this.canvasSpaceGeometryBounds():this.canvasSpaceBoundingBox();for(let s=0,c=this.effects().length;s<c;s=s+1){let l=this.effects()[s];if(l.isVisibleForRendering()&&l.type()=="BACKGROUND_BLUR"){let u=B.new3(a).expandedBy1(l.blurRadius()),d=!1,h=this.topLevelAncestor();if(h!=null&&e.has(R.toString(h.id()))&&(d=!0),d)return this._invalidateRenderTreeForSelf(),t.push(u),!0}}}return!1}getCachedRenderTree(){return this._renderTree}renderTree1(){return this.renderTree2(new Jt(this))}renderTree2(e){if(e.overlayRenderData()!=null&&e.overlayRenderData().hasTransition()&&e.hasBackgroundBlurs()){let t=new Ne.GenerateArgs(Ne.RenderMode.NORMAL);return Ne.generateRenderTree(e,t)}if(this._renderTree==null){let t=new Ne.GenerateArgs(Ne.RenderMode.NORMAL);this.actingAsOverlayOrSublayerForRendertreeGeneration(()=>{this._renderTree=new fe(Ne.generateRenderTree(e,t))}),(this._renderTree.value==null||!this._renderTree.value.hasBackgroundBlurs())&&(this._renderTreeWithoutBackgroundBlurs=this._renderTree)}return this._renderTree.value}getCachedRenderTreeForBaseScreen(){return this._renderTreeAsBaseScreen}renderTreeForBaseScreen1(){return this.renderTreeForBaseScreen2(new Jt(this))}renderTreeForBaseScreen2(e){if(this._renderTreeAsBaseScreen==null){let t=new Ne.GenerateArgs(Ne.RenderMode.NORMAL);this.actingAsBaseScreenForRendertreeGeneration(()=>{this._renderTreeAsBaseScreen=new fe(Ne.generateRenderTree(e,t))})}return this._renderTreeAsBaseScreen.value}renderTreeWithoutBackgroundBlurs(){if(this._renderTreeWithoutBackgroundBlurs==null){let e=new Jt(this),t=new Ne.GenerateArgs(Ne.RenderMode.WITHOUT_BACKGROUND_BLURS);this._renderTreeWithoutBackgroundBlurs=new fe(Ne.generateRenderTree(e,t))}return this._renderTreeWithoutBackgroundBlurs.value}renderTreeForShadowRoot1(){return this.renderTreeForShadowRoot2(new Jt(this))}renderTreeForShadowRoot2(e){if(this._renderTreeForShadowRoot==null){let t=new Ne.GenerateArgs(Ne.RenderMode.SHADOW,e.uniqueIdentifier());this._renderTreeForShadowRoot=new fe(Ne.generateRenderTree(e,t))}return this._renderTreeForShadowRoot.value}renderTreeForShadowDescendant1(){return this.renderTreeForShadowDescendant2(new Jt(this))}renderTreeForShadowDescendant2(e){if(this._renderTreeForShadowDescendant==null){let t=new Ne.GenerateArgs(Ne.RenderMode.SHADOW);this._renderTreeForShadowDescendant=new fe(Ne.generateRenderTree(e,t))}return this._renderTreeForShadowDescendant.value}renderTreeForKnockoutShadowRoot1(){return this.renderTreeForKnockoutShadowRoot2(new Jt(this))}renderTreeForKnockoutShadowRoot2(e){if(this._renderTreeForKnockoutShadowRoot==null){let t=new Ne.GenerateArgs(Ne.RenderMode.KNOCKOUT_SHADOW,e.uniqueIdentifier());this._renderTreeForKnockoutShadowRoot=new fe(Ne.generateRenderTree(e,t))}return this._renderTreeForKnockoutShadowRoot.value}renderTreeForKnockoutShadowDescendant1(){return this.renderTreeForKnockoutShadowDescendant2(new Jt(this))}renderTreeForKnockoutShadowDescendant2(e){if(this._renderTreeForKnockoutShadowDescendant==null){let t=new Ne.GenerateArgs(Ne.RenderMode.KNOCKOUT_SHADOW);this._renderTreeForKnockoutShadowDescendant=new fe(Ne.generateRenderTree(e,t))}return this._renderTreeForKnockoutShadowDescendant.value}renderTreeForOverlay(e){let t=!1;e.overlayRenderData()!=null&&this._overlayCacheKey!=e.overlayRenderData().overlayCacheKey()&&(this._invalidateRenderTreeForSelf(),t=!0);let n=this.renderTree2(e);return t&&(this._overlayCacheKey=e.overlayRenderData().overlayCacheKey()),n}_handlePropertyChangeForRenderTree(e,t){switch(e){case 23:case 77:{this.invalidateRenderTreeForSelfAndParents(),this.invalidateRenderTreeForChildren();break}case 24:{this.invalidateRenderTreeForSelfAndParents(),t!=null&&t.invalidateRenderTreeForSelfAndParents();break}case 87:case 65:{let n=this.findAllTopLevelNodesInNode(this);for(let r=0,o=n.length;r<o;r=r+1){let i=n[r];i!=null&&i.invalidateRenderTreeForSelfAndParents()}break}case 63:case 8:case 37:case 21:case 58:case 3:case 12:case 9:case 10:case 36:case 13:case 80:case 34:case 33:case 48:case 22:case 73:case 59:case 1:case 2:case 4:case 75:case 18:case 7:case 60:case 51:case 52:case 54:case 55:case 89:case 90:case 91:case 92:case 62:case 72:case 74:case 43:case 38:case 39:case 40:case 41:case 14:case 44:case 61:{this.invalidateRenderTreeForSelfAndParents();break}}}},Se=Ke;Se.schema=null,Se._geometryBuilder=new bt,Se._renderedBuilder=new bt,Se._scrollingBuilder=new bt,Se._effectBuilder=new bt,Se._effectBounds=B.new2(),Se.EMPTY_REGION_PAINTS=[];(t=>{let g;(i=>(i[i.CONTINUE=0]="CONTINUE",i[i.BREAK=1]="BREAK",i[i.SKIP=2]="SKIP"))(g=t.Loop||(t.Loop={}));let e;(r=>{function n(o){return t.Loop[o]}r.Loop_toString=n})(e=t.in_Loop||(t.in_Loop={}))})(Se||(Se={}));var Au=class{setSerialization(e){this._serialization=e}decodeFillPaintData(e){if(e.length==0)return Re.EMPTY;let t=Se.schema.decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let n=null;try{let r=t.nodeChanges[0],o=r.fillPaints!=null?r.fillPaints:r.strokePaints;n=this._serialization.decodePaints(o,t.blobs)}catch(r){ze("Caught error during fill paints marshaling. Rendered output may be incorrect"),La(r),n=Re.EMPTY}return n}decodeSingleSolidFillWithNormalBlendMode(e,t,n){if(e.alpha!=1)throw new Error("Alpha from C++ is always expected to be 1");let r=new ne("SOLID");return r.setColor(E.new3(e.red,e.green,e.blue,e.alpha)),r.setOpacity(t),r.setIsEnabled(n),[r].slice()}decodeEffectData(e){let t=Se.schema.decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return pt.decodeEffects(t.nodeChanges[0].effects)}decodePrototypeInteractions(e){let t=Se.schema.decodeNodeChange(e);if(t==null)throw new Error("Got bad node change from C++");return pt.decodePrototypeInteractions(t.prototypeInteractions)}decodeVectorData(e){let t=Se.schema.decodeMessage(e);if(t.nodeChanges===void 0||t.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");return this._serialization.decodeVectorData(t.nodeChanges[0].vectorData,t.blobs)}decodeTextData(e,t,n){let r=Se.schema.decodeMessage(e);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Got bad node changes from C++");let o=this._serialization.decodeTextData(r.nodeChanges[0].textData,r.blobs),i=[];for(let a of n)i.push(this._serialization.decodeEmojiImage(a));return new Hr(o.styleOverrideTable(),t?1:0,o.hyperlinkBoxes(),o.characters(),o.lines(),o.characterStyleIds(),n,i)}constructor(){this._serialization=null}},$i=Au;$i.instance=new Au;var ho=(t=>(t[t.INTERACTIVE_COMPONENTS_ENABLED=0]="INTERACTIVE_COMPONENTS_ENABLED",t[t.INTERACTIVE_COMPONENTS_DISABLED=1]="INTERACTIVE_COMPONENTS_DISABLED",t))(ho||{}),gg=class{constructor(e,t){this.clone=e,this.source=t}},_g=class{constructor(e,t){this.transitionRootStablePath=e,this.cloneOps=t}},bo=class{constructor(e,t){this._appState=null,this._modules=null,this._cachedViewNode=null,this._modules=e,this._appState=t}modules(){return this._modules}nodeTsApi(){var t;let e;return(t=this._modules)==null?void 0:t.nodeTsApi}nodeTsApiGenerated(){var t;let e;return(t=this._modules)==null?void 0:t.nodeTsApiGenerated}sceneGraphTsApi(){var t;let e;return(t=this._modules)==null?void 0:t.sceneGraphTsApi}_prototype(){var t;let e;return(t=this._modules)==null?void 0:t.prototype}fonts(){var t;let e;return(t=this._modules)==null?void 0:t.fonts}dumpFileForTests(){return this._prototype().dumpFile()}getNodeChangesForSwap(e,t,n){let r=this._prototype().getNodeChangesForSwap(e.guids,t,n),o=this._appState.scene(),i=r.clones.map(a=>{let s=o.findNode1(a.clone),c=o.findNode1(a.source);return new gg(s,c)});return new _g(new wt(r.transitionRootStablePath),i)}runSetVariable(e,t,n,r){this._prototype().runSetVariable(e,t,n,r)}getFirstTruthyConditionalIndex(e,t){return this._prototype().getFirstTruthyConditionalIndex(e,t)}getICActionsForSetVariableAction(e,t,n,r,o){return this._prototype().getICActionsForSetVariableAction(e,t,n,r,o)}shouldDisallowSwap(e,t){return this._prototype().shouldDisallowSwap(e.guids,t)}applyExistingVariableChangesToIFLLoadedNodes(){this._prototype().applyExistingVariableChangesToIFLLoadedNodes()}prepareCppNodeForAccess(e){e!=this._cachedViewNode&&(this.nodeTsApi().setGlobalUnstableNodeByHandle(e.handle()),this._cachedViewNode=e)}createSceneAndSetActive(e,t){er.instance.interactiveComponentsStatusForNewScene=t;let n=this._prototype().createSceneWithDangerousLoadingFlag(e);this._prototype().setActiveScene(n);let r=er.instance.findScene(n);if(r==null)throw new Error("Failed to create scene in C++");return this._setSceneAsActiveIfNeeded(r),r}destroyScene(e){this._prototype().destroyScene(e.handle())}markSceneLoaded(e){this._prototype().markSceneLoaded(e.handle())}resetLocalChanges(){this._prototype().resetLocalChanges()}resetLocalInstanceChanges(e){this._prototype().resetLocalInstanceChanges(e)}resetLocalNestedInstanceChanges(e){this._prototype().resetLocalNestedInstanceChanges(e)}nodeHasLocalSymbolChanges(e){return this._prototype().nodeHasLocalSymbolChanges(e)}getNumStateTransitions(e){return this._prototype().getNumStateTransitions(e)}_setSceneAsActiveIfNeeded(e){this._prototype().getActiveScene()!=e.handle()&&this._prototype().setActiveScene(e.handle())}applyNodeChanges(e){this._prototype().applyNodeChanges(e,Si)}reset(){this._prototype()!=null&&this._prototype().reset()}findNode(e,t){return this._setSceneAsActiveIfNeeded(e),this._prototype().findNodeByStablePath(t.guids)}idlRegionsToGeometry(e,t){if(e===null||e==null)return null;let n=[],r=[];bt.INSTANCE.reset();for(let i of e){let a=new to(i.path),s=new Hn(i.windingRule==1?"ODD":"NONZERO",i.styleID,a,a.bounds());n.push(s),r.push(i.styleID),bt.INSTANCE.include3(s.bounds())}let o=t!=null?t:new ao(new Yn(new Map));return new Dn(n,r,bt.INSTANCE.build(),o)}idlRegionsToTextGeometry(e,t){if(e==null)return null;let n=[],r=[],o=[];bt.INSTANCE.reset();for(let a of e){let s=new to(a.path),c=new Hn(a.windingRule==1?"ODD":"NONZERO",a.styleID,s,s.bounds());n.push(c),r.push(a.styleID),o.push(a.emojiCodePoints),bt.INSTANCE.include3(c.bounds())}let i=t!=null?t:new ao(new Yn(new Map));return new cu(n,r,bt.INSTANCE.build(),i,o)}getAffineTransform(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getAffineTransform(t),new ee(St.retAffineTransform_m00,St.retAffineTransform_m01,St.retAffineTransform_m02,St.retAffineTransform_m10,St.retAffineTransform_m11,St.retAffineTransform_m12)}getAffineTransform_SGEO(e){return this._prototype().getAffineTransform_SGEO(e),new ee(St.retAffineTransform_m00,St.retAffineTransform_m01,St.retAffineTransform_m02,St.retAffineTransform_m10,St.retAffineTransform_m11,St.retAffineTransform_m12)}getArcData(e,t){this.prepareCppNodeForAccess(e),this._prototype().getArcData(t);let n={};return n.startingAngle=St.retArcData_startAngle,n.endingAngle=St.retArcData_endAngle,n.innerRadius=St.retArcData_innerRadius,n}getArcData_SGEO(e){this._prototype().getArcData_SGEO(e);let t={};return t.startingAngle=St.retArcData_startAngle,t.endingAngle=St.retArcData_endAngle,t.innerRadius=St.retArcData_innerRadius,t}getBool(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getBool(t)}getBool_SGEO(e){return this._prototype().getBool_SGEO(e)}getDouble(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getDouble(t)}getDouble_SGEO(e){return this._prototype().getDouble_SGEO(e)}getEffectList(e){this.prepareCppNodeForAccess(e);let t=this._prototype().getEffectList();return jr.WeakHandle_isValid(t)?this._modules.effectData_Internal.getOrCreateSkewCopy(t):[]}getEffectList_SGEO(e){let t=this._prototype().getEffectList_SGEO(e);return jr.WeakHandle_isValid(t)?this._modules.effectData_Internal.getOrCreateSkewCopy(t):[]}getGUID(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getGUID(t),R._new(St.retGUID_sessionId,St.retGUID_localId)}getGUID_SGEO(e){return this._prototype().getGUID_SGEO(e),R._new(St.retGUID_sessionId,St.retGUID_localId)}getStyleId(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getStyleId(t),{guid:St.retStyleId.guid,ref:St.retStyleId.ref}}getStyleId_SGEO(e){return this._prototype().getStyleId_SGEO(e),{guid:St.retStyleId.guid,ref:St.retStyleId.ref}}getInt(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getInt(t)}getInt_SGEO(e,t){return this._prototype().getInt_SGEO(e,t)}getPaintList(e,t){this.prepareCppNodeForAccess(e);let n=this._prototype().getPaintList(t);return jr.WeakHandle_isValid(n)?this._modules.paintData_Internal.getOrCreateSkewCopy(n):[]}getPaintList_SGEO(e){let t=this._prototype().getPaintList_SGEO(e);return jr.WeakHandle_isValid(t)?this._modules.paintData_Internal.getOrCreateSkewCopy(t):[]}getField(e,t){this.prepareCppNodeForAccess(e);let n=this._prototype().getField(t);if(n.length==0)return null;let r=Se.schema.decodeMessage(n);if(r.nodeChanges===void 0||r.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField");let o=r.nodeChanges[0],i=[],a=null;return this._appState.serialization().decodeNodeChange(o,i,(s,c)=>{a=c}),a}getField_SGEO(e){let t=this._prototype().getField_SGEO(e);if(t.length==0)return null;let n=Se.schema.decodeMessage(t);if(n.nodeChanges===void 0||n.nodeChanges.length!=1)throw new Error("Bad NODE_CHANGES from getField_SGEO");let r=n.nodeChanges[0],o=[],i=null;return this._appState.serialization().decodeNodeChange(r,o,(a,s)=>{i=s}),i}getParentIndex(e){this.prepareCppNodeForAccess(e);let t=this._prototype().getParentIndex();return kn.fromString(t)}getParentIndex_SGEO(e){return kn.fromString(this._prototype().getParentIndex_SGEO(e))}getPrototypeInteractions_SGEO(e){let t=this._prototype().getPrototypeInteractions_SGEO(e);return jr.WeakHandle_isValid(t)?this._modules.prototypeInteractions_Internal.getOrCreateSkewCopy(t):[]}getString(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getString(t)}getString_SGEO(e){return this._prototype().getString_SGEO(e)}getVector(e,t){return this.prepareCppNodeForAccess(e),this._prototype().getVector(t),new I(St.retVector_x,St.retVector_y)}getVector_SGEO(e){return this._prototype().getVector_SGEO(e),new I(St.retVector_x,St.retVector_y)}getOverridePath(e){return this.prepareCppNodeForAccess(e),new wt(this._prototype().overridePath())}getStablePath(e){return this.prepareCppNodeForAccess(e),new wt(this._prototype().stablePath())}getHas(e,t){return this.prepareCppNodeForAccess(e),this._prototype().has(t)}forEachField(e,t){this.prepareCppNodeForAccess(e),St.forEachFieldCallback=t,this._prototype().forEachField(),St.forEachFieldCallback=null}applyLocalNodeChangesForTests(e){if(!bo.isTestingEnv())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().applyLocalNodeChangesForTests(e)}clearDirtyTextLayoutForTests(e){if(!bo.isTestingEnv())throw new Error("Should not be calling flushLayoutForTests outside of tests");this._prototype().clearDirtyTextLayoutForTests(e.handle())}updateSymbolInstancesForTests(){if(!bo.isTestingEnv())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().updateSymbolInstancesForTests()}updateStylesForTests(){if(!bo.isTestingEnv())throw new Error("Should not be calling applyLocalNodeChangesForTests outside of tests");this._prototype().updateStylesForTests()}static instance(){return bo._prototypeLib}static destroy(){bo._prototypeLib!=null&&bo._prototypeLib.reset(),bo._prototypeLib=null}static initialize(e,t){if(bo._prototypeLib!=null){ze("Attempt to initialize PrototypeLib, but PrototypeLib is already initialized");return}bo._prototypeLib=new bo(e,t),$i.instance.setSerialization(t.serialization()),di&&e.interactionTestHelpers.setIsRunningViewerRenderServer()}static isTestingEnv(){return Rr||di}},x=bo;x._prototypeLib=null;var Ec=class{isReady(){return this._isReady}createScene(e){return new yt(e,Ec.instance.interactiveComponentsStatusForNewScene)}setViewer(e){this._viewer=e}getViewer(){return this._viewer}handleUncompressedMessage(e,t){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.handleUncompressedMessage(e,t)}handleUncompressedSchema(e){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");return this._multiplayer.handleUncompressedSchema(e)}didReceiveNodeChanges(e,t){if(this._multiplayer==null)throw new Error("Multiplayer hasn't been set");this._multiplayer.didReceiveNodeChanges(e,t)}setSerialization(e){this._serialization=e}setMultiplayer(e){this._multiplayer=e}findScene(e){return x._prototypeLib.modules().prototype.getScene(e)}findNode(e){return Ht.IntMap_get(this._nodes,e,null)}setReverseVariantBindingsForICsDisabled(e){let t=this._reverseVariantBindingsForICsDisabled;return this._reverseVariantBindingsForICsDisabled=e,t}reverseVariantBindingsForICsDisabled(){return this._reverseVariantBindingsForICsDisabled}ready(){this._isReady=!0}track(e,t){Je.trackEventJSON1(e,t)}triggerViewerEvent(e,t){this._viewer!==null&&this._viewer.trigger(e,t)}Node_created(e,t,n,r){if(t!=null){let o=new Se(e,t,R._new(n,r));this._nodes.set(e,o),t.dangerouslyRegisterNode(o)}else throw new Error("Cannot create node with null scene")}Node_destroyed(e){let t=this.findNode(e);if(t!=null){let n=t.scene();n!=null&&n.dangerouslyUnregisterNode(t.id()),this._nodes.delete(e)}}triggerSceneGraphEvent(e,t,n){let r=this.findNode(e);if(r==null)return;let o=r.scene();if(o!=null){let i=t,a=r.id(),s=hg(x._prototypeLib,o,a,i,n),c=null,l=!1;i==94?Z.asStringEnum(s,"CREATED")=="CREATED"?(c=Z.new8("REMOVED"),l=!0):c=Z.new8("CREATED"):c=Ac(x._prototypeLib,r,i),o.broadcastPropertyChange(new eu(r,i,s,c)),l&&o.dangerouslyUnregisterNode(a)}}updateNodeAfterPropertyChange(e,t){let n=this.findNode(e);n!=null&&n.updateAfterPropertyChange(t)}linkNodeToParent(e,t,n){let r=this.findNode(e);r!=null&&r.linkToParent(this.findNode(t),n)}unlinkNodeFromParent(e){let t=this.findNode(e);t!=null&&t.unlinkFromParent()}debugPrototypeActionFromPreview(e){top.postMessage({debugPrototypeActionFromPreview:e},window.origin)}retAffineTransform(e,t,n,r,o,i){St.retAffineTransform_m00=e,St.retAffineTransform_m01=t,St.retAffineTransform_m02=n,St.retAffineTransform_m10=r,St.retAffineTransform_m11=o,St.retAffineTransform_m12=i}retArcData(e,t,n){St.retArcData_startAngle=e,St.retArcData_endAngle=t,St.retArcData_innerRadius=n}retGUID(e,t){St.retGUID_sessionId=e,St.retGUID_localId=t}retStyleId(e){St.retStyleId=e}retVector(e,t){St.retVector_x=e,St.retVector_y=t}forEachFieldCallback(e){St.forEachFieldCallback!=null&&St.forEachFieldCallback(e)}constructor(){this._viewer=null,this._isReady=!1,this._serialization=new pt(null),this._multiplayer=null,this.interactiveComponentsStatusForNewScene=1,this._nodes=new Map,this._reverseVariantBindingsForICsDisabled=!1}},er=Ec;er.instance=new Ec;var St;(f=>(f.retAffineTransform_m00=0,f.retAffineTransform_m01=0,f.retAffineTransform_m02=0,f.retAffineTransform_m10=0,f.retAffineTransform_m11=0,f.retAffineTransform_m12=0,f.retArcData_startAngle=0,f.retArcData_endAngle=0,f.retArcData_innerRadius=0,f.retGUID_sessionId=0,f.retGUID_localId=0,f.retStyleId=null,f.retVector_x=0,f.retVector_y=0,f.forEachFieldCallback=null))(St||(St={}));var mg;(e=>{function g(t){return ho[t]}e.InteractiveComponentsEnabled_toString=g})(mg||(mg={}));var pi=null;var Q;(Ie=>{function g(){return(tt.OS_isMobile(tt.OS_current())||tt.OS_current()==4&&navigator.maxTouchPoints>0||At.forceMobileOptimizations())&&T().respectRenderBudgetOnScroll}Ie.respectRenderBudgetOnScroll=g;function e(){return T().backgroundBlurOpts}Ie.useBackgroundBlurOpts=e;function t(){return T().flushAfterClear}Ie.shouldFlushAfterClear=t;function n(){return T().flushAfterStencilCover}Ie.shouldFlushAfterStencilCover=n;function r(){return T().flushAfterRenderGeometryDirectly}Ie.shouldFlushAfterRenderGeometryDirectly=r;function o(){return T().flushAfterDraws}Ie.shouldFlushAfterDraws=o;function i(){return tt.OS_isMobile(tt.OS_current())||tt.OS_current()==4&&navigator.maxTouchPoints>0||At.forceMobileOptimizations()}Ie.shouldPreventVolatileCaching=i;function a(){return window.devicePixelRatio>3}Ie.isHighDPR=a;function s(){return T().internalDebugTools}Ie.internalDebugTools=s;function c(){return!a()}Ie.useSSAA=c;function l(){return Ie._bowser!=null&&Ie._bowser.mac==!0}Ie.mac=l;function u(){return Ie._bowser!=null&&Ie._bowser.windows==!0}Ie.windows=u;function d(){return Ie._bowser!=null&&Ie._bowser.ios==!0}Ie.ios=d;function h(){return Ie._bowser!=null&&Ie._bowser.android==!0}Ie.android=h;function S(){return Ie._bowser!=null&&Ie._bowser.linux==!0}Ie.linux=S;function f(){return Ie._bowser!=null&&Ie._bowser.chrome==!0}Ie.chrome=f;function y(){return Ie._bowser!=null&&Ie._bowser.safari==!0}Ie.safari=y;function v(){return Ie._bowser!=null&&Ie._bowser.firefox==!0}Ie.firefox=v;function b(){return Ie._bowser!=null&&Ie._bowser.msedge==!0}Ie.edge=b;function m(){return Ie._bowser!=null&&Ie._bowser.msie==!0}Ie.msie=m;function p(gt){return Ie._bowser.version===null||Ie._bowser.version===void 0?!1:Ie._bowser.compareVersions([Ie._bowser.version,gt])>=0}Ie.isBrowserVersionAtLeast=p;function _(gt){return Ie._bowser.osversion===null||Ie._bowser.osversion===void 0?!1:Ie._bowser.compareVersions([Ie._bowser.osversion,gt])>=0}Ie.isOSVersionAtLeast=_;function T(){return Ie._featureFlags}Ie.getFeatureFlags=T;function N(gt){var qe,on;let Lt,Ve;Ie._featureFlags=nt.create(gt),Rr?pi.featureFlagsCppApi.updateFeatureFlags(gt):((on=(qe=x._prototypeLib)==null?void 0:qe.modules())==null?void 0:on.featureFlagsCppApi)!=null&&x._prototypeLib.modules().featureFlagsCppApi.updateFeatureFlags(gt)}Ie.setFeatureFlags=N;function k(gt){var Ve;let Lt=Object.assign({},(Ve=Ie._featureFlags)==null?void 0:Ve.originalObject);N(Object.assign(Lt,gt))}Ie.updateFeatureFlags=k;function j(){return Ie._viewerMode}Ie.getViewerMode=j;function te(gt){Ie._viewerMode=gt}Ie.setViewerMode=te;function Y(){return Ie._scrollToPan}Ie.getScrollToPan=Y;function _e(gt){Ie._scrollToPan=gt}Ie.setScrollToPan=_e;function ce(){return Ie._dragToPan}Ie.getDragToPan=ce;function V(gt){Ie._dragToPan=gt}Ie.setDragToPan=V;function H(){return Ie._disablePrototypeDeviceFrames}Ie.disablePrototypeDeviceFrames1=H;function M(gt){Ie._disablePrototypeDeviceFrames=gt}Ie.disablePrototypeDeviceFrames2=M;function K(){return Ie._gameControllerListener}Ie.gameControllerListener=K;function U(){return Ie._isInlinePreview}Ie.isInlinePreview=U;function P(gt){Ie.protoUseFrameEvictionForUnitTests=gt}Ie.setProtoUseFrameEvictionForUnitTests=P;function J(){return 2==0?Ie.protoUseFrameEvictionForUnitTests:tt.OS_isMobile(tt.OS_current())||tt.OS_current()==4&&navigator.maxTouchPoints>0||At.forceMobileOptimizations()}Ie.protoUseFrameEviction=J;function z(){return!J()&&T().prototypeIflPreloadMore}Ie.protoPreloadMore=z;function O(gt){let Lt=on=>{if(!(on in gt))throw new Error(`Missing required parameter '${on}'`);return gt[on]},Ve=(on,Xt)=>on in gt?gt[on]:Xt,qe=Lt("featureFlags");N(qe),Ie._viewerMode=It.ViewerMode_create(Lt("viewerMode")),Je.initialize(Ve("trackAnalyticsEvent",null),Ve("definedAnalyticsHandler",null),Ve("appTimerStart",null),Ve("appTimerStop",null),Ve("loadTimeTracker",null),Ve("socketConnectionTracker",null)),Ie._bowser=Lt("bowser"),Ie._scrollToPan=Ve("scrollToPan",Ie._scrollToPanDefault),Ie._disablePrototypeDeviceFrames=Ve("disablePrototypeDeviceFrames",Ie._disablePrototypeDeviceFramesDefault),Ie._gameControllerListener=Ve("gameControllerListener",null),Ie._isInlinePreview=Ve("isInlinePreview",!1)}Ie.initialize=O;function G(){return!Ie._disablePrototypeDeviceFrames&&Ie._viewerMode==ot.PROTOTYPE}Ie.deviceFramesSupported=G;function L(gt){Ie.prototypeBackgroundColorOverride=gt}Ie.setPrototypeBackgroundColorOverride=L;function $(){if(Ie._htmlImageDecodeMethodIsPresent==null){let gt=Br.HTMLDocument_createElementImage(document),Lt=gt.decode!==null&&gt.decode!==void 0;Ie._htmlImageDecodeMethodIsPresent=new fe(Lt)}return Ie._htmlImageDecodeMethodIsPresent.value}Ie.htmlImageDecodeMethodIsPresent=$;function se(){return tt.OS_isMobile(tt.OS_current())||tt.OS_current()==4&&navigator.maxTouchPoints>0||At.forceMobileOptimizations()}Ie.shouldApplyMobileOptimizations=se;class nt{static create(Lt){let Ve=on=>Lt===null?!1:!!Lt[on],qe=new nt;return qe.viewerWebGLClearWorkaround=Ve("viewer_webgl_clear_workaround"),qe.swipePresentation=Ve("swipe_presentation"),qe.flushBeforeMasks=Ve("flush_before_masks"),qe.animatedGIFs=Ve("animated_gifs"),qe.removePreviewStencil=Ve("viewer_remove_preview_stencil"),qe.mergeInteractiveBounds=Ve("viewer_merge_interactive_bounds"),qe.internalDebugTools=Ve("internal_only_debug_tools"),qe.viewerServerDownsample1024=Ve("viewer_server_downsample_1024"),qe.prototypeVideosV2=Ve("prototype_videos_v2"),qe.prototypeLogVideoAndICSwap=Ve("prototype_log_video_and_ic_swap"),qe.ssaa3x3MobileProto=Ve("viewer_ssaa_3x3_on_mobile"),qe.respectRenderBudgetOnScroll=Ve("viewer_respect_budget_on_scroll"),qe.fontIndex220528=Ve("font_index_220528"),qe.fontIndexEmoji=Ve("font_index_emoji"),qe.fontIndexEmojiLowRes=Ve("font_index_emoji_low_res"),qe.backgroundBlurOpts=Ve("viewer_background_blur_opts"),qe.flushAfterClear=Ve("viewer_flush_after_clear"),qe.flushAfterStencilCover=Ve("viewer_flush_after_stencil_cover"),qe.flushAfterRenderGeometryDirectly=Ve("flush_after_render_geometry_dir"),qe.flushAfterDraws=Ve("flush_after_draws"),qe.variables=Ve("variables"),qe.prototypeTemporaryStickyScroll=Ve("prototype_temporary_stickyscroll"),qe.logAllWebsocket=Ve("prototype_log_all_ws"),qe.prototypeAlwaysShowFramenum=Ve("prototype_always_show_framenum"),qe.prototypeSectionsIncFrameLoading=Ve("prototype_sections_inc_loading"),qe.prototypeIflPreloadMore=Ve("prototype_ifl_preload_more"),qe.overlayBackgroundBlurs=Ve("viewer_overlay_background_blurs"),qe.omitDropShadowsOnTLFs=Ve("omit_drop_shadows_on_tlfs"),qe.prototypeStateManagement=Ve("prototype_state_management"),qe.prototypeIflDelaySceneLoad=Ve("prototype_ifl_delay_scene_load"),qe.videoOnIOSStaging=Ve("video_on_ios_staging"),qe.prototypeAllowInvisibleSource=Ve("prototype_allow_invisible_source"),qe.prototypeCombineTlfLogic=Ve("prototype_combine_tlf_logic"),qe.logNullDevirtualization=Ve("viewer_log_null_devirtualization"),qe.prototypeNewMouseEvents=Ve("prototype_new_mouse_events"),qe.prototypeTransparentWebMVideo=Ve("prototype_transparent_webm_video"),qe.originalObject=Lt,qe}constructor(){this.viewerWebGLClearWorkaround=!1,this.swipePresentation=!1,this.flushBeforeMasks=!1,this.animatedGIFs=!1,this.removePreviewStencil=!1,this.originalObject=null,this.mergeInteractiveBounds=!1,this.internalDebugTools=!1,this.canvasLoadGrowOnly=!1,this.viewerServerDownsample1024=!1,this.prototypeAlwaysShowFramenum=!1,this.prototypeVideosV2=!1,this.prototypeLogVideoAndICSwap=!1,this.prototypeLogVideoPlay=!1,this.ssaa3x3MobileProto=!1,this.respectRenderBudgetOnScroll=!1,this.fontIndex220528=!1,this.fontIndexEmoji=!1,this.fontIndexEmojiLowRes=!1,this.backgroundBlurOpts=!1,this.flushAfterClear=!1,this.flushAfterStencilCover=!1,this.flushAfterRenderGeometryDirectly=!1,this.flushAfterDraws=!1,this.variables=!1,this.prototypeTemporaryStickyScroll=!1,this.logAllWebsocket=!1,this.multipleActions=!1,this.prototypeSectionsIncFrameLoading=!1,this.prototypeStateManagement=!1,this.prototypeIflPreloadMore=!1,this.overlayBackgroundBlurs=!1,this.omitDropShadowsOnTLFs=!1,this.prototypeIflDelaySceneLoad=!1,this.videoOnIOSStaging=!1,this.prototypeAllowInvisibleSource=!1,this.prototypeCombineTlfLogic=!1,this.logNullDevirtualization=!1,this.prototypeNewMouseEvents=!1,this.prototypeTransparentWebMVideo=!1}}Ie.FeatureFlags=nt;let ot;(Ve=>(Ve[Ve.MIRROR=0]="MIRROR",Ve[Ve.PROTOTYPE=1]="PROTOTYPE"))(ot=Ie.ViewerMode||(Ie.ViewerMode={}));let It;(Ve=>{function gt(qe){if(typeof qe=="string")switch(Vr(qe)){case"MIRROR":return 0;case"PROTOTYPE":return 1}throw new Error(`Invalid viewer mode: ${qe}`)}Ve.ViewerMode_create=gt;function Lt(qe){return ot[qe]}Ve.ViewerMode_toString=Lt})(It=Ie.in_ViewerMode||(Ie.in_ViewerMode={})),Ie._bowser=null,Ie._featureFlags=new nt,Ie._viewerMode=1,Ie._scrollToPanDefault=!0,Ie._scrollToPan=Ie._scrollToPanDefault,Ie._dragToPanDefault=!0,Ie._dragToPan=Ie._dragToPanDefault,Ie._disablePrototypeDeviceFramesDefault=!1,Ie._disablePrototypeDeviceFrames=Ie._disablePrototypeDeviceFramesDefault,Ie._gameControllerListener=null,Ie._isInlinePreview=!1,Ie.protoUseFrameEvictionForUnitTests=!1,Ie.prototypeBackgroundColorOverride=null,Ie._htmlImageDecodeMethodIsPresent=null,Ie.forceInitiateStateChangeForTests=!1})(Q||(Q={}));var Eu=class{constructor(e,t,n,r){this._appState=null,this._canvasView=null,this._emitter=null,this._session=null,this._userSyncing=null,this._isFirst=!1,this._appState=e,this._canvasView=t,this._emitter=n,this._session=r,this._userSyncing=null,this._isFirst=!0,this._session.addObserver(this),this._appState.addFrameObserver(this)}reset(){this._isFirst=!0}userInfoJSON(){if(this._userSyncing==null)return null;let e=[],t=this._userSyncing.userBySessionID(),n=this._session.sessionID();t.has(n)&&e.push(t.get(n).toJSON());for(let o of Array.from(this._userSyncing.userBySessionID().values()))o.sessionID!=n&&e.push(o.toJSON());let r=0;if(this._session.presenterSessionID()!=null&&this._session.presenterSessionID().value==n)for(let o of Array.from(this._userSyncing.userBySessionID().values()))o.sessionID!=n&&o.observedSessions.indexOf(n)!=-1&&(r=r+1);return{deviceNameFilter:this._session.role(),sessionID:n,allUsers:e,followerCount:r,presenterSessionID:this._session.presenterSessionID()!=null?this._session.presenterSessionID().value:null,sessionNominatedByCurrentUser:this._session.sessionNominatedByCurrentUser()!=null?this._session.sessionNominatedByCurrentUser().value:null,sessionsNominatingCurrentUser:this._session.sessionsNominatingCurrentUser()}}setPreviewToObservedFrameOrOverlay(e){var s;let t=this._appState.prototypeState(),n=this._appState.prototypeStructure(),r=this._session.observedUser();if(r==null)return;this.applyInstanceStateSwaps(e);let o=(s=r.triggeredOverlaysData)!=null?s:[],i=r.currentFrame;if(i!=null&&!R.equals(this._appState.baseScreenId(),i)){let c=null,l=null;o.length==0&&(c=r.lastTriggeredHotspot,l=r.lastTriggeredPrototypeInteractionID);let u=null;if(c!=null&&l!=null)u=n.findPrototypeInteractionWithId(R.toString(c),R.toString(l));else if(c!=null){let d=this._appState.getActiveCanvas().scene().findNode1(c),h=Ft.cleanedInteractionsForNode(this._appState,d);h.length!=0&&(u=h[0])}this._appState.prototypeState().navigateToFrameAndCloseOverlays3(i,this._appState.scene().findNode1(c),1,0,0,u,null)}let a=t.getCurrentOverlays();a.length>o.length&&(t.closeOverlayAtAndAbove(o.length,1),a=t.getCurrentOverlays());for(let c=0,l=o.length;c<l;c=c+1){let u=pt.decodeGUID(o[c].overlayGuid),d=pt.decodeGUID(o[c].swapGuid),h=pt.decodeGUID_instanceHACK(o[c].hotspotGuid),S=pt.decodeGUID(o[c].prototypeInteractionGuid),f=null;if(S!=null)f=n.findPrototypeInteractionWithId(R.toString(h),R.toString(S));else{let y=this._appState.prototypeStructure().findPrototypeInteractionsWithTransition(R.toString(h),R.toString(d));y.length!=0&&(f=y[0])}if(a.length<=c){let y=this._appState.scene().findNode1(h);if(y==null)return;t.overlayFrame(d,y,!0,0,0,f,null),a=t.getCurrentOverlays()}if(!R.equals(a[c].id(),u)||!R.equals(a[c].overlayDataModelId(),d)){if(c<a.length-1&&t.closeOverlayAtAndAbove(c+1,1),!R.equals(a[c].overlayDataModelId(),d)){t.closeOverlayAtAndAbove(c,1);let _=this._appState.scene().findNode1(h);t.overlayFrame(d,_,!0,0,0,f,null)}let y=this._appState.scene().findNode1(a[c].id()),v=r.lastTriggeredHotspot,b=this._appState.scene().findNode1(v);b=y!=null&&y.isAncestorOf(b)?b:null;let m=r.lastTriggeredPrototypeInteractionID,p=null;b!=null&&m!=null?p=n.findPrototypeInteractionWithId(R.toString(b.id()),R.toString(m)):b!=null&&n.nodeTransitionTracker().cleanedUpInteractionMap()._in(b.id())&&(p=n.nodeTransitionTracker().cleanedUpInteractionMap().getHotspotInteractions(b.id())[0]),t.swapTopOverlay(u,b,0,p,null)}a=t.getCurrentOverlays()}t.getInitiatedChange()!=null&&!e&&t.commitStateChange()}_initiateStateSwap(e){var a;let t,n=this._appState.prototypeState(),r=pt.decodeGUIDPath(e.hotspotStablePath),o=(a=this._appState.scene())==null?void 0:a.findNode3(r),i=pt.decodeGUID(e.interactionID);n.swapInstanceToState2(pt.decodeGUIDPath(e.instanceStablePath),pt.decodeGUID(e.stateID),o,0,o==null?void 0:o.findPrototypeInteraction(i),1,null)}_commitStateSwap(e){let t=this._appState.prototypeState(),n=pt.decodeGUIDPath(e.instanceStablePath);t.commitChangesBelowInstanceTransitionRoot(n)}applyInstanceStateSwaps(e){let t=this._session.observedUser();if(t.instanceStateChanges!=null){for(let n of t.instanceStateChanges)n.phase=="INITIATED"&&this._initiateStateSwap(n),(n.phase=="COMMITTED"||!e)&&this._commitStateSwap(n);t.instanceStateChanges=[]}}handleConnect(e,t){this._userSyncing=new Hl,this._session.setMultiplayerUserSyncing(this._userSyncing),this._userSyncing.onChange=n=>{this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())},this._userSyncing.onMouseCursorChange=n=>{let r;n==this._session.observingSessionID()&&(r=this._canvasView)!=null&&r.viewport().invalidate()}}handleDisconnect(){this._userSyncing=null,this._session.setMultiplayerUserSyncing(null),this._emitter.trigger("multiplayerUserInfoChange",null)}handleJoinStart(e,t,n){e!=1&&this._emitter.trigger("joinStart",null)}handleJoinEnd(){let e;this._session.scene()!=this._appState.scene()&&this._appState.setActiveCanvas(null),this._isFirst&&(this._isFirst=!1);let t=this._appState.getActiveCanvas();t!=null&&this._emitter.trigger("prototypeDeviceChanged",t.prototypeDevice().toJSON()),(e=this._canvasView)!=null&&e.afterEnteredViewer()}handleNodeChanges(){this._appState.prototypeState().didApplyNodeChanges()}handlePresenterChange(){this._emitter.trigger("multiplayerUserInfoChange",this.userInfoJSON())}handleSceneGraphReply(e,t){}handleSceneChangedLoadingPhase(e,t){}onFrame(){this.setPreviewToObservedFrameOrOverlay(!0)}};var Cc;(u=>{function g(d){return d}u._shortcut1=g;function e(d,h){return d|h<<u.MODIFIERS_SHIFT}u._shortcut2=e;function t(d,h,S){return d|h<<u.MODIFIERS_SHIFT|S<<u.FLAGS_SHIFT}u._shortcut3=t;function n(d){let h=new Map([[3,[e(20,4),e(20,16)]],[4,[21,29]],[1,[93,92,69,e(93,16),e(92,16),e(69,16)]],[2,[91,70,e(91,16),e(70,16)]]]);for(let S of Array.from(h.keys()))for(let f of h.get(S)){let y=f&u.KEY_MASK,v=f>>u.MODIFIERS_SHIFT&u.MODIFIERS_MASK,b=f>>u.FLAGS_SHIFT&u.FLAGS_MASK;o.Flags_currentlyApplies(b)&&((16&v)!=0&&(v|=Aa.Modifiers_currentPlatformModifier()),ns.KeyShortcutMap_set(d,y,v,S))}}u.addTo=n;let r;(f=>(f[f.__NONE=0]="__NONE",f[f.MAC=1]="MAC",f[f.NON_MAC=2]="NON_MAC"))(r=u.Flags||(u.Flags={}));let o;(f=>{function d(y){return(1&y)!=0}f.Flags_isMacOnly=d;function h(y){return(2&y)!=0}f.Flags_isNonMacOnly=h;function S(y){return(!d(y)||tt.OS_current()==4)&&(!h(y)||tt.OS_current()!=4)}f.Flags_currentlyApplies=S})(o=u.in_Flags||(u.in_Flags={})),u.KEY_MASK=255,u.MODIFIERS_MASK=255,u.MODIFIERS_SHIFT=8,u.FLAGS_MASK=255,u.FLAGS_SHIFT=16})(Cc||(Cc={}));var Nc=(t=>(t[t.INTERNAL_ON_FRAME_LOOP_ENABLED=0]="INTERNAL_ON_FRAME_LOOP_ENABLED",t[t.INTERNAL_ON_FRAME_LOOP_DISABLED=1]="INTERNAL_ON_FRAME_LOOP_DISABLED",t))(Nc||{}),Oc=class{constructor(e,t,n,r,o){this._window=null,this._appState=null,this._canvasView=null,this._shortcuts=new Map,this._multiplayerSession=null,this._multiplayerCoupler=null,this._window=new tl(e,n,o==1),this._appState=new Nn(t),this._canvasView=new ei(this._appState,t),this._canvasView.setParent(this._window.root()),this._canvasView.setup(),this._canvasView.focus(),this._registerShortcuts(),this._multiplayerSession=new Lr(this._appState,()=>this._window.isActive(),t,r),this._multiplayerCoupler=new Eu(this._appState,this._canvasView,t,this._multiplayerSession),this._canvasView.setMultiplayer(this._multiplayerSession),er.instance.setSerialization(this._appState.serialization()),er.instance.setMultiplayer(this._multiplayerSession)}state(){return this._appState}canvasView(){return this._canvasView}window(){return this._window}multiplayerSession(){return this._multiplayerSession}multiplayerCoupler(){return this._multiplayerCoupler}_registerShortcuts(){let e=!0;$n.addUpdate(zt.keyPress(this._window.root().events()),t=>{e&&(Cc.addTo(this._shortcuts),e=!1);let n=ns.KeyShortcutMap_get(this._shortcuts,t.asKeyEvent().key,t.modifiers(),0);n!=0&&(this._appState.triggerAction1(n),t.accept())})}unloadSceneAndResetPrototypeLib(){this._multiplayerSession.disconnect(),this._appState.setScene(null),this._multiplayerSession.setScene(null),x._prototypeLib!=null&&(console.log("Resetting PrototypeLib..."),x.destroy())}initializePrototypeLib(e){if(this.unloadSceneAndResetPrototypeLib(),e==null)throw new Error("Can't initialize PrototypeLib with null CppModules");x.initialize(e,this._appState)}connectTo(e,t,n,r,o,i,a){if(this._appState.setActivePrototypeStartingPointNodeId(n),this._appState.prototypeState().resetPrototype(),this._multiplayerCoupler.reset(),this._appState.setRenderDots(!!i),this._canvasView.setBackgroundEnabled(!i),At.setImagePrefixURL(`/file/${e}/image`),At.setVideoPrefixUrl(`/api/files/${e}/videos`),tt.OS_isMobile(tt.OS_current())||tt.OS_current()==4&&navigator.maxTouchPoints>0||At.forceMobileOptimizations()){let s=Q.getFeatureFlags().viewerServerDownsample1024?1024:2048;At.setImageBatchURL(`/file/${e}/image/batch?max_size=${s}`)}else At.setImageBatchURL(`/file/${e}/image/batch`);this.initializePrototypeLib(a),this._multiplayerSession.connectTo(e,t,r,o)}},fg;(e=>{function g(t){return Nc[t]}e.InternalOnFrameLoop_toString=g})(fg||(fg={}));function d_(){let g=new Map,e=window.location.search;if(e.length==0)return g;e=e.slice(1);for(let t of e.split("&")){let n=t.split("=");n.length==2&&g.set(n[0],n[1])}return g}function or(){if(!Sg){Sg=!0;let g=d_(),e=Me.StringMap_get(g,"force-dpr",null);if(e!=null){let t=+parseFloat(e);isNaN(t)||(Cu=new fe(Pe.Math_clamp1(t,.1,4)))}}return Cu!=null?Cu.value:window.devicePixelRatio}var Sg=!1,Cu=null;var Rc=class{constructor(e){this._scene=null,this._watchedNodeIDs=new Map,this.onChangeCallback=null,e.addAppObserver(this)}watchNodesWithIDs(e){this._watchedNodeIDs=new Map;for(let t of e)this._watchedNodeIDs.set(R.toString(t),!0)}handleSceneChange(e,t){this._scene=t,e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this.onChangeCallback!=null&&this.onChangeCallback()}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}_isWatchedNode(e){return this._watchedNodeIDs.has(R.toString(e))}_isAncestorOrSelfOfWatchedNode(e){for(let t of Array.from(this._watchedNodeIDs.keys())){let n=this._scene.findNode2(t);for(let r=n;r!=null;r=r.parent())if(R.equals(r.id(),e))return!0}return!1}handleSceneGraphEvent(e){let t=!1;if(e.property==24){let n=e.oldVal!=null&&Z.isParentIndex(e.oldVal)?Z.asParentIndex(e.oldVal):null,r=e.newVal!=null&&Z.isParentIndex(e.newVal)?Z.asParentIndex(e.newVal):null;(n==null||r==null||n.id!=r.id)&&(t=this._isAncestorOrSelfOfWatchedNode(e.node.id()))}else e.property==23?t=this._isAncestorOrSelfOfWatchedNode(e.node.id()):(e.property==48||e.property==85)&&(t=this._isWatchedNode(e.node.id()));t&&this.onChangeCallback!=null&&this.onChangeCallback()}};var ea=class{toJSON(){let e={nodeId:R.toString(this.nodeId)};return this.nodeOffset!=null&&(e.nodeOffset={x:this.nodeOffset.x(),y:this.nodeOffset.y()}),this.canvasPosition!=null&&(e.canvasPosition={x:this.canvasPosition.x(),y:this.canvasPosition.y()}),e}static fromJSON(e){let t=null,n=null,r=null;return e.nodeId!==null&&e.nodeId!==void 0&&(t=R.fromString(e.nodeId)),e.nodeOffset!==null&&e.nodeOffset!==void 0&&(n=new I(e.nodeOffset.x,e.nodeOffset.y)),e.canvasPosition!==null&&e.canvasPosition!==void 0&&(r=new I(e.canvasPosition.x,e.canvasPosition.y)),new ea(t,n,r)}constructor(e,t,n){this.nodeId=e,this.nodeOffset=t,this.canvasPosition=n}},wc=class{constructor(e){this._appState=null,this._boundsWatcher=null,this._shouldNotifyCommentPositionsChanged=!1,this._nodesWithComments=[],this.notifyCommentPositionsChange=null,this._appState=e,this._boundsWatcher=new Rc(e),this._boundsWatcher.onChangeCallback=()=>{this._shouldNotifyCommentPositionsChanged=!0},this._appState.addAppObserver(this),this._appState.addFrameObserver(this),this._appState.prototypeState().addObserver(this)}setNodesWithComments(e){this._boundsWatcher.watchNodesWithIDs(e),this._nodesWithComments=e}onFrame(){this._shouldNotifyCommentPositionsChanged&&(this.notifyCommentPositionsChange!=null&&this.notifyCommentPositionsChange(),this._shouldNotifyCommentPositionsChanged=!1)}handleSceneChange(e,t){this._shouldNotifyCommentPositionsChanged=!0}handleActiveCanvasChange(e,t){this._shouldNotifyCommentPositionsChanged=!0}handleActivePrototypeStartingPointChange(e,t){}_isAncestorOrSelfOfNodeWithComment(e){let t=this._appState.scene();if(t==null)return!1;for(let n of this._nodesWithComments){let r=t.findNode1(n);for(let o=r;o!=null;o=o.parent()){let i=o.id();if(R.equals(i,e))return!0}}return!1}handleStateChangeAborted(e){this.handlePresentedStateChange(e)}handleStateChangeCommitted(e,t){this.handlePresentedStateChange(e)}handleStateChangeInitiated(e){this.handlePresentedStateChange(e)}handleStateChangeRequested(e){}handlePresentedStateChange(e){if(e==null||this._shouldNotifyCommentPositionsChanged)return;if(this._isAncestorOrSelfOfNodeWithComment(e.oldStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let t=e.oldStateAndOverlays.overlays;for(let r=0,o=t.length;r<o;r=r+1){let i=t[r].id;if(this._isAncestorOrSelfOfNodeWithComment(i)){this._shouldNotifyCommentPositionsChanged=!0;return}}if(this._isAncestorOrSelfOfNodeWithComment(e.newStateAndOverlays.stateId)){this._shouldNotifyCommentPositionsChanged=!0;return}let n=e.newStateAndOverlays.overlays;for(let r=0,o=n.length;r<o;r=r+1){let i=n[r].id;if(this._isAncestorOrSelfOfNodeWithComment(i)){this._shouldNotifyCommentPositionsChanged=!0;return}}}handleFitModeChange(e,t){}handleRestartPrototype(){}getCommentDestinationAtPosition(e){let t=this._appState.scene();if(t==null)return null;let n=this._appState.baseScreenNode();if(n==null)return null;let r=this._appState.prototypeState().getCurrentOverlays();for(let i=r.length-1;i>=0;i=i-1){let a=t.findNode1(r[i].id());if(a==null)continue;let s=r[i].renderedBounds(n);if(s.contains2(e)){let c=e.subtract1(s.topLeft());return new ea(a.id(),c,null)}}let o=e.subtract1(n.canvasSpaceBoundingBox().topLeft());return new ea(n.id(),o,null)}_currentCommentsScreen(){return this._appState.prototypeState().getTopmostScreen()}_currentCommentsScreenRenderedBounds(){let e=this._appState.baseScreenNode(),t=this._appState.prototypeState().getTopmostOverlay();return e!=null&&t!=null?t.renderedBounds(e):e==null?void 0:e.canvasSpaceBoundingBox()}getCanvasSpaceCommentLocations(e,t){let n={};for(let r of Array.from(t.keys())){let o=t.get(r),i=e.findNode1(o.nodeId),a=this._currentCommentsScreen(),s=this._currentCommentsScreenRenderedBounds();if(i==null||a==null||s==null)continue;let c=!1;if(c=a.isAncestorOf(i),!c)continue;let l=i.canvasSpaceScrolledBounds(1).topLeft().subtract1(a.canvasSpaceBoundingBox().topLeft()),d=s.topLeft().add1(l).add1(o.nodeOffset),h={};h.x=d.x(),h.y=d.y(),n[r]=h}return n}};var al=class{constructor(e,t,n){this.prototypeApp=e,this.skewKiwiSerialization=t,this.deprecatedJsSceneHooks=n}};var is;(i=>{function g(a){return{x:Math.round(a.x()*100)/100,y:Math.round(a.y()*100)/100}}i._serialize=g;function e(a){return new I(a.x,a.y)}i._deserializeVector=e;function t(a,s){(1&s)!=0&&(a.alt=!0),(2&s)!=0&&(a.meta=!0),(4&s)!=0&&(a.shift=!0),(8&s)!=0&&(a.ctrl=!0),(16&s)!=0&&(a.platform=!0)}i._setModifiers=t;function n(a){return("alt"in a?1:0)|("meta"in a?2:0)|("shift"in a?4:0)|("ctrl"in a?8:0)|("platform"in a?16:0)}i._loadModifiers=n;function r(a,s){let c=a.asMouseEvent();if(c!=null){let u={};return u.type=Oi[a.type()],u.at=g(s(c.locationInWindow)),c.locationInWindow.equals(c.previousLocationInWindow)||(u.lastAt=g(s(c.previousLocationInWindow))),c.clickCount!=0&&(u.clicks=c.clickCount),c.scrollDelta!=null&&(u.scroll=g(c.scrollDelta)),t(u,a.modifiers()),u}let l=a.asKeyEvent();if(l!=null){let u={};return u.type=Oi[a.type()],u.key=l.key,l.isRepeat&&(u.repeat=!0),t(u,a.modifiers()),u}return null}i.serialize=r;function o(a,s,c,l){let u=Zi.ViewerEventType_fromString(a.type);if(Zi.ViewerEventType_isMouseEventType(u)){let d=l(e(a.at)),h=s(d),S=d;"lastAt"in a&&(S=l(e(a.lastAt)));let f=null;"scroll"in a&&(f=e(a.scroll));let y=0;"clicks"in a&&(y=a.clicks);let v=n(a);return new Qi(u,h,v,d,S,f,y,[])}else if(Zi.ViewerEventType_isKeyEventType(u)){let d=c(),h=a.key|0,S=a.repeat,f=n(a);return new rs(u,d,f,h,S)}else if(Zi.ViewerEventType_isTouchEventType(u)){let d=n(a),h=l(e(a.at)),S=s(h);if(u==11||u==12){let f=h;"lastAt"in a&&(f=l(e(a.lastAt)));let y=new Ys(0,S,h,f);return new $o(u,S,d,[y],[y])}else return new $o(u,S,d,[],[])}else if(Zi.ViewerEventType_isWindowEventType(u))throw new Error("Deserializing window events not supported");throw new Error(`Unrecognized event type in deserialize ${Oi[u]}`)}i.deserialize=o})(is||(is={}));var Pc=class{constructor(e,t,n){if(this._app=null,this._frameLoader=null,this._session=null,this._emitter=null,this._pendingNodeId=null,this._app=e,this._session=t,this._frameLoader=this._session.incrementalLoader(),this._frameLoader==null)throw new Error("Expected incremental frame loader for mirror mode");this._emitter=n,this._pendingNodeId=null,this._emitter.on("incrementalLoadingInfo",r=>{r.type==="finishIncrementalLoading"&&this._handleIncrementalLoadFinished()})}connectToFileAndShowNode(e,t,n,r,o,i,a){n!=null&&this._app.state().setActivePrototypeStartingPointNodeId(n),this._session.fileKey()!=e?this._app.connectTo(e,t,n,r,o,i,a):this._app.state().currentFileKey()!=e?(this._frameLoader.requestTlf(t),this._pendingNodeId=t):this._frameLoader.requestTlf(t)?this._app.state().prototypeState().navigateToFrameAndCloseOverlays1(t):this._pendingNodeId=t}_handleIncrementalLoadFinished(){var t;let e;this._pendingNodeId!=null&&((t=this._app.state().scene())==null?void 0:t.findNode1(this._pendingNodeId))!=null&&(this._app.state().prototypeState().navigateToFrameAndCloseOverlays1(this._pendingNodeId),this._pendingNodeId=null)}};var Nu=class{constructor(e){this._session=null,this._preservers=[],this._isReconnecting=!1,this._session=e,this._session.addObserver(this),this._preservers.push(new yg),this._preservers.push(new bg)}handleSceneChangedLoadingPhase(e,t){t==1?this.handleSceneWillRebuildAfterReconnect():e==1&&t==2&&this.handleSceneDidRebuildAfterReconnect()}handleSceneWillRebuildAfterReconnect(){if(this._session.scene()==null){ze("Scene unexpectedly null in handleSceneWillRebuildAfterReconnect");return}this._isReconnecting=!0,this._preservers.forEach(e=>{e.reset()}),this._session.scene().each(e=>{this._preservers.forEach(t=>{t.saveDataFromOldSceneNode(e)})})}handleSceneDidRebuildAfterReconnect(){this._isReconnecting=!1,this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())}),this._preservers.forEach(e=>{e.reset()})}handleConnect(e,t){}handleDisconnect(){}handleJoinStart(e,t,n){}handleJoinEnd(){}handlePresenterChange(){}handleNodeChanges(){!this._isReconnecting||this._preservers.forEach(e=>{e.restoreDataToNewScene(this._session.scene())})}handleSceneGraphReply(e,t){}},bg=class{constructor(){this._nodeDeveloperFriendlyIdToScrollOffset=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdToScrollOffset=new Map}saveDataFromOldSceneNode(e){e.scrollDirection()!="NONE"&&!e.scrollOffset().equals(ye.FrozenVector_ZERO)&&this._nodeDeveloperFriendlyIdToScrollOffset.set(e.developerFriendlyId(),e.scrollOffset())}restoreDataToNewScene(e){Me.StringMap_each(this._nodeDeveloperFriendlyIdToScrollOffset,(t,n)=>{let r=e.findNodeFromDeveloperFriendlyId(t);r!=null&&r.setScrollOffset(n)})}},yg=class{constructor(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=null,this.reset()}reset(){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens=new rr}saveDataFromOldSceneNode(e){e.usedAsBaseScreen()&&this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.add(e.developerFriendlyId())}restoreDataToNewScene(e){this._nodeDeveloperFriendlyIdsUsedAsBaseScreens.each(t=>{let n=e.findNodeFromDeveloperFriendlyId(t);n!=null&&n.setUsedAsBaseScreen(!0)})}};var Ou=class{constructor(e){this._scene=null,this.onChange=null,this._scene=e.scene(),e.addAppObserver(this)}handleSceneChange(e,t){e!=null&&e.removeObserver(this),t!=null&&t.addObserver(this),this._scene=t}handleActiveCanvasChange(e,t){}handleActivePrototypeStartingPointChange(e,t){}handleSceneGraphEvent(e){(e.node.type()=="CANVAS"||e.node.type()=="DOCUMENT")&&this.onChange(this.pages())}pages(){let e=[];if(this._scene!=null&&this._scene.root()!=null)for(let t=0;t<this._scene.root().childCount();t=t+1){let n=this._scene.root().childAt1(t);n.type()=="CANVAS"&&!n.isInternalOnly()&&e.push({id:R.toString(n.id()),name:n.name()})}return e}};var Ru;(r=>{function g(o){return Array.from(o.values())}r.Set_values=g;function e(o,i){return n(o,i)}r.Set_subtract=e;function t(o){return new Set(o)}r.Set_new1=t;function n(o,i){let a=new Set(Array.from(o.values()));return o.forEach(s=>{i.has(s)&&a.delete(s)}),a}r.Set_difference=n})(Ru||(Ru={}));var wu=(t=>(t[t.INCREMENTAL_QUERIED_BY_CLIENT=0]="INCREMENTAL_QUERIED_BY_CLIENT",t[t.FULL_DOCUMENT_UPFRONT=1]="FULL_DOCUMENT_UPFRONT",t))(wu||{});var Tg;(e=>{function g(t){return wu[t]}e.DocumentLoadMode_toString=g})(Tg||(Tg={}));var vg;(c=>{function g(){return C.BufferChunk.BYTE_COUNT}c.BYTE_COUNT=g;function e(){let l=new s,u=l.add(C.VertexFormat.POSITION_F2,g()/4|0,0);u.area.byteOffset()==0;let d=l.add(C.VertexFormat.POSITION_F2,g()/4|0,1);d.area.byteOffset()==(g()/4|0);let h=l.add(C.VertexFormat.POSITION_F2,g()/4|0,2);h.area.byteOffset()==(g()/4|0)*2;let S=l.add(C.VertexFormat.POSITION_F2,g()/4|0,3);S.area.byteOffset()==(g()/4|0)*3,u.free(),h.free();let f=l.add(C.VertexFormat.POSITION_F2,g()/4|0,4);d.area.byteOffset()==0,S.area.byteOffset()==(g()/4|0),f.area.byteOffset()==(g()/4|0)*2,l.pool.totalVRAM()==g(),l.context.buffers.length==1;let y=l.context.buffers[0];d.check(y),S.check(y),f.check(y)}c.testBasicBufferPoolGC=e;function t(){let l=new s,u=l.add(C.VertexFormat.POSITION_F2,g()/4|0,0);u.area.byteOffset()==0;let d=l.add(C.VertexFormat.POSITION_F2,g()/4|0,1);d.area.byteOffset()==(g()/4|0);let h=l.add(C.VertexFormat.POSITION_F2,g()/4|0,2);h.area.byteOffset()==(g()/4|0)*2;let S=l.add(C.VertexFormat.POSITION_F2,g()/4|0,3);S.area.byteOffset()==(g()/4|0)*3,u.free();let f=l.add(C.VertexFormat.POSITION_F2,g()/4|0,4);d.area.byteOffset()==0,h.area.byteOffset()==(g()/4|0),S.area.byteOffset()==(g()/4|0)*2,f.area.byteOffset()==(g()/4|0)*3,l.pool.totalVRAM()==g(),l.context.buffers.length==1;let y=l.context.buffers[0];d.check(y),h.check(y),S.check(y),f.check(y)}c.testBasicBufferPoolGC2=t;function n(){let l=new s,u=l.add(C.VertexFormat.POSITION_F2,g()/4|0,0);u.area.byteOffset()==0;let d=l.add(C.VertexFormat.POSITION_F2,g()/4|0,1);d.area.byteOffset()==(g()/4|0);let h=l.add(C.VertexFormat.POSITION_F2,g()/4|0,2);h.area.byteOffset()==(g()/4|0)*2,d.free();let S=l.add(C.VertexFormat.POSITION_F2,g()/2|0,3);u.area.byteOffset()==0,h.area.byteOffset()==(g()/4|0),S.area.byteOffset()==(g()/4|0)*2,l.pool.totalVRAM()==g(),l.context.buffers.length==1;let f=l.context.buffers[0];u.check(f),h.check(f),S.check(f)}c.testByteOffsetBugFig5426=n;function r(){let l=new s,u=l.add(C.VertexFormat.POSITION_F2,8,0);u.area.byteOffset()==0;let d=l.add(C.VertexFormat.POSITION_F2,8,1);d.area.byteOffset()==8;let h=l.add(C.VertexFormat.POSITION_F4_COORD_F4,32,2);h.area.byteOffset()==32;let S=l.add(C.VertexFormat.POSITION_F4_COORD_F4,32,3);S.area.byteOffset()==64,d.free(),h.free();let f=l.add(C.VertexFormat.POSITION_F2,g()-64,4);u.area.byteOffset()==0,S.area.byteOffset()==32,f.area.byteOffset()==64,l.pool.totalVRAM()==g(),l.context.buffers.length==1;let y=l.context.buffers[0];u.check(y),S.check(y),f.check(y)}c.testStrideBugFig5426=r;class o{constructor(u,d){this._context=null,this._byteCount=0,this._bytes=null,this._context=u,this._byteCount=d,this._bytes=new Uint8Array(d)}context(){return this._context}bytes(){return this._bytes}byteCount(){return this._byteCount}move(u,d,h){h>=0,0<=u&&u+h<=this._byteCount,0<=d&&d+h<=this._byteCount,u!=d&&h!=0&&this._bytes.set(this._bytes.subarray(u,u+h),d)}upload2(u,d){0<=d&&d+u.length<=this._byteCount,this._bytes.set(u,d)}prepare(){}}c.VertexBuffer=o;class i{createVertexBuffer(u){let d=new o(this,u);return this.buffers.push(d),d}addContextResetHandler(u){}beginFrame(){}clear2(u,d){}createMaterial(u,d,h,S){return null}createTexture2(u,d,h,S,f){return null}createTexture3(u,d,h){return null}createTextureSet(u,d,h){return null}currentTextureSet(){return null}currentStencilState(){return null}currentBlendState(){return null}draw(u,d,h){}endFrame(){}flush(){}height(){return 0}maxTextureSize(){return 4096}removeContextResetHandler(u){}resize(u,d){return new C.ComputedCanvasSize(new I(u,d),!1)}setBlendState(u){}readPixels(u,d,h,S,f){return null}setStencilState(u){}setTextureSet(u){}setViewport(u,d,h,S){}width(){return 0}annotate(u,d){d()}annotateAndReturn(u,d){return d()}annotateProfile(u,d){d()}setScissor(u){}isContextLost(){return!1}graphicsCardName(){return"Unknown"}setMaximumDrawingBufferSizeForTesting(u){}clearMaximumDrawingBufferSizeForTesting(){}hasLoggedHighpPrecisionUnsupported(){return!0}setHasLoggedHighpPrecisionUnsupported(){}constructor(){this.buffers=[]}}c.Context=i;class a{free(){this.area.free(),this.area.wasFreed()}check(u){for(let d=0,h=this.bytes.length;d<h;d=d+1)u.bytes()[this.area.byteOffset()+d]==this.bytes[d]}constructor(u,d){this.bytes=u,this.area=d}}c.Result=a;class s{constructor(){this.context=new i,this.pool=null,this.pool=new C.BufferPool(this.context)}add(u,d,h){let S=new Uint8Array(d);S[0]=h*2+1,S[S.length-1]=h*2+2;let f=this.pool.allocate(u,S);return f!=null,f.byteCount()==d,f.wasFreed(),new a(S,f)}}c.Helper=s})(vg||(vg={}));var xc;(a=>(a.FIG_FILE_NO_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,73,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,130,136,1,0]),a.FIG_FILE_THUMBNAIL=new Uint8Array([102,105,103,45,107,105,119,105,1,0,0,0,208,10,0,0,141,24,123,127,227,70,113,87,118,156,199,229,30,125,80,74,41,165,148,82,74,129,114,87,74,41,165,180,149,45,217,86,34,75,170,36,231,113,148,186,138,45,199,106,100,201,104,101,95,114,208,239,206,204,142,94,78,14,126,228,143,104,231,177,243,218,153,217,89,127,57,10,133,8,46,67,255,102,21,50,182,119,100,27,214,196,243,85,215,103,240,103,217,154,62,233,13,85,107,160,123,0,242,177,167,187,13,88,145,220,186,165,193,186,229,25,3,75,53,97,213,246,252,115,83,135,197,142,92,76,60,29,101,117,106,201,19,239,216,112,38,174,110,218,42,238,220,85,175,35,1,194,206,80,227,57,170,81,167,83,48,10,80,174,174,106,19,219,50,17,203,36,112,234,26,62,202,230,86,58,11,157,69,32,192,104,165,7,36,95,215,136,105,100,159,200,37,63,141,146,89,148,92,186,235,24,121,44,219,122,170,187,54,242,216,154,86,74,32,175,95,2,34,10,101,154,221,27,143,116,11,237,229,61,213,58,81,165,151,3,215,30,59,232,98,223,85,71,200,215,238,218,182,169,171,214,196,118,116,87,245,13,219,66,111,79,244,158,111,187,232,42,122,137,142,153,134,20,187,167,155,166,225,120,184,220,119,129,9,194,39,227,115,224,234,131,177,169,186,19,199,54,207,7,82,200,61,80,101,105,186,54,105,242,29,250,250,25,154,116,223,51,141,30,34,30,120,231,163,174,141,177,126,104,88,160,204,146,216,71,221,56,76,102,35,240,138,177,87,28,213,243,38,254,16,196,13,134,116,146,238,72,158,14,215,84,247,88,71,93,202,104,108,250,134,35,131,219,66,83,193,146,238,216,69,82,187,103,155,118,5,237,152,198,96,232,203,61,29,15,98,45,87,187,197,14,205,214,6,210,73,218,82,130,251,112,10,174,169,162,236,3,207,238,251,19,41,3,61,28,170,174,86,65,135,154,209,239,235,174,78,30,220,215,207,122,230,216,163,120,62,24,142,17,247,208,83,253,113,21,228,71,82,11,44,94,50,199,35,195,178,61,195,71,21,47,59,65,148,228,116,152,29,207,54,13,153,11,3,87,213,12,56,205,9,153,138,206,87,40,252,202,120,40,21,10,194,141,167,129,209,168,112,192,52,178,101,126,183,141,145,42,61,219,49,150,80,46,222,52,136,67,138,53,228,187,171,251,61,25,230,190,33,115,167,111,152,82,182,111,200,3,108,233,243,121,56,45,236,107,27,150,5,85,228,13,85,205,62,149,73,231,218,78,13,242,190,13,105,33,211,96,210,53,199,104,142,210,85,123,199,219,168,150,31,94,231,61,153,253,109,219,53,6,6,149,30,27,59,144,145,40,197,180,79,229,2,76,240,201,6,220,161,133,211,52,11,242,40,77,0,81,38,61,38,156,91,164,42,7,95,140,99,189,78,28,197,90,47,47,194,108,156,68,57,20,100,203,85,165,201,142,113,166,155,178,35,128,186,30,21,140,210,75,19,145,103,245,65,236,192,1,33,51,210,201,168,145,138,53,174,212,241,106,121,61,85,90,215,246,242,44,189,10,213,56,186,68,211,170,45,12,242,219,208,164,101,246,216,47,150,10,49,247,130,21,40,41,189,144,225,145,30,124,61,86,93,201,166,186,174,125,42,15,31,77,109,17,168,127,61,54,76,232,22,110,209,171,164,168,163,52,66,181,35,163,208,218,213,79,116,89,44,165,84,165,155,166,113,24,36,246,42,44,227,215,30,91,148,147,96,35,108,243,160,96,165,250,113,215,119,85,185,86,206,236,234,172,164,103,195,52,139,158,167,73,30,196,176,221,212,251,254,118,120,220,162,40,148,163,177,231,27,125,67,182,177,122,247,73,152,229,209,20,247,182,124,219,217,222,218,181,125,223,30,201,162,78,215,34,236,173,51,145,102,80,11,154,222,87,161,202,37,179,107,123,144,101,134,228,215,207,117,76,59,74,22,5,26,186,84,229,168,224,10,84,125,239,88,182,236,182,163,83,99,131,220,77,179,81,148,101,40,179,202,155,178,61,113,185,128,242,129,178,214,173,129,47,211,70,11,196,130,202,67,233,65,243,67,254,250,216,185,44,161,162,28,28,107,128,212,35,71,31,200,248,157,224,71,113,180,190,44,156,235,85,154,229,183,51,171,213,179,193,113,48,181,76,31,86,34,78,13,77,234,231,37,98,168,151,65,53,131,155,116,157,15,178,104,86,8,185,147,158,181,129,138,12,250,58,79,221,80,68,207,195,134,211,82,129,244,181,146,204,107,29,94,126,19,135,94,88,22,0,132,215,179,139,202,244,117,117,36,13,131,179,165,147,234,187,144,139,208,249,100,255,245,245,145,99,187,170,123,78,73,73,98,192,239,60,172,156,190,211,215,100,36,139,174,4,170,131,233,21,69,188,50,118,8,173,225,41,4,130,26,63,52,100,223,232,81,211,147,220,189,116,13,242,179,162,232,218,255,79,185,226,182,163,181,200,163,249,205,255,218,225,168,61,125,2,53,68,55,119,107,48,6,195,185,34,224,82,135,210,129,245,46,227,113,10,169,44,151,208,56,98,72,44,222,206,216,62,227,151,240,79,185,128,127,173,0,254,181,41,247,96,243,53,18,111,144,232,2,10,184,107,196,51,228,94,32,183,148,228,229,233,10,54,76,165,212,46,227,171,84,68,178,100,129,117,20,228,89,116,205,120,103,249,248,49,238,95,62,126,130,232,229,227,143,80,198,242,9,34,219,203,39,136,220,89,62,65,100,199,9,50,56,3,35,153,133,176,79,185,92,71,51,246,85,67,232,189,178,69,2,113,19,196,235,16,197,174,101,187,124,29,206,24,78,208,10,150,33,227,173,121,176,140,226,27,224,231,2,143,23,55,130,144,92,76,179,104,149,3,116,39,215,65,96,142,39,255,152,241,82,176,210,141,211,11,198,249,197,77,30,10,214,226,84,72,76,105,193,32,180,64,56,65,93,32,121,22,228,129,228,221,133,170,150,194,148,67,41,236,1,227,101,96,148,116,21,76,163,28,67,216,218,68,34,186,0,163,56,107,95,84,83,196,33,219,17,16,75,193,134,188,3,38,37,98,158,102,75,118,196,118,35,169,245,132,237,201,133,191,0,255,147,32,138,1,179,31,109,95,142,143,216,65,150,230,65,17,254,123,2,9,176,56,148,151,17,216,200,148,221,233,34,200,130,41,228,161,192,216,84,144,172,1,67,19,108,23,18,7,215,246,38,204,160,120,67,63,64,67,115,222,138,101,65,123,88,159,26,152,13,151,97,28,37,16,150,111,248,206,101,124,179,90,8,246,45,239,204,170,27,79,176,239,248,110,183,224,98,74,187,58,65,72,205,103,209,44,199,4,82,144,118,142,1,193,197,48,140,46,23,57,102,196,0,229,193,158,105,186,92,6,201,76,20,161,229,13,25,100,164,76,232,214,28,78,93,218,5,91,27,87,174,162,100,144,186,130,245,57,175,153,21,202,112,10,70,107,35,1,43,204,159,165,217,85,169,37,129,176,7,49,200,155,21,206,254,151,128,96,153,57,1,56,162,112,76,83,193,190,226,220,187,89,94,164,113,33,93,72,0,212,66,2,211,186,148,33,96,191,2,89,139,39,44,79,175,31,200,186,219,103,149,212,81,176,90,193,56,13,94,20,21,128,154,102,80,236,112,98,96,153,20,231,134,243,16,170,101,10,241,221,153,71,113,120,28,82,194,215,122,21,80,136,77,96,136,9,11,73,143,134,54,164,11,182,224,237,50,187,119,104,108,98,74,71,166,238,203,205,212,157,207,69,152,67,40,90,89,48,139,214,2,35,93,231,240,78,51,135,59,84,87,208,78,115,169,0,194,176,158,207,161,9,128,97,81,117,15,125,200,160,97,84,149,231,194,64,92,93,23,76,217,147,250,63,98,60,192,151,138,2,78,84,170,90,201,122,233,129,145,50,193,118,88,187,48,12,218,135,32,108,145,7,157,203,117,142,89,77,208,110,233,200,30,157,151,242,172,241,86,217,67,63,183,242,76,193,167,74,111,17,36,88,235,63,148,45,8,191,126,112,9,244,63,173,228,67,168,3,29,5,23,132,252,100,213,104,92,38,107,53,64,98,248,179,244,234,128,181,241,75,168,79,139,254,177,131,95,66,253,165,246,181,83,44,137,240,25,116,240,171,112,6,248,93,90,17,250,175,117,87,217,43,150,68,248,188,121,40,251,21,64,196,191,77,241,46,130,197,129,92,16,242,11,65,233,126,15,191,132,250,178,217,135,14,43,128,136,95,205,32,169,32,160,16,103,232,54,252,126,3,36,6,53,144,87,186,116,146,179,7,53,68,228,238,5,220,110,151,25,24,48,211,19,44,42,116,238,225,29,36,49,247,150,129,184,2,250,35,252,18,74,11,203,14,142,183,182,176,19,104,247,156,189,116,23,75,236,58,238,52,132,189,206,101,71,226,236,229,45,4,49,245,107,245,118,21,216,87,238,32,137,121,0,173,38,9,51,183,44,137,87,155,48,177,12,27,189,233,71,229,154,72,6,100,72,112,153,5,171,5,38,73,130,73,252,218,45,20,49,30,85,88,15,181,39,120,101,255,248,54,142,88,143,69,30,100,70,2,70,120,69,235,127,125,27,67,108,230,50,130,83,50,35,248,0,203,79,106,136,200,35,33,167,244,211,178,31,191,209,132,137,197,202,225,70,241,225,234,184,34,123,126,218,132,137,197,94,84,227,119,227,146,125,131,189,249,34,60,109,113,68,227,89,242,38,251,89,3,36,134,175,69,245,20,121,139,189,85,1,68,116,69,253,184,120,155,253,188,134,136,236,229,47,120,23,188,203,222,126,1,154,54,248,249,157,167,192,123,236,23,119,144,196,60,206,203,23,226,171,236,157,114,77,164,147,124,251,41,248,26,251,229,54,134,216,78,47,110,191,121,222,97,239,222,198,17,235,217,166,208,189,21,216,95,221,197,18,251,57,220,13,177,28,75,4,59,227,239,213,16,145,159,82,164,42,134,95,55,97,98,249,123,227,126,182,216,251,53,68,228,111,230,229,220,229,176,223,148,107,34,253,35,47,71,143,167,236,131,114,77,164,111,67,121,223,8,22,243,223,22,75,34,76,160,245,206,96,162,145,47,32,204,175,15,216,239,110,161,136,241,187,112,251,174,73,248,239,183,49,196,22,228,219,207,139,143,217,135,219,24,98,187,136,171,59,72,176,21,255,67,3,36,134,233,166,158,29,46,216,227,26,34,242,172,158,50,158,20,75,34,132,117,255,232,21,23,209,71,183,80,196,56,199,163,25,132,233,50,204,179,27,150,241,63,54,97,98,185,164,195,105,48,125,188,141,33,182,133,168,222,39,159,177,168,2,136,248,189,132,235,102,114,213,132,137,37,150,40,39,152,205,136,101,217,132,137,37,41,103,9,152,74,210,114,77,164,149,168,199,160,57,251,103,13,17,57,155,103,144,31,35,232,190,90,36,202,198,47,238,32,137,57,207,232,136,210,62,52,43,206,214,13,144,24,54,116,228,221,42,160,13,161,207,196,157,135,215,231,236,90,52,159,85,95,176,27,241,194,145,234,123,246,60,18,132,116,214,23,113,4,92,116,47,255,171,201,223,24,164,254,61,11,179,104,83,18,164,243,57,255,225,36,10,159,161,125,48,8,77,131,100,19,8,140,115,216,69,67,97,52,133,185,46,186,14,99,39,11,55,192,7,194,21,9,107,97,34,138,167,130,252,129,1,55,211,111,12,239,195,180,82,139,49,225,85,87,14,196,13,180,23,198,52,13,117,211,107,208,209,26,139,48,43,231,153,131,173,103,33,12,97,9,176,202,96,41,197,52,210,42,167,165,182,156,215,198,174,137,35,202,166,244,99,195,58,75,105,211,53,219,21,165,34,152,125,247,210,11,80,179,193,124,217,229,251,51,112,104,26,90,36,241,160,248,209,155,41,15,229,16,4,79,215,166,21,10,28,7,77,242,73,53,120,225,132,220,94,87,118,11,246,156,195,152,9,42,152,207,59,2,14,50,136,11,225,187,1,253,124,221,102,123,162,120,200,23,148,125,209,252,125,224,19,118,32,94,240,208,255,148,221,91,5,34,199,186,221,97,135,114,105,151,211,238,125,9,246,171,201,250,1,41,118,130,155,56,13,102,128,120,248,31,76,0,0,0,99,100,100,98,96,102,96,97,98,100,96,96,98,96,97,100,117,201,79,46,205,77,205,43,97,96,99,228,168,103,96,96,224,100,224,1,81,64,0,166,4,24,132,24,24,24,25,192,154,24,20,129,250,88,157,19,243,202,18,139,113,40,231,103,4,105,16,102,48,2,11,177,49,48,0,0,3,0,0,0,1,2,3]),a.GIF_MULTI_IMAGE=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,2,76,1,0,59]),a.GIF_MALFORMED_END_NO_EOF=new Uint8Array([71,73,70,56,57,97,2,0,2,0,241,0,0,0,0,0,255,255,255,255,0,0,0,255,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,4,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,44,1,0,0,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,0,0,1,0,1,0,0,2,2,76,1,0,44,1,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,1,0,1,0,1,0,1,0,0,2,2,76,1,0,44,0,0,1,0,1,0,1,0,0,2,2,84,1,0,33,249,4,4,50,0,0,0,44,0,0,1,0,1,0,1,0,0,2,50,76,1,0]),a.GIF_SPEED=new Uint8Array([71,73,70,56,57,97,2,0,2,0,240,0,0,0,0,0,255,255,255,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,249,4,0,25,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,12,94,0,33,249,4,0,50,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,68,0,5,0,33,249,4,0,100,0,0,0,44,0,0,0,0,2,0,2,0,0,2,2,132,83,0,33,249,4,0,200,0,0,0,44,0,0,0,0,2,0,2,0,0,2,3,4,2,5,0,59]),a.GIF_D1_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,5,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59]),a.GIF_D3_D3_D3_D3=new Uint8Array([71,73,70,56,57,97,4,0,4,0,240,0,0,0,0,0,255,0,0,33,249,4,13,100,0,0,0,33,255,11,78,69,84,83,67,65,80,69,50,46,48,3,1,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,0,2,5,76,0,134,203,80,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,255,0,2,5,4,18,134,198,92,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,0,0,255,2,5,132,143,17,166,5,0,33,249,4,13,100,0,0,0,33,255,11,73,109,97,103,101,77,97,103,105,99,107,13,103,97,109,109,97,61,48,46,52,53,52,53,53,0,44,0,0,0,0,4,0,4,0,128,0,0,0,255,0,255,2,5,132,111,17,185,80,0,59])))(xc||(xc={}));var yK=new ys(1/.05,1),TK=Ga.withDampingRatio(.5,100,1.1);var Ig;(t=>{function g(n,r){return n(r)}t.call=g;function e(n){return n}t._new=e})(Ig||(Ig={}));var Pu;(r=>{function g(){let o=AssertLib.deepEqual;beforeEach(()=>{Q.setViewerMode(Q.ViewerMode.PROTOTYPE)}),Ut("Drag vector computation:",()=>{Ee("Smart animate drag - matched object with translation",()=>{t([(i,a,s,c)=>{let l=de(s,"rect");l.setRelativeTransform(new ee(1,0,30,0,1,50)),de(c,"rect").setRelativeTransform(new ee(1,0,130,0,1,250));let d=Ln(l,c,"DRAG","SMART_ANIMATE","NAVIGATE"),h=mn.computeDragVector1(l,d,s,i.prototypeStructure(),i.prototypeState());o(h,new I(100,200))}])}),Ee("Smart animate drag - matched object with translation, rotation, and resizing",()=>{t([(i,a,s,c)=>{let l=de(s,"rect");l.setSize(new I(100,100)),l.setRelativeTransform(ee.new2().translatedBy1(l.size().negative().divide(2)));let u=de(c,"rect");u.setSize(new I(200,100));let d=ee.new2().translatedBy1(u.size().negative().divide(2));d.postRotate(Pe.Math_PI()/2),d.postTranslate(new I(100,200)),u.setRelativeTransform(d);let h=Ln(l,c,"DRAG","SMART_ANIMATE","NAVIGATE"),S=mn.computeDragVector1(l,h,s,i.prototypeStructure(),i.prototypeState());o(S,new I(100,200))}])}),Ee("Smart animate drag - no matches",()=>{t([(i,a,s,c)=>{let l=de(s,"rect");l.setRelativeTransform(new ee(1,0,30,0,1,50));let u=Ln(l,c,"DRAG","SMART_ANIMATE","NAVIGATE"),d=mn.computeDragVector1(l,u,s,i.prototypeStructure(),i.prototypeState());o(d,null)}])}),Ee("Smart animate drag - overlay swap with matched object with translation",()=>{t([(i,a,s,c)=>{let l=a.root().childAt1(0),u=ct(l,"overlayA"),d=ct(l,"overlayB"),h=de(u,"rect");h.setRelativeTransform(new ee(1,0,30,0,1,50)),de(d,"rect").setRelativeTransform(new ee(1,0,130,0,1,250));let f=Ln(h,d,"DRAG","SMART_ANIMATE","SWAP");Ln(s,u,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let y=mn.computeDragVector1(h,f,s,i.prototypeStructure(),i.prototypeState());o(y,new I(100,200))}])}),Ee("Smart animate drag - overlay swap with no matches",()=>{t([(i,a,s,c)=>{let l=a.root().childAt1(0),u=ct(l,"overlayA"),d=ct(l,"overlayB"),h=de(u,"rect");h.setRelativeTransform(new ee(1,0,30,0,1,50));let S=Ln(h,d,"DRAG","SMART_ANIMATE","SWAP");Ln(s,u,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY");let f=mn.computeDragVector1(h,S,s,i.prototypeStructure(),i.prototypeState());o(f,null)}])}),Ee("Move in smart animate drag - matched object with translation",()=>{t([(i,a,s,c)=>{let l=de(s,"rect");l.setRelativeTransform(new ee(1,0,30,0,1,50)),de(c,"rect").setRelativeTransform(new ee(1,0,130,0,1,250));let d=tc(l,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),h=mn.computeDragVector1(l,d,s,i.prototypeStructure(),i.prototypeState());o(h,new I(100,200))}])}),Ee("Move in smart animate drag - no matches",()=>{t([(i,a,s,c)=>{let l=de(s,"rect");l.setRelativeTransform(new ee(1,0,30,0,1,50));let u=tc(l,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE",!0),d=_t.get("MOVE_FROM_LEFT").enteringFrameTransition(),h=c.size().multiply1(d.to().translation1().subtract1(d.from().translation1())),S=mn.computeDragVector1(l,u,s,i.prototypeStructure(),i.prototypeState());o(S,h)}])}),Ee("Screen swipe drag - nested node move in transition",()=>{t([(i,a,s,c)=>{let l=de(s,"rect");l.setRelativeTransform(new ee(1,0,30,0,1,50));let u=Ln(l,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),d=_t.get("MOVE_FROM_LEFT").enteringFrameTransition(),h=c.size().multiply1(d.to().translation1().subtract1(d.from().translation1())),S=mn.computeDragVector1(l,u,s,i.prototypeStructure(),i.prototypeState());o(S,h)}])}),Ee("Screen swipe drag - nested node move out transition",()=>{t([(i,a,s,c)=>{let l=de(s,"rect");l.setRelativeTransform(new ee(1,0,30,0,1,50));let u=Ln(l,c,"DRAG","MOVE_OUT_TO_LEFT","NAVIGATE"),d=_t.get("MOVE_OUT_TO_LEFT").exitingFrameTransition(),h=s.size().multiply1(d.to().translation1().subtract1(d.from().translation1())),S=mn.computeDragVector1(l,u,s,i.prototypeStructure(),i.prototypeState());o(S,h)}])}),Ee("Screen swipe drag - TLF move in transition",()=>{t([(i,a,s,c)=>{let l=Ln(s,c,"DRAG","MOVE_FROM_LEFT","NAVIGATE"),u=_t.get("MOVE_FROM_LEFT").enteringFrameTransition(),d=c.size().multiply1(u.to().translation1().subtract1(u.from().translation1())),h=mn.computeDragVector1(s,l,s,i.prototypeStructure(),i.prototypeState());o(h,d)}])}),Ee("Back screen swipe drag - TLF was opened by move in",()=>{t([(i,a,s,c)=>{Ln(s,c,"ON_CLICK","MOVE_FROM_LEFT","NAVIGATE"),nc(c),rc(c,"DRAG");let l=s.prototypeInteractions()[0],u=l.action().value;i.scene().setAllTlfsLoaded(),i.prototypeState().navigateToFrameAndCloseOverlays1(s.id()),i.prototypeState().commitStateChange(),i.prototypeState().navigateToFrameAndCloseOverlays3(u.transitionNodeID(),i.baseScreenNode(),1,0,4,l,u),i.prototypeState().commitStateChange();let d=_t.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),h=c.size().multiply1(d.to().translation1().subtract1(d.from().translation1())),S=c.prototypeInteractions()[0],f=mn.computeDragVector1(c,S,c,i.prototypeStructure(),i.prototypeState());o(f,h)}])}),Ee("Overlay swipe drag - overlay move in transition",()=>{t([(i,a,s,c)=>{Ln(s,c,"DRAG","MOVE_FROM_LEFT","OVERLAY"),c.setSize(new I(250,250)),c.setOverlayPositionType("TOP_LEFT");let l=mn.computeDragVector1(s,s.prototypeInteractions()[0],s,i.prototypeStructure(),i.prototypeState());o(l,new I(c.size().x(),0))}])}),Ee("Overlay swipe drag - overlay move in transition with nested source",()=>{t([(i,a,s,c)=>{let l=de(s,"rect"),u=Ln(l,c,"DRAG","MOVE_FROM_LEFT","OVERLAY");c.setSize(new I(250,250)),c.setOverlayPositionType("TOP_LEFT");let d=mn.computeDragVector1(l,u,s,i.prototypeStructure(),i.prototypeState());o(d,new I(c.size().x(),0))}])}),Ee("Close overlay swipe drag - overlay opened by move in",()=>{t([(i,a,s,c)=>{let l=a.root().childAt1(0),u=ct(l,"overlayA");u.setSize(new I(250,250)),u.setOverlayPositionType("TOP_LEFT");let d=de(u,"rect");d.setRelativeTransform(new ee(1,0,30,0,1,50)),Ln(s,u,"ON_CLICK","MOVE_FROM_LEFT","OVERLAY"),Jd(d),rc(d,"DRAG"),i.scene().setAllTlfsLoaded(),i.prototypeState().navigateToFrameAndCloseOverlays1(s.id()),i.prototypeState().commitStateChange(),i.prototypeState().overlayFrame(u.id(),s,!1,0,0,s.prototypeInteractions()[0],null),i.prototypeState().commitStateChange();let h=_t.get("MOVE_FROM_LEFT").reversed().exitingFrameTransition(),S=u.size().multiply1(h.to().translation1().subtract1(h.from().translation1())),f=mn.computeDragVector1(d,d.prototypeInteractions()[0],s,i.prototypeStructure(),i.prototypeState());o(f,S)}])}),Ee("Overlay go back swipe drag - no back frame",()=>{t([(i,a,s,c)=>{c.setSize(new I(250,250)),c.setOverlayPositionType("TOP_LEFT"),Ln(s,c,"DRAG","MOVE_FROM_LEFT","OVERLAY"),nc(c),rc(c,"DRAG"),i.scene().setAllTlfsLoaded(),i.prototypeState().navigateToFrameAndCloseOverlays1(s.id()),i.prototypeState().commitStateChange(),i.prototypeState().overlayFrame(c.id(),s,!1,0,0,s.prototypeInteractions()[0],null),i.prototypeState().commitStateChange();let l=mn.computeDragVector1(c,c.prototypeInteractions()[0],s,i.prototypeStructure(),i.prototypeState());o(l,null)}])}),Ee("Drag - invalid navigate transition",()=>{t([(i,a,s,c)=>{Ln(s,c,"DRAG","DISSOLVE","NAVIGATE");let l=mn.computeDragVector1(s,null,s,i.prototypeStructure(),i.prototypeState());o(l,null)}])})}),Ut("Drag progress measurement:",()=>{let i=null;beforeEach(()=>{i=new oa,We.dangerouslyPushMockTime(i)}),afterEach(()=>{We.popMockTime()}),Ee("Simple drag velocity and progress measurement",()=>{t([(a,s,c,l)=>{let u=1e-14,d=AssertLib,h=(k,j,te)=>d(Math.abs(te-j)<=u,`Expected velocity at timestep ${k} to equal ${j}, got ${te}`);a.prototypeState().setIsDragging(!0);let S=new mn(null,new I(1,0),null,null);S.handleDragStart(new I(0,0)),S.handleDrag(new I(0,0));let f=S.onTickProgress();o(f,0),i.advanceSeconds(1),S.handleDrag(new I(.5,0));let y=S.onTickProgress();o(y,.5);let v=S.signedDragSpeed();h(1,.5,v),i.advanceSeconds(.5),S.handleDrag(new I(1,0));let b=S.onTickProgress();o(b,1);let m=S.signedDragSpeed();h(2,1,m),i.advanceSeconds(1);let p=S.onTickProgress();o(p,1);let _=S.signedDragSpeed();h(3,0,_),i.advanceSeconds(.1),S.handleDrag(new I(.5,0));let T=S.onTickProgress();o(T,.5);let N=S.signedDragSpeed();h(4,-5,N)}])}),Ee("Different-direction drag velocity and progress measurement",()=>{t([(a,s,c,l)=>{let u=1e-14,d=AssertLib,h=(T,N,k)=>d(Math.abs(k-N)<=u,`Expected velocity at timestep ${T} to equal ${N}, got ${k}`);a.prototypeState().setIsDragging(!0);let S=new mn(null,new I(1,0),null,null);S.handleDragStart(new I(0,0)),S.handleDrag(new I(0,0));let f=S.onTickProgress();o(f,0),i.advanceSeconds(1),S.handleDrag(new I(0,.5));let y=S.onTickProgress();o(y,0);let v=S.signedDragSpeed();h(1,0,v),i.advanceSeconds(1),S.handleDrag(new I(-.5,0));let b=S.onTickProgress();o(b,0);let m=S.signedDragSpeed();h(2,-.5,m),i.advanceSeconds(1),S.handleDrag(new I(.5,1));let p=S.onTickProgress();o(p,.5);let _=S.signedDragSpeed();h(3,1,_)}])})})}r.testDragToAnimateBehavior=g;function e(o){t(o.map(i=>(a,s,c,l)=>{i(c,l)}))}r.createNewSceneAndRun=e;function t(o){let i=new Nn(new rn),a=yt.createSceneWithCanvasForTests1(),s=a.root().childAt1(0),c=Mn(s,"source",E.BLACK);c.setRelativeTransform(new ee(1,0,0,0,1,400)),c.setSize(new I(500,700));let l=Mn(s,"dst",E.BLACK);l.setRelativeTransform(new ee(1,0,0,0,1,1100)),l.setSize(new I(500,700)),i.setActiveCanvas(s),i.setScene(a);for(let u of o)u(i,a,c,l)}r.createNewAppStateAndSceneAndRun=t;function n(){let o=AssertLib.deepStrictEqual,i=new wa("./src/test/protomagicmove.test.sk");beforeEach(()=>{Q.setViewerMode(Q.ViewerMode.PROTOTYPE)}),Ut("getNodeMatches",()=>{let a=(s,c,l)=>{let u=_r.getNodeMatches(s,c);for(let d of l){let h=d[0],S=d[1],f=Me.StringMap_get(u,R.toString(h.id()),null),y=Me.StringMap_get(u,R.toString(S.id()),null);o(f,S,`Expected ${R.toString(h.id())} to match ${R.toString(S.id())}, but got ${f==null?null:R.toString(f.id())} instead.`),o(y,h,`Expected ${R.toString(S.id())} to match ${R.toString(h.id())}, but got ${y==null?null:R.toString(y.id())} instead.`)}o(u.size,l.length*2)};Ee("simple match case",()=>{let c=yt.createSceneWithCanvasForTests1().root().childAt1(0),l=ct(c,"src"),u=rt(l,"A"),d=rt(l,"B"),h=rt(l,"C"),S=ct(c,"dst"),f=rt(S,"A"),y=rt(S,"B"),v=rt(S,"C");a(l,S,[[u,f],[d,y],[h,v]])}),Ee("crossed match case",()=>{let c=yt.createSceneWithCanvasForTests1().root().childAt1(0),l=ct(c,"src"),u=rt(l,"A"),d=rt(l,"B"),h=ct(c,"dst"),S=rt(h,"B"),f=rt(h,"A");a(l,h,[[u,f],[d,S]])}),Ee("duplicate names",()=>{let c=yt.createSceneWithCanvasForTests1().root().childAt1(0),l=ct(c,"src"),u=rt(l,"A"),d=rt(l,"A");rt(l,"A");let h=ct(c,"dst"),S=rt(h,"A"),f=rt(h,"A");a(l,h,[[u,S],[d,f]])}),Ee("recursive matches",()=>{let c=yt.createSceneWithCanvasForTests1().root().childAt1(0),l=ct(c,"src"),u=ct(c,"dst"),d=rt(l,"A"),h=rt(d,"A"),S=rt(d,"B"),f=rt(l,"B");rt(f,"A"),rt(f,"B");let y=rt(l,"C");rt(y,"A"),rt(y,"B");let v=rt(u,"A"),b=rt(v,"A"),m=rt(v,"B"),p=rt(u,"B");rt(p,"C"),rt(p,"D");let _=rt(u,"D");rt(_,"A"),rt(_,"B"),a(l,u,[[d,v],[h,b],[S,m],[f,p]])}),Ee("hidden and transparent nodes",()=>{let c=yt.createSceneWithCanvasForTests1().root().childAt1(0),l=ct(c,"src"),u=rt(l,"A");rt(l,"B");let d=rt(l,"C"),h=rt(l,"D");u.setVisible(!1),d.setOpacity(0);let S=ct(c,"dst");rt(S,"A");let f=rt(S,"B"),y=rt(S,"C"),v=rt(S,"D");f.setVisible(!1),h.setOpacity(0),a(l,S,[[d,y],[h,v]])}),Ee("boolean op nodes",()=>{let c=yt.createSceneWithCanvasForTests1().root().childAt1(0),l=ct(c,"src"),u=es(l);u.setName("booleanOp"),rt(u,"A"),rt(u,"B");let d=ct(c,"dst"),h=es(d);h.setName("booleanOp"),rt(h,"A"),rt(h,"B"),a(l,d,[[u,h]])})}),Ee("Smart animate of fixed elements",()=>{let a=new I(100,100),s=new I(10,10),c=new Nn(new rn),l=yt.createSceneWithCanvasForTests1(),u=l.root().childAt1(0);u.setPrototypeDevice(new Xn("CUSTOM",a,null,"NONE")),u.setCurrentViewportSize(a),c.setActiveCanvas(u),c.setScene(l);let d=(y,v)=>{let b=mt(u);b.setSize(new I(y,v)),b.setUsedAsBaseScreen(!0);let m=Cr(b);return m.setSize(new I(10,10)),m.setRelativeTransform(new ee(1,0,0,0,1,v-s.y())),m.setVerticalConstraint("MAX"),m.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),b},h=d(100,200),S=d(100,100);ts(h,S);let f=pa.buildStrategy(h.childAt1(0),S.childAt1(0));o(f.transition.from().transform1().translation().y(),a.y()-s.y()),o(f.transition.to().transform1().translation().y(),a.y()-s.y())}),Ut("interpolation strategies",()=>{let a=(s,c)=>{let l=pa.buildStrategy(s,c);l.isDissolve};Ee("dissolve discrete properties",()=>{[(c,l)=>{let u=de(c,"A");u.setBlendMode("NORMAL");let d=de(l,"A");d.setBlendMode("MULTIPLY"),a(u,d)},(c,l)=>{let u=Om(c,"B"),d=de(l,"B");a(u,d)},(c,l)=>{let u=Mn(c,"C",E.TRANSPARENT);de(u,"C_content");let d=Ni(l,"C");de(d,"C_content"),a(u,d)},(c,l)=>{c.setOverflowDirection("VERTICAL"),l.setOverflowDirection("VERTICAL");let u=de(c,"D");u.setScrollBehavior("SCROLLS");let d=de(l,"D");d.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),a(u,d)}].forEach(c=>{e([c])})}),Ee("interpolate effects and paints",()=>{let s=ne.createLinearGradient([new lt(E.RED,0),new lt(E.TRANSPARENT,.5)]);[(l,u)=>{let d=oc(l,"A",[s]),h=de(u,"A");a(d,h)},(l,u)=>{let d=de(l,"B");d.setTestOnlyEffects1([]);let h=de(u,"B");h.setTestOnlyEffects1([we.createForegroundBlur(1)]),a(d,h)},(l,u)=>{let d=de(l,"C");d.setTestOnlyEffects1([we.createForegroundBlur(1)]);let h=de(u,"C");h.setTestOnlyEffects1([we.createDropShadow1(1,new I(1,1),E.BLACK,1)]),a(d,h)},(l,u)=>{let d=de(l,"D"),h=[we.createForegroundBlur(1),we.createDropShadow1(1,new I(1,1),E.BLACK,1)];d.setTestOnlyEffects1(h);let S=de(u,"D"),f=h.slice();f[0].setIsEnabled(!1),S.setTestOnlyEffects1(f),a(d,S)},(l,u)=>{let d=de(l,"E"),h=[s,ne.createSolid(E.RED,1)];d.setTestOnlyFillPaints3(h);let S=de(u,"E"),f=h.slice();f[0].setIsEnabled(!1),S.setTestOnlyFillPaints3(f),a(d,S)}].forEach(l=>{e([l])})}),Ee("interpolate geometry",()=>{let s=(l,u,d)=>{let h=rt(l,u);h.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]);let S=d.topLeft().x(),f=d.topLeft().y(),y=d.width(),v=d.height(),b=new Hn("NONZERO",0,vt.new2().moveTo1(S,f).lineTo(S+y,f).lineTo(S+y,f+v).lineTo(S,f+v-1).close(),d),m=new Dn([b],null,b.bounds(),null);return h.setTestOnlyFillPaints([ne.createSolid(E.RED,1)]),h.setTestOnlyFillGeometry(m),h.setTestOnlyStrokeGeometry(m),Ze(h,d.topLeft(),d.size()),h};[(l,u)=>{let d=s(l,"A",new B(0,0,100,100)),h=kt(u,"A",E.RED,1);a(d,h)}].forEach(l=>{e([l])})})}),Ut("magic move",()=>{let a=(u,d,h)=>{Pa(u,()=>{let S=[];return d.forEach(f=>{e([h,(y,v)=>{let b=new ee(1,0,0,0,1,1100-400),m=Nt.FrozenAffineTransform_IDENTITY,p=_r.getMagicMovePlan2(y,b,v,m,_t.get(f));S.push(i.asyncAssertMatchesSnapshot(`plan ${f}`,p.debugString()));let _=()=>0,T=new pr([0,0,1,1],.3),N=new _r.AnimationPlanCursor(p,_,T);S.push(i.asyncAssertMatchesSnapshot(`render tree ${f}`,N.renderTree().debugString1()))}])}),Promise.all(S)})},s=["DISSOLVE","SLIDE_FROM_RIGHT","PUSH_FROM_RIGHT","MOVE_FROM_RIGHT","SLIDE_OUT_TO_RIGHT","MOVE_OUT_TO_RIGHT"],c=["DISSOLVE","MOVE_FROM_RIGHT","MOVE_OUT_TO_RIGHT"],l=["DISSOLVE"];a("identical rectangles",l,(u,d)=>{de(u,"rect"),de(d,"rect")}),a("rectangles with different opacities",l,(u,d)=>{de(u,"rect").setOpacity(.9),de(d,"rect").setOpacity(.1)}),a("rectangles with changing and unchanging paints",l,(u,d)=>{oc(u,"rect",[ne.createSolid(E.RED,1),ne.createSolid(E.GREEN,1)]),oc(d,"rect",[ne.createSolid(E.BLUE,1),ne.createSolid(E.GREEN,1)])}),a("rectangles with different translations",l,(u,d)=>{de(u,"rect").setRelativeTransform(new ee(1,0,30,0,1,50)),de(d,"rect").setRelativeTransform(new ee(1,0,130,0,1,250))}),a("rectangles with different rotation",l,(u,d)=>{let h=de(u,"rect");h.setRelativeTransform(new ee(1,0,30,0,1,50));let S=de(d,"rect"),f=ee.new3(h.relativeTransform());f.rotatedBy(Pe.Math_PI()/4),S.setRelativeTransform(f)}),a("rectangles with different scale",l,(u,d)=>{let h=de(u,"rect");h.setRelativeTransform(new ee(1,0,30,0,1,50));let S=de(d,"rect"),f=ee.new3(h.relativeTransform());f.scaledBy1(new I(2,3)),S.setRelativeTransform(f)}),a("insertion of new rectangle",l,(u,d)=>{de(d,"rect")}),a("deletion of old rectangle",l,(u,d)=>{de(u,"rect")}),a("rectangles with mismatched names",l,(u,d)=>{de(u,"A"),de(d,"B")}),a("hidden and never-visible rectangles",l,(u,d)=>{let h=de(u,"hidden"),S=de(u,"neverVisible");h.setVisible(!1),S.setOpacity(0);let f=de(d,"hidden"),y=de(d,"neverVisible");f.setVisible(!1),y.setOpacity(0)}),a("hidden and transparent and no match nodes to visible nodes",l,(u,d)=>{let h=de(u,"hidden"),S=de(u,"transparent");h.setVisible(!1),S.setOpacity(0),de(d,"hidden"),de(d,"transparent"),de(d,"noMatch")}),a("visible nodes to hidden and transparent and no match nodes",l,(u,d)=>{de(u,"hidden"),de(u,"transparent"),de(u,"noMatch");let h=de(d,"hidden"),S=de(d,"transparent");h.setVisible(!1),S.setOpacity(0)}),a("matching boolean op nodes",l,(u,d)=>{let h=es(u);h.setName("booleanOp"),rt(h,"A"),rt(h,"B");let S=es(d);S.setName("booleanOp"),rt(S,"A"),rt(S,"B")}),a("simple matching with layer re-ordering",l,(u,d)=>{de(u,"A"),de(u,"B"),de(d,"B"),de(d,"A")}),a("simple insertion, deletion, and matching",s,(u,d)=>{de(u,"A"),de(u,"B"),de(d,"C"),de(d,"B")}),a("complex layer re-ordering with insertions and removals",c,(u,d)=>{de(u,"A"),de(u,"B"),de(u,"C"),de(u,"D"),de(u,"E"),de(u,"F"),de(u,"G"),de(u,"H"),de(d,"1"),de(d,"2"),de(d,"F"),de(d,"3"),de(d,"4"),de(d,"C"),de(d,"5"),de(d,"6")}),a("complex matching case with no nesting",l,(u,d)=>{de(u,"A"),de(u,"B"),de(u,"C"),de(u,"E"),de(d,"X"),de(d,"Y"),de(d,"B"),de(d,"Z"),de(d,"E"),de(d,"F")}),a("simple nested matching",l,(u,d)=>{let h=ct(u,"F");ct(h,"rect");let S=ct(d,"F");ct(S,"rect").setOpacity(.5)}),a("nested insertions/removals",c,(u,d)=>{let h=ct(u,"A");de(h,"rectA");let S=ct(d,"B");de(S,"rectB")}),a("dissolving between different sized objects",l,(u,d)=>{de(u,"A").setSize(new I(100,100)),de(d,"A").setSize(new I(200,200))}),a("dissolving between non-uniformly scaling frames with children",l,(u,d)=>{let h=ct(u,"A");h.setSize(new I(150,1)),kt(h,"rect",E.RED,1).setSize(new I(100,100)),kt(h,"rect",E.RED,1).setSize(new I(100,100));let y=ct(d,"A");y.setSize(new I(300,300)),kt(y,"rect",E.RED,1).setSize(new I(100,100)),kt(y,"rect",E.RED,1).setSize(new I(100,100))}),a("dissolving between background blur objects",l,(u,d)=>{kt(u,"A",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)]),kt(d,"A",E.BLUE,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)])}),a("dissolving between background blur objects with a background blur behind",l,(u,d)=>{kt(u,"BG",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)]),kt(d,"BG",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)]),kt(u,"A",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)]),kt(d,"A",E.BLUE,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)])}),a("translating a background blur contained in a frame with clip-content enabled",l,(u,d)=>{let h=ct(u,"A");h.setIsFrameMaskDisabled(!0);let S=ct(h,"B");kt(S,"BG",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)]);let y=ct(d,"A");y.setIsFrameMaskDisabled(!0);let v=ee.new3(y.relativeTransform());v.translatedBy2(10,10),y.setRelativeTransform(v);let b=ct(y,"B");kt(b,"BG",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)])}),a("translating a node with a background blur",l,(u,d)=>{kt(u,"BG",E.RED,.5).setTestOnlyEffects1([we.createBackgroundBlur(1)]);let S=kt(d,"BG",E.RED,.5);S.setTestOnlyEffects1([we.createBackgroundBlur(1)]);let f=ee.new3(S.relativeTransform());f.translatedBy2(10,10),S.setRelativeTransform(f)}),a("dissolving + scaling between nodes with unmatched children",l,(u,d)=>{let h=Mn(u,"F",E.RED);h.setSize(new I(100,100)),de(h,"rect"),ct(d,"F").setSize(new I(200,200))}),a("dissolve only between nodes with unmatched children",l,(u,d)=>{let h=Mn(u,"F",E.RED);h.setSize(new I(100,100)),de(h,"rect"),vm(d,"F").setSize(new I(100,100))}),a("dissolving between visible top frame to invisibile top frame",l,(u,d)=>{let h=new ne("SOLID");h.setColor(E.RED),h.setOpacity(1),h.setIsEnabled(!0),u.setTestOnlyFillPaints3([h]),h.setOpacity(0),d.setTestOnlyFillPaints3([h])}),a("dissolving between different opacity objects",l,(u,d)=>{let h=de(u,"A");h.setOpacity(1),h.setBlendMode("MULTIPLY");let S=de(d,"A");S.setOpacity(.5),S.setBlendMode("NORMAL")}),a("dissolving between invisible node to visible node",l,(u,d)=>{kt(u,"A",E.RED,0),kt(d,"A",E.BLUE,.5)}),a("interpolating between two solid color paints",l,(u,d)=>{kt(u,"A",E.RED,1),kt(d,"A",E.BLUE,1)}),a("drop shadow: node rotates",l,(u,d)=>{let h=de(u,"rect");h.setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]),h.setRelativeTransform(new ee(1,0,30,0,1,50));let S=de(d,"rect");S.setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]);let f=ee.new3(h.relativeTransform());f.rotatedBy(Pe.Math_PI()/4),S.setRelativeTransform(f)}),a("inner shadow: node rotates",l,(u,d)=>{let h=de(u,"rect");h.setTestOnlyEffects1([we.createInnerShadow(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]),h.setRelativeTransform(new ee(1,0,30,0,1,50));let S=de(d,"rect");S.setTestOnlyEffects1([we.createInnerShadow(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]);let f=ee.new3(h.relativeTransform());f.rotatedBy(Pe.Math_PI()/4),S.setRelativeTransform(f)}),a("drop shadow: group shadow where group rotates and children are static",l,(u,d)=>{let h=Mn(u,"F",E.TRANSPARENT);h.setIsBackgroundEnabled(!1),de(h,"rectA").setRelativeTransform(ee.new2()),de(h,"rectB").setRelativeTransform(new ee(1,0,50,0,1,0)),h.setRelativeTransform(new ee(1,0,30,0,1,50)),h.setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]);let y=Mn(d,"F",E.TRANSPARENT);y.setIsBackgroundEnabled(!1),de(y,"rectA").setRelativeTransform(ee.new2()),de(y,"rectB").setRelativeTransform(new ee(1,0,50,0,1,0));let m=ee.new3(h.relativeTransform());m.rotatedBy(Pe.Math_PI()/4),y.setRelativeTransform(m),y.setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)])}),a("drop shadow: group shadow where group is static and children rotate",l,(u,d)=>{let h=Mn(u,"F",E.TRANSPARENT);h.setIsBackgroundEnabled(!1),de(h,"rectA").setRelativeTransform(ee.new2()),de(h,"rectB").setRelativeTransform(new ee(1,0,50,0,1,0)),h.setRelativeTransform(new ee(1,0,30,0,1,50)),h.setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]);let y=Mn(d,"F",E.TRANSPARENT);y.setIsBackgroundEnabled(!1);let v=de(y,"rectA");v.setRelativeTransform(ee.new2());let b=de(y,"rectB");b.setRelativeTransform(new ee(1,0,50,0,1,0));let m=ee.new3(v.relativeTransform());m.rotatedBy(Pe.Math_PI()/4),v.setRelativeTransform(m);let p=ee.new3(b.relativeTransform());p.rotatedBy(Pe.Math_PI()/4),b.setRelativeTransform(p),y.setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)])}),a("drop shadow: complex group shadow with nested groups and mixed transitions",l,(u,d)=>{let h=Mn(u,"staticGroup1",E.TRANSPARENT);h.setIsBackgroundEnabled(!1),h.setRelativeTransform(new ee(1,0,30,0,1,50)),h.setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]),de(h,"staticRectZ").setRelativeTransform(ee.new2());let f=Mn(h,"rotatingGroup2",E.TRANSPARENT);f.setIsBackgroundEnabled(!1),de(f,"rotatingRectA").setRelativeTransform(ee.new2()),de(f,"staticRectB").setRelativeTransform(new ee(1,0,50,0,1,0));let b=Mn(d,"staticGroup1",E.TRANSPARENT);b.setIsBackgroundEnabled(!1),b.setRelativeTransform(new ee(1,0,30,0,1,50)),b.setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]),de(b,"staticRectZ").setRelativeTransform(ee.new2());let p=Mn(b,"rotatingGroup2",E.TRANSPARENT);p.setIsBackgroundEnabled(!1),p.setRelativeTransform(ee.new2().rotatedBy(Pe.Math_PI()/4)),de(p,"rotatingRectA").setRelativeTransform(ee.new2().rotatedBy(Pe.Math_PI()/3)),de(p,"staticRectB").setRelativeTransform(new ee(1,0,50,0,1,0))}),a("inner shadow: complex group shadow with nested groups and mixed transitions",l,(u,d)=>{let h=Mn(u,"staticGroup1",E.TRANSPARENT);h.setIsBackgroundEnabled(!1),h.setRelativeTransform(new ee(1,0,30,0,1,50)),h.setTestOnlyEffects1([we.createInnerShadow(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]),de(h,"staticRectZ").setRelativeTransform(ee.new2());let f=Mn(h,"rotatingGroup2",E.TRANSPARENT);f.setIsBackgroundEnabled(!1),de(f,"rotatingRectA").setRelativeTransform(ee.new2()),de(f,"staticRectB").setRelativeTransform(new ee(1,0,50,0,1,0));let b=Mn(d,"staticGroup1",E.TRANSPARENT);b.setIsBackgroundEnabled(!1),b.setRelativeTransform(new ee(1,0,30,0,1,50)),b.setTestOnlyEffects1([we.createInnerShadow(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]),de(b,"staticRectZ").setRelativeTransform(ee.new2());let p=Mn(b,"rotatingGroup2",E.TRANSPARENT);p.setIsBackgroundEnabled(!1),p.setRelativeTransform(ee.new2().rotatedBy(Pe.Math_PI()/4)),de(p,"rotatingRectA").setRelativeTransform(ee.new2().rotatedBy(Pe.Math_PI()/3)),de(p,"staticRectB").setRelativeTransform(new ee(1,0,50,0,1,0))}),a("drop shadow: no node change but parent rotates",l,(u,d)=>{let h=ct(u,"F");de(h,"rect").setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]),h.setRelativeTransform(new ee(1,0,30,0,1,50));let f=de(d,"F");de(f,"rect").setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]);let v=ee.new3(h.relativeTransform());v.rotatedBy(Pe.Math_PI()/4),f.setRelativeTransform(v)}),a("drop shadow: no node change but parent translates/resizes",l,(u,d)=>{let h=ct(u,"F");de(h,"rect").setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]),h.setRelativeTransform(new ee(1,0,30,0,1,50)),h.setSize(new I(100,100));let f=ct(d,"F");de(f,"rect").setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]);let v=ee.new3(h.relativeTransform());v.translate1(ye.FrozenVector_new4(1,1)),f.setRelativeTransform(v),f.setSize(new I(100,200))}),a("transition between scrolling frames",c,(u,d)=>{u.setOverflowDirection("VERTICAL"),u.setTestOnlyFillPaints([ne.createSolid(E.RED,1)]),u.setTestOnlyEffects1([we.createDropShadow1(1,new I(1,1),E.BLACK,1)]),d.setTestOnlyFillPaints([ne.createSolid(E.BLUE,1)]),d.setTestOnlyEffects1([we.createDropShadow1(1,new I(1,1),E.BLACK,1)]);let h=kt(u,"rect",E.GREEN,1);h.setSize(new I(u.size().x(),u.size().y()+100)),kt(d,"rect",E.GREEN,1).setSize(h.size())}),a("scaling nodes whose children have different scaling factors",l,(u,d)=>{let h=ct(u,"subframe");h.setSize(new I(100,100)),de(h,"rect").setSize(new I(50,50));let f=ct(d,"subframe");f.setSize(new I(200,200)),de(f,"rect").setSize(new I(50,50))}),a("deeply nested scaling nodes whose children have different scaling factors",l,(u,d)=>{let h=ct(u,"A");h.setSize(new I(100,100));let S=Mn(h,"B",E.RED);S.setSize(new I(50,50)),Mn(S,"C",E.BLACK).setSize(new I(10,10));let y=ct(d,"A");y.setSize(new I(200,200));let v=de(y,"B");v.setSize(new I(50,50)),Mn(v,"C",E.BLACK).setSize(new I(10,10))}),a("transition between two screens with masks",l,(u,d)=>{let h=de(u,"mask");h.setSize(new I(50,50)),h.setIsMask(!0),de(u,"color").setSize(new I(100,100)),rt(d,"andrew");let f=de(d,"mask");f.setRelativeTransform(new ee(1,0,10,0,1,10)),f.setSize(new I(50,50)),f.setIsMask(!0),de(d,"color").setSize(new I(100,100))}),a("MOVE_IN with unmatched layers nested inside of matched layers",["MOVE_FROM_RIGHT"],(u,d)=>{let h=ct(u,"A");kt(h,"A_1",E.BLUE,1);let S=ct(d,"A");kt(S,"A_2",E.GREEN,1)}),a("MOVE_IN with unmatched layers nested inside of matched fixed layers",["MOVE_FROM_RIGHT"],(u,d)=>{let h=ct(u,"A");h.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),kt(h,"A_1",E.BLUE,1);let S=ct(d,"A");kt(S,"A_2",E.GREEN,1)}),a("dissolving image fills with different geometries should separate into masks",l,(u,d)=>{Zd(u,"tri",new I(100,100)),Zd(d,"tri",new I(50,100))}),a("dissolving non-image fills with different geometries should NOT separate into masks",l,(u,d)=>{Qd(u,"rect",E.RED,1,new I(100,100)),Qd(d,"rect",E.GREEN,1,new I(50,100))}),Pa("non-image rects with different geometries interpolate rounded rectangle parameters",()=>{let u=[];return l.forEach(d=>{e([(h,S)=>{Nr(h,"rect",E.RED,1,new I(100,100)),Nr(S,"rect",E.GREEN,1,new I(50,100));let f=new ee(1,0,0,0,1,1100-400),y=Nt.FrozenAffineTransform_IDENTITY,v=_r.getMagicMovePlan2(h,f,S,y,_t.get(d));u.push(i.asyncAssertMatchesSnapshot(`plan ${d}`,v.debugString()));let b=()=>0,m=new pr([0,0,1,1],.3),p=new _r.AnimationPlanCursor(v,b,m);u.push(i.asyncAssertMatchesSnapshot(`render tree ${d}`,p.renderTree().debugString1()))}])}),Promise.all(u)}),Pa("non-image rects with different geometries and different effect spreads interpolate rounded rectangle + effect parameters",()=>{let u=[];return l.forEach(d=>{e([(h,S)=>{Nr(h,"rect",E.RED,1,new I(100,100)).setTestOnlyEffects1([we.createDropShadow2(1,new I(5,5),E.BLACK,.5,10)]),Nr(S,"rect",E.GREEN,1,new I(50,100)).setTestOnlyEffects1([we.createDropShadow2(1,new I(5,5),E.BLACK,.5,10)]);let v=new ee(1,0,0,0,1,1100-400),b=Nt.FrozenAffineTransform_IDENTITY,m=_r.getMagicMovePlan2(h,v,S,b,_t.get(d));u.push(i.asyncAssertMatchesSnapshot(`plan ${d}`,m.debugString()));let p=()=>0,_=new pr([0,0,1,1],.3),T=new _r.AnimationPlanCursor(m,p,_);u.push(i.asyncAssertMatchesSnapshot(`render tree ${d}`,T.renderTree().debugString1()))}])}),Promise.all(u)}),a("dissolving image rects with different geometries: render good-enough identical shadows for now",l,(u,d)=>{let h=[we.createDropShadow1(1,new I(5,5),E.BLACK,.5)];Ks(u,"rect",new I(100,100)).setTestOnlyEffects1(h),Ks(d,"rect",new I(50,100)).setTestOnlyEffects1(h)}),a("dissolving image rects with different geometries: non-identical shadows fall back to dissolve for now",l,(u,d)=>{Ks(u,"rect",new I(100,100)).setTestOnlyEffects1([we.createDropShadow1(1,new I(5,5),E.BLACK,.5)]),Ks(d,"rect",new I(50,100)).setTestOnlyEffects1([we.createDropShadow1(5,new I(5,5),E.BLACK,.5)])}),a("groups with drop shadows and moving children",l,(u,d)=>{let h=Ni(u,"G");Nr(h,"A",E.RED,1,new I(10,10)),Nr(h,"B",E.GREEN,1,new I(10,10)),h.setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]);let S=Ni(d,"G");S.setTestOnlyEffects1([we.createDropShadow1(1,ye.FrozenVector_new4(1,1),E.BLACK,.5)]),Nr(S,"A",E.RED,1,new I(10,10)).setRelativeTransform(new ee(1,0,20,0,1,30)),Nr(S,"B",E.GREEN,1,new I(10,10)).setRelativeTransform(new ee(1,0,50,0,1,100))}),a("resizing resize-to-fit-groups without background paints",l,(u,d)=>{let h=Ni(u,"G");Nr(h,"A",E.RED,1,new I(10,10)).setRelativeTransform(new ee(1,0,0,0,1,0)),Nr(h,"B",E.GREEN,1,new I(10,10)).setRelativeTransform(new ee(1,0,10,0,1,30)),h.setSize(new I(20,40));let y=Ni(d,"G");Nr(y,"A",E.RED,1,new I(10,10)).setRelativeTransform(new ee(1,0,0,0,1,0)),Nr(y,"B",E.GREEN,1,new I(10,10)).setRelativeTransform(new ee(1,0,20,0,1,30)),y.setSize(new I(30,40))}),a("resizing resize-to-fit-groups with background paints",l,(u,d)=>{let h=[ne.createSolid(E.RED,1)],S=Ni(u,"G");S.setTestOnlyFillPaints(h),Nr(S,"A",E.RED,1,new I(10,10)).setRelativeTransform(new ee(1,0,0,0,1,0)),Nr(S,"B",E.GREEN,1,new I(10,10)).setRelativeTransform(new ee(1,0,10,0,1,30)),S.setSize(new I(20,40));let v=Ni(d,"G");v.setTestOnlyFillPaints(h),Nr(v,"A",E.RED,1,new I(10,10)).setRelativeTransform(new ee(1,0,0,0,1,0)),Nr(v,"B",E.GREEN,1,new I(10,10)).setRelativeTransform(new ee(1,0,20,0,1,30)),v.setSize(new I(30,40))}),a("transition between symbols with new frame properties",l,(u,d)=>{u.setType("SYMBOL"),u.setContainerSupportsFillStrokeAndCorners(!0),u.setTestOnlyFillPaints(u.fillPaints()),d.setType("SYMBOL"),d.setContainerSupportsFillStrokeAndCorners(!0),d.setTestOnlyFillPaints([ne.createSolid(E.RED,1)])}),a("Smart animate frames with reverse z-index",["SMART_ANIMATE"],(u,d)=>{let h=S=>{S.setStackReverseZIndex(!0),S.setStackMode("HORIZONTAL");let f=kt(S,"A",E.RED,.5);f.setSize(new I(20,20)),f.setRelativeTransform(new ee(1,0,0,0,1,0));let y=kt(S,"B",E.BLUE,.5);y.setSize(new I(20,20)),y.setRelativeTransform(new ee(1,0,10,0,1,0))};h(u),h(d)})})}r.testMagicMove=n})(Pu||(Pu={}));var Fu;(S=>{function g(){let f=AssertLib.deepStrictEqual;Ee("Reparenting a node should invalidate render trees on both its old and its new parent",()=>{let v=yt.createSceneWithCanvasForTests1().root().childAt1(0),b=mt(v),m=mt(v),p=i(b,d.FILL,new B(0,0,100,100)),_=b.renderTree1(),T=m.renderTree1();f(_!=null,!0),f(T!=null,!0),p.setParentIndex(new kn(R.invalid(),sn.fromString(""))),m.appendChild(p);let N=b.renderTree1(),k=m.renderTree1();f(N!=_,!0),f(k!=T,!0)})}S.testNodeRenderTree=g;function e(f,y){let v=new Hn("NONZERO",0,vt.forCenterStrokeAroundRect(f,y),f);return new Dn([v],null,v.bounds(),null)}S.strokeGeometryForRect=e;function t(f,y){if(Math.abs(E.redF(f)-E.redF(y))+Math.abs(E.greenF(f)-E.greenF(y))+Math.abs(E.blueF(f)-E.blueF(y))+Math.abs(E.alphaF(f)-E.alphaF(y))>.01)throw new Error(`Colors are too different ${E.toString(f)} ${E.toString(y)}`)}S.assertColorRoughlyEquals=t;function n(f,y,v){let b=Im(f);return b.setTestOnlyFillPaints([ne.createSolid(E.BLACK,v)]),b.setTestOnlyFillGeometry(Nm(y)),Ze(b,b.fillGeometry().bounds.topLeft(),b.fillGeometry().bounds.size()),b}S.createStaticVectorWithMultipleRegions=n;function r(f,y,v,b){f.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),h.GeometryType_hasFill(y)&&f.setTestOnlyFillGeometry(Do(v)),h.GeometryType_hasStroke(y)&&(f.setTestOnlyStrokeGeometry(e(v,b)),f.setStrokeWeight(b)),Ze(f,v.topLeft(),v.size())}S.addPaintsAndGeometry=r;function o(f,y,v,b){let m=Cr(f);return r(m,y,v,b),m}S.createRectangleWithPaintsAndGeometry1=o;function i(f,y,v){return o(f,y,v,1)}S.createRectangleWithPaintsAndGeometry2=i;function a(f,y,v,b,m){let p=Am(f,y);return r(p,v,b,m),p}S.createRoundedRectangleWithPaintsAndGeometry1=a;function s(f,y,v,b){return a(f,y,v,b,1)}S.createRoundedRectangleWithPaintsAndGeometry2=s;function c(f,y){let v=Cr(f);v.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]);let b=y.topLeft().x(),m=y.topLeft().y(),p=y.width(),_=y.height(),T=new Hn("NONZERO",0,vt.new2().moveTo1(b,m).lineTo(b+p,m).lineTo(b+p,m+_).lineTo(b,m+_-1).close(),y),N=new Dn([T],null,T.bounds(),null);return v.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),v.setTestOnlyFillGeometry(N),v.setTestOnlyStrokeGeometry(N),Ze(v,y.topLeft(),y.size()),v}S.createNonRectangleInNode=c;function l(f,y,v){let b=f.canvasSpaceBoundingBox();switch(v){case"INSIDE":case"OUTSIDE":{f.setTestOnlyStrokeGeometry(e(b,y*2));break}case"CENTER":{f.setTestOnlyStrokeGeometry(e(b,y));break}}f.setStrokeAlign(v)}S.setStrokeForRect=l;function u(){let f=AssertLib.deepStrictEqual,y=new wa("./src/test/rendertree.test.sk");Ut("generateRenderTree",()=>{let v=null,b=null,m=()=>{v=yt.createSceneWithCanvasForTests1(),b=v.root().childAt1(0),b.setPrototypeDevice(Xn.DEFAULT)};beforeEach(m),Te("simple rect",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return y.asyncAssertMatchesSnapshot("should emit single fill",p.renderTree1().debugString1())}),Te("simple rounded rect",()=>{let p=s(b,10,d.FILL,new B(0,0,100,100));return y.asyncAssertMatchesSnapshot("should emit single rounded rect fill",p.renderTree1().debugString1())}),Te("rounded rect symbol",()=>{let p=Qo(b);return r(p,d.FILL,new B(0,0,100,100),0),p.setContainerSupportsFillStrokeAndCorners(!0),p.setIsFrameMaskDisabled(!0),p.setCornerRadius(10),y.asyncAssertMatchesSnapshot("symbol should emit rounded rect fill",p.renderTree1().debugString1())}),Te("rounded rect instance",()=>{let p=Qo(b),_=ji(b,p);return r(_,d.FILL,new B(0,0,100,100),0),_.setContainerSupportsFillStrokeAndCorners(!0),_.setIsFrameMaskDisabled(!0),_.setCornerRadius(10),y.asyncAssertMatchesSnapshot("instance should emit rounded rect fill",_.renderTree1().debugString1())}),Pa("simple vector with multiple regions",()=>{let p=[],_=n(b,[new B(0,0,10,10),new B(20,20,10,10)],.5);p.push(y.asyncAssertMatchesSnapshot("should emit single fill",_.renderTree1().debugString1()));let T=n(b,[new B(0,0,10,10),new B(5,5,10,10)],.5);return p.push(y.asyncAssertMatchesSnapshot("should emit multiple fills",T.renderTree1().debugString1())),Promise.all(p)}),Te("multiply blend mode",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setBlendMode("MULTIPLY"),y.asyncAssertMatchesSnapshot("should emit fill with blend mode",p.renderTree1().debugString1())}),Te("foreground blur",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setTestOnlyEffects([we.createForegroundBlur(4)].slice()),y.asyncAssertMatchesSnapshot("should emit foreground blur",p.renderTree1().debugString1())}),Te("foreground blur w/ radius zero",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setTestOnlyEffects([we.createForegroundBlur(0)].slice()),y.asyncAssertMatchesSnapshot("blur should be ellided",p.renderTree1().debugString1())}),Te("foreground blur disabled",()=>{let p=i(b,d.FILL,new B(0,0,100,100)),_=we.createForegroundBlur(4);return _.setIsEnabled(!1),p.setTestOnlyEffects([_].slice()),y.asyncAssertMatchesSnapshot("blur should be ellided",p.renderTree1().debugString1())}),Te("background blur",()=>{i(b,d.FILL,new B(25,25,50,50)).setTestOnlyFillPaints([ne.createSolid(E.RED,1)]);let _=i(b,d.FILL,new B(0,0,100,100));return _.setTestOnlyEffects([we.createBackgroundBlur(4)].slice()),y.asyncAssertMatchesSnapshot("blur should be ellided because rect with blur is opaque",_.renderTree1().debugString1())}),Te("background blur on partially transparent node",()=>{i(b,d.FILL,new B(25,25,50,50)).setTestOnlyFillPaints([ne.createSolid(E.RED,1)]);let _=i(b,d.FILL,new B(0,0,100,100));return _.setTestOnlyFillPaints([ne.createSolid(E.BLACK,.5)]),_.setTestOnlyEffects([we.createBackgroundBlur(4)].slice()),y.asyncAssertMatchesSnapshot("background blur should be emitted",_.renderTree1().debugString1())}),Te("rectangle won't show up in the background blur",()=>{i(b,d.FILL,new B(0,0,10,10)).setTestOnlyFillPaints([ne.createSolid(E.RED,1)]);let _=mt(b);_.setTestOnlyFillPaints([ne.createSolid(E.BLACK,.5)]),Ze(_,new I(0,0),new I(10,10));let T=i(_,d.FILL,new B(0,0,10,10));return T.setTestOnlyFillPaints([ne.createSolid(E.GREEN,.5)]),T.setTestOnlyEffects([we.createBackgroundBlur(4)].slice()),y.asyncAssertMatchesSnapshot("red rectangle should not show up in the background blur",_.renderTree1().debugString1())}),Ut("scrolling frames",()=>{Te("wrap scrollable layers in a volatile property binding",()=>{let p=mt(b);return p.setOverflowDirection("VERTICAL"),Ze(p,new I(0,0),new I(100,100)),i(p,d.FILL,new B(0,0,100,200)).setTestOnlyFillPaints([ne.createSolid(E.RED,1)]),y.asyncAssertMatchesSnapshot("red fill should be in volatile property binding",p.renderTree1().debugString1())}),Te("wrap scrollable layers with non-isolated blends with a group",()=>{let p=mt(b);p.setOverflowDirection("VERTICAL"),Ze(p,new I(0,0),new I(100,100));let _=i(p,d.FILL,new B(0,0,100,200));_.setBlendMode("MULTIPLY"),_.setTestOnlyFillPaints([ne.createSolid(E.RED,1)]);let T=p.renderTree1();return y.asyncAssertMatchesSnapshot("red rectangle should be wrapped with a group",T.debugString1())}),Pa("fixed layers and their descendants should be re-positioned",()=>{let p=[];b.setPrototypeDevice(new Xn("CUSTOM",new I(100,100),"","NONE"));let _=mt(b);Ze(_,new I(0,0),new I(100,500));let T=mt(_);return T.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),T.setVerticalConstraint("MAX"),Ze(T,new I(0,400),new I(100,100)),i(T,d.FILL,new B(0,0,100,100)).setTestOnlyFillPaints([ne.createSolid(E.RED,1)]),p.push(y.asyncAssertMatchesSnapshot("Red square should NOT be culled because the screen is 100 x 500",_.renderTree1().debugString1())),p.push(y.asyncAssertMatchesSnapshot("Red square should NOT be culled even though the screen is 100 x 100 because it is a fixed footer that was repositioned to be in in the screen",_.renderTreeForBaseScreen1().debugString1())),T.setScrollBehavior("SCROLLS"),p.push(y.asyncAssertMatchesSnapshot("Red square SHOULD be culled because the screen is 100 x 100 and the footer is not fixed",_.renderTreeForBaseScreen1().debugString1())),Promise.all(p)}),Te("do not wrap fixed layers in a volatile property binding",()=>{let p=mt(b);p.setOverflowDirection("VERTICAL"),Ze(p,new I(0,0),new I(100,100));let _=mt(p);return _.setTestOnlyFillPaints([ne.createSolid(E.GREEN,1)]),_.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),i(p,d.FILL,new B(0,50,100,150)).setTestOnlyFillPaints([ne.createSolid(E.RED,1)]),y.asyncAssertMatchesSnapshot("red fill should be in volatile property binding; green fill should not",p.renderTree1().debugString1())}),Te("Background blur trees should not cull scrollable content",()=>{let p=mt(b);p.setOverflowDirection("VERTICAL"),Ze(p,new I(0,0),new I(100,100)),p.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]);let _=i(p,d.FILL,new B(0,150,100,100));Ze(_,new I(150,0),new I(100,101)),_.setTestOnlyFillPaints([ne.createSolid(E.GREEN,1)]);let T=i(p,d.FILL,new B(0,0,100,100));return T.setScrollBehavior("FIXED_WHEN_CHILD_OF_SCROLLING_FRAME"),Ze(T,new I(0,0),new I(100,100)),T.setTestOnlyFillPaints([ne.createSolid(E.RED,.5)]),T.setTestOnlyEffects([we.createBackgroundBlur(4)].slice()),y.asyncAssertMatchesSnapshot("blur node should contain green fill",p.renderTree1().optimized().debugString1())}),["FRAME","GROUP"].forEach(p=>{Te(`Background blur inside ${p} in scrolling content should contain transformed scrolling siblings`,()=>{let _=mt(b);_.setOverflowDirection("VERTICAL"),Ze(_,new I(0,0),new I(100,100)),_.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]);let T=p=="FRAME"?mt(_):Zo(_),N=i(T,d.FILL,new B(0,0,100,101));Ze(N,new I(0,0),new I(100,101)),N.setTestOnlyFillPaints([ne.createSolid(E.GREEN,1)]);let k=i(T,d.FILL,new B(0,0,100,100));return Ze(k,new I(0,0),new I(100,100)),k.setTestOnlyFillPaints([ne.createSolid(E.RED,.5)]),k.setTestOnlyEffects([we.createBackgroundBlur(4)].slice()),Ze(T,new I(0,0),new I(100,101)),y.asyncAssertMatchesSnapshot("blur node should contain transformed green fill",_.renderTree1().optimized().debugString1())})}),Te("calling .renderTree on a frame should NOT make it scrollable by default",()=>{b.setCurrentViewportSize(new I(100,50));let p=mt(b);return Ze(p,new I(0,0),new I(100,100)),i(p,d.FILL,new B(0,0,100,100)).setTestOnlyFillPaints([ne.createSolid(E.RED,1)]),y.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should NOT be present",p.renderTree1().debugString1())}),Te("calling .renderTreeForBaseScreen on a frame should make it scrollable by default",()=>{b.setCurrentViewportSize(new I(100,50));let p=mt(b);return Ze(p,new I(0,0),new I(100,100)),i(p,d.FILL,new B(0,0,100,100)).setTestOnlyFillPaints([ne.createSolid(E.RED,1)]),y.asyncAssertMatchesSnapshot("VOLATILE_PROPERTY_BINDING should be present",p.renderTreeForBaseScreen1().debugString1())})}),Te("drop shadow",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),p.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("drop shadow should be emitted",p.renderTree1().debugString1())}),Te("two drop shadows",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),p.setTestOnlyEffects([we.createDropShadow1(0,new I(50,50),E.RED,1),we.createDropShadow1(0,new I(-50,-50),E.GREEN,1)].slice()),y.asyncAssertMatchesSnapshot("two drop shadows should be emitted",p.renderTree1().debugString1())}),Te("drop shadow on semi-transparent layer",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),p.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)].slice()),p.setOpacity(.5),y.asyncAssertMatchesSnapshot("should be wrapped in blend with 0.5 opacity",p.renderTree1().debugString1())}),Te("drop shadow on clipping frame with visible background paints",()=>{let p=mt(b);Ze(p,new I(-100,-100),new I(300,300));let _=mt(p);return Ze(_,new I(0,0),new I(200,200)),_.setTestOnlyFillPaints([ne.createSolid(E.RED,1)]),i(_,d.FILL,new B(0,0,100,100)).setTestOnlyFillPaints([ne.createSolid(E.GREEN,1)]),_.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("shadow tree does not contain rect fill",_.renderTree1().debugString1())}),Te("drop shadow on non-clipping frame with visible background paints",()=>{let p=mt(b);Ze(p,new I(-100,-100),new I(300,300));let _=mt(p);return Ze(_,new I(0,0),new I(200,200)),_.setTestOnlyFillPaints([ne.createSolid(E.RED,1)]),_.setIsFrameMaskDisabled(!0),i(_,d.FILL,new B(0,0,100,100)).setTestOnlyFillPaints([ne.createSolid(E.GREEN,1)]),_.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill",_.renderTree1().debugString1())}),Te("drop shadow on clipping frame with no background paints",()=>{let p=mt(b);Ze(p,new I(-100,-100),new I(300,300));let _=mt(p);return Ze(_,new I(0,0),new I(200,200)),_.setTestOnlyFillPaints([]),i(_,d.FILL,new B(0,0,100,100)).setTestOnlyFillPaints([ne.createSolid(E.GREEN,1)]),_.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",_.renderTree1().debugString1())}),Te("drop shadow on clipping frame with no visible background paints",()=>{let p=mt(b);Ze(p,new I(-100,-100),new I(300,300));let _=mt(p);return Ze(_,new I(0,0),new I(200,200)),_.setTestOnlyFillPaints([ne.createSolid(E.RED,0)]),i(_,d.FILL,new B(0,0,100,100)).setTestOnlyFillPaints([ne.createSolid(E.GREEN,1)]),_.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("shadow tree DOES contain rect fill; does not contain frame background",_.renderTree1().debugString1())}),Te("drop shadow on clipping frame with visible background paint with transparent area",()=>{let p=ne.createLinearGradient([new lt(E.new3(0,0,0,1),0),new lt(E.new3(0,0,0,0),.5)]),_=mt(b);Ze(_,new I(-100,-100),new I(300,300));let T=mt(_);return Ze(T,new I(0,0),new I(200,200)),T.setTestOnlyFillPaints([p]),i(T,d.FILL,new B(0,0,100,100)).setTestOnlyFillPaints([ne.createSolid(E.GREEN,1)]),T.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("shadow tree should contain frame background and rect",T.renderTree1().debugString1())}),Te("drop shadow on clipping frame with inside stroke",()=>{let p=mt(b);Ze(p,new I(-100,-100),new I(300,300));let _=va(p,"frame",[ne.createSolid(E.RED,1)],[ne.createSolid(E.BLACK,1)],new B(0,0,50,50));return Ze(_,new I(0,0),new I(50,50)),_.setStrokeAlign("INSIDE"),_.setStrokeWeight(4),c(_,new B(0,0,100,100)),_.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("drop shadow should not be clipped by frame mask",_.renderTree1().debugString1())}),Te("drop shadow on rounded rectangle clipping frame with inside stroke",()=>{let p=mt(b);Ze(p,new I(-100,-100),new I(300,300));let _=va(p,"frame",[ne.createSolid(E.RED,1)],[ne.createSolid(E.WHITE,1)],new B(0,0,50,50));return Ze(_,new I(0,0),new I(50,50)),_.setStrokeAlign("INSIDE"),_.setStrokeWeight(4),_.setCornerRadius(10),_.setTestOnlyFillGeometry(Em(_.canvasSpaceBoundingBox(),10)),_.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("drop shadow should be a rounded rect",_.renderTree1().debugString1())}),Te("drop shadow and inner shadow on clipping frame with inside stroke",()=>{let p=mt(b);Ze(p,new I(-100,-100),new I(300,300));let _=va(p,"frame",[ne.createSolid(E.RED,1)],[ne.createSolid(E.BLACK,1)],new B(0,0,50,50));return Ze(_,new I(0,0),new I(50,50)),_.setTestOnlyFillPaints([ne.createSolid(E.WHITE,1)]),_.setStrokeAlign("INSIDE"),_.setTestOnlyStrokePaints([ne.createSolid(E.RED,1)]),_.setStrokeWeight(4),c(_,new B(0,0,100,100)),_.setTestOnlyEffects([we.createInnerShadow(4,new I(0,0),E.BLACK,.25),we.createDropShadow1(4,new I(0,0),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("inner shadow should be clipped by frame mask",_.renderTree1().debugString1())}),Te("spread shadow for eligible frame",()=>{let p=mt(b);Ze(p,new I(0,0),new I(300,300));let _=oo(p,"frame",ne.createSolid(E.RED,1));return Ze(_,new I(0,0),new I(50,50)),_.setTestOnlyEffects([we.createDropShadow2(0,new I(0,0),E.BLACK,.25,10)].slice()),y.asyncAssertMatchesSnapshot("should generate shadow with spread for eligible frame: max bounds",`${_.renderTree1().maxBounds}
`)}),Te("no spread shadow for frame with no visible fill paints",()=>{let p=oo(b,"frame",ne.createSolid(E.RED,0));return Ze(p,new I(0,0),new I(50,50)),i(p,d.FILL,new B(0,0,100,100)).setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),p.setTestOnlyEffects([we.createDropShadow2(0,new I(0,0),E.BLACK,.25,10)].slice()),y.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no visible fill: max bounds",`${p.renderTree1().maxBounds}
`)}),Te("no spread shadow for frame that does not clip",()=>{let p=mt(b);Ze(p,new I(0,0),new I(300,300));let _=oo(p,"frame",ne.createSolid(E.RED,1));return Ze(_,new I(0,0),new I(50,50)),_.setIsFrameMaskDisabled(!0),_.setTestOnlyEffects([we.createDropShadow2(0,new I(0,0),E.BLACK,.25,10)].slice()),y.asyncAssertMatchesSnapshot("should generate shadow without spread for frame with no clipping: max bounds",`${_.renderTree1().maxBounds}
`)}),Te("drop shadow with knockout: translucent node",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setTestOnlyFillPaints([ne.createSolid(E.RED,.5)]),p.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,5,!1)].slice()),y.asyncAssertMatchesSnapshot("should generate knockout shadow for regular translucent node",p.renderTree1().debugString1())}),Te("drop shadow with knockout: opaque node",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setTestOnlyFillPaints([ne.createSolid(E.RED,1)]),p.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,5,!1)].slice()),y.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque node",p.renderTree1().debugString1())}),Te("drop shadow with knockout: opaque frame",()=>{let p=mt(b);Ze(p,new I(-100,-100),new I(300,300));let _=oo(p,"frame",ne.createSolid(E.RED,1));return Ze(_,new I(0,0),new I(50,50)),_.setIsFrameMaskDisabled(!0),_.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,20,!1)].slice()),y.asyncAssertMatchesSnapshot("should optimize out knockout shadow for opaque frame",_.renderTree1().debugString1())}),Te("drop shadow with knockout: node with gradient transparency",()=>{let p=i(b,d.FILL,new B(0,0,100,100)),_=ne.createLinearGradient([new lt(E.new3(0,0,0,1),0),new lt(E.new3(0,0,0,0),.3),new lt(E.new3(0,0,0,0),.7),new lt(E.new3(0,0,0,1),.7)]);return p.setTestOnlyFillPaints([_]),p.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,5,!1)].slice()),y.asyncAssertMatchesSnapshot("should knockout gradient with transparency",p.renderTree1().debugString1())}),Te("drop shadow with knockout: with effect blend mode",()=>{let p=i(b,d.FILL,new B(0,0,100,100));p.setTestOnlyFillPaints([ne.createSolid(E.RED,.5)]);let _=we.createDropShadow3(0,new I(10,0),E.BLACK,.25,5,!1);return _.setBlendMode("DIFFERENCE"),p.setTestOnlyEffects([_].slice()),y.asyncAssertMatchesSnapshot("should generate blend for knockout shadow",p.renderTree1().debugString1())}),Te("drop shadow with knockout: with an inner shadow",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setTestOnlyFillPaints([ne.createSolid(E.RED,.5)]),p.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,5,!1),we.createInnerShadow(4,new I(5,5),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("should generate knockout shadow and inner shadow",p.renderTree1().debugString1())}),Te("drop shadow with knockout: with fill/stroke blend modes",()=>{let p=i(b,d.FILL,new B(0,0,100,100)),_=ne.createSolid(E.RED,.5);_.setBlendMode("HARD_LIGHT"),p.setTestOnlyFillPaints([_]);let T=ne.createSolid(E.BLUE,.5);return T.setBlendMode("SOFT_LIGHT"),p.setTestOnlyStrokePaints([T]),p.setStrokeWeight(5),p.setStrokeAlign("OUTSIDE"),p.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,5,!1)].slice()),y.asyncAssertMatchesSnapshot("should generate fills/strokes with effects correctly (should not nest blends into knockout shadow mask alpha)",p.renderTree1().debugString1())}),Te("drop shadow with knockout: should not render knockout shadow inside bg blur",()=>{let p=oo(b,"frame",ne.createSolid(E.RED,1));Ze(p,new I(0,0),new I(50,50));let _=i(b,d.FILL,new B(0,0,100,100));return _.setTestOnlyFillPaints([ne.createSolid(E.RED,.5)]),_.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,.25,5,!1),we.createBackgroundBlur(10)].slice()),y.asyncAssertMatchesSnapshot("should not render knockout shadow inside bg blur",_.renderTree1().debugString1())}),Te("drop shadow with knockout: with drop shadow that does not overlap node at all",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setTestOnlyFillPaints([ne.createSolid(E.RED,.5)]),p.setTestOnlyEffects([we.createDropShadow3(10,new I(200,0),E.BLACK,.25,5,!1)].slice()),y.asyncAssertMatchesSnapshot("should optimize but not cull knockout shadow that does not overlap node",p.renderTree1().debugString1())}),Te("drop shadow with knockout: transparent frame with stroke should have no shadows inside",()=>{let p=mt(b);Ze(p,new I(-100,-100),new I(300,300));let _=va(p,"frame",[ne.createSolid(E.RED,0)],[ne.createSolid(E.BLACK,1)],new B(0,0,50,50));return Ze(_,new I(0,0),new I(50,50)),_.setTestOnlyEffects([we.createDropShadow3(10,new I(10,0),E.BLACK,1,5,!1)].slice()),y.asyncAssertMatchesSnapshot("should generate knockout shadow for transparent node",_.renderTree1().debugString1())}),Te("inner shadow",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),p.setTestOnlyEffects([we.createInnerShadow(4,new I(0,0),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("should output inner shadow",p.renderTree1().debugString1())}),Te("two inner shadows",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),p.setTestOnlyEffects([we.createInnerShadow(0,new I(50,50),E.RED,1),we.createInnerShadow(0,new I(-50,-50),E.GREEN,1)].slice()),y.asyncAssertMatchesSnapshot("should output two inner shadows",p.renderTree1().debugString1())}),Te("inner shadow w/ zero blur radius",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),p.setTestOnlyEffects([we.createInnerShadow(0,new I(0,4),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("should NOT output inner shadow",p.renderTree1().debugString1())}),Te("inner shadow, with outside stroke (mask.alpha HARD_MASK_WITH_COLOR inlines into shader)",()=>{let p=i(b,d.FILL_AND_STROKE,new B(0,0,100,100));return p.setStrokeAlign("OUTSIDE"),p.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),p.setTestOnlyStrokePaints([ne.createSolid(E.WHITE,1)]),p.setTestOnlyEffects([we.createInnerShadow(1,new I(0,4),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("should have mask without hard mask alpha",p.renderTree1().debugString1())}),Te("semi-transparent rect",()=>{let p=i(b,d.FILL,new B(0,0,100,100));return p.setTestOnlyFillPaints([ne.createSolid(E.BLACK,.5)]),p.setOpacity(.5),y.asyncAssertMatchesSnapshot("opacity should be baked into fill paint",p.renderTree1().debugString1())}),Te("simple rect with stroke",()=>{let p=i(b,d.FILL_AND_STROKE,new B(0,0,100,100));return p.setStrokeAlign("INSIDE"),p.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),p.setTestOnlyStrokePaints([ne.createSolid(E.WHITE,1)]),y.asyncAssertMatchesSnapshot("should output FillStroke",p.renderTree1().debugString1())}),Te("rect with stroke and disabled fill should NOT render fill",()=>{let p=i(b,d.FILL_AND_STROKE,new B(0,0,100,100));p.setStrokeAlign("INSIDE");let _=ne.createSolid(E.BLACK,1);return _.setIsEnabled(!1),p.setTestOnlyFillPaints([_]),p.setTestOnlyStrokePaints([ne.createSolid(E.WHITE,1)]),y.asyncAssertMatchesSnapshot("FILL_STROKE should NOT have black fill",p.renderTree1().debugString1())}),Te("background blur with no background",()=>{let p=Object({viewer_background_blur_opts:!0});Q.updateFeatureFlags(p);let _=oo(b,"frame",ne.createSolid(E.RED,.5));return Ze(_,new I(0,0),new I(100,100)),_.setTestOnlyEffects([we.createBackgroundBlur(10)].slice()),y.asyncAssertMatchesSnapshot("should not generate a background blur subtree",_.renderTree1().debugString1())}),Te("background blur with no scrolling elements",()=>{let p=Object({viewer_background_blur_opts:!0});Q.updateFeatureFlags(p);let _=oo(b,"frame",ne.createSolid(E.RED,1));Ze(_,new I(0,0),new I(100,100));let T=i(b,d.FILL,new B(0,0,50,50));return T.setTestOnlyFillPaints([ne.createSolid(E.RED,.5)]),T.setTestOnlyEffects([we.createBackgroundBlur(10)].slice()),y.asyncAssertMatchesSnapshot("should not include an INVERSE_TRANSFORM node",T.renderTree1().debugString1())}),Te("background blur with scroll: foreground and background in clipping frame",()=>{let p=Object({viewer_background_blur_opts:!0});Q.updateFeatureFlags(p);let _=oo(b,"frame",ne.createSolid(E.RED,1));Ze(_,new I(0,0),new I(100,100)),_.setOverflowDirection("VERTICAL");let T=oo(_,"container",ne.createSolid(E.WHITE,1));Ze(T,new I(0,0),new I(100,500));let N=i(T,d.FILL,new B(0,0,50,50));return N.setTestOnlyFillPaints([ne.createSolid(E.RED,.5)]),N.setTestOnlyEffects([we.createBackgroundBlur(10)].slice()),y.asyncAssertMatchesSnapshot("background blur should not include INVERSE_TRANSFORM or scrolling TRANSFORM nodes",N.renderTree1().debugString1())}),Ut("simple stroke-only rect",()=>{let p=null;beforeEach(()=>{m(),p=i(b,d.FILL_AND_STROKE,new B(0,0,100,100)),p.setTestOnlyFillPaints(Re.EMPTY),p.setTestOnlyStrokePaints([ne.createSolid(E.WHITE,1)])}),Te("inside stroke",()=>(l(p,1,"INSIDE"),y.asyncAssertMatchesSnapshot("should output FillStroke with mode .INSIDE",p.renderTree1().debugString1()))),Te("outside stroke",()=>(l(p,1,"OUTSIDE"),y.asyncAssertMatchesSnapshot("should output FillStroke with mode .OUTSIDE",p.renderTree1().debugString1()))),Te("center stroke",()=>(l(p,1,"CENTER"),y.asyncAssertMatchesSnapshot("should output FillStroke with mode .CENTER",p.renderTree1().debugString1())))}),Ut("Simple tests on non-rects",()=>{Te("simple non-rectangle",()=>{let p=c(b,new B(0,0,100,100));return y.asyncAssertMatchesSnapshot("should be single fill without isRect flag",p.renderTree1().debugString1())}),Te("non-rectangle not clipped by frame",()=>{let p=mt(b);return Ze(p,new I(0,0),new I(100,100)),p.setTestOnlyFillPaints([ne.createSolid(E.WHITE,1)]),c(p,new B(0,0,99,99)),y.asyncAssertMatchesSnapshot("group with two fills (frame background and non-rect layer)",p.renderTree1().debugString1())}),Te("non-rectangle clipped by frame",()=>{let p=mt(b);return Ze(p,new I(0,0),new I(50,50)),p.setTestOnlyFillPaints([ne.createSolid(E.WHITE,1)]),c(p,new B(0,0,100,100)),y.asyncAssertMatchesSnapshot("clipping should not be optimized",p.renderTree1().debugString1())})}),Te("grouped single node",()=>{let p=Zo(b);Ji(p,!1),Ze(p,new I(0,0),new I(100,100));let _=i(p,d.FILL,new B(0,0,100,100));return _.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),y.asyncAssertMatchesSnapshot("group should be ellided since it does not affect rendering",_.renderTree1().debugString1())}),Te("nested groups",()=>{let p=Zo(b);Ji(p,!1),Ze(p,new I(0,0),new I(100,100));let _=Zo(p);Ji(_,!1),Ze(_,new I(0,0),new I(50,50)),i(_,d.FILL,new B(0,0,50,50)).setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]);let N=Zo(p);return Ji(N,!1),Ze(N,new I(50,50),new I(50,50)),i(N,d.FILL,new B(0,0,50,50)).setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),y.asyncAssertMatchesSnapshot("render tree should contain only 1 group since groups do not affect rendering",p.renderTree1().debugString1())}),Te("flatten nested opacities",()=>{let p=Zo(b);Ze(p,new I(0,0),new I(100,100)),p.setOpacity(.8);let _=Zo(p);Ze(_,new I(0,0),new I(50,50)),_.setOpacity(.5);let T=i(_,d.FILL,new B(0,0,50,50));T.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),T.setOpacity(.5);let N=Zo(p);Ze(N,new I(50,50),new I(50,50)),N.setOpacity(.25);let k=i(N,d.FILL,new B(0,0,50,50));return k.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]),k.setOpacity(.1),y.asyncAssertMatchesSnapshot("opacities for ellided groups should be applied to leaves",p.renderTree1().debugString1())}),Ut("node outside bounds of frame",()=>{let p=null;beforeEach(()=>{m(),p=mt(b),p.setTestOnlyFillPaints([ne.createSolid(E.WHITE,1)]),Ze(p,new I(0,0),new I(100,100)),i(p,d.FILL,new B(110,110,100,100)).setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)])}),Te("without frame clipping",()=>(p.setIsFrameMaskDisabled(!0),y.asyncAssertMatchesSnapshot("there should be two fills; one for the non-clipped rect",p.renderTree1().debugString1()))),Te("with frame clipping",()=>(p.setIsFrameMaskDisabled(!1),y.asyncAssertMatchesSnapshot("there should be on fill; rect was clipped",p.renderTree1().debugString1()))),Ee("with frame clipping and no background color",()=>{p.setIsFrameMaskDisabled(!1),Ji(p,!1),f(p.renderTree1(),null)})}),Ut("frame background",()=>{let p=null;beforeEach(()=>{m(),p=mt(b),p.setTestOnlyFillPaints([ne.createSolid(E.WHITE,1)]),Ji(p,!0),Ze(p,new I(0,0),new I(100,100))}),Te("with solid paint",()=>(p.setTestOnlyFillPaints([ne.createSolid(E.new3(1,.5,0,1),1)]),y.asyncAssertMatchesSnapshot("frame background fill should be present",b.renderTree1().debugString1()))),Te("with solid paint and blend mode",()=>{let _=ne.createSolid(E.new3(1,.5,0,1),1);return _.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([_]),y.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",b.renderTree1().debugString1())}),Te("with solid paint and blended gradient",()=>{let _=ne.createSolid(E.new3(1,.5,0,1),1),T=ne.createLinearGradient([new lt(E.new3(1,.5,0,1),.25),new lt(E.new3(0,.5,1,1),.75)]);return T.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([_,T]),y.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",b.renderTree1().debugString1())}),Te("with solid paint and blend mode and children",()=>{let _=ne.createSolid(E.new3(1,.5,0,1),1);return _.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([_]),i(p,d.FILL,new B(0,0,100,100)).setTestOnlyFillPaints([ne.createSolid(E.BLACK,.5)]),y.asyncAssertMatchesSnapshot("should output background and children",b.renderTree1().debugString1())}),Te("with drop shadow and opaque fill",()=>{let _=Object({omit_drop_shadows_on_tlfs:!0});return Q.updateFeatureFlags(_),p.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("should not output a drop shadow",p.renderTree1().debugString1())}),Te("with drop shadow and no opaque fill",()=>{let _=Object({omit_drop_shadows_on_tlfs:!0});return Q.updateFeatureFlags(_),p.setTestOnlyFillPaints([ne.createSolid(E.WHITE,.5)]),p.setTestOnlyEffects([we.createDropShadow1(4,new I(0,0),E.BLACK,.25)].slice()),y.asyncAssertMatchesSnapshot("should output a drop shadow",p.renderTree1().debugString1())})}),Ut("frame fills for containers supporting fill stroke and corners",()=>{let p=null;beforeEach(()=>{m(),p=mt(b),p.setContainerSupportsFillStrokeAndCorners(!0),p.setTestOnlyFillPaints([ne.createSolid(E.WHITE,1)]),Ze(p,new I(0,0),new I(100,100))}),Te("with solid paint",()=>(p.setTestOnlyFillPaints([ne.createSolid(E.new3(1,.5,0,1),1)]),y.asyncAssertMatchesSnapshot("frame background fill should be present",b.renderTree1().debugString1()))),Te("with solid paint and blend mode",()=>{let _=ne.createSolid(E.new3(1,.5,0,1),1);return _.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([_]),y.asyncAssertMatchesSnapshot("frame background should have MULTIPLY blend mode",b.renderTree1().debugString1())}),Te("with solid paint and blended gradient",()=>{let _=ne.createSolid(E.new3(1,.5,0,1),1),T=ne.createLinearGradient([new lt(E.new3(1,.5,0,1),.25),new lt(E.new3(0,.5,1,1),.75)]);return T.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([_,T]),y.asyncAssertMatchesSnapshot("should output solid Fill and blended gradient Fill",b.renderTree1().debugString1())}),Te("with solid paint and blend mode and children",()=>{let _=ne.createSolid(E.new3(1,.5,0,1),1);return _.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([_]),i(p,d.FILL,new B(0,0,100,100)).setTestOnlyFillPaints([ne.createSolid(E.BLACK,.5)]),y.asyncAssertMatchesSnapshot("should output background and children",b.renderTree1().debugString1())}),Te("with inside stroke",()=>{let _=va(b,"frame",[ne.createSolid(E.RED,1)],[ne.createSolid(E.BLACK,1)],new B(0,0,50,50));return Ze(_,new I(0,0),new I(50,50)),_.setContainerSupportsFillStrokeAndCorners(!0),_.setStrokeAlign("INSIDE"),_.setStrokeWeight(4),c(_,new B(0,0,100,100)),y.asyncAssertMatchesSnapshot("should generate a fill render node that is clipped by the frame mask",b.renderTree1().debugString1())}),Te("with outside stroke",()=>{let _=va(b,"frame",[ne.createSolid(E.RED,1)],[ne.createSolid(E.BLACK,1)],new B(0,0,50,50));return Ze(_,new I(0,0),new I(50,50)),_.setContainerSupportsFillStrokeAndCorners(!0),Ze(_,new I(0,0),new I(50,50)),_.setStrokeAlign("OUTSIDE"),_.setStrokeWeight(4),c(_,new B(0,0,100,100)),y.asyncAssertMatchesSnapshot("should have stroke on top of mask",b.renderTree1().debugString1())})}),Ut("masks",()=>{Te("blend mode of masked content should mark mask and all ancestors as 'hasBlends'",()=>{let p=mt(b);return p.setIsBackgroundEnabled(!1),p.setIsFrameMaskDisabled(!0),i(p,d.FILL,new B(0,0,10,10)).setIsMask(!0),i(p,d.FILL,new B(0,0,100,100)).setBlendMode("MULTIPLY"),y.asyncAssertMatchesSnapshot("all ancestors of rect should have 'hasBlends' flag",b.renderTree1().debugString1())}),Te("small outside strokes should be masked",()=>{let p=mt(b);p.setIsBackgroundEnabled(!1),p.setIsFrameMaskDisabled(!0),i(p,d.FILL,new B(0,0,100,100)).setIsMask(!0);let T=o(p,d.FILL_AND_STROKE,new B(0,0,100,100),2);return T.setStrokeAlign("OUTSIDE"),T.setTestOnlyFillPaints([ne.createSolid(E.WHITE,1)]),T.setTestOnlyStrokePaints([ne.createSolid(E.BLACK,1)]),y.asyncAssertMatchesSnapshot("optimized RenderTree should mask rect with outside stroke",b.renderTree1().optimized().debugString1())})}),Ut("rectangle visibility",()=>{let p=null;beforeEach(()=>{m(),p=i(b,d.FILL,new B(0,0,100,100)),p.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)])}),Te("default visible",()=>y.asyncAssertMatchesSnapshot("should output single fill",p.renderTree1().debugString1())),Ee("visibility false",()=>{p.setVisible(!1),f(p.renderTree1(),null)}),Ee("layer opacity zero",()=>{p.setOpacity(0),f(p.renderTree1(),null)}),Ee("fill paint opacity zero",()=>{p.setTestOnlyFillPaints([ne.createSolid(E.BLACK,0)]),f(p.renderTree1(),null)}),Ee("no paints",()=>{p.setTestOnlyFillPaints(Re.EMPTY),f(p.renderTree1(),null)}),Ee("no fill paint, stroke paints, zero stroke width",()=>{let _=0,T=o(b,d.FILL_AND_STROKE,new B(0,0,100,100),_);T.setTestOnlyFillPaints(Re.EMPTY),T.setTestOnlyStrokePaints([ne.createSolid(E.TRANSPARENT,0)]),f(T.renderTree1(),null)})}),Ut("solid paints",()=>{let p=null;beforeEach(()=>{m(),p=i(b,d.FILL,new B(0,0,100,100))}),Te("normal",()=>(p.setTestOnlyFillPaints([ne.createSolid(E.new3(1,.5,0,1),1)]),y.asyncAssertMatchesSnapshot("should output fill with opacity=1",p.renderTree1().debugString1()))),Te("50% opacity",()=>(p.setTestOnlyFillPaints([ne.createSolid(E.new3(1,.5,0,1),.5)]),y.asyncAssertMatchesSnapshot("should output fill with opacity=0.5",p.renderTree1().debugString1()))),Ee("0% opacity",()=>{p.setTestOnlyFillPaints([ne.createSolid(E.new3(1,.5,0,1),0)]),f(p.renderTree1(),null)}),Ee("disabled",()=>{let _=ne.createSolid(E.new3(1,.5,0,1),1);_.setIsEnabled(!1),p.setTestOnlyFillPaints([_]),f(p.renderTree1(),null)}),Te("multiply blend",()=>{let _=ne.createSolid(E.new3(1,.5,0,1),1);return _.setBlendMode("MULTIPLY"),p.setTestOnlyFillPaints([_]),y.asyncAssertMatchesSnapshot("should output Blend with Fill child",p.renderTree1().debugString1())})}),Ut("gradient paints",()=>{let p=null;beforeEach(()=>{m(),p=i(b,d.FILL,new B(0,0,100,100))}),Te("linear",()=>{let _=ne.createLinearGradient([new lt(E.new3(1,.5,0,1),.25),new lt(E.new3(0,.5,1,1),.75)]);return p.setTestOnlyFillPaints([_]),y.asyncAssertMatchesSnapshot("should output Fill with linear gradient paint",p.renderTree1().debugString1())}),Te("radial",()=>{let _=ne.createRadialGradient([new lt(E.new3(1,.5,0,1),.25),new lt(E.new3(0,.5,1,1),.75)]);return p.setTestOnlyFillPaints([_]),y.asyncAssertMatchesSnapshot("should output Fill with radial gradient paint",p.renderTree1().debugString1())}),Te("angular",()=>{let _=ne.createAngularGradient([new lt(E.new3(1,.5,0,1),.25),new lt(E.new3(0,.5,1,1),.75)]);return p.setTestOnlyFillPaints([_]),y.asyncAssertMatchesSnapshot("should output Fill with angular gradient paint",p.renderTree1().debugString1())}),Te("diamond",()=>{let _=ne.createDiamondGradient([new lt(E.new3(1,.5,0,1),.25),new lt(E.new3(0,.5,1,1),.75)]);return p.setTestOnlyFillPaints([_]),y.asyncAssertMatchesSnapshot("should output Fill with diamond gradient paint",p.renderTree1().debugString1())}),Te("50% opacity",()=>{let _=ne.createLinearGradient([new lt(E.new3(1,.5,0,1),.25),new lt(E.new3(0,.5,1,1),.75)]);return _.setOpacity(.5),p.setTestOnlyFillPaints([_]),y.asyncAssertMatchesSnapshot("should output linear gradient with 50% opacity",p.renderTree1().debugString1())}),Ee("0% opacity",()=>{let _=ne.createLinearGradient([new lt(E.new3(1,.5,0,1),.25),new lt(E.new3(0,.5,1,1),.75)]);_.setOpacity(0),p.setTestOnlyFillPaints([_]),f(p.renderTree1(),null)}),Ee("disabled",()=>{let _=ne.createLinearGradient([new lt(E.new3(1,.5,0,1),.25),new lt(E.new3(0,.5,1,1),.75)]);_.setIsEnabled(!1),p.setTestOnlyFillPaints([_]),f(p.renderTree1(),null)}),Te("40% stop opacity",()=>{let _=ne.createLinearGradient([new lt(E.new3(1,.5,0,.4),.25),new lt(E.new3(0,.5,1,.6),.75)]);return p.setTestOnlyFillPaints([_]),y.asyncAssertMatchesSnapshot("should output linear gradient with partial opacity stops",p.renderTree1().debugString1())}),Ee("0% stop opacity",()=>{let _=ne.createLinearGradient([new lt(E.new3(1,.5,0,0),.25),new lt(E.new3(0,.5,1,0),.75)]);p.setTestOnlyFillPaints([_]),f(p.renderTree1(),null)}),Te("transform",()=>{let _=ne.createLinearGradient([new lt(E.new3(1,.5,0,1),.25),new lt(E.new3(0,.5,1,1),.75)]);_.setTransform1(new ee(.5,-.5,1,-1,1.5,-1.5)),p.setTestOnlyFillPaints([_]);let T=p.renderTree1();f(T.op(),3);let k=T.geometry.paints;return f(k,p.fillPaints()),y.asyncAssertMatchesSnapshot("should output linear gradient",p.renderTree1().debugString1())})}),Te("geometry",()=>{let p=Er(b,"VECTOR");p.setTestOnlyFillPaints([ne.createSolid(E.BLACK,1)]);let _=new B(0,0,100,100),T=new Hn("ODD",0,vt.new2().moveTo1(0,0).lineTo(100,0).lineTo(50,100).close(),_),N=new Hn("NONZERO",0,vt.new2().moveTo1(0,100).lineTo(100,100).lineTo(50,0).close(),_);p.setTestOnlyFillGeometry(new Dn([T,N],null,_,null));let k=p.renderTree1();f(k.op(),1);let j=k;return f(j.children.length,2),f(j.children[0].op(),3),f(j.children[1].op(),3),f(j.children[0].geometry.path().windingRule(),"ODD"),f(j.children[1].geometry.path().windingRule(),"NONZERO"),y.asyncAssertMatchesSnapshot("should output a group with two fills",p.renderTree1().debugString1())})}),Ut("RenderTree optimization of PaintData",()=>{Ee("dual-color gradient",()=>{let v=[ne.createLinearGradient([new lt(E.new3(0,.5,1,1),0),new lt(E.new3(1,.5,0,1),1)])],b=Re.optimize(v);f(b.length,1),f(b[0].type(),"GRADIENT_LINEAR")}),Ee("dual-opacity gradient",()=>{let v=[ne.createLinearGradient([new lt(E.new3(1,.5,0,0),0),new lt(E.new3(1,.5,0,1),1)])],b=Re.optimize(v);f(b.length,1),f(b[0].type(),"GRADIENT_LINEAR")}),Ee("single-color gradient",()=>{let v=[ne.createLinearGradient([new lt(E.new3(1,.5,0,1),0),new lt(E.new3(1,.5,0,1),1)])],b=Re.optimize(v);f(b.length,1),f(b[0].type(),"SOLID")}),Ee("solid underneath dual-color gradient",()=>{let v=[ne.createSolid(E.GREEN,1),ne.createLinearGradient([new lt(E.new3(0,0,1,.5),0),new lt(E.new3(1,0,0,.5),1)])],b=Re.optimize(v);f(b.length,1),f(b[0].type(),"GRADIENT_LINEAR"),b[0].asSinglePaint()!=null;let m=b[0].asSinglePaint().colorStops()[0],p=b[0].asSinglePaint().colorStops()[1];f(m.position,0),t(m.color,E.new3(0,.5,.5,1)),f(p.position,1),t(p.color,E.new3(.5,.5,0,1))}),Ee("solid underneath single-color gradient",()=>{let v=[ne.createSolid(E.GREEN,1),ne.createLinearGradient([new lt(E.new3(1,0,0,.5),0),new lt(E.new3(1,0,0,.5),1)])],b=Re.optimize(v);f(b.length,1),f(b[0].type(),"SOLID"),t(b[0].asSinglePaint().color(),E.new3(.5,.5,0,1))})}),Ut("RenderTree.isRect",()=>{let v=m=>{f(new xt(m,"ODD").isRect(),!0)},b=m=>{f(new xt(m,"ODD").isRect(),!1)};Ee("RenderTree.isRect",()=>{v(vt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5)),v(vt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0)),v(vt.new2().lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),v(vt.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).close()),v(vt.new2().moveTo1(0,0).lineTo(10,0).lineTo(10,5).lineTo(0,5).lineTo(0,0).close()),b(vt.new2().moveTo1(10,0).lineTo(10,5).lineTo(0,5)),b(vt.new2().moveTo1(10,0).lineTo(0,0).lineTo(10,5).lineTo(0,5).close()),b(vt.new2().quadraticTo(10,0,10,5).lineTo(0,5)),b(vt.new2().lineTo(10,0).quadraticTo(10,5,0,5)),b(vt.new2().cubicTo1(10,0,10,5,0,5));let p=yt.createSceneWithCanvasForTests1().root().childAt1(0),_=i(p,d.FILL,new B(0,0,100,100));f(_.renderTree1()!=null,!0),f(_.renderTree1().isRectFill(),!0)})}),Ut("RenderTree optimization of Group nodes",()=>{let v=null;beforeEach(()=>{let b=new Qt(new xt(Dt.fromRect(new B(0,0,1,1)),"ODD"),[ne.createSolid(E.BLACK,1)]);v=new Sn(ee.new2(),b,I.new2())}),Ee("empty group",()=>{f(new Ue([]).optimized(),null)}),Ee("empty nested group",()=>{f(new Ue([new Ue([])]).optimized(),null)}),Te("single group",()=>y.asyncAssertMatchesSnapshot("should be fill only; no groups",new Ue([v]).optimized().debugString1())),Te("single nested group",()=>y.asyncAssertMatchesSnapshot("should be fill only; no groups",new Ue([new Ue([v])]).optimized().debugString1())),Te("double group",()=>y.asyncAssertMatchesSnapshot("group with two fill children can't be optimized",new Ue([v,v]).optimized().debugString1())),Te("double nested group 1",()=>y.asyncAssertMatchesSnapshot("outer group should be optimized away, leaving a group with two fill children",new Ue([new Ue([v,v])]).optimized().debugString1())),Te("double nested group 2",()=>y.asyncAssertMatchesSnapshot("inner groups should be optimized away, leaving a group with two fill children",new Ue([new Ue([v]),new Ue([v])]).optimized().debugString1()))}),Ut("RenderTree optimization of Dissolve",()=>{let v=null,b=null,m=(p,_)=>new Jn(p,_,"A",()=>1).optimized();beforeEach(()=>{let p=new Qt(new xt(Dt.fromRect(new B(0,0,1,1)),"ODD"),[ne.createSolid(E.BLACK,1)]);v=new Sn(ee.new2(),p,I.new2());let _=new Qt(new xt(Dt.fromRect(new B(0,0,1,1)),"ODD"),[ne.createSolid(E.RED,1)]);b=new Sn(ee.new2(),_,I.new2())}),Ee("both subtrees null",()=>{f(m(null,null),null)}),Te("old subtree null",()=>y.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because old subtree is null",m(null,v).debugString1())),Te("new subtree null",()=>y.asyncAssertMatchesSnapshot("dissolve should be optimized into volatile opacity because new subtree is null",m(v,null).debugString1())),Te("identical subtrees",()=>y.asyncAssertMatchesSnapshot("dissolve should be optimized away entirely because subtrees are identical",m(v,v).debugString1())),Te("different subtrees",()=>y.asyncAssertMatchesSnapshot("dissolve should not be optimized away",m(v,b).debugString1()))}),Ut("RenderTree optimization of Fill",()=>{Ee("fill with zero opacity paint",()=>{f(new Sn(ee.new2(),new Qt(new xt(Dt.fromRect(new B(0,0,1,1)),"ODD"),[ne.createSolid(E.BLACK,0)]),I.new2()).optimized(),null)}),Ee("fill with disabled paint",()=>{f(new Sn(ee.new2(),new Qt(new xt(Dt.fromRect(new B(0,0,1,1)),"ODD"),[ne.create("SOLID",1,"NORMAL",!1,E.BLACK)]),I.new2()).optimized(),null)}),Ee("fill with empty bounds",()=>{f(new Sn(ee.new2(),new Qt(new xt(Dt.fromRect(new B(0,0,0,0)),"ODD"),[ne.createSolid(E.BLACK,1)]),I.new2()).optimized(),null)})}),Ut("RenderTree optimization of Blur",()=>{let v=null;beforeEach(()=>{let b=new Qt(new xt(Dt.fromRect(new B(0,0,1,1)),"ODD"),[ne.createSolid(E.BLACK,1)]);v=new Sn(ee.new2(),b,I.new2())}),Te("zero radius blur",()=>y.asyncAssertMatchesSnapshot("should contain no Blur node",new Ar(0,v,B.INVALID).optimized().debugString1())),Te("blur wrapping volatile fill",()=>y.asyncAssertMatchesSnapshot("volatile property binding should be OUTSIDE of blur",new Ar(10,et.forTranslation(v,Ct.forAnimateableTranslation("x"),()=>I.new2()),B.INVALID).optimized().debugString1())),Te("clamp blur wrapping volatile fill",()=>y.asyncAssertMatchesSnapshot("volatile property binding should be INSIDE of blur",new Ar(10,et.forTranslation(v,Ct.forAnimateableTranslation("x"),()=>I.new2()),new B(0,0,1,1)).optimized().debugString1()))}),Ut("RenderTree optimization of HardMaskWithColor",()=>{let v=null;beforeEach(()=>{let b=new Qt(new xt(Dt.fromRect(new B(0,0,1,1)),"ODD"),[ne.createSolid(E.BLACK,1)]);v=new Sn(ee.new2(),b,I.new2())}),Te("hard mask wrapping fill",()=>y.asyncAssertMatchesSnapshot("should be a single Fill",new Dr(v,E.BLACK).optimized().debugString1())),Te("hard mask wrapping volatile fill",()=>y.asyncAssertMatchesSnapshot("should be a single Fill wrapped by the VolatilePropertyBinding",new Dr(et.forTranslation(v,Ct.forAnimateableTranslation("x"),()=>I.new2()),E.BLACK).optimized().debugString1())),Te("hard mask wrapping blend nodes",()=>y.asyncAssertMatchesSnapshot("should be a single Fill",new Dr(new xr("MULTIPLY",.5,v),E.BLACK).optimized().debugString1()))}),Ut("Stack reverse Z index",()=>{let v=null,b=null,m=()=>{v=yt.createSceneWithCanvasForTests1(),b=v.root().childAt1(0),b.setPrototypeDevice(Xn.DEFAULT)};beforeEach(m),Te("stacking frame without stackReverseZIndex",()=>{let p=ct(b,"f");return kt(p,"c1",E.RED,1),kt(p,"c2",E.BLUE,1),p.setStackMode("VERTICAL"),p.setStackReverseZIndex(!1),y.asyncAssertMatchesSnapshot("should have non-reversed children",p.renderTree1().debugString1())}),Te("stacking frame with stackReverseZIndex",()=>{let p=ct(b,"f");return kt(p,"c1",E.RED,1),kt(p,"c2",E.BLUE,1),p.setStackMode("VERTICAL"),p.setStackReverseZIndex(!0),y.asyncAssertMatchesSnapshot("should have reversed children",p.renderTree1().debugString1())}),Te("non-stacking frame without stackReverseZIndex",()=>{let p=ct(b,"f");return kt(p,"c1",E.RED,1),kt(p,"c2",E.BLUE,1),p.setStackMode("NONE"),p.setStackReverseZIndex(!1),y.asyncAssertMatchesSnapshot("should have non-reversed children",p.renderTree1().debugString1())}),Te("non-stacking frame with stackReverseZIndex",()=>{let p=ct(b,"f");return kt(p,"c1",E.RED,1),kt(p,"c2",E.BLUE,1),p.setStackMode("NONE"),p.setStackReverseZIndex(!0),y.asyncAssertMatchesSnapshot("should have non-reversed children",p.renderTree1().debugString1())})})}S.testRenderTree=u;let d;(v=>(v[v.FILL=0]="FILL",v[v.FILL_AND_STROKE=1]="FILL_AND_STROKE"))(d=S.GeometryType||(S.GeometryType={}));let h;(b=>{function f(m){return m==0||m==1}b.GeometryType_hasFill=f;function y(m){return m==1}b.GeometryType_hasStroke=y;function v(m){return d[m]}b.GeometryType_toString=v})(h=S.in_GeometryType||(S.in_GeometryType={}))})(Fu||(Fu={}));var Og=(n=>(n[n.NONE=0]="NONE",n[n.RECORD=1]="RECORD",n[n.PLAYBACK=2]="PLAYBACK",n))(Og||{}),Du;(r=>{function g(){return r._instance}r.instance=g;function e(o,i){r._instance=new t(o,i)}r.create=e;class t extends Vd{constructor(i,a){super(s=>{this._emitter.trigger("topLevelFrameChange",null)});this._dirtyNodes=null,this._emitter=null,this._scene=null,i.addFrameObserver(this),i.addAppObserver(this),i.prototypeState().addObserver(this),this._emitter=a,this._clearDirtySet()}_clearDirtySet(){this._dirtyNodes=new Vi(i=>R.toString(i))}handleSceneGraphEvent(i){switch(i.property){case 61:case 24:case 23:case 85:case 48:case 77:case 4:case 18:case 7:{this._dirtyNodes.add(i.node.id());break}}}handleSceneChange(i,a){i!=null&&i.removeObserver(this),a!=null&&a.addObserver(this)}handleActiveCanvasChange(i,a){}handleActivePrototypeStartingPointChange(i,a){}onFrame(){this._dirtyNodes.each(i=>{this._emitter.trigger("accessibilityNodeInvalidated",R.toString(i))}),this._clearDirtySet()}}r._AccessibilityObserver=t,r._instance=null})(Du||(Du={}));var ko=(r=>(r[r.VIEWER=0]="VIEWER",r[r.WORKER=1]="WORKER",r[r.TEST=2]="TEST",r[r.RENDER_SERVER=3]="RENDER_SERVER",r))(ko||{});var Ag;(e=>{function g(t){return Og[t]}e.InteractionTestState_toString=g})(Ag||(Ag={}));var Eg;(e=>{function g(t){return ko[t]}e.Build_toString=g})(Eg||(Eg={}));function xu(g){return{x:g.x(),y:g.y(),width:g.width(),height:g.height()}}function Cg(g){let e=g.state().getActiveCanvas();if(e==null)return null;let t=e.backgroundColor();return t==E.TRANSPARENT?null:E.asFloattoJSON(t)}function Ng(g){if(g.state().scene()==null)return null;let t=g.state().getActiveCanvas();if(t==null)return null;let n=Q.prototypeBackgroundColorOverride!=null?Q.prototypeBackgroundColorOverride.value:t.prototypeBackgroundColor();return n==E.TRANSPARENT?null:E.asInttoJSON(n)}function v_(g){let e=[];for(let t of g)e.push(R.fromString(t));return e}function I_(g,e){let t=window;t!==null&&t.addEventListener("message",n=>{let r=n.data,o=r.type,i=r.data;if(o==="NAVIGATE_TO_FRAME_IN_PROTOTYPE")if(!i.nodeId)ze(`Expected nodeId to exist, received ${i.nodeId}.`);else{let a=R.fromString(i.nodeId),s=R.fromString(i.startingPointNodeId);s!=null?g.prototypeState().navigateToFrameAndCloseOverlays2(a,s):g.prototypeState().navigateToFrameAndCloseOverlays1(a)}})}function A_(g){return{trigger:g.event().interactionType(),to:g.action().value.connectionType(),type:g.action().value.navigationType()}}function Rg(g){return t=>{let n=t.subtract1(g.canvasView().absoluteBounds().topLeft()),r=g.canvasView().canvasSpaceToWindowSpace().clone();return r.invert()?(r.transformPoint(n),n):null}}function wg(g,e,t){e.window().setAfterNotify(n=>{let r=is.serialize(n,g);r!==null&&t.trigger("recordInteraction",r)})}function E_(g,e){let t=Rg(g);wg(t,g,e)}function C_(g){bi.detect(),At.initialize(g),Zt.initialize(),wr.initialize(),Q.initialize(g),Se.schema=g.kiwiSchema;let e=new rn,t=new Oc(At.getContainerElement(),e,Q.gameControllerListener(),new Dd,0),n=t.multiplayerSession(),r=t.multiplayerCoupler();new Nu(n);let o=new wc(t.state()),i=new Ou(t.state());I_(t.state(),e),Pi.init(e,t.state(),t.canvasView());let a=null;Q.getViewerMode()==Q.ViewerMode.MIRROR&&(a=new Pc(t,n,e));let s=g.deviceName;if(typeof s=="string"){if(["viewer","prototype","editor"].indexOf(s)==-1)throw new Error(`Invalid device name ${s}`);n.setRole(s)}e.on("sceneDidCompleteInitialLoad",m=>{let p=_=>{window.figmaPerfTesting&&window.postMessage({name:_,value:0},"*")};p("DOCUMENT_IS_LOADED"),t.canvasView().afterFrame=()=>{t.canvasView().afterFrame=null,p("AFTER_FIRST_RENDER"),e.trigger("documentIsLoaded",null)},t.canvasView().afterFirstRenderOfScreenStack=()=>{t.canvasView().afterFirstRenderOfScreenStack=null,p("AFTER_FIRST_RENDER_OF_TLF")}});let c=0,l=g.interactionTestState;if(typeof l!="string"||l==="NONE")c=0;else if(l==="RECORD")c=1;else if(l==="PLAYBACK")c=2,Si=!0;else throw new Error(`Invalid interactionTestState ${l}`);let u=null,d=null,h=null,S=null;c!=0&&(u=m=>{let p=m.clone();return t.canvasView().canvasSpaceToWindowSpace().transformPoint(p),p.add1(t.canvasView().absoluteBounds().topLeft())},d=Rg(t),h=m=>t.window().root().viewFromPoint(m),S=()=>t.window().focusedView()),c==1&&wg(d,t,e),t.state().addActionObserver(new rn.ActionHandler(e));let f=new rn.AppHandler(e,t.state());t.state().addFrameObserver(f),Du.create(t.state(),e),$n.addUpdate(zt.windowFrame(t.window().events()),m=>{n.maybeFlushNextUserChange(0)}),t.canvasView().onBaseScreenIdChanged=(m,p,_,T)=>{m!=null&&e.trigger("baseScreenChanged",{nodeId:R.toString(m),userInitiated:p==1,updateURL:_,repairsInvalidState:T})},t.canvasView().disengageObservationMode=()=>{e.trigger("disengageObservationMode",{})},t.canvasView().viewportTracker().onChange=(m,p)=>{e.trigger("viewportChanged",{offset:{x:m.x(),y:m.y()},zoomScale:p})},t.canvasView().onResize=()=>{e.trigger("canvasResize",null)},t.canvasView().onURLClicked=(m,p)=>{e.trigger("urlClicked",{url:m,openInNewWindow:p})},t.canvasView().onNavigateToPrototype=(m,p)=>{e.trigger("navigateToPrototype",{fileKey:m,guid:p})},ro.instance().startLibLoad=()=>{e.trigger("loadVideoJsLib",{})},i.onChange=m=>{e.trigger("pagesChange",m)},o.notifyCommentPositionsChange=()=>{e.trigger("watchedNodeBoundsChange",null)},new Ma(t.state(),63,m=>{let p="backgroundColorChange";e.trigger(p,Cg(t))}),new Ma(t.state(),64,m=>{let p="prototypeBackgroundColorChange";e.trigger(p,Ng(t))}),new Ma(t.state(),65,m=>{e.trigger("prototypeDeviceChanged",m!=null?Z.asPrototypeDevice(m).toJSON():null)});let y=[],v={appState:()=>t.state(),multiplayer:()=>n,prototypeState:()=>t.state().prototypeState(),logAndGetDocument:()=>{var _;let m,p=(_=t.state().scene())==null?void 0:_.root();return p!=null?console.log(p.debugString()):console.log("Document root not found \u{1F630}"),p},logAndGetBaseScreen:()=>{let m=t.state().baseScreenNode();return m!=null?console.log(m.debugString()):console.log("Base screen not found \u{1F630}"),m},logAndGetNode:m=>{var T;let p,_=(T=t.state().scene())==null?void 0:T.findNode2(m);return _!=null?console.log(_.debugString()):console.log(`Node with id ${m!=null?m:"null"} not found!`),_},logAndGetNodeByStablePath:m=>{var T;let p,_=(T=t.state().scene())==null?void 0:T.findNode3(wt.fromString(m));return _!=null?console.log(_.debugString()):console.log(`Node with stablePath ${m!=null?m:"null"} not found!`),_},logAndGetRenderTree:m=>{var k,j,te;let p,_,T,N=(k=t.state().scene())==null?void 0:k.findNode2(m);return N!=null?console.log((te=(j=N.renderTree1())==null?void 0:j.debugString1())!=null?te:"null"):console.log(`Node with id ${m!=null?m:"null"} not found!`),N.renderTree1()},logFakeError:m=>{Uu(m)},setDebugUserChanges:m=>{Lr.debugUserChanges=m},fulfilledMultiplayerQueries:()=>n.fulfilledMultiplayerQueries(),ICSemanticStorageTrie:()=>{console.log(t.state().prototypeState().componentStateSyncer.debugString())},VideoSemanticStorageTrie:()=>{console.log(t.state().videoManager().runtimeStorage().toString1())}};Q.getFeatureFlags().internalDebugTools&&(window.DebuggingHelpers=v);let b={setObservingSessionID:m=>{if(!xa(m))throw new Error("Missing sessionID");let p=m|0;p!=n.observingSessionID()&&(n.setObservingSessionID(p),r.setPreviewToObservedFrameOrOverlay(!1),e.trigger("multiplayerUserInfoChange",r.userInfoJSON()),t.canvasView().viewport().invalidate())},nominatePresenter:m=>{if(!xa(m))throw new Error("Missing sessionID");n.nominatePresenter(m|0)},cancelPresenterNomination:m=>{if(!xa(m))throw new Error("Missing sessionID");n.cancelPresenterNomination(m|0)},startPresenting:()=>{n.startPresenting()},stopPresenting:()=>{n.stopPresenting()},adjustZoom:(m,p)=>{t.canvasView().viewport().adjustCameraZoom2(1,m,p)},setZoom:(m,p)=>{t.canvasView().viewport().setCameraZoom(1,m)},zoomToNode:(m,p)=>{var N;let _,T=(N=t.state().scene())==null?void 0:N.findNode1(R.fromString(m));T!=null&&(t.state().setActiveCanvas(T.canvas()),t.canvasView().viewport().zoomToFit1(1,T.canvasSpaceBoundingBox(),p))},getZoomBounds:()=>({min:$r.ZOOM_MIN,max:$r.ZOOM_MAX}),setCanvasSpaceCenter:(m,p)=>{let _=new I(-1*m.x,-1*m.y);t.canvasView().viewport().setCameraOffset2(1,_,p)},setCanvasSpaceCenterWithScroll:m=>{var Y;let p,_=new I(m.x,m.y),T=(Y=t.state().baseScreenNode())==null?void 0:Y.canvasSpaceBoundingBox();if(T==null)return;let N=Math.max(_.x()-T.x(),0),k=Math.max(_.y()-T.y(),0),j=Math.max(N-T.width()/2,0),te=Math.max(k-T.height()/2,0);if(N!=0||k!=0){let _e=new I(j,te);t.canvasView().updateScrollOffsetForNode(t.state().prototypeState().getTopmostScreen(),_e)}},setScrollPadding:m=>{t.canvasView().setScrollPadding(+m.left,+m.top,+m.right,+m.bottom)},setScrollToPan:m=>{Q.setScrollToPan(m)},setDragToPan:m=>{Q.setDragToPan(m)},injectVideoJsLib:m=>{ro.instance().onLoadComplete(m)},connectTo:(m,p)=>{let _=new al(er.instance,$i.instance,er.instance);p(_).then(T=>{let N=T.cppModules;t.state().setFontListPromise(T.fontListPromise),Q.getFeatureFlags().internalDebugTools&&(v.fullscreen=N==null?void 0:N.sharedDebuggingHelpers,window.DebuggingHelpers=v);let k=m.fileKey,j=R.fromString(m.nodeId);R.isRoot(j)&&(j=null),Q.getViewerMode()==Q.ViewerMode.MIRROR&&a!=null?a.connectToFileAndShowNode(k,j,R.fromString(m.startingPointNodeId),m.oauthToken,m.interactiveComponentsEnabled?0:1,!!m.renderDots,N):t.connectTo(k,j,R.fromString(m.startingPointNodeId),m.oauthToken,m.interactiveComponentsEnabled?0:1,!!m.renderDots,N)})},openFileKey:()=>{var p;let m;return(p=n.fileKey())!=null?p:t.state().currentFileKey()},isConnected:()=>n.isConnected(),hasActiveScene:()=>t.state().scene()!=null,unloadSceneForTesting:()=>{n.disconnect(),t.state().prototypeState().resetPrototype(),t.state().setScene(null)},disconnectForTesting:()=>{n.disconnect()},reconnectForTesting:()=>{n.attemptReconnect()},enforceValidPrototypeStateForTesting:()=>{t.state().prototypeState().enforceValidPrototypeStateForTesting()},deleteNodeForTesting:m=>{let p=t.state().scene();if(p==null)throw new Error("No current scene");p.removeNode(R.fromString(m))},translateNodeForTesting:(m,p,_)=>{let T=t.state().scene();if(T==null)throw new Error("No current scene");let N=T.findNode2(m);if(N==null)throw new Error("Node not found");let k=N.relativeTransform().clone();k.translate2(p,_),N.setRelativeTransform(k)},addCanvasViewScrollObserverForTesting:m=>{let p=new Tu(null,_=>{m(_.scrollOffset().x(),_.scrollOffset().y())});y.push(p),t.canvasView().addObserver(p)},clearCanvasViewScrollObserversForTesting:()=>{for(let m of y)t.canvasView().removeObserver(m);y=[]},sendMultiplayerNodeChangesForTesting:m=>{let p=t.state().scene();if(p==null)throw new Error("No current scene");let _=Se.schema.encodeMessage(m);p.applyMessageToScene(_)},setMockEmbedListener:m=>{Pi.setMockListener(m)},setMaximumDrawingBufferSizeForTesting:m=>{t.canvasView().setMaximumDrawingBufferSizeForTesting(m)},clearMaximumDrawingBufferSizeForTesting:()=>{t.canvasView().clearMaximumDrawingBufferSizeForTesting()},triggerResizeForTesting:()=>{t.canvasView().triggerResizeForTesting()},reset:()=>{t.state().prototypeState().resetState(),t.unloadSceneAndResetPrototypeLib()},loadFile:(m,p)=>{let _=new al(er.instance,$i.instance,er.instance);p(_).then(T=>{let N=T.cppModules;t.state().setFontListPromise(T.fontListPromise),t.initializePrototypeLib(N),Q.getFeatureFlags().internalDebugTools&&(v.fullscreen=N==null?void 0:N.debuggingHelpers,window.DebuggingHelpers=v);let k=m.bytes,j=R.fromString(m.nodeId);R.isRoot(j)&&(j=null);let te=m.startingPointNodeId,Y=m.imagePrefixURL,_e=m.videoPrefixURL,ce=m.interactiveComponentsEnabled,V=m.renderDots;typeof Y=="string"&&At.setImagePrefixURL(Y),typeof _e=="string"&&At.setVideoPrefixUrl(_e),t.state().serialization().decodeSceneForViewerAndPrototypeLib2(k,ce?0:1,"DUMMY_FILE_KEY").then1(H=>{if(n.disconnect(),t.state().prototypeState().resetPrototype(),t.state().setScene(H),t.state().setRenderDots(!!V),t.canvasView().setBackgroundEnabled(!V),H.setAllTlfsLoaded(),Q.getViewerMode()==Q.ViewerMode.PROTOTYPE){let M=t.state().scene().findNode1(j);if(M==null){let P=t.state().scene().findNode1(R.fromString(te));if(P!=null&&P.isTopLevel()&&Ua(P)&&(M=P),M==null){let J=t.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();J.length>0&&(M=t.state().scene().findNode1(R.fromString(J[0])))}}t.state().setActivePrototypeStartingPointNodeId(R.fromString(te));let K=t.state().prototypeStructure().nodeToRestartPrototypeOn(t.state().getActiveCanvas()),U=M==null?void 0:M.topLevelAncestor();if(U!=null)t.state().prototypeState().navigateToFrameAndCloseOverlays1(U.id());else if(K!=null)t.state().prototypeState().navigateToFrameAndCloseOverlays1(K.id());else if(!di)throw new Error("Calling loadFile in PROTOTYPE mode but with a file that isn't a valid prototype")}t.state().fontListPromise().then(M=>{e.trigger("sceneDidCompleteInitialLoad",null)})})})},navigateForward:()=>{t.canvasView().navigateForward(19)},navigateBackward:()=>{t.canvasView().navigateBackward(18)},navigateToFrameAndCloseOverlays:m=>{let p=R.fromString(m);p!=null&&t.state().prototypeState().navigateToFrameAndCloseOverlays1(p)},restartPrototype:()=>{t.state().prototypeState().restartPrototype(1)},forceFrame:()=>{t.window().forceFrame!=null&&Sl(()=>{t.window().forceFrame()})},setScalingMode:m=>{if(typeof m!="string")throw new Error("Expected string");Vr(m)=="free"&&console.warn("setScalingMode('free') called "),t.state().prototypeState().setFitModeFromParameter(Vr(m)),t.state().prototypeState().getCurrentFitMode()==3&&t.canvasView().viewport().setCameraZoom(0,1)},setTransitionOnClick:m=>{t.state().prototypeState().setTransitionOnClick(m)},setShowHotspots:m=>{t.canvasView().setShowHotspots(m)},toggleInteractionRecording:m=>{m?E_(t,e):t.window().clearAfterNotify()},getBackgroundColor:()=>Cg(t),getPrototypeBackgroundColor:()=>Ng(t),getPrototypeStartNodeId:()=>{let m=null,p=t.state().prototypeStructure().topLevelPrototypeStartingPointNodeIdsSorted();return p.length>0&&(m=R.fromString(p[0])),m==null||!R.isValid(m)?null:R.toString(m)},getActivePrototypeStartingPointNodeId:()=>{let m=t.state().activePrototypeStartingPointNodeId();return m==null||!R.isValid(m)?null:R.toString(m)},setActivePrototypeStartingPointNodeId:m=>{let p=R.fromString(m);t.state().activePrototypeStartingPointNodeId()!=p&&t.state().setActivePrototypeStartingPointNodeId(p)},prototypeStartingPointsData:()=>{let m=t.state().prototypeStructure();return m==null?null:m.prototypeStartingPointsData()},getBaseScreenId:()=>{let m;return(m=t.state().baseScreenId())!=null?R.toString(m):null},getCurrentOverlayIdsForTesting:()=>t.state().prototypeState().getCurrentOverlayIds().map(m=>R.toString(m)),getOnscreenStatesForTesting:()=>t.state().prototypeState().getOnscreenStates().map(m=>({stablePath:m.a.guids.map(p=>R.toString(p)),stateId:R.toString(m.b)})),pageIdForNodeId:m=>{let p,_=t.state().scene();if(_==null)return null;let T=_.findNode2(m);return(p=T==null?void 0:T.findContainingCanvasOrSelf())!=null?R.toString(p.id()):null},prototypeType:()=>{let m=t.state().prototypeStructure();return m==null||m.currentType()==1?"FRAME_LIST":"NONLINEAR"},requestPage:m=>{var N;let p,_=R.fromString(m),T=(N=t.state().scene())==null?void 0:N.findNode1(_);T!=null&&T.type()=="CANVAS"&&t.state().requestSetActiveCanvas(T)},setCurrentPageId:m=>{var N;let p,_=R.fromString(m),T=(N=t.state().scene())==null?void 0:N.findNode1(_);T!=null&&T.type()=="CANVAS"&&t.state().setActiveCanvas(T)},getCurrentPageId:()=>{let m,p=t.state().getActiveCanvas();return(m=p==null?void 0:p.findContainingCanvasOrSelf())!=null?R.toString(m.id()):null},getNodesToShowInPrototype:()=>t.state().prototypeStructure().topLevelPrototypeNodesInOrder(),getStatsForAnalytics:()=>{let m=t.state().getActiveCanvas();if(m==null)throw new Error("Asking for stats without an active canvas");let p=m.prototypeDevice();return{pageId:R.toString(m.id()),deviceType:p.type,presetIdentifier:p.presetIdentifier,graphicsCardName:t.canvasView().graphicsCardName(),isHardwareAccelerationDisabled:C.isUsingSoftwareRenderer(t.canvasView().getContext()),isHighDPR:Q.isHighDPR(),fastImageDecode:Un.browserSupportsFastImageDecoding()}},getPrototypeDeviceType:()=>{let m=t.state().getActiveCanvas();return m==null?(ze("Asking for prototype device type without a playback canvas"),"NONE"):m.prototypeDevice().type},getCurrentTlfBounds:()=>{var T;let m,p=(T=t.state().baseScreenNode())==null?void 0:T.canvasSpaceBoundingBox(),_=B.new2();return p==null?null:(p.transformInto2(_,t.canvasView().canvasSpaceToWindowSpace()),xu(_))},setUserDidAttemptZoom:m=>{t.canvasView().userDidAttemptZoom=p=>{m(Tc[p])}},getCanvasSpaceBoundsByNodeId:m=>{let p={},_=t.state().scene();if(_==null)throw new Error("No current scene");for(let T of m){let N=R.fromString(T);if(N==null)continue;let k=_.findNode1(N);if(k==null)continue;let j=k.canvasSpaceBoundingBox();p[T]=new Map([["x",j.x()],["y",j.y()],["width",j.width()],["height",j.height()]])}return p},watchBoundsForNodes:m=>{let p=v_(m);o.setNodesWithComments(p)},getPrototypeStateCurrentIndex:()=>t.state().prototypeState().getCurrentBaseScreenIndex(),getNavigateForwardEnabled:()=>t.state().prototypeStructure().currentType()==1?t.state().prototypeState().getNextBaseScreenIdForFrameList()!=null:t.state().prototypeState().getNextBaseScreenIdForPrototype()!=null,getNavigateBackwardEnabled:()=>t.state().prototypeState().getPreviousBaseScreenId()!=null,getPages:()=>i.pages(),viewport:()=>{let m=t.canvasView().viewport(),p=m.offset(),_=m.zoomScale();return{offset:{x:p.x(),y:p.y()},zoomScale:_}},getStatsForDebugging:()=>Rn.getStatsForDebugging(),on:e.on,off:e.off,trigger:e.trigger,playbackInteraction:m=>{if(c==2){let p=is.deserialize(m,h,S,u);t.window().notify(p)}},setNewContainerElement:m=>{t.window().setNewContainerElement(m)},canvasViewCursorForTesting:()=>el[t.canvasView().cursor()],lastTopLevelTransitionPropertiesForTesting:()=>{let m=t.state().prototypeState().lastInitiatedTopLevelStateChange();return m==null||m.transitionParameters==null?null:{type:m.transitionParameters.transitionType,durationSeconds:m.transitionParameters.transitionDuration}},lastICTransitionPropertiesForTesting:()=>{let m=t.state().prototypeState().lastInitiatedInstanceStateChange();return m==null||m.transitionParameters==null?null:{type:m.transitionParameters.transitionType,durationSeconds:m.transitionParameters.transitionDuration}},scrollOffsetForNodeInBaseScreenForTesting:m=>{let p=t.state().scene();if(p==null)return{};let _=p.findNode2(m);return _!=null?_.scrollOffset().toJSON():I.new2().toJSON()},scrollOffsetForNodeInOverlayAtForTesting:(m,p)=>{let _=t.state().scene();if(_==null)return{};let T=_.findNode2(m);return T!=null?T.scrollOffset().toJSON():I.new2().toJSON()},getCanvasSpaceCommentLocations:m=>{let p=t.state().scene();if(p==null)return{};let _=new Map;for(let T in m)_.set(T,ea.fromJSON(m[T]));return o.getCanvasSpaceCommentLocations(p,_)},getCommentDestinationAtPosition:m=>{let p=new I(m.x,m.y),_=o.getCommentDestinationAtPosition(p);return _==null?null:_.toJSON()},isWaitingForDeviceFrameToLoadForTesting:()=>{var _;let m,p=t.state().getActiveCanvas();return p==null?!1:(_=t.canvasView().deviceRenderer())==null?void 0:_.isWaitingForDeviceFrameToLoad(p.prototypeDevice())},prototypeViewHitTest:m=>{let p=new I(m.x,m.y),_=t.state().baseScreenNode();return _==null?{type:"NONE"}:t.canvasView().hitTestDeviceFrame(p)?{type:"DEVICE_FRAME"}:_.canvasSpaceBoundingBox().contains2(p)?{type:"CURRENT_TLF"}:{type:"PROTOTYPE_BACKGROUND"}},getPrototypeNode:m=>{var _;let p;return(_=t.state().scene())==null?void 0:_.findNode2(m)},getTopmostFrameNode:m=>t.state().prototypeState().getTopmostScreen(),mapChildren:(m,p)=>{let _=[];if(m.isStack())for(let T=0,N=m.childCount();T<N;T=T+1)_.push(p(m.childAt1(T)));else for(let T=0,N=m.childCount();T<N;T=T+1)_.push(p(m.childAt1(m.childCount()-T-1)));return _},nodeId:m=>R.toString(m.id()),nodeName:m=>m.name(),nodeParent:m=>m.parent(),nodeType:m=>m.type(),nodeCanvasSpaceBounds:m=>xu(m.canvasSpacePreviewBounds()),nodeDisplayBounds:m=>{let p=null;if(m.parent().type()=="CANVAS"){let _=t.state().prototypeState().getOpenOverlayData(m.id());_!=null?p=_.renderedBounds(t.state().prototypeState().getCurrentBaseScreenNode()):p=m.canvasSpaceScrolledBounds(1),p=t.canvasView().viewport().canvasSpaceToViewSpace1().transformRect(p.clone())}else{let _=m.fullSize(),T=new B(0,0,_.x(),_.y()),N=m.relativeTransform().clone(),k=ee.new2();k.scale2(t.canvasView().viewport().canvasSpaceToViewSpace1().scale()),N.leftMultiply(k),p=N.transformRect(T)}return xu(p)},nodeFillTypes:m=>m.fillPaints().map(p=>p.type()),nodeInteractions:m=>m.prototypeInteractions().filter(p=>p.action()!=null&&p.action().value.connectionType()!="NONE").map(p=>A_(p)),nodeScrollBounds:m=>{let p=null;if(m.hasOverflowingContentInScrollDirection()){let _=m.canvasSpaceContentBounds(),T=m.scrollOffset();p={x:T.x(),y:T.y(),width:_.width(),height:_.height()}}return p},nodeScrollTo:(m,p,_)=>{m.setScrollOffset(new I(p,_))},nodeText:m=>{var _;let p;return(_=m==null?void 0:m.textData())==null?void 0:_.characters()},nodeVisible:m=>m==null?!1:m.visible(),nodeAccessibilityProperties:m=>({role:m.ariaRole(),label:m.accessibleLabel()}),nodeCharacterStyles:m=>{var j,te,Y,_e;let p,_,T,N,k=(j=m==null?void 0:m.textData())==null?void 0:j.characters();if(k!=null){let ce=_n._new();_n.set(ce,5,m.get2(5));let V=(te=m==null?void 0:m.textData())==null?void 0:te.characterStyleIds(),H=(_e=(Y=m==null?void 0:m.textData())==null?void 0:Y.styleOverrideTable())!=null?_e:new Yn,M=V!=null?V.length:0,K=0,U=0,P=[],J=(z,O,G)=>{let L,$,se=new Map;_n.each(ce,(nt,ot)=>{se.set(Rt[nt],ot)}),(L=($=H==null?void 0:H.styleByID2())!=null?Ht.IntMap_get($,G,null):null)!=null&&_n.each(L,(nt,ot)=>{se.set(Rt[nt],ot)}),P.push({start:z,end:O,props:se})};for(let z=0,O=k.length;z<O;z=z+1){let G=M>z?V[z]:0;H._in(G)||(G=0),K!=G&&(J(U,z,K),K=G,U=z)}return J(U,k.length,K),P}else return[]},nodeLineData:m=>{var T;let p,_=(T=m==null?void 0:m.textData())==null?void 0:T.lines();return _!=null?_.map(N=>({indentLevel:N.indentationLevel,lineType:N.lineType})):null},nodeTriggerInteraction:(m,p)=>{let _=0;p=="ON_CLICK"&&(_=4);let T=t.state().prototypeStructure().findHotspotsWithInteractionType(m,0,p);for(let N of T){let k=t.state().prototypeStructure().findPrototypeInteractionsWithInteractionType(N.node,p);for(let j of k){t.canvasView().triggerHotspot(N,j,_,null);return}}},nodeHover:m=>{let p=new Eo(m);t.canvasView().handleHoverAtHotspot(p)},nodeReverseHover:m=>{let p=new Eo(m);t.canvasView().handleReverseHoverAtHotspot(p)},nodeTableCells:m=>{if(m.type()!="TABLE")return null;let p=[];for(let _=0,T=m.childCount();_<T;_=_+1)p.push(m.childAt1(m.childCount()-_-1));return p},nodeTableCellContent:m=>{var T,N;let p,_;return m.type()!="TABLE_CELL"?null:(N=(T=m.childAt1(0))==null?void 0:T.textData())==null?void 0:N.characters()},getCurrentOverlayStack:()=>t.state().prototypeState().getCurrentOverlays().map(m=>m.node()),setFeatureFlagsForTesting:m=>{Q.setFeatureFlags(m)},setPrototypeBackgroundColorOverride:m=>{let p=E.new2(m>>16&255,m>>8&255,m&255,255);Q.setPrototypeBackgroundColorOverride(new fe(p))},resetStateForTests:()=>{t.canvasView().resetStateForTests()},takeSpectorSnapshot:()=>{t.canvasView().viewport().invalidate(),t.canvasView().getContext().takeSpectorSnapshot()},clearTileCachesAndTakeSpectorSnapshot:()=>{t.canvasView().viewport().invalidate(),t.canvasView().clearTileCaches(),t.canvasView().getContext().takeSpectorSnapshot()},renderLayerByLayerActivate:()=>{!Q.internalDebugTools()||(t.canvasView().viewport().invalidate(),t.canvasView().clearTileCaches(),t.canvasView().renderLayerByLayerActivate())},renderLayerByLayerDeactivate:()=>{!Q.internalDebugTools()||t.canvasView().renderLayerByLayerDeactivate()},renderLayerByLayerPlay:()=>{!Q.internalDebugTools()||t.canvasView().renderLayerByLayerPlay()},renderLayerByLayerPause:()=>{!Q.internalDebugTools()||t.canvasView().renderLayerByLayerPause()},renderLayerByLayerForward:()=>{!Q.internalDebugTools()||t.canvasView().renderLayerByLayerForward()},renderLayerByLayerBackward:()=>{!Q.internalDebugTools()||t.canvasView().renderLayerByLayerBackward()},renderLayerByLayerRewind:()=>{!Q.internalDebugTools()||t.canvasView().renderLayerByLayerRewind()},renderLayerByLayerIncreaseSpeed:()=>{!Q.internalDebugTools()||t.canvasView().renderLayerByLayerIncreaseSpeed()},renderLayerByLayerDecreaseSpeed:()=>{!Q.internalDebugTools()||t.canvasView().renderLayerByLayerDecreaseSpeed()},toggleRenderTreePrinting:()=>{!Q.internalDebugTools()||t.canvasView().toggleRenderTreePrinting()}};return er.instance.setViewer(b),b}function N_(){return new al(er.instance,$i.instance,er.instance)}function O_(){let g=window,e=g.Fig;e||(g.Fig=e={}),e.createViewer=t=>{if(delete e.createViewer,!(t instanceof Object))throw new Error("Missing parameters");return C_(t)},e.getPrototypeAppBindingsForTest=()=>(delete e.getPrototypeAppBindingsForTest,N_())}function Pg(){console.debug("viewer build: sk"),O_()}var Rr=!1,Si=!1;console.log("Using the TS viewer!");Pg();})();
//!!!!!!!!!!!!!!!!!!!!!!
//# sourceMappingURL=https://admin.figma.com/admin/viewerbuild-artifacts/59c77ca4be933a630bb1d0c3ef3a9c7c751e2808/ts-viewer.js.map
/* pako 1.0.3 nodeca/pako */
var pako=(function(){return function t(e,a,i){function n(s,o){if(!a[s]){if(!e[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(r)return r(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var d=a[s]={exports:{}};e[s][0].call(d.exports,function(t){var a=e[s][1][t];return n(a?a:t)},d,d.exports,t,e,a,i)}return a[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,e,a){"use strict";function i(t){if(!(this instanceof i))return new i(t);this.options=l.assign({level:w,method:v,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var a=o.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(a!==b)throw new Error(d[a]);if(e.header&&o.deflateSetHeader(this.strm,e.header),e.dictionary){var n;if(n="string"==typeof e.dictionary?h.string2buf(e.dictionary):"[object ArrayBuffer]"===_.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,a=o.deflateSetDictionary(this.strm,n),a!==b)throw new Error(d[a]);this._dict_set=!0}}function n(t,e){var a=new i(e);if(a.push(t,!0),a.err)throw a.msg;return a.result}function r(t,e){return e=e||{},e.raw=!0,n(t,e)}function s(t,e){return e=e||{},e.gzip=!0,n(t,e)}var o=t("./zlib/deflate"),l=t("./utils/common"),h=t("./utils/strings"),d=t("./zlib/messages"),f=t("./zlib/zstream"),_=Object.prototype.toString,u=0,c=4,b=0,g=1,m=2,w=-1,p=0,v=8;i.prototype.push=function(t,e){var a,i,n=this.strm,r=this.options.chunkSize;if(this.ended)return!1;i=e===~~e?e:e===!0?c:u,"string"==typeof t?n.input=h.string2buf(t):"[object ArrayBuffer]"===_.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new l.Buf8(r),n.next_out=0,n.avail_out=r),a=o.deflate(n,i),a!==g&&a!==b)return this.onEnd(a),this.ended=!0,!1;0!==n.avail_out&&(0!==n.avail_in||i!==c&&i!==m)||("string"===this.options.to?this.onData(h.buf2binstring(l.shrinkBuf(n.output,n.next_out))):this.onData(l.shrinkBuf(n.output,n.next_out)))}while((n.avail_in>0||0===n.avail_out)&&a!==g);return i===c?(a=o.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===b):i!==m||(this.onEnd(b),n.avail_out=0,!0)},i.prototype.onData=function(t){this.chunks.push(t)},i.prototype.onEnd=function(t){t===b&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},a.Deflate=i,a.deflate=n,a.deflateRaw=r,a.gzip=s},{"./utils/common":3,"./utils/strings":4,"./zlib/deflate":8,"./zlib/messages":13,"./zlib/zstream":15}],2:[function(t,e,a){"use strict";function i(t){if(!(this instanceof i))return new i(t);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0===(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var a=s.inflateInit2(this.strm,e.windowBits);if(a!==h.Z_OK)throw new Error(d[a]);this.header=new _,s.inflateGetHeader(this.strm,this.header)}function n(t,e){var a=new i(e);if(a.push(t,!0),a.err)throw a.msg;return a.result}function r(t,e){return e=e||{},e.raw=!0,n(t,e)}var s=t("./zlib/inflate"),o=t("./utils/common"),l=t("./utils/strings"),h=t("./zlib/constants"),d=t("./zlib/messages"),f=t("./zlib/zstream"),_=t("./zlib/gzheader"),u=Object.prototype.toString;i.prototype.push=function(t,e){var a,i,n,r,d,f,_=this.strm,c=this.options.chunkSize,b=this.options.dictionary,g=!1;if(this.ended)return!1;i=e===~~e?e:e===!0?h.Z_FINISH:h.Z_NO_FLUSH,"string"==typeof t?_.input=l.binstring2buf(t):"[object ArrayBuffer]"===u.call(t)?_.input=new Uint8Array(t):_.input=t,_.next_in=0,_.avail_in=_.input.length;do{if(0===_.avail_out&&(_.output=new o.Buf8(c),_.next_out=0,_.avail_out=c),a=s.inflate(_,h.Z_NO_FLUSH),a===h.Z_NEED_DICT&&b&&(f="string"==typeof b?l.string2buf(b):"[object ArrayBuffer]"===u.call(b)?new Uint8Array(b):b,a=s.inflateSetDictionary(this.strm,f)),a===h.Z_BUF_ERROR&&g===!0&&(a=h.Z_OK,g=!1),a!==h.Z_STREAM_END&&a!==h.Z_OK)return this.onEnd(a),this.ended=!0,!1;_.next_out&&(0!==_.avail_out&&a!==h.Z_STREAM_END&&(0!==_.avail_in||i!==h.Z_FINISH&&i!==h.Z_SYNC_FLUSH)||("string"===this.options.to?(n=l.utf8border(_.output,_.next_out),r=_.next_out-n,d=l.buf2string(_.output,n),_.next_out=r,_.avail_out=c-r,r&&o.arraySet(_.output,_.output,n,r,0),this.onData(d)):this.onData(o.shrinkBuf(_.output,_.next_out)))),0===_.avail_in&&0===_.avail_out&&(g=!0)}while((_.avail_in>0||0===_.avail_out)&&a!==h.Z_STREAM_END);return a===h.Z_STREAM_END&&(i=h.Z_FINISH),i===h.Z_FINISH?(a=s.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===h.Z_OK):i!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),_.avail_out=0,!0)},i.prototype.onData=function(t){this.chunks.push(t)},i.prototype.onEnd=function(t){t===h.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},a.Inflate=i,a.inflate=n,a.inflateRaw=r,a.ungzip=n},{"./utils/common":3,"./utils/strings":4,"./zlib/constants":6,"./zlib/gzheader":9,"./zlib/inflate":11,"./zlib/messages":13,"./zlib/zstream":15}],3:[function(t,e,a){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;a.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var a=e.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(var i in a)a.hasOwnProperty(i)&&(t[i]=a[i])}}return t},a.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var n={arraySet:function(t,e,a,i,n){if(e.subarray&&t.subarray)return void t.set(e.subarray(a,a+i),n);for(var r=0;r<i;r++)t[n+r]=e[a+r]},flattenChunks:function(t){var e,a,i,n,r,s;for(i=0,e=0,a=t.length;e<a;e++)i+=t[e].length;for(s=new Uint8Array(i),n=0,e=0,a=t.length;e<a;e++)r=t[e],s.set(r,n),n+=r.length;return s}},r={arraySet:function(t,e,a,i,n){for(var r=0;r<i;r++)t[n+r]=e[a+r]},flattenChunks:function(t){return[].concat.apply([],t)}};a.setTyped=function(t){t?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,n)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,r))},a.setTyped(i)},{}],4:[function(t,e,a){"use strict";function i(t,e){if(e<65537&&(t.subarray&&s||!t.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var a="",i=0;i<e;i++)a+=String.fromCharCode(t[i]);return a}var n=t("./common"),r=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){s=!1}for(var o=new n.Buf8(256),l=0;l<256;l++)o[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;o[254]=o[254]=1,a.string2buf=function(t){var e,a,i,r,s,o=t.length,l=0;for(r=0;r<o;r++)a=t.charCodeAt(r),55296===(64512&a)&&r+1<o&&(i=t.charCodeAt(r+1),56320===(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),r++)),l+=a<128?1:a<2048?2:a<65536?3:4;for(e=new n.Buf8(l),s=0,r=0;s<l;r++)a=t.charCodeAt(r),55296===(64512&a)&&r+1<o&&(i=t.charCodeAt(r+1),56320===(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),r++)),a<128?e[s++]=a:a<2048?(e[s++]=192|a>>>6,e[s++]=128|63&a):a<65536?(e[s++]=224|a>>>12,e[s++]=128|a>>>6&63,e[s++]=128|63&a):(e[s++]=240|a>>>18,e[s++]=128|a>>>12&63,e[s++]=128|a>>>6&63,e[s++]=128|63&a);return e},a.buf2binstring=function(t){return i(t,t.length)},a.binstring2buf=function(t){for(var e=new n.Buf8(t.length),a=0,i=e.length;a<i;a++)e[a]=t.charCodeAt(a);return e},a.buf2string=function(t,e){var a,n,r,s,l=e||t.length,h=new Array(2*l);for(n=0,a=0;a<l;)if(r=t[a++],r<128)h[n++]=r;else if(s=o[r],s>4)h[n++]=65533,a+=s-1;else{for(r&=2===s?31:3===s?15:7;s>1&&a<l;)r=r<<6|63&t[a++],s--;s>1?h[n++]=65533:r<65536?h[n++]=r:(r-=65536,h[n++]=55296|r>>10&1023,h[n++]=56320|1023&r)}return i(h,n)},a.utf8border=function(t,e){var a;for(e=e||t.length,e>t.length&&(e=t.length),a=e-1;a>=0&&128===(192&t[a]);)a--;return a<0?e:0===a?e:a+o[t[a]]>e?a:e}},{"./common":3}],5:[function(t,e,a){"use strict";function i(t,e,a,i){for(var n=65535&t|0,r=t>>>16&65535|0,s=0;0!==a;){s=a>2e3?2e3:a,a-=s;do n=n+e[i++]|0,r=r+n|0;while(--s);n%=65521,r%=65521}return n|r<<16|0}e.exports=i},{}],6:[function(t,e,a){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],7:[function(t,e,a){"use strict";function i(){for(var t,e=[],a=0;a<256;a++){t=a;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[a]=t}return e}function n(t,e,a,i){var n=r,s=i+a;t^=-1;for(var o=i;o<s;o++)t=t>>>8^n[255&(t^e[o])];return t^-1}var r=i();e.exports=n},{}],8:[function(t,e,a){"use strict";function i(t,e){return t.msg=D[e],e}function n(t){return(t<<1)-(t>4?9:0)}function r(t){for(var e=t.length;--e>=0;)t[e]=0}function s(t){var e=t.state,a=e.pending;a>t.avail_out&&(a=t.avail_out),0!==a&&(R.arraySet(t.output,e.pending_buf,e.pending_out,a,t.next_out),t.next_out+=a,e.pending_out+=a,t.total_out+=a,t.avail_out-=a,e.pending-=a,0===e.pending&&(e.pending_out=0))}function o(t,e){C._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,s(t.strm)}function l(t,e){t.pending_buf[t.pending++]=e}function h(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function d(t,e,a,i){var n=t.avail_in;return n>i&&(n=i),0===n?0:(t.avail_in-=n,R.arraySet(e,t.input,t.next_in,n,a),1===t.state.wrap?t.adler=N(t.adler,e,n,a):2===t.state.wrap&&(t.adler=O(t.adler,e,n,a)),t.next_in+=n,t.total_in+=n,n)}function f(t,e){var a,i,n=t.max_chain_length,r=t.strstart,s=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-ft?t.strstart-(t.w_size-ft):0,h=t.window,d=t.w_mask,f=t.prev,_=t.strstart+dt,u=h[r+s-1],c=h[r+s];t.prev_length>=t.good_match&&(n>>=2),o>t.lookahead&&(o=t.lookahead);do if(a=e,h[a+s]===c&&h[a+s-1]===u&&h[a]===h[r]&&h[++a]===h[r+1]){r+=2,a++;do;while(h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&h[++r]===h[++a]&&r<_);if(i=dt-(_-r),r=_-dt,i>s){if(t.match_start=e,s=i,i>=o)break;u=h[r+s-1],c=h[r+s]}}while((e=f[e&d])>l&&0!==--n);return s<=t.lookahead?s:t.lookahead}function _(t){var e,a,i,n,r,s=t.w_size;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=s+(s-ft)){R.arraySet(t.window,t.window,s,s,0),t.match_start-=s,t.strstart-=s,t.block_start-=s,a=t.hash_size,e=a;do i=t.head[--e],t.head[e]=i>=s?i-s:0;while(--a);a=s,e=a;do i=t.prev[--e],t.prev[e]=i>=s?i-s:0;while(--a);n+=s}if(0===t.strm.avail_in)break;if(a=d(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=a,t.lookahead+t.insert>=ht)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=(t.ins_h<<t.hash_shift^t.window[r+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[r+ht-1])&t.hash_mask,t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<ht)););}while(t.lookahead<ft&&0!==t.strm.avail_in)}function u(t,e){var a=65535;for(a>t.pending_buf_size-5&&(a=t.pending_buf_size-5);;){if(t.lookahead<=1){if(_(t),0===t.lookahead&&e===I)return vt;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+a;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,o(t,!1),0===t.strm.avail_out))return vt;if(t.strstart-t.block_start>=t.w_size-ft&&(o(t,!1),0===t.strm.avail_out))return vt}return t.insert=0,e===F?(o(t,!0),0===t.strm.avail_out?yt:xt):t.strstart>t.block_start&&(o(t,!1),0===t.strm.avail_out)?vt:vt}function c(t,e){for(var a,i;;){if(t.lookahead<ft){if(_(t),t.lookahead<ft&&e===I)return vt;if(0===t.lookahead)break}if(a=0,t.lookahead>=ht&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ht-1])&t.hash_mask,a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==a&&t.strstart-a<=t.w_size-ft&&(t.match_length=f(t,a)),t.match_length>=ht)if(i=C._tr_tally(t,t.strstart-t.match_start,t.match_length-ht),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=ht){t.match_length--;do t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ht-1])&t.hash_mask,a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=C._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(o(t,!1),0===t.strm.avail_out))return vt}return t.insert=t.strstart<ht-1?t.strstart:ht-1,e===F?(o(t,!0),0===t.strm.avail_out?yt:xt):t.last_lit&&(o(t,!1),0===t.strm.avail_out)?vt:kt}function b(t,e){for(var a,i,n;;){if(t.lookahead<ft){if(_(t),t.lookahead<ft&&e===I)return vt;if(0===t.lookahead)break}if(a=0,t.lookahead>=ht&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ht-1])&t.hash_mask,a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=ht-1,0!==a&&t.prev_length<t.max_lazy_match&&t.strstart-a<=t.w_size-ft&&(t.match_length=f(t,a),t.match_length<=5&&(t.strategy===q||t.match_length===ht&&t.strstart-t.match_start>4096)&&(t.match_length=ht-1)),t.prev_length>=ht&&t.match_length<=t.prev_length){n=t.strstart+t.lookahead-ht,i=C._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-ht),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=n&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+ht-1])&t.hash_mask,a=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(0!==--t.prev_length);if(t.match_available=0,t.match_length=ht-1,t.strstart++,i&&(o(t,!1),0===t.strm.avail_out))return vt}else if(t.match_available){if(i=C._tr_tally(t,0,t.window[t.strstart-1]),i&&o(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return vt}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=C._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<ht-1?t.strstart:ht-1,e===F?(o(t,!0),0===t.strm.avail_out?yt:xt):t.last_lit&&(o(t,!1),0===t.strm.avail_out)?vt:kt}function g(t,e){for(var a,i,n,r,s=t.window;;){if(t.lookahead<=dt){if(_(t),t.lookahead<=dt&&e===I)return vt;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=ht&&t.strstart>0&&(n=t.strstart-1,i=s[n],i===s[++n]&&i===s[++n]&&i===s[++n])){r=t.strstart+dt;do;while(i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&n<r);t.match_length=dt-(r-n),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=ht?(a=C._tr_tally(t,1,t.match_length-ht),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(a=C._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),a&&(o(t,!1),0===t.strm.avail_out))return vt}return t.insert=0,e===F?(o(t,!0),0===t.strm.avail_out?yt:xt):t.last_lit&&(o(t,!1),0===t.strm.avail_out)?vt:kt}function m(t,e){for(var a;;){if(0===t.lookahead&&(_(t),0===t.lookahead)){if(e===I)return vt;break}if(t.match_length=0,a=C._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,a&&(o(t,!1),0===t.strm.avail_out))return vt}return t.insert=0,e===F?(o(t,!0),0===t.strm.avail_out?yt:xt):t.last_lit&&(o(t,!1),0===t.strm.avail_out)?vt:kt}function w(t,e,a,i,n){this.good_length=t,this.max_lazy=e,this.nice_length=a,this.max_chain=i,this.func=n}function p(t){t.window_size=2*t.w_size,r(t.head),t.max_lazy_match=Z[t.level].max_lazy,t.good_match=Z[t.level].good_length,t.nice_match=Z[t.level].nice_length,t.max_chain_length=Z[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=ht-1,t.match_available=0,t.ins_h=0}function v(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=V,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new R.Buf16(2*ot),this.dyn_dtree=new R.Buf16(2*(2*rt+1)),this.bl_tree=new R.Buf16(2*(2*st+1)),r(this.dyn_ltree),r(this.dyn_dtree),r(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new R.Buf16(lt+1),this.heap=new R.Buf16(2*nt+1),r(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new R.Buf16(2*nt+1),r(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function k(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=Q,e=t.state,e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?ut:wt,t.adler=2===e.wrap?0:1,e.last_flush=I,C._tr_init(e),H):i(t,K)}function y(t){var e=k(t);return e===H&&p(t.state),e}function x(t,e){return t&&t.state?2!==t.state.wrap?K:(t.state.gzhead=e,H):K}function z(t,e,a,n,r,s){if(!t)return K;var o=1;if(e===Y&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),r<1||r>$||a!==V||n<8||n>15||e<0||e>9||s<0||s>W)return i(t,K);8===n&&(n=9);var l=new v;return t.state=l,l.strm=t,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+ht-1)/ht),l.window=new R.Buf8(2*l.w_size),l.head=new R.Buf16(l.hash_size),l.prev=new R.Buf16(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new R.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=s,l.method=a,y(t)}function B(t,e){return z(t,e,V,tt,et,J)}function S(t,e){var a,o,d,f;if(!t||!t.state||e>L||e<0)return t?i(t,K):K;if(o=t.state,!t.output||!t.input&&0!==t.avail_in||o.status===pt&&e!==F)return i(t,0===t.avail_out?P:K);if(o.strm=t,a=o.last_flush,o.last_flush=e,o.status===ut)if(2===o.wrap)t.adler=0,l(o,31),l(o,139),l(o,8),o.gzhead?(l(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),l(o,255&o.gzhead.time),l(o,o.gzhead.time>>8&255),l(o,o.gzhead.time>>16&255),l(o,o.gzhead.time>>24&255),l(o,9===o.level?2:o.strategy>=G||o.level<2?4:0),l(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(l(o,255&o.gzhead.extra.length),l(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(t.adler=O(t.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=ct):(l(o,0),l(o,0),l(o,0),l(o,0),l(o,0),l(o,9===o.level?2:o.strategy>=G||o.level<2?4:0),l(o,zt),o.status=wt);else{var _=V+(o.w_bits-8<<4)<<8,u=-1;u=o.strategy>=G||o.level<2?0:o.level<6?1:6===o.level?2:3,_|=u<<6,0!==o.strstart&&(_|=_t),_+=31-_%31,o.status=wt,h(o,_),0!==o.strstart&&(h(o,t.adler>>>16),h(o,65535&t.adler)),t.adler=1}if(o.status===ct)if(o.gzhead.extra){for(d=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>d&&(t.adler=O(t.adler,o.pending_buf,o.pending-d,d)),s(t),d=o.pending,o.pending!==o.pending_buf_size));)l(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>d&&(t.adler=O(t.adler,o.pending_buf,o.pending-d,d)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=bt)}else o.status=bt;if(o.status===bt)if(o.gzhead.name){d=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>d&&(t.adler=O(t.adler,o.pending_buf,o.pending-d,d)),s(t),d=o.pending,o.pending===o.pending_buf_size)){f=1;break}f=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,l(o,f)}while(0!==f);o.gzhead.hcrc&&o.pending>d&&(t.adler=O(t.adler,o.pending_buf,o.pending-d,d)),0===f&&(o.gzindex=0,o.status=gt)}else o.status=gt;if(o.status===gt)if(o.gzhead.comment){d=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>d&&(t.adler=O(t.adler,o.pending_buf,o.pending-d,d)),s(t),d=o.pending,o.pending===o.pending_buf_size)){f=1;break}f=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,l(o,f)}while(0!==f);o.gzhead.hcrc&&o.pending>d&&(t.adler=O(t.adler,o.pending_buf,o.pending-d,d)),0===f&&(o.status=mt)}else o.status=mt;if(o.status===mt&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&s(t),o.pending+2<=o.pending_buf_size&&(l(o,255&t.adler),l(o,t.adler>>8&255),t.adler=0,o.status=wt)):o.status=wt),0!==o.pending){if(s(t),0===t.avail_out)return o.last_flush=-1,H}else if(0===t.avail_in&&n(e)<=n(a)&&e!==F)return i(t,P);if(o.status===pt&&0!==t.avail_in)return i(t,P);if(0!==t.avail_in||0!==o.lookahead||e!==I&&o.status!==pt){var c=o.strategy===G?m(o,e):o.strategy===X?g(o,e):Z[o.level].func(o,e);if(c!==yt&&c!==xt||(o.status=pt),c===vt||c===yt)return 0===t.avail_out&&(o.last_flush=-1),H;if(c===kt&&(e===U?C._tr_align(o):e!==L&&(C._tr_stored_block(o,0,0,!1),e===T&&(r(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),s(t),0===t.avail_out))return o.last_flush=-1,H}return e!==F?H:o.wrap<=0?j:(2===o.wrap?(l(o,255&t.adler),l(o,t.adler>>8&255),l(o,t.adler>>16&255),l(o,t.adler>>24&255),l(o,255&t.total_in),l(o,t.total_in>>8&255),l(o,t.total_in>>16&255),l(o,t.total_in>>24&255)):(h(o,t.adler>>>16),h(o,65535&t.adler)),s(t),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?H:j)}function E(t){var e;return t&&t.state?(e=t.state.status,e!==ut&&e!==ct&&e!==bt&&e!==gt&&e!==mt&&e!==wt&&e!==pt?i(t,K):(t.state=null,e===wt?i(t,M):H)):K}function A(t,e){var a,i,n,s,o,l,h,d,f=e.length;if(!t||!t.state)return K;if(a=t.state,s=a.wrap,2===s||1===s&&a.status!==ut||a.lookahead)return K;for(1===s&&(t.adler=N(t.adler,e,f,0)),a.wrap=0,f>=a.w_size&&(0===s&&(r(a.head),a.strstart=0,a.block_start=0,a.insert=0),d=new R.Buf8(a.w_size),R.arraySet(d,e,f-a.w_size,a.w_size,0),e=d,f=a.w_size),o=t.avail_in,l=t.next_in,h=t.input,t.avail_in=f,t.next_in=0,t.input=e,_(a);a.lookahead>=ht;){i=a.strstart,n=a.lookahead-(ht-1);do a.ins_h=(a.ins_h<<a.hash_shift^a.window[i+ht-1])&a.hash_mask,a.prev[i&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=i,i++;while(--n);a.strstart=i,a.lookahead=ht-1,_(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=ht-1,a.match_available=0,t.next_in=l,t.input=h,t.avail_in=o,a.wrap=s,H}var Z,R=t("../utils/common"),C=t("./trees"),N=t("./adler32"),O=t("./crc32"),D=t("./messages"),I=0,U=1,T=3,F=4,L=5,H=0,j=1,K=-2,M=-3,P=-5,Y=-1,q=1,G=2,X=3,W=4,J=0,Q=2,V=8,$=9,tt=15,et=8,at=29,it=256,nt=it+1+at,rt=30,st=19,ot=2*nt+1,lt=15,ht=3,dt=258,ft=dt+ht+1,_t=32,ut=42,ct=69,bt=73,gt=91,mt=103,wt=113,pt=666,vt=1,kt=2,yt=3,xt=4,zt=3;Z=[new w(0,0,0,0,u),new w(4,4,8,4,c),new w(4,5,16,8,c),new w(4,6,32,32,c),new w(4,4,16,16,b),new w(8,16,32,32,b),new w(8,16,128,128,b),new w(8,32,128,256,b),new w(32,128,258,1024,b),new w(32,258,258,4096,b)],a.deflateInit=B,a.deflateInit2=z,a.deflateReset=y,a.deflateResetKeep=k,a.deflateSetHeader=x,a.deflate=S,a.deflateEnd=E,a.deflateSetDictionary=A,a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./messages":13,"./trees":14}],9:[function(t,e,a){"use strict";function i(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}e.exports=i},{}],10:[function(t,e,a){"use strict";var i=30,n=12;e.exports=function(t,e){var a,r,s,o,l,h,d,f,_,u,c,b,g,m,w,p,v,k,y,x,z,B,S,E,A;a=t.state,r=t.next_in,E=t.input,s=r+(t.avail_in-5),o=t.next_out,A=t.output,l=o-(e-t.avail_out),h=o+(t.avail_out-257),d=a.dmax,f=a.wsize,_=a.whave,u=a.wnext,c=a.window,b=a.hold,g=a.bits,m=a.lencode,w=a.distcode,p=(1<<a.lenbits)-1,v=(1<<a.distbits)-1;t:do{g<15&&(b+=E[r++]<<g,g+=8,b+=E[r++]<<g,g+=8),k=m[b&p];e:for(;;){if(y=k>>>24,b>>>=y,g-=y,y=k>>>16&255,0===y)A[o++]=65535&k;else{if(!(16&y)){if(0===(64&y)){k=m[(65535&k)+(b&(1<<y)-1)];continue e}if(32&y){a.mode=n;break t}t.msg="invalid literal/length code",a.mode=i;break t}x=65535&k,y&=15,y&&(g<y&&(b+=E[r++]<<g,g+=8),x+=b&(1<<y)-1,b>>>=y,g-=y),g<15&&(b+=E[r++]<<g,g+=8,b+=E[r++]<<g,g+=8),k=w[b&v];a:for(;;){if(y=k>>>24,b>>>=y,g-=y,y=k>>>16&255,!(16&y)){if(0===(64&y)){k=w[(65535&k)+(b&(1<<y)-1)];continue a}t.msg="invalid distance code",a.mode=i;break t}if(z=65535&k,y&=15,g<y&&(b+=E[r++]<<g,g+=8,g<y&&(b+=E[r++]<<g,g+=8)),z+=b&(1<<y)-1,z>d){t.msg="invalid distance too far back",a.mode=i;break t}if(b>>>=y,g-=y,y=o-l,z>y){if(y=z-y,y>_&&a.sane){t.msg="invalid distance too far back",a.mode=i;break t}if(B=0,S=c,0===u){if(B+=f-y,y<x){x-=y;do A[o++]=c[B++];while(--y);B=o-z,S=A}}else if(u<y){if(B+=f+u-y,y-=u,y<x){x-=y;do A[o++]=c[B++];while(--y);if(B=0,u<x){y=u,x-=y;do A[o++]=c[B++];while(--y);B=o-z,S=A}}}else if(B+=u-y,y<x){x-=y;do A[o++]=c[B++];while(--y);B=o-z,S=A}for(;x>2;)A[o++]=S[B++],A[o++]=S[B++],A[o++]=S[B++],x-=3;x&&(A[o++]=S[B++],x>1&&(A[o++]=S[B++]))}else{B=o-z;do A[o++]=A[B++],A[o++]=A[B++],A[o++]=A[B++],x-=3;while(x>2);x&&(A[o++]=A[B++],x>1&&(A[o++]=A[B++]))}break}}break}}while(r<s&&o<h);x=g>>3,r-=x,g-=x<<3,b&=(1<<g)-1,t.next_in=r,t.next_out=o,t.avail_in=r<s?5+(s-r):5-(r-s),t.avail_out=o<h?257+(h-o):257-(o-h),a.hold=b,a.bits=g}},{}],11:[function(t,e,a){"use strict";function i(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new w.Buf16(320),this.work=new w.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function r(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=T,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new w.Buf32(bt),e.distcode=e.distdyn=new w.Buf32(gt),e.sane=1,e.back=-1,Z):N}function s(t){var e;return t&&t.state?(e=t.state,e.wsize=0,e.whave=0,e.wnext=0,r(t)):N}function o(t,e){var a,i;return t&&t.state?(i=t.state,e<0?(a=0,e=-e):(a=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?N:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=a,i.wbits=e,s(t))):N}function l(t,e){var a,i;return t?(i=new n,t.state=i,i.window=null,a=o(t,e),a!==Z&&(t.state=null),a):N}function h(t){return l(t,wt)}function d(t){if(pt){var e;for(g=new w.Buf32(512),m=new w.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(y(z,t.lens,0,288,g,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;y(B,t.lens,0,32,m,0,t.work,{bits:5}),pt=!1}t.lencode=g,t.lenbits=9,t.distcode=m,t.distbits=5}function f(t,e,a,i){var n,r=t.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new w.Buf8(r.wsize)),i>=r.wsize?(w.arraySet(r.window,e,a-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(n=r.wsize-r.wnext,n>i&&(n=i),w.arraySet(r.window,e,a-i,n,r.wnext),i-=n,i?(w.arraySet(r.window,e,a-i,i,0),r.wnext=i,r.whave=r.wsize):(r.wnext+=n,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=n))),0}function _(t,e){var a,n,r,s,o,l,h,_,u,c,b,g,m,bt,gt,mt,wt,pt,vt,kt,yt,xt,zt,Bt,St=0,Et=new w.Buf8(4),At=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return N;a=t.state,a.mode===X&&(a.mode=W),o=t.next_out,r=t.output,h=t.avail_out,s=t.next_in,n=t.input,l=t.avail_in,_=a.hold,u=a.bits,c=l,b=h,xt=Z;t:for(;;)switch(a.mode){case T:if(0===a.wrap){a.mode=W;break}for(;u<16;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}if(2&a.wrap&&35615===_){a.check=0,Et[0]=255&_,Et[1]=_>>>8&255,a.check=v(a.check,Et,2,0),_=0,u=0,a.mode=F;break}if(a.flags=0,a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&_)<<8)+(_>>8))%31){t.msg="incorrect header check",a.mode=_t;break}if((15&_)!==U){t.msg="unknown compression method",a.mode=_t;break}if(_>>>=4,u-=4,yt=(15&_)+8,0===a.wbits)a.wbits=yt;else if(yt>a.wbits){t.msg="invalid window size",a.mode=_t;break}a.dmax=1<<yt,t.adler=a.check=1,a.mode=512&_?q:X,_=0,u=0;break;case F:for(;u<16;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}if(a.flags=_,(255&a.flags)!==U){t.msg="unknown compression method",a.mode=_t;break}if(57344&a.flags){t.msg="unknown header flags set",a.mode=_t;break}a.head&&(a.head.text=_>>8&1),512&a.flags&&(Et[0]=255&_,Et[1]=_>>>8&255,a.check=v(a.check,Et,2,0)),_=0,u=0,a.mode=L;case L:for(;u<32;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}a.head&&(a.head.time=_),512&a.flags&&(Et[0]=255&_,Et[1]=_>>>8&255,Et[2]=_>>>16&255,Et[3]=_>>>24&255,a.check=v(a.check,Et,4,0)),_=0,u=0,a.mode=H;case H:for(;u<16;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}a.head&&(a.head.xflags=255&_,a.head.os=_>>8),512&a.flags&&(Et[0]=255&_,Et[1]=_>>>8&255,a.check=v(a.check,Et,2,0)),_=0,u=0,a.mode=j;case j:if(1024&a.flags){for(;u<16;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}a.length=_,a.head&&(a.head.extra_len=_),512&a.flags&&(Et[0]=255&_,Et[1]=_>>>8&255,a.check=v(a.check,Et,2,0)),_=0,u=0}else a.head&&(a.head.extra=null);a.mode=K;case K:if(1024&a.flags&&(g=a.length,g>l&&(g=l),g&&(a.head&&(yt=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Array(a.head.extra_len)),w.arraySet(a.head.extra,n,s,g,yt)),512&a.flags&&(a.check=v(a.check,n,g,s)),l-=g,s+=g,a.length-=g),a.length))break t;a.length=0,a.mode=M;case M:if(2048&a.flags){if(0===l)break t;g=0;do yt=n[s+g++],a.head&&yt&&a.length<65536&&(a.head.name+=String.fromCharCode(yt));while(yt&&g<l);if(512&a.flags&&(a.check=v(a.check,n,g,s)),l-=g,s+=g,yt)break t}else a.head&&(a.head.name=null);a.length=0,a.mode=P;case P:if(4096&a.flags){if(0===l)break t;g=0;do yt=n[s+g++],a.head&&yt&&a.length<65536&&(a.head.comment+=String.fromCharCode(yt));while(yt&&g<l);if(512&a.flags&&(a.check=v(a.check,n,g,s)),l-=g,s+=g,yt)break t}else a.head&&(a.head.comment=null);a.mode=Y;case Y:if(512&a.flags){for(;u<16;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}if(_!==(65535&a.check)){t.msg="header crc mismatch",a.mode=_t;break}_=0,u=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),t.adler=a.check=0,a.mode=X;break;case q:for(;u<32;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}t.adler=a.check=i(_),_=0,u=0,a.mode=G;case G:if(0===a.havedict)return t.next_out=o,t.avail_out=h,t.next_in=s,t.avail_in=l,a.hold=_,a.bits=u,C;t.adler=a.check=1,a.mode=X;case X:if(e===E||e===A)break t;case W:if(a.last){_>>>=7&u,u-=7&u,a.mode=ht;break}for(;u<3;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}switch(a.last=1&_,_>>>=1,u-=1,3&_){case 0:a.mode=J;break;case 1:if(d(a),a.mode=at,e===A){_>>>=2,u-=2;break t}break;case 2:a.mode=$;break;case 3:t.msg="invalid block type",a.mode=_t}_>>>=2,u-=2;break;case J:for(_>>>=7&u,u-=7&u;u<32;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}if((65535&_)!==(_>>>16^65535)){t.msg="invalid stored block lengths",a.mode=_t;break}if(a.length=65535&_,_=0,u=0,a.mode=Q,e===A)break t;case Q:a.mode=V;case V:if(g=a.length){if(g>l&&(g=l),g>h&&(g=h),0===g)break t;w.arraySet(r,n,s,g,o),l-=g,s+=g,h-=g,o+=g,a.length-=g;break}a.mode=X;break;case $:for(;u<14;){if(0===l)break t;
l--,_+=n[s++]<<u,u+=8}if(a.nlen=(31&_)+257,_>>>=5,u-=5,a.ndist=(31&_)+1,_>>>=5,u-=5,a.ncode=(15&_)+4,_>>>=4,u-=4,a.nlen>286||a.ndist>30){t.msg="too many length or distance symbols",a.mode=_t;break}a.have=0,a.mode=tt;case tt:for(;a.have<a.ncode;){for(;u<3;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}a.lens[At[a.have++]]=7&_,_>>>=3,u-=3}for(;a.have<19;)a.lens[At[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,zt={bits:a.lenbits},xt=y(x,a.lens,0,19,a.lencode,0,a.work,zt),a.lenbits=zt.bits,xt){t.msg="invalid code lengths set",a.mode=_t;break}a.have=0,a.mode=et;case et:for(;a.have<a.nlen+a.ndist;){for(;St=a.lencode[_&(1<<a.lenbits)-1],gt=St>>>24,mt=St>>>16&255,wt=65535&St,!(gt<=u);){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}if(wt<16)_>>>=gt,u-=gt,a.lens[a.have++]=wt;else{if(16===wt){for(Bt=gt+2;u<Bt;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}if(_>>>=gt,u-=gt,0===a.have){t.msg="invalid bit length repeat",a.mode=_t;break}yt=a.lens[a.have-1],g=3+(3&_),_>>>=2,u-=2}else if(17===wt){for(Bt=gt+3;u<Bt;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}_>>>=gt,u-=gt,yt=0,g=3+(7&_),_>>>=3,u-=3}else{for(Bt=gt+7;u<Bt;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}_>>>=gt,u-=gt,yt=0,g=11+(127&_),_>>>=7,u-=7}if(a.have+g>a.nlen+a.ndist){t.msg="invalid bit length repeat",a.mode=_t;break}for(;g--;)a.lens[a.have++]=yt}}if(a.mode===_t)break;if(0===a.lens[256]){t.msg="invalid code -- missing end-of-block",a.mode=_t;break}if(a.lenbits=9,zt={bits:a.lenbits},xt=y(z,a.lens,0,a.nlen,a.lencode,0,a.work,zt),a.lenbits=zt.bits,xt){t.msg="invalid literal/lengths set",a.mode=_t;break}if(a.distbits=6,a.distcode=a.distdyn,zt={bits:a.distbits},xt=y(B,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,zt),a.distbits=zt.bits,xt){t.msg="invalid distances set",a.mode=_t;break}if(a.mode=at,e===A)break t;case at:a.mode=it;case it:if(l>=6&&h>=258){t.next_out=o,t.avail_out=h,t.next_in=s,t.avail_in=l,a.hold=_,a.bits=u,k(t,b),o=t.next_out,r=t.output,h=t.avail_out,s=t.next_in,n=t.input,l=t.avail_in,_=a.hold,u=a.bits,a.mode===X&&(a.back=-1);break}for(a.back=0;St=a.lencode[_&(1<<a.lenbits)-1],gt=St>>>24,mt=St>>>16&255,wt=65535&St,!(gt<=u);){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}if(mt&&0===(240&mt)){for(pt=gt,vt=mt,kt=wt;St=a.lencode[kt+((_&(1<<pt+vt)-1)>>pt)],gt=St>>>24,mt=St>>>16&255,wt=65535&St,!(pt+gt<=u);){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}_>>>=pt,u-=pt,a.back+=pt}if(_>>>=gt,u-=gt,a.back+=gt,a.length=wt,0===mt){a.mode=lt;break}if(32&mt){a.back=-1,a.mode=X;break}if(64&mt){t.msg="invalid literal/length code",a.mode=_t;break}a.extra=15&mt,a.mode=nt;case nt:if(a.extra){for(Bt=a.extra;u<Bt;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}a.length+=_&(1<<a.extra)-1,_>>>=a.extra,u-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=rt;case rt:for(;St=a.distcode[_&(1<<a.distbits)-1],gt=St>>>24,mt=St>>>16&255,wt=65535&St,!(gt<=u);){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}if(0===(240&mt)){for(pt=gt,vt=mt,kt=wt;St=a.distcode[kt+((_&(1<<pt+vt)-1)>>pt)],gt=St>>>24,mt=St>>>16&255,wt=65535&St,!(pt+gt<=u);){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}_>>>=pt,u-=pt,a.back+=pt}if(_>>>=gt,u-=gt,a.back+=gt,64&mt){t.msg="invalid distance code",a.mode=_t;break}a.offset=wt,a.extra=15&mt,a.mode=st;case st:if(a.extra){for(Bt=a.extra;u<Bt;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}a.offset+=_&(1<<a.extra)-1,_>>>=a.extra,u-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){t.msg="invalid distance too far back",a.mode=_t;break}a.mode=ot;case ot:if(0===h)break t;if(g=b-h,a.offset>g){if(g=a.offset-g,g>a.whave&&a.sane){t.msg="invalid distance too far back",a.mode=_t;break}g>a.wnext?(g-=a.wnext,m=a.wsize-g):m=a.wnext-g,g>a.length&&(g=a.length),bt=a.window}else bt=r,m=o-a.offset,g=a.length;g>h&&(g=h),h-=g,a.length-=g;do r[o++]=bt[m++];while(--g);0===a.length&&(a.mode=it);break;case lt:if(0===h)break t;r[o++]=a.length,h--,a.mode=it;break;case ht:if(a.wrap){for(;u<32;){if(0===l)break t;l--,_|=n[s++]<<u,u+=8}if(b-=h,t.total_out+=b,a.total+=b,b&&(t.adler=a.check=a.flags?v(a.check,r,b,o-b):p(a.check,r,b,o-b)),b=h,(a.flags?_:i(_))!==a.check){t.msg="incorrect data check",a.mode=_t;break}_=0,u=0}a.mode=dt;case dt:if(a.wrap&&a.flags){for(;u<32;){if(0===l)break t;l--,_+=n[s++]<<u,u+=8}if(_!==(4294967295&a.total)){t.msg="incorrect length check",a.mode=_t;break}_=0,u=0}a.mode=ft;case ft:xt=R;break t;case _t:xt=O;break t;case ut:return D;case ct:default:return N}return t.next_out=o,t.avail_out=h,t.next_in=s,t.avail_in=l,a.hold=_,a.bits=u,(a.wsize||b!==t.avail_out&&a.mode<_t&&(a.mode<ht||e!==S))&&f(t,t.output,t.next_out,b-t.avail_out)?(a.mode=ut,D):(c-=t.avail_in,b-=t.avail_out,t.total_in+=c,t.total_out+=b,a.total+=b,a.wrap&&b&&(t.adler=a.check=a.flags?v(a.check,r,b,t.next_out-b):p(a.check,r,b,t.next_out-b)),t.data_type=a.bits+(a.last?64:0)+(a.mode===X?128:0)+(a.mode===at||a.mode===Q?256:0),(0===c&&0===b||e===S)&&xt===Z&&(xt=I),xt)}function u(t){if(!t||!t.state)return N;var e=t.state;return e.window&&(e.window=null),t.state=null,Z}function c(t,e){var a;return t&&t.state?(a=t.state,0===(2&a.wrap)?N:(a.head=e,e.done=!1,Z)):N}function b(t,e){var a,i,n,r=e.length;return t&&t.state?(a=t.state,0!==a.wrap&&a.mode!==G?N:a.mode===G&&(i=1,i=p(i,e,r,0),i!==a.check)?O:(n=f(t,e,r,r))?(a.mode=ut,D):(a.havedict=1,Z)):N}var g,m,w=t("../utils/common"),p=t("./adler32"),v=t("./crc32"),k=t("./inffast"),y=t("./inftrees"),x=0,z=1,B=2,S=4,E=5,A=6,Z=0,R=1,C=2,N=-2,O=-3,D=-4,I=-5,U=8,T=1,F=2,L=3,H=4,j=5,K=6,M=7,P=8,Y=9,q=10,G=11,X=12,W=13,J=14,Q=15,V=16,$=17,tt=18,et=19,at=20,it=21,nt=22,rt=23,st=24,ot=25,lt=26,ht=27,dt=28,ft=29,_t=30,ut=31,ct=32,bt=852,gt=592,mt=15,wt=mt,pt=!0;a.inflateReset=s,a.inflateReset2=o,a.inflateResetKeep=r,a.inflateInit=h,a.inflateInit2=l,a.inflate=_,a.inflateEnd=u,a.inflateGetHeader=c,a.inflateSetDictionary=b,a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./inffast":10,"./inftrees":12}],12:[function(t,e,a){"use strict";var i=t("../utils/common"),n=15,r=852,s=592,o=0,l=1,h=2,d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],_=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,a,c,b,g,m,w){var p,v,k,y,x,z,B,S,E,A=w.bits,Z=0,R=0,C=0,N=0,O=0,D=0,I=0,U=0,T=0,F=0,L=null,H=0,j=new i.Buf16(n+1),K=new i.Buf16(n+1),M=null,P=0;for(Z=0;Z<=n;Z++)j[Z]=0;for(R=0;R<c;R++)j[e[a+R]]++;for(O=A,N=n;N>=1&&0===j[N];N--);if(O>N&&(O=N),0===N)return b[g++]=20971520,b[g++]=20971520,w.bits=1,0;for(C=1;C<N&&0===j[C];C++);for(O<C&&(O=C),U=1,Z=1;Z<=n;Z++)if(U<<=1,U-=j[Z],U<0)return-1;if(U>0&&(t===o||1!==N))return-1;for(K[1]=0,Z=1;Z<n;Z++)K[Z+1]=K[Z]+j[Z];for(R=0;R<c;R++)0!==e[a+R]&&(m[K[e[a+R]]++]=R);if(t===o?(L=M=m,z=19):t===l?(L=d,H-=257,M=f,P-=257,z=256):(L=_,M=u,z=-1),F=0,R=0,Z=C,x=g,D=O,I=0,k=-1,T=1<<O,y=T-1,t===l&&T>r||t===h&&T>s)return 1;for(var Y=0;;){Y++,B=Z-I,m[R]<z?(S=0,E=m[R]):m[R]>z?(S=M[P+m[R]],E=L[H+m[R]]):(S=96,E=0),p=1<<Z-I,v=1<<D,C=v;do v-=p,b[x+(F>>I)+v]=B<<24|S<<16|E|0;while(0!==v);for(p=1<<Z-1;F&p;)p>>=1;if(0!==p?(F&=p-1,F+=p):F=0,R++,0===--j[Z]){if(Z===N)break;Z=e[a+m[R]]}if(Z>O&&(F&y)!==k){for(0===I&&(I=O),x+=C,D=Z-I,U=1<<D;D+I<N&&(U-=j[D+I],!(U<=0));)D++,U<<=1;if(T+=1<<D,t===l&&T>r||t===h&&T>s)return 1;k=F&y,b[k]=O<<24|D<<16|x-g|0}}return 0!==F&&(b[x+F]=Z-I<<24|64<<16|0),w.bits=O,0}},{"../utils/common":3}],13:[function(t,e,a){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(t,e,a){"use strict";function i(t){for(var e=t.length;--e>=0;)t[e]=0}function n(t,e,a,i,n){this.static_tree=t,this.extra_bits=e,this.extra_base=a,this.elems=i,this.max_length=n,this.has_stree=t&&t.length}function r(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function s(t){return t<256?lt[t]:lt[256+(t>>>7)]}function o(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function l(t,e,a){t.bi_valid>W-a?(t.bi_buf|=e<<t.bi_valid&65535,o(t,t.bi_buf),t.bi_buf=e>>W-t.bi_valid,t.bi_valid+=a-W):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=a)}function h(t,e,a){l(t,a[2*e],a[2*e+1])}function d(t,e){var a=0;do a|=1&t,t>>>=1,a<<=1;while(--e>0);return a>>>1}function f(t){16===t.bi_valid?(o(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function _(t,e){var a,i,n,r,s,o,l=e.dyn_tree,h=e.max_code,d=e.stat_desc.static_tree,f=e.stat_desc.has_stree,_=e.stat_desc.extra_bits,u=e.stat_desc.extra_base,c=e.stat_desc.max_length,b=0;for(r=0;r<=X;r++)t.bl_count[r]=0;for(l[2*t.heap[t.heap_max]+1]=0,a=t.heap_max+1;a<G;a++)i=t.heap[a],r=l[2*l[2*i+1]+1]+1,r>c&&(r=c,b++),l[2*i+1]=r,i>h||(t.bl_count[r]++,s=0,i>=u&&(s=_[i-u]),o=l[2*i],t.opt_len+=o*(r+s),f&&(t.static_len+=o*(d[2*i+1]+s)));if(0!==b){do{for(r=c-1;0===t.bl_count[r];)r--;t.bl_count[r]--,t.bl_count[r+1]+=2,t.bl_count[c]--,b-=2}while(b>0);for(r=c;0!==r;r--)for(i=t.bl_count[r];0!==i;)n=t.heap[--a],n>h||(l[2*n+1]!==r&&(t.opt_len+=(r-l[2*n+1])*l[2*n],l[2*n+1]=r),i--)}}function u(t,e,a){var i,n,r=new Array(X+1),s=0;for(i=1;i<=X;i++)r[i]=s=s+a[i-1]<<1;for(n=0;n<=e;n++){var o=t[2*n+1];0!==o&&(t[2*n]=d(r[o]++,o))}}function c(){var t,e,a,i,r,s=new Array(X+1);for(a=0,i=0;i<K-1;i++)for(dt[i]=a,t=0;t<1<<et[i];t++)ht[a++]=i;for(ht[a-1]=i,r=0,i=0;i<16;i++)for(ft[i]=r,t=0;t<1<<at[i];t++)lt[r++]=i;for(r>>=7;i<Y;i++)for(ft[i]=r<<7,t=0;t<1<<at[i]-7;t++)lt[256+r++]=i;for(e=0;e<=X;e++)s[e]=0;for(t=0;t<=143;)st[2*t+1]=8,t++,s[8]++;for(;t<=255;)st[2*t+1]=9,t++,s[9]++;for(;t<=279;)st[2*t+1]=7,t++,s[7]++;for(;t<=287;)st[2*t+1]=8,t++,s[8]++;for(u(st,P+1,s),t=0;t<Y;t++)ot[2*t+1]=5,ot[2*t]=d(t,5);_t=new n(st,et,M+1,P,X),ut=new n(ot,at,0,Y,X),ct=new n(new Array(0),it,0,q,J)}function b(t){var e;for(e=0;e<P;e++)t.dyn_ltree[2*e]=0;for(e=0;e<Y;e++)t.dyn_dtree[2*e]=0;for(e=0;e<q;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*Q]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function g(t){t.bi_valid>8?o(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function m(t,e,a,i){g(t),i&&(o(t,a),o(t,~a)),N.arraySet(t.pending_buf,t.window,e,a,t.pending),t.pending+=a}function w(t,e,a,i){var n=2*e,r=2*a;return t[n]<t[r]||t[n]===t[r]&&i[e]<=i[a]}function p(t,e,a){for(var i=t.heap[a],n=a<<1;n<=t.heap_len&&(n<t.heap_len&&w(e,t.heap[n+1],t.heap[n],t.depth)&&n++,!w(e,i,t.heap[n],t.depth));)t.heap[a]=t.heap[n],a=n,n<<=1;t.heap[a]=i}function v(t,e,a){var i,n,r,o,d=0;if(0!==t.last_lit)do i=t.pending_buf[t.d_buf+2*d]<<8|t.pending_buf[t.d_buf+2*d+1],n=t.pending_buf[t.l_buf+d],d++,0===i?h(t,n,e):(r=ht[n],h(t,r+M+1,e),o=et[r],0!==o&&(n-=dt[r],l(t,n,o)),i--,r=s(i),h(t,r,a),o=at[r],0!==o&&(i-=ft[r],l(t,i,o)));while(d<t.last_lit);h(t,Q,e)}function k(t,e){var a,i,n,r=e.dyn_tree,s=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=G,a=0;a<l;a++)0!==r[2*a]?(t.heap[++t.heap_len]=h=a,t.depth[a]=0):r[2*a+1]=0;for(;t.heap_len<2;)n=t.heap[++t.heap_len]=h<2?++h:0,r[2*n]=1,t.depth[n]=0,t.opt_len--,o&&(t.static_len-=s[2*n+1]);for(e.max_code=h,a=t.heap_len>>1;a>=1;a--)p(t,r,a);n=l;do a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],p(t,r,1),i=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=i,r[2*n]=r[2*a]+r[2*i],t.depth[n]=(t.depth[a]>=t.depth[i]?t.depth[a]:t.depth[i])+1,r[2*a+1]=r[2*i+1]=n,t.heap[1]=n++,p(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],_(t,e),u(r,h,t.bl_count)}function y(t,e,a){var i,n,r=-1,s=e[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),e[2*(a+1)+1]=65535,i=0;i<=a;i++)n=s,s=e[2*(i+1)+1],++o<l&&n===s||(o<h?t.bl_tree[2*n]+=o:0!==n?(n!==r&&t.bl_tree[2*n]++,t.bl_tree[2*V]++):o<=10?t.bl_tree[2*$]++:t.bl_tree[2*tt]++,o=0,r=n,0===s?(l=138,h=3):n===s?(l=6,h=3):(l=7,h=4))}function x(t,e,a){var i,n,r=-1,s=e[1],o=0,d=7,f=4;for(0===s&&(d=138,f=3),i=0;i<=a;i++)if(n=s,s=e[2*(i+1)+1],!(++o<d&&n===s)){if(o<f){do h(t,n,t.bl_tree);while(0!==--o)}else 0!==n?(n!==r&&(h(t,n,t.bl_tree),o--),h(t,V,t.bl_tree),l(t,o-3,2)):o<=10?(h(t,$,t.bl_tree),l(t,o-3,3)):(h(t,tt,t.bl_tree),l(t,o-11,7));o=0,r=n,0===s?(d=138,f=3):n===s?(d=6,f=3):(d=7,f=4)}}function z(t){var e;for(y(t,t.dyn_ltree,t.l_desc.max_code),y(t,t.dyn_dtree,t.d_desc.max_code),k(t,t.bl_desc),e=q-1;e>=3&&0===t.bl_tree[2*nt[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function B(t,e,a,i){var n;for(l(t,e-257,5),l(t,a-1,5),l(t,i-4,4),n=0;n<i;n++)l(t,t.bl_tree[2*nt[n]+1],3);x(t,t.dyn_ltree,e-1),x(t,t.dyn_dtree,a-1)}function S(t){var e,a=4093624447;for(e=0;e<=31;e++,a>>>=1)if(1&a&&0!==t.dyn_ltree[2*e])return D;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return I;for(e=32;e<M;e++)if(0!==t.dyn_ltree[2*e])return I;return D}function E(t){bt||(c(),bt=!0),t.l_desc=new r(t.dyn_ltree,_t),t.d_desc=new r(t.dyn_dtree,ut),t.bl_desc=new r(t.bl_tree,ct),t.bi_buf=0,t.bi_valid=0,b(t)}function A(t,e,a,i){l(t,(T<<1)+(i?1:0),3),m(t,e,a,!0)}function Z(t){l(t,F<<1,3),h(t,Q,st),f(t)}function R(t,e,a,i){var n,r,s=0;t.level>0?(t.strm.data_type===U&&(t.strm.data_type=S(t)),k(t,t.l_desc),k(t,t.d_desc),s=z(t),n=t.opt_len+3+7>>>3,r=t.static_len+3+7>>>3,r<=n&&(n=r)):n=r=a+5,a+4<=n&&e!==-1?A(t,e,a,i):t.strategy===O||r===n?(l(t,(F<<1)+(i?1:0),3),v(t,st,ot)):(l(t,(L<<1)+(i?1:0),3),B(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),v(t,t.dyn_ltree,t.dyn_dtree)),b(t),i&&g(t)}function C(t,e,a){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&a,t.last_lit++,0===e?t.dyn_ltree[2*a]++:(t.matches++,e--,t.dyn_ltree[2*(ht[a]+M+1)]++,t.dyn_dtree[2*s(e)]++),t.last_lit===t.lit_bufsize-1}var N=t("../utils/common"),O=4,D=0,I=1,U=2,T=0,F=1,L=2,H=3,j=258,K=29,M=256,P=M+1+K,Y=30,q=19,G=2*P+1,X=15,W=16,J=7,Q=256,V=16,$=17,tt=18,et=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],at=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],it=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],nt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],rt=512,st=new Array(2*(P+2));i(st);var ot=new Array(2*Y);i(ot);var lt=new Array(rt);i(lt);var ht=new Array(j-H+1);i(ht);var dt=new Array(K);i(dt);var ft=new Array(Y);i(ft);var _t,ut,ct,bt=!1;a._tr_init=E,a._tr_stored_block=A,a._tr_flush_block=R,a._tr_tally=C,a._tr_align=Z},{"../utils/common":3}],15:[function(t,e,a){"use strict";function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}e.exports=i},{}],"/":[function(t,e,a){"use strict";var i=t("./lib/utils/common").assign,n=t("./lib/deflate"),r=t("./lib/inflate"),s=t("./lib/zlib/constants"),o={};i(o,n,r,s),e.exports=o},{"./lib/deflate":1,"./lib/inflate":2,"./lib/utils/common":3,"./lib/zlib/constants":6}]},{},[])("/")})();
// This is the minified js of the zstddec npm package (https://www.npmjs.com/package/zstddec) at version 0.0.2. We make one modification where we change the last line from `exports.ZSTDDecoder=Q;` to `globalThis.ZSTDDecoder=Q;` in order to make the library globally available for us to use.

var A,I,B,g={env:{emscripten_notify_memory_growth:function(A){B=new Uint8Array(I.exports.memory.buffer)}}},Q=function(){function Q(){}var E=Q.prototype;return E.init=function(){return A||(A="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+C).then(function(A){return A.arrayBuffer()}).then(function(A){return WebAssembly.instantiate(A,g)}).then(this._init):WebAssembly.instantiate(Buffer.from(C,"base64"),g).then(this._init))},E._init=function(A){I=A.instance,g.env.emscripten_notify_memory_growth(0)},E.decode=function(A,g){if(void 0===g&&(g=0),!I)throw new Error("ZSTDDecoder: Await .init() before decoding.");var Q=A.byteLength,C=I.exports.malloc(Q);B.set(A,C),g=g||Number(I.exports.ZSTD_findDecompressedSize(C,Q));var E=I.exports.malloc(g),i=I.exports.ZSTD_decompress(E,g,C,Q),D=B.slice(E,E+i);return I.exports.free(C),I.exports.free(E),D},Q}(),C="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ";globalThis.ZSTDDecoder=Q;
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).RBush=i()}(this,function(){"use strict";function t(t,r,e,a,h){!function t(n,r,e,a,h){for(;a>e;){if(a-e>600){var o=a-e+1,s=r-e+1,l=Math.log(o),f=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*f*(o-f)/o)*(s-o/2<0?-1:1),m=Math.max(e,Math.floor(r-s*f/o+u)),c=Math.min(a,Math.floor(r+(o-s)*f/o+u));t(n,r,m,c,h)}var p=n[r],d=e,x=a;for(i(n,e,r),h(n[a],p)>0&&i(n,e,a);d<x;){for(i(n,d,x),d++,x--;h(n[d],p)<0;)d++;for(;h(n[x],p)>0;)x--}0===h(n[e],p)?i(n,e,x):i(n,++x,a),x<=r&&(e=x+1),r<=x&&(a=x-1)}}(t,r,e||0,a||t.length-1,h||n)}function i(t,i,n){var r=t[i];t[i]=t[n],t[n]=r}function n(t,i){return t<i?-1:t>i?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function e(t,i,n){if(!n)return i.indexOf(t);for(var r=0;r<i.length;r++)if(n(t,i[r]))return r;return-1}function a(t,i){h(t,0,t.children.length,i,t)}function h(t,i,n,r,e){e||(e=p(null)),e.minX=1/0,e.minY=1/0,e.maxX=-1/0,e.maxY=-1/0;for(var a=i;a<n;a++){var h=t.children[a];o(e,t.leaf?r(h):h)}return e}function o(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function s(t,i){return t.minX-i.minX}function l(t,i){return t.minY-i.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function m(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function c(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(i,n,r,e,a){for(var h=[n,r];h.length;)if(!((r=h.pop())-(n=h.pop())<=e)){var o=n+Math.ceil((r-n)/e/2)*e;t(i,o,n,r,a),h.push(n,o,o,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var i=this.data,n=[];if(!c(t,i))return n;for(var r=this.toBBox,e=[];i;){for(var a=0;a<i.children.length;a++){var h=i.children[a],o=i.leaf?r(h):h;c(t,o)&&(i.leaf?n.push(h):m(t,o)?this._all(h,n):e.push(h))}i=e.pop()}return n},r.prototype.collides=function(t){var i=this.data;if(!c(t,i))return!1;for(var n=[];i;){for(var r=0;r<i.children.length;r++){var e=i.children[r],a=i.leaf?this.toBBox(e):e;if(c(t,a)){if(i.leaf||m(t,a))return!0;n.push(e)}}i=n.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0;i<t.length;i++)this.insert(t[i]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(t,i){if(!t)return this;for(var n,r,a,h=this.data,o=this.toBBox(t),s=[],l=[];h||s.length;){if(h||(h=s.pop(),r=s[s.length-1],n=l.pop(),a=!0),h.leaf){var f=e(t,h.children,i);if(-1!==f)return h.children.splice(f,1),s.push(h),this._condense(s),this}a||h.leaf||!m(h,o)?r?(n++,h=r.children[n],a=!1):h=null:(s.push(h),l.push(n),n=0,r=h,h=h.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,i){return t.minX-i.minX},r.prototype.compareMinY=function(t,i){return t.minY-i.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},r.prototype._build=function(t,i,n,r){var e,h=n-i+1,o=this._maxEntries;if(h<=o)return a(e=p(t.slice(i,n+1)),this.toBBox),e;r||(r=Math.ceil(Math.log(h)/Math.log(o)),o=Math.ceil(h/Math.pow(o,r-1))),(e=p([])).leaf=!1,e.height=r;var s=Math.ceil(h/o),l=s*Math.ceil(Math.sqrt(o));d(t,i,n,l,this.compareMinX);for(var f=i;f<=n;f+=l){var u=Math.min(f+l-1,n);d(t,f,u,s,this.compareMinY);for(var m=f;m<=u;m+=s){var c=Math.min(m+s-1,u);e.children.push(this._build(t,m,c,r-1))}}return a(e,this.toBBox),e},r.prototype._chooseSubtree=function(t,i,n,r){for(;r.push(i),!i.leaf&&r.length-1!==n;){for(var e=1/0,a=1/0,h=void 0,o=0;o<i.children.length;o++){var s=i.children[o],l=f(s),u=(m=t,c=s,(Math.max(c.maxX,m.maxX)-Math.min(c.minX,m.minX))*(Math.max(c.maxY,m.maxY)-Math.min(c.minY,m.minY))-l);u<a?(a=u,e=l<e?l:e,h=s):u===a&&l<e&&(e=l,h=s)}i=h||i.children[0]}var m,c;return i},r.prototype._insert=function(t,i,n){var r=n?t:this.toBBox(t),e=[],a=this._chooseSubtree(r,this.data,i,e);for(a.children.push(t),o(a,r);i>=0&&e[i].children.length>this._maxEntries;)this._split(e,i),i--;this._adjustParentBBoxes(r,e,i)},r.prototype._split=function(t,i){var n=t[i],r=n.children.length,e=this._minEntries;this._chooseSplitAxis(n,e,r);var h=this._chooseSplitIndex(n,e,r),o=p(n.children.splice(h,n.children.length-h));o.height=n.height,o.leaf=n.leaf,a(n,this.toBBox),a(o,this.toBBox),i?t[i-1].children.push(o):this._splitRoot(n,o)},r.prototype._splitRoot=function(t,i){this.data=p([t,i]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,i,n){for(var r,e,a,o,s,l,u,m=1/0,c=1/0,p=i;p<=n-i;p++){var d=h(t,0,p,this.toBBox),x=h(t,p,n,this.toBBox),v=(e=d,a=x,o=void 0,s=void 0,l=void 0,u=void 0,o=Math.max(e.minX,a.minX),s=Math.max(e.minY,a.minY),l=Math.min(e.maxX,a.maxX),u=Math.min(e.maxY,a.maxY),Math.max(0,l-o)*Math.max(0,u-s)),M=f(d)+f(x);v<m?(m=v,r=p,c=M<c?M:c):v===m&&M<c&&(c=M,r=p)}return r||n-i},r.prototype._chooseSplitAxis=function(t,i,n){var r=t.leaf?this.compareMinX:s,e=t.leaf?this.compareMinY:l;this._allDistMargin(t,i,n,r)<this._allDistMargin(t,i,n,e)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,i,n,r){t.children.sort(r);for(var e=this.toBBox,a=h(t,0,i,e),s=h(t,n-i,n,e),l=u(a)+u(s),f=i;f<n-i;f++){var m=t.children[f];o(a,t.leaf?e(m):m),l+=u(a)}for(var c=n-i-1;c>=i;c--){var p=t.children[c];o(s,t.leaf?e(p):p),l+=u(s)}return l},r.prototype._adjustParentBBoxes=function(t,i,n){for(var r=n;r>=0;r--)o(i[r],t)},r.prototype._condense=function(t){for(var i=t.length-1,n=void 0;i>=0;i--)0===t[i].children.length?i>0?(n=t[i-1].children).splice(n.indexOf(t[i]),1):this.clear():a(t[i],this.toBBox)},r});
var kiwi=(()=>{var k=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var M=(l,e)=>{for(var t in e)k(l,t,{get:e[t],enumerable:!0})},F=(l,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of C(e))!N.call(l,r)&&r!==t&&k(l,r,{get:()=>e[r],enumerable:!(n=K(e,r))||n.enumerable});return l};var R=l=>F(k({},"__esModule",{value:!0}),l);var oe={};M(oe,{compileSchema:()=>I,decodeBinarySchema:()=>w,encodeBinarySchema:()=>D,parseSchema:()=>B});var A=new Int32Array(1),E=new Float32Array(A.buffer),p=class{constructor(e){if(e&&!(e instanceof Uint8Array))throw new Error("Must initialize a ByteBuffer with a Uint8Array");this._data=e||new Uint8Array(256),this._index=0,this._start=0,this.length=e?e.length:0}extendWindowTo(e){this._index=e._index}getNewWindowFromRight(){let e=new p(this._data);return e._index=this._index,e._start=this._index,e}windowToUint8Array(){return this._data.subarray(this._start,this._index)}toUint8Array(){return this._data.subarray(0,this.length)}readByte(){if(this._index+1>this._data.length)throw new Error("Index out of bounds");return this._data[this._index++]}readByteArray(){let e=this.readVarUint(),t=this._index,n=t+e;if(n>this._data.length)throw new Error("Read array out of bounds");this._index=n;let r=new Uint8Array(e);return r.set(this._data.subarray(t,n)),r}readVarFloat(){let e=this._index,t=this._data,n=t.length;if(e+1>n)throw new Error("Index out of bounds");let r=t[e];if(r===0)return this._index=e+1,0;if(e+4>n)throw new Error("Index out of bounds");let i=r|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24;return this._index=e+4,i=i<<23|i>>>9,A[0]=i,E[0]}readVarUint(){let e=0,t=0;do{var n=this.readByte();e|=(n&127)<<t,t+=7}while(n&128&&t<35);return e>>>0}readVarInt(){let e=this.readVarUint()|0;return e&1?~(e>>>1):e>>>1}readVarUint64Bin(){let e=0,t="";do{var n=this.readByte();if(e<8){let r=((n&127)>>>0).toString(2);t=(n&128?r.padStart(7,"0"):r)+t}else{t=n.toString(2)+t;break}e+=1}while(n&128);return t}readVarUint64(){return this.convertBase(this.readVarUint64Bin(),2,10)}readVarInt64(){let e=this.readVarUint64Bin();if(e.slice(-1)=="1"){let t=this.parseToDigitsArray(e.slice(0,-1),2);return t=this.add(t,[1],2),"-"+this.convertBase(this.parseFromDigitsArray(t,2),2,10)}else return this.convertBase(e.slice(0,-1),2,10)}readString(){let e="";for(;;){let t,n=this.readByte();if(n<192)t=n;else{let r=this.readByte();if(n<224)t=(n&31)<<6|r&63;else{let i=this.readByte();if(n<240)t=(n&15)<<12|(r&63)<<6|i&63;else{let a=this.readByte();t=(n&7)<<18|(r&63)<<12|(i&63)<<6|a&63}}}if(t===0)break;t<65536?e+=String.fromCharCode(t):(t-=65536,e+=String.fromCharCode((t>>10)+55296,(t&(1<<10)-1)+56320))}return e}_growBy(e){if(this.length+e>this._data.length){let t=new Uint8Array(this.length+e<<1);t.set(this._data),this._data=t}this.length+=e}writeByte(e){let t=this.length;this._growBy(1),this._data[t]=e}writeByteArray(e){this.writeVarUint(e.length);let t=this.length;this._growBy(e.length),this._data.set(e,t)}writeVarFloat(e){let t=this.length;E[0]=e;let n=A[0];if(n=n>>>23|n<<9,(n&255)===0){this.writeByte(0);return}this._growBy(4);let r=this._data;r[t]=n,r[t+1]=n>>8,r[t+2]=n>>16,r[t+3]=n>>24}writeVarUint(e){do{let t=e&127;e>>>=7,this.writeByte(e?t|128:t)}while(e)}writeVarInt(e){this.writeVarUint(e<<1^e>>31)}writeVarUint64Helper(e){if(!!e){var t=0;do{if(t<8){var n=parseInt(e.slice(-7),2);e=e.slice(0,-7)}else{var n=parseInt(e.slice(-8),2);e=e.slice(0,-8),this.writeByte(n);break}this.writeByte(e?n|128:n),t+=1}while(e)}}writeVarUint64(e){e=this.cleanNumericString(e);let t=this.convertBase(e,10,2);this.writeVarUint64Helper(t)}subtractOne(e){let t=1,n=e.split("").map(Number);for(let r=n.length-1;r>=0;r--)if(n[r]<t)n[r]=1;else{n[r]--,t=0;break}return n.join("").replace(/^0+/,"")}cleanNumericString(e){let t="";for(let n=0;n<e.length;n++){let r=e.charAt(n);(r>="0"&&r<="9"||n===0&&r==="-")&&(t+=r)}return t}writeVarInt64(e){if(e=this.cleanNumericString(e),e!=""){if(e[0]!="-")var t=this.convertBase(e,10,2)+"0";else{var t=this.convertBase(e.slice(1),10,2);if(t=="0"||t==""){this.writeVarUint64("0");return}t=this.subtractOne(t)+"1"}this.writeVarUint64Helper(t)}}add(e,t,n){let r=[],i=Math.max(e.length,t.length),a=0,s=0;for(;s<i||a;){let h=s<e.length?e[s]:0,d=s<t.length?t[s]:0,u=a+h+d;r.push(u%n),a=Math.floor(u/n),s++}return r}multiplyByNumber(e,t,n){if(e<0)return[];if(e===0)return[];let r=[],i=t;for(;e&1&&(r=this.add(r,i,n)),e=e>>1,e!==0;)i=this.add(i,i,n);return r}parseToDigitsArray(e,t){let n=e.toString().split(""),r=[];for(let i=n.length-1;i>=0;i--){let a=parseInt(n[i],t);if(isNaN(a))return[];r.push(a)}return r}parseFromDigitsArray(e,t){let n="";for(let r=e.length-1;r>=0;r--)n+=e[r].toString(t);return n}convertBase(e,t,n){let r=this.parseToDigitsArray(e,t);if(r===null)return"";let i=[0],a=[1];for(let s=0;s<r.length;s++)r[s]&&(i=this.add(i,this.multiplyByNumber(r[s],a,n),n)),a=this.multiplyByNumber(t,a,n);return this.parseFromDigitsArray(i,n)}writeString(e){let t;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(n+1===e.length||r<55296||r>=56320)t=r;else{let i=e.charCodeAt(++n);t=(r<<10)+i+(65536-(55296<<10)-56320)}if(t===0)throw new Error("Cannot encode a string containing the null character");t<128?this.writeByte(t):(t<2048?this.writeByte(t>>6&31|192):(t<65536?this.writeByte(t>>12&15|224):(this.writeByte(t>>18&7|240),this.writeByte(t>>12&63|128)),this.writeByte(t>>6&63|128)),this.writeByte(t&63|128))}this.writeByte(0)}};var S=["bool","byte","int","uint","float","string","int64","uint64"],U=["ENUM","STRUCT","MESSAGE"];function w(l){let e=l instanceof p?l:new p(l),t=e.readVarUint(),n=[];for(let r=0;r<t;r++){let i=e.readString(),a=e.readByte(),s=e.readVarUint(),h=[];for(let d=0;d<s;d++){let u=e.readString(),y=e.readVarInt(),m=!!(e.readByte()&1),g=e.readVarUint();h.push({name:u,line:0,column:0,type:U[a]==="ENUM"?null:y,isArray:m,isDeprecated:!1,value:g})}n.push({name:i,line:0,column:0,kind:U[a],fields:h})}for(let r=0;r<t;r++){let i=n[r].fields;for(let a=0;a<i.length;a++){let s=i[a],h=s.type;if(h!==null&&h<0){if(~h>=S.length)throw new Error("Invalid type "+h);s.type=S[~h]}else{if(h!==null&&h>=n.length)throw new Error("Invalid type "+h);s.type=h===null?null:n[h].name}}}return{package:null,definitions:n}}function D(l){let e=new p,t=l.definitions,n={};e.writeVarUint(t.length);for(let r=0;r<t.length;r++)n[t[r].name]=r;for(let r=0;r<t.length;r++){let i=t[r];e.writeString(i.name),e.writeByte(U.indexOf(i.kind)),e.writeVarUint(i.fields.length);for(let a=0;a<i.fields.length;a++){let s=i.fields[a],h=S.indexOf(s.type);e.writeString(s.name),e.writeVarInt(h===-1?n[s.type]:~h),e.writeByte(s.isArray?1:0),e.writeVarUint(s.value)}}return e.toUint8Array()}var V=class{constructor(){this._float=new Float32Array(1),this._int=new Int32Array(this._float.buffer),this._value=0}reset(){this._value=0}value(){return this._value}hashStr(e){for(var t=0;t<e.length;++t)this.hashI(e.codePointAt(t)||0)}hashBool(e){this.hashI(e?1:0)}hashBytes(e){for(var t=0;t<e.length;++t)this.hashI(e[t])}hashF(e){this._float[0]=e,this._value=this._combine(this._value,this._int[0])}hashI(e){this._value=this._combine(this._value,e)}_combine(e,t){return t+2654435769+(e<<6)+(e>>2)}},v=class{constructor(e){this._helper=new V,this._bb=e}bb(){return this._bb}windowToUint8Array(){return this._bb.windowToUint8Array()}value(){return this._helper.value()}readByte(){let e=this._bb.readByte();return this._helper.hashI(e),e}readByteArray(){let e=this._bb.readByteArray();return this._helper.hashBytes(e),e}readVarFloat(){let e=this._bb.readVarFloat();return this._helper.hashF(e),e}readVarUint(){let e=this._bb.readVarUint();return this._helper.hashI(e),e}readVarInt(){let e=this._bb.readVarInt();return this._helper.hashI(e),e}readVarUint64(){let e=this._bb.readVarUint64();return this._helper.hashStr(e),e}readVarInt64(){let e=this._bb.readVarInt64();return this._helper.hashStr(e),e}readString(){let e=this._bb.readString();return this._helper.hashStr(e),e}};var b=class{constructor(e,t){this._buckets=new Map,this._hash=e,this._equals=t}get(e,t){let n=this._hash(e),r=this._buckets.get(n);if(r!==void 0)for(let i=0;i<r.length;++i){let a=r[i];if(this._equals(e,a.key))return a.value}return t}set(e,t){let n=this._hash(e),r=this._buckets.get(n);r===void 0&&(r=[],this._buckets.set(n,r));for(let i=0;i<r.length;++i){let a=r[i];if(this._equals(e,a.key))return a.value=t,t}return r.push({key:e,value:t}),t}remove(e){let t=this._hash(e),n=this._buckets.get(t);if(n!==void 0){for(let r=0;r<n.length;++r)if(this._equals(e,n[r].key)){n.splice(r,1),n.length===0&&this._buckets.delete(t);break}}}};function o(l){return JSON.stringify(l)}function f(l,e,t){var n=new Error(l);throw n.line=e,n.column=t,n}var H=["bool","byte","float","int","string","uint","int64","uint64"],G=["ByteBuffer","package"],O=/((?:-|\b)\d+\b|[=;{}]|\[\]|\[deprecated\]|\b[A-Za-z_][A-Za-z0-9_]*\b|\/\/.*|\s+)/g,x=/^[A-Za-z_][A-Za-z0-9_]*$/,j=/^\/\/.*|\s+$/,q=/^=$/,z=/^$/,T=/^;$/,Z=/^-?\d+$/,P=/^\{$/,W=/^\}$/,J=/^\[\]$/,L=/^enum$/,Q=/^struct$/,X=/^message$/,Y=/^package$/,ee=/^\[deprecated\]$/;function te(l){let e=l.split(O),t=[],n=0,r=0;for(let i=0;i<e.length;i++){let a=e[i];i&1?j.test(a)||t.push({text:a,line:r+1,column:n+1}):a!==""&&f("Syntax error "+o(a),r+1,n+1);let s=a.split(`
`);s.length>1&&(n=0),r+=s.length-1,n+=s[s.length-1].length}return t.push({text:"",line:r,column:n}),t}function re(l){function e(){return l[s]}function t(h){return h.test(e().text)?(s++,!0):!1}function n(h,d){if(!t(h)){let u=e();f("Expected "+d+" but found "+o(u.text),u.line,u.column)}}function r(){let h=e();f("Unexpected token "+o(h.text),h.line,h.column)}let i=[],a=null,s=0;for(t(Y)&&(a=e().text,n(x,"identifier"),n(T,'";"'));s<l.length&&!t(z);){let h=[],d;t(L)?d="ENUM":t(Q)?d="STRUCT":t(X)?d="MESSAGE":r();let u=e();for(n(x,"identifier"),n(P,'"{"');!t(W);){let y=null,m=!1,g=!1;d!=="ENUM"&&(y=e().text,n(x,"identifier"),m=t(J));let _=e();n(x,"identifier");let c=null;d!=="STRUCT"&&(n(q,'"="'),c=e(),n(Z,"integer"),(+c.text|0)+""!==c.text&&f("Invalid integer "+o(c.text),c.line,c.column));let $=e();t(ee)&&(d!=="MESSAGE"&&f("Cannot deprecate this field",$.line,$.column),g=!0),n(T,'";"'),h.push({name:_.text,line:_.line,column:_.column,type:y,isArray:m,isDeprecated:g,value:c!==null?+c.text|0:h.length+1})}i.push({name:u.text,line:u.line,column:u.column,kind:d,fields:h})}return{package:a,definitions:i}}function ie(l){let e=H.slice(),t={};for(let i=0;i<l.definitions.length;i++){let a=l.definitions[i];e.indexOf(a.name)!==-1&&f("The type "+o(a.name)+" is defined twice",a.line,a.column),G.indexOf(a.name)!==-1&&f("The type name "+o(a.name)+" is reserved",a.line,a.column),e.push(a.name),t[a.name]=a}for(let i=0;i<l.definitions.length;i++){let a=l.definitions[i],s=a.fields;if(a.kind==="ENUM"||s.length===0)continue;for(let d=0;d<s.length;d++){let u=s[d];e.indexOf(u.type)===-1&&f("The type "+o(u.type)+" is not defined for field "+o(u.name),u.line,u.column)}let h=[];for(let d=0;d<s.length;d++){let u=s[d];h.indexOf(u.value)!==-1&&f("The id for field "+o(u.name)+" is used twice",u.line,u.column),u.value<=0&&f("The id for field "+o(u.name)+" must be positive",u.line,u.column),u.value>s.length&&f("The id for field "+o(u.name)+" cannot be larger than "+s.length,u.line,u.column),h.push(u.value)}}let n={},r=i=>{let a=t[i];if(a&&a.kind==="STRUCT"&&(n[i]===1&&f("Recursive nesting of "+o(i)+" is not allowed",a.line,a.column),n[i]!==2&&a)){n[i]=1;let s=a.fields;for(let h=0;h<s.length;h++){let d=s[h];d.isArray||r(d.type)}n[i]=2}return!0};for(let i=0;i<l.definitions.length;i++)r(l.definitions[i].name)}function B(l){let e=re(te(l));return ie(e),e}function ne(l,e,t,n){let r=[],i="  ";r.push("function(bb, optDedupCache) {"),r.push("  var dedupKey = null;"),t.includes(l.name)&&(r.push("  if (!!optDedupCache) {"),r.push("    if (!(optDedupCache instanceof this.HashTable)) {"),r.push('      throw new Error("optDedupCache must be instance of HashTable");'),r.push("    }"),r.push("    // lookahead with hasher then reference result with dedup cache"),r.push("    var hasher = new this.Hasher(bb.getNewWindowFromRight());"),r.push(`    this[${o("hash"+l.name)}](hasher);`),r.push(`    dedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${o(l.name)} };`),r.push("    var cachedResult = optDedupCache.get(dedupKey, null);"),r.push("    if (cachedResult !== null) {"),r.push("      bb.extendWindowTo(hasher.bb());"),r.push("      return cachedResult;"),r.push("    }"),r.push("  }")),r.push("  var result = {};"),r.push("  if (!(bb instanceof this.ByteBuffer)) {"),r.push("    bb = new this.ByteBuffer(bb);"),r.push("  }"),r.push(""),l.kind==="MESSAGE"&&(r.push("  while (true) {"),r.push("  var x = bb.readVarUint();"),r.push("    switch (x) {"),r.push("    case 0:"),r.push("      return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),r.push(""),i="      ");for(let a=0;a<l.fields.length;a++){let s=l.fields[a],h,d;switch(s.type){case"bool":{h="!!bb.readByte()",d="!!hasher.readByte()";break}case"byte":{h="bb.readByte()",d="hasher.readByte()";break}case"int":{h="bb.readVarInt()",d="hasher.readVarInt()";break}case"uint":{h="bb.readVarUint()",d="hasher.readVarUint()";break}case"int64":{h="bb.readVarInt64()",d="hasher.readVarInt64()";break}case"uint64":{h="bb.readVarUint64()",d="hasher.readVarUint64()";break}case"float":{h="bb.readVarFloat()",d="hasher.readVarFloat()";break}case"string":{h="bb.readString()",d="hasher.readString()";break}default:{let u=e[s.type];u?u.kind==="ENUM"?(h=`this[${o(u.name)}][bb.readVarUint()]`,d=`this[${o(u.name)}][hasher.readVarUint()]`):(h=`this[${o("decode"+u.name)}](bb, optDedupCache || null)`,d=`this[${o("hash"+u.name)}](hasher)`):f(`Invalid type ${o(s.type)} for field ${o(s.name)}`,s.line,s.column)}}l.kind==="MESSAGE"&&r.push(`    case ${s.value}:`),s.isArray?s.isDeprecated?s.type==="byte"?r.push(i+"bb.readByteArray();"):(r.push(i+"var length = bb.readVarUint();"),r.push(i+`while (length-- > 0) ${h};`)):s.type==="byte"?r.push(i+`result[${o(s.name)}] = bb.readByteArray();`):(r.push(i+"var arrayDedupKey = null;"),r.push(i+"var values = null;"),n.includes(s.type)&&(r.push(i+"if (!!optDedupCache) {"),r.push(i+"  // lookahead with hasher then reference result with dedup cache"),r.push(i+"  var hasher = new this.Hasher(bb.getNewWindowFromRight());"),r.push(i+"  var length = hasher.readVarUint();"),r.push(i+`  for (var i = 0; i < length; i++) ${d};`),r.push(i+`  arrayDedupKey = { hash: hasher.value(), data: hasher.windowToUint8Array(), defName: ${o(s.type+"[]")} };`),r.push(i+"  var cachedResult = optDedupCache.get(arrayDedupKey, null);"),r.push(i+"  if (cachedResult !== null) {"),r.push(i+"    bb.extendWindowTo(hasher.bb());"),r.push(i+"    values = cachedResult;"),r.push(i+"  }"),r.push(i+"}")),r.push(i+"if (values === null) {"),r.push(i+"  var length = bb.readVarUint();"),r.push(i+"  var values = Array(length);"),r.push(i+`  for (var i = 0; i < length; i++) values[i] = ${h};`),r.push(i+"  if (arrayDedupKey !== null) { optDedupCache.set(arrayDedupKey, values); }"),r.push(i+"}"),r.push(i+`result[${o(s.name)}] = values;`)):s.isDeprecated?r.push(i+`${h};`):r.push(i+`result[${o(s.name)}] = ${h};`),l.kind==="MESSAGE"&&(r.push("      break;"),r.push(""))}return l.kind==="MESSAGE"?(r.push("    default:"),r.push('      throw new Error("Attempted to parse invalid message");'),r.push("    }"),r.push("  }")):r.push("  return dedupKey !== null ? optDedupCache.set(dedupKey, result) : result;"),r.push("}"),r.join(`
`)}function ae(l,e){let t=[],n="  ";t.push("function(hasher) {"),t.push("  var result = {};"),t.push("  if (!(hasher instanceof this.Hasher)) {"),t.push('    throw new Error("Expected Hasher");'),t.push("  }"),t.push(""),l.kind==="MESSAGE"&&(t.push("  while (true) {"),t.push("    switch (hasher.readVarUint()) {"),t.push("    case 0:"),t.push("      return;"),t.push(""),n="      ");for(let r=0;r<l.fields.length;r++){let i=l.fields[r],a;switch(i.type){case"bool":{a="hasher.readByte()";break}case"byte":{a="hasher.readByte()";break}case"int":{a="hasher.readVarInt()";break}case"uint":{a="hasher.readVarUint()";break}case"int64":{a="hasher.readVarInt64()";break}case"uint64":{a="hasher.readVarUint64()";break}case"float":{a="hasher.readVarFloat()";break}case"string":{a="hasher.readString()";break}default:{let s=e[i.type];s?s.kind==="ENUM"?a="hasher.readVarUint()":a=`this[${o("hash"+s.name)}](hasher)`:f(`Invalid type ${o(i.type)} for field ${o(i.name)}`,i.line,i.column)}}l.kind==="MESSAGE"&&t.push(`    case ${i.value}:`),i.isArray?i.type==="byte"?t.push(n+"hasher.readByteArray();"):(t.push(n+"var length = hasher.readVarUint();"),t.push(n+`while (length-- > 0) ${a};`)):t.push(n+`${a};`),l.kind==="MESSAGE"&&(t.push("      break;"),t.push(""))}return l.kind==="MESSAGE"?(t.push("    default:"),t.push('      throw new Error("Attempted to parse invalid message");'),t.push("    }"),t.push("  }")):t.push("  return;"),t.push("}"),t.join(`
`)}function se(l,e){let t=[];t.push("function(message, bb) {"),t.push("  var isTopLevel = !bb;"),t.push("  if (isTopLevel) bb = new this.ByteBuffer();");for(let n=0;n<l.fields.length;n++){let r=l.fields[n],i;if(!r.isDeprecated){switch(r.type){case"bool":{i="bb.writeByte(value);";break}case"byte":{i="bb.writeByte(value);";break}case"int":{i="bb.writeVarInt(value);";break}case"uint":{i="bb.writeVarUint(value);";break}case"int64":{i="bb.writeVarInt64(value);";break}case"uint64":{i="bb.writeVarUint64(value);";break}case"float":{i="bb.writeVarFloat(value);";break}case"string":{i="bb.writeString(value);";break}default:{let a=e[r.type];if(a)a.kind==="ENUM"?i=`var encoded = this[${o(a.name)}][value]; if (encoded === void 0) throw new Error("Invalid value " + JSON.stringify(value) + ${o(" for enum "+o(a.name))}); bb.writeVarUint(encoded);`:i=`this[${o("encode"+a.name)}](value, bb);`;else throw new Error(`Invalid type ${o(r.type)} for field ${o(r.name)}`)}}t.push(""),t.push(`  var value = message[${o(r.name)}];`),t.push("  if (value != null) {"),l.kind==="MESSAGE"&&t.push(`    bb.writeVarUint(${r.value});`),r.isArray?r.type==="byte"?t.push("    bb.writeByteArray(value);"):(t.push("    var values = value, n = values.length;"),t.push("    bb.writeVarUint(n);"),t.push("    for (var i = 0; i < n; i++) {"),t.push("      value = values[i];"),t.push(`      ${i}`),t.push("    }")):t.push(`    ${i}`),l.kind==="STRUCT"&&(t.push("  } else {"),t.push(`    throw new Error(${o("Missing required field "+o(r.name))});`)),t.push("  }")}}return l.kind==="MESSAGE"&&t.push("  bb.writeVarUint(0);"),t.push(""),t.push("  if (isTopLevel) return bb.toUint8Array();"),t.push("}"),t.join(`
`)}function le(l){return typeof l=="string"?B(l):l instanceof Uint8Array||l instanceof p?w(l):l}function he(l,e,t){l=le(l);let n={},r=l.package,i=[];r!==null?i.push(`var ${r} = exports || ${r} || {}, exports;`):(i.push("var exports = exports || {};"),r="exports"),i.push(`${r}.ByteBuffer = ${r}.ByteBuffer || require("kiwi-schema").ByteBuffer;`);for(let a=0;a<l.definitions.length;a++){let s=l.definitions[a];n[s.name]=s}for(let a=0;a<l.definitions.length;a++){let s=l.definitions[a];switch(s.kind){case"ENUM":{let h={};for(let d=0;d<s.fields.length;d++){let u=s.fields[d];h[u.name]=u.value,h[u.value]=u.name}i.push(`${r}[${o(s.name)}] = ${JSON.stringify(h,null,2)};`);break}case"STRUCT":case"MESSAGE":{i.push(""),i.push(`${r}[${o("decode"+s.name)}] = ${ne(s,n,e,t)};`),i.push(""),i.push(`${r}[${o("encode"+s.name)}] = ${se(s,n)};`),i.push(""),i.push(`${r}[${o("hash"+s.name)}] = ${ae(s,n)};`);break}default:f("Invalid definition kind "+o(s.kind),s.line,s.column)}}return i.push(""),i.join(`
`)}function ue(l,e){if(l.length!==e.length)return!1;for(let t=0;t<l.length;t++)if(l[t]!==e[t])return!1;return!0}function I(l,e){let t={ByteBuffer:p,Hasher:v,HashTable:b,makeDedupCache:()=>new b(i=>i.hash,(i,a)=>i.defName===a.defName&&ue(i.data,a.data))},n=[],r=[];return e&&(n=e.filter(i=>!!i.match(/^[A-Za-z_][A-Za-z0-9_]*$/)),r=e.filter(i=>!!i.match(/^[A-Za-z_][A-Za-z0-9_]*\[\]$/)).map(i=>i.slice(0,i.length-2)),r.length+n.length!==e.length&&console.warn("Some definitions to dedup are invalid identifiers, skipping...")),new Function("exports",he(l,n,r))(t),t}return R(oe);})();
